---
description: Next.js framework-specific rules and best practices
globs: ["**/*.{ts,tsx,js,jsx}", "**/app/**/*", "**/pages/**/*", "**/lib/**/*"]
alwaysApply: true
---

# Next.js Rules

## ğŸ—ï¸ Framework Patterns
- App Router exclusively (no Pages Router)
- Server Components for data fetching
- Client Components only when needed
- Server Actions for form mutations

## ğŸ“ Project Structure
```
â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx       # Root layout
â”‚   â”œâ”€â”€ page.tsx         # Home page
â”‚   â”œâ”€â”€ loading.tsx      # Loading UI
â”‚   â””â”€â”€ not-found.tsx    # 404 page
â”œâ”€â”€ components/          # Reusable components
â”œâ”€â”€ lib/                 # Utilities and configurations
â”‚   â”œâ”€â”€ db/             # Database configuration
â”‚   â”œâ”€â”€ trpc/           # tRPC configuration
â”‚   â””â”€â”€ store/          # State management
â”œâ”€â”€ hooks/              # Custom React hooks
â””â”€â”€ types/              # TypeScript definitions
```

## ğŸ¯ Component Design
- Functional components with hooks
- TypeScript strict typing
- Component composition over inheritance
- Server/Client component separation

## ğŸ£ Hooks & State Management
- Built-in React hooks
- Custom hooks for reusable logic
- Rules of Hooks compliance
- Proper cleanup in effects
- Zustand for complex state (optional)

## ğŸ”„ Data Fetching Patterns
- Server Components for initial data
- Client Components for interactive data
- Server Actions for mutations
- tRPC for type-safe APIs (recommended)
- Streaming and Suspense for UX

## ğŸ› ï¸ Recommended Tech Stack (Type-Safe)
- **Styling**: PandaCSS + shadcn/ui (type-safe CSS)
- **Database**: Drizzle ORM + PostgreSQL (type-safe queries)
- **API**: tRPC for end-to-end type-safe APIs
- **State**: Zustand for type-safe state management
- **Linting**: Biome for code quality
- **Testing**: Vitest + Testing Library with TypeScript

## ğŸš€ Performance Features
- Automatic code splitting
- Image optimization with Next.js Image
- Font optimization
- Bundle analyzer integration

## âš™ï¸ Configuration
- next.config.js for build settings
- Environment variables with Zod validation
- Middleware for routing logic
- API routes for external integrations

## ğŸš« Forbidden Practices
- Pages Router in new projects
- Raw fetch calls (use tRPC)
- Raw SQL queries (use Drizzle)
- Traditional CSS (use PandaCSS)
- Manual state management (use Zustand)
- Client-side data fetching in Server Components
- Heavy computations in render
- Missing error boundaries

## ğŸ¯ Best Practices
- Use TypeScript for better DX
- Leverage built-in optimizations
- Proper loading and error states
- SEO optimization with metadata API
- Type-safe configuration with Zod