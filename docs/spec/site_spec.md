# Site Specification

## 1. Overview

This document outlines the core specifications for a modern
single‑page application (SPA) built with the specified tech stack.
It covers architecture, navigation, UI/UX guidelines, billing,
referral, consent, admin features and deployment.

## 2. Technical Stack
- **Framework**: Next.js (App Router) – React 18, TypeScript
- **API / BFF**: tRPC (serverless functions)
- **Authentication**: Auth.js (JWT, Redis deny‑list, session rotation)
- **State Management**: Zustand
- **Styling**: Tailwind CSS + Pandacss (design tokens)
- **UI Components**: Radix UI, Iconify (no emoji)
- **Database / ORM**: PostgreSQL (Neon/pgBouncer) with Drizzle ORM
- **Cache / PubSub**: Upstash Redis (streams + pub/sub + rate‑limit)
- **Payments**: Stripe (Checkout, Billing Portal, Invoices)
- **Testing**: Vitest, Playwright, axe, Lighthouse
- **Lint / Formatting**: Biome
- **Package Manager**: pnpm
- **Containerisation**: Docker + docker‑compose (web, db, redis)

## 3. Navigation / Information Architecture
- `/` – Home / Landing
- `/features` – Feature overview
- `/pricing` – Plans (Small / Medium / Large) with annual discount
- `/docs` – Documentation hub
- `/faq` – Frequently asked questions
- `/blog` – News & announcements
- `/status` – System status page
- `/support` – Contact / ticket form
- `/account` – User account hub
  - `profile` – Basic info, avatar
  - `username` – Unique handle management
  - `security` – 2FA, recovery codes
  - `sessions` – Device list, revoke
  - `billing` – Subscription selection, invoices download
  - `wallet` – Balance, top‑up, transaction history
  - `invites` – Generate / manage invite codes
  - `referral` – Personal link, stats, wallet credit reward
  - `notifications` – Email / push preferences, in‑app center
  - `activity` – Personal activity log
  - `consent` – Cookie & privacy preferences
- `/u/[username]` – Public profile page
- `/admin` – Administration panel
  - `dashboard` – Site‑wide metrics, charts
  - `users` – Search, role, ban, rename audit
  - `billing` – Manage subscriptions, refunds, invoices
  - `wallet` – Reconciliation, anomalies
  - `newsletter` – List, send, unsubscribe stats
  - `invites` – Admin view, limits, revocation
  - `referral` – Programs, links, reward settings
  - `notifications` – Broadcast messages
  - `support` – Ticket queue, status, reply
  - `audit` – Full audit log with filters
  - `membership` – Plan CRUD, discount config
- `/legal` – Legal pages
  - `terms`
  - `privacy`
  - `cookies`

## 4. UI / UX Guidelines (Modern SPA)
### 4.1 Core Principles
- **Minimalist functionalism** – remove unnecessary decoration.
- **Readability first** – clear typography, adequate line‑height and spacing.
- **Consistency** – unified corner radius, spacing, font, colour palette.
- **Fluid interaction** – smooth transitions, no jarring animations.

### 4.2 Visual Design
- **Colour scheme** – Dark mode primary (dark‑gray/black); Light mode as secondary.
- **Accent colour** – Single brand colour (e.g., blue) for buttons and highlights.
- **Contrast** – WCAG AA compliance for text vs background.
- **Shapes** – 8‑12 px border‑radius, soft shadows for elevation.
- **Card layout** – Content blocks as cards, reusable across the app.
- **Typography** – Inter / SF Pro, sans‑serif; headings bold, body regular.

### 4.3 Motion & Interaction
- Transition duration: 200‑400 ms.
- Hover: slight scale (1.03) or deeper shadow.
- Active: slight shrink (0.95‑0.98).
- Page change: fade‑in/out or slide, keeping flow natural.
- Immediate visual feedback for all actions (click, submit, toggle).

### 4.4 Interaction Patterns
- **Chat‑style flow** for conversational sections.
- Fixed input area at the bottom for messaging‑type components.
- Expandable/collapsible sections for long content.
- In‑app notification bell with unread badge.

### 4.5 UX Rules
- Fixed top or side navigation, clear hierarchy.
- Emphasise content, avoid distracting elements.
- Natural scrolling with lazy‑load where appropriate.
- All components (button, card, input, modal) built from the same design system.
- Mobile‑first, fully responsive across phones, tablets, desktops.

### 4.6 Testing Requirements
- Verify dark & light mode readability (WCAG AA).
- Ensure every interactive element provides instant feedback.
- Run responsive tests on common breakpoints (320 px, 768 px, 1024 px, 1440 px).
- Accessibility audit (axe, Lighthouse) for each page.

## 5. Billing, Subscription & Wallet Model
- **Plans**: Small ($7.99), Medium ($19.99), Large ($49.99) – monthly.
- **Annual discount**: pay 10 × monthly price for 12 months.
- **Automatic top‑up**: each active plan adds the same amount to the user’s wallet every month.
- **Discounts**: plan‑specific percentage applied to every wallet charge.
- **Wallet**: single USD balance; all consumptions (API calls, extra features) debit from wallet after discount.
- **Top‑up**: manual Stripe checkout adds USD to wallet.
- **Invoices**: generated by Stripe, downloadable from `/account/billing`.

## 6. Referral System
- Reward type: **Wallet credit** (USD) only.
- Trigger events: successful signup, first successful charge, subscription activation.
- Admin configurable: fixed amount or percentage of first charge, reward window (e.g., 30 days), per‑user cap.
- Anti‑abuse: IP/device fingerprint, disposable‑email check, rate limits.
- Front‑end: personal referral link (`/r/<code>`), QR code, stats page in account.

## 7. Consent & Legal Management
- **Legal pages**: `/legal/terms`, `/legal/privacy`, `/legal/cookies`.
- **Cookie banner** with accept / reject and link to consent centre.
- **Consent centre** (under `/account/consent`) lets users view and modify:
  - Terms & Privacy acceptance history
  - Cookie categories (necessary, analytics, marketing)
  - Marketing opt‑in/out (newsletter)
- **Database schema** (`consents` table): id, user_id, type, version, accepted_at, ip, user_agent.
- **Versioning**: each update to Terms/Privacy creates a new version; users must re‑accept.
- **Admin UI**: view current versions, export consent logs, force re‑acceptance.

## 8. Notifications
- Email templates for recharge, subscription change, referral reward, invoice.
- Optional push / in‑app notifications (bell icon, unread count).
- Admin can broadcast site‑wide messages.

## 9. Support & Activity Logs
- **Support**: `/support` page with ticket form; admin ticket queue with status, assignment, reply.
- **Activity Log** (user view): wallet transactions, subscription changes, login history, invites, referrals.
- **Audit Log** (admin): full system events with filters, sorting, grouping.

## 10. Admin Dashboard
- Overview charts (active users, MRR, churn, referral conversions).
- Filters / sorting / grouping by date, plan, region, device.
- Quick links to manage plans, invoices, newsletters, invites, referrals, consents.

## 11. Deployment / DevOps
- Docker Compose defines three services: `web` (Next.js), `db` (PostgreSQL), `redis` (Upstash compatible).
- Entry script runs: `pnpm install --frozen-lockfile && pnpm db:migrate && pnpm dev`.
- Environment variables for Stripe keys, JWT secret, DB URL, Redis URL.
- CI/CD runs lint (Biome), tests, builds Docker image, pushes to registry.

## 12. Additional Optional Features (P1 / P2)
- Full‑text site search (Meilisearch / Typesense).
- In‑app notification center (already listed, can be expanded).
- Contact / live‑chat widget.
- API key management (future).
- Multi‑language support (excluded for now).

## 13. Glossary
- **BFF** – Backend‑for‑Frontend.
- **USD** – United States Dollar, the sole currency.
- **ACC** – Account.

*This specification is intended as a high‑level blueprint. Implementation details such as exact component names, routing code or database migrations are intentionally omitted.*