import{createRequire as UV}from"node:module";var YV=Object.create;var{getPrototypeOf:GV,defineProperty:tK,getOwnPropertyNames:XV}=Object;var qV=Object.prototype.hasOwnProperty;var sG=(J,Z,$)=>{$=J!=null?YV(GV(J)):{};let W=Z||!J||!J.__esModule?tK($,"default",{value:J,enumerable:!0}):$;for(let Q of XV(J))if(!qV.call(W,Q))tK(W,Q,{get:()=>J[Q],enumerable:!0});return W};var J6=(J,Z)=>()=>(Z||J((Z={exports:{}}).exports,Z),Z.exports);var HV=(J,Z)=>{for(var $ in Z)tK(J,$,{get:Z[$],enumerable:!0,configurable:!0,set:(W)=>Z[$]=()=>W})};var b6=UV(import.meta.url);var $Y=J6((zX)=>{Object.defineProperty(zX,"__esModule",{value:!0});zX.resolveBackendAndExecutionProviders=zX.registerBackend=void 0;var OZ=new Map,pJ=[],EV=(J,Z,$)=>{if(Z&&typeof Z.init==="function"&&typeof Z.createInferenceSessionHandler==="function"){let W=OZ.get(J);if(W===void 0)OZ.set(J,{backend:Z,priority:$});else if(W.priority>$)return;else if(W.priority===$){if(W.backend!==Z)throw Error(`cannot register backend "${J}" using priority ${$}`)}if($>=0){let Q=pJ.indexOf(J);if(Q!==-1)pJ.splice(Q,1);for(let Y=0;Y<pJ.length;Y++)if(OZ.get(pJ[Y]).priority<=$){pJ.splice(Y,0,J);return}pJ.push(J)}return}throw TypeError("not a valid backend")};zX.registerBackend=EV;var LV=async(J)=>{let Z=OZ.get(J);if(!Z)return"backend not found.";if(Z.initialized)return Z.backend;else if(Z.aborted)return Z.error;else{let $=!!Z.initPromise;try{if(!$)Z.initPromise=Z.backend.init(J);return await Z.initPromise,Z.initialized=!0,Z.backend}catch(W){if(!$)Z.error=`${W}`,Z.aborted=!0;return Z.error}finally{delete Z.initPromise}}},AV=async(J)=>{let Z=J.executionProviders||[],$=Z.map((q)=>typeof q==="string"?q:q.name),W=$.length===0?pJ:$,Q,Y=[],H=new Set;for(let q of W){let E=await LV(q);if(typeof E==="string")Y.push({name:q,err:E});else{if(!Q)Q=E;if(Q===E)H.add(q)}}if(!Q)throw Error(`no available backend found. ERR: ${Y.map((q)=>`[${q.name}] ${q.err}`).join(", ")}`);for(let{name:q,err:E}of Y)if($.includes(q))console.warn(`removing requested execution provider "${q}" from session options because it is not available: ${E}`);let G=Z.filter((q)=>H.has(typeof q==="string"?q:q.name));return[Q,new Proxy(J,{get:(q,E)=>{if(E==="executionProviders")return G;return Reflect.get(q,E)}})]};zX.resolveBackendAndExecutionProviders=AV});var LX=J6((ZY)=>{Object.defineProperty(ZY,"__esModule",{value:!0});ZY.registerBackend=void 0;var FV=$Y();Object.defineProperty(ZY,"registerBackend",{enumerable:!0,get:function(){return FV.registerBackend}})});var FX=J6((AX)=>{Object.defineProperty(AX,"__esModule",{value:!0});AX.version=void 0;AX.version="1.21.0"});var QY=J6((IX)=>{Object.defineProperty(IX,"__esModule",{value:!0});IX.env=void 0;var IV=FX(),RX="warning";IX.env={wasm:{},webgl:{},webgpu:{},versions:{common:IV.version},set logLevel(J){if(J===void 0)return;if(typeof J!=="string"||["verbose","info","warning","error","fatal"].indexOf(J)===-1)throw Error(`Unsupported logging level: ${J}`);RX=J},get logLevel(){return RX}};Object.defineProperty(IX.env,"logLevel",{enumerable:!0})});var jX=J6((DX)=>{Object.defineProperty(DX,"__esModule",{value:!0});DX.env=void 0;var DV=QY();DX.env=DV.env});var SX=J6((PX)=>{Object.defineProperty(PX,"__esModule",{value:!0});PX.tensorToImageData=PX.tensorToDataURL=void 0;var wV=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);$.width=J.dims[3],$.height=J.dims[2];let W=$.getContext("2d");if(W!=null){let Q,Y;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")Q=J.dims[2],Y=J.dims[3];else Q=J.dims[3],Y=J.dims[2];let H=Z?.format!==void 0?Z.format:"RGB",G=Z?.norm,q,E;if(G===void 0||G.mean===void 0)q=[255,255,255,255];else if(typeof G.mean==="number")q=[G.mean,G.mean,G.mean,G.mean];else if(q=[G.mean[0],G.mean[1],G.mean[2],0],G.mean[3]!==void 0)q[3]=G.mean[3];if(G===void 0||G.bias===void 0)E=[0,0,0,0];else if(typeof G.bias==="number")E=[G.bias,G.bias,G.bias,G.bias];else if(E=[G.bias[0],G.bias[1],G.bias[2],0],G.bias[3]!==void 0)E[3]=G.bias[3];let V=Y*Q,N=0,z=V,w=V*2,R=-1;if(H==="RGBA")N=0,z=V,w=V*2,R=V*3;else if(H==="RGB")N=0,z=V,w=V*2;else if(H==="RBG")N=0,w=V,z=V*2;for(let y=0;y<Y;y++)for(let D=0;D<Q;D++){let j=(J.data[N++]-E[0])*q[0],v=(J.data[z++]-E[1])*q[1],g=(J.data[w++]-E[2])*q[2],A=R===-1?255:(J.data[R++]-E[3])*q[3];W.fillStyle="rgba("+j+","+v+","+g+","+A+")",W.fillRect(D,y,1,1)}if("toDataURL"in $)return $.toDataURL();else throw Error("toDataURL is not supported")}else throw Error("Can not access image data")};PX.tensorToDataURL=wV;var jV=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),W;if($!=null){let Q,Y,H;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")Q=J.dims[2],Y=J.dims[1],H=J.dims[3];else Q=J.dims[3],Y=J.dims[2],H=J.dims[1];let G=Z!==void 0?Z.format!==void 0?Z.format:"RGB":"RGB",q=Z?.norm,E,V;if(q===void 0||q.mean===void 0)E=[255,255,255,255];else if(typeof q.mean==="number")E=[q.mean,q.mean,q.mean,q.mean];else if(E=[q.mean[0],q.mean[1],q.mean[2],255],q.mean[3]!==void 0)E[3]=q.mean[3];if(q===void 0||q.bias===void 0)V=[0,0,0,0];else if(typeof q.bias==="number")V=[q.bias,q.bias,q.bias,q.bias];else if(V=[q.bias[0],q.bias[1],q.bias[2],0],q.bias[3]!==void 0)V[3]=q.bias[3];let N=Y*Q;if(Z!==void 0){if(Z.format!==void 0&&H===4&&Z.format!=="RGBA"||H===3&&Z.format!=="RGB"&&Z.format!=="BGR")throw Error("Tensor format doesn't match input tensor dims")}let z=4,w=0,R=1,y=2,D=3,j=0,v=N,g=N*2,A=-1;if(G==="RGBA")j=0,v=N,g=N*2,A=N*3;else if(G==="RGB")j=0,v=N,g=N*2;else if(G==="RBG")j=0,g=N,v=N*2;W=$.createImageData(Q,Y);for(let T=0;T<Y*Q;w+=z,R+=z,y+=z,D+=z,T++)W.data[w]=(J.data[j++]-V[0])*E[0],W.data[R]=(J.data[v++]-V[1])*E[1],W.data[y]=(J.data[g++]-V[2])*E[2],W.data[D]=A===-1?255:(J.data[A++]-V[3])*E[3]}else throw Error("Can not access image data");return W};PX.tensorToImageData=jV});var kX=J6((MX)=>{Object.defineProperty(MX,"__esModule",{value:!0});MX.tensorFromPinnedBuffer=MX.tensorFromMLTensor=MX.tensorFromGpuBuffer=MX.tensorFromTexture=MX.tensorFromImage=MX.bufferToTensor=void 0;var Q5=hZ(),CV=(J,Z)=>{if(J===void 0)throw Error("Image buffer must be defined");if(Z.height===void 0||Z.width===void 0)throw Error("Image height and width must be defined");if(Z.tensorLayout==="NHWC")throw Error("NHWC Tensor layout is not supported yet");let{height:$,width:W}=Z,Q=Z.norm??{mean:255,bias:0},Y,H;if(typeof Q.mean==="number")Y=[Q.mean,Q.mean,Q.mean,Q.mean];else Y=[Q.mean[0],Q.mean[1],Q.mean[2],Q.mean[3]??255];if(typeof Q.bias==="number")H=[Q.bias,Q.bias,Q.bias,Q.bias];else H=[Q.bias[0],Q.bias[1],Q.bias[2],Q.bias[3]??0];let G=Z.format!==void 0?Z.format:"RGBA",q=Z.tensorFormat!==void 0?Z.tensorFormat!==void 0?Z.tensorFormat:"RGB":"RGB",E=$*W,V=q==="RGBA"?new Float32Array(E*4):new Float32Array(E*3),N=4,z=0,w=1,R=2,y=3,D=0,j=E,v=E*2,g=-1;if(G==="RGB")N=3,z=0,w=1,R=2,y=-1;if(q==="RGBA")g=E*3;else if(q==="RBG")D=0,v=E,j=E*2;else if(q==="BGR")v=0,j=E,D=E*2;for(let T=0;T<E;T++,z+=N,R+=N,w+=N,y+=N)if(V[D++]=(J[z]+H[0])/Y[0],V[j++]=(J[w]+H[1])/Y[1],V[v++]=(J[R]+H[2])/Y[2],g!==-1&&y!==-1)V[g++]=(J[y]+H[3])/Y[3];return q==="RGBA"?new Q5.Tensor("float32",V,[1,4,$,W]):new Q5.Tensor("float32",V,[1,3,$,W])};MX.bufferToTensor=CV;var SV=async(J,Z)=>{let $=typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement,W=typeof ImageData<"u"&&J instanceof ImageData,Q=typeof ImageBitmap<"u"&&J instanceof ImageBitmap,Y=typeof J==="string",H,G=Z??{},q=()=>{if(typeof document<"u")return document.createElement("canvas");else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);else throw Error("Canvas is not supported")},E=(V)=>{if(typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement)return V.getContext("2d");else if(V instanceof OffscreenCanvas)return V.getContext("2d");else return null};if($){let V=q();V.width=J.width,V.height=J.height;let N=E(V);if(N!=null){let{height:z,width:w}=J;if(Z!==void 0&&Z.resizedHeight!==void 0&&Z.resizedWidth!==void 0)z=Z.resizedHeight,w=Z.resizedWidth;if(Z!==void 0){if(G=Z,Z.tensorFormat!==void 0)throw Error("Image input config format must be RGBA for HTMLImageElement");else G.tensorFormat="RGBA";G.height=z,G.width=w}else G.tensorFormat="RGBA",G.height=z,G.width=w;N.drawImage(J,0,0),H=N.getImageData(0,0,w,z).data}else throw Error("Can not access image data")}else if(W){let V,N;if(Z!==void 0&&Z.resizedWidth!==void 0&&Z.resizedHeight!==void 0)V=Z.resizedHeight,N=Z.resizedWidth;else V=J.height,N=J.width;if(Z!==void 0)G=Z;if(G.format="RGBA",G.height=V,G.width=N,Z!==void 0){let z=q();z.width=N,z.height=V;let w=E(z);if(w!=null)w.putImageData(J,0,0),H=w.getImageData(0,0,N,V).data;else throw Error("Can not access image data")}else H=J.data}else if(Q){if(Z===void 0)throw Error("Please provide image config with format for Imagebitmap");let V=q();V.width=J.width,V.height=J.height;let N=E(V);if(N!=null){let{height:z,width:w}=J;return N.drawImage(J,0,0,w,z),H=N.getImageData(0,0,w,z).data,G.height=z,G.width=w,MX.bufferToTensor(H,G)}else throw Error("Can not access image data")}else if(Y)return new Promise((V,N)=>{let z=q(),w=E(z);if(!J||!w)return N();let R=new Image;R.crossOrigin="Anonymous",R.src=J,R.onload=()=>{z.width=R.width,z.height=R.height,w.drawImage(R,0,0,z.width,z.height);let y=w.getImageData(0,0,z.width,z.height);G.height=z.height,G.width=z.width,V(MX.bufferToTensor(y.data,G))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(H!==void 0)return MX.bufferToTensor(H,G);else throw Error("Input data provided is not supported - aborted tensor creation")};MX.tensorFromImage=SV;var MV=(J,Z)=>{let{width:$,height:W,download:Q,dispose:Y}=Z,H=[1,W,$,4];return new Q5.Tensor({location:"texture",type:"float32",texture:J,dims:H,download:Q,dispose:Y})};MX.tensorFromTexture=MV;var TV=(J,Z)=>{let{dataType:$,dims:W,download:Q,dispose:Y}=Z;return new Q5.Tensor({location:"gpu-buffer",type:$??"float32",gpuBuffer:J,dims:W,download:Q,dispose:Y})};MX.tensorFromGpuBuffer=TV;var kV=(J,Z)=>{let{dataType:$,dims:W,download:Q,dispose:Y}=Z;return new Q5.Tensor({location:"ml-tensor",type:$??"float32",mlTensor:J,dims:W,download:Q,dispose:Y})};MX.tensorFromMLTensor=kV;var _V=(J,Z,$)=>new Q5.Tensor({location:"cpu-pinned",type:J,data:Z,dims:$??[Z.length]});MX.tensorFromPinnedBuffer=_V});var vX=J6((xX)=>{Object.defineProperty(xX,"__esModule",{value:!0});xX.checkTypedArray=xX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=xX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=void 0;xX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]);xX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);var _X=!1,bV=()=>{if(!_X){_X=!0;let J=typeof BigInt64Array<"u"&&BigInt64Array.from,Z=typeof BigUint64Array<"u"&&BigUint64Array.from,$=globalThis.Float16Array,W=typeof $<"u"&&$.from;if(J)xX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("int64",BigInt64Array),xX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigInt64Array,"int64");if(Z)xX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("uint64",BigUint64Array),xX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigUint64Array,"uint64");if(W)xX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("float16",$),xX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set($,"float16");else xX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("float16",Uint16Array)}};xX.checkTypedArray=bV});var hX=J6((OX)=>{Object.defineProperty(OX,"__esModule",{value:!0});OX.tensorReshape=OX.calculateSize=void 0;var f5=hZ(),hV=(J)=>{let Z=1;for(let $=0;$<J.length;$++){let W=J[$];if(typeof W!=="number"||!Number.isSafeInteger(W))throw TypeError(`dims[${$}] must be an integer, got: ${W}`);if(W<0)throw RangeError(`dims[${$}] must be a non-negative integer, got: ${W}`);Z*=W}return Z};OX.calculateSize=hV;var fV=(J,Z)=>{switch(J.location){case"cpu":return new f5.Tensor(J.type,J.data,Z);case"cpu-pinned":return new f5.Tensor({location:"cpu-pinned",data:J.data,type:J.type,dims:Z});case"texture":return new f5.Tensor({location:"texture",texture:J.texture,type:J.type,dims:Z});case"gpu-buffer":return new f5.Tensor({location:"gpu-buffer",gpuBuffer:J.gpuBuffer,type:J.type,dims:Z});case"ml-tensor":return new f5.Tensor({location:"ml-tensor",mlTensor:J.mlTensor,type:J.type,dims:Z});default:throw Error(`tensorReshape: tensor location ${J.location} is not supported`)}};OX.tensorReshape=fV});var hZ=J6((gX)=>{Object.defineProperty(gX,"__esModule",{value:!0});gX.Tensor=void 0;var fX=SX(),d5=kX(),dZ=vX(),dX=hX();class uX{constructor(J,Z,$){(0,dZ.checkTypedArray)();let W,Q;if(typeof J==="object"&&"location"in J)switch(this.dataLocation=J.location,W=J.type,Q=J.dims,J.location){case"cpu-pinned":{let H=dZ.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(W);if(!H)throw TypeError(`unsupported type "${W}" to create tensor from pinned buffer`);if(!(J.data instanceof H))throw TypeError(`buffer should be of type ${H.name}`);this.cpuData=J.data;break}case"texture":{if(W!=="float32")throw TypeError(`unsupported type "${W}" to create tensor from texture`);this.gpuTextureData=J.texture,this.downloader=J.download,this.disposer=J.dispose;break}case"gpu-buffer":{if(W!=="float32"&&W!=="float16"&&W!=="int32"&&W!=="int64"&&W!=="uint32"&&W!=="uint8"&&W!=="bool"&&W!=="uint4"&&W!=="int4")throw TypeError(`unsupported type "${W}" to create tensor from gpu buffer`);this.gpuBufferData=J.gpuBuffer,this.downloader=J.download,this.disposer=J.dispose;break}case"ml-tensor":{if(W!=="float32"&&W!=="float16"&&W!=="int32"&&W!=="int64"&&W!=="uint32"&&W!=="uint64"&&W!=="int8"&&W!=="uint8"&&W!=="bool"&&W!=="uint4"&&W!=="int4")throw TypeError(`unsupported type "${W}" to create tensor from MLTensor`);this.mlTensorData=J.mlTensor,this.downloader=J.download,this.disposer=J.dispose;break}default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let H,G;if(typeof J==="string")if(W=J,G=$,J==="string"){if(!Array.isArray(Z))throw TypeError("A string tensor's data must be a string array.");H=Z}else{let q=dZ.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(J);if(q===void 0)throw TypeError(`Unsupported tensor type: ${J}.`);if(Array.isArray(Z))if(J==="float16"&&q===Uint16Array||J==="uint4"||J==="int4")throw TypeError(`Creating a ${J} tensor from number array is not supported. Please use ${q.name} as data.`);else if(J==="uint64"||J==="int64")H=q.from(Z,BigInt);else H=q.from(Z);else if(Z instanceof q)H=Z;else if(Z instanceof Uint8ClampedArray)if(J==="uint8")H=Uint8Array.from(Z);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(J==="float16"&&Z instanceof Uint16Array&&q!==Uint16Array)H=new globalThis.Float16Array(Z.buffer,Z.byteOffset,Z.length);else throw TypeError(`A ${W} tensor's data must be type of ${q}`)}else if(G=Z,Array.isArray(J)){if(J.length===0)throw TypeError("Tensor type cannot be inferred from an empty array.");let q=typeof J[0];if(q==="string")W="string",H=J;else if(q==="boolean")W="bool",H=Uint8Array.from(J);else throw TypeError(`Invalid element type of data array: ${q}.`)}else if(J instanceof Uint8ClampedArray)W="uint8",H=Uint8Array.from(J);else{let q=dZ.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.get(J.constructor);if(q===void 0)throw TypeError(`Unsupported type for tensor data: ${J.constructor}.`);W=q,H=J}if(G===void 0)G=[H.length];else if(!Array.isArray(G))throw TypeError("A tensor's dims must be a number array");Q=G,this.cpuData=H,this.dataLocation="cpu"}let Y=(0,dX.calculateSize)(Q);if(this.cpuData&&Y!==this.cpuData.length)if((W==="uint4"||W==="int4")&&Math.ceil(Y/2)===this.cpuData.length);else throw Error(`Tensor's size(${Y}) does not match data length(${this.cpuData.length}).`);this.type=W,this.dims=Q,this.size=Y}static async fromImage(J,Z){return(0,d5.tensorFromImage)(J,Z)}static fromTexture(J,Z){return(0,d5.tensorFromTexture)(J,Z)}static fromGpuBuffer(J,Z){return(0,d5.tensorFromGpuBuffer)(J,Z)}static fromMLTensor(J,Z){return(0,d5.tensorFromMLTensor)(J,Z)}static fromPinnedBuffer(J,Z,$){return(0,d5.tensorFromPinnedBuffer)(J,Z,$)}toDataURL(J){return(0,fX.tensorToDataURL)(this,J)}toImageData(J){return(0,fX.tensorToImageData)(this,J)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(J){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let Z=await this.downloader();if(this.downloader=void 0,this.dataLocation="cpu",this.cpuData=Z,J&&this.disposer)this.disposer(),this.disposer=void 0;return Z}finally{this.isDownloading=!1}}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");if(this.disposer)this.disposer(),this.disposer=void 0;this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw Error("The tensor is disposed.")}reshape(J){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return(0,dX.tensorReshape)(this,J)}}gX.Tensor=uX});var KY=J6((cX)=>{Object.defineProperty(cX,"__esModule",{value:!0});cX.Tensor=void 0;var uV=hZ();cX.Tensor=uV.Tensor});var YY=J6((pX)=>{Object.defineProperty(pX,"__esModule",{value:!0});pX.TRACE_FUNC_END=pX.TRACE_FUNC_BEGIN=pX.TRACE=void 0;var zJ=QY(),gV=(J,Z)=>{if(typeof zJ.env.trace>"u"?!zJ.env.wasm.trace:!zJ.env.trace)return;console.timeStamp(`${J}::ORT::${Z}`)};pX.TRACE=gV;var aX=(J,Z)=>{let $=Error().stack?.split(/\r\n|\r|\n/g)||[],W=!1;for(let Q=0;Q<$.length;Q++){if(W&&!$[Q].includes("TRACE_FUNC")){let Y=`FUNC_${J}::${$[Q].trim().split(" ")[1]}`;if(Z)Y+=`::${Z}`;pX.TRACE("CPU",Y);return}if($[Q].includes("TRACE_FUNC"))W=!0}},lV=(J)=>{if(typeof zJ.env.trace>"u"?!zJ.env.wasm.trace:!zJ.env.trace)return;aX("BEGIN",J)};pX.TRACE_FUNC_BEGIN=lV;var cV=(J)=>{if(typeof zJ.env.trace>"u"?!zJ.env.wasm.trace:!zJ.env.trace)return;aX("END",J)};pX.TRACE_FUNC_END=cV});var iX=J6((nX)=>{Object.defineProperty(nX,"__esModule",{value:!0});nX.InferenceSession=void 0;var aV=$Y(),u5=KY(),uZ=YY();class GY{constructor(J){this.handler=J}async run(J,Z,$){(0,uZ.TRACE_FUNC_BEGIN)();let W={},Q={};if(typeof J!=="object"||J===null||J instanceof u5.Tensor||Array.isArray(J))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let Y=!0;if(typeof Z==="object"){if(Z===null)throw TypeError("Unexpected argument[1]: cannot be null.");if(Z instanceof u5.Tensor)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(Z)){if(Z.length===0)throw TypeError("'fetches' cannot be an empty array.");Y=!1;for(let q of Z){if(typeof q!=="string")throw TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(q)===-1)throw RangeError(`'fetches' contains invalid output name: ${q}.`);W[q]=null}if(typeof $==="object"&&$!==null)Q=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else{let q=!1,E=Object.getOwnPropertyNames(Z);for(let V of this.outputNames)if(E.indexOf(V)!==-1){let N=Z[V];if(N===null||N instanceof u5.Tensor)q=!0,Y=!1,W[V]=N}if(q){if(typeof $==="object"&&$!==null)Q=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else Q=Z}}else if(typeof Z<"u")throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let q of this.inputNames)if(typeof J[q]>"u")throw Error(`input '${q}' is missing in 'feeds'.`);if(Y)for(let q of this.outputNames)W[q]=null;let H=await this.handler.run(J,W,Q),G={};for(let q in H)if(Object.hasOwnProperty.call(H,q)){let E=H[q];if(E instanceof u5.Tensor)G[q]=E;else G[q]=new u5.Tensor(E.type,E.data,E.dims)}return(0,uZ.TRACE_FUNC_END)(),G}async release(){return this.handler.dispose()}static async create(J,Z,$,W){(0,uZ.TRACE_FUNC_BEGIN)();let Q,Y={};if(typeof J==="string"){if(Q=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof Uint8Array){if(Q=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&J instanceof SharedArrayBuffer){let E=J,V=0,N=J.byteLength;if(typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z==="number"){if(V=Z,!Number.isSafeInteger(V))throw RangeError("'byteOffset' must be an integer.");if(V<0||V>=E.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${E.byteLength}).`);if(N=J.byteLength-V,typeof $==="number"){if(N=$,!Number.isSafeInteger(N))throw RangeError("'byteLength' must be an integer.");if(N<=0||V+N>E.byteLength)throw RangeError(`'byteLength' is out of range (0, ${E.byteLength-V}].`);if(typeof W==="object"&&W!==null)Y=W;else if(typeof W<"u")throw TypeError("'options' must be an object.")}else if(typeof $<"u")throw TypeError("'byteLength' must be a number.")}else if(typeof Z<"u")throw TypeError("'options' must be an object.");Q=new Uint8Array(E,V,N)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[H,G]=await(0,aV.resolveBackendAndExecutionProviders)(Y),q=await H.createInferenceSessionHandler(Q,G);return(0,uZ.TRACE_FUNC_END)(),new GY(q)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}nX.InferenceSession=GY});var Jq=J6((tX)=>{Object.defineProperty(tX,"__esModule",{value:!0});tX.InferenceSession=void 0;var pV=iX();tX.InferenceSession=pV.InferenceSession});var Zq=J6(($q)=>{Object.defineProperty($q,"__esModule",{value:!0})});var Qq=J6((Wq)=>{Object.defineProperty(Wq,"__esModule",{value:!0})});var Yq=J6((Kq)=>{Object.defineProperty(Kq,"__esModule",{value:!0})});var Xq=J6((Gq)=>{Object.defineProperty(Gq,"__esModule",{value:!0})});var gZ=J6((L4)=>{var rV=L4&&L4.__createBinding||(Object.create?function(J,Z,$,W){if(W===void 0)W=$;var Q=Object.getOwnPropertyDescriptor(Z,$);if(!Q||("get"in Q?!Z.__esModule:Q.writable||Q.configurable))Q={enumerable:!0,get:function(){return Z[$]}};Object.defineProperty(J,W,Q)}:function(J,Z,$,W){if(W===void 0)W=$;J[W]=Z[$]}),EJ=L4&&L4.__exportStar||function(J,Z){for(var $ in J)if($!=="default"&&!Object.prototype.hasOwnProperty.call(Z,$))rV(Z,J,$)};Object.defineProperty(L4,"__esModule",{value:!0});EJ(LX(),L4);EJ(jX(),L4);EJ(Jq(),L4);EJ(KY(),L4);EJ(Zq(),L4);EJ(Qq(),L4);EJ(YY(),L4);EJ(Yq(),L4);EJ(Xq(),L4)});var Nq=J6((Hq)=>{Object.defineProperty(Hq,"__esModule",{value:!0});Hq.initOrt=Hq.binding=void 0;var lZ=gZ();Hq.binding=b6(`../bin/napi-v3/${process.platform}/${process.arch}/onnxruntime_binding.node`);var qq=!1,eV=()=>{if(!qq){qq=!0;let J=2;if(lZ.env.logLevel)switch(lZ.env.logLevel){case"verbose":J=0;break;case"info":J=1;break;case"warning":J=2;break;case"error":J=3;break;case"fatal":J=4;break;default:throw Error(`Unsupported log level: ${lZ.env.logLevel}`)}Hq.binding.initOrtOnce(J,lZ.Tensor)}};Hq.initOrt=eV});var qY=J6((s4)=>{var nV=s4&&s4.__classPrivateFieldSet||function(J,Z,$,W,Q){if(W==="m")throw TypeError("Private method is not writable");if(W==="a"&&!Q)throw TypeError("Private accessor was defined without a setter");if(typeof Z==="function"?J!==Z||!Q:!Z.has(J))throw TypeError("Cannot write private member to an object whose class did not declare it");return W==="a"?Q.call(J,$):Q?Q.value=$:Z.set(J,$),$},rJ=s4&&s4.__classPrivateFieldGet||function(J,Z,$,W){if($==="a"&&!W)throw TypeError("Private accessor was defined without a getter");if(typeof Z==="function"?J!==Z||!W:!Z.has(J))throw TypeError("Cannot read private member from an object whose class did not declare it");return $==="m"?W:$==="a"?W.call(J):W?W.value:Z.get(J)},n4;Object.defineProperty(s4,"__esModule",{value:!0});s4.listSupportedBackends=s4.onnxruntimeBackend=void 0;var XY=Nq();class zq{constructor(J,Z){if(n4.set(this,void 0),(0,XY.initOrt)(),nV(this,n4,new XY.binding.InferenceSession,"f"),typeof J==="string")rJ(this,n4,"f").loadModel(J,Z);else rJ(this,n4,"f").loadModel(J.buffer,J.byteOffset,J.byteLength,Z);this.inputNames=rJ(this,n4,"f").inputNames,this.outputNames=rJ(this,n4,"f").outputNames}async dispose(){rJ(this,n4,"f").dispose()}startProfiling(){}endProfiling(){rJ(this,n4,"f").endProfiling()}async run(J,Z,$){return new Promise((W,Q)=>{setImmediate(()=>{try{W(rJ(this,n4,"f").run(J,Z,$))}catch(Y){Q(Y)}})})}}n4=new WeakMap;class Eq{async init(){return Promise.resolve()}async createInferenceSessionHandler(J,Z){return new Promise(($,W)=>{setImmediate(()=>{try{$(new zq(J,Z||{}))}catch(Q){W(Q)}})})}}s4.onnxruntimeBackend=new Eq;s4.listSupportedBackends=XY.binding.listSupportedBackends});var Bq=J6((Lq)=>{Object.defineProperty(Lq,"__esModule",{value:!0});Lq.version=void 0;Lq.version="1.21.0"});var Iq=J6((LJ)=>{var sV=LJ&&LJ.__createBinding||(Object.create?function(J,Z,$,W){if(W===void 0)W=$;var Q=Object.getOwnPropertyDescriptor(Z,$);if(!Q||("get"in Q?!Z.__esModule:Q.writable||Q.configurable))Q={enumerable:!0,get:function(){return Z[$]}};Object.defineProperty(J,W,Q)}:function(J,Z,$,W){if(W===void 0)W=$;J[W]=Z[$]}),iV=LJ&&LJ.__exportStar||function(J,Z){for(var $ in J)if($!=="default"&&!Object.prototype.hasOwnProperty.call(Z,$))sV(Z,J,$)};Object.defineProperty(LJ,"__esModule",{value:!0});LJ.listSupportedBackends=void 0;iV(gZ(),LJ);var tV=qY();Object.defineProperty(LJ,"listSupportedBackends",{enumerable:!0,get:function(){return tV.listSupportedBackends}});var Fq=gZ(),oV=Bq(),Rq=qY(),JN=(0,Rq.listSupportedBackends)();for(let J of JN)(0,Fq.registerBackend)(J.name,Rq.onnxruntimeBackend,100);Object.defineProperty(Fq.env.versions,"node",{value:oV.version,enumerable:!0})});var i4=J6((dA,wq)=>{var Dq=function(J){return typeof J<"u"&&J!==null},$N=function(J){return typeof J==="object"},ZN=function(J){return Object.prototype.toString.call(J)==="[object Object]"},WN=function(J){return typeof J==="function"},QN=function(J){return typeof J==="boolean"},KN=function(J){return J instanceof Buffer},YN=function(J){if(Dq(J))switch(J.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},GN=function(J){return J instanceof ArrayBuffer},XN=function(J){return typeof J==="string"&&J.length>0},qN=function(J){return typeof J==="number"&&!Number.isNaN(J)},HN=function(J){return Number.isInteger(J)},UN=function(J,Z,$){return J>=Z&&J<=$},VN=function(J,Z){return Z.includes(J)},NN=function(J,Z,$){return Error(`Expected ${Z} for ${J} but received ${$} of type ${typeof $}`)},zN=function(J,Z){return Z.message=J.message,Z};wq.exports={defined:Dq,object:$N,plainObject:ZN,fn:WN,bool:QN,buffer:KN,typedArray:YN,arrayBuffer:GN,string:XN,number:qN,integer:HN,inRange:UN,inArray:VN,invalidParameterError:NN,nativeError:zN}});var Cq=J6((uA,Pq)=>{var jq=()=>process.platform==="linux",cZ=null,EN=()=>{if(!cZ)if(jq()&&process.report){let J=process.report.excludeNetwork;process.report.excludeNetwork=!0,cZ=process.report.getReport(),process.report.excludeNetwork=J}else cZ={};return cZ};Pq.exports={isLinux:jq,getReport:EN}});var Mq=J6((gA,Sq)=>{var K5=b6("fs"),LN=(J)=>{let Z=K5.openSync(J,"r"),$=Buffer.alloc(2048),W=K5.readSync(Z,$,0,2048,0);return K5.close(Z,()=>{}),$.subarray(0,W)},AN=(J)=>new Promise((Z,$)=>{K5.open(J,"r",(W,Q)=>{if(W)$(W);else{let Y=Buffer.alloc(2048);K5.read(Q,Y,0,2048,0,(H,G)=>{Z(Y.subarray(0,G)),K5.close(Q,()=>{})})}})});Sq.exports={LDD_PATH:"/usr/bin/ldd",SELF_PATH:"/proc/self/exe",readFileSync:LN,readFile:AN}});var kq=J6((lA,Tq)=>{var BN=(J)=>{if(J.length<64)return null;if(J.readUInt32BE(0)!==2135247942)return null;if(J.readUInt8(4)!==2)return null;if(J.readUInt8(5)!==1)return null;let Z=J.readUInt32LE(32),$=J.readUInt16LE(54),W=J.readUInt16LE(56);for(let Q=0;Q<W;Q++){let Y=Z+Q*$;if(J.readUInt32LE(Y)===3){let G=J.readUInt32LE(Y+8),q=J.readUInt32LE(Y+32);return J.subarray(G,G+q).toString().replace(/\0.*$/g,"")}}return null};Tq.exports={interpreterPath:BN}});var aZ=J6((cA,rq)=>{var xq=b6("child_process"),{isLinux:Y5,getReport:yq}=Cq(),{LDD_PATH:mZ,SELF_PATH:vq,readFile:HY,readFileSync:UY}=Mq(),{interpreterPath:Oq}=kq(),t4,o4,JJ,PJ="",bq=()=>{if(!PJ)return new Promise((J)=>{xq.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",(Z,$)=>{PJ=Z?" ":$,J(PJ)})});return PJ},hq=()=>{if(!PJ)try{PJ=xq.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(J){PJ=" "}return PJ},AJ="glibc",fq=/LIBC[a-z0-9 \-).]*?(\d+\.\d+)/i,eJ="musl",FN=(J)=>J.includes("libc.musl-")||J.includes("ld-musl-"),dq=()=>{let J=yq();if(J.header&&J.header.glibcVersionRuntime)return AJ;if(Array.isArray(J.sharedObjects)){if(J.sharedObjects.some(FN))return eJ}return null},uq=(J)=>{let[Z,$]=J.split(/[\r\n]+/);if(Z&&Z.includes(AJ))return AJ;if($&&$.includes(eJ))return eJ;return null},gq=(J)=>{if(J){if(J.includes("/ld-musl-"))return eJ;else if(J.includes("/ld-linux-"))return AJ}return null},lq=(J)=>{if(J=J.toString(),J.includes("musl"))return eJ;if(J.includes("GNU C Library"))return AJ;return null},RN=async()=>{if(o4!==void 0)return o4;o4=null;try{let J=await HY(mZ);o4=lq(J)}catch(J){}return o4},IN=()=>{if(o4!==void 0)return o4;o4=null;try{let J=UY(mZ);o4=lq(J)}catch(J){}return o4},DN=async()=>{if(t4!==void 0)return t4;t4=null;try{let J=await HY(vq),Z=Oq(J);t4=gq(Z)}catch(J){}return t4},wN=()=>{if(t4!==void 0)return t4;t4=null;try{let J=UY(vq),Z=Oq(J);t4=gq(Z)}catch(J){}return t4},cq=async()=>{let J=null;if(Y5()){if(J=await DN(),!J){if(J=await RN(),!J)J=dq();if(!J){let Z=await bq();J=uq(Z)}}}return J},mq=()=>{let J=null;if(Y5()){if(J=wN(),!J){if(J=IN(),!J)J=dq();if(!J){let Z=hq();J=uq(Z)}}}return J},jN=async()=>Y5()&&await cq()!==AJ,PN=()=>Y5()&&mq()!==AJ,CN=async()=>{if(JJ!==void 0)return JJ;JJ=null;try{let Z=(await HY(mZ)).match(fq);if(Z)JJ=Z[1]}catch(J){}return JJ},SN=()=>{if(JJ!==void 0)return JJ;JJ=null;try{let Z=UY(mZ).match(fq);if(Z)JJ=Z[1]}catch(J){}return JJ},aq=()=>{let J=yq();if(J.header&&J.header.glibcVersionRuntime)return J.header.glibcVersionRuntime;return null},_q=(J)=>J.trim().split(/\s+/)[1],pq=(J)=>{let[Z,$,W]=J.split(/[\r\n]+/);if(Z&&Z.includes(AJ))return _q(Z);if($&&W&&$.includes(eJ))return _q(W);return null},MN=async()=>{let J=null;if(Y5()){if(J=await CN(),!J)J=aq();if(!J){let Z=await bq();J=pq(Z)}}return J},TN=()=>{let J=null;if(Y5()){if(J=SN(),!J)J=aq();if(!J){let Z=hq();J=pq(Z)}}return J};rq.exports={GLIBC:AJ,MUSL:eJ,family:cq,familySync:mq,isNonGlibcLinux:jN,isNonGlibcLinuxSync:PN,version:MN,versionSync:TN}});var g5=J6((mA,eq)=>{var kN=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...J)=>console.error("SEMVER",...J):()=>{};eq.exports=kN});var pZ=J6((aA,nq)=>{var _N=Number.MAX_SAFE_INTEGER||9007199254740991,xN=["major","premajor","minor","preminor","patch","prepatch","prerelease"];nq.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:_N,RELEASE_TYPES:xN,SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var l5=J6(($J,sq)=>{var{MAX_SAFE_COMPONENT_LENGTH:VY,MAX_SAFE_BUILD_LENGTH:yN,MAX_LENGTH:vN}=pZ(),ON=g5();$J=sq.exports={};var bN=$J.re=[],hN=$J.safeRe=[],r0=$J.src=[],fN=$J.safeSrc=[],e0=$J.t={},dN=0,NY="[a-zA-Z0-9-]",uN=[["\\s",1],["\\d",vN],[NY,yN]],gN=(J)=>{for(let[Z,$]of uN)J=J.split(`${Z}*`).join(`${Z}{0,${$}}`).split(`${Z}+`).join(`${Z}{1,${$}}`);return J},z6=(J,Z,$)=>{let W=gN(Z),Q=dN++;ON(J,Q,Z),e0[J]=Q,r0[Q]=Z,fN[Q]=W,bN[Q]=new RegExp(Z,$?"g":void 0),hN[Q]=new RegExp(W,$?"g":void 0)};z6("NUMERICIDENTIFIER","0|[1-9]\\d*");z6("NUMERICIDENTIFIERLOOSE","\\d+");z6("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${NY}*`);z6("MAINVERSION",`(${r0[e0.NUMERICIDENTIFIER]})\\.(${r0[e0.NUMERICIDENTIFIER]})\\.(${r0[e0.NUMERICIDENTIFIER]})`);z6("MAINVERSIONLOOSE",`(${r0[e0.NUMERICIDENTIFIERLOOSE]})\\.(${r0[e0.NUMERICIDENTIFIERLOOSE]})\\.(${r0[e0.NUMERICIDENTIFIERLOOSE]})`);z6("PRERELEASEIDENTIFIER",`(?:${r0[e0.NONNUMERICIDENTIFIER]}|${r0[e0.NUMERICIDENTIFIER]})`);z6("PRERELEASEIDENTIFIERLOOSE",`(?:${r0[e0.NONNUMERICIDENTIFIER]}|${r0[e0.NUMERICIDENTIFIERLOOSE]})`);z6("PRERELEASE",`(?:-(${r0[e0.PRERELEASEIDENTIFIER]}(?:\\.${r0[e0.PRERELEASEIDENTIFIER]})*))`);z6("PRERELEASELOOSE",`(?:-?(${r0[e0.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r0[e0.PRERELEASEIDENTIFIERLOOSE]})*))`);z6("BUILDIDENTIFIER",`${NY}+`);z6("BUILD",`(?:\\+(${r0[e0.BUILDIDENTIFIER]}(?:\\.${r0[e0.BUILDIDENTIFIER]})*))`);z6("FULLPLAIN",`v?${r0[e0.MAINVERSION]}${r0[e0.PRERELEASE]}?${r0[e0.BUILD]}?`);z6("FULL",`^${r0[e0.FULLPLAIN]}$`);z6("LOOSEPLAIN",`[v=\\s]*${r0[e0.MAINVERSIONLOOSE]}${r0[e0.PRERELEASELOOSE]}?${r0[e0.BUILD]}?`);z6("LOOSE",`^${r0[e0.LOOSEPLAIN]}$`);z6("GTLT","((?:<|>)?=?)");z6("XRANGEIDENTIFIERLOOSE",`${r0[e0.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);z6("XRANGEIDENTIFIER",`${r0[e0.NUMERICIDENTIFIER]}|x|X|\\*`);z6("XRANGEPLAIN",`[v=\\s]*(${r0[e0.XRANGEIDENTIFIER]})(?:\\.(${r0[e0.XRANGEIDENTIFIER]})(?:\\.(${r0[e0.XRANGEIDENTIFIER]})(?:${r0[e0.PRERELEASE]})?${r0[e0.BUILD]}?)?)?`);z6("XRANGEPLAINLOOSE",`[v=\\s]*(${r0[e0.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r0[e0.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r0[e0.XRANGEIDENTIFIERLOOSE]})(?:${r0[e0.PRERELEASELOOSE]})?${r0[e0.BUILD]}?)?)?`);z6("XRANGE",`^${r0[e0.GTLT]}\\s*${r0[e0.XRANGEPLAIN]}$`);z6("XRANGELOOSE",`^${r0[e0.GTLT]}\\s*${r0[e0.XRANGEPLAINLOOSE]}$`);z6("COERCEPLAIN",`(^|[^\\d])(\\d{1,${VY}})(?:\\.(\\d{1,${VY}}))?(?:\\.(\\d{1,${VY}}))?`);z6("COERCE",`${r0[e0.COERCEPLAIN]}(?:$|[^\\d])`);z6("COERCEFULL",r0[e0.COERCEPLAIN]+`(?:${r0[e0.PRERELEASE]})?(?:${r0[e0.BUILD]})?(?:$|[^\\d])`);z6("COERCERTL",r0[e0.COERCE],!0);z6("COERCERTLFULL",r0[e0.COERCEFULL],!0);z6("LONETILDE","(?:~>?)");z6("TILDETRIM",`(\\s*)${r0[e0.LONETILDE]}\\s+`,!0);$J.tildeTrimReplace="$1~";z6("TILDE",`^${r0[e0.LONETILDE]}${r0[e0.XRANGEPLAIN]}$`);z6("TILDELOOSE",`^${r0[e0.LONETILDE]}${r0[e0.XRANGEPLAINLOOSE]}$`);z6("LONECARET","(?:\\^)");z6("CARETTRIM",`(\\s*)${r0[e0.LONECARET]}\\s+`,!0);$J.caretTrimReplace="$1^";z6("CARET",`^${r0[e0.LONECARET]}${r0[e0.XRANGEPLAIN]}$`);z6("CARETLOOSE",`^${r0[e0.LONECARET]}${r0[e0.XRANGEPLAINLOOSE]}$`);z6("COMPARATORLOOSE",`^${r0[e0.GTLT]}\\s*(${r0[e0.LOOSEPLAIN]})$|^$`);z6("COMPARATOR",`^${r0[e0.GTLT]}\\s*(${r0[e0.FULLPLAIN]})$|^$`);z6("COMPARATORTRIM",`(\\s*)${r0[e0.GTLT]}\\s*(${r0[e0.LOOSEPLAIN]}|${r0[e0.XRANGEPLAIN]})`,!0);$J.comparatorTrimReplace="$1$2$3";z6("HYPHENRANGE",`^\\s*(${r0[e0.XRANGEPLAIN]})\\s+-\\s+(${r0[e0.XRANGEPLAIN]})\\s*$`);z6("HYPHENRANGELOOSE",`^\\s*(${r0[e0.XRANGEPLAINLOOSE]})\\s+-\\s+(${r0[e0.XRANGEPLAINLOOSE]})\\s*$`);z6("STAR","(<|>)?=?\\s*\\*");z6("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");z6("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var rZ=J6((pA,iq)=>{var lN=Object.freeze({loose:!0}),cN=Object.freeze({}),mN=(J)=>{if(!J)return cN;if(typeof J!=="object")return lN;return J};iq.exports=mN});var $H=J6((rA,JH)=>{var tq=/^[0-9]+$/,oq=(J,Z)=>{if(typeof J==="number"&&typeof Z==="number")return J===Z?0:J<Z?-1:1;let $=tq.test(J),W=tq.test(Z);if($&&W)J=+J,Z=+Z;return J===Z?0:$&&!W?-1:W&&!$?1:J<Z?-1:1},aN=(J,Z)=>oq(Z,J);JH.exports={compareIdentifiers:oq,rcompareIdentifiers:aN}});var G5=J6((eA,WH)=>{var eZ=g5(),{MAX_LENGTH:ZH,MAX_SAFE_INTEGER:nZ}=pZ(),{safeRe:sZ,t:iZ}=l5(),pN=rZ(),{compareIdentifiers:zY}=$H();class u4{constructor(J,Z){if(Z=pN(Z),J instanceof u4)if(J.loose===!!Z.loose&&J.includePrerelease===!!Z.includePrerelease)return J;else J=J.version;else if(typeof J!=="string")throw TypeError(`Invalid version. Must be a string. Got type "${typeof J}".`);if(J.length>ZH)throw TypeError(`version is longer than ${ZH} characters`);eZ("SemVer",J,Z),this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease;let $=J.trim().match(Z.loose?sZ[iZ.LOOSE]:sZ[iZ.FULL]);if(!$)throw TypeError(`Invalid Version: ${J}`);if(this.raw=J,this.major=+$[1],this.minor=+$[2],this.patch=+$[3],this.major>nZ||this.major<0)throw TypeError("Invalid major version");if(this.minor>nZ||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>nZ||this.patch<0)throw TypeError("Invalid patch version");if(!$[4])this.prerelease=[];else this.prerelease=$[4].split(".").map((W)=>{if(/^[0-9]+$/.test(W)){let Q=+W;if(Q>=0&&Q<nZ)return Q}return W});this.build=$[5]?$[5].split("."):[],this.format()}format(){if(this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length)this.version+=`-${this.prerelease.join(".")}`;return this.version}toString(){return this.version}compare(J){if(eZ("SemVer.compare",this.version,this.options,J),!(J instanceof u4)){if(typeof J==="string"&&J===this.version)return 0;J=new u4(J,this.options)}if(J.version===this.version)return 0;return this.compareMain(J)||this.comparePre(J)}compareMain(J){if(!(J instanceof u4))J=new u4(J,this.options);if(this.major<J.major)return-1;if(this.major>J.major)return 1;if(this.minor<J.minor)return-1;if(this.minor>J.minor)return 1;if(this.patch<J.patch)return-1;if(this.patch>J.patch)return 1;return 0}comparePre(J){if(!(J instanceof u4))J=new u4(J,this.options);if(this.prerelease.length&&!J.prerelease.length)return-1;else if(!this.prerelease.length&&J.prerelease.length)return 1;else if(!this.prerelease.length&&!J.prerelease.length)return 0;let Z=0;do{let $=this.prerelease[Z],W=J.prerelease[Z];if(eZ("prerelease compare",Z,$,W),$===void 0&&W===void 0)return 0;else if(W===void 0)return 1;else if($===void 0)return-1;else if($===W)continue;else return zY($,W)}while(++Z)}compareBuild(J){if(!(J instanceof u4))J=new u4(J,this.options);let Z=0;do{let $=this.build[Z],W=J.build[Z];if(eZ("build compare",Z,$,W),$===void 0&&W===void 0)return 0;else if(W===void 0)return 1;else if($===void 0)return-1;else if($===W)continue;else return zY($,W)}while(++Z)}inc(J,Z,$){if(J.startsWith("pre")){if(!Z&&$===!1)throw Error("invalid increment argument: identifier is empty");if(Z){let W=`-${Z}`.match(this.options.loose?sZ[iZ.PRERELEASELOOSE]:sZ[iZ.PRERELEASE]);if(!W||W[1]!==Z)throw Error(`invalid identifier: ${Z}`)}}switch(J){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",Z,$);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",Z,$);break;case"prepatch":this.prerelease.length=0,this.inc("patch",Z,$),this.inc("pre",Z,$);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",Z,$);this.inc("pre",Z,$);break;case"release":if(this.prerelease.length===0)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0,this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":{let W=Number($)?1:0;if(this.prerelease.length===0)this.prerelease=[W];else{let Q=this.prerelease.length;while(--Q>=0)if(typeof this.prerelease[Q]==="number")this.prerelease[Q]++,Q=-2;if(Q===-1){if(Z===this.prerelease.join(".")&&$===!1)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(W)}}if(Z){let Q=[Z,W];if($===!1)Q=[Z];if(zY(this.prerelease[0],Z)===0){if(isNaN(this.prerelease[1]))this.prerelease=Q}else this.prerelease=Q}break}default:throw Error(`invalid increment argument: ${J}`)}if(this.raw=this.format(),this.build.length)this.raw+=`+${this.build.join(".")}`;return this}}WH.exports=u4});var YH=J6((nA,KH)=>{var QH=G5(),rN=(J,Z,$=!1)=>{if(J instanceof QH)return J;try{return new QH(J,Z)}catch(W){if(!$)return null;throw W}};KH.exports=rN});var XH=J6((sA,GH)=>{var eN=G5(),nN=YH(),{safeRe:tZ,t:oZ}=l5(),sN=(J,Z)=>{if(J instanceof eN)return J;if(typeof J==="number")J=String(J);if(typeof J!=="string")return null;Z=Z||{};let $=null;if(!Z.rtl)$=J.match(Z.includePrerelease?tZ[oZ.COERCEFULL]:tZ[oZ.COERCE]);else{let q=Z.includePrerelease?tZ[oZ.COERCERTLFULL]:tZ[oZ.COERCERTL],E;while((E=q.exec(J))&&(!$||$.index+$[0].length!==J.length)){if(!$||E.index+E[0].length!==$.index+$[0].length)$=E;q.lastIndex=E.index+E[1].length+E[2].length}q.lastIndex=-1}if($===null)return null;let W=$[2],Q=$[3]||"0",Y=$[4]||"0",H=Z.includePrerelease&&$[5]?`-${$[5]}`:"",G=Z.includePrerelease&&$[6]?`+${$[6]}`:"";return nN(`${W}.${Q}.${Y}${H}${G}`,Z)};GH.exports=sN});var nJ=J6((iA,HH)=>{var qH=G5(),iN=(J,Z,$)=>new qH(J,$).compare(new qH(Z,$));HH.exports=iN});var EY=J6((tA,UH)=>{var tN=nJ(),oN=(J,Z,$)=>tN(J,Z,$)>=0;UH.exports=oN});var zH=J6((oA,NH)=>{class VH{constructor(){this.max=1000,this.map=new Map}get(J){let Z=this.map.get(J);if(Z===void 0)return;else return this.map.delete(J),this.map.set(J,Z),Z}delete(J){return this.map.delete(J)}set(J,Z){if(!this.delete(J)&&Z!==void 0){if(this.map.size>=this.max){let W=this.map.keys().next().value;this.delete(W)}this.map.set(J,Z)}return this}}NH.exports=VH});var LH=J6((JB,EH)=>{var Jz=nJ(),$z=(J,Z,$)=>Jz(J,Z,$)===0;EH.exports=$z});var BH=J6(($B,AH)=>{var Zz=nJ(),Wz=(J,Z,$)=>Zz(J,Z,$)!==0;AH.exports=Wz});var RH=J6((ZB,FH)=>{var Qz=nJ(),Kz=(J,Z,$)=>Qz(J,Z,$)>0;FH.exports=Kz});var DH=J6((WB,IH)=>{var Yz=nJ(),Gz=(J,Z,$)=>Yz(J,Z,$)<0;IH.exports=Gz});var jH=J6((QB,wH)=>{var Xz=nJ(),qz=(J,Z,$)=>Xz(J,Z,$)<=0;wH.exports=qz});var CH=J6((KB,PH)=>{var Hz=LH(),Uz=BH(),Vz=RH(),Nz=EY(),zz=DH(),Ez=jH(),Lz=(J,Z,$,W)=>{switch(Z){case"===":if(typeof J==="object")J=J.version;if(typeof $==="object")$=$.version;return J===$;case"!==":if(typeof J==="object")J=J.version;if(typeof $==="object")$=$.version;return J!==$;case"":case"=":case"==":return Hz(J,$,W);case"!=":return Uz(J,$,W);case">":return Vz(J,$,W);case">=":return Nz(J,$,W);case"<":return zz(J,$,W);case"<=":return Ez(J,$,W);default:throw TypeError(`Invalid operator: ${Z}`)}};PH.exports=Lz});var yH=J6((YB,xH)=>{var c5=Symbol("SemVer ANY");class J8{static get ANY(){return c5}constructor(J,Z){if(Z=SH(Z),J instanceof J8)if(J.loose===!!Z.loose)return J;else J=J.value;if(J=J.trim().split(/\s+/).join(" "),AY("comparator",J,Z),this.options=Z,this.loose=!!Z.loose,this.parse(J),this.semver===c5)this.value="";else this.value=this.operator+this.semver.version;AY("comp",this)}parse(J){let Z=this.options.loose?MH[TH.COMPARATORLOOSE]:MH[TH.COMPARATOR],$=J.match(Z);if(!$)throw TypeError(`Invalid comparator: ${J}`);if(this.operator=$[1]!==void 0?$[1]:"",this.operator==="=")this.operator="";if(!$[2])this.semver=c5;else this.semver=new kH($[2],this.options.loose)}toString(){return this.value}test(J){if(AY("Comparator.test",J,this.options.loose),this.semver===c5||J===c5)return!0;if(typeof J==="string")try{J=new kH(J,this.options)}catch(Z){return!1}return LY(J,this.operator,this.semver,this.options)}intersects(J,Z){if(!(J instanceof J8))throw TypeError("a Comparator is required");if(this.operator===""){if(this.value==="")return!0;return new _H(J.value,Z).test(this.value)}else if(J.operator===""){if(J.value==="")return!0;return new _H(this.value,Z).test(J.semver)}if(Z=SH(Z),Z.includePrerelease&&(this.value==="<0.0.0-0"||J.value==="<0.0.0-0"))return!1;if(!Z.includePrerelease&&(this.value.startsWith("<0.0.0")||J.value.startsWith("<0.0.0")))return!1;if(this.operator.startsWith(">")&&J.operator.startsWith(">"))return!0;if(this.operator.startsWith("<")&&J.operator.startsWith("<"))return!0;if(this.semver.version===J.semver.version&&this.operator.includes("=")&&J.operator.includes("="))return!0;if(LY(this.semver,"<",J.semver,Z)&&this.operator.startsWith(">")&&J.operator.startsWith("<"))return!0;if(LY(this.semver,">",J.semver,Z)&&this.operator.startsWith("<")&&J.operator.startsWith(">"))return!0;return!1}}xH.exports=J8;var SH=rZ(),{safeRe:MH,t:TH}=l5(),LY=CH(),AY=g5(),kH=G5(),_H=BY()});var BY=J6((GB,hH)=>{var Az=/\s+/g;class m5{constructor(J,Z){if(Z=Fz(Z),J instanceof m5)if(J.loose===!!Z.loose&&J.includePrerelease===!!Z.includePrerelease)return J;else return new m5(J.raw,Z);if(J instanceof FY)return this.raw=J.value,this.set=[[J]],this.formatted=void 0,this;if(this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease,this.raw=J.trim().replace(Az," "),this.set=this.raw.split("||").map(($)=>this.parseRange($.trim())).filter(($)=>$.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let $=this.set[0];if(this.set=this.set.filter((W)=>!OH(W[0])),this.set.length===0)this.set=[$];else if(this.set.length>1){for(let W of this.set)if(W.length===1&&Cz(W[0])){this.set=[W];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let J=0;J<this.set.length;J++){if(J>0)this.formatted+="||";let Z=this.set[J];for(let $=0;$<Z.length;$++){if($>0)this.formatted+=" ";this.formatted+=Z[$].toString().trim()}}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(J){let $=((this.options.includePrerelease&&jz)|(this.options.loose&&Pz))+":"+J,W=vH.get($);if(W)return W;let Q=this.options.loose,Y=Q?A4[q4.HYPHENRANGELOOSE]:A4[q4.HYPHENRANGE];J=J.replace(Y,bz(this.options.includePrerelease)),k6("hyphen replace",J),J=J.replace(A4[q4.COMPARATORTRIM],Iz),k6("comparator trim",J),J=J.replace(A4[q4.TILDETRIM],Dz),k6("tilde trim",J),J=J.replace(A4[q4.CARETTRIM],wz),k6("caret trim",J);let H=J.split(" ").map((V)=>Sz(V,this.options)).join(" ").split(/\s+/).map((V)=>Oz(V,this.options));if(Q)H=H.filter((V)=>{return k6("loose invalid filter",V,this.options),!!V.match(A4[q4.COMPARATORLOOSE])});k6("range list",H);let G=new Map,q=H.map((V)=>new FY(V,this.options));for(let V of q){if(OH(V))return[V];G.set(V.value,V)}if(G.size>1&&G.has(""))G.delete("");let E=[...G.values()];return vH.set($,E),E}intersects(J,Z){if(!(J instanceof m5))throw TypeError("a Range is required");return this.set.some(($)=>{return bH($,Z)&&J.set.some((W)=>{return bH(W,Z)&&$.every((Q)=>{return W.every((Y)=>{return Q.intersects(Y,Z)})})})})}test(J){if(!J)return!1;if(typeof J==="string")try{J=new Rz(J,this.options)}catch(Z){return!1}for(let Z=0;Z<this.set.length;Z++)if(hz(this.set[Z],J,this.options))return!0;return!1}}hH.exports=m5;var Bz=zH(),vH=new Bz,Fz=rZ(),FY=yH(),k6=g5(),Rz=G5(),{safeRe:A4,t:q4,comparatorTrimReplace:Iz,tildeTrimReplace:Dz,caretTrimReplace:wz}=l5(),{FLAG_INCLUDE_PRERELEASE:jz,FLAG_LOOSE:Pz}=pZ(),OH=(J)=>J.value==="<0.0.0-0",Cz=(J)=>J.value==="",bH=(J,Z)=>{let $=!0,W=J.slice(),Q=W.pop();while($&&W.length)$=W.every((Y)=>{return Q.intersects(Y,Z)}),Q=W.pop();return $},Sz=(J,Z)=>{return J=J.replace(A4[q4.BUILD],""),k6("comp",J,Z),J=kz(J,Z),k6("caret",J),J=Mz(J,Z),k6("tildes",J),J=xz(J,Z),k6("xrange",J),J=vz(J,Z),k6("stars",J),J},B4=(J)=>!J||J.toLowerCase()==="x"||J==="*",Mz=(J,Z)=>{return J.trim().split(/\s+/).map(($)=>Tz($,Z)).join(" ")},Tz=(J,Z)=>{let $=Z.loose?A4[q4.TILDELOOSE]:A4[q4.TILDE];return J.replace($,(W,Q,Y,H,G)=>{k6("tilde",J,W,Q,Y,H,G);let q;if(B4(Q))q="";else if(B4(Y))q=`>=${Q}.0.0 <${+Q+1}.0.0-0`;else if(B4(H))q=`>=${Q}.${Y}.0 <${Q}.${+Y+1}.0-0`;else if(G)k6("replaceTilde pr",G),q=`>=${Q}.${Y}.${H}-${G} <${Q}.${+Y+1}.0-0`;else q=`>=${Q}.${Y}.${H} <${Q}.${+Y+1}.0-0`;return k6("tilde return",q),q})},kz=(J,Z)=>{return J.trim().split(/\s+/).map(($)=>_z($,Z)).join(" ")},_z=(J,Z)=>{k6("caret",J,Z);let $=Z.loose?A4[q4.CARETLOOSE]:A4[q4.CARET],W=Z.includePrerelease?"-0":"";return J.replace($,(Q,Y,H,G,q)=>{k6("caret",J,Q,Y,H,G,q);let E;if(B4(Y))E="";else if(B4(H))E=`>=${Y}.0.0${W} <${+Y+1}.0.0-0`;else if(B4(G))if(Y==="0")E=`>=${Y}.${H}.0${W} <${Y}.${+H+1}.0-0`;else E=`>=${Y}.${H}.0${W} <${+Y+1}.0.0-0`;else if(q)if(k6("replaceCaret pr",q),Y==="0")if(H==="0")E=`>=${Y}.${H}.${G}-${q} <${Y}.${H}.${+G+1}-0`;else E=`>=${Y}.${H}.${G}-${q} <${Y}.${+H+1}.0-0`;else E=`>=${Y}.${H}.${G}-${q} <${+Y+1}.0.0-0`;else if(k6("no pr"),Y==="0")if(H==="0")E=`>=${Y}.${H}.${G}${W} <${Y}.${H}.${+G+1}-0`;else E=`>=${Y}.${H}.${G}${W} <${Y}.${+H+1}.0-0`;else E=`>=${Y}.${H}.${G} <${+Y+1}.0.0-0`;return k6("caret return",E),E})},xz=(J,Z)=>{return k6("replaceXRanges",J,Z),J.split(/\s+/).map(($)=>yz($,Z)).join(" ")},yz=(J,Z)=>{J=J.trim();let $=Z.loose?A4[q4.XRANGELOOSE]:A4[q4.XRANGE];return J.replace($,(W,Q,Y,H,G,q)=>{k6("xRange",J,W,Q,Y,H,G,q);let E=B4(Y),V=E||B4(H),N=V||B4(G),z=N;if(Q==="="&&z)Q="";if(q=Z.includePrerelease?"-0":"",E)if(Q===">"||Q==="<")W="<0.0.0-0";else W="*";else if(Q&&z){if(V)H=0;if(G=0,Q===">")if(Q=">=",V)Y=+Y+1,H=0,G=0;else H=+H+1,G=0;else if(Q==="<=")if(Q="<",V)Y=+Y+1;else H=+H+1;if(Q==="<")q="-0";W=`${Q+Y}.${H}.${G}${q}`}else if(V)W=`>=${Y}.0.0${q} <${+Y+1}.0.0-0`;else if(N)W=`>=${Y}.${H}.0${q} <${Y}.${+H+1}.0-0`;return k6("xRange return",W),W})},vz=(J,Z)=>{return k6("replaceStars",J,Z),J.trim().replace(A4[q4.STAR],"")},Oz=(J,Z)=>{return k6("replaceGTE0",J,Z),J.trim().replace(A4[Z.includePrerelease?q4.GTE0PRE:q4.GTE0],"")},bz=(J)=>(Z,$,W,Q,Y,H,G,q,E,V,N,z)=>{if(B4(W))$="";else if(B4(Q))$=`>=${W}.0.0${J?"-0":""}`;else if(B4(Y))$=`>=${W}.${Q}.0${J?"-0":""}`;else if(H)$=`>=${$}`;else $=`>=${$}${J?"-0":""}`;if(B4(E))q="";else if(B4(V))q=`<${+E+1}.0.0-0`;else if(B4(N))q=`<${E}.${+V+1}.0-0`;else if(z)q=`<=${E}.${V}.${N}-${z}`;else if(J)q=`<${E}.${V}.${+N+1}-0`;else q=`<=${q}`;return`${$} ${q}`.trim()},hz=(J,Z,$)=>{for(let W=0;W<J.length;W++)if(!J[W].test(Z))return!1;if(Z.prerelease.length&&!$.includePrerelease){for(let W=0;W<J.length;W++){if(k6(J[W].semver),J[W].semver===FY.ANY)continue;if(J[W].semver.prerelease.length>0){let Q=J[W].semver;if(Q.major===Z.major&&Q.minor===Z.minor&&Q.patch===Z.patch)return!0}}return!1}return!0}});var dH=J6((XB,fH)=>{var fz=BY(),dz=(J,Z,$)=>{try{Z=new fz(Z,$)}catch(W){return!1}return Z.test(J)};fH.exports=dz});var RY=J6((qB,uz)=>{uz.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.34.4",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://sharp.pixelplumbing.com",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unnebäck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix Bünemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","Jérémy Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kotěšovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Chouciño <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugué <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com>","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>","Dennis Beatty <dennis@dcbeatty.com>","Ingvar Stepanyan <me@rreverser.com>","Don Denton <don@happycollision.com>"],scripts:{install:"node install/check.js",clean:"rm -rf src/build/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run test-lint && npm run test-unit && npm run test-licensing && npm run test-types","test-lint":"semistandard && cpplint","test-unit":"nyc --reporter=lcov --reporter=text --check-coverage --branches=100 mocha","test-licensing":'license-checker --production --summary --onlyAllow="Apache-2.0;BSD;ISC;LGPL-3.0-or-later;MIT"',"test-leak":"./test/leak/leak.sh","test-types":"tsd","package-from-local-build":"node npm/from-local-build.js","package-release-notes":"node npm/release-notes.js","docs-build":"node docs/build.mjs","docs-serve":"cd docs && npm start","docs-publish":"cd docs && npm run build && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},type:"commonjs",main:"lib/index.js",types:"lib/index.d.ts",files:["install","lib","src/*.{cc,h,gyp}"],repository:{type:"git",url:"git://github.com/lovell/sharp.git"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{"@img/colour":"^1.0.0","detect-libc":"^2.1.0",semver:"^7.7.2"},optionalDependencies:{"@img/sharp-darwin-arm64":"0.34.4","@img/sharp-darwin-x64":"0.34.4","@img/sharp-libvips-darwin-arm64":"1.2.3","@img/sharp-libvips-darwin-x64":"1.2.3","@img/sharp-libvips-linux-arm":"1.2.3","@img/sharp-libvips-linux-arm64":"1.2.3","@img/sharp-libvips-linux-ppc64":"1.2.3","@img/sharp-libvips-linux-s390x":"1.2.3","@img/sharp-libvips-linux-x64":"1.2.3","@img/sharp-libvips-linuxmusl-arm64":"1.2.3","@img/sharp-libvips-linuxmusl-x64":"1.2.3","@img/sharp-linux-arm":"0.34.4","@img/sharp-linux-arm64":"0.34.4","@img/sharp-linux-ppc64":"0.34.4","@img/sharp-linux-s390x":"0.34.4","@img/sharp-linux-x64":"0.34.4","@img/sharp-linuxmusl-arm64":"0.34.4","@img/sharp-linuxmusl-x64":"0.34.4","@img/sharp-wasm32":"0.34.4","@img/sharp-win32-arm64":"0.34.4","@img/sharp-win32-ia32":"0.34.4","@img/sharp-win32-x64":"0.34.4"},devDependencies:{"@emnapi/runtime":"^1.5.0","@img/sharp-libvips-dev":"1.2.3","@img/sharp-libvips-dev-wasm32":"1.2.3","@img/sharp-libvips-win32-arm64":"1.2.3","@img/sharp-libvips-win32-ia32":"1.2.3","@img/sharp-libvips-win32-x64":"1.2.3","@types/node":"*",cc:"^3.0.1",emnapi:"^1.5.0","exif-reader":"^2.0.2","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^9.1.2","license-checker":"^25.0.1",mocha:"^11.7.2","node-addon-api":"^8.5.0","node-gyp":"^11.4.2",nyc:"^17.1.0",semistandard:"^17.0.0","tar-fs":"^3.1.1",tsd:"^0.33.0"},license:"Apache-2.0",engines:{node:"^18.17.0 || ^20.3.0 || >=21.0.0"},config:{libvips:">=8.17.2"},funding:{url:"https://opencollective.com/libvips"},semistandard:{env:["mocha"]},cc:{linelength:"120",filter:["build/include"]},nyc:{include:["lib"]},tsd:{directory:"test/types/"}}});var DY=J6((HB,nH)=>{var{spawnSync:$8}=b6("node:child_process"),{createHash:gz}=b6("node:crypto"),cH=XH(),lz=EY(),cz=dH(),uH=aZ(),{config:mz,engines:gH,optionalDependencies:az}=RY(),pz=process.env.npm_package_config_libvips||mz.libvips,mH=cH(pz).version,rz=["darwin-arm64","darwin-x64","linux-arm","linux-arm64","linux-ppc64","linux-s390x","linux-x64","linuxmusl-arm64","linuxmusl-x64","win32-arm64","win32-ia32","win32-x64"],Z8={encoding:"utf8",shell:!0},ez=(J)=>{if(J instanceof Error)console.error(`sharp: Installation error: ${J.message}`);else console.log(`sharp: ${J}`)},aH=()=>uH.isNonGlibcLinuxSync()?uH.familySync():"",nz=()=>`${process.platform}${aH()}-${process.arch}`,X5=()=>{if(pH())return"wasm32";let{npm_config_arch:J,npm_config_platform:Z,npm_config_libc:$}=process.env,W=typeof $==="string"?$:aH();return`${Z||process.platform}${W}-${J||process.arch}`},sz=()=>{try{return b6(`@img/sharp-libvips-dev-${X5()}/include`)}catch{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/include");})()}catch{}}return""},iz=()=>{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/cplusplus");})()}catch{}return""},tz=()=>{try{return b6(`@img/sharp-libvips-dev-${X5()}/lib`)}catch{try{return b6(`@img/sharp-libvips-${X5()}/lib`)}catch{}}return""},oz=()=>{if(process.release?.name==="node"&&process.versions){if(!cz(process.versions.node,gH.node))return{found:process.versions.node,expected:gH.node}}},pH=()=>{let{CC:J}=process.env;return Boolean(J&&J.endsWith("/emcc"))},J3=()=>{if(process.platform==="darwin"&&process.arch==="x64")return($8("sysctl sysctl.proc_translated",Z8).stdout||"").trim()==="sysctl.proc_translated: 1";return!1},lH=(J)=>gz("sha512").update(J).digest("hex"),$3=()=>{try{let J=lH(`imgsharp-libvips-${X5()}`),Z=cH(az[`@img/sharp-libvips-${X5()}`],{includePrerelease:!0}).version;return lH(`${J}npm:${Z}`).slice(0,10)}catch{}return""},Z3=()=>$8(`node-gyp rebuild --directory=src ${pH()?"--nodedir=emscripten":""}`,{...Z8,stdio:"inherit"}).status,rH=()=>{if(process.platform!=="win32")return($8("pkg-config --modversion vips-cpp",{...Z8,env:{...process.env,PKG_CONFIG_PATH:eH()}}).stdout||"").trim();else return""},eH=()=>{if(process.platform!=="win32")return[($8('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',Z8).stdout||"").trim(),process.env.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":");else return""},IY=(J,Z,$)=>{if($)$(`Detected ${Z}, skipping search for globally-installed libvips`);return J},W3=(J)=>{if(Boolean(process.env.SHARP_IGNORE_GLOBAL_LIBVIPS)===!0)return IY(!1,"SHARP_IGNORE_GLOBAL_LIBVIPS",J);if(Boolean(process.env.SHARP_FORCE_GLOBAL_LIBVIPS)===!0)return IY(!0,"SHARP_FORCE_GLOBAL_LIBVIPS",J);if(J3())return IY(!1,"Rosetta",J);let Z=rH();return!!Z&&lz(Z,mH)};nH.exports={minimumLibvipsVersion:mH,prebuiltPlatforms:rz,buildPlatformArch:X5,buildSharpLibvipsIncludeDir:sz,buildSharpLibvipsCPlusPlusDir:iz,buildSharpLibvipsLibDir:tz,isUnsupportedNodeRuntime:oz,runtimePlatformArch:nz,log:ez,yarnLocator:$3,spawnRebuild:Z3,globalLibvipsVersion:rH,pkgConfigPath:eH,useGlobalLibvips:W3}});var p5=J6((VB,iH)=>{var{familySync:Q3,versionSync:K3}=aZ(),{runtimePlatformArch:Y3,isUnsupportedNodeRuntime:sH,prebuiltPlatforms:G3,minimumLibvipsVersion:X3}=DY(),sJ=Y3(),q3=[`../src/build/Release/sharp-${sJ}.node`,"../src/build/Release/sharp-wasm32.node",`@img/sharp-${sJ}/sharp.node`,"@img/sharp-wasm32/sharp.node"],wY,q5,a5=[];for(wY of q3)try{q5=b6(wY);break}catch(J){a5.push(J)}if(q5&&wY.startsWith("@img/sharp-linux-x64")&&!q5._isUsingX64V2()){let J=Error("Prebuilt binaries for linux-x64 require v2 microarchitecture");J.code="Unsupported CPU",a5.push(J),q5=null}if(q5)iH.exports=q5;else{let[J,Z,$]=["linux","darwin","win32"].map((Y)=>sJ.startsWith(Y)),W=[`Could not load the "sharp" module using the ${sJ} runtime`];a5.forEach((Y)=>{if(Y.code!=="MODULE_NOT_FOUND")W.push(`${Y.code}: ${Y.message}`)});let Q=a5.map((Y)=>Y.message).join(" ");if(W.push("Possible solutions:"),sH()){let{found:Y,expected:H}=sH();W.push("- Please upgrade Node.js:",`    Found ${Y}`,`    Requires ${H}`)}else if(G3.includes(sJ)){let[Y,H]=sJ.split("-"),G=Y.endsWith("musl")?" --libc=musl":"";W.push("- Ensure optional dependencies can be installed:","    npm install --include=optional sharp","- Ensure your package manager supports multi-platform installation:","    See https://sharp.pixelplumbing.com/install#cross-platform","- Add platform-specific dependencies:",`    npm install --os=${Y.replace("musl","")}${G} --cpu=${H} sharp`)}else W.push(`- Manually install libvips >= ${X3}`,"- Add experimental WebAssembly-based dependencies:","    npm install --cpu=wasm32 sharp","    npm install @img/sharp-wasm32");if(J&&/(symbol not found|CXXABI_)/i.test(Q))try{let{config:Y}=b6(`@img/sharp-libvips-${sJ}/package`),H=`${Q3()} ${K3()}`,G=`${Y.musl?"musl":"glibc"} ${Y.musl||Y.glibc}`;W.push("- Update your OS:",`    Found ${H}`,`    Requires ${G}`)}catch(Y){}if(J&&/\/snap\/core[0-9]{2}/.test(Q))W.push("- Remove the Node.js Snap, which does not support native modules","    snap remove node");if(Z&&/Incompatible library version/.test(Q))W.push("- Update Homebrew:","    brew update && brew upgrade vips");if(a5.some((Y)=>Y.code==="ERR_DLOPEN_DISABLED"))W.push("- Run Node.js without using the --no-addons flag");if($&&/The specified procedure could not be found/.test(Q))W.push("- Using the canvas package on Windows?","    See https://sharp.pixelplumbing.com/install#canvas-and-windows","- Check for outdated versions of sharp in the dependency tree:","    npm ls sharp");throw W.push("- Consult the installation documentation:","    See https://sharp.pixelplumbing.com/install"),Error(W.join(`
`))}});var oH=J6((zB,tH)=>{var H3=b6("node:util"),jY=b6("node:stream"),U3=i4();p5();var V3=H3.debuglog("sharp"),iJ=function(J,Z){if(arguments.length===1&&!U3.defined(J))throw Error("Invalid input");if(!(this instanceof iJ))return new iJ(J,Z);return jY.Duplex.call(this),this.options={topOffsetPre:-1,leftOffsetPre:-1,widthPre:-1,heightPre:-1,topOffsetPost:-1,leftOffsetPost:-1,widthPost:-1,heightPost:-1,width:-1,height:-1,canvas:"crop",position:0,resizeBackground:[0,0,0,255],angle:0,rotationAngle:0,rotationBackground:[0,0,0,255],rotateBefore:!1,orientBefore:!1,flip:!1,flop:!1,extendTop:0,extendBottom:0,extendLeft:0,extendRight:0,extendBackground:[0,0,0,255],extendWith:"background",withoutEnlargement:!1,withoutReduction:!1,affineMatrix:[],affineBackground:[0,0,0,255],affineIdx:0,affineIdy:0,affineOdx:0,affineOdy:0,affineInterpolator:this.constructor.interpolators.bilinear,kernel:"lanczos3",fastShrinkOnLoad:!0,tint:[-1,0,0,0],flatten:!1,flattenBackground:[0,0,0],unflatten:!1,negate:!1,negateAlpha:!0,medianSize:0,blurSigma:0,precision:"integer",minAmpl:0.2,sharpenSigma:0,sharpenM1:1,sharpenM2:2,sharpenX1:2,sharpenY2:10,sharpenY3:20,threshold:0,thresholdGrayscale:!0,trimBackground:[],trimThreshold:-1,trimLineArt:!1,dilateWidth:0,erodeWidth:0,gamma:0,gammaOut:0,greyscale:!1,normalise:!1,normaliseLower:1,normaliseUpper:99,claheWidth:0,claheHeight:0,claheMaxSlope:3,brightness:1,saturation:1,hue:0,lightness:0,booleanBufferIn:null,booleanFileIn:"",joinChannelIn:[],extractChannel:-1,removeAlpha:!1,ensureAlpha:-1,colourspace:"srgb",colourspacePipeline:"last",composite:[],fileOut:"",formatOut:"input",streamOut:!1,keepMetadata:0,withMetadataOrientation:-1,withMetadataDensity:0,withIccProfile:"",withExif:{},withExifMerge:!0,withXmp:"",resolveWithObject:!1,loop:-1,delay:[],jpegQuality:80,jpegProgressive:!1,jpegChromaSubsampling:"4:2:0",jpegTrellisQuantisation:!1,jpegOvershootDeringing:!1,jpegOptimiseScans:!1,jpegOptimiseCoding:!0,jpegQuantisationTable:0,pngProgressive:!1,pngCompressionLevel:6,pngAdaptiveFiltering:!1,pngPalette:!1,pngQuality:100,pngEffort:7,pngBitdepth:8,pngDither:1,jp2Quality:80,jp2TileHeight:512,jp2TileWidth:512,jp2Lossless:!1,jp2ChromaSubsampling:"4:4:4",webpQuality:80,webpAlphaQuality:100,webpLossless:!1,webpNearLossless:!1,webpSmartSubsample:!1,webpSmartDeblock:!1,webpPreset:"default",webpEffort:4,webpMinSize:!1,webpMixed:!1,gifBitdepth:8,gifEffort:7,gifDither:1,gifInterFrameMaxError:0,gifInterPaletteMaxError:3,gifKeepDuplicateFrames:!1,gifReuse:!0,gifProgressive:!1,tiffQuality:80,tiffCompression:"jpeg",tiffPredictor:"horizontal",tiffPyramid:!1,tiffMiniswhite:!1,tiffBitdepth:8,tiffTile:!1,tiffTileHeight:256,tiffTileWidth:256,tiffXres:1,tiffYres:1,tiffResolutionUnit:"inch",heifQuality:50,heifLossless:!1,heifCompression:"av1",heifEffort:4,heifChromaSubsampling:"4:4:4",heifBitdepth:8,jxlDistance:1,jxlDecodingTier:0,jxlEffort:7,jxlLossless:!1,rawDepth:"uchar",tileSize:256,tileOverlap:0,tileContainer:"fs",tileLayout:"dz",tileFormat:"last",tileDepth:"last",tileAngle:0,tileSkipBlanks:-1,tileBackground:[255,255,255,255],tileCentre:!1,tileId:"https://example.com/iiif",tileBasename:"",timeoutSeconds:0,linearA:[],linearB:[],pdfBackground:[255,255,255,255],debuglog:($)=>{this.emit("warning",$),V3($)},queueListener:function($){iJ.queue.emit("change",$)}},this.options.input=this._createInputDescriptor(J,Z,{allowStream:!0}),this};Object.setPrototypeOf(iJ.prototype,jY.Duplex.prototype);Object.setPrototypeOf(iJ,jY.Duplex);function N3(){let J=this.constructor.call(),{debuglog:Z,queueListener:$,...W}=this.options;if(J.options=structuredClone(W),J.options.debuglog=Z,J.options.queueListener=$,this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),J.options.input.buffer=this.options.input.buffer,J.emit("finish")});return J}Object.assign(iJ.prototype,{clone:N3});tH.exports=iJ});var ZU=J6((EB,$U)=>{var i=i4(),CJ=p5(),z3={left:"low",top:"low",low:"low",center:"centre",centre:"centre",right:"high",bottom:"high",high:"high"},E3=["failOn","limitInputPixels","unlimited","animated","autoOrient","density","ignoreIcc","page","pages","sequentialRead","jp2","openSlide","pdf","raw","svg","tiff","failOnError","openSlideLevel","pdfBackground","tiffSubifd"];function JU(J){let Z=E3.filter(($)=>i.defined(J[$])).map(($)=>[$,J[$]]);return Z.length?Object.fromEntries(Z):void 0}function L3(J,Z,$){let W={autoOrient:!1,failOn:"warning",limitInputPixels:Math.pow(16383,2),ignoreIcc:!1,unlimited:!1,sequentialRead:!0};if(i.string(J))W.file=J;else if(i.buffer(J)){if(J.length===0)throw Error("Input Buffer is empty");W.buffer=J}else if(i.arrayBuffer(J)){if(J.byteLength===0)throw Error("Input bit Array is empty");W.buffer=Buffer.from(J,0,J.byteLength)}else if(i.typedArray(J)){if(J.length===0)throw Error("Input Bit Array is empty");W.buffer=Buffer.from(J.buffer,J.byteOffset,J.byteLength)}else if(i.plainObject(J)&&!i.defined(Z)){if(Z=J,JU(Z))W.buffer=[]}else if(!i.defined(J)&&!i.defined(Z)&&i.object($)&&$.allowStream)W.buffer=[];else if(Array.isArray(J))if(J.length>1)if(!this.options.joining)this.options.joining=!0,this.options.join=J.map((Q)=>this._createInputDescriptor(Q));else throw Error("Recursive join is unsupported");else throw Error("Expected at least two images to join");else throw Error(`Unsupported input '${J}' of type ${typeof J}${i.defined(Z)?` when also providing options of type ${typeof Z}`:""}`);if(i.object(Z)){if(i.defined(Z.failOnError))if(i.bool(Z.failOnError))W.failOn=Z.failOnError?"warning":"none";else throw i.invalidParameterError("failOnError","boolean",Z.failOnError);if(i.defined(Z.failOn))if(i.string(Z.failOn)&&i.inArray(Z.failOn,["none","truncated","error","warning"]))W.failOn=Z.failOn;else throw i.invalidParameterError("failOn","one of: none, truncated, error, warning",Z.failOn);if(i.defined(Z.autoOrient))if(i.bool(Z.autoOrient))W.autoOrient=Z.autoOrient;else throw i.invalidParameterError("autoOrient","boolean",Z.autoOrient);if(i.defined(Z.density))if(i.inRange(Z.density,1,1e5))W.density=Z.density;else throw i.invalidParameterError("density","number between 1 and 100000",Z.density);if(i.defined(Z.ignoreIcc))if(i.bool(Z.ignoreIcc))W.ignoreIcc=Z.ignoreIcc;else throw i.invalidParameterError("ignoreIcc","boolean",Z.ignoreIcc);if(i.defined(Z.limitInputPixels))if(i.bool(Z.limitInputPixels))W.limitInputPixels=Z.limitInputPixels?Math.pow(16383,2):0;else if(i.integer(Z.limitInputPixels)&&i.inRange(Z.limitInputPixels,0,Number.MAX_SAFE_INTEGER))W.limitInputPixels=Z.limitInputPixels;else throw i.invalidParameterError("limitInputPixels","positive integer",Z.limitInputPixels);if(i.defined(Z.unlimited))if(i.bool(Z.unlimited))W.unlimited=Z.unlimited;else throw i.invalidParameterError("unlimited","boolean",Z.unlimited);if(i.defined(Z.sequentialRead))if(i.bool(Z.sequentialRead))W.sequentialRead=Z.sequentialRead;else throw i.invalidParameterError("sequentialRead","boolean",Z.sequentialRead);if(i.defined(Z.raw)){if(i.object(Z.raw)&&i.integer(Z.raw.width)&&Z.raw.width>0&&i.integer(Z.raw.height)&&Z.raw.height>0&&i.integer(Z.raw.channels)&&i.inRange(Z.raw.channels,1,4))switch(W.rawWidth=Z.raw.width,W.rawHeight=Z.raw.height,W.rawChannels=Z.raw.channels,J.constructor){case Uint8Array:case Uint8ClampedArray:W.rawDepth="uchar";break;case Int8Array:W.rawDepth="char";break;case Uint16Array:W.rawDepth="ushort";break;case Int16Array:W.rawDepth="short";break;case Uint32Array:W.rawDepth="uint";break;case Int32Array:W.rawDepth="int";break;case Float32Array:W.rawDepth="float";break;case Float64Array:W.rawDepth="double";break;default:W.rawDepth="uchar";break}else throw Error("Expected width, height and channels for raw pixel input");if(W.rawPremultiplied=!1,i.defined(Z.raw.premultiplied))if(i.bool(Z.raw.premultiplied))W.rawPremultiplied=Z.raw.premultiplied;else throw i.invalidParameterError("raw.premultiplied","boolean",Z.raw.premultiplied);if(W.rawPageHeight=0,i.defined(Z.raw.pageHeight))if(i.integer(Z.raw.pageHeight)&&Z.raw.pageHeight>0&&Z.raw.pageHeight<=Z.raw.height){if(Z.raw.height%Z.raw.pageHeight!==0)throw Error(`Expected raw.height ${Z.raw.height} to be a multiple of raw.pageHeight ${Z.raw.pageHeight}`);W.rawPageHeight=Z.raw.pageHeight}else throw i.invalidParameterError("raw.pageHeight","positive integer",Z.raw.pageHeight)}if(i.defined(Z.animated))if(i.bool(Z.animated))W.pages=Z.animated?-1:1;else throw i.invalidParameterError("animated","boolean",Z.animated);if(i.defined(Z.pages))if(i.integer(Z.pages)&&i.inRange(Z.pages,-1,1e5))W.pages=Z.pages;else throw i.invalidParameterError("pages","integer between -1 and 100000",Z.pages);if(i.defined(Z.page))if(i.integer(Z.page)&&i.inRange(Z.page,0,1e5))W.page=Z.page;else throw i.invalidParameterError("page","integer between 0 and 100000",Z.page);if(i.object(Z.openSlide)&&i.defined(Z.openSlide.level))if(i.integer(Z.openSlide.level)&&i.inRange(Z.openSlide.level,0,256))W.openSlideLevel=Z.openSlide.level;else throw i.invalidParameterError("openSlide.level","integer between 0 and 256",Z.openSlide.level);else if(i.defined(Z.level))if(i.integer(Z.level)&&i.inRange(Z.level,0,256))W.openSlideLevel=Z.level;else throw i.invalidParameterError("level","integer between 0 and 256",Z.level);if(i.object(Z.tiff)&&i.defined(Z.tiff.subifd))if(i.integer(Z.tiff.subifd)&&i.inRange(Z.tiff.subifd,-1,1e5))W.tiffSubifd=Z.tiff.subifd;else throw i.invalidParameterError("tiff.subifd","integer between -1 and 100000",Z.tiff.subifd);else if(i.defined(Z.subifd))if(i.integer(Z.subifd)&&i.inRange(Z.subifd,-1,1e5))W.tiffSubifd=Z.subifd;else throw i.invalidParameterError("subifd","integer between -1 and 100000",Z.subifd);if(i.object(Z.svg)){if(i.defined(Z.svg.stylesheet))if(i.string(Z.svg.stylesheet))W.svgStylesheet=Z.svg.stylesheet;else throw i.invalidParameterError("svg.stylesheet","string",Z.svg.stylesheet);if(i.defined(Z.svg.highBitdepth))if(i.bool(Z.svg.highBitdepth))W.svgHighBitdepth=Z.svg.highBitdepth;else throw i.invalidParameterError("svg.highBitdepth","boolean",Z.svg.highBitdepth)}if(i.object(Z.pdf)&&i.defined(Z.pdf.background))W.pdfBackground=this._getBackgroundColourOption(Z.pdf.background);else if(i.defined(Z.pdfBackground))W.pdfBackground=this._getBackgroundColourOption(Z.pdfBackground);if(i.object(Z.jp2)&&i.defined(Z.jp2.oneshot))if(i.bool(Z.jp2.oneshot))W.jp2Oneshot=Z.jp2.oneshot;else throw i.invalidParameterError("jp2.oneshot","boolean",Z.jp2.oneshot);if(i.defined(Z.create))if(i.object(Z.create)&&i.integer(Z.create.width)&&Z.create.width>0&&i.integer(Z.create.height)&&Z.create.height>0&&i.integer(Z.create.channels)){if(W.createWidth=Z.create.width,W.createHeight=Z.create.height,W.createChannels=Z.create.channels,W.createPageHeight=0,i.defined(Z.create.pageHeight))if(i.integer(Z.create.pageHeight)&&Z.create.pageHeight>0&&Z.create.pageHeight<=Z.create.height){if(Z.create.height%Z.create.pageHeight!==0)throw Error(`Expected create.height ${Z.create.height} to be a multiple of create.pageHeight ${Z.create.pageHeight}`);W.createPageHeight=Z.create.pageHeight}else throw i.invalidParameterError("create.pageHeight","positive integer",Z.create.pageHeight);if(i.defined(Z.create.noise)){if(!i.object(Z.create.noise))throw Error("Expected noise to be an object");if(Z.create.noise.type!=="gaussian")throw Error("Only gaussian noise is supported at the moment");if(W.createNoiseType=Z.create.noise.type,!i.inRange(Z.create.channels,1,4))throw i.invalidParameterError("create.channels","number between 1 and 4",Z.create.channels);if(W.createNoiseMean=128,i.defined(Z.create.noise.mean))if(i.number(Z.create.noise.mean)&&i.inRange(Z.create.noise.mean,0,1e4))W.createNoiseMean=Z.create.noise.mean;else throw i.invalidParameterError("create.noise.mean","number between 0 and 10000",Z.create.noise.mean);if(W.createNoiseSigma=30,i.defined(Z.create.noise.sigma))if(i.number(Z.create.noise.sigma)&&i.inRange(Z.create.noise.sigma,0,1e4))W.createNoiseSigma=Z.create.noise.sigma;else throw i.invalidParameterError("create.noise.sigma","number between 0 and 10000",Z.create.noise.sigma)}else if(i.defined(Z.create.background)){if(!i.inRange(Z.create.channels,3,4))throw i.invalidParameterError("create.channels","number between 3 and 4",Z.create.channels);W.createBackground=this._getBackgroundColourOption(Z.create.background)}else throw Error("Expected valid noise or background to create a new input image");delete W.buffer}else throw Error("Expected valid width, height and channels to create a new input image");if(i.defined(Z.text))if(i.object(Z.text)&&i.string(Z.text.text)){if(W.textValue=Z.text.text,i.defined(Z.text.height)&&i.defined(Z.text.dpi))throw Error("Expected only one of dpi or height");if(i.defined(Z.text.font))if(i.string(Z.text.font))W.textFont=Z.text.font;else throw i.invalidParameterError("text.font","string",Z.text.font);if(i.defined(Z.text.fontfile))if(i.string(Z.text.fontfile))W.textFontfile=Z.text.fontfile;else throw i.invalidParameterError("text.fontfile","string",Z.text.fontfile);if(i.defined(Z.text.width))if(i.integer(Z.text.width)&&Z.text.width>0)W.textWidth=Z.text.width;else throw i.invalidParameterError("text.width","positive integer",Z.text.width);if(i.defined(Z.text.height))if(i.integer(Z.text.height)&&Z.text.height>0)W.textHeight=Z.text.height;else throw i.invalidParameterError("text.height","positive integer",Z.text.height);if(i.defined(Z.text.align))if(i.string(Z.text.align)&&i.string(this.constructor.align[Z.text.align]))W.textAlign=this.constructor.align[Z.text.align];else throw i.invalidParameterError("text.align","valid alignment",Z.text.align);if(i.defined(Z.text.justify))if(i.bool(Z.text.justify))W.textJustify=Z.text.justify;else throw i.invalidParameterError("text.justify","boolean",Z.text.justify);if(i.defined(Z.text.dpi))if(i.integer(Z.text.dpi)&&i.inRange(Z.text.dpi,1,1e6))W.textDpi=Z.text.dpi;else throw i.invalidParameterError("text.dpi","integer between 1 and 1000000",Z.text.dpi);if(i.defined(Z.text.rgba))if(i.bool(Z.text.rgba))W.textRgba=Z.text.rgba;else throw i.invalidParameterError("text.rgba","bool",Z.text.rgba);if(i.defined(Z.text.spacing))if(i.integer(Z.text.spacing)&&i.inRange(Z.text.spacing,-1e6,1e6))W.textSpacing=Z.text.spacing;else throw i.invalidParameterError("text.spacing","integer between -1000000 and 1000000",Z.text.spacing);if(i.defined(Z.text.wrap))if(i.string(Z.text.wrap)&&i.inArray(Z.text.wrap,["word","char","word-char","none"]))W.textWrap=Z.text.wrap;else throw i.invalidParameterError("text.wrap","one of: word, char, word-char, none",Z.text.wrap);delete W.buffer}else throw Error("Expected a valid string to create an image with text.");if(i.defined(Z.join))if(i.defined(this.options.join)){if(i.defined(Z.join.animated))if(i.bool(Z.join.animated))W.joinAnimated=Z.join.animated;else throw i.invalidParameterError("join.animated","boolean",Z.join.animated);if(i.defined(Z.join.across))if(i.integer(Z.join.across)&&i.inRange(Z.join.across,1,1e6))W.joinAcross=Z.join.across;else throw i.invalidParameterError("join.across","integer between 1 and 100000",Z.join.across);if(i.defined(Z.join.shim))if(i.integer(Z.join.shim)&&i.inRange(Z.join.shim,0,1e6))W.joinShim=Z.join.shim;else throw i.invalidParameterError("join.shim","integer between 0 and 100000",Z.join.shim);if(i.defined(Z.join.background))W.joinBackground=this._getBackgroundColourOption(Z.join.background);if(i.defined(Z.join.halign))if(i.string(Z.join.halign)&&i.string(this.constructor.align[Z.join.halign]))W.joinHalign=this.constructor.align[Z.join.halign];else throw i.invalidParameterError("join.halign","valid alignment",Z.join.halign);if(i.defined(Z.join.valign))if(i.string(Z.join.valign)&&i.string(this.constructor.align[Z.join.valign]))W.joinValign=this.constructor.align[Z.join.valign];else throw i.invalidParameterError("join.valign","valid alignment",Z.join.valign)}else throw Error("Expected input to be an array of images to join")}else if(i.defined(Z))throw Error("Invalid input options "+Z);return W}function A3(J,Z,$){if(Array.isArray(this.options.input.buffer))if(i.buffer(J)){if(this.options.input.buffer.length===0)this.on("finish",()=>{this.streamInFinished=!0});this.options.input.buffer.push(J),$()}else $(Error("Non-Buffer data on Writable Stream"));else $(Error("Unexpected data on Writable Stream"))}function B3(){if(this._isStreamInput())this.options.input.buffer=Buffer.concat(this.options.input.buffer)}function F3(){return Array.isArray(this.options.input.buffer)}function R3(J){let Z=Error();if(i.fn(J)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),CJ.metadata(this.options,($,W)=>{if($)J(i.nativeError($,Z));else J(null,W)})});else CJ.metadata(this.options,($,W)=>{if($)J(i.nativeError($,Z));else J(null,W)});return this}else if(this._isStreamInput())return new Promise(($,W)=>{let Q=()=>{this._flattenBufferIn(),CJ.metadata(this.options,(Y,H)=>{if(Y)W(i.nativeError(Y,Z));else $(H)})};if(this.writableFinished)Q();else this.once("finish",Q)});else return new Promise(($,W)=>{CJ.metadata(this.options,(Q,Y)=>{if(Q)W(i.nativeError(Q,Z));else $(Y)})})}function I3(J){let Z=Error();if(i.fn(J)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),CJ.stats(this.options,($,W)=>{if($)J(i.nativeError($,Z));else J(null,W)})});else CJ.stats(this.options,($,W)=>{if($)J(i.nativeError($,Z));else J(null,W)});return this}else if(this._isStreamInput())return new Promise(($,W)=>{this.on("finish",function(){this._flattenBufferIn(),CJ.stats(this.options,(Q,Y)=>{if(Q)W(i.nativeError(Q,Z));else $(Y)})})});else return new Promise(($,W)=>{CJ.stats(this.options,(Q,Y)=>{if(Q)W(i.nativeError(Q,Z));else $(Y)})})}$U.exports=function(J){Object.assign(J.prototype,{_inputOptionsFromObject:JU,_createInputDescriptor:L3,_write:A3,_flattenBufferIn:B3,_isStreamInput:F3,metadata:R3,stats:I3}),J.align=z3}});var XU=J6((LB,GU)=>{var $6=i4(),QU={center:0,centre:0,north:1,east:2,south:3,west:4,northeast:5,southeast:6,southwest:7,northwest:8},KU={top:1,right:2,bottom:3,left:4,"right top":5,"right bottom":6,"left bottom":7,"left top":8},WU={background:"background",copy:"copy",repeat:"repeat",mirror:"mirror"},YU={entropy:16,attention:17},PY={nearest:"nearest",linear:"linear",cubic:"cubic",mitchell:"mitchell",lanczos2:"lanczos2",lanczos3:"lanczos3",mks2013:"mks2013",mks2021:"mks2021"},D3={contain:"contain",cover:"cover",fill:"fill",inside:"inside",outside:"outside"},w3={contain:"embed",cover:"crop",fill:"ignore_aspect",inside:"max",outside:"min"};function CY(J){return J.angle%360!==0||J.rotationAngle!==0}function W8(J){return J.width!==-1||J.height!==-1}function j3(J,Z,$){if(W8(this.options))this.options.debuglog("ignoring previous resize options");if(this.options.widthPost!==-1)this.options.debuglog("operation order will be: extract, resize, extract");if($6.defined(J))if($6.object(J)&&!$6.defined($))$=J;else if($6.integer(J)&&J>0)this.options.width=J;else throw $6.invalidParameterError("width","positive integer",J);else this.options.width=-1;if($6.defined(Z))if($6.integer(Z)&&Z>0)this.options.height=Z;else throw $6.invalidParameterError("height","positive integer",Z);else this.options.height=-1;if($6.object($)){if($6.defined($.width))if($6.integer($.width)&&$.width>0)this.options.width=$.width;else throw $6.invalidParameterError("width","positive integer",$.width);if($6.defined($.height))if($6.integer($.height)&&$.height>0)this.options.height=$.height;else throw $6.invalidParameterError("height","positive integer",$.height);if($6.defined($.fit)){let W=w3[$.fit];if($6.string(W))this.options.canvas=W;else throw $6.invalidParameterError("fit","valid fit",$.fit)}if($6.defined($.position)){let W=$6.integer($.position)?$.position:YU[$.position]||KU[$.position]||QU[$.position];if($6.integer(W)&&($6.inRange(W,0,8)||$6.inRange(W,16,17)))this.options.position=W;else throw $6.invalidParameterError("position","valid position/gravity/strategy",$.position)}if(this._setBackgroundColourOption("resizeBackground",$.background),$6.defined($.kernel))if($6.string(PY[$.kernel]))this.options.kernel=PY[$.kernel];else throw $6.invalidParameterError("kernel","valid kernel name",$.kernel);if($6.defined($.withoutEnlargement))this._setBooleanOption("withoutEnlargement",$.withoutEnlargement);if($6.defined($.withoutReduction))this._setBooleanOption("withoutReduction",$.withoutReduction);if($6.defined($.fastShrinkOnLoad))this._setBooleanOption("fastShrinkOnLoad",$.fastShrinkOnLoad)}if(CY(this.options)&&W8(this.options))this.options.rotateBefore=!0;return this}function P3(J){if($6.integer(J)&&J>0)this.options.extendTop=J,this.options.extendBottom=J,this.options.extendLeft=J,this.options.extendRight=J;else if($6.object(J)){if($6.defined(J.top))if($6.integer(J.top)&&J.top>=0)this.options.extendTop=J.top;else throw $6.invalidParameterError("top","positive integer",J.top);if($6.defined(J.bottom))if($6.integer(J.bottom)&&J.bottom>=0)this.options.extendBottom=J.bottom;else throw $6.invalidParameterError("bottom","positive integer",J.bottom);if($6.defined(J.left))if($6.integer(J.left)&&J.left>=0)this.options.extendLeft=J.left;else throw $6.invalidParameterError("left","positive integer",J.left);if($6.defined(J.right))if($6.integer(J.right)&&J.right>=0)this.options.extendRight=J.right;else throw $6.invalidParameterError("right","positive integer",J.right);if(this._setBackgroundColourOption("extendBackground",J.background),$6.defined(J.extendWith))if($6.string(WU[J.extendWith]))this.options.extendWith=WU[J.extendWith];else throw $6.invalidParameterError("extendWith","one of: background, copy, repeat, mirror",J.extendWith)}else throw $6.invalidParameterError("extend","integer or object",J);return this}function C3(J){let Z=W8(this.options)||this.options.widthPre!==-1?"Post":"Pre";if(this.options[`width${Z}`]!==-1)this.options.debuglog("ignoring previous extract options");if(["left","top","width","height"].forEach(function($){let W=J[$];if($6.integer(W)&&W>=0)this.options[$+($==="left"||$==="top"?"Offset":"")+Z]=W;else throw $6.invalidParameterError($,"integer",W)},this),CY(this.options)&&!W8(this.options)){if(this.options.widthPre===-1||this.options.widthPost===-1)this.options.rotateBefore=!0}if(this.options.input.autoOrient)this.options.orientBefore=!0;return this}function S3(J){if(this.options.trimThreshold=10,$6.defined(J))if($6.object(J)){if($6.defined(J.background))this._setBackgroundColourOption("trimBackground",J.background);if($6.defined(J.threshold))if($6.number(J.threshold)&&J.threshold>=0)this.options.trimThreshold=J.threshold;else throw $6.invalidParameterError("threshold","positive number",J.threshold);if($6.defined(J.lineArt))this._setBooleanOption("trimLineArt",J.lineArt)}else throw $6.invalidParameterError("trim","object",J);if(CY(this.options))this.options.rotateBefore=!0;return this}GU.exports=function(J){Object.assign(J.prototype,{resize:j3,extend:P3,extract:C3,trim:S3}),J.gravity=QU,J.strategy=YU,J.kernel=PY,J.fit=D3,J.position=KU}});var HU=J6((AB,qU)=>{var w6=i4(),SY={clear:"clear",source:"source",over:"over",in:"in",out:"out",atop:"atop",dest:"dest","dest-over":"dest-over","dest-in":"dest-in","dest-out":"dest-out","dest-atop":"dest-atop",xor:"xor",add:"add",saturate:"saturate",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","colour-dodge":"colour-dodge","color-dodge":"colour-dodge","colour-burn":"colour-burn","color-burn":"colour-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion"};function M3(J){if(!Array.isArray(J))throw w6.invalidParameterError("images to composite","array",J);return this.options.composite=J.map((Z)=>{if(!w6.object(Z))throw w6.invalidParameterError("image to composite","object",Z);let $=this._inputOptionsFromObject(Z),W={input:this._createInputDescriptor(Z.input,$,{allowStream:!1}),blend:"over",tile:!1,left:0,top:0,hasOffset:!1,gravity:0,premultiplied:!1};if(w6.defined(Z.blend))if(w6.string(SY[Z.blend]))W.blend=SY[Z.blend];else throw w6.invalidParameterError("blend","valid blend name",Z.blend);if(w6.defined(Z.tile))if(w6.bool(Z.tile))W.tile=Z.tile;else throw w6.invalidParameterError("tile","boolean",Z.tile);if(w6.defined(Z.left))if(w6.integer(Z.left))W.left=Z.left;else throw w6.invalidParameterError("left","integer",Z.left);if(w6.defined(Z.top))if(w6.integer(Z.top))W.top=Z.top;else throw w6.invalidParameterError("top","integer",Z.top);if(w6.defined(Z.top)!==w6.defined(Z.left))throw Error("Expected both left and top to be set");else W.hasOffset=w6.integer(Z.top)&&w6.integer(Z.left);if(w6.defined(Z.gravity))if(w6.integer(Z.gravity)&&w6.inRange(Z.gravity,0,8))W.gravity=Z.gravity;else if(w6.string(Z.gravity)&&w6.integer(this.constructor.gravity[Z.gravity]))W.gravity=this.constructor.gravity[Z.gravity];else throw w6.invalidParameterError("gravity","valid gravity",Z.gravity);if(w6.defined(Z.premultiplied))if(w6.bool(Z.premultiplied))W.premultiplied=Z.premultiplied;else throw w6.invalidParameterError("premultiplied","boolean",Z.premultiplied);return W}),this}qU.exports=function(J){J.prototype.composite=M3,J.blend=SY}});var EU=J6((BB,zU)=>{var K0=i4(),UU={integer:"integer",float:"float",approximate:"approximate"};function T3(J,Z){if(!K0.defined(J))return this.autoOrient();if(this.options.angle||this.options.rotationAngle)this.options.debuglog("ignoring previous rotate options"),this.options.angle=0,this.options.rotationAngle=0;if(K0.integer(J)&&!(J%90))this.options.angle=J;else if(K0.number(J)){if(this.options.rotationAngle=J,K0.object(Z)&&Z.background)this._setBackgroundColourOption("rotationBackground",Z.background)}else throw K0.invalidParameterError("angle","numeric",J);return this}function k3(){return this.options.input.autoOrient=!0,this}function _3(J){return this.options.flip=K0.bool(J)?J:!0,this}function x3(J){return this.options.flop=K0.bool(J)?J:!0,this}function y3(J,Z){let $=[].concat(...J);if($.length===4&&$.every(K0.number))this.options.affineMatrix=$;else throw K0.invalidParameterError("matrix","1x4 or 2x2 array",J);if(K0.defined(Z))if(K0.object(Z)){if(this._setBackgroundColourOption("affineBackground",Z.background),K0.defined(Z.idx))if(K0.number(Z.idx))this.options.affineIdx=Z.idx;else throw K0.invalidParameterError("options.idx","number",Z.idx);if(K0.defined(Z.idy))if(K0.number(Z.idy))this.options.affineIdy=Z.idy;else throw K0.invalidParameterError("options.idy","number",Z.idy);if(K0.defined(Z.odx))if(K0.number(Z.odx))this.options.affineOdx=Z.odx;else throw K0.invalidParameterError("options.odx","number",Z.odx);if(K0.defined(Z.ody))if(K0.number(Z.ody))this.options.affineOdy=Z.ody;else throw K0.invalidParameterError("options.ody","number",Z.ody);if(K0.defined(Z.interpolator))if(K0.inArray(Z.interpolator,Object.values(this.constructor.interpolators)))this.options.affineInterpolator=Z.interpolator;else throw K0.invalidParameterError("options.interpolator","valid interpolator name",Z.interpolator)}else throw K0.invalidParameterError("options","object",Z);return this}function v3(J,Z,$){if(!K0.defined(J))this.options.sharpenSigma=-1;else if(K0.bool(J))this.options.sharpenSigma=J?-1:0;else if(K0.number(J)&&K0.inRange(J,0.01,1e4)){if(this.options.sharpenSigma=J,K0.defined(Z))if(K0.number(Z)&&K0.inRange(Z,0,1e4))this.options.sharpenM1=Z;else throw K0.invalidParameterError("flat","number between 0 and 10000",Z);if(K0.defined($))if(K0.number($)&&K0.inRange($,0,1e4))this.options.sharpenM2=$;else throw K0.invalidParameterError("jagged","number between 0 and 10000",$)}else if(K0.plainObject(J)){if(K0.number(J.sigma)&&K0.inRange(J.sigma,0.000001,10))this.options.sharpenSigma=J.sigma;else throw K0.invalidParameterError("options.sigma","number between 0.000001 and 10",J.sigma);if(K0.defined(J.m1))if(K0.number(J.m1)&&K0.inRange(J.m1,0,1e6))this.options.sharpenM1=J.m1;else throw K0.invalidParameterError("options.m1","number between 0 and 1000000",J.m1);if(K0.defined(J.m2))if(K0.number(J.m2)&&K0.inRange(J.m2,0,1e6))this.options.sharpenM2=J.m2;else throw K0.invalidParameterError("options.m2","number between 0 and 1000000",J.m2);if(K0.defined(J.x1))if(K0.number(J.x1)&&K0.inRange(J.x1,0,1e6))this.options.sharpenX1=J.x1;else throw K0.invalidParameterError("options.x1","number between 0 and 1000000",J.x1);if(K0.defined(J.y2))if(K0.number(J.y2)&&K0.inRange(J.y2,0,1e6))this.options.sharpenY2=J.y2;else throw K0.invalidParameterError("options.y2","number between 0 and 1000000",J.y2);if(K0.defined(J.y3))if(K0.number(J.y3)&&K0.inRange(J.y3,0,1e6))this.options.sharpenY3=J.y3;else throw K0.invalidParameterError("options.y3","number between 0 and 1000000",J.y3)}else throw K0.invalidParameterError("sigma","number between 0.01 and 10000",J);return this}function O3(J){if(!K0.defined(J))this.options.medianSize=3;else if(K0.integer(J)&&K0.inRange(J,1,1000))this.options.medianSize=J;else throw K0.invalidParameterError("size","integer between 1 and 1000",J);return this}function b3(J){let Z;if(K0.number(J))Z=J;else if(K0.plainObject(J)){if(!K0.number(J.sigma))throw K0.invalidParameterError("options.sigma","number between 0.3 and 1000",Z);if(Z=J.sigma,"precision"in J)if(K0.string(UU[J.precision]))this.options.precision=UU[J.precision];else throw K0.invalidParameterError("precision","one of: integer, float, approximate",J.precision);if("minAmplitude"in J)if(K0.number(J.minAmplitude)&&K0.inRange(J.minAmplitude,0.001,1))this.options.minAmpl=J.minAmplitude;else throw K0.invalidParameterError("minAmplitude","number between 0.001 and 1",J.minAmplitude)}if(!K0.defined(J))this.options.blurSigma=-1;else if(K0.bool(J))this.options.blurSigma=J?-1:0;else if(K0.number(Z)&&K0.inRange(Z,0.3,1000))this.options.blurSigma=Z;else throw K0.invalidParameterError("sigma","number between 0.3 and 1000",Z);return this}function VU(J){if(!K0.defined(J))this.options.dilateWidth=1;else if(K0.integer(J)&&J>0)this.options.dilateWidth=J;else throw K0.invalidParameterError("dilate","positive integer",VU);return this}function NU(J){if(!K0.defined(J))this.options.erodeWidth=1;else if(K0.integer(J)&&J>0)this.options.erodeWidth=J;else throw K0.invalidParameterError("erode","positive integer",NU);return this}function h3(J){if(this.options.flatten=K0.bool(J)?J:!0,K0.object(J))this._setBackgroundColourOption("flattenBackground",J.background);return this}function f3(){return this.options.unflatten=!0,this}function d3(J,Z){if(!K0.defined(J))this.options.gamma=2.2;else if(K0.number(J)&&K0.inRange(J,1,3))this.options.gamma=J;else throw K0.invalidParameterError("gamma","number between 1.0 and 3.0",J);if(!K0.defined(Z))this.options.gammaOut=this.options.gamma;else if(K0.number(Z)&&K0.inRange(Z,1,3))this.options.gammaOut=Z;else throw K0.invalidParameterError("gammaOut","number between 1.0 and 3.0",Z);return this}function u3(J){if(this.options.negate=K0.bool(J)?J:!0,K0.plainObject(J)&&"alpha"in J)if(!K0.bool(J.alpha))throw K0.invalidParameterError("alpha","should be boolean value",J.alpha);else this.options.negateAlpha=J.alpha;return this}function g3(J){if(K0.plainObject(J)){if(K0.defined(J.lower))if(K0.number(J.lower)&&K0.inRange(J.lower,0,99))this.options.normaliseLower=J.lower;else throw K0.invalidParameterError("lower","number between 0 and 99",J.lower);if(K0.defined(J.upper))if(K0.number(J.upper)&&K0.inRange(J.upper,1,100))this.options.normaliseUpper=J.upper;else throw K0.invalidParameterError("upper","number between 1 and 100",J.upper)}if(this.options.normaliseLower>=this.options.normaliseUpper)throw K0.invalidParameterError("range","lower to be less than upper",`${this.options.normaliseLower} >= ${this.options.normaliseUpper}`);return this.options.normalise=!0,this}function l3(J){return this.normalise(J)}function c3(J){if(K0.plainObject(J)){if(K0.integer(J.width)&&J.width>0)this.options.claheWidth=J.width;else throw K0.invalidParameterError("width","integer greater than zero",J.width);if(K0.integer(J.height)&&J.height>0)this.options.claheHeight=J.height;else throw K0.invalidParameterError("height","integer greater than zero",J.height);if(K0.defined(J.maxSlope))if(K0.integer(J.maxSlope)&&K0.inRange(J.maxSlope,0,100))this.options.claheMaxSlope=J.maxSlope;else throw K0.invalidParameterError("maxSlope","integer between 0 and 100",J.maxSlope)}else throw K0.invalidParameterError("options","plain object",J);return this}function m3(J){if(!K0.object(J)||!Array.isArray(J.kernel)||!K0.integer(J.width)||!K0.integer(J.height)||!K0.inRange(J.width,3,1001)||!K0.inRange(J.height,3,1001)||J.height*J.width!==J.kernel.length)throw Error("Invalid convolution kernel");if(!K0.integer(J.scale))J.scale=J.kernel.reduce(function(Z,$){return Z+$},0);if(J.scale<1)J.scale=1;if(!K0.integer(J.offset))J.offset=0;return this.options.convKernel=J,this}function a3(J,Z){if(!K0.defined(J))this.options.threshold=128;else if(K0.bool(J))this.options.threshold=J?128:0;else if(K0.integer(J)&&K0.inRange(J,0,255))this.options.threshold=J;else throw K0.invalidParameterError("threshold","integer between 0 and 255",J);if(!K0.object(Z)||Z.greyscale===!0||Z.grayscale===!0)this.options.thresholdGrayscale=!0;else this.options.thresholdGrayscale=!1;return this}function p3(J,Z,$){if(this.options.boolean=this._createInputDescriptor(J,$),K0.string(Z)&&K0.inArray(Z,["and","or","eor"]))this.options.booleanOp=Z;else throw K0.invalidParameterError("operator","one of: and, or, eor",Z);return this}function r3(J,Z){if(!K0.defined(J)&&K0.number(Z))J=1;else if(K0.number(J)&&!K0.defined(Z))Z=0;if(!K0.defined(J))this.options.linearA=[];else if(K0.number(J))this.options.linearA=[J];else if(Array.isArray(J)&&J.length&&J.every(K0.number))this.options.linearA=J;else throw K0.invalidParameterError("a","number or array of numbers",J);if(!K0.defined(Z))this.options.linearB=[];else if(K0.number(Z))this.options.linearB=[Z];else if(Array.isArray(Z)&&Z.length&&Z.every(K0.number))this.options.linearB=Z;else throw K0.invalidParameterError("b","number or array of numbers",Z);if(this.options.linearA.length!==this.options.linearB.length)throw Error("Expected a and b to be arrays of the same length");return this}function e3(J){if(!Array.isArray(J))throw K0.invalidParameterError("inputMatrix","array",J);if(J.length!==3&&J.length!==4)throw K0.invalidParameterError("inputMatrix","3x3 or 4x4 array",J.length);let Z=J.flat().map(Number);if(Z.length!==9&&Z.length!==16)throw K0.invalidParameterError("inputMatrix","cardinality of 9 or 16",Z.length);return this.options.recombMatrix=Z,this}function n3(J){if(!K0.plainObject(J))throw K0.invalidParameterError("options","plain object",J);if("brightness"in J)if(K0.number(J.brightness)&&J.brightness>=0)this.options.brightness=J.brightness;else throw K0.invalidParameterError("brightness","number above zero",J.brightness);if("saturation"in J)if(K0.number(J.saturation)&&J.saturation>=0)this.options.saturation=J.saturation;else throw K0.invalidParameterError("saturation","number above zero",J.saturation);if("hue"in J)if(K0.integer(J.hue))this.options.hue=J.hue%360;else throw K0.invalidParameterError("hue","number",J.hue);if("lightness"in J)if(K0.number(J.lightness))this.options.lightness=J.lightness;else throw K0.invalidParameterError("lightness","number",J.lightness);return this}zU.exports=function(J){Object.assign(J.prototype,{autoOrient:k3,rotate:T3,flip:_3,flop:x3,affine:y3,sharpen:v3,erode:NU,dilate:VU,median:O3,blur:b3,flatten:h3,unflatten:f3,gamma:d3,negate:u3,normalise:g3,normalize:l3,clahe:c3,convolve:m3,threshold:a3,boolean:p3,linear:r3,recomb:e3,modulate:n3})}});var IU=J6((FB,RU)=>{var{defineProperty:_Y,getOwnPropertyDescriptor:s3,getOwnPropertyNames:i3}=Object,t3=Object.prototype.hasOwnProperty,o3=(J,Z)=>{for(var $ in Z)_Y(J,$,{get:Z[$],enumerable:!0})},JE=(J,Z,$,W)=>{if(Z&&typeof Z==="object"||typeof Z==="function"){for(let Q of i3(Z))if(!t3.call(J,Q)&&Q!==$)_Y(J,Q,{get:()=>Z[Q],enumerable:!(W=s3(Z,Q))||W.enumerable})}return J},$E=(J)=>JE(_Y({},"__esModule",{value:!0}),J),LU={};o3(LU,{default:()=>EE});RU.exports=$E(LU);var ZJ={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},AU=Object.create(null);for(let J in ZJ)if(Object.hasOwn(ZJ,J))AU[ZJ[J]]=J;var w4={to:{},get:{}};w4.get=function(J){let Z=J.slice(0,3).toLowerCase(),$,W;switch(Z){case"hsl":{$=w4.get.hsl(J),W="hsl";break}case"hwb":{$=w4.get.hwb(J),W="hwb";break}default:{$=w4.get.rgb(J),W="rgb";break}}if(!$)return null;return{model:W,value:$}};w4.get.rgb=function(J){if(!J)return null;let Z=/^#([a-f\d]{3,4})$/i,$=/^#([a-f\d]{6})([a-f\d]{2})?$/i,W=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,Q=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,Y=/^(\w+)$/,H=[0,0,0,1],G,q,E;if(G=J.match($)){E=G[2],G=G[1];for(q=0;q<3;q++){let V=q*2;H[q]=Number.parseInt(G.slice(V,V+2),16)}if(E)H[3]=Number.parseInt(E,16)/255}else if(G=J.match(Z)){G=G[1],E=G[3];for(q=0;q<3;q++)H[q]=Number.parseInt(G[q]+G[q],16);if(E)H[3]=Number.parseInt(E+E,16)/255}else if(G=J.match(W)){for(q=0;q<3;q++)H[q]=Number.parseInt(G[q+1],10);if(G[4])H[3]=G[5]?Number.parseFloat(G[4])*0.01:Number.parseFloat(G[4])}else if(G=J.match(Q)){for(q=0;q<3;q++)H[q]=Math.round(Number.parseFloat(G[q+1])*2.55);if(G[4])H[3]=G[5]?Number.parseFloat(G[4])*0.01:Number.parseFloat(G[4])}else if(G=J.match(Y)){if(G[1]==="transparent")return[0,0,0,0];if(!Object.hasOwn(ZJ,G[1]))return null;return H=ZJ[G[1]],H[3]=1,H}else return null;for(q=0;q<3;q++)H[q]=SJ(H[q],0,255);return H[3]=SJ(H[3],0,1),H};w4.get.hsl=function(J){if(!J)return null;let Z=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,$=J.match(Z);if($){let W=Number.parseFloat($[4]),Q=(Number.parseFloat($[1])%360+360)%360,Y=SJ(Number.parseFloat($[2]),0,100),H=SJ(Number.parseFloat($[3]),0,100),G=SJ(Number.isNaN(W)?1:W,0,1);return[Q,Y,H,G]}return null};w4.get.hwb=function(J){if(!J)return null;let Z=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,$=J.match(Z);if($){let W=Number.parseFloat($[4]),Q=(Number.parseFloat($[1])%360+360)%360,Y=SJ(Number.parseFloat($[2]),0,100),H=SJ(Number.parseFloat($[3]),0,100),G=SJ(Number.isNaN(W)?1:W,0,1);return[Q,Y,H,G]}return null};w4.to.hex=function(...J){return"#"+Q8(J[0])+Q8(J[1])+Q8(J[2])+(J[3]<1?Q8(Math.round(J[3]*255)):"")};w4.to.rgb=function(...J){return J.length<4||J[3]===1?"rgb("+Math.round(J[0])+", "+Math.round(J[1])+", "+Math.round(J[2])+")":"rgba("+Math.round(J[0])+", "+Math.round(J[1])+", "+Math.round(J[2])+", "+J[3]+")"};w4.to.rgb.percent=function(...J){let Z=Math.round(J[0]/255*100),$=Math.round(J[1]/255*100),W=Math.round(J[2]/255*100);return J.length<4||J[3]===1?"rgb("+Z+"%, "+$+"%, "+W+"%)":"rgba("+Z+"%, "+$+"%, "+W+"%, "+J[3]+")"};w4.to.hsl=function(...J){return J.length<4||J[3]===1?"hsl("+J[0]+", "+J[1]+"%, "+J[2]+"%)":"hsla("+J[0]+", "+J[1]+"%, "+J[2]+"%, "+J[3]+")"};w4.to.hwb=function(...J){let Z="";if(J.length>=4&&J[3]!==1)Z=", "+J[3];return"hwb("+J[0]+", "+J[1]+"%, "+J[2]+"%"+Z+")"};w4.to.keyword=function(...J){return AU[J.slice(0,3)]};function SJ(J,Z,$){return Math.min(Math.max(Z,J),$)}function Q8(J){let Z=Math.round(J).toString(16).toUpperCase();return Z.length<2?"0"+Z:Z}var H5=w4,BU={};for(let J of Object.keys(ZJ))BU[ZJ[J]]=J;var p0={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},tJ=p0,BJ=0.008856451679035631;function V5(J){let Z=J>0.0031308?1.055*J**0.4166666666666667-0.055:J*12.92;return Math.min(Math.max(0,Z),1)}function N5(J){return J>0.04045?((J+0.055)/1.055)**2.4:J/12.92}for(let J of Object.keys(p0)){if(!("channels"in p0[J]))throw Error("missing channels property: "+J);if(!("labels"in p0[J]))throw Error("missing channel labels property: "+J);if(p0[J].labels.length!==p0[J].channels)throw Error("channel and label counts mismatch: "+J);let{channels:Z,labels:$}=p0[J];delete p0[J].channels,delete p0[J].labels,Object.defineProperty(p0[J],"channels",{value:Z}),Object.defineProperty(p0[J],"labels",{value:$})}p0.rgb.hsl=function(J){let Z=J[0]/255,$=J[1]/255,W=J[2]/255,Q=Math.min(Z,$,W),Y=Math.max(Z,$,W),H=Y-Q,G,q;switch(Y){case Q:{G=0;break}case Z:{G=($-W)/H;break}case $:{G=2+(W-Z)/H;break}case W:{G=4+(Z-$)/H;break}}if(G=Math.min(G*60,360),G<0)G+=360;let E=(Q+Y)/2;if(Y===Q)q=0;else if(E<=0.5)q=H/(Y+Q);else q=H/(2-Y-Q);return[G,q*100,E*100]};p0.rgb.hsv=function(J){let Z,$,W,Q,Y,H=J[0]/255,G=J[1]/255,q=J[2]/255,E=Math.max(H,G,q),V=E-Math.min(H,G,q),N=function(z){return(E-z)/6/V+0.5};if(V===0)Q=0,Y=0;else{switch(Y=V/E,Z=N(H),$=N(G),W=N(q),E){case H:{Q=W-$;break}case G:{Q=0.3333333333333333+Z-W;break}case q:{Q=0.6666666666666666+$-Z;break}}if(Q<0)Q+=1;else if(Q>1)Q-=1}return[Q*360,Y*100,E*100]};p0.rgb.hwb=function(J){let Z=J[0],$=J[1],W=J[2],Q=p0.rgb.hsl(J)[0],Y=0.00392156862745098*Math.min(Z,Math.min($,W));return W=1-0.00392156862745098*Math.max(Z,Math.max($,W)),[Q,Y*100,W*100]};p0.rgb.oklab=function(J){let Z=N5(J[0]/255),$=N5(J[1]/255),W=N5(J[2]/255),Q=Math.cbrt(0.4122214708*Z+0.5363325363*$+0.0514459929*W),Y=Math.cbrt(0.2119034982*Z+0.6806995451*$+0.1073969566*W),H=Math.cbrt(0.0883024619*Z+0.2817188376*$+0.6299787005*W),G=0.2104542553*Q+0.793617785*Y-0.0040720468*H,q=1.9779984951*Q-2.428592205*Y+0.4505937099*H,E=0.0259040371*Q+0.7827717662*Y-0.808675766*H;return[G*100,q*100,E*100]};p0.rgb.cmyk=function(J){let Z=J[0]/255,$=J[1]/255,W=J[2]/255,Q=Math.min(1-Z,1-$,1-W),Y=(1-Z-Q)/(1-Q)||0,H=(1-$-Q)/(1-Q)||0,G=(1-W-Q)/(1-Q)||0;return[Y*100,H*100,G*100,Q*100]};function ZE(J,Z){return(J[0]-Z[0])**2+(J[1]-Z[1])**2+(J[2]-Z[2])**2}p0.rgb.keyword=function(J){let Z=BU[J];if(Z)return Z;let $=Number.POSITIVE_INFINITY,W;for(let Q of Object.keys(ZJ)){let Y=ZJ[Q],H=ZE(J,Y);if(H<$)$=H,W=Q}return W};p0.keyword.rgb=function(J){return ZJ[J]};p0.rgb.xyz=function(J){let Z=N5(J[0]/255),$=N5(J[1]/255),W=N5(J[2]/255),Q=Z*0.4124564+$*0.3575761+W*0.1804375,Y=Z*0.2126729+$*0.7151522+W*0.072175,H=Z*0.0193339+$*0.119192+W*0.9503041;return[Q*100,Y*100,H*100]};p0.rgb.lab=function(J){let Z=p0.rgb.xyz(J),$=Z[0],W=Z[1],Q=Z[2];$/=95.047,W/=100,Q/=108.883,$=$>BJ?$**0.3333333333333333:7.787*$+0.13793103448275862,W=W>BJ?W**0.3333333333333333:7.787*W+0.13793103448275862,Q=Q>BJ?Q**0.3333333333333333:7.787*Q+0.13793103448275862;let Y=116*W-16,H=500*($-W),G=200*(W-Q);return[Y,H,G]};p0.hsl.rgb=function(J){let Z=J[0]/360,$=J[1]/100,W=J[2]/100,Q,Y;if($===0)return Y=W*255,[Y,Y,Y];let H=W<0.5?W*(1+$):W+$-W*$,G=2*W-H,q=[0,0,0];for(let E=0;E<3;E++){if(Q=Z+0.3333333333333333*-(E-1),Q<0)Q++;if(Q>1)Q--;if(6*Q<1)Y=G+(H-G)*6*Q;else if(2*Q<1)Y=H;else if(3*Q<2)Y=G+(H-G)*(0.6666666666666666-Q)*6;else Y=G;q[E]=Y*255}return q};p0.hsl.hsv=function(J){let Z=J[0],$=J[1]/100,W=J[2]/100,Q=$,Y=Math.max(W,0.01);W*=2,$*=W<=1?W:2-W,Q*=Y<=1?Y:2-Y;let H=(W+$)/2,G=W===0?2*Q/(Y+Q):2*$/(W+$);return[Z,G*100,H*100]};p0.hsv.rgb=function(J){let Z=J[0]/60,$=J[1]/100,W=J[2]/100,Q=Math.floor(Z)%6,Y=Z-Math.floor(Z),H=255*W*(1-$),G=255*W*(1-$*Y),q=255*W*(1-$*(1-Y));switch(W*=255,Q){case 0:return[W,q,H];case 1:return[G,W,H];case 2:return[H,W,q];case 3:return[H,G,W];case 4:return[q,H,W];case 5:return[W,H,G]}};p0.hsv.hsl=function(J){let Z=J[0],$=J[1]/100,W=J[2]/100,Q=Math.max(W,0.01),Y,H;H=(2-$)*W;let G=(2-$)*Q;return Y=$*Q,Y/=G<=1?G:2-G,Y=Y||0,H/=2,[Z,Y*100,H*100]};p0.hwb.rgb=function(J){let Z=J[0]/360,$=J[1]/100,W=J[2]/100,Q=$+W,Y;if(Q>1)$/=Q,W/=Q;let H=Math.floor(6*Z),G=1-W;if(Y=6*Z-H,(H&1)!==0)Y=1-Y;let q=$+Y*(G-$),E,V,N;switch(H){default:case 6:case 0:{E=G,V=q,N=$;break}case 1:{E=q,V=G,N=$;break}case 2:{E=$,V=G,N=q;break}case 3:{E=$,V=q,N=G;break}case 4:{E=q,V=$,N=G;break}case 5:{E=G,V=$,N=q;break}}return[E*255,V*255,N*255]};p0.cmyk.rgb=function(J){let Z=J[0]/100,$=J[1]/100,W=J[2]/100,Q=J[3]/100,Y=1-Math.min(1,Z*(1-Q)+Q),H=1-Math.min(1,$*(1-Q)+Q),G=1-Math.min(1,W*(1-Q)+Q);return[Y*255,H*255,G*255]};p0.xyz.rgb=function(J){let Z=J[0]/100,$=J[1]/100,W=J[2]/100,Q,Y,H;return Q=Z*3.2404542+$*-1.5371385+W*-0.4985314,Y=Z*-0.969266+$*1.8760108+W*0.041556,H=Z*0.0556434+$*-0.2040259+W*1.0572252,Q=V5(Q),Y=V5(Y),H=V5(H),[Q*255,Y*255,H*255]};p0.xyz.lab=function(J){let Z=J[0],$=J[1],W=J[2];Z/=95.047,$/=100,W/=108.883,Z=Z>BJ?Z**0.3333333333333333:7.787*Z+0.13793103448275862,$=$>BJ?$**0.3333333333333333:7.787*$+0.13793103448275862,W=W>BJ?W**0.3333333333333333:7.787*W+0.13793103448275862;let Q=116*$-16,Y=500*(Z-$),H=200*($-W);return[Q,Y,H]};p0.xyz.oklab=function(J){let Z=J[0]/100,$=J[1]/100,W=J[2]/100,Q=Math.cbrt(0.8189330101*Z+0.3618667424*$-0.1288597137*W),Y=Math.cbrt(0.0329845436*Z+0.9293118715*$+0.0361456387*W),H=Math.cbrt(0.0482003018*Z+0.2643662691*$+0.633851707*W),G=0.2104542553*Q+0.793617785*Y-0.0040720468*H,q=1.9779984951*Q-2.428592205*Y+0.4505937099*H,E=0.0259040371*Q+0.7827717662*Y-0.808675766*H;return[G*100,q*100,E*100]};p0.oklab.oklch=function(J){return p0.lab.lch(J)};p0.oklab.xyz=function(J){let Z=J[0]/100,$=J[1]/100,W=J[2]/100,Q=(0.999999998*Z+0.396337792*$+0.215803758*W)**3,Y=(1.000000008*Z-0.105561342*$-0.063854175*W)**3,H=(1.000000055*Z-0.089484182*$-1.291485538*W)**3,G=1.227013851*Q-0.55779998*Y+0.281256149*H,q=-0.040580178*Q+1.11225687*Y-0.071676679*H,E=-0.076381285*Q-0.421481978*Y+1.58616322*H;return[G*100,q*100,E*100]};p0.oklab.rgb=function(J){let Z=J[0]/100,$=J[1]/100,W=J[2]/100,Q=(Z+0.3963377774*$+0.2158037573*W)**3,Y=(Z-0.1055613458*$-0.0638541728*W)**3,H=(Z-0.0894841775*$-1.291485548*W)**3,G=V5(4.0767416621*Q-3.3077115913*Y+0.2309699292*H),q=V5(-1.2684380046*Q+2.6097574011*Y-0.3413193965*H),E=V5(-0.0041960863*Q-0.7034186147*Y+1.707614701*H);return[G*255,q*255,E*255]};p0.oklch.oklab=function(J){return p0.lch.lab(J)};p0.lab.xyz=function(J){let Z=J[0],$=J[1],W=J[2],Q,Y,H;Y=(Z+16)/116,Q=$/500+Y,H=Y-W/200;let G=Y**3,q=Q**3,E=H**3;return Y=G>BJ?G:(Y-0.13793103448275862)/7.787,Q=q>BJ?q:(Q-0.13793103448275862)/7.787,H=E>BJ?E:(H-0.13793103448275862)/7.787,Q*=95.047,Y*=100,H*=108.883,[Q,Y,H]};p0.lab.lch=function(J){let Z=J[0],$=J[1],W=J[2],Q;if(Q=Math.atan2(W,$)*360/2/Math.PI,Q<0)Q+=360;let H=Math.sqrt($*$+W*W);return[Z,H,Q]};p0.lch.lab=function(J){let Z=J[0],$=J[1],Q=J[2]/360*2*Math.PI,Y=$*Math.cos(Q),H=$*Math.sin(Q);return[Z,Y,H]};p0.rgb.ansi16=function(J,Z=null){let[$,W,Q]=J,Y=Z===null?p0.rgb.hsv(J)[2]:Z;if(Y=Math.round(Y/50),Y===0)return 30;let H=30+(Math.round(Q/255)<<2|Math.round(W/255)<<1|Math.round($/255));if(Y===2)H+=60;return H};p0.hsv.ansi16=function(J){return p0.rgb.ansi16(p0.hsv.rgb(J),J[2])};p0.rgb.ansi256=function(J){let Z=J[0],$=J[1],W=J[2];if(Z>>4===$>>4&&$>>4===W>>4){if(Z<8)return 16;if(Z>248)return 231;return Math.round((Z-8)/247*24)+232}return 16+36*Math.round(Z/255*5)+6*Math.round($/255*5)+Math.round(W/255*5)};p0.ansi16.rgb=function(J){J=J[0];let Z=J%10;if(Z===0||Z===7){if(J>50)Z+=3.5;return Z=Z/10.5*255,[Z,Z,Z]}let $=(Math.trunc(J>50)+1)*0.5,W=(Z&1)*$*255,Q=(Z>>1&1)*$*255,Y=(Z>>2&1)*$*255;return[W,Q,Y]};p0.ansi256.rgb=function(J){if(J=J[0],J>=232){let Y=(J-232)*10+8;return[Y,Y,Y]}J-=16;let Z,$=Math.floor(J/36)/5*255,W=Math.floor((Z=J%36)/6)/5*255,Q=Z%6/5*255;return[$,W,Q]};p0.rgb.hex=function(J){let $=(((Math.round(J[0])&255)<<16)+((Math.round(J[1])&255)<<8)+(Math.round(J[2])&255)).toString(16).toUpperCase();return"000000".slice($.length)+$};p0.hex.rgb=function(J){let Z=J.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!Z)return[0,0,0];let $=Z[0];if(Z[0].length===3)$=[...$].map((G)=>G+G).join("");let W=Number.parseInt($,16),Q=W>>16&255,Y=W>>8&255,H=W&255;return[Q,Y,H]};p0.rgb.hcg=function(J){let Z=J[0]/255,$=J[1]/255,W=J[2]/255,Q=Math.max(Math.max(Z,$),W),Y=Math.min(Math.min(Z,$),W),H=Q-Y,G,q=H<1?Y/(1-H):0;if(H<=0)G=0;else if(Q===Z)G=($-W)/H%6;else if(Q===$)G=2+(W-Z)/H;else G=4+(Z-$)/H;return G/=6,G%=1,[G*360,H*100,q*100]};p0.hsl.hcg=function(J){let Z=J[1]/100,$=J[2]/100,W=$<0.5?2*Z*$:2*Z*(1-$),Q=0;if(W<1)Q=($-0.5*W)/(1-W);return[J[0],W*100,Q*100]};p0.hsv.hcg=function(J){let Z=J[1]/100,$=J[2]/100,W=Z*$,Q=0;if(W<1)Q=($-W)/(1-W);return[J[0],W*100,Q*100]};p0.hcg.rgb=function(J){let Z=J[0]/360,$=J[1]/100,W=J[2]/100;if($===0)return[W*255,W*255,W*255];let Q=[0,0,0],Y=Z%1*6,H=Y%1,G=1-H,q=0;switch(Math.floor(Y)){case 0:{Q[0]=1,Q[1]=H,Q[2]=0;break}case 1:{Q[0]=G,Q[1]=1,Q[2]=0;break}case 2:{Q[0]=0,Q[1]=1,Q[2]=H;break}case 3:{Q[0]=0,Q[1]=G,Q[2]=1;break}case 4:{Q[0]=H,Q[1]=0,Q[2]=1;break}default:Q[0]=1,Q[1]=0,Q[2]=G}return q=(1-$)*W,[($*Q[0]+q)*255,($*Q[1]+q)*255,($*Q[2]+q)*255]};p0.hcg.hsv=function(J){let Z=J[1]/100,$=J[2]/100,W=Z+$*(1-Z),Q=0;if(W>0)Q=Z/W;return[J[0],Q*100,W*100]};p0.hcg.hsl=function(J){let Z=J[1]/100,W=J[2]/100*(1-Z)+0.5*Z,Q=0;if(W>0&&W<0.5)Q=Z/(2*W);else if(W>=0.5&&W<1)Q=Z/(2*(1-W));return[J[0],Q*100,W*100]};p0.hcg.hwb=function(J){let Z=J[1]/100,$=J[2]/100,W=Z+$*(1-Z);return[J[0],(W-Z)*100,(1-W)*100]};p0.hwb.hcg=function(J){let Z=J[1]/100,W=1-J[2]/100,Q=W-Z,Y=0;if(Q<1)Y=(W-Q)/(1-Q);return[J[0],Q*100,Y*100]};p0.apple.rgb=function(J){return[J[0]/65535*255,J[1]/65535*255,J[2]/65535*255]};p0.rgb.apple=function(J){return[J[0]/255*65535,J[1]/255*65535,J[2]/255*65535]};p0.gray.rgb=function(J){return[J[0]/100*255,J[0]/100*255,J[0]/100*255]};p0.gray.hsl=function(J){return[0,0,J[0]]};p0.gray.hsv=p0.gray.hsl;p0.gray.hwb=function(J){return[0,100,J[0]]};p0.gray.cmyk=function(J){return[0,0,0,J[0]]};p0.gray.lab=function(J){return[J[0],0,0]};p0.gray.hex=function(J){let Z=Math.round(J[0]/100*255)&255,W=((Z<<16)+(Z<<8)+Z).toString(16).toUpperCase();return"000000".slice(W.length)+W};p0.rgb.gray=function(J){return[(J[0]+J[1]+J[2])/3/255*100]};function WE(){let J={},Z=Object.keys(tJ);for(let{length:$}=Z,W=0;W<$;W++)J[Z[W]]={distance:-1,parent:null};return J}function QE(J){let Z=WE(),$=[J];Z[J].distance=0;while($.length>0){let W=$.pop(),Q=Object.keys(tJ[W]);for(let{length:Y}=Q,H=0;H<Y;H++){let G=Q[H],q=Z[G];if(q.distance===-1)q.distance=Z[W].distance+1,q.parent=W,$.unshift(G)}}return Z}function KE(J,Z){return function($){return Z(J($))}}function YE(J,Z){let $=[Z[J].parent,J],W=tJ[Z[J].parent][J],Q=Z[J].parent;while(Z[Q].parent)$.unshift(Z[Q].parent),W=KE(tJ[Z[Q].parent][Q],W),Q=Z[Q].parent;return W.conversion=$,W}function GE(J){let Z=QE(J),$={},W=Object.keys(Z);for(let{length:Q}=W,Y=0;Y<Q;Y++){let H=W[Y];if(Z[H].parent===null)continue;$[H]=YE(H,Z)}return $}var XE=GE,U5={},qE=Object.keys(tJ);function HE(J){let Z=function(...$){let W=$[0];if(W===void 0||W===null)return W;if(W.length>1)$=W;return J($)};if("conversion"in J)Z.conversion=J.conversion;return Z}function UE(J){let Z=function(...$){let W=$[0];if(W===void 0||W===null)return W;if(W.length>1)$=W;let Q=J($);if(typeof Q==="object")for(let{length:Y}=Q,H=0;H<Y;H++)Q[H]=Math.round(Q[H]);return Q};if("conversion"in J)Z.conversion=J.conversion;return Z}for(let J of qE){U5[J]={},Object.defineProperty(U5[J],"channels",{value:tJ[J].channels}),Object.defineProperty(U5[J],"labels",{value:tJ[J].labels});let Z=XE(J),$=Object.keys(Z);for(let W of $){let Q=Z[W];U5[J][W]=UE(Q),U5[J][W].raw=HE(Q)}}var T4=U5,FU=["keyword","gray","hex"],MY={};for(let J of Object.keys(T4))MY[[...T4[J].labels].sort().join("")]=J;var TY={};function $4(J,Z){if(!(this instanceof $4))return new $4(J,Z);if(Z&&Z in FU)Z=null;if(Z&&!(Z in T4))throw Error("Unknown model: "+Z);let $,W;if(J==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(J instanceof $4)this.model=J.model,this.color=[...J.color],this.valpha=J.valpha;else if(typeof J==="string"){let Q=H5.get(J);if(Q===null)throw Error("Unable to parse color from string: "+J);this.model=Q.model,W=T4[this.model].channels,this.color=Q.value.slice(0,W),this.valpha=typeof Q.value[W]==="number"?Q.value[W]:1}else if(J.length>0){this.model=Z||"rgb",W=T4[this.model].channels;let Q=Array.prototype.slice.call(J,0,W);this.color=kY(Q,W),this.valpha=typeof J[W]==="number"?J[W]:1}else if(typeof J==="number")this.model="rgb",this.color=[J>>16&255,J>>8&255,J&255],this.valpha=1;else{this.valpha=1;let Q=Object.keys(J);if("alpha"in J)Q.splice(Q.indexOf("alpha"),1),this.valpha=typeof J.alpha==="number"?J.alpha:0;let Y=Q.sort().join("");if(!(Y in MY))throw Error("Unable to parse color from object: "+JSON.stringify(J));this.model=MY[Y];let{labels:H}=T4[this.model],G=[];for($=0;$<H.length;$++)G.push(J[H[$]]);this.color=kY(G)}if(TY[this.model]){W=T4[this.model].channels;for($=0;$<W;$++){let Q=TY[this.model][$];if(Q)this.color[$]=Q(this.color[$])}}if(this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze)Object.freeze(this)}$4.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(J){let Z=this.model in H5.to?this:this.rgb();Z=Z.round(typeof J==="number"?J:1);let $=Z.valpha===1?Z.color:[...Z.color,this.valpha];return H5.to[Z.model](...$)},percentString(J){let Z=this.rgb().round(typeof J==="number"?J:1),$=Z.valpha===1?Z.color:[...Z.color,this.valpha];return H5.to.rgb.percent(...$)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){let J={},{channels:Z}=T4[this.model],{labels:$}=T4[this.model];for(let W=0;W<Z;W++)J[$[W]]=this.color[W];if(this.valpha!==1)J.alpha=this.valpha;return J},unitArray(){let J=this.rgb().color;if(J[0]/=255,J[1]/=255,J[2]/=255,this.valpha!==1)J.push(this.valpha);return J},unitObject(){let J=this.rgb().object();if(J.r/=255,J.g/=255,J.b/=255,this.valpha!==1)J.alpha=this.valpha;return J},round(J){return J=Math.max(J||0,0),new $4([...this.color.map(NE(J)),this.valpha],this.model)},alpha(J){if(J!==void 0)return new $4([...this.color,Math.max(0,Math.min(1,J))],this.model);return this.valpha},red:f6("rgb",0,t6(255)),green:f6("rgb",1,t6(255)),blue:f6("rgb",2,t6(255)),hue:f6(["hsl","hsv","hsl","hwb","hcg"],0,(J)=>(J%360+360)%360),saturationl:f6("hsl",1,t6(100)),lightness:f6("hsl",2,t6(100)),saturationv:f6("hsv",1,t6(100)),value:f6("hsv",2,t6(100)),chroma:f6("hcg",1,t6(100)),gray:f6("hcg",2,t6(100)),white:f6("hwb",1,t6(100)),wblack:f6("hwb",2,t6(100)),cyan:f6("cmyk",0,t6(100)),magenta:f6("cmyk",1,t6(100)),yellow:f6("cmyk",2,t6(100)),black:f6("cmyk",3,t6(100)),x:f6("xyz",0,t6(95.047)),y:f6("xyz",1,t6(100)),z:f6("xyz",2,t6(108.833)),l:f6("lab",0,t6(100)),a:f6("lab",1),b:f6("lab",2),keyword(J){if(J!==void 0)return new $4(J);return T4[this.model].keyword(this.color)},hex(J){if(J!==void 0)return new $4(J);return H5.to.hex(...this.rgb().round().color)},hexa(J){if(J!==void 0)return new $4(J);let Z=this.rgb().round().color,$=Math.round(this.valpha*255).toString(16).toUpperCase();if($.length===1)$="0"+$;return H5.to.hex(...Z)+$},rgbNumber(){let J=this.rgb().color;return(J[0]&255)<<16|(J[1]&255)<<8|J[2]&255},luminosity(){let J=this.rgb().color,Z=[];for(let[$,W]of J.entries()){let Q=W/255;Z[$]=Q<=0.04045?Q/12.92:((Q+0.055)/1.055)**2.4}return 0.2126*Z[0]+0.7152*Z[1]+0.0722*Z[2]},contrast(J){let Z=this.luminosity(),$=J.luminosity();if(Z>$)return(Z+0.05)/($+0.05);return($+0.05)/(Z+0.05)},level(J){let Z=this.contrast(J);if(Z>=7)return"AAA";return Z>=4.5?"AA":""},isDark(){let J=this.rgb().color;return(J[0]*2126+J[1]*7152+J[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){let J=this.rgb();for(let Z=0;Z<3;Z++)J.color[Z]=255-J.color[Z];return J},lighten(J){let Z=this.hsl();return Z.color[2]+=Z.color[2]*J,Z},darken(J){let Z=this.hsl();return Z.color[2]-=Z.color[2]*J,Z},saturate(J){let Z=this.hsl();return Z.color[1]+=Z.color[1]*J,Z},desaturate(J){let Z=this.hsl();return Z.color[1]-=Z.color[1]*J,Z},whiten(J){let Z=this.hwb();return Z.color[1]+=Z.color[1]*J,Z},blacken(J){let Z=this.hwb();return Z.color[2]+=Z.color[2]*J,Z},grayscale(){let J=this.rgb().color,Z=J[0]*0.3+J[1]*0.59+J[2]*0.11;return $4.rgb(Z,Z,Z)},fade(J){return this.alpha(this.valpha-this.valpha*J)},opaquer(J){return this.alpha(this.valpha+this.valpha*J)},rotate(J){let Z=this.hsl(),$=Z.color[0];return $=($+J)%360,$=$<0?360+$:$,Z.color[0]=$,Z},mix(J,Z){if(!J||!J.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof J);let $=J.rgb(),W=this.rgb(),Q=Z===void 0?0.5:Z,Y=2*Q-1,H=$.alpha()-W.alpha(),G=((Y*H===-1?Y:(Y+H)/(1+Y*H))+1)/2,q=1-G;return $4.rgb(G*$.red()+q*W.red(),G*$.green()+q*W.green(),G*$.blue()+q*W.blue(),$.alpha()*Q+W.alpha()*(1-Q))}};for(let J of Object.keys(T4)){if(FU.includes(J))continue;let{channels:Z}=T4[J];$4.prototype[J]=function(...$){if(this.model===J)return new $4(this);if($.length>0)return new $4($,J);return new $4([...zE(T4[this.model][J].raw(this.color)),this.valpha],J)},$4[J]=function(...$){let W=$[0];if(typeof W==="number")W=kY($,Z);return new $4(W,J)}}function VE(J,Z){return Number(J.toFixed(Z))}function NE(J){return function(Z){return VE(Z,J)}}function f6(J,Z,$){J=Array.isArray(J)?J:[J];for(let W of J)(TY[W]||=[])[Z]=$;return J=J[0],function(W){let Q;if(W!==void 0){if($)W=$(W);return Q=this[J](),Q.color[Z]=W,Q}if(Q=this[J]().color[Z],$)Q=$(Q);return Q}}function t6(J){return function(Z){return Math.max(0,Math.min(J,Z))}}function zE(J){return Array.isArray(J)?J:[J]}function kY(J,Z){for(let $=0;$<Z;$++)if(typeof J[$]!=="number")J[$]=0;return J}var EE=$4});var wU=J6((RB,DU)=>{DU.exports=IU().default});var SU=J6((IB,CU)=>{var LE=wU(),FJ=i4(),jU={multiband:"multiband","b-w":"b-w",bw:"b-w",cmyk:"cmyk",srgb:"srgb"};function AE(J){return this._setBackgroundColourOption("tint",J),this}function BE(J){return this.options.greyscale=FJ.bool(J)?J:!0,this}function FE(J){return this.greyscale(J)}function RE(J){if(!FJ.string(J))throw FJ.invalidParameterError("colourspace","string",J);return this.options.colourspacePipeline=J,this}function IE(J){return this.pipelineColourspace(J)}function DE(J){if(!FJ.string(J))throw FJ.invalidParameterError("colourspace","string",J);return this.options.colourspace=J,this}function wE(J){return this.toColourspace(J)}function PU(J){if(FJ.object(J)||FJ.string(J)){let Z=LE(J);return[Z.red(),Z.green(),Z.blue(),Math.round(Z.alpha()*255)]}else throw FJ.invalidParameterError("background","object or string",J)}function jE(J,Z){if(FJ.defined(Z))this.options[J]=PU(Z)}CU.exports=function(J){Object.assign(J.prototype,{tint:AE,greyscale:BE,grayscale:FE,pipelineColourspace:RE,pipelineColorspace:IE,toColourspace:DE,toColorspace:wE,_getBackgroundColourOption:PU,_setBackgroundColourOption:jE}),J.colourspace=jU,J.colorspace=jU}});var TU=J6((DB,MU)=>{var WJ=i4(),PE={and:"and",or:"or",eor:"eor"};function CE(){return this.options.removeAlpha=!0,this}function SE(J){if(WJ.defined(J))if(WJ.number(J)&&WJ.inRange(J,0,1))this.options.ensureAlpha=J;else throw WJ.invalidParameterError("alpha","number between 0 and 1",J);else this.options.ensureAlpha=1;return this}function ME(J){let Z={red:0,green:1,blue:2,alpha:3};if(Object.keys(Z).includes(J))J=Z[J];if(WJ.integer(J)&&WJ.inRange(J,0,4))this.options.extractChannel=J;else throw WJ.invalidParameterError("channel","integer or one of: red, green, blue, alpha",J);return this}function TE(J,Z){if(Array.isArray(J))J.forEach(function($){this.options.joinChannelIn.push(this._createInputDescriptor($,Z))},this);else this.options.joinChannelIn.push(this._createInputDescriptor(J,Z));return this}function kE(J){if(WJ.string(J)&&WJ.inArray(J,["and","or","eor"]))this.options.bandBoolOp=J;else throw WJ.invalidParameterError("boolOp","one of: and, or, eor",J);return this}MU.exports=function(J){Object.assign(J.prototype,{removeAlpha:CE,ensureAlpha:SE,extractChannel:ME,joinChannel:TE,bandbool:kE}),J.bool=PE}});var vU=J6((wB,yU)=>{var xY=b6("node:path"),x=i4(),z5=p5(),kU=new Map([["heic","heif"],["heif","heif"],["avif","avif"],["jpeg","jpeg"],["jpg","jpeg"],["jpe","jpeg"],["tile","tile"],["dz","tile"],["png","png"],["raw","raw"],["tiff","tiff"],["tif","tiff"],["webp","webp"],["gif","gif"],["jp2","jp2"],["jpx","jp2"],["j2k","jp2"],["j2c","jp2"],["jxl","jxl"]]),_E=/\.(jp[2x]|j2[kc])$/i,_U=()=>Error("JP2 output requires libvips with support for OpenJPEG"),xU=(J)=>1<<31-Math.clz32(Math.ceil(Math.log2(J)));function xE(J,Z){let $;if(!x.string(J))$=Error("Missing output file path");else if(x.string(this.options.input.file)&&xY.resolve(this.options.input.file)===xY.resolve(J))$=Error("Cannot use same file for input and output");else if(_E.test(xY.extname(J))&&!this.constructor.format.jp2k.output.file)$=_U();if($)if(x.fn(Z))Z($);else return Promise.reject($);else{this.options.fileOut=J;let W=Error();return this._pipeline(Z,W)}return this}function yE(J,Z){if(x.object(J))this._setBooleanOption("resolveWithObject",J.resolveWithObject);else if(this.options.resolveWithObject)this.options.resolveWithObject=!1;this.options.fileOut="";let $=Error();return this._pipeline(x.fn(J)?J:Z,$)}function vE(){return this.options.keepMetadata|=1,this}function OE(J){if(x.object(J))for(let[Z,$]of Object.entries(J))if(x.object($))for(let[W,Q]of Object.entries($))if(x.string(Q))this.options.withExif[`exif-${Z.toLowerCase()}-${W}`]=Q;else throw x.invalidParameterError(`${Z}.${W}`,"string",Q);else throw x.invalidParameterError(Z,"object",$);else throw x.invalidParameterError("exif","object",J);return this.options.withExifMerge=!1,this.keepExif()}function bE(J){return this.withExif(J),this.options.withExifMerge=!0,this}function hE(){return this.options.keepMetadata|=8,this}function fE(J,Z){if(x.string(J))this.options.withIccProfile=J;else throw x.invalidParameterError("icc","string",J);if(this.keepIccProfile(),x.object(Z)){if(x.defined(Z.attach))if(x.bool(Z.attach)){if(!Z.attach)this.options.keepMetadata&=-9}else throw x.invalidParameterError("attach","boolean",Z.attach)}return this}function dE(){return this.options.keepMetadata|=2,this}function uE(J){if(x.string(J)&&J.length>0)this.options.withXmp=J,this.options.keepMetadata|=2;else throw x.invalidParameterError("xmp","non-empty string",J);return this}function gE(){return this.options.keepMetadata=31,this}function lE(J){if(this.keepMetadata(),this.withIccProfile("srgb"),x.object(J)){if(x.defined(J.orientation))if(x.integer(J.orientation)&&x.inRange(J.orientation,1,8))this.options.withMetadataOrientation=J.orientation;else throw x.invalidParameterError("orientation","integer between 1 and 8",J.orientation);if(x.defined(J.density))if(x.number(J.density)&&J.density>0)this.options.withMetadataDensity=J.density;else throw x.invalidParameterError("density","positive number",J.density);if(x.defined(J.icc))this.withIccProfile(J.icc);if(x.defined(J.exif))this.withExifMerge(J.exif)}return this}function cE(J,Z){let $=kU.get((x.object(J)&&x.string(J.id)?J.id:J).toLowerCase());if(!$)throw x.invalidParameterError("format",`one of: ${[...kU.keys()].join(", ")}`,J);return this[$](Z)}function mE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.jpegQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.progressive))this._setBooleanOption("jpegProgressive",J.progressive);if(x.defined(J.chromaSubsampling))if(x.string(J.chromaSubsampling)&&x.inArray(J.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jpegChromaSubsampling=J.chromaSubsampling;else throw x.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",J.chromaSubsampling);let Z=x.bool(J.optimizeCoding)?J.optimizeCoding:J.optimiseCoding;if(x.defined(Z))this._setBooleanOption("jpegOptimiseCoding",Z);if(x.defined(J.mozjpeg))if(x.bool(J.mozjpeg)){if(J.mozjpeg)this.options.jpegTrellisQuantisation=!0,this.options.jpegOvershootDeringing=!0,this.options.jpegOptimiseScans=!0,this.options.jpegProgressive=!0,this.options.jpegQuantisationTable=3}else throw x.invalidParameterError("mozjpeg","boolean",J.mozjpeg);let $=x.bool(J.trellisQuantization)?J.trellisQuantization:J.trellisQuantisation;if(x.defined($))this._setBooleanOption("jpegTrellisQuantisation",$);if(x.defined(J.overshootDeringing))this._setBooleanOption("jpegOvershootDeringing",J.overshootDeringing);let W=x.bool(J.optimizeScans)?J.optimizeScans:J.optimiseScans;if(x.defined(W)){if(this._setBooleanOption("jpegOptimiseScans",W),W)this.options.jpegProgressive=!0}let Q=x.number(J.quantizationTable)?J.quantizationTable:J.quantisationTable;if(x.defined(Q))if(x.integer(Q)&&x.inRange(Q,0,8))this.options.jpegQuantisationTable=Q;else throw x.invalidParameterError("quantisationTable","integer between 0 and 8",Q)}return this._updateFormatOut("jpeg",J)}function aE(J){if(x.object(J)){if(x.defined(J.progressive))this._setBooleanOption("pngProgressive",J.progressive);if(x.defined(J.compressionLevel))if(x.integer(J.compressionLevel)&&x.inRange(J.compressionLevel,0,9))this.options.pngCompressionLevel=J.compressionLevel;else throw x.invalidParameterError("compressionLevel","integer between 0 and 9",J.compressionLevel);if(x.defined(J.adaptiveFiltering))this._setBooleanOption("pngAdaptiveFiltering",J.adaptiveFiltering);let Z=J.colours||J.colors;if(x.defined(Z))if(x.integer(Z)&&x.inRange(Z,2,256))this.options.pngBitdepth=xU(Z);else throw x.invalidParameterError("colours","integer between 2 and 256",Z);if(x.defined(J.palette))this._setBooleanOption("pngPalette",J.palette);else if([J.quality,J.effort,J.colours,J.colors,J.dither].some(x.defined))this._setBooleanOption("pngPalette",!0);if(this.options.pngPalette){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,0,100))this.options.pngQuality=J.quality;else throw x.invalidParameterError("quality","integer between 0 and 100",J.quality);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,1,10))this.options.pngEffort=J.effort;else throw x.invalidParameterError("effort","integer between 1 and 10",J.effort);if(x.defined(J.dither))if(x.number(J.dither)&&x.inRange(J.dither,0,1))this.options.pngDither=J.dither;else throw x.invalidParameterError("dither","number between 0.0 and 1.0",J.dither)}}return this._updateFormatOut("png",J)}function pE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.webpQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.alphaQuality))if(x.integer(J.alphaQuality)&&x.inRange(J.alphaQuality,0,100))this.options.webpAlphaQuality=J.alphaQuality;else throw x.invalidParameterError("alphaQuality","integer between 0 and 100",J.alphaQuality);if(x.defined(J.lossless))this._setBooleanOption("webpLossless",J.lossless);if(x.defined(J.nearLossless))this._setBooleanOption("webpNearLossless",J.nearLossless);if(x.defined(J.smartSubsample))this._setBooleanOption("webpSmartSubsample",J.smartSubsample);if(x.defined(J.smartDeblock))this._setBooleanOption("webpSmartDeblock",J.smartDeblock);if(x.defined(J.preset))if(x.string(J.preset)&&x.inArray(J.preset,["default","photo","picture","drawing","icon","text"]))this.options.webpPreset=J.preset;else throw x.invalidParameterError("preset","one of: default, photo, picture, drawing, icon, text",J.preset);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,0,6))this.options.webpEffort=J.effort;else throw x.invalidParameterError("effort","integer between 0 and 6",J.effort);if(x.defined(J.minSize))this._setBooleanOption("webpMinSize",J.minSize);if(x.defined(J.mixed))this._setBooleanOption("webpMixed",J.mixed)}return yY(J,this.options),this._updateFormatOut("webp",J)}function rE(J){if(x.object(J)){if(x.defined(J.reuse))this._setBooleanOption("gifReuse",J.reuse);if(x.defined(J.progressive))this._setBooleanOption("gifProgressive",J.progressive);let Z=J.colours||J.colors;if(x.defined(Z))if(x.integer(Z)&&x.inRange(Z,2,256))this.options.gifBitdepth=xU(Z);else throw x.invalidParameterError("colours","integer between 2 and 256",Z);if(x.defined(J.effort))if(x.number(J.effort)&&x.inRange(J.effort,1,10))this.options.gifEffort=J.effort;else throw x.invalidParameterError("effort","integer between 1 and 10",J.effort);if(x.defined(J.dither))if(x.number(J.dither)&&x.inRange(J.dither,0,1))this.options.gifDither=J.dither;else throw x.invalidParameterError("dither","number between 0.0 and 1.0",J.dither);if(x.defined(J.interFrameMaxError))if(x.number(J.interFrameMaxError)&&x.inRange(J.interFrameMaxError,0,32))this.options.gifInterFrameMaxError=J.interFrameMaxError;else throw x.invalidParameterError("interFrameMaxError","number between 0.0 and 32.0",J.interFrameMaxError);if(x.defined(J.interPaletteMaxError))if(x.number(J.interPaletteMaxError)&&x.inRange(J.interPaletteMaxError,0,256))this.options.gifInterPaletteMaxError=J.interPaletteMaxError;else throw x.invalidParameterError("interPaletteMaxError","number between 0.0 and 256.0",J.interPaletteMaxError);if(x.defined(J.keepDuplicateFrames))if(x.bool(J.keepDuplicateFrames))this._setBooleanOption("gifKeepDuplicateFrames",J.keepDuplicateFrames);else throw x.invalidParameterError("keepDuplicateFrames","boolean",J.keepDuplicateFrames)}return yY(J,this.options),this._updateFormatOut("gif",J)}function eE(J){if(!this.constructor.format.jp2k.output.buffer)throw _U();if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.jp2Quality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.lossless))if(x.bool(J.lossless))this.options.jp2Lossless=J.lossless;else throw x.invalidParameterError("lossless","boolean",J.lossless);if(x.defined(J.tileWidth))if(x.integer(J.tileWidth)&&x.inRange(J.tileWidth,1,32768))this.options.jp2TileWidth=J.tileWidth;else throw x.invalidParameterError("tileWidth","integer between 1 and 32768",J.tileWidth);if(x.defined(J.tileHeight))if(x.integer(J.tileHeight)&&x.inRange(J.tileHeight,1,32768))this.options.jp2TileHeight=J.tileHeight;else throw x.invalidParameterError("tileHeight","integer between 1 and 32768",J.tileHeight);if(x.defined(J.chromaSubsampling))if(x.string(J.chromaSubsampling)&&x.inArray(J.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jp2ChromaSubsampling=J.chromaSubsampling;else throw x.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",J.chromaSubsampling)}return this._updateFormatOut("jp2",J)}function yY(J,Z){if(x.object(J)&&x.defined(J.loop))if(x.integer(J.loop)&&x.inRange(J.loop,0,65535))Z.loop=J.loop;else throw x.invalidParameterError("loop","integer between 0 and 65535",J.loop);if(x.object(J)&&x.defined(J.delay))if(x.integer(J.delay)&&x.inRange(J.delay,0,65535))Z.delay=[J.delay];else if(Array.isArray(J.delay)&&J.delay.every(x.integer)&&J.delay.every(($)=>x.inRange($,0,65535)))Z.delay=J.delay;else throw x.invalidParameterError("delay","integer or an array of integers between 0 and 65535",J.delay)}function nE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.tiffQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.bitdepth))if(x.integer(J.bitdepth)&&x.inArray(J.bitdepth,[1,2,4,8]))this.options.tiffBitdepth=J.bitdepth;else throw x.invalidParameterError("bitdepth","1, 2, 4 or 8",J.bitdepth);if(x.defined(J.tile))this._setBooleanOption("tiffTile",J.tile);if(x.defined(J.tileWidth))if(x.integer(J.tileWidth)&&J.tileWidth>0)this.options.tiffTileWidth=J.tileWidth;else throw x.invalidParameterError("tileWidth","integer greater than zero",J.tileWidth);if(x.defined(J.tileHeight))if(x.integer(J.tileHeight)&&J.tileHeight>0)this.options.tiffTileHeight=J.tileHeight;else throw x.invalidParameterError("tileHeight","integer greater than zero",J.tileHeight);if(x.defined(J.miniswhite))this._setBooleanOption("tiffMiniswhite",J.miniswhite);if(x.defined(J.pyramid))this._setBooleanOption("tiffPyramid",J.pyramid);if(x.defined(J.xres))if(x.number(J.xres)&&J.xres>0)this.options.tiffXres=J.xres;else throw x.invalidParameterError("xres","number greater than zero",J.xres);if(x.defined(J.yres))if(x.number(J.yres)&&J.yres>0)this.options.tiffYres=J.yres;else throw x.invalidParameterError("yres","number greater than zero",J.yres);if(x.defined(J.compression))if(x.string(J.compression)&&x.inArray(J.compression,["none","jpeg","deflate","packbits","ccittfax4","lzw","webp","zstd","jp2k"]))this.options.tiffCompression=J.compression;else throw x.invalidParameterError("compression","one of: none, jpeg, deflate, packbits, ccittfax4, lzw, webp, zstd, jp2k",J.compression);if(x.defined(J.predictor))if(x.string(J.predictor)&&x.inArray(J.predictor,["none","horizontal","float"]))this.options.tiffPredictor=J.predictor;else throw x.invalidParameterError("predictor","one of: none, horizontal, float",J.predictor);if(x.defined(J.resolutionUnit))if(x.string(J.resolutionUnit)&&x.inArray(J.resolutionUnit,["inch","cm"]))this.options.tiffResolutionUnit=J.resolutionUnit;else throw x.invalidParameterError("resolutionUnit","one of: inch, cm",J.resolutionUnit)}return this._updateFormatOut("tiff",J)}function sE(J){return this.heif({...J,compression:"av1"})}function iE(J){if(x.object(J)){if(x.string(J.compression)&&x.inArray(J.compression,["av1","hevc"]))this.options.heifCompression=J.compression;else throw x.invalidParameterError("compression","one of: av1, hevc",J.compression);if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.heifQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.lossless))if(x.bool(J.lossless))this.options.heifLossless=J.lossless;else throw x.invalidParameterError("lossless","boolean",J.lossless);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,0,9))this.options.heifEffort=J.effort;else throw x.invalidParameterError("effort","integer between 0 and 9",J.effort);if(x.defined(J.chromaSubsampling))if(x.string(J.chromaSubsampling)&&x.inArray(J.chromaSubsampling,["4:2:0","4:4:4"]))this.options.heifChromaSubsampling=J.chromaSubsampling;else throw x.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",J.chromaSubsampling);if(x.defined(J.bitdepth))if(x.integer(J.bitdepth)&&x.inArray(J.bitdepth,[8,10,12])){if(J.bitdepth!==8&&this.constructor.versions.heif)throw x.invalidParameterError("bitdepth when using prebuilt binaries",8,J.bitdepth);this.options.heifBitdepth=J.bitdepth}else throw x.invalidParameterError("bitdepth","8, 10 or 12",J.bitdepth)}else throw x.invalidParameterError("options","Object",J);return this._updateFormatOut("heif",J)}function tE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.jxlDistance=J.quality>=30?0.1+(100-J.quality)*0.09:0.017666666666666667*J.quality*J.quality-1.15*J.quality+25;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);else if(x.defined(J.distance))if(x.number(J.distance)&&x.inRange(J.distance,0,15))this.options.jxlDistance=J.distance;else throw x.invalidParameterError("distance","number between 0.0 and 15.0",J.distance);if(x.defined(J.decodingTier))if(x.integer(J.decodingTier)&&x.inRange(J.decodingTier,0,4))this.options.jxlDecodingTier=J.decodingTier;else throw x.invalidParameterError("decodingTier","integer between 0 and 4",J.decodingTier);if(x.defined(J.lossless))if(x.bool(J.lossless))this.options.jxlLossless=J.lossless;else throw x.invalidParameterError("lossless","boolean",J.lossless);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,1,9))this.options.jxlEffort=J.effort;else throw x.invalidParameterError("effort","integer between 1 and 9",J.effort)}return yY(J,this.options),this._updateFormatOut("jxl",J)}function oE(J){if(x.object(J)){if(x.defined(J.depth))if(x.string(J.depth)&&x.inArray(J.depth,["char","uchar","short","ushort","int","uint","float","complex","double","dpcomplex"]))this.options.rawDepth=J.depth;else throw x.invalidParameterError("depth","one of: char, uchar, short, ushort, int, uint, float, complex, double, dpcomplex",J.depth)}return this._updateFormatOut("raw")}function JL(J){if(x.object(J)){if(x.defined(J.size))if(x.integer(J.size)&&x.inRange(J.size,1,8192))this.options.tileSize=J.size;else throw x.invalidParameterError("size","integer between 1 and 8192",J.size);if(x.defined(J.overlap))if(x.integer(J.overlap)&&x.inRange(J.overlap,0,8192)){if(J.overlap>this.options.tileSize)throw x.invalidParameterError("overlap",`<= size (${this.options.tileSize})`,J.overlap);this.options.tileOverlap=J.overlap}else throw x.invalidParameterError("overlap","integer between 0 and 8192",J.overlap);if(x.defined(J.container))if(x.string(J.container)&&x.inArray(J.container,["fs","zip"]))this.options.tileContainer=J.container;else throw x.invalidParameterError("container","one of: fs, zip",J.container);if(x.defined(J.layout))if(x.string(J.layout)&&x.inArray(J.layout,["dz","google","iiif","iiif3","zoomify"]))this.options.tileLayout=J.layout;else throw x.invalidParameterError("layout","one of: dz, google, iiif, iiif3, zoomify",J.layout);if(x.defined(J.angle))if(x.integer(J.angle)&&!(J.angle%90))this.options.tileAngle=J.angle;else throw x.invalidParameterError("angle","positive/negative multiple of 90",J.angle);if(this._setBackgroundColourOption("tileBackground",J.background),x.defined(J.depth))if(x.string(J.depth)&&x.inArray(J.depth,["onepixel","onetile","one"]))this.options.tileDepth=J.depth;else throw x.invalidParameterError("depth","one of: onepixel, onetile, one",J.depth);if(x.defined(J.skipBlanks))if(x.integer(J.skipBlanks)&&x.inRange(J.skipBlanks,-1,65535))this.options.tileSkipBlanks=J.skipBlanks;else throw x.invalidParameterError("skipBlanks","integer between -1 and 255/65535",J.skipBlanks);else if(x.defined(J.layout)&&J.layout==="google")this.options.tileSkipBlanks=5;let Z=x.bool(J.center)?J.center:J.centre;if(x.defined(Z))this._setBooleanOption("tileCentre",Z);if(x.defined(J.id))if(x.string(J.id))this.options.tileId=J.id;else throw x.invalidParameterError("id","string",J.id);if(x.defined(J.basename))if(x.string(J.basename))this.options.tileBasename=J.basename;else throw x.invalidParameterError("basename","string",J.basename)}if(x.inArray(this.options.formatOut,["jpeg","png","webp"]))this.options.tileFormat=this.options.formatOut;else if(this.options.formatOut!=="input")throw x.invalidParameterError("format","one of: jpeg, png, webp",this.options.formatOut);return this._updateFormatOut("dz")}function $L(J){if(!x.plainObject(J))throw x.invalidParameterError("options","object",J);if(x.integer(J.seconds)&&x.inRange(J.seconds,0,3600))this.options.timeoutSeconds=J.seconds;else throw x.invalidParameterError("seconds","integer between 0 and 3600",J.seconds);return this}function ZL(J,Z){if(!(x.object(Z)&&Z.force===!1))this.options.formatOut=J;return this}function WL(J,Z){if(x.bool(Z))this.options[J]=Z;else throw x.invalidParameterError(J,"boolean",Z)}function QL(){if(!this.options.streamOut){this.options.streamOut=!0;let J=Error();this._pipeline(void 0,J)}}function KL(J,Z){if(typeof J==="function"){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),z5.pipeline(this.options,($,W,Q)=>{if($)J(x.nativeError($,Z));else J(null,W,Q)})});else z5.pipeline(this.options,($,W,Q)=>{if($)J(x.nativeError($,Z));else J(null,W,Q)});return this}else if(this.options.streamOut){if(this._isStreamInput()){if(this.once("finish",()=>{this._flattenBufferIn(),z5.pipeline(this.options,($,W,Q)=>{if($)this.emit("error",x.nativeError($,Z));else this.emit("info",Q),this.push(W);this.push(null),this.on("end",()=>this.emit("close"))})}),this.streamInFinished)this.emit("finish")}else z5.pipeline(this.options,($,W,Q)=>{if($)this.emit("error",x.nativeError($,Z));else this.emit("info",Q),this.push(W);this.push(null),this.on("end",()=>this.emit("close"))});return this}else if(this._isStreamInput())return new Promise(($,W)=>{this.once("finish",()=>{this._flattenBufferIn(),z5.pipeline(this.options,(Q,Y,H)=>{if(Q)W(x.nativeError(Q,Z));else if(this.options.resolveWithObject)$({data:Y,info:H});else $(Y)})})});else return new Promise(($,W)=>{z5.pipeline(this.options,(Q,Y,H)=>{if(Q)W(x.nativeError(Q,Z));else if(this.options.resolveWithObject)$({data:Y,info:H});else $(Y)})})}yU.exports=function(J){Object.assign(J.prototype,{toFile:xE,toBuffer:yE,keepExif:vE,withExif:OE,withExifMerge:bE,keepIccProfile:hE,withIccProfile:fE,keepXmp:dE,withXmp:uE,keepMetadata:gE,withMetadata:lE,toFormat:cE,jpeg:mE,jp2:eE,png:aE,webp:pE,tiff:nE,avif:sE,heif:iE,jxl:tE,gif:rE,raw:oE,tile:JL,timeout:$L,_updateFormatOut:ZL,_setBooleanOption:WL,_read:QL,_pipeline:KL})}});var fU=J6((jB,hU)=>{var YL=b6("node:events"),K8=aZ(),y4=i4(),{runtimePlatformArch:GL}=DY(),F4=p5(),OU=GL(),vY=F4.libvipsVersion(),MJ=F4.format();MJ.heif.output.alias=["avif","heic"];MJ.jpeg.output.alias=["jpe","jpg"];MJ.tiff.output.alias=["tif"];MJ.jp2k.output.alias=["j2c","j2k","jp2","jpx"];var XL={nearest:"nearest",bilinear:"bilinear",bicubic:"bicubic",locallyBoundedBicubic:"lbb",nohalo:"nohalo",vertexSplitQuadraticBasisSpline:"vsqbs"},E5={vips:vY.semver};if(!vY.isGlobal)if(!vY.isWasm)try{E5=b6(`@img/sharp-${OU}/versions`)}catch(J){try{E5=b6(`@img/sharp-libvips-${OU}/versions`)}catch(Z){}}else try{E5=(()=>{throw new Error("Cannot require module "+"@img/sharp-wasm32/versions");})()}catch(J){}E5.sharp=RY().version;if(E5.heif&&MJ.heif)MJ.heif.input.fileSuffix=[".avif"],MJ.heif.output.alias=["avif"];function bU(J){if(y4.bool(J))if(J)return F4.cache(50,20,100);else return F4.cache(0,0,0);else if(y4.object(J))return F4.cache(J.memory,J.files,J.items);else return F4.cache()}bU(!0);function qL(J){return F4.concurrency(y4.integer(J)?J:null)}if(K8.familySync()===K8.GLIBC&&!F4._isUsingJemalloc())F4.concurrency(1);else if(K8.familySync()===K8.MUSL&&F4.concurrency()===1024)F4.concurrency(b6("node:os").availableParallelism());var HL=new YL.EventEmitter;function UL(){return F4.counters()}function VL(J){return F4.simd(y4.bool(J)?J:null)}function NL(J){if(y4.object(J))if(Array.isArray(J.operation)&&J.operation.every(y4.string))F4.block(J.operation,!0);else throw y4.invalidParameterError("operation","Array<string>",J.operation);else throw y4.invalidParameterError("options","object",J)}function zL(J){if(y4.object(J))if(Array.isArray(J.operation)&&J.operation.every(y4.string))F4.block(J.operation,!1);else throw y4.invalidParameterError("operation","Array<string>",J.operation);else throw y4.invalidParameterError("options","object",J)}hU.exports=function(J){J.cache=bU,J.concurrency=qL,J.counters=UL,J.simd=VL,J.format=MJ,J.interpolators=XL,J.versions=E5,J.queue=HL,J.block=NL,J.unblock=zL}});var uU=J6((CB,dU)=>{var RJ=oH();ZU()(RJ);XU()(RJ);HU()(RJ);EU()(RJ);SU()(RJ);TU()(RJ);vU()(RJ);fU()(RJ);dU.exports=RJ});import*as EL from"node:fs";import*as LL from"node:path";import*as AL from"node:url";var JY={};HV(JY,{registerBackend:()=>iG,env:()=>NV,Tensor:()=>aJ,TRACE_FUNC_END:()=>yZ,TRACE_FUNC_BEGIN:()=>xZ,TRACE:()=>VX,InferenceSession:()=>zV});var _Z=new Map,cJ=[],iG=(J,Z,$)=>{if(Z&&typeof Z.init==="function"&&typeof Z.createInferenceSessionHandler==="function"){let W=_Z.get(J);if(W===void 0)_Z.set(J,{backend:Z,priority:$});else if(W.priority>$)return;else if(W.priority===$){if(W.backend!==Z)throw Error(`cannot register backend "${J}" using priority ${$}`)}if($>=0){let Q=cJ.indexOf(J);if(Q!==-1)cJ.splice(Q,1);for(let Y=0;Y<cJ.length;Y++)if(_Z.get(cJ[Y]).priority<=$){cJ.splice(Y,0,J);return}cJ.push(J)}return}throw TypeError("not a valid backend")},VV=async(J)=>{let Z=_Z.get(J);if(!Z)return"backend not found.";if(Z.initialized)return Z.backend;else if(Z.aborted)return Z.error;else{let $=!!Z.initPromise;try{if(!$)Z.initPromise=Z.backend.init(J);return await Z.initPromise,Z.initialized=!0,Z.backend}catch(W){if(!$)Z.error=`${W}`,Z.aborted=!0;return Z.error}finally{delete Z.initPromise}}},tG=async(J)=>{let Z=J.executionProviders||[],$=Z.map((q)=>typeof q==="string"?q:q.name),W=$.length===0?cJ:$,Q,Y=[],H=new Set;for(let q of W){let E=await VV(q);if(typeof E==="string")Y.push({name:q,err:E});else{if(!Q)Q=E;if(Q===E)H.add(q)}}if(!Q)throw Error(`no available backend found. ERR: ${Y.map((q)=>`[${q.name}] ${q.err}`).join(", ")}`);for(let{name:q,err:E}of Y)if($.includes(q))console.warn(`removing requested execution provider "${q}" from session options because it is not available: ${E}`);let G=Z.filter((q)=>H.has(typeof q==="string"?q:q.name));return[Q,new Proxy(J,{get:(q,E)=>{if(E==="executionProviders")return G;return Reflect.get(q,E)}})]};var oG="1.21.0";var JX="warning",M4={wasm:{},webgl:{},webgpu:{},versions:{common:oG},set logLevel(J){if(J===void 0)return;if(typeof J!=="string"||["verbose","info","warning","error","fatal"].indexOf(J)===-1)throw Error(`Unsupported logging level: ${J}`);JX=J},get logLevel(){return JX}};Object.defineProperty(M4,"logLevel",{enumerable:!0});var NV=M4;var $X=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);$.width=J.dims[3],$.height=J.dims[2];let W=$.getContext("2d");if(W!=null){let Q,Y;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")Q=J.dims[2],Y=J.dims[3];else Q=J.dims[3],Y=J.dims[2];let H=Z?.format!==void 0?Z.format:"RGB",G=Z?.norm,q,E;if(G===void 0||G.mean===void 0)q=[255,255,255,255];else if(typeof G.mean==="number")q=[G.mean,G.mean,G.mean,G.mean];else if(q=[G.mean[0],G.mean[1],G.mean[2],0],G.mean[3]!==void 0)q[3]=G.mean[3];if(G===void 0||G.bias===void 0)E=[0,0,0,0];else if(typeof G.bias==="number")E=[G.bias,G.bias,G.bias,G.bias];else if(E=[G.bias[0],G.bias[1],G.bias[2],0],G.bias[3]!==void 0)E[3]=G.bias[3];let V=Y*Q,N=0,z=V,w=V*2,R=-1;if(H==="RGBA")N=0,z=V,w=V*2,R=V*3;else if(H==="RGB")N=0,z=V,w=V*2;else if(H==="RBG")N=0,w=V,z=V*2;for(let y=0;y<Y;y++)for(let D=0;D<Q;D++){let j=(J.data[N++]-E[0])*q[0],v=(J.data[z++]-E[1])*q[1],g=(J.data[w++]-E[2])*q[2],A=R===-1?255:(J.data[R++]-E[3])*q[3];W.fillStyle="rgba("+j+","+v+","+g+","+A+")",W.fillRect(D,y,1,1)}if("toDataURL"in $)return $.toDataURL();else throw Error("toDataURL is not supported")}else throw Error("Can not access image data")},ZX=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),W;if($!=null){let Q,Y,H;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")Q=J.dims[2],Y=J.dims[1],H=J.dims[3];else Q=J.dims[3],Y=J.dims[2],H=J.dims[1];let G=Z!==void 0?Z.format!==void 0?Z.format:"RGB":"RGB",q=Z?.norm,E,V;if(q===void 0||q.mean===void 0)E=[255,255,255,255];else if(typeof q.mean==="number")E=[q.mean,q.mean,q.mean,q.mean];else if(E=[q.mean[0],q.mean[1],q.mean[2],255],q.mean[3]!==void 0)E[3]=q.mean[3];if(q===void 0||q.bias===void 0)V=[0,0,0,0];else if(typeof q.bias==="number")V=[q.bias,q.bias,q.bias,q.bias];else if(V=[q.bias[0],q.bias[1],q.bias[2],0],q.bias[3]!==void 0)V[3]=q.bias[3];let N=Y*Q;if(Z!==void 0){if(Z.format!==void 0&&H===4&&Z.format!=="RGBA"||H===3&&Z.format!=="RGB"&&Z.format!=="BGR")throw Error("Tensor format doesn't match input tensor dims")}let z=4,w=0,R=1,y=2,D=3,j=0,v=N,g=N*2,A=-1;if(G==="RGBA")j=0,v=N,g=N*2,A=N*3;else if(G==="RGB")j=0,v=N,g=N*2;else if(G==="RBG")j=0,g=N,v=N*2;W=$.createImageData(Q,Y);for(let T=0;T<Y*Q;w+=z,R+=z,y+=z,D+=z,T++)W.data[w]=(J.data[j++]-V[0])*E[0],W.data[R]=(J.data[v++]-V[1])*E[1],W.data[y]=(J.data[g++]-V[2])*E[2],W.data[D]=A===-1?255:(J.data[A++]-V[3])*E[3]}else throw Error("Can not access image data");return W};var oK=(J,Z)=>{if(J===void 0)throw Error("Image buffer must be defined");if(Z.height===void 0||Z.width===void 0)throw Error("Image height and width must be defined");if(Z.tensorLayout==="NHWC")throw Error("NHWC Tensor layout is not supported yet");let{height:$,width:W}=Z,Q=Z.norm??{mean:255,bias:0},Y,H;if(typeof Q.mean==="number")Y=[Q.mean,Q.mean,Q.mean,Q.mean];else Y=[Q.mean[0],Q.mean[1],Q.mean[2],Q.mean[3]??255];if(typeof Q.bias==="number")H=[Q.bias,Q.bias,Q.bias,Q.bias];else H=[Q.bias[0],Q.bias[1],Q.bias[2],Q.bias[3]??0];let G=Z.format!==void 0?Z.format:"RGBA",q=Z.tensorFormat!==void 0?Z.tensorFormat!==void 0?Z.tensorFormat:"RGB":"RGB",E=$*W,V=q==="RGBA"?new Float32Array(E*4):new Float32Array(E*3),N=4,z=0,w=1,R=2,y=3,D=0,j=E,v=E*2,g=-1;if(G==="RGB")N=3,z=0,w=1,R=2,y=-1;if(q==="RGBA")g=E*3;else if(q==="RBG")D=0,v=E,j=E*2;else if(q==="BGR")v=0,j=E,D=E*2;for(let T=0;T<E;T++,z+=N,R+=N,w+=N,y+=N)if(V[D++]=(J[z]+H[0])/Y[0],V[j++]=(J[w]+H[1])/Y[1],V[v++]=(J[R]+H[2])/Y[2],g!==-1&&y!==-1)V[g++]=(J[y]+H[3])/Y[3];return q==="RGBA"?new X4("float32",V,[1,4,$,W]):new X4("float32",V,[1,3,$,W])},WX=async(J,Z)=>{let $=typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement,W=typeof ImageData<"u"&&J instanceof ImageData,Q=typeof ImageBitmap<"u"&&J instanceof ImageBitmap,Y=typeof J==="string",H,G=Z??{},q=()=>{if(typeof document<"u")return document.createElement("canvas");else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);else throw Error("Canvas is not supported")},E=(V)=>{if(typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement)return V.getContext("2d");else if(V instanceof OffscreenCanvas)return V.getContext("2d");else return null};if($){let V=q();V.width=J.width,V.height=J.height;let N=E(V);if(N!=null){let{height:z,width:w}=J;if(Z!==void 0&&Z.resizedHeight!==void 0&&Z.resizedWidth!==void 0)z=Z.resizedHeight,w=Z.resizedWidth;if(Z!==void 0){if(G=Z,Z.tensorFormat!==void 0)throw Error("Image input config format must be RGBA for HTMLImageElement");else G.tensorFormat="RGBA";G.height=z,G.width=w}else G.tensorFormat="RGBA",G.height=z,G.width=w;N.drawImage(J,0,0),H=N.getImageData(0,0,w,z).data}else throw Error("Can not access image data")}else if(W){let V,N;if(Z!==void 0&&Z.resizedWidth!==void 0&&Z.resizedHeight!==void 0)V=Z.resizedHeight,N=Z.resizedWidth;else V=J.height,N=J.width;if(Z!==void 0)G=Z;if(G.format="RGBA",G.height=V,G.width=N,Z!==void 0){let z=q();z.width=N,z.height=V;let w=E(z);if(w!=null)w.putImageData(J,0,0),H=w.getImageData(0,0,N,V).data;else throw Error("Can not access image data")}else H=J.data}else if(Q){if(Z===void 0)throw Error("Please provide image config with format for Imagebitmap");let V=q();V.width=J.width,V.height=J.height;let N=E(V);if(N!=null){let{height:z,width:w}=J;return N.drawImage(J,0,0,w,z),H=N.getImageData(0,0,w,z).data,G.height=z,G.width=w,oK(H,G)}else throw Error("Can not access image data")}else if(Y)return new Promise((V,N)=>{let z=q(),w=E(z);if(!J||!w)return N();let R=new Image;R.crossOrigin="Anonymous",R.src=J,R.onload=()=>{z.width=R.width,z.height=R.height,w.drawImage(R,0,0,z.width,z.height);let y=w.getImageData(0,0,z.width,z.height);G.height=z.height,G.width=z.width,V(oK(y.data,G))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(H!==void 0)return oK(H,G);else throw Error("Input data provided is not supported - aborted tensor creation")},QX=(J,Z)=>{let{width:$,height:W,download:Q,dispose:Y}=Z;return new X4({location:"texture",type:"float32",texture:J,dims:[1,W,$,4],download:Q,dispose:Y})},KX=(J,Z)=>{let{dataType:$,dims:W,download:Q,dispose:Y}=Z;return new X4({location:"gpu-buffer",type:$??"float32",gpuBuffer:J,dims:W,download:Q,dispose:Y})},YX=(J,Z)=>{let{dataType:$,dims:W,download:Q,dispose:Y}=Z;return new X4({location:"ml-tensor",type:$??"float32",mlTensor:J,dims:W,download:Q,dispose:Y})},GX=(J,Z,$)=>new X4({location:"cpu-pinned",type:J,data:Z,dims:$??[Z.length]});var mJ=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),b5=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),XX=!1,qX=()=>{if(!XX){XX=!0;let J=typeof BigInt64Array<"u"&&BigInt64Array.from,Z=typeof BigUint64Array<"u"&&BigUint64Array.from,$=globalThis.Float16Array,W=typeof $<"u"&&$.from;if(J)mJ.set("int64",BigInt64Array),b5.set(BigInt64Array,"int64");if(Z)mJ.set("uint64",BigUint64Array),b5.set(BigUint64Array,"uint64");if(W)mJ.set("float16",$),b5.set($,"float16");else mJ.set("float16",Uint16Array)}};var HX=(J)=>{let Z=1;for(let $=0;$<J.length;$++){let W=J[$];if(typeof W!=="number"||!Number.isSafeInteger(W))throw TypeError(`dims[${$}] must be an integer, got: ${W}`);if(W<0)throw RangeError(`dims[${$}] must be a non-negative integer, got: ${W}`);Z*=W}return Z},UX=(J,Z)=>{switch(J.location){case"cpu":return new X4(J.type,J.data,Z);case"cpu-pinned":return new X4({location:"cpu-pinned",data:J.data,type:J.type,dims:Z});case"texture":return new X4({location:"texture",texture:J.texture,type:J.type,dims:Z});case"gpu-buffer":return new X4({location:"gpu-buffer",gpuBuffer:J.gpuBuffer,type:J.type,dims:Z});case"ml-tensor":return new X4({location:"ml-tensor",mlTensor:J.mlTensor,type:J.type,dims:Z});default:throw Error(`tensorReshape: tensor location ${J.location} is not supported`)}};class X4{constructor(J,Z,$){qX();let W,Q;if(typeof J==="object"&&"location"in J)switch(this.dataLocation=J.location,W=J.type,Q=J.dims,J.location){case"cpu-pinned":{let H=mJ.get(W);if(!H)throw TypeError(`unsupported type "${W}" to create tensor from pinned buffer`);if(!(J.data instanceof H))throw TypeError(`buffer should be of type ${H.name}`);this.cpuData=J.data;break}case"texture":{if(W!=="float32")throw TypeError(`unsupported type "${W}" to create tensor from texture`);this.gpuTextureData=J.texture,this.downloader=J.download,this.disposer=J.dispose;break}case"gpu-buffer":{if(W!=="float32"&&W!=="float16"&&W!=="int32"&&W!=="int64"&&W!=="uint32"&&W!=="uint8"&&W!=="bool"&&W!=="uint4"&&W!=="int4")throw TypeError(`unsupported type "${W}" to create tensor from gpu buffer`);this.gpuBufferData=J.gpuBuffer,this.downloader=J.download,this.disposer=J.dispose;break}case"ml-tensor":{if(W!=="float32"&&W!=="float16"&&W!=="int32"&&W!=="int64"&&W!=="uint32"&&W!=="uint64"&&W!=="int8"&&W!=="uint8"&&W!=="bool"&&W!=="uint4"&&W!=="int4")throw TypeError(`unsupported type "${W}" to create tensor from MLTensor`);this.mlTensorData=J.mlTensor,this.downloader=J.download,this.disposer=J.dispose;break}default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let H,G;if(typeof J==="string")if(W=J,G=$,J==="string"){if(!Array.isArray(Z))throw TypeError("A string tensor's data must be a string array.");H=Z}else{let q=mJ.get(J);if(q===void 0)throw TypeError(`Unsupported tensor type: ${J}.`);if(Array.isArray(Z))if(J==="float16"&&q===Uint16Array||J==="uint4"||J==="int4")throw TypeError(`Creating a ${J} tensor from number array is not supported. Please use ${q.name} as data.`);else if(J==="uint64"||J==="int64")H=q.from(Z,BigInt);else H=q.from(Z);else if(Z instanceof q)H=Z;else if(Z instanceof Uint8ClampedArray)if(J==="uint8")H=Uint8Array.from(Z);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(J==="float16"&&Z instanceof Uint16Array&&q!==Uint16Array)H=new globalThis.Float16Array(Z.buffer,Z.byteOffset,Z.length);else throw TypeError(`A ${W} tensor's data must be type of ${q}`)}else if(G=Z,Array.isArray(J)){if(J.length===0)throw TypeError("Tensor type cannot be inferred from an empty array.");let q=typeof J[0];if(q==="string")W="string",H=J;else if(q==="boolean")W="bool",H=Uint8Array.from(J);else throw TypeError(`Invalid element type of data array: ${q}.`)}else if(J instanceof Uint8ClampedArray)W="uint8",H=Uint8Array.from(J);else{let q=b5.get(J.constructor);if(q===void 0)throw TypeError(`Unsupported type for tensor data: ${J.constructor}.`);W=q,H=J}if(G===void 0)G=[H.length];else if(!Array.isArray(G))throw TypeError("A tensor's dims must be a number array");Q=G,this.cpuData=H,this.dataLocation="cpu"}let Y=HX(Q);if(this.cpuData&&Y!==this.cpuData.length)if((W==="uint4"||W==="int4")&&Math.ceil(Y/2)===this.cpuData.length);else throw Error(`Tensor's size(${Y}) does not match data length(${this.cpuData.length}).`);this.type=W,this.dims=Q,this.size=Y}static async fromImage(J,Z){return WX(J,Z)}static fromTexture(J,Z){return QX(J,Z)}static fromGpuBuffer(J,Z){return KX(J,Z)}static fromMLTensor(J,Z){return YX(J,Z)}static fromPinnedBuffer(J,Z,$){return GX(J,Z,$)}toDataURL(J){return $X(this,J)}toImageData(J){return ZX(this,J)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(J){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let Z=await this.downloader();if(this.downloader=void 0,this.dataLocation="cpu",this.cpuData=Z,J&&this.disposer)this.disposer(),this.disposer=void 0;return Z}finally{this.isDownloading=!1}}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");if(this.disposer)this.disposer(),this.disposer=void 0;this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw Error("The tensor is disposed.")}reshape(J){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return UX(this,J)}}var aJ=X4;var VX=(J,Z)=>{if(typeof M4.trace>"u"?!M4.wasm.trace:!M4.trace)return;console.timeStamp(`${J}::ORT::${Z}`)},NX=(J,Z)=>{let $=Error().stack?.split(/\r\n|\r|\n/g)||[],W=!1;for(let Q=0;Q<$.length;Q++){if(W&&!$[Q].includes("TRACE_FUNC")){let Y=`FUNC_${J}::${$[Q].trim().split(" ")[1]}`;if(Z)Y+=`::${Z}`;VX("CPU",Y);return}if($[Q].includes("TRACE_FUNC"))W=!0}},xZ=(J)=>{if(typeof M4.trace>"u"?!M4.wasm.trace:!M4.trace)return;NX("BEGIN",J)},yZ=(J)=>{if(typeof M4.trace>"u"?!M4.wasm.trace:!M4.trace)return;NX("END",J)};class vZ{constructor(J){this.handler=J}async run(J,Z,$){xZ();let W={},Q={};if(typeof J!=="object"||J===null||J instanceof aJ||Array.isArray(J))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let Y=!0;if(typeof Z==="object"){if(Z===null)throw TypeError("Unexpected argument[1]: cannot be null.");if(Z instanceof aJ)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(Z)){if(Z.length===0)throw TypeError("'fetches' cannot be an empty array.");Y=!1;for(let q of Z){if(typeof q!=="string")throw TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(q)===-1)throw RangeError(`'fetches' contains invalid output name: ${q}.`);W[q]=null}if(typeof $==="object"&&$!==null)Q=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else{let q=!1,E=Object.getOwnPropertyNames(Z);for(let V of this.outputNames)if(E.indexOf(V)!==-1){let N=Z[V];if(N===null||N instanceof aJ)q=!0,Y=!1,W[V]=N}if(q){if(typeof $==="object"&&$!==null)Q=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else Q=Z}}else if(typeof Z<"u")throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let q of this.inputNames)if(typeof J[q]>"u")throw Error(`input '${q}' is missing in 'feeds'.`);if(Y)for(let q of this.outputNames)W[q]=null;let H=await this.handler.run(J,W,Q),G={};for(let q in H)if(Object.hasOwnProperty.call(H,q)){let E=H[q];if(E instanceof aJ)G[q]=E;else G[q]=new aJ(E.type,E.data,E.dims)}return yZ(),G}async release(){return this.handler.dispose()}static async create(J,Z,$,W){xZ();let Q,Y={};if(typeof J==="string"){if(Q=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof Uint8Array){if(Q=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&J instanceof SharedArrayBuffer){let E=J,V=0,N=J.byteLength;if(typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z==="number"){if(V=Z,!Number.isSafeInteger(V))throw RangeError("'byteOffset' must be an integer.");if(V<0||V>=E.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${E.byteLength}).`);if(N=J.byteLength-V,typeof $==="number"){if(N=$,!Number.isSafeInteger(N))throw RangeError("'byteLength' must be an integer.");if(N<=0||V+N>E.byteLength)throw RangeError(`'byteLength' is out of range (0, ${E.byteLength-V}].`);if(typeof W==="object"&&W!==null)Y=W;else if(typeof W<"u")throw TypeError("'options' must be an object.")}else if(typeof $<"u")throw TypeError("'byteLength' must be a number.")}else if(typeof Z<"u")throw TypeError("'options' must be an object.");Q=new Uint8Array(E,V,N)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[H,G]=await tG(Y),q=await H.createInferenceSessionHandler(Q,G);return yZ(),new vZ(q)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}var zV=vZ;var BL=sG(Iq(),1),FL=sG(uU(),1),__dirname="/Users/kyle/rules/node_modules/@huggingface/transformers/dist",RL={"node:fs":(J)=>{/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/J.exports=EL},"node:path":(J)=>{/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/J.exports=LL},"node:url":(J)=>{/*!***************************!*\
  !*** external "node:url" ***!
  \***************************/J.exports=AL},"onnxruntime-common":(J)=>{/*!*************************************!*\
  !*** external "onnxruntime-common" ***!
  \*************************************/J.exports=JY},"onnxruntime-node":(J)=>{/*!***********************************!*\
  !*** external "onnxruntime-node" ***!
  \***********************************/J.exports=BL},sharp:(J)=>{/*!************************!*\
  !*** external "sharp" ***!
  \************************/J.exports=FL},"?8b6b":()=>{/*!*********************************!*\
  !*** onnxruntime-web (ignored) ***!
  \*********************************/},"./node_modules/@huggingface/jinja/dist/index.js":(J,Z,$)=>{/*!*******************************************************!*\
  !*** ./node_modules/@huggingface/jinja/dist/index.js ***!
  \*******************************************************/$.r(Z),$.d(Z,{Environment:()=>y0,Interpreter:()=>a0,Template:()=>YJ,parse:()=>A0,tokenize:()=>V});var W=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),Q=class{constructor(L,u){this.value=L,this.type=u}};function Y(L){return/\w/.test(L)}function H(L){return/[0-9]/.test(L)}var G=[["{%",W.OpenStatement],["%}",W.CloseStatement],["{{",W.OpenExpression],["}}",W.CloseExpression],["(",W.OpenParen],[")",W.CloseParen],["{",W.OpenCurlyBracket],["}",W.CloseCurlyBracket],["[",W.OpenSquareBracket],["]",W.CloseSquareBracket],[",",W.Comma],[".",W.Dot],[":",W.Colon],["|",W.Pipe],["<=",W.ComparisonBinaryOperator],[">=",W.ComparisonBinaryOperator],["==",W.ComparisonBinaryOperator],["!=",W.ComparisonBinaryOperator],["<",W.ComparisonBinaryOperator],[">",W.ComparisonBinaryOperator],["+",W.AdditiveBinaryOperator],["-",W.AdditiveBinaryOperator],["~",W.AdditiveBinaryOperator],["*",W.MultiplicativeBinaryOperator],["/",W.MultiplicativeBinaryOperator],["%",W.MultiplicativeBinaryOperator],["=",W.Equals]],q=new Map([["n",`
`],["t","\t"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function E(L,u={}){if(L.endsWith(`
`))L=L.slice(0,-1);if(u.lstrip_blocks)L=L.replace(/^[ \t]*({[#%-])/gm,"$1");if(u.trim_blocks)L=L.replace(/([#%-]})\n/g,"$1");return L.replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{").replace(/-#}\s*/g,"#}").replace(/\s*{#-/g,"{#").replace(/{%\s*(end)?generation\s*%}/gs,"")}function V(L,u={}){let C=[],f=E(L,u),r=0,G0=0,L0=(c0)=>{let t0="";while(c0(f[r])){if(f[r]==="\\"){if(++r,r>=f.length)throw SyntaxError("Unexpected end of input");let v0=f[r++],V6=q.get(v0);if(V6===void 0)throw SyntaxError(`Unexpected escaped character: ${v0}`);t0+=V6;continue}if(t0+=f[r++],r>=f.length)throw SyntaxError("Unexpected end of input")}return t0};J:while(r<f.length){let c0=C.at(-1)?.type;if(c0===void 0||c0===W.CloseStatement||c0===W.CloseExpression||c0===W.Comment){let v0="";while(r<f.length&&!(f[r]==="{"&&(f[r+1]==="%"||f[r+1]==="{"||f[r+1]==="#")))v0+=f[r++];if(v0.length>0){C.push(new Q(v0,W.Text));continue}}if(f[r]==="{"&&f[r+1]==="#"){r+=2;let v0="";while(f[r]!=="#"||f[r+1]!=="}"){if(r+2>=f.length)throw SyntaxError("Missing end of comment tag");v0+=f[r++]}C.push(new Q(v0,W.Comment)),r+=2;continue}L0((v0)=>/\s/.test(v0));let t0=f[r];if(t0==="-"||t0==="+"){let v0=C.at(-1)?.type;if(v0===W.Text||v0===void 0)throw SyntaxError(`Unexpected character: ${t0}`);switch(v0){case W.Identifier:case W.NumericLiteral:case W.StringLiteral:case W.CloseParen:case W.CloseSquareBracket:break;default:{++r;let V6=L0(H);C.push(new Q(`${t0}${V6}`,V6.length>0?W.NumericLiteral:W.UnaryOperator));continue}}}for(let[v0,V6]of G){if(v0==="}}"&&G0>0)continue;if(f.slice(r,r+v0.length)===v0){if(C.push(new Q(v0,V6)),V6===W.OpenExpression)G0=0;else if(V6===W.OpenCurlyBracket)++G0;else if(V6===W.CloseCurlyBracket)--G0;r+=v0.length;continue J}}if(t0==="'"||t0==='"'){++r;let v0=L0((V6)=>V6!==t0);C.push(new Q(v0,W.StringLiteral)),++r;continue}if(H(t0)){let v0=L0(H);if(f[r]==="."&&H(f[r+1])){++r;let V6=L0(H);v0=`${v0}.${V6}`}C.push(new Q(v0,W.NumericLiteral));continue}if(Y(t0)){let v0=L0(Y);C.push(new Q(v0,W.Identifier));continue}throw SyntaxError(`Unexpected character: ${t0}`)}return C}var N=class{type="Statement"},z=class extends N{constructor(L){super();this.body=L}type="Program"},w=class extends N{constructor(L,u,C){super();this.test=L,this.body=u,this.alternate=C}type="If"},R=class extends N{constructor(L,u,C,f){super();this.loopvar=L,this.iterable=u,this.body=C,this.defaultBlock=f}type="For"},y=class extends N{type="Break"},D=class extends N{type="Continue"},j=class extends N{constructor(L,u,C){super();this.assignee=L,this.value=u,this.body=C}type="Set"},v=class extends N{constructor(L,u,C){super();this.name=L,this.args=u,this.body=C}type="Macro"},g=class extends N{constructor(L){super();this.value=L}type="Comment"},A=class extends N{type="Expression"},T=class extends A{constructor(L,u,C){super();this.object=L,this.property=u,this.computed=C}type="MemberExpression"},B=class extends A{constructor(L,u){super();this.callee=L,this.args=u}type="CallExpression"},F=class extends A{constructor(L){super();this.value=L}type="Identifier"},P=class extends A{constructor(L){super();this.value=L}type="Literal"},_=class extends P{type="IntegerLiteral"},h=class extends P{type="FloatLiteral"},c=class extends P{type="StringLiteral"},m=class extends P{type="ArrayLiteral"},d=class extends P{type="TupleLiteral"},a=class extends P{type="ObjectLiteral"},n=class extends A{constructor(L,u,C){super();this.operator=L,this.left=u,this.right=C}type="BinaryExpression"},t=class extends A{constructor(L,u){super();this.operand=L,this.filter=u}type="FilterExpression"},W0=class extends N{constructor(L,u){super();this.filter=L,this.body=u}type="FilterStatement"},o=class extends A{constructor(L,u){super();this.lhs=L,this.test=u}type="SelectExpression"},N0=class extends A{constructor(L,u,C){super();this.operand=L,this.negate=u,this.test=C}type="TestExpression"},w0=class extends A{constructor(L,u){super();this.operator=L,this.argument=u}type="UnaryExpression"},I=class extends A{constructor(L=void 0,u=void 0,C=void 0){super();this.start=L,this.stop=u,this.step=C}type="SliceExpression"},O=class extends A{constructor(L,u){super();this.key=L,this.value=u}type="KeywordArgumentExpression"},p=class extends A{constructor(L){super();this.argument=L}type="SpreadExpression"},Z0=class extends N{constructor(L,u,C){super();this.call=L,this.callerArgs=u,this.body=C}type="CallStatement"},z0=class extends A{constructor(L,u,C){super();this.condition=L,this.trueExpr=u,this.falseExpr=C}type="Ternary"};function A0(L){let u=new z([]),C=0;function f(P0,S0){let m0=L[C++];if(!m0||m0.type!==P0)throw Error(`Parser Error: ${S0}. ${m0.type} !== ${P0}.`);return m0}function r(P0){if(!t0(P0))throw SyntaxError(`Expected ${P0}`);++C}function G0(){switch(L[C].type){case W.Comment:return new g(L[C++].value);case W.Text:return v0();case W.OpenStatement:return V6();case W.OpenExpression:return E6();default:throw SyntaxError(`Unexpected token type: ${L[C].type}`)}}function L0(...P0){return C+P0.length<=L.length&&P0.every((S0,m0)=>S0===L[C+m0].type)}function c0(...P0){return L[C]?.type===W.OpenStatement&&L[C+1]?.type===W.Identifier&&P0.includes(L[C+1]?.value)}function t0(...P0){return C+P0.length<=L.length&&P0.every((S0,m0)=>L[C+m0].type==="Identifier"&&S0===L[C+m0].value)}function v0(){return new c(f(W.Text,"Expected text token").value)}function V6(){if(f(W.OpenStatement,"Expected opening statement token"),L[C].type!==W.Identifier)throw SyntaxError(`Unknown statement, got ${L[C].type}`);let P0=L[C].value,S0;switch(P0){case"set":++C,S0=x6();break;case"if":++C,S0=j6(),f(W.OpenStatement,"Expected {% token"),r("endif"),f(W.CloseStatement,"Expected %} token");break;case"macro":++C,S0=V4(),f(W.OpenStatement,"Expected {% token"),r("endmacro"),f(W.CloseStatement,"Expected %} token");break;case"for":++C,S0=Z4(),f(W.OpenStatement,"Expected {% token"),r("endfor"),f(W.CloseStatement,"Expected %} token");break;case"call":{++C;let m0=null;if(L0(W.OpenParen))m0=x4();let P6=Y4();if(P6.type!=="Identifier")throw SyntaxError("Expected identifier following call statement");let UJ=x4();f(W.CloseStatement,"Expected closing statement token");let p4=[];while(!c0("endcall"))p4.push(G0());f(W.OpenStatement,"Expected '{%'"),r("endcall"),f(W.CloseStatement,"Expected closing statement token");let C4=new B(P6,UJ);S0=new Z0(C4,m0,p4);break}case"break":++C,f(W.CloseStatement,"Expected closing statement token"),S0=new y;break;case"continue":++C,f(W.CloseStatement,"Expected closing statement token"),S0=new D;break;case"filter":{++C;let m0=Y4();if(m0 instanceof F&&L0(W.OpenParen))m0=_4(m0);f(W.CloseStatement,"Expected closing statement token");let P6=[];while(!c0("endfilter"))P6.push(G0());f(W.OpenStatement,"Expected '{%'"),r("endfilter"),f(W.CloseStatement,"Expected '%}'"),S0=new W0(m0,P6);break}default:throw SyntaxError(`Unknown statement type: ${P0}`)}return S0}function E6(){f(W.OpenExpression,"Expected opening expression token");let P0=p6();return f(W.CloseExpression,"Expected closing expression token"),P0}function x6(){let P0=R4(),S0=null,m0=[];if(L0(W.Equals))++C,S0=R4();else{f(W.CloseStatement,"Expected %} token");while(!c0("endset"))m0.push(G0());f(W.OpenStatement,"Expected {% token"),r("endset")}return f(W.CloseStatement,"Expected closing statement token"),new j(P0,S0,m0)}function j6(){let P0=p6();f(W.CloseStatement,"Expected closing statement token");let S0=[],m0=[];while(!c0("elif","else","endif"))S0.push(G0());if(c0("elif")){++C,++C;let P6=j6();m0.push(P6)}else if(c0("else")){++C,++C,f(W.CloseStatement,"Expected closing statement token");while(!c0("endif"))m0.push(G0())}return new w(P0,S0,m0)}function V4(){let P0=Y4();if(P0.type!=="Identifier")throw SyntaxError("Expected identifier following macro statement");let S0=x4();f(W.CloseStatement,"Expected closing statement token");let m0=[];while(!c0("endmacro"))m0.push(G0());return new v(P0,S0,m0)}function R4(P0=!1){let S0=P0?Y4:p6,m0=[S0()],P6=L0(W.Comma);while(P6)if(++C,m0.push(S0()),!L0(W.Comma))break;return P6?new d(m0):m0[0]}function Z4(){let P0=R4(!0);if(!(P0 instanceof F||P0 instanceof d))throw SyntaxError(`Expected identifier/tuple for the loop variable, got ${P0.type} instead`);if(!t0("in"))throw SyntaxError("Expected `in` keyword following loop variable");++C;let S0=p6();f(W.CloseStatement,"Expected closing statement token");let m0=[];while(!c0("endfor","else"))m0.push(G0());let P6=[];if(c0("else")){++C,++C,f(W.CloseStatement,"Expected closing statement token");while(!c0("endfor"))P6.push(G0())}return new R(P0,S0,m0,P6)}function p6(){return I4()}function I4(){let P0=g4();if(t0("if")){++C;let S0=g4();if(t0("else")){++C;let m0=I4();return new z0(S0,P0,m0)}else return new o(P0,S0)}return P0}function g4(){let P0=l4();while(t0("or")){let S0=L[C];++C;let m0=l4();P0=new n(S0,P0,m0)}return P0}function l4(){let P0=O4();while(t0("and")){let S0=L[C];++C;let m0=O4();P0=new n(S0,P0,m0)}return P0}function O4(){let P0;while(t0("not")){let S0=L[C];++C;let m0=O4();P0=new w0(S0,m0)}return P0??GJ()}function GJ(){let P0=c4();while(!0){let S0;if(t0("not","in"))S0=new Q("not in",W.Identifier),C+=2;else if(t0("in"))S0=L[C++];else if(L0(W.ComparisonBinaryOperator))S0=L[C++];else break;let m0=c4();P0=new n(S0,P0,m0)}return P0}function c4(){let P0=P4();while(L0(W.AdditiveBinaryOperator)){let S0=L[C];++C;let m0=P4();P0=new n(S0,P0,m0)}return P0}function j4(){let P0=m4(Y4());if(L0(W.OpenParen))return _4(P0);return P0}function _4(P0){let S0=new B(P0,x4());if(S0=m4(S0),L0(W.OpenParen))S0=_4(S0);return S0}function x4(){f(W.OpenParen,"Expected opening parenthesis for arguments list");let P0=XJ();return f(W.CloseParen,"Expected closing parenthesis for arguments list"),P0}function XJ(){let P0=[];while(!L0(W.CloseParen)){let S0;if(L[C].type===W.MultiplicativeBinaryOperator&&L[C].value==="*"){++C;let m0=p6();S0=new p(m0)}else if(S0=p6(),L0(W.Equals)){if(++C,!(S0 instanceof F))throw SyntaxError("Expected identifier for keyword argument");let m0=p6();S0=new O(S0,m0)}if(P0.push(S0),L0(W.Comma))++C}return P0}function qJ(){let P0=[],S0=!1;while(!L0(W.CloseSquareBracket))if(L0(W.Colon))P0.push(void 0),++C,S0=!0;else if(P0.push(p6()),L0(W.Colon))++C,S0=!0;if(P0.length===0)throw SyntaxError("Expected at least one argument for member/slice expression");if(S0){if(P0.length>3)throw SyntaxError("Expected 0-3 arguments for slice expression");return new I(...P0)}return P0[0]}function m4(P0){while(L0(W.Dot)||L0(W.OpenSquareBracket)){let S0=L[C];++C;let m0,P6=S0.type===W.OpenSquareBracket;if(P6)m0=qJ(),f(W.CloseSquareBracket,"Expected closing square bracket");else if(m0=Y4(),m0.type!=="Identifier")throw SyntaxError("Expected identifier following dot operator");P0=new T(P0,m0,P6)}return P0}function P4(){let P0=a4();while(L0(W.MultiplicativeBinaryOperator)){let S0=L[C++],m0=a4();P0=new n(S0,P0,m0)}return P0}function a4(){let P0=HJ();while(t0("is")){++C;let S0=t0("not");if(S0)++C;let m0=Y4();if(!(m0 instanceof F))throw SyntaxError("Expected identifier for the test");P0=new N0(P0,S0,m0)}return P0}function HJ(){let P0=j4();while(L0(W.Pipe)){++C;let S0=Y4();if(!(S0 instanceof F))throw SyntaxError("Expected identifier for the filter");if(L0(W.OpenParen))S0=_4(S0);P0=new t(P0,S0)}return P0}function Y4(){let P0=L[C++];switch(P0.type){case W.NumericLiteral:{let S0=P0.value;return S0.includes(".")?new h(Number(S0)):new _(Number(S0))}case W.StringLiteral:{let S0=P0.value;while(L0(W.StringLiteral))S0+=L[C++].value;return new c(S0)}case W.Identifier:return new F(P0.value);case W.OpenParen:{let S0=R4();return f(W.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),S0}case W.OpenSquareBracket:{let S0=[];while(!L0(W.CloseSquareBracket))if(S0.push(p6()),L0(W.Comma))++C;return++C,new m(S0)}case W.OpenCurlyBracket:{let S0=new Map;while(!L0(W.CloseCurlyBracket)){let m0=p6();f(W.Colon,"Expected colon between key and value in object literal");let P6=p6();if(S0.set(m0,P6),L0(W.Comma))++C}return++C,new a(S0)}default:throw SyntaxError(`Unexpected token: ${P0.type}`)}}while(C<L.length)u.body.push(G0());return u}function j0(L,u,C=1){if(u===void 0)u=L,L=0;let f=[];for(let r=L;r<u;r+=C)f.push(r);return f}function h0(L,u,C,f=1){let r=Math.sign(f);if(r>=0)u=(u??=0)<0?Math.max(L.length+u,0):Math.min(u,L.length),C=(C??=L.length)<0?Math.max(L.length+C,0):Math.min(C,L.length);else u=(u??=L.length-1)<0?Math.max(L.length+u,-1):Math.min(u,L.length-1),C=(C??=-1)<-1?Math.max(L.length+C,-1):Math.min(C,L.length-1);let G0=[];for(let L0=u;r*L0<r*C;L0+=f)G0.push(L[L0]);return G0}function d0(L){return L.replace(/\b\w/g,(u)=>u.toUpperCase())}function T0(L){return b(new Date,L)}function b(L,u){let C=new Intl.DateTimeFormat(void 0,{month:"long"}),f=new Intl.DateTimeFormat(void 0,{month:"short"}),r=(G0)=>G0<10?"0"+G0:G0.toString();return u.replace(/%[YmdbBHM%]/g,(G0)=>{switch(G0){case"%Y":return L.getFullYear().toString();case"%m":return r(L.getMonth()+1);case"%d":return r(L.getDate());case"%b":return f.format(L);case"%B":return C.format(L);case"%H":return r(L.getHours());case"%M":return r(L.getMinutes());case"%%":return"%";default:return G0}})}function S(L){return L.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Q0(L,u,C,f){if(f===0)return L;let r=f==null||f<0?1/0:f,G0=u.length===0?new RegExp("(?=)","gu"):new RegExp(S(u),"gu");return L.replaceAll(G0,(L0)=>{if(r>0)return--r,C;return L0})}var B0=class extends Error{},I0=class extends Error{},F0=class{type="RuntimeValue";value;builtins=new Map;constructor(L=void 0){this.value=L}__bool__(){return new R0(!!this.value)}toString(){return String(this.value)}},Y0=class extends F0{type="IntegerValue"},E0=class extends F0{type="FloatValue";toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},X0=class extends F0{type="StringValue";builtins=new Map([["upper",new b0(()=>{return new X0(this.value.toUpperCase())})],["lower",new b0(()=>{return new X0(this.value.toLowerCase())})],["strip",new b0(()=>{return new X0(this.value.trim())})],["title",new b0(()=>{return new X0(d0(this.value))})],["capitalize",new b0(()=>{return new X0(this.value.charAt(0).toUpperCase()+this.value.slice(1))})],["length",new Y0(this.value.length)],["rstrip",new b0(()=>{return new X0(this.value.trimEnd())})],["lstrip",new b0(()=>{return new X0(this.value.trimStart())})],["startswith",new b0((L)=>{if(L.length===0)throw Error("startswith() requires at least one argument");let u=L[0];if(u instanceof X0)return new R0(this.value.startsWith(u.value));else if(u instanceof U0){for(let C of u.value){if(!(C instanceof X0))throw Error("startswith() tuple elements must be strings");if(this.value.startsWith(C.value))return new R0(!0)}return new R0(!1)}throw Error("startswith() argument must be a string or tuple of strings")})],["endswith",new b0((L)=>{if(L.length===0)throw Error("endswith() requires at least one argument");let u=L[0];if(u instanceof X0)return new R0(this.value.endsWith(u.value));else if(u instanceof U0){for(let C of u.value){if(!(C instanceof X0))throw Error("endswith() tuple elements must be strings");if(this.value.endsWith(C.value))return new R0(!0)}return new R0(!1)}throw Error("endswith() argument must be a string or tuple of strings")})],["split",new b0((L)=>{let u=L[0]??new s0;if(!(u instanceof X0||u instanceof s0))throw Error("sep argument must be a string or null");let C=L[1]??new Y0(-1);if(!(C instanceof Y0))throw Error("maxsplit argument must be a number");let f=[];if(u instanceof s0){let r=this.value.trimStart();for(let{0:G0,index:L0}of r.matchAll(/\S+/g)){if(C.value!==-1&&f.length>=C.value&&L0!==void 0){f.push(G0+r.slice(L0+G0.length));break}f.push(G0)}}else{if(u.value==="")throw Error("empty separator");if(f=this.value.split(u.value),C.value!==-1&&f.length>C.value)f.push(f.splice(C.value).join(u.value))}return new U0(f.map((r)=>new X0(r)))})],["replace",new b0((L)=>{if(L.length<2)throw Error("replace() requires at least two arguments");let u=L[0],C=L[1];if(!(u instanceof X0&&C instanceof X0))throw Error("replace() arguments must be strings");let f;if(L.length>2)if(L[2].type==="KeywordArgumentsValue")f=L[2].value.get("count")??new s0;else f=L[2];else f=new s0;if(!(f instanceof Y0||f instanceof s0))throw Error("replace() count argument must be a number or null");return new X0(Q0(this.value,u.value,C.value,f.value))})]])},R0=class extends F0{type="BooleanValue"},C0=class extends F0{type="ObjectValue";__bool__(){return new R0(this.value.size>0)}builtins=new Map([["get",new b0(([L,u])=>{if(!(L instanceof X0))throw Error(`Object key must be a string: got ${L.type}`);return this.value.get(L.value)??u??new s0})],["items",new b0(()=>this.items())],["keys",new b0(()=>this.keys())],["values",new b0(()=>this.values())]]);items(){return new U0(Array.from(this.value.entries()).map(([L,u])=>new U0([new X0(L),u])))}keys(){return new U0(Array.from(this.value.keys()).map((L)=>new X0(L)))}values(){return new U0(Array.from(this.value.values()))}},x0=class extends C0{type="KeywordArgumentsValue"},U0=class extends F0{type="ArrayValue";builtins=new Map([["length",new Y0(this.value.length)]]);__bool__(){return new R0(this.value.length>0)}},u0=class extends U0{type="TupleValue"},b0=class extends F0{type="FunctionValue"},s0=class extends F0{type="NullValue"},l0=class extends F0{type="UndefinedValue"},y0=class{constructor(L){this.parent=L}variables=new Map([["namespace",new b0((L)=>{if(L.length===0)return new C0(new Map);if(L.length!==1||!(L[0]instanceof C0))throw Error("`namespace` expects either zero arguments or a single object argument");return L[0]})]]);tests=new Map([["boolean",(L)=>L.type==="BooleanValue"],["callable",(L)=>L instanceof b0],["odd",(L)=>{if(!(L instanceof Y0))throw Error(`cannot odd on ${L.type}`);return L.value%2!==0}],["even",(L)=>{if(!(L instanceof Y0))throw Error(`cannot even on ${L.type}`);return L.value%2===0}],["false",(L)=>L.type==="BooleanValue"&&!L.value],["true",(L)=>L.type==="BooleanValue"&&L.value],["none",(L)=>L.type==="NullValue"],["string",(L)=>L.type==="StringValue"],["number",(L)=>L instanceof Y0||L instanceof E0],["integer",(L)=>L instanceof Y0],["iterable",(L)=>L.type==="ArrayValue"||L.type==="StringValue"],["mapping",(L)=>L.type==="ObjectValue"],["lower",(L)=>{let u=L.value;return L.type==="StringValue"&&u===u.toLowerCase()}],["upper",(L)=>{let u=L.value;return L.type==="StringValue"&&u===u.toUpperCase()}],["none",(L)=>L.type==="NullValue"],["defined",(L)=>L.type!=="UndefinedValue"],["undefined",(L)=>L.type==="UndefinedValue"],["equalto",(L,u)=>L.value===u.value],["eq",(L,u)=>L.value===u.value]]);set(L,u){return this.declareVariable(L,n0(u))}declareVariable(L,u){if(this.variables.has(L))throw SyntaxError(`Variable already declared: ${L}`);return this.variables.set(L,u),u}setVariable(L,u){return this.variables.set(L,u),u}resolve(L){if(this.variables.has(L))return this;if(this.parent)return this.parent.resolve(L);throw Error(`Unknown variable: ${L}`)}lookupVariable(L){try{return this.resolve(L).variables.get(L)??new l0}catch{return new l0}}};function i0(L){L.set("false",!1),L.set("true",!0),L.set("none",null),L.set("raise_exception",(u)=>{throw Error(u)}),L.set("range",j0),L.set("strftime_now",T0),L.set("True",!0),L.set("False",!1),L.set("None",null)}var a0=class{global;constructor(L){this.global=L??new y0}run(L){return this.evaluate(L,this.global)}evaluateBinaryExpression(L,u){let C=this.evaluate(L.left,u);switch(L.operator.value){case"and":return C.__bool__().value?this.evaluate(L.right,u):C;case"or":return C.__bool__().value?C:this.evaluate(L.right,u)}let f=this.evaluate(L.right,u);switch(L.operator.value){case"==":return new R0(C.value==f.value);case"!=":return new R0(C.value!=f.value)}if(C instanceof l0||f instanceof l0){if(f instanceof l0&&["in","not in"].includes(L.operator.value))return new R0(L.operator.value==="not in");throw Error(`Cannot perform operation ${L.operator.value} on undefined values`)}else if(C instanceof s0||f instanceof s0)throw Error("Cannot perform operation on null values");else if(L.operator.value==="~")return new X0(C.value.toString()+f.value.toString());else if((C instanceof Y0||C instanceof E0)&&(f instanceof Y0||f instanceof E0)){let r=C.value,G0=f.value;switch(L.operator.value){case"+":case"-":case"*":{let L0=L.operator.value==="+"?r+G0:L.operator.value==="-"?r-G0:r*G0;return C instanceof E0||f instanceof E0?new E0(L0):new Y0(L0)}case"/":return new E0(r/G0);case"%":{let L0=r%G0;return C instanceof E0||f instanceof E0?new E0(L0):new Y0(L0)}case"<":return new R0(r<G0);case">":return new R0(r>G0);case">=":return new R0(r>=G0);case"<=":return new R0(r<=G0)}}else if(C instanceof U0&&f instanceof U0)switch(L.operator.value){case"+":return new U0(C.value.concat(f.value))}else if(f instanceof U0){let r=f.value.find((G0)=>G0.value===C.value)!==void 0;switch(L.operator.value){case"in":return new R0(r);case"not in":return new R0(!r)}}if(C instanceof X0||f instanceof X0)switch(L.operator.value){case"+":return new X0(C.value.toString()+f.value.toString())}if(C instanceof X0&&f instanceof X0)switch(L.operator.value){case"in":return new R0(f.value.includes(C.value));case"not in":return new R0(!f.value.includes(C.value))}if(C instanceof X0&&f instanceof C0)switch(L.operator.value){case"in":return new R0(f.value.has(C.value));case"not in":return new R0(!f.value.has(C.value))}throw SyntaxError(`Unknown operator "${L.operator.value}" between ${C.type} and ${f.type}`)}evaluateArguments(L,u){let C=[],f=new Map;for(let r of L)if(r.type==="SpreadExpression"){let G0=r,L0=this.evaluate(G0.argument,u);if(!(L0 instanceof U0))throw Error(`Cannot unpack non-iterable type: ${L0.type}`);for(let c0 of L0.value)C.push(c0)}else if(r.type==="KeywordArgumentExpression"){let G0=r;f.set(G0.key.value,this.evaluate(G0.value,u))}else{if(f.size>0)throw Error("Positional arguments must come before keyword arguments");C.push(this.evaluate(r,u))}return[C,f]}applyFilter(L,u,C){if(u.type==="Identifier"){let f=u;if(f.value==="tojson")return new X0(B6(L));if(L instanceof U0)switch(f.value){case"list":return L;case"first":return L.value[0];case"last":return L.value[L.value.length-1];case"length":return new Y0(L.value.length);case"reverse":return new U0(L.value.reverse());case"sort":return new U0(L.value.sort((r,G0)=>{if(r.type!==G0.type)throw Error(`Cannot compare different types: ${r.type} and ${G0.type}`);switch(r.type){case"IntegerValue":case"FloatValue":return r.value-G0.value;case"StringValue":return r.value.localeCompare(G0.value);default:throw Error(`Cannot compare type: ${r.type}`)}}));case"join":return new X0(L.value.map((r)=>r.value).join(""));case"string":return new X0(B6(L));case"unique":{let r=new Set,G0=[];for(let L0 of L.value)if(!r.has(L0.value))r.add(L0.value),G0.push(L0);return new U0(G0)}default:throw Error(`Unknown ArrayValue filter: ${f.value}`)}else if(L instanceof X0)switch(f.value){case"length":case"upper":case"lower":case"title":case"capitalize":{let r=L.builtins.get(f.value);if(r instanceof b0)return r.value([],C);else if(r instanceof Y0)return r;else throw Error(`Unknown StringValue filter: ${f.value}`)}case"trim":return new X0(L.value.trim());case"indent":return new X0(L.value.split(`
`).map((r,G0)=>G0===0||r.length===0?r:"    "+r).join(`
`));case"join":case"string":return L;case"int":{let r=parseInt(L.value,10);return new Y0(isNaN(r)?0:r)}case"float":{let r=parseFloat(L.value);return new E0(isNaN(r)?0:r)}default:throw Error(`Unknown StringValue filter: ${f.value}`)}else if(L instanceof Y0||L instanceof E0)switch(f.value){case"abs":return L instanceof Y0?new Y0(Math.abs(L.value)):new E0(Math.abs(L.value));case"int":return new Y0(Math.floor(L.value));case"float":return new E0(L.value);default:throw Error(`Unknown NumericValue filter: ${f.value}`)}else if(L instanceof C0)switch(f.value){case"items":return new U0(Array.from(L.value.entries()).map(([r,G0])=>new U0([new X0(r),G0])));case"length":return new Y0(L.value.size);default:throw Error(`Unknown ObjectValue filter: ${f.value}`)}else if(L instanceof R0)switch(f.value){case"bool":return new R0(L.value);case"int":return new Y0(L.value?1:0);case"float":return new E0(L.value?1:0);case"string":return new X0(L.value?"true":"false");default:throw Error(`Unknown BooleanValue filter: ${f.value}`)}throw Error(`Cannot apply filter "${f.value}" to type: ${L.type}`)}else if(u.type==="CallExpression"){let f=u;if(f.callee.type!=="Identifier")throw Error(`Unknown filter: ${f.callee.type}`);let r=f.callee.value;if(r==="tojson"){let[,G0]=this.evaluateArguments(f.args,C),L0=G0.get("indent")??new s0;if(!(L0 instanceof Y0||L0 instanceof s0))throw Error("If set, indent must be a number");return new X0(B6(L,L0.value))}else if(r==="join"){let G0;if(L instanceof X0)G0=Array.from(L.value);else if(L instanceof U0)G0=L.value.map((v0)=>v0.value);else throw Error(`Cannot apply filter "${r}" to type: ${L.type}`);let[L0,c0]=this.evaluateArguments(f.args,C),t0=L0.at(0)??c0.get("separator")??new X0("");if(!(t0 instanceof X0))throw Error("separator must be a string");return new X0(G0.join(t0.value))}else if(r==="int"||r==="float"){let[G0,L0]=this.evaluateArguments(f.args,C),c0=G0.at(0)??L0.get("default")??(r==="int"?new Y0(0):new E0(0));if(L instanceof X0){let t0=r==="int"?parseInt(L.value,10):parseFloat(L.value);return isNaN(t0)?c0:r==="int"?new Y0(t0):new E0(t0)}else if(L instanceof Y0||L instanceof E0)return L;else if(L instanceof R0)return r==="int"?new Y0(L.value?1:0):new E0(L.value?1:0);else throw Error(`Cannot apply filter "${r}" to type: ${L.type}`)}else if(r==="default"){let[G0,L0]=this.evaluateArguments(f.args,C),c0=G0[0]??new X0(""),t0=G0[1]??L0.get("boolean")??new R0(!1);if(!(t0 instanceof R0))throw Error("`default` filter flag must be a boolean");if(L instanceof l0||t0.value&&!L.__bool__().value)return c0;return L}if(L instanceof U0){switch(r){case"selectattr":case"rejectattr":{let G0=r==="selectattr";if(L.value.some((E6)=>!(E6 instanceof C0)))throw Error(`\`${r}\` can only be applied to array of objects`);if(f.args.some((E6)=>E6.type!=="StringLiteral"))throw Error(`arguments of \`${r}\` must be strings`);let[L0,c0,t0]=f.args.map((E6)=>this.evaluate(E6,C)),v0;if(c0){let E6=C.tests.get(c0.value);if(!E6)throw Error(`Unknown test: ${c0.value}`);v0=E6}else v0=(...E6)=>E6[0].__bool__().value;let V6=L.value.filter((E6)=>{let x6=E6.value.get(L0.value),j6=x6?v0(x6,t0):!1;return G0?j6:!j6});return new U0(V6)}case"map":{let[,G0]=this.evaluateArguments(f.args,C);if(G0.has("attribute")){let L0=G0.get("attribute");if(!(L0 instanceof X0))throw Error("attribute must be a string");let c0=G0.get("default"),t0=L.value.map((v0)=>{if(!(v0 instanceof C0))throw Error("items in map must be an object");return v0.value.get(L0.value)??c0??new l0});return new U0(t0)}else throw Error("`map` expressions without `attribute` set are not currently supported.")}}throw Error(`Unknown ArrayValue filter: ${r}`)}else if(L instanceof X0){switch(r){case"indent":{let[G0,L0]=this.evaluateArguments(f.args,C),c0=G0.at(0)??L0.get("width")??new Y0(4);if(!(c0 instanceof Y0))throw Error("width must be a number");let t0=G0.at(1)??L0.get("first")??new R0(!1),v0=G0.at(2)??L0.get("blank")??new R0(!1),V6=L.value.split(`
`),E6=" ".repeat(c0.value),x6=V6.map((j6,V4)=>!t0.value&&V4===0||!v0.value&&j6.length===0?j6:E6+j6);return new X0(x6.join(`
`))}case"replace":{let G0=L.builtins.get("replace");if(!(G0 instanceof b0))throw Error("replace filter not available");let[L0,c0]=this.evaluateArguments(f.args,C);return G0.value([...L0,new x0(c0)],C)}}throw Error(`Unknown StringValue filter: ${r}`)}else throw Error(`Cannot apply filter "${r}" to type: ${L.type}`)}throw Error(`Unknown filter: ${u.type}`)}evaluateFilterExpression(L,u){let C=this.evaluate(L.operand,u);return this.applyFilter(C,L.filter,u)}evaluateTestExpression(L,u){let C=this.evaluate(L.operand,u),f=u.tests.get(L.test.value);if(!f)throw Error(`Unknown test: ${L.test.value}`);let r=f(C);return new R0(L.negate?!r:r)}evaluateSelectExpression(L,u){if(!this.evaluate(L.test,u).__bool__().value)return new l0;return this.evaluate(L.lhs,u)}evaluateUnaryExpression(L,u){let C=this.evaluate(L.argument,u);switch(L.operator.value){case"not":return new R0(!C.value);default:throw SyntaxError(`Unknown operator: ${L.operator.value}`)}}evaluateTernaryExpression(L,u){return this.evaluate(L.condition,u).__bool__().value?this.evaluate(L.trueExpr,u):this.evaluate(L.falseExpr,u)}evalProgram(L,u){return this.evaluateBlock(L.body,u)}evaluateBlock(L,u){let C="";for(let f of L){let r=this.evaluate(f,u);if(r.type!=="NullValue"&&r.type!=="UndefinedValue")C+=r.toString()}return new X0(C)}evaluateIdentifier(L,u){return u.lookupVariable(L.value)}evaluateCallExpression(L,u){let[C,f]=this.evaluateArguments(L.args,u);if(f.size>0)C.push(new x0(f));let r=this.evaluate(L.callee,u);if(r.type!=="FunctionValue")throw Error(`Cannot call something that is not a function: got ${r.type}`);return r.value(C,u)}evaluateSliceExpression(L,u,C){if(!(L instanceof U0||L instanceof X0))throw Error("Slice object must be an array or string");let f=this.evaluate(u.start,C),r=this.evaluate(u.stop,C),G0=this.evaluate(u.step,C);if(!(f instanceof Y0||f instanceof l0))throw Error("Slice start must be numeric or undefined");if(!(r instanceof Y0||r instanceof l0))throw Error("Slice stop must be numeric or undefined");if(!(G0 instanceof Y0||G0 instanceof l0))throw Error("Slice step must be numeric or undefined");if(L instanceof U0)return new U0(h0(L.value,f.value,r.value,G0.value));else return new X0(h0(Array.from(L.value),f.value,r.value,G0.value).join(""))}evaluateMemberExpression(L,u){let C=this.evaluate(L.object,u),f;if(L.computed)if(L.property.type==="SliceExpression")return this.evaluateSliceExpression(C,L.property,u);else f=this.evaluate(L.property,u);else f=new X0(L.property.value);let r;if(C instanceof C0){if(!(f instanceof X0))throw Error(`Cannot access property with non-string: got ${f.type}`);r=C.value.get(f.value)??C.builtins.get(f.value)}else if(C instanceof U0||C instanceof X0)if(f instanceof Y0){if(r=C.value.at(f.value),C instanceof X0)r=new X0(C.value.at(f.value))}else if(f instanceof X0)r=C.builtins.get(f.value);else throw Error(`Cannot access property with non-string/non-number: got ${f.type}`);else{if(!(f instanceof X0))throw Error(`Cannot access property with non-string: got ${f.type}`);r=C.builtins.get(f.value)}return r instanceof F0?r:new l0}evaluateSet(L,u){let C=L.value?this.evaluate(L.value,u):this.evaluateBlock(L.body,u);if(L.assignee.type==="Identifier"){let f=L.assignee.value;u.setVariable(f,C)}else if(L.assignee.type==="TupleLiteral"){let f=L.assignee;if(!(C instanceof U0))throw Error(`Cannot unpack non-iterable type in set: ${C.type}`);let r=C.value;if(r.length!==f.value.length)throw Error(`Too ${f.value.length>r.length?"few":"many"} items to unpack in set`);for(let G0=0;G0<f.value.length;++G0){let L0=f.value[G0];if(L0.type!=="Identifier")throw Error(`Cannot unpack to non-identifier in set: ${L0.type}`);u.setVariable(L0.value,r[G0])}}else if(L.assignee.type==="MemberExpression"){let f=L.assignee,r=this.evaluate(f.object,u);if(!(r instanceof C0))throw Error("Cannot assign to member of non-object");if(f.property.type!=="Identifier")throw Error("Cannot assign to member with non-identifier property");r.value.set(f.property.value,C)}else throw Error(`Invalid LHS inside assignment expression: ${JSON.stringify(L.assignee)}`);return new s0}evaluateIf(L,u){let C=this.evaluate(L.test,u);return this.evaluateBlock(C.__bool__().value?L.body:L.alternate,u)}evaluateFor(L,u){let C=new y0(u),f,r;if(L.iterable.type==="SelectExpression"){let v0=L.iterable;r=this.evaluate(v0.lhs,C),f=v0.test}else r=this.evaluate(L.iterable,C);if(!(r instanceof U0||r instanceof C0))throw Error(`Expected iterable or object type in for loop: got ${r.type}`);if(r instanceof C0)r=r.keys();let G0=[],L0=[];for(let v0=0;v0<r.value.length;++v0){let V6=new y0(C),E6=r.value[v0],x6;if(L.loopvar.type==="Identifier")x6=(j6)=>j6.setVariable(L.loopvar.value,E6);else if(L.loopvar.type==="TupleLiteral"){let j6=L.loopvar;if(E6.type!=="ArrayValue")throw Error(`Cannot unpack non-iterable type: ${E6.type}`);let V4=E6;if(j6.value.length!==V4.value.length)throw Error(`Too ${j6.value.length>V4.value.length?"few":"many"} items to unpack`);x6=(R4)=>{for(let Z4=0;Z4<j6.value.length;++Z4){if(j6.value[Z4].type!=="Identifier")throw Error(`Cannot unpack non-identifier type: ${j6.value[Z4].type}`);R4.setVariable(j6.value[Z4].value,V4.value[Z4])}}}else throw Error(`Invalid loop variable(s): ${L.loopvar.type}`);if(f){if(x6(V6),!this.evaluate(f,V6).__bool__().value)continue}G0.push(E6),L0.push(x6)}let c0="",t0=!0;for(let v0=0;v0<G0.length;++v0){let V6=new Map([["index",new Y0(v0+1)],["index0",new Y0(v0)],["revindex",new Y0(G0.length-v0)],["revindex0",new Y0(G0.length-v0-1)],["first",new R0(v0===0)],["last",new R0(v0===G0.length-1)],["length",new Y0(G0.length)],["previtem",v0>0?G0[v0-1]:new l0],["nextitem",v0<G0.length-1?G0[v0+1]:new l0]]);C.setVariable("loop",new C0(V6)),L0[v0](C);try{let E6=this.evaluateBlock(L.body,C);c0+=E6.value}catch(E6){if(E6 instanceof I0)continue;if(E6 instanceof B0)break;throw E6}t0=!1}if(t0){let v0=this.evaluateBlock(L.defaultBlock,C);c0+=v0.value}return new X0(c0)}evaluateMacro(L,u){return u.setVariable(L.name.value,new b0((C,f)=>{let r=new y0(f);C=C.slice();let G0;if(C.at(-1)?.type==="KeywordArgumentsValue")G0=C.pop();for(let L0=0;L0<L.args.length;++L0){let c0=L.args[L0],t0=C[L0];if(c0.type==="Identifier"){let v0=c0;if(!t0)throw Error(`Missing positional argument: ${v0.value}`);r.setVariable(v0.value,t0)}else if(c0.type==="KeywordArgumentExpression"){let v0=c0,V6=t0??G0?.value.get(v0.key.value)??this.evaluate(v0.value,r);r.setVariable(v0.key.value,V6)}else throw Error(`Unknown argument type: ${c0.type}`)}return this.evaluateBlock(L.body,r)})),new s0}evaluateCallStatement(L,u){let C=new b0((c0,t0)=>{let v0=new y0(t0);if(L.callerArgs)for(let V6=0;V6<L.callerArgs.length;++V6){let E6=L.callerArgs[V6];if(E6.type!=="Identifier")throw Error(`Caller parameter must be an identifier, got ${E6.type}`);v0.setVariable(E6.value,c0[V6]??new l0)}return this.evaluateBlock(L.body,v0)}),[f,r]=this.evaluateArguments(L.call.args,u);f.push(new x0(r));let G0=this.evaluate(L.call.callee,u);if(G0.type!=="FunctionValue")throw Error(`Cannot call something that is not a function: got ${G0.type}`);let L0=new y0(u);return L0.setVariable("caller",C),G0.value(f,L0)}evaluateFilterStatement(L,u){let C=this.evaluateBlock(L.body,u);return this.applyFilter(C,L.filter,u)}evaluate(L,u){if(!L)return new l0;switch(L.type){case"Program":return this.evalProgram(L,u);case"Set":return this.evaluateSet(L,u);case"If":return this.evaluateIf(L,u);case"For":return this.evaluateFor(L,u);case"Macro":return this.evaluateMacro(L,u);case"CallStatement":return this.evaluateCallStatement(L,u);case"Break":throw new B0;case"Continue":throw new I0;case"IntegerLiteral":return new Y0(L.value);case"FloatLiteral":return new E0(L.value);case"StringLiteral":return new X0(L.value);case"ArrayLiteral":return new U0(L.value.map((C)=>this.evaluate(C,u)));case"TupleLiteral":return new u0(L.value.map((C)=>this.evaluate(C,u)));case"ObjectLiteral":{let C=new Map;for(let[f,r]of L.value){let G0=this.evaluate(f,u);if(!(G0 instanceof X0))throw Error(`Object keys must be strings: got ${G0.type}`);C.set(G0.value,this.evaluate(r,u))}return new C0(C)}case"Identifier":return this.evaluateIdentifier(L,u);case"CallExpression":return this.evaluateCallExpression(L,u);case"MemberExpression":return this.evaluateMemberExpression(L,u);case"UnaryExpression":return this.evaluateUnaryExpression(L,u);case"BinaryExpression":return this.evaluateBinaryExpression(L,u);case"FilterExpression":return this.evaluateFilterExpression(L,u);case"FilterStatement":return this.evaluateFilterStatement(L,u);case"TestExpression":return this.evaluateTestExpression(L,u);case"SelectExpression":return this.evaluateSelectExpression(L,u);case"Ternary":return this.evaluateTernaryExpression(L,u);case"Comment":return new s0;default:throw SyntaxError(`Unknown node type: ${L.type}`)}}};function n0(L){switch(typeof L){case"number":return Number.isInteger(L)?new Y0(L):new E0(L);case"string":return new X0(L);case"boolean":return new R0(L);case"undefined":return new l0;case"object":if(L===null)return new s0;else if(Array.isArray(L))return new U0(L.map(n0));else return new C0(new Map(Object.entries(L).map(([u,C])=>[u,n0(C)])));case"function":return new b0((u,C)=>{let f=L(...u.map((r)=>r.value))??null;return n0(f)});default:throw Error(`Cannot convert to runtime value: ${L}`)}}function B6(L,u,C){let f=C??0;switch(L.type){case"NullValue":case"UndefinedValue":return"null";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(L.value);case"ArrayValue":case"ObjectValue":{let r=u?" ".repeat(u):"",G0=`
`+r.repeat(f),L0=G0+r;if(L.type==="ArrayValue"){let c0=L.value.map((t0)=>B6(t0,u,f+1));return u?`[${L0}${c0.join(`,${L0}`)}${G0}]`:`[${c0.join(", ")}]`}else{let c0=Array.from(L.value.entries()).map(([t0,v0])=>{let V6=`"${t0}": ${B6(v0,u,f+1)}`;return u?`${L0}${V6}`:V6});return u?`{${c0.join(",")}${G0}}`:`{${c0.join(", ")}}`}}default:throw Error(`Cannot convert to JSON: ${L.type}`)}}var Q6=`
`,a6="{%- ",H4=" -%}";function U4(L){switch(L.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":if(L.operator.value==="and")return 1;if(L.operator.value==="in"||L.operator.value==="not in")return 2;return 0}return 0}function k4(L,u="\t"){let C=typeof u==="number"?" ".repeat(u):u;return o6(L.body,0,C).replace(/\n$/,"")}function _6(...L){return a6+L.join(" ")+H4}function o6(L,u,C){return L.map((f)=>IJ(f,u,C)).join(Q6)}function IJ(L,u,C){let f=C.repeat(u);switch(L.type){case"Program":return o6(L.body,u,C);case"If":return TJ(L,u,C);case"For":return kJ(L,u,C);case"Set":return v4(L,u,C);case"Macro":return Z6(L,u,C);case"Break":return f+_6("break");case"Continue":return f+_6("continue");case"CallStatement":return QJ(L,u,C);case"FilterStatement":return KJ(L,u,C);case"Comment":return f+"{# "+L.value+" #}";default:return f+"{{- "+H6(L)+" -}}"}}function TJ(L,u,C){let f=C.repeat(u),r=[],G0=L;while(G0)if(r.push({test:G0.test,body:G0.body}),G0.alternate.length===1&&G0.alternate[0].type==="If")G0=G0.alternate[0];else break;let L0=f+_6("if",H6(r[0].test))+Q6+o6(r[0].body,u+1,C);for(let c0=1;c0<r.length;++c0)L0+=Q6+f+_6("elif",H6(r[c0].test))+Q6+o6(r[c0].body,u+1,C);if(G0&&G0.alternate.length>0)L0+=Q6+f+_6("else")+Q6+o6(G0.alternate,u+1,C);return L0+=Q6+f+_6("endif"),L0}function kJ(L,u,C){let f=C.repeat(u),r="";if(L.iterable.type==="SelectExpression"){let L0=L.iterable;r=`${H6(L0.lhs)} if ${H6(L0.test)}`}else r=H6(L.iterable);let G0=f+_6("for",H6(L.loopvar),"in",r)+Q6+o6(L.body,u+1,C);if(L.defaultBlock.length>0)G0+=Q6+f+_6("else")+Q6+o6(L.defaultBlock,u+1,C);return G0+=Q6+f+_6("endfor"),G0}function v4(L,u,C){let f=C.repeat(u),r=H6(L.assignee),G0=L.value?H6(L.value):"",L0=f+_6("set",`${r}${L.value?" = "+G0:""}`);if(L.body.length===0)return L0;return L0+Q6+o6(L.body,u+1,C)+Q6+f+_6("endset")}function Z6(L,u,C){let f=C.repeat(u),r=L.args.map(H6).join(", ");return f+_6("macro",`${L.name.value}(${r})`)+Q6+o6(L.body,u+1,C)+Q6+f+_6("endmacro")}function QJ(L,u,C){let f=C.repeat(u),r=L.callerArgs&&L.callerArgs.length>0?`(${L.callerArgs.map(H6).join(", ")})`:"",G0=H6(L.call),L0=f+_6(`call${r}`,G0)+Q6;return L0+=o6(L.body,u+1,C)+Q6,L0+=f+_6("endcall"),L0}function KJ(L,u,C){let f=C.repeat(u),r=L.filter.type==="Identifier"?L.filter.value:H6(L.filter),G0=f+_6("filter",r)+Q6;return G0+=o6(L.body,u+1,C)+Q6,G0+=f+_6("endfilter"),G0}function H6(L,u=-1){switch(L.type){case"SpreadExpression":return`*${H6(L.argument)}`;case"Identifier":return L.value;case"IntegerLiteral":return`${L.value}`;case"FloatLiteral":return`${L.value}`;case"StringLiteral":return JSON.stringify(L.value);case"BinaryExpression":{let C=L,f=U4(C),r=H6(C.left,f),G0=H6(C.right,f+1),L0=`${r} ${C.operator.value} ${G0}`;return f<u?`(${L0})`:L0}case"UnaryExpression":{let C=L;return C.operator.value+(C.operator.value==="not"?" ":"")+H6(C.argument,1/0)}case"CallExpression":{let C=L,f=C.args.map(H6).join(", ");return`${H6(C.callee)}(${f})`}case"MemberExpression":{let C=L,f=H6(C.object);if(!["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(C.object.type))f=`(${f})`;let r=H6(C.property);if(!C.computed&&C.property.type!=="Identifier")r=`(${r})`;return C.computed?`${f}[${r}]`:`${f}.${r}`}case"FilterExpression":{let C=L,f=H6(C.operand,1/0);if(C.filter.type==="CallExpression")return`${f} | ${H6(C.filter)}`;return`${f} | ${C.filter.value}`}case"SelectExpression":{let C=L;return`${H6(C.lhs)} if ${H6(C.test)}`}case"TestExpression":{let C=L;return`${H6(C.operand)} is${C.negate?" not":""} ${C.test.value}`}case"ArrayLiteral":case"TupleLiteral":{let C=L.value.map(H6),f=L.type==="ArrayLiteral"?"[]":"()";return`${f[0]}${C.join(", ")}${f[1]}`}case"ObjectLiteral":return`{${Array.from(L.value.entries()).map(([f,r])=>`${H6(f)}: ${H6(r)}`).join(", ")}}`;case"SliceExpression":{let C=L,f=C.start?H6(C.start):"",r=C.stop?H6(C.stop):"",G0=C.step?`:${H6(C.step)}`:"";return`${f}:${r}${G0}`}case"KeywordArgumentExpression":{let C=L;return`${C.key.value}=${H6(C.value)}`}case"Ternary":{let C=L,f=`${H6(C.trueExpr)} if ${H6(C.condition,0)} else ${H6(C.falseExpr)}`;return u>-1?`(${f})`:f}default:throw Error(`Unknown expression type: ${L.type}`)}}var YJ=class{parsed;constructor(L){let u=V(L,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=A0(u)}render(L){let u=new y0;if(i0(u),L)for(let[r,G0]of Object.entries(L))u.set(r,G0);return new a0(u).run(this.parsed).value}format(L){return k4(this.parsed,L?.indent||"\t")}}},"./src/backends/onnx.js":(J,Z,$)=>{/*!******************************!*\
  !*** ./src/backends/onnx.js ***!
  \******************************/var W;$.r(Z),$.d(Z,{Tensor:()=>G.Tensor,createInferenceSession:()=>D,deviceToExecutionProviders:()=>R,isONNXProxy:()=>B,isONNXTensor:()=>A,runInferenceSession:()=>g});var Q=$("./src/env.js");/*! ../env.js */var Y=$("onnxruntime-node");/*! onnxruntime-node */var H=$("?8b6b");/*! onnxruntime-web */var G=$("onnxruntime-common");/*! onnxruntime-common */let q=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),E=[],V,N,z=Symbol.for("onnxruntime");if(z in globalThis)N=globalThis[z];else if(Q.apis.IS_NODE_ENV){switch(N=Y.default??Y,process.platform){case"win32":E.push("dml");break;case"linux":if(process.arch==="x64")E.push("cuda");break;case"darwin":break}E.push("cpu"),V=["cpu"]}else{if(N=W||(W=$.t(H,2)),Q.apis.IS_WEBNN_AVAILABLE)E.push("webnn-npu","webnn-gpu","webnn-cpu","webnn");if(Q.apis.IS_WEBGPU_AVAILABLE)E.push("webgpu");E.push("wasm"),V=["wasm"]}let w=N.InferenceSession;function R(F=null){if(!F)return V;switch(F){case"auto":return E;case"gpu":return E.filter((P)=>["webgpu","cuda","dml","webnn-gpu"].includes(P))}if(E.includes(F))return[q[F]??F];throw Error(`Unsupported device: "${F}". Should be one of: ${E.join(", ")}.`)}let y=null;async function D(F,P,_){if(y)await y;let h=w.create(F,P);y??=h;let c=await h;return c.config=_,c}let j=Promise.resolve(),v=Q.apis.IS_BROWSER_ENV||Q.apis.IS_WEBWORKER_ENV;async function g(F,P){let _=()=>F.run(P);return await(v?j=j.then(_):_())}function A(F){return F instanceof N.Tensor}let T=N?.env;if(T?.wasm){if(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!T.wasm.wasmPaths)T.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${Q.env.version}/dist/`;T.wasm.proxy=!1}if(T?.webgpu)T.webgpu.powerPreference="high-performance";function B(){return T?.wasm?.proxy}Q.env.backends.onnx=T},"./src/base/feature_extraction_utils.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/base/feature_extraction_utils.js ***!
  \**********************************************/$.r(Z),$.d(Z,{FeatureExtractor:()=>H,validate_audio_inputs:()=>G});var W=$("./src/utils/constants.js");/*! ../utils/constants.js */var Q=$("./src/utils/generic.js");/*! ../utils/generic.js */var Y=$("./src/utils/hub.js");/*! ../utils/hub.js */class H extends Q.Callable{constructor(q){super();this.config=q}static async from_pretrained(q,E={}){let V=await(0,Y.getModelJSON)(q,W.FEATURE_EXTRACTOR_NAME,!0,E);return new this(V)}}function G(q,E){if(!(q instanceof Float32Array||q instanceof Float64Array))throw Error(`${E} expects input to be a Float32Array or a Float64Array, but got ${q?.constructor?.name??typeof q} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(J,Z,$)=>{/*!********************************************!*\
  !*** ./src/base/image_processors_utils.js ***!
  \********************************************/$.r(Z),$.d(Z,{ImageProcessor:()=>T,center_to_corners_format:()=>z,post_process_instance_segmentation:()=>A,post_process_object_detection:()=>w,post_process_panoptic_segmentation:()=>g,post_process_semantic_segmentation:()=>R});var W=$("./src/utils/generic.js");/*! ../utils/generic.js */var Q=$("./src/utils/tensor.js");/*! ../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../utils/maths.js */var H=$("./src/utils/image.js");/*! ../utils/image.js */var G=$("./src/utils/core.js");/*! ../utils/core.js */var q=$("./src/utils/hub.js");/*! ../utils/hub.js */var E=$("./src/utils/constants.js");/*! ../utils/constants.js */function V(B,F,P=0,_=null){let h=B/F,c=(0,Y.bankers_round)(h)*F;if(_!==null&&c>_)c=Math.floor(h)*F;if(c<P)c=Math.ceil(h)*F;return c}function N([B,F],P){return[Math.max(Math.floor(B/P),1)*P,Math.max(Math.floor(F/P),1)*P]}function z([B,F,P,_]){return[B-P/2,F-_/2,B+P/2,F+_/2]}function w(B,F=0.5,P=null,_=!1){let{logits:h,pred_boxes:c}=B,[m,d,a]=h.dims;if(P!==null&&P.length!==m)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let n=[];for(let t=0;t<m;++t){let W0=P!==null?P[t]:null,o={boxes:[],classes:[],scores:[]},N0=h[t],w0=c[t];for(let I=0;I<d;++I){let O=N0[I],p=[],Z0;if(_){Z0=O.sigmoid().data;for(let z0=0;z0<Z0.length;++z0)if(Z0[z0]>F)p.push(z0)}else{let z0=(0,Y.max)(O.data)[1];if(z0===a-1)continue;if(Z0=(0,Y.softmax)(O.data),Z0[z0]<F)continue;p.push(z0)}for(let z0 of p){let A0=w0[I].data;if(A0=z(A0),W0!==null)A0=A0.map((j0,h0)=>j0*W0[(h0+1)%2]);o.boxes.push(A0),o.classes.push(z0),o.scores.push(Z0[z0])}}n.push(o)}return n}function R(B,F=null){let P=B.logits,_=P.dims[0];if(F!==null&&F.length!==_)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let c=0;c<_;++c){let m=F!==null?F[c]:null,d=P[c];if(m!==null)d=(0,Q.interpolate)(d,m,"bilinear",!1);let[a,n]=m??d.dims.slice(-2),t=new Q.Tensor("int32",new Int32Array(a*n),[a,n]),W0=d[0].data,o=t.data;for(let I=1;I<d.dims[0];++I){let O=d[I].data;for(let p=0;p<O.length;++p)if(O[p]>W0[p])W0[p]=O[p],o[p]=I}let N0=Array(d.dims[0]);for(let I=0;I<o.length;++I){let O=o[I];N0[O]=O}let w0=N0.filter((I)=>I!==void 0);h.push({segmentation:t,labels:w0})}return h}function y(B,F,P,_){let h=[],c=[],m=[];for(let d=0;d<B.dims[0];++d){let a=B[d],n=F[d],t=(0,Y.max)(a.data)[1];if(t===_)continue;let o=(0,Y.softmax)(a.data)[t];if(o>P)h.push(n),c.push(o),m.push(t)}return[h,c,m]}function D(B,F,P,_=0.5,h=0.8){let c=[],m=0,d=0,a=F[P].data;for(let t=0;t<B.length;++t){if(B[t]===P)c.push(t),++m;if(a[t]>=_)++d}let n=m>0&&d>0;if(n)n=m/d>h;return[n,c]}function j(B,F,P,_,h,c=null,m=null){let[d,a]=m??B[0].dims,n=new Q.Tensor("int32",new Int32Array(d*a),[d,a]),t=[];if(m!==null)for(let I=0;I<B.length;++I)B[I]=(0,Q.interpolate)(B[I],m,"bilinear",!1);let W0=new Int32Array(B[0].data.length),o=new Float32Array(B[0].data.length);for(let I=0;I<B.length;++I){let O=F[I],p=B[I].data;for(let Z0=0;Z0<p.length;++Z0)if(p[Z0]*=O,p[Z0]>o[Z0])W0[Z0]=I,o[Z0]=p[Z0]}let N0=0,w0=n.data;for(let I=0;I<P.length;++I){let O=P[I],[p,Z0]=D(W0,B,I,_,h);if(!p)continue;++N0;for(let z0 of Z0)w0[z0]=N0;t.push({id:N0,label_id:O,score:F[I]})}return[n,t]}function v(B,F,P=28,_=3136,h=1003520){if(B<P||F<P)throw Error(`height:${B} or width:${F} must be larger than factor:${P}`);else if(Math.max(B,F)/Math.min(B,F)>200)throw Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(B,F)/Math.min(B,F)}`);let c=Math.round(B/P)*P,m=Math.round(F/P)*P;if(c*m>h){let d=Math.sqrt(B*F/h);c=Math.floor(B/d/P)*P,m=Math.floor(F/d/P)*P}else if(c*m<_){let d=Math.sqrt(_/(B*F));c=Math.ceil(B*d/P)*P,m=Math.ceil(F*d/P)*P}return[c,m]}function g(B,F=0.5,P=0.5,_=0.8,h=null,c=null){if(h===null)console.warn("`label_ids_to_fuse` unset. No instance will be fused."),h=new Set;let m=B.class_queries_logits??B.logits,a=(B.masks_queries_logits??B.pred_masks).sigmoid(),[n,t,W0]=m.dims;if(W0-=1,c!==null&&c.length!==n)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let o=[];for(let N0=0;N0<n;++N0){let w0=c!==null?c[N0]:null,I=m[N0],O=a[N0],[p,Z0,z0]=y(I,O,F,W0);if(z0.length===0){let[h0,d0]=w0??O.dims.slice(-2),T0=new Q.Tensor("int32",new Int32Array(h0*d0).fill(-1),[h0,d0]);o.push({segmentation:T0,segments_info:[]});continue}let[A0,j0]=j(p,Z0,z0,P,_,h,w0);o.push({segmentation:A0,segments_info:j0})}return o}function A(B,F=0.5,P=null){throw Error("`post_process_instance_segmentation` is not yet implemented.")}class T extends W.Callable{constructor(B){super();if(this.image_mean=B.image_mean??B.mean,this.image_std=B.image_std??B.std,this.resample=B.resample??2,this.do_rescale=B.do_rescale??!0,this.rescale_factor=B.rescale_factor??0.00392156862745098,this.do_normalize=B.do_normalize,this.do_thumbnail=B.do_thumbnail,this.size=B.size??B.image_size,this.do_resize=B.do_resize??this.size!==void 0,this.size_divisibility=B.size_divisibility??B.size_divisor,this.do_center_crop=B.do_center_crop,this.crop_size=B.crop_size,this.do_convert_rgb=B.do_convert_rgb??!0,this.do_crop_margin=B.do_crop_margin,this.pad_size=B.pad_size,this.do_pad=B.do_pad,this.min_pixels=B.min_pixels,this.max_pixels=B.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0)this.pad_size=this.size;this.do_flip_channel_order=B.do_flip_channel_order??!1,this.config=B}async thumbnail(B,F,P=2){let{height:_,width:h}=B,c=F.height,m=F.width,d=Math.min(_,c),a=Math.min(h,m);if(d===_&&a===h)return B;if(_>h)a=Math.floor(h*d/_);else if(h>_)d=Math.floor(_*a/h);return await B.resize(a,d,{resample:P})}async crop_margin(B,F=200){let P=B.clone().grayscale(),_=(0,Y.min)(P.data)[0],c=(0,Y.max)(P.data)[0]-_;if(c===0)return B;let m=F/255,d=P.width,a=P.height,n=0,t=0,W0=P.data;for(let o=0;o<P.height;++o){let N0=o*P.width;for(let w0=0;w0<P.width;++w0)if((W0[N0+w0]-_)/c<m)d=Math.min(d,w0),a=Math.min(a,o),n=Math.max(n,w0),t=Math.max(t,o)}return B=await B.crop([d,a,n,t]),B}pad_image(B,F,P,{mode:_="constant",center:h=!1,constant_values:c=0}={}){let[m,d,a]=F,n,t;if(typeof P==="number")n=P,t=P;else if(P==="square")n=t=Math.max(m,d);else n=P.width,t=P.height;if(n!==d||t!==m){let W0=new Float32Array(n*t*a);if(Array.isArray(c))for(let w0=0;w0<W0.length;++w0)W0[w0]=c[w0%a];else if(c!==0)W0.fill(c);let[o,N0]=h?[Math.floor((n-d)/2),Math.floor((t-m)/2)]:[0,0];for(let w0=0;w0<m;++w0){let I=(w0+N0)*n,O=w0*d;for(let p=0;p<d;++p){let Z0=(I+p+o)*a,z0=(O+p)*a;for(let A0=0;A0<a;++A0)W0[Z0+A0]=B[z0+A0]}}if(_==="symmetric"){if(h)throw Error("`center` padding is not supported when `mode` is set to `symmetric`.");let w0=m-1,I=d-1;for(let O=0;O<t;++O){let p=O*n,Z0=(0,G.calculateReflectOffset)(O,w0)*d;for(let z0=0;z0<n;++z0){if(O<m&&z0<d)continue;let A0=(p+z0)*a,j0=(Z0+(0,G.calculateReflectOffset)(z0,I))*a;for(let h0=0;h0<a;++h0)W0[A0+h0]=B[j0+h0]}}}B=W0,F=[t,n,a]}return[B,F]}rescale(B){for(let F=0;F<B.length;++F)B[F]=this.rescale_factor*B[F]}get_resize_output_image_size(B,F){let[P,_]=B.size,h,c;if(this.do_thumbnail){let{height:m,width:d}=F;h=Math.min(m,d)}else if(Number.isInteger(F))h=F,c=this.config.max_size??h;else if(F!==void 0)h=F.shortest_edge,c=F.longest_edge;if(h!==void 0||c!==void 0){let m=h===void 0?1:Math.max(h/P,h/_),d=P*m,a=_*m,n=c===void 0?1:Math.min(c/d,c/a),t=Math.floor(Number((d*n).toFixed(2))),W0=Math.floor(Number((a*n).toFixed(2)));if(this.size_divisibility!==void 0)[t,W0]=N([t,W0],this.size_divisibility);return[t,W0]}else if(F!==void 0&&F.width!==void 0&&F.height!==void 0){let{width:m,height:d}=F;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let a=d/_,n=m/P;if(Math.abs(1-n)<Math.abs(1-a))a=n;else n=a;d=V(a*_,this.config.ensure_multiple_of),m=V(n*P,this.config.ensure_multiple_of)}return[m,d]}else if(this.size_divisibility!==void 0)return N([P,_],this.size_divisibility);else if(this.min_pixels!==void 0&&this.max_pixels!==void 0){let m=this.config.patch_size*this.config.merge_size;return v(_,P,m,this.min_pixels,this.max_pixels)}else throw Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(F)}`)}async resize(B){let[F,P]=this.get_resize_output_image_size(B,this.size);return await B.resize(F,P,{resample:this.resample})}async preprocess(B,{do_normalize:F=null,do_pad:P=null,do_convert_rgb:_=null,do_convert_grayscale:h=null,do_flip_channel_order:c=null}={}){if(this.do_crop_margin)B=await this.crop_margin(B);let[m,d]=B.size;if(_??this.do_convert_rgb)B=B.rgb();else if(h)B=B.grayscale();if(this.do_resize)B=await this.resize(B);if(this.do_thumbnail)B=await this.thumbnail(B,this.size,this.resample);if(this.do_center_crop){let o,N0;if(Number.isInteger(this.crop_size))o=this.crop_size,N0=this.crop_size;else o=this.crop_size.width,N0=this.crop_size.height;B=await B.center_crop(o,N0)}let a=[B.height,B.width],n=Float32Array.from(B.data),t=[B.height,B.width,B.channels];if(this.do_rescale)this.rescale(n);if(F??this.do_normalize){let o=this.image_mean;if(!Array.isArray(this.image_mean))o=Array(B.channels).fill(o);let N0=this.image_std;if(!Array.isArray(this.image_std))N0=Array(B.channels).fill(o);if(o.length!==B.channels||N0.length!==B.channels)throw Error(`When set to arrays, the length of \`image_mean\` (${o.length}) and \`image_std\` (${N0.length}) must match the number of channels in the image (${B.channels}).`);for(let w0=0;w0<n.length;w0+=B.channels)for(let I=0;I<B.channels;++I)n[w0+I]=(n[w0+I]-o[I])/N0[I]}if(P??this.do_pad){if(this.pad_size)[n,t]=this.pad_image(n,[B.height,B.width,B.channels],this.pad_size);else if(this.size_divisibility){let[o,N0]=N([t[1],t[0]],this.size_divisibility);[n,t]=this.pad_image(n,t,{width:o,height:N0})}}if(c??this.do_flip_channel_order){if(t[2]!==3)throw Error("Flipping channel order is only supported for RGB images.");for(let o=0;o<n.length;o+=3){let N0=n[o];n[o]=n[o+2],n[o+2]=N0}}let W0=new Q.Tensor("float32",n,t).permute(2,0,1);return{original_size:[d,m],reshaped_input_size:a,pixel_values:W0}}async _call(B,...F){if(!Array.isArray(B))B=[B];let P=await Promise.all(B.map((h)=>this.preprocess(h)));return{pixel_values:(0,Q.stack)(P.map((h)=>h.pixel_values),0),original_sizes:P.map((h)=>h.original_size),reshaped_input_sizes:P.map((h)=>h.reshaped_input_size)}}static async from_pretrained(B,F={}){let P=await(0,q.getModelJSON)(B,E.IMAGE_PROCESSOR_NAME,!0,F);return new this(P)}}},"./src/base/processing_utils.js":(J,Z,$)=>{/*!**************************************!*\
  !*** ./src/base/processing_utils.js ***!
  \**************************************/$.r(Z),$.d(Z,{Processor:()=>H});var W=$("./src/utils/constants.js");/*! ../utils/constants.js */var Q=$("./src/utils/generic.js");/*! ../utils/generic.js */var Y=$("./src/utils/hub.js");/*! ../utils/hub.js */class H extends Q.Callable{static classes=["image_processor_class","tokenizer_class","feature_extractor_class"];static uses_processor_config=!1;static uses_chat_template_file=!1;constructor(G,q,E){super();this.config=G,this.components=q,this.chat_template=E}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(G,q={}){if(!this.tokenizer)throw Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(G,{tokenize:!1,chat_template:this.chat_template??void 0,...q})}batch_decode(...G){if(!this.tokenizer)throw Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...G)}decode(...G){if(!this.tokenizer)throw Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...G)}async _call(G,...q){for(let E of[this.image_processor,this.feature_extractor,this.tokenizer])if(E)return E(G,...q);throw Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(G,q={}){let[E,V,N]=await Promise.all([this.uses_processor_config?(0,Y.getModelJSON)(G,W.PROCESSOR_NAME,!0,q):{},Promise.all(this.classes.filter((z)=>(z in this)).map(async(z)=>{let w=await this[z].from_pretrained(G,q);return[z.replace(/_class$/,""),w]})).then(Object.fromEntries),this.uses_chat_template_file?(0,Y.getModelText)(G,W.CHAT_TEMPLATE_NAME,!0,q):null]);return new this(E,V,N)}}},"./src/configs.js":(J,Z,$)=>{/*!************************!*\
  !*** ./src/configs.js ***!
  \************************/$.r(Z),$.d(Z,{AutoConfig:()=>V,PretrainedConfig:()=>E,getCacheShapes:()=>G});var W=$("./src/utils/core.js");/*! ./utils/core.js */var Q=$("./src/utils/hub.js");/*! ./utils/hub.js */async function Y(N,z){return await(0,Q.getModelJSON)(N,"config.json",!0,z)}function H(N){let z={},w={};switch(N.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":w=H(N.text_config);break;case"moondream1":w=H(N.phi_config);break;case"musicgen":w=H(N.decoder);break;case"multi_modality":w=H(N.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":z.num_heads="n_head",z.num_layers="n_layer",z.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":z.num_heads="num_attention_heads",z.num_layers="num_hidden_layers",z.hidden_size="hidden_size";break;case"llama":case"llama4_text":case"nanochat":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"granitemoehybrid":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":z.num_heads="num_key_value_heads",z.num_layers="num_hidden_layers",z.hidden_size="hidden_size",z.num_attention_heads="num_attention_heads",z.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"vaultgemma":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":z.num_heads="num_key_value_heads",z.num_layers="num_hidden_layers",z.dim_kv="head_dim";break;case"openelm":z.num_heads="num_kv_heads",z.num_layers="num_transformer_layers",z.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":z.num_heads="num_heads",z.num_layers="num_layers",z.hidden_size="hidden_size";break;case"bloom":z.num_heads="n_head",z.num_layers="n_layer",z.hidden_size="hidden_size";break;case"mpt":z.num_heads="n_heads",z.num_layers="n_layers",z.hidden_size="d_model";break;case"exaone":z.num_heads="num_key_value_heads",z.num_layers="num_layers",z.dim_kv="head_dim",z.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":z.num_decoder_layers="num_decoder_layers",z.num_decoder_heads="num_heads",z.decoder_dim_kv="d_kv",z.num_encoder_layers="num_layers",z.num_encoder_heads="num_heads",z.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":z.num_decoder_layers="decoder_layers",z.num_decoder_heads="decoder_attention_heads",z.decoder_hidden_size="d_model",z.num_encoder_layers="encoder_layers",z.num_encoder_heads="encoder_attention_heads",z.encoder_hidden_size="d_model";break;case"speecht5":z.num_decoder_layers="decoder_layers",z.num_decoder_heads="decoder_attention_heads",z.decoder_hidden_size="hidden_size",z.num_encoder_layers="encoder_layers",z.num_encoder_heads="encoder_attention_heads",z.encoder_hidden_size="hidden_size";break;case"trocr":z.num_encoder_layers=z.num_decoder_layers="decoder_layers",z.num_encoder_heads=z.num_decoder_heads="decoder_attention_heads",z.encoder_hidden_size=z.decoder_hidden_size="d_model";break;case"musicgen_decoder":z.num_encoder_layers=z.num_decoder_layers="num_hidden_layers",z.num_encoder_heads=z.num_decoder_heads="num_attention_heads",z.encoder_hidden_size=z.decoder_hidden_size="hidden_size";break;case"moonshine":z.num_decoder_layers="decoder_num_hidden_layers",z.num_decoder_heads="decoder_num_key_value_heads",z.num_encoder_layers="encoder_num_hidden_layers",z.num_encoder_heads="encoder_num_key_value_heads",z.encoder_hidden_size=z.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":let y=H(N.decoder),D="num_decoder_layers"in y,j=(0,W.pick)(N,["model_type","is_encoder_decoder"]);if(D)j.num_decoder_layers=y.num_decoder_layers,j.num_decoder_heads=y.num_decoder_heads,j.decoder_hidden_size=y.decoder_hidden_size,j.num_encoder_layers=y.num_encoder_layers,j.num_encoder_heads=y.num_encoder_heads,j.encoder_hidden_size=y.encoder_hidden_size;else j.num_layers=y.num_layers,j.num_heads=y.num_heads,j.hidden_size=y.hidden_size;return j}let R={...w,...(0,W.pick)(N,["model_type","multi_query","is_encoder_decoder"])};for(let y in z)R[y]=N[z[y]];return R}function G(N,z){if(N.model_type==="lfm2"){let w=z?.prefix??"past_key_values",R=w==="present"?"present":"past",y={},{layer_types:D,num_attention_heads:j,num_key_value_heads:v,hidden_size:g,conv_L_cache:A}=N,T=g/j,B=z?.batch_size??1;for(let F=0;F<D.length;++F)if(D[F]==="full_attention")for(let P of["key","value"])y[`${w}.${F}.${P}`]=[B,v,0,T];else if(D[F]==="conv")y[`${R}_conv.${F}`]=[B,g,A];else throw Error(`Unsupported layer type: ${D[F]}`);return y}return q(N,z)}function q(N,{prefix:z="past_key_values",batch_size:w=1}={}){let R={},y=N.normalized_config;if(y.is_encoder_decoder&&(("num_encoder_heads"in y)&&("num_decoder_heads"in y))){let D=y.encoder_dim_kv??y.encoder_hidden_size/y.num_encoder_heads,j=y.decoder_dim_kv??y.decoder_hidden_size/y.num_decoder_heads,v=[w,y.num_encoder_heads,0,D],g=[w,y.num_decoder_heads,0,j];for(let A=0;A<y.num_decoder_layers;++A)R[`${z}.${A}.encoder.key`]=v,R[`${z}.${A}.encoder.value`]=v,R[`${z}.${A}.decoder.key`]=g,R[`${z}.${A}.decoder.value`]=g}else{let{num_heads:D,num_layers:j}=y,v=y.dim_kv??y.hidden_size/(y.num_attention_heads??D);if(y.model_type==="falcon"){let g=[w*D,0,v];for(let A=0;A<j;++A)R[`${z}.${A}.key`]=g,R[`${z}.${A}.value`]=g}else if(y.multi_query){let g=[w*D,0,2*v];for(let A=0;A<j;++A)R[`${z}.${A}.key_value`]=g}else if(y.model_type==="bloom"){let g=[w*D,v,0],A=[w*D,0,v];for(let T=0;T<j;++T)R[`${z}.${T}.key`]=g,R[`${z}.${T}.value`]=A}else if(y.model_type==="openelm")for(let g=0;g<j;++g){let A=[w,D[g],0,v];R[`${z}.${g}.key`]=A,R[`${z}.${g}.value`]=A}else{let g=[w,D,0,v];for(let A=0;A<j;++A)R[`${z}.${A}.key`]=g,R[`${z}.${A}.value`]=g}}return R}class E{model_type=null;is_encoder_decoder=!1;max_position_embeddings;"transformers.js_config";constructor(N){Object.assign(this,N),this.normalized_config=H(this)}static async from_pretrained(N,{progress_callback:z=null,config:w=null,cache_dir:R=null,local_files_only:y=!1,revision:D="main"}={}){if(w&&!(w instanceof E))w=new E(w);let j=w??await Y(N,{progress_callback:z,config:w,cache_dir:R,local_files_only:y,revision:D});return new this(j)}}class V{static async from_pretrained(...N){return E.from_pretrained(...N)}}},"./src/env.js":(J,Z,$)=>{/*!********************!*\
  !*** ./src/env.js ***!
  \********************/$.r(Z),$.d(Z,{apis:()=>v,env:()=>P});var W=$("node:fs");/*! node:fs */var Q=$("node:path");/*! node:path */var Y=$("node:url");/*! node:url */let H="3.7.6",G=typeof window<"u"&&typeof window.document<"u",q=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes(self.constructor?.name),E=typeof self<"u"&&"caches"in self,V=typeof navigator<"u"&&"gpu"in navigator,N=typeof navigator<"u"&&"ml"in navigator,z=typeof process<"u",w=z&&process?.release?.name==="node",R=!_(W.default),y=!_(Q.default),D=typeof globalThis.Deno<"u",j=typeof globalThis.Bun<"u",v=Object.freeze({IS_BROWSER_ENV:G,IS_WEBWORKER_ENV:q,IS_WEB_CACHE_AVAILABLE:E,IS_WEBGPU_AVAILABLE:V,IS_WEBNN_AVAILABLE:N,IS_PROCESS_AVAILABLE:z,IS_NODE_ENV:w,IS_FS_AVAILABLE:R,IS_PATH_AVAILABLE:y}),g=R&&y,A="./";if(g){let h=Object(import.meta).url;if(h)A=Q.default.dirname(Q.default.dirname(Y.default.fileURLToPath(h)));else if(typeof __dirname<"u")A=Q.default.dirname(__dirname)}let T=g?Q.default.join(A,"/.cache/"):null,B="/models/",F=g?Q.default.join(A,B):B,P={version:H,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(G||q),localModelPath:F,useFS:R,useBrowserCache:E&&!D,useFSCache:R,cacheDir:T,useCustomCache:!1,customCache:null};function _(h){return Object.keys(h).length===0}},"./src/generation/configuration_utils.js":(J,Z,$)=>{/*!***********************************************!*\
  !*** ./src/generation/configuration_utils.js ***!
  \***********************************************/$.r(Z),$.d(Z,{GenerationConfig:()=>Q});var W=$("./src/utils/core.js");/*! ../utils/core.js */class Q{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=!1;max_time=null;do_sample=!1;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=!0;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=!1;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=!1;exponential_decay_length_penalty=null;suppress_tokens=null;streamer=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=!1;output_hidden_states=!1;output_scores=!1;return_dict_in_generate=!1;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(Y){Object.assign(this,(0,W.pick)(Y,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/generation/logits_process.js ***!
  \******************************************/$.r(Z),$.d(Z,{ClassifierFreeGuidanceLogitsProcessor:()=>v,ForcedBOSTokenLogitsProcessor:()=>E,ForcedEOSTokenLogitsProcessor:()=>V,LogitsProcessor:()=>H,LogitsProcessorList:()=>q,LogitsWarper:()=>G,MinLengthLogitsProcessor:()=>y,MinNewTokensLengthLogitsProcessor:()=>D,NoBadWordsLogitsProcessor:()=>j,NoRepeatNGramLogitsProcessor:()=>w,RepetitionPenaltyLogitsProcessor:()=>R,SuppressTokensAtBeginLogitsProcessor:()=>N,TemperatureLogitsWarper:()=>g,TopKLogitsWarper:()=>T,TopPLogitsWarper:()=>A,WhisperTimeStampLogitsProcessor:()=>z});var W=$("./src/utils/generic.js");/*! ../utils/generic.js */var Q=$("./src/utils/tensor.js");/*! ../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../utils/maths.js */class H extends W.Callable{_call(B,F){throw Error("`_call` should be implemented in a subclass")}}class G extends W.Callable{_call(B,F){throw Error("`_call` should be implemented in a subclass")}}class q extends W.Callable{constructor(){super();this.processors=[]}push(B){this.processors.push(B)}extend(B){this.processors.push(...B)}_call(B,F){let P=F;for(let _ of this.processors)P=_(B,P);return P}[Symbol.iterator](){return this.processors.values()}}class E extends H{constructor(B){super();this.bos_token_id=B}_call(B,F){for(let P=0;P<B.length;++P)if(B[P].length===1){let _=F[P].data;_.fill(-1/0),_[this.bos_token_id]=0}return F}}class V extends H{constructor(B,F){super();this.max_length=B,this.eos_token_id=Array.isArray(F)?F:[F]}_call(B,F){for(let P=0;P<B.length;++P)if(B[P].length===this.max_length-1){let _=F[P].data;_.fill(-1/0);for(let h of this.eos_token_id)_[h]=0}return F}}class N extends H{constructor(B,F){super();this.begin_suppress_tokens=B,this.begin_index=F}_call(B,F){for(let P=0;P<B.length;++P)if(B[P].length===this.begin_index){let _=F[P].data;for(let h of this.begin_suppress_tokens)_[h]=-1/0}return F}}class z extends H{constructor(B,F){super();if(this.eos_token_id=Array.isArray(B.eos_token_id)?B.eos_token_id[0]:B.eos_token_id,this.no_timestamps_token_id=B.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=F.length,F.at(-1)===this.no_timestamps_token_id)this.begin_index-=1;this.max_initial_timestamp_index=B.max_initial_timestamp_index}_call(B,F){for(let P=0;P<B.length;++P){let _=F[P].data;if(_[this.no_timestamps_token_id]=-1/0,B[P].length===this.begin_index-1){_.fill(-1/0),_[this.timestamp_begin]=0;continue}let h=B[P].slice(this.begin_index),c=h.length>=1&&h[h.length-1]>=this.timestamp_begin,m=h.length<2||h[h.length-2]>=this.timestamp_begin;if(c)if(m)_.subarray(this.timestamp_begin).fill(-1/0);else _.subarray(0,this.eos_token_id).fill(-1/0);if(B[P].length===this.begin_index&&this.max_initial_timestamp_index!==null){let t=this.timestamp_begin+this.max_initial_timestamp_index;_.subarray(t+1).fill(-1/0)}let d=(0,Y.log_softmax)(_),a=Math.log(d.subarray(this.timestamp_begin).map(Math.exp).reduce((t,W0)=>t+W0)),n=(0,Y.max)(d.subarray(0,this.timestamp_begin))[0];if(a>n)_.subarray(0,this.timestamp_begin).fill(-1/0)}return F}}class w extends H{constructor(B){super();this.no_repeat_ngram_size=B}getNgrams(B){let F=B.length,P=[];for(let h=0;h<F+1-this.no_repeat_ngram_size;++h){let c=[];for(let m=0;m<this.no_repeat_ngram_size;++m)c.push(B[h+m]);P.push(c.map(Number))}let _=new Map;for(let h of P){let c=h.slice(0,h.length-1),m=JSON.stringify(c),d=_.get(m)??[];d.push(h[h.length-1]),_.set(m,d)}return _}getGeneratedNgrams(B,F){let P=F.slice(F.length+1-this.no_repeat_ngram_size,F.length);return B.get(JSON.stringify(P.map(Number)))??[]}calcBannedNgramTokens(B){let F=[];if(B.length+1<this.no_repeat_ngram_size)return F;else{let P=this.getNgrams(B);return this.getGeneratedNgrams(P,B)}}_call(B,F){for(let P=0;P<B.length;++P){let _=F[P].data,h=this.calcBannedNgramTokens(B[P]);for(let c of h)_[c]=-1/0}return F}}class R extends H{constructor(B){super();this.penalty=B}_call(B,F){for(let P=0;P<B.length;++P){let _=F[P].data;for(let h of new Set(B[P])){let c=Number(h);if(_[c]<0)_[c]*=this.penalty;else _[c]/=this.penalty}}return F}}class y extends H{constructor(B,F){super();this.min_length=B,this.eos_token_id=Array.isArray(F)?F:[F]}_call(B,F){for(let P=0;P<B.length;++P)if(B[P].length<this.min_length){let _=F[P].data;for(let h of this.eos_token_id)_[h]=-1/0}return F}}class D extends H{constructor(B,F,P){super();this.prompt_length_to_skip=B,this.min_new_tokens=F,this.eos_token_id=Array.isArray(P)?P:[P]}_call(B,F){for(let P=0;P<B.length;++P)if(B[P].length-this.prompt_length_to_skip<this.min_new_tokens){let h=F[P].data;for(let c of this.eos_token_id)h[c]=-1/0}return F}}class j extends H{constructor(B,F){super();this.bad_words_ids=B,this.eos_token_id=Array.isArray(F)?F:[F]}_call(B,F){for(let P=0;P<B.length;++P){let _=F[P].data,h=B[P];for(let c of this.bad_words_ids){if(h.length<c.length-1)continue;let m=!0;for(let d=1;d<=c.length-1;++d)if(c.at(-d-1)!=h.at(-d)){m=!1;break}if(m)_[c.at(-1)]=-1/0}}return F}}class v extends H{constructor(B){super();if(B<=1)throw Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${B}.`);this.guidance_scale=B}_call(B,F){if(F.dims[0]!==2*B.length)throw Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${F.dims[0]} for the logits and ${B.length} for the input ids.`);let P=B.length,_=F.slice([0,P],null),h=F.slice([P,F.dims[0]],null);for(let c=0;c<h.data.length;++c)h.data[c]+=(_.data[c]-h.data[c])*this.guidance_scale;return h}}class g extends G{constructor(B){super();if(typeof B!=="number"||B<=0){let F=`\`temperature\` (=${B}) must be a strictly positive float, otherwise your next token scores will be invalid.`;if(B===0)F+=" If you're looking for greedy decoding strategies, set `do_sample=false`."}this.temperature=B}_call(B,F){let P=F.data;for(let _=0;_<P.length;++_)P[_]/=this.temperature;return F}}class A extends G{constructor(B,{filter_value:F=-1/0,min_tokens_to_keep:P=1}={}){super();if(B<0||B>1)throw Error(`\`top_p\` must be a float > 0 and < 1, but is ${B}`);if(!Number.isInteger(P)||P<1)throw Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${P}`);this.top_p=B,this.filter_value=F,this.min_tokens_to_keep=P}}class T extends G{constructor(B,{filter_value:F=-1/0,min_tokens_to_keep:P=1}={}){super();if(!Number.isInteger(B)||B<0)throw Error(`\`top_k\` must be a positive integer, but is ${B}`);this.top_k=Math.max(B,P),this.filter_value=F}}},"./src/generation/logits_sampler.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/generation/logits_sampler.js ***!
  \******************************************/$.r(Z),$.d(Z,{LogitsSampler:()=>G});var W=$("./src/utils/generic.js");/*! ../utils/generic.js */var Q=$("./src/utils/tensor.js");/*! ../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../utils/maths.js */var H=$("./src/generation/configuration_utils.js");/*! ../generation/configuration_utils.js */class G extends W.Callable{constructor(N){super();this.generation_config=N}async _call(N){return this.sample(N)}async sample(N){throw Error("sample should be implemented in subclasses.")}getLogits(N,z){let w=N.dims.at(-1),R=N.data;if(z===-1)R=R.slice(-w);else{let y=z*w;R=R.slice(y,y+w)}return R}randomSelect(N){let z=0;for(let R=0;R<N.length;++R)z+=N[R];let w=Math.random()*z;for(let R=0;R<N.length;++R)if(w-=N[R],w<=0)return R;return 0}static getSampler(N){if(N.do_sample)return new E(N);else if(N.num_beams>1)return new V(N);else{if(N.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${N.num_return_sequences}.`);return new q(N)}}}class q extends G{async sample(N){let z=(0,Y.max)(N.data)[1];return[[BigInt(z),0]]}}class E extends G{async sample(N){let z=N.dims.at(-1);if(this.generation_config.top_k>0)z=Math.min(this.generation_config.top_k,z);let[w,R]=await(0,Q.topk)(N,z),y=(0,Y.softmax)(w.data);return Array.from({length:this.generation_config.num_beams},()=>{let D=this.randomSelect(y);return[R.data[D],Math.log(y[D])]})}}class V extends G{async sample(N){let z=N.dims.at(-1);if(this.generation_config.top_k>0)z=Math.min(this.generation_config.top_k,z);let[w,R]=await(0,Q.topk)(N,z),y=(0,Y.softmax)(w.data);return Array.from({length:this.generation_config.num_beams},(D,j)=>{return[R.data[j],Math.log(y[j])]})}}},"./src/generation/stopping_criteria.js":(J,Z,$)=>{/*!*********************************************!*\
  !*** ./src/generation/stopping_criteria.js ***!
  \*********************************************/$.r(Z),$.d(Z,{EosTokenCriteria:()=>G,InterruptableStoppingCriteria:()=>q,MaxLengthCriteria:()=>H,StoppingCriteria:()=>Q,StoppingCriteriaList:()=>Y});var W=$("./src/utils/generic.js");/*! ../utils/generic.js */class Q extends W.Callable{_call(E,V){throw Error("StoppingCriteria needs to be subclassed")}}class Y extends W.Callable{constructor(){super();this.criteria=[]}push(E){this.criteria.push(E)}extend(E){if(E instanceof Y)E=E.criteria;else if(E instanceof Q)E=[E];this.criteria.push(...E)}_call(E,V){let N=Array(E.length).fill(!1);for(let z of this.criteria){let w=z(E,V);for(let R=0;R<N.length;++R)N[R]||=w[R]}return N}[Symbol.iterator](){return this.criteria.values()}}class H extends Q{constructor(E,V=null){super();this.max_length=E,this.max_position_embeddings=V}_call(E){return E.map((V)=>V.length>=this.max_length)}}class G extends Q{constructor(E){super();if(!Array.isArray(E))E=[E];this.eos_token_id=E}_call(E,V){return E.map((N)=>{let z=N.at(-1);return this.eos_token_id.some((w)=>z==w)})}}class q extends Q{constructor(){super();this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(E,V){return Array(E.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(J,Z,$)=>{/*!*************************************!*\
  !*** ./src/generation/streamers.js ***!
  \*************************************/$.r(Z),$.d(Z,{BaseStreamer:()=>H,TextStreamer:()=>q,WhisperTextStreamer:()=>E});var W=$("./src/utils/core.js");/*! ../utils/core.js */var Q=$("./src/tokenizers.js");/*! ../tokenizers.js */var Y=$("./src/env.js");/*! ../env.js */class H{put(V){throw Error("Not implemented")}end(){throw Error("Not implemented")}}let G=Y.apis.IS_PROCESS_AVAILABLE?(V)=>process.stdout.write(V):(V)=>console.log(V);class q extends H{constructor(V,{skip_prompt:N=!1,callback_function:z=null,token_callback_function:w=null,skip_special_tokens:R=!0,decode_kwargs:y={},...D}={}){super();this.tokenizer=V,this.skip_prompt=N,this.callback_function=z??G,this.token_callback_function=w,this.decode_kwargs={skip_special_tokens:R,...y,...D},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(V){if(V.length>1)throw Error("TextStreamer only supports batch size of 1");let N=this.next_tokens_are_prompt;if(N){if(this.next_tokens_are_prompt=!1,this.skip_prompt)return}let z=V[0];this.token_callback_function?.(z),this.token_cache=(0,W.mergeArrays)(this.token_cache,z);let w=this.tokenizer.decode(this.token_cache,this.decode_kwargs),R;if(N||w.endsWith(`
`))R=w.slice(this.print_len),this.token_cache=[],this.print_len=0;else if(w.length>0&&(0,Q.is_chinese_char)(w.charCodeAt(w.length-1)))R=w.slice(this.print_len),this.print_len+=R.length;else R=w.slice(this.print_len,w.lastIndexOf(" ")+1),this.print_len+=R.length;this.on_finalized_text(R,!1)}end(){let V;if(this.token_cache.length>0)V=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0;else V="";this.next_tokens_are_prompt=!0,this.on_finalized_text(V,!0)}on_finalized_text(V,N){if(V.length>0)this.callback_function?.(V);if(N&&this.callback_function===G&&Y.apis.IS_PROCESS_AVAILABLE)this.callback_function?.(`
`)}}class E extends q{constructor(V,{skip_prompt:N=!1,callback_function:z=null,token_callback_function:w=null,on_chunk_start:R=null,on_chunk_end:y=null,on_finalize:D=null,time_precision:j=0.02,skip_special_tokens:v=!0,decode_kwargs:g={}}={}){super(V,{skip_prompt:N,skip_special_tokens:v,callback_function:z,token_callback_function:w,decode_kwargs:g});this.timestamp_begin=V.timestamp_begin,this.on_chunk_start=R,this.on_chunk_end=y,this.on_finalize=D,this.time_precision=j,this.waiting_for_timestamp=!1}put(V){if(V.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");let N=V[0];if(N.length===1){let z=Number(N[0])-this.timestamp_begin;if(z>=0){let w=z*this.time_precision;if(this.waiting_for_timestamp)this.on_chunk_end?.(w);else this.on_chunk_start?.(w);this.waiting_for_timestamp=!this.waiting_for_timestamp,this.token_callback_function?.(N);return}}return super.put(V)}end(){super.end(),this.on_finalize?.()}}},"./src/models.js":(J,Z,$)=>{/*!***********************!*\
  !*** ./src/models.js ***!
  \***********************/$.r(Z),$.d(Z,{ASTForAudioClassification:()=>w8,ASTModel:()=>D8,ASTPreTrainedModel:()=>r5,AlbertForMaskedLM:()=>L6,AlbertForQuestionAnswering:()=>k0,AlbertForSequenceClassification:()=>f0,AlbertModel:()=>O0,AlbertPreTrainedModel:()=>_0,ArceeForCausalLM:()=>AW,ArceeModel:()=>LW,ArceePreTrainedModel:()=>N$,AutoModel:()=>LG,AutoModelForAudioClassification:()=>OG,AutoModelForAudioFrameClassification:()=>hG,AutoModelForAudioTextToText:()=>pG,AutoModelForCTC:()=>vG,AutoModelForCausalLM:()=>wG,AutoModelForDepthEstimation:()=>gG,AutoModelForDocumentQuestionAnswering:()=>fG,AutoModelForImageClassification:()=>SG,AutoModelForImageFeatureExtraction:()=>mG,AutoModelForImageMatting:()=>dG,AutoModelForImageSegmentation:()=>MG,AutoModelForImageTextToText:()=>aG,AutoModelForImageToImage:()=>uG,AutoModelForMaskGeneration:()=>yG,AutoModelForMaskedLM:()=>jG,AutoModelForNormalEstimation:()=>lG,AutoModelForObjectDetection:()=>_G,AutoModelForPoseEstimation:()=>cG,AutoModelForQuestionAnswering:()=>PG,AutoModelForSemanticSegmentation:()=>TG,AutoModelForSeq2SeqLM:()=>FG,AutoModelForSequenceClassification:()=>AG,AutoModelForSpeechSeq2Seq:()=>RG,AutoModelForTextToSpectrogram:()=>IG,AutoModelForTextToWaveform:()=>DG,AutoModelForTokenClassification:()=>BG,AutoModelForUniversalSegmentation:()=>kG,AutoModelForVision2Seq:()=>CG,AutoModelForXVector:()=>bG,AutoModelForZeroShotObjectDetection:()=>xG,BartForConditionalGeneration:()=>n6,BartForSequenceClassification:()=>N4,BartModel:()=>M6,BartPretrainedModel:()=>b4,BaseModelOutput:()=>B0,BeitForImageClassification:()=>d7,BeitModel:()=>f7,BeitPreTrainedModel:()=>p$,BertForMaskedLM:()=>Y0,BertForQuestionAnswering:()=>R0,BertForSequenceClassification:()=>E0,BertForTokenClassification:()=>X0,BertModel:()=>F0,BertPreTrainedModel:()=>I0,BlenderbotForConditionalGeneration:()=>u6,BlenderbotModel:()=>d6,BlenderbotPreTrainedModel:()=>h6,BlenderbotSmallForConditionalGeneration:()=>L5,BlenderbotSmallModel:()=>vJ,BlenderbotSmallPreTrainedModel:()=>z4,BloomForCausalLM:()=>G7,BloomModel:()=>Y7,BloomPreTrainedModel:()=>v$,CLIPModel:()=>h8,CLIPPreTrainedModel:()=>wJ,CLIPSegForImageSegmentation:()=>n8,CLIPSegModel:()=>e8,CLIPSegPreTrainedModel:()=>W$,CLIPTextModel:()=>hY,CLIPTextModelWithProjection:()=>f8,CLIPVisionModel:()=>fY,CLIPVisionModelWithProjection:()=>d8,CamembertForMaskedLM:()=>t0,CamembertForQuestionAnswering:()=>E6,CamembertForSequenceClassification:()=>v0,CamembertForTokenClassification:()=>V6,CamembertModel:()=>c0,CamembertPreTrainedModel:()=>L0,CausalLMOutput:()=>NJ,CausalLMOutputWithPast:()=>eG,ChineseCLIPModel:()=>m8,ChineseCLIPPreTrainedModel:()=>c8,ClapAudioModelWithProjection:()=>r9,ClapModel:()=>a9,ClapPreTrainedModel:()=>C5,ClapTextModelWithProjection:()=>p9,CodeGenForCausalLM:()=>qW,CodeGenModel:()=>XW,CodeGenPreTrainedModel:()=>H$,CohereForCausalLM:()=>dW,CohereModel:()=>fW,CoherePreTrainedModel:()=>j$,ConvBertForMaskedLM:()=>QJ,ConvBertForQuestionAnswering:()=>YJ,ConvBertForSequenceClassification:()=>KJ,ConvBertForTokenClassification:()=>H6,ConvBertModel:()=>Z6,ConvBertPreTrainedModel:()=>v4,ConvNextForImageClassification:()=>yQ,ConvNextModel:()=>xQ,ConvNextPreTrainedModel:()=>GZ,ConvNextV2ForImageClassification:()=>OQ,ConvNextV2Model:()=>vQ,ConvNextV2PreTrainedModel:()=>XZ,DFineForObjectDetection:()=>t7,DFineModel:()=>i7,DFinePreTrainedModel:()=>t$,DINOv3ConvNextModel:()=>cQ,DINOv3ConvNextPreTrainedModel:()=>lQ,DINOv3ViTModel:()=>gQ,DINOv3ViTPreTrainedModel:()=>uQ,DPTForDepthEstimation:()=>zQ,DPTModel:()=>NQ,DPTPreTrainedModel:()=>QZ,DacDecoderModel:()=>OK,DacDecoderOutput:()=>xK,DacEncoderModel:()=>vK,DacEncoderOutput:()=>_K,DacModel:()=>yK,DacPreTrainedModel:()=>y5,DebertaForMaskedLM:()=>V4,DebertaForQuestionAnswering:()=>p6,DebertaForSequenceClassification:()=>R4,DebertaForTokenClassification:()=>Z4,DebertaModel:()=>j6,DebertaPreTrainedModel:()=>x6,DebertaV2ForMaskedLM:()=>l4,DebertaV2ForQuestionAnswering:()=>c4,DebertaV2ForSequenceClassification:()=>O4,DebertaV2ForTokenClassification:()=>GJ,DebertaV2Model:()=>g4,DebertaV2PreTrainedModel:()=>I4,DecisionTransformerModel:()=>zK,DecisionTransformerPreTrainedModel:()=>NK,DeiTForImageClassification:()=>WQ,DeiTModel:()=>ZQ,DeiTPreTrainedModel:()=>JZ,DepthAnythingForDepthEstimation:()=>LQ,DepthAnythingPreTrainedModel:()=>EQ,DepthProForDepthEstimation:()=>IQ,DepthProPreTrainedModel:()=>RQ,DetrForObjectDetection:()=>g7,DetrForSegmentation:()=>r$,DetrModel:()=>u7,DetrObjectDetectionOutput:()=>e$,DetrPreTrainedModel:()=>R5,DetrSegmentationOutput:()=>l7,Dinov2ForImageClassification:()=>hQ,Dinov2Model:()=>bQ,Dinov2PreTrainedModel:()=>qZ,Dinov2WithRegistersForImageClassification:()=>dQ,Dinov2WithRegistersModel:()=>fQ,Dinov2WithRegistersPreTrainedModel:()=>HZ,DistilBertForMaskedLM:()=>m4,DistilBertForQuestionAnswering:()=>qJ,DistilBertForSequenceClassification:()=>x4,DistilBertForTokenClassification:()=>XJ,DistilBertModel:()=>_4,DistilBertPreTrainedModel:()=>j4,DonutSwinModel:()=>_Q,DonutSwinPreTrainedModel:()=>kQ,EfficientNetForImageClassification:()=>JK,EfficientNetModel:()=>o9,EfficientNetPreTrainedModel:()=>IZ,ElectraForMaskedLM:()=>C,ElectraForQuestionAnswering:()=>G0,ElectraForSequenceClassification:()=>f,ElectraForTokenClassification:()=>r,ElectraModel:()=>u,ElectraPreTrainedModel:()=>L,Ernie4_5_ForCausalLM:()=>u9,Ernie4_5_Model:()=>d9,Ernie4_5_PretrainedModel:()=>LZ,EsmForMaskedLM:()=>HJ,EsmForSequenceClassification:()=>Y4,EsmForTokenClassification:()=>P0,EsmModel:()=>a4,EsmPreTrainedModel:()=>P4,ExaoneForCausalLM:()=>SW,ExaoneModel:()=>CW,ExaonePreTrainedModel:()=>B$,FalconForCausalLM:()=>m9,FalconModel:()=>c9,FalconPreTrainedModel:()=>BZ,FastViTForImageClassification:()=>S7,FastViTModel:()=>C7,FastViTPreTrainedModel:()=>g$,Florence2ForConditionalGeneration:()=>k8,Florence2PreTrainedModel:()=>T8,GLPNForDepthEstimation:()=>TQ,GLPNModel:()=>MQ,GLPNPreTrainedModel:()=>YZ,GPT2LMHeadModel:()=>i8,GPT2Model:()=>s8,GPT2PreTrainedModel:()=>Q$,GPTBigCodeForCausalLM:()=>GW,GPTBigCodeModel:()=>YW,GPTBigCodePreTrainedModel:()=>q$,GPTJForCausalLM:()=>KW,GPTJModel:()=>QW,GPTJPreTrainedModel:()=>X$,GPTNeoForCausalLM:()=>$W,GPTNeoModel:()=>JW,GPTNeoPreTrainedModel:()=>Y$,GPTNeoXForCausalLM:()=>WW,GPTNeoXModel:()=>ZW,GPTNeoXPreTrainedModel:()=>G$,Gemma2ForCausalLM:()=>cW,Gemma2Model:()=>lW,Gemma2PreTrainedModel:()=>C$,Gemma3ForCausalLM:()=>rW,Gemma3Model:()=>pW,Gemma3PreTrainedModel:()=>M$,Gemma3nForConditionalGeneration:()=>o5,Gemma3nPreTrainedModel:()=>v8,GemmaForCausalLM:()=>gW,GemmaModel:()=>uW,GemmaPreTrainedModel:()=>P$,GlmForCausalLM:()=>PW,GlmModel:()=>jW,GlmPreTrainedModel:()=>A$,GraniteForCausalLM:()=>OW,GraniteModel:()=>vW,GraniteMoeHybridForCausalLM:()=>hW,GraniteMoeHybridModel:()=>bW,GraniteMoeHybridPreTrainedModel:()=>w$,GranitePreTrainedModel:()=>D$,GroundingDinoForObjectDetection:()=>aQ,GroundingDinoPreTrainedModel:()=>mQ,GroupViTModel:()=>P7,GroupViTPreTrainedModel:()=>j7,HeliumForCausalLM:()=>wW,HeliumModel:()=>DW,HeliumPreTrainedModel:()=>L$,HieraForImageClassification:()=>KQ,HieraModel:()=>QQ,HieraPreTrainedModel:()=>$Z,HubertForCTC:()=>w9,HubertForSequenceClassification:()=>j9,HubertModel:()=>D9,HubertPreTrainedModel:()=>dY,IJepaForImageClassification:()=>E7,IJepaModel:()=>z7,IJepaPreTrainedModel:()=>f$,Idefics3ForConditionalGeneration:()=>B5,Idefics3PreTrainedModel:()=>O8,ImageMattingOutput:()=>mK,JAISLMHeadModel:()=>o8,JAISModel:()=>t8,JAISPreTrainedModel:()=>K$,JinaCLIPModel:()=>a8,JinaCLIPPreTrainedModel:()=>F5,JinaCLIPTextModel:()=>p8,JinaCLIPVisionModel:()=>r8,Lfm2ForCausalLM:()=>FW,Lfm2Model:()=>BW,Lfm2PreTrainedModel:()=>z$,LiteWhisperForConditionalGeneration:()=>P8,Llama4ForCausalLM:()=>NW,Llama4PreTrainedModel:()=>VW,LlamaForCausalLM:()=>UW,LlamaModel:()=>HW,LlamaPreTrainedModel:()=>U$,LlavaForConditionalGeneration:()=>A5,LlavaOnevisionForConditionalGeneration:()=>S8,LlavaPreTrainedModel:()=>t5,LlavaQwen2ForCausalLM:()=>y8,LongT5ForConditionalGeneration:()=>e6,LongT5Model:()=>W4,LongT5PreTrainedModel:()=>v6,M2M100ForConditionalGeneration:()=>$9,M2M100Model:()=>J9,M2M100PreTrainedModel:()=>NZ,MBartForCausalLM:()=>s6,MBartForConditionalGeneration:()=>Q4,MBartForSequenceClassification:()=>h4,MBartModel:()=>r4,MBartPreTrainedModel:()=>D4,MPNetForMaskedLM:()=>xJ,MPNetForQuestionAnswering:()=>U,MPNetForSequenceClassification:()=>yJ,MPNetForTokenClassification:()=>oJ,MPNetModel:()=>_J,MPNetPreTrainedModel:()=>C4,MT5ForConditionalGeneration:()=>G4,MT5Model:()=>DJ,MT5PreTrainedModel:()=>S4,MarianMTModel:()=>oQ,MarianModel:()=>tQ,MarianPreTrainedModel:()=>VZ,MaskFormerForInstanceSegmentation:()=>SQ,MaskFormerModel:()=>CQ,MaskFormerPreTrainedModel:()=>KZ,MaskedLMOutput:()=>c6,Metric3DForDepthEstimation:()=>wQ,Metric3DPreTrainedModel:()=>DQ,Metric3Dv2ForDepthEstimation:()=>PQ,Metric3Dv2PreTrainedModel:()=>jQ,MgpstrForSceneTextRecognition:()=>FK,MgpstrModelOutput:()=>AK,MgpstrPreTrainedModel:()=>BK,MimiDecoderModel:()=>kK,MimiDecoderOutput:()=>SK,MimiEncoderModel:()=>TK,MimiEncoderOutput:()=>CK,MimiModel:()=>MK,MimiPreTrainedModel:()=>x5,MistralForCausalLM:()=>f9,MistralModel:()=>h9,MistralPreTrainedModel:()=>EZ,MobileBertForMaskedLM:()=>P6,MobileBertForQuestionAnswering:()=>p4,MobileBertForSequenceClassification:()=>UJ,MobileBertModel:()=>m0,MobileBertPreTrainedModel:()=>S0,MobileLLMForCausalLM:()=>TW,MobileLLMModel:()=>MW,MobileLLMPreTrainedModel:()=>F$,MobileNetV1ForImageClassification:()=>ZK,MobileNetV1ForSemanticSegmentation:()=>WK,MobileNetV1Model:()=>$K,MobileNetV1PreTrainedModel:()=>M5,MobileNetV2ForImageClassification:()=>KK,MobileNetV2ForSemanticSegmentation:()=>YK,MobileNetV2Model:()=>QK,MobileNetV2PreTrainedModel:()=>T5,MobileNetV3ForImageClassification:()=>XK,MobileNetV3ForSemanticSegmentation:()=>qK,MobileNetV3Model:()=>GK,MobileNetV3PreTrainedModel:()=>k5,MobileNetV4ForImageClassification:()=>UK,MobileNetV4ForSemanticSegmentation:()=>VK,MobileNetV4Model:()=>HK,MobileNetV4PreTrainedModel:()=>_5,MobileViTForImageClassification:()=>_7,MobileViTModel:()=>k7,MobileViTPreTrainedModel:()=>l$,MobileViTV2ForImageClassification:()=>y7,MobileViTV2Model:()=>x7,MobileViTV2PreTrainedModel:()=>c$,ModelOutput:()=>Q0,ModernBertDecoderForCausalLM:()=>a6,ModernBertDecoderModel:()=>Q6,ModernBertDecoderPreTrainedModel:()=>B6,ModernBertForMaskedLM:()=>i0,ModernBertForSequenceClassification:()=>a0,ModernBertForTokenClassification:()=>n0,ModernBertModel:()=>y0,ModernBertPreTrainedModel:()=>l0,Moondream1ForConditionalGeneration:()=>M8,MoonshineForConditionalGeneration:()=>C8,MoonshineModel:()=>bY,MoonshinePreTrainedModel:()=>s5,MptForCausalLM:()=>q7,MptModel:()=>X7,MptPreTrainedModel:()=>O$,MultiModalityCausalLM:()=>LK,MultiModalityPreTrainedModel:()=>EK,MusicgenForCausalLM:()=>cY,MusicgenForConditionalGeneration:()=>wZ,MusicgenModel:()=>lY,MusicgenPreTrainedModel:()=>DZ,NanoChatForCausalLM:()=>EW,NanoChatModel:()=>zW,NanoChatPreTrainedModel:()=>V$,NeoBertForMaskedLM:()=>U0,NeoBertForQuestionAnswering:()=>s0,NeoBertForSequenceClassification:()=>u0,NeoBertForTokenClassification:()=>b0,NeoBertModel:()=>x0,NeoBertPreTrainedModel:()=>C0,NomicBertModel:()=>U4,NomicBertPreTrainedModel:()=>H4,OPTForCausalLM:()=>U7,OPTModel:()=>H7,OPTPreTrainedModel:()=>b$,Olmo2ForCausalLM:()=>yW,Olmo2Model:()=>xW,Olmo2PreTrainedModel:()=>I$,OlmoForCausalLM:()=>_W,OlmoModel:()=>kW,OlmoPreTrainedModel:()=>R$,OpenELMForCausalLM:()=>nW,OpenELMModel:()=>eW,OpenELMPreTrainedModel:()=>T$,OwlViTForObjectDetection:()=>O7,OwlViTModel:()=>v7,OwlViTPreTrainedModel:()=>m$,Owlv2ForObjectDetection:()=>h7,Owlv2Model:()=>b7,Owlv2PreTrainedModel:()=>a$,PaliGemmaForConditionalGeneration:()=>x8,PaliGemmaPreTrainedModel:()=>_8,ParakeetForCTC:()=>G9,ParakeetPreTrainedModel:()=>Y9,PatchTSMixerForPrediction:()=>wK,PatchTSMixerModel:()=>DK,PatchTSMixerPreTrainedModel:()=>PZ,PatchTSTForPrediction:()=>IK,PatchTSTModel:()=>RK,PatchTSTPreTrainedModel:()=>jZ,Phi3ForCausalLM:()=>K7,Phi3Model:()=>Q7,Phi3PreTrainedModel:()=>y$,Phi3VForCausalLM:()=>$$,Phi3VPreTrainedModel:()=>b8,PhiForCausalLM:()=>W7,PhiModel:()=>Z7,PhiPreTrainedModel:()=>x$,PreTrainedModel:()=>S,PretrainedMixin:()=>F6,PvtForImageClassification:()=>F7,PvtModel:()=>B7,PvtPreTrainedModel:()=>d$,PyAnnoteForAudioFrameClassification:()=>q9,PyAnnoteModel:()=>X9,PyAnnotePreTrainedModel:()=>zZ,QuestionAnsweringModelOutput:()=>J4,Qwen2ForCausalLM:()=>iW,Qwen2Model:()=>sW,Qwen2PreTrainedModel:()=>k$,Qwen2VLForConditionalGeneration:()=>$7,Qwen2VLPreTrainedModel:()=>J7,Qwen3ForCausalLM:()=>oW,Qwen3Model:()=>tW,Qwen3PreTrainedModel:()=>_$,RFDetrForObjectDetection:()=>n7,RFDetrModel:()=>e7,RFDetrObjectDetectionOutput:()=>s7,RFDetrPreTrainedModel:()=>i$,RTDetrForObjectDetection:()=>m7,RTDetrModel:()=>c7,RTDetrObjectDetectionOutput:()=>J5,RTDetrPreTrainedModel:()=>n$,RTDetrV2ForObjectDetection:()=>p7,RTDetrV2Model:()=>a7,RTDetrV2ObjectDetectionOutput:()=>r7,RTDetrV2PreTrainedModel:()=>s$,ResNetForImageClassification:()=>GQ,ResNetModel:()=>YQ,ResNetPreTrainedModel:()=>ZZ,RoFormerForMaskedLM:()=>o6,RoFormerForQuestionAnswering:()=>kJ,RoFormerForSequenceClassification:()=>IJ,RoFormerForTokenClassification:()=>TJ,RoFormerModel:()=>_6,RoFormerPreTrainedModel:()=>k4,RobertaForMaskedLM:()=>X8,RobertaForQuestionAnswering:()=>U8,RobertaForSequenceClassification:()=>q8,RobertaForTokenClassification:()=>H8,RobertaModel:()=>G8,RobertaPreTrainedModel:()=>OJ,SamImageSegmentationOutput:()=>iQ,SamModel:()=>sQ,SamPreTrainedModel:()=>nQ,SapiensForDepthEstimation:()=>BQ,SapiensForNormalEstimation:()=>FQ,SapiensForSemanticSegmentation:()=>AQ,SapiensPreTrainedModel:()=>D5,SegformerForImageClassification:()=>n9,SegformerForSemanticSegmentation:()=>s9,SegformerModel:()=>gY,SegformerPreTrainedModel:()=>S5,Seq2SeqLMOutput:()=>rG,SequenceClassifierOutput:()=>q6,SiglipModel:()=>u8,SiglipPreTrainedModel:()=>Z$,SiglipTextModel:()=>g8,SiglipVisionModel:()=>l8,SmolLM3ForCausalLM:()=>IW,SmolLM3Model:()=>RW,SmolLM3PreTrainedModel:()=>E$,SmolVLMForConditionalGeneration:()=>J$,SnacDecoderModel:()=>fK,SnacEncoderModel:()=>hK,SnacModel:()=>bK,SnacPreTrainedModel:()=>v5,SpeechT5ForSpeechToText:()=>x9,SpeechT5ForTextToSpeech:()=>y9,SpeechT5HifiGan:()=>v9,SpeechT5Model:()=>uY,SpeechT5PreTrainedModel:()=>P5,SqueezeBertForMaskedLM:()=>s,SqueezeBertForQuestionAnswering:()=>V0,SqueezeBertForSequenceClassification:()=>$0,SqueezeBertModel:()=>l,SqueezeBertPreTrainedModel:()=>k,StableLmForCausalLM:()=>t9,StableLmModel:()=>i9,StableLmPreTrainedModel:()=>RZ,Starcoder2ForCausalLM:()=>l9,Starcoder2Model:()=>g9,Starcoder2PreTrainedModel:()=>AZ,StyleTextToSpeech2Model:()=>_9,StyleTextToSpeech2PreTrainedModel:()=>k9,Swin2SRForImageSuperResolution:()=>VQ,Swin2SRModel:()=>UQ,Swin2SRPreTrainedModel:()=>WZ,SwinForImageClassification:()=>qQ,SwinForSemanticSegmentation:()=>HQ,SwinModel:()=>XQ,SwinPreTrainedModel:()=>I5,T5ForConditionalGeneration:()=>r6,T5Model:()=>y6,T5PreTrainedModel:()=>X6,TableTransformerForObjectDetection:()=>JQ,TableTransformerModel:()=>o7,TableTransformerObjectDetectionOutput:()=>$Q,TableTransformerPreTrainedModel:()=>o$,TokenClassifierOutput:()=>g6,TrOCRForCausalLM:()=>b9,TrOCRPreTrainedModel:()=>O9,UltravoxModel:()=>CZ,UltravoxPreTrainedModel:()=>jK,UniSpeechForCTC:()=>N9,UniSpeechForSequenceClassification:()=>z9,UniSpeechModel:()=>V9,UniSpeechPreTrainedModel:()=>w5,UniSpeechSatForAudioFrameClassification:()=>B9,UniSpeechSatForCTC:()=>L9,UniSpeechSatForSequenceClassification:()=>A9,UniSpeechSatModel:()=>E9,UniSpeechSatPreTrainedModel:()=>$5,VaultGemmaForCausalLM:()=>aW,VaultGemmaModel:()=>mW,VaultGemmaPreTrainedModel:()=>S$,ViTForImageClassification:()=>N7,ViTMAEModel:()=>I7,ViTMAEPreTrainedModel:()=>R7,ViTMSNForImageClassification:()=>w7,ViTMSNModel:()=>D7,ViTMSNPreTrainedModel:()=>u$,ViTModel:()=>V7,ViTPreTrainedModel:()=>h$,VisionEncoderDecoderModel:()=>i5,VitMatteForImageMatting:()=>T7,VitMattePreTrainedModel:()=>M7,VitPoseForPoseEstimation:()=>A7,VitPosePreTrainedModel:()=>L7,VitsModel:()=>FZ,VitsModelOutput:()=>aK,VitsPreTrainedModel:()=>e9,VoxtralForConditionalGeneration:()=>PK,Wav2Vec2BertForCTC:()=>R9,Wav2Vec2BertForSequenceClassification:()=>I9,Wav2Vec2BertModel:()=>F9,Wav2Vec2BertPreTrainedModel:()=>j5,Wav2Vec2ForAudioFrameClassification:()=>K9,Wav2Vec2ForCTC:()=>W9,Wav2Vec2ForSequenceClassification:()=>Q9,Wav2Vec2Model:()=>Z9,Wav2Vec2PreTrainedModel:()=>VJ,WavLMForAudioFrameClassification:()=>T9,WavLMForCTC:()=>C9,WavLMForSequenceClassification:()=>S9,WavLMForXVector:()=>M9,WavLMModel:()=>P9,WavLMPreTrainedModel:()=>fJ,WeSpeakerResNetModel:()=>U9,WeSpeakerResNetPreTrainedModel:()=>H9,WhisperForConditionalGeneration:()=>n5,WhisperModel:()=>j8,WhisperPreTrainedModel:()=>e5,XLMForQuestionAnswering:()=>L8,XLMForSequenceClassification:()=>z8,XLMForTokenClassification:()=>E8,XLMModel:()=>V8,XLMPreTrainedModel:()=>bJ,XLMRobertaForMaskedLM:()=>B8,XLMRobertaForQuestionAnswering:()=>I8,XLMRobertaForSequenceClassification:()=>F8,XLMRobertaForTokenClassification:()=>R8,XLMRobertaModel:()=>A8,XLMRobertaPreTrainedModel:()=>hJ,XLMWithLMHeadModel:()=>N8,XVectorOutput:()=>cK,YolosForObjectDetection:()=>rQ,YolosModel:()=>pQ,YolosObjectDetectionOutput:()=>eQ,YolosPreTrainedModel:()=>UZ});var W=$("./src/configs.js");/*! ./configs.js */var Q=$("./src/backends/onnx.js");/*! ./backends/onnx.js */var Y=$("./src/utils/dtypes.js");/*! ./utils/dtypes.js */var H=$("./src/utils/generic.js");/*! ./utils/generic.js */var G=$("./src/utils/core.js");/*! ./utils/core.js */var q=$("./src/utils/hub.js");/*! ./utils/hub.js */var E=$("./src/utils/constants.js");/*! ./utils/constants.js */var V=$("./src/generation/logits_process.js");/*! ./generation/logits_process.js */var N=$("./src/generation/configuration_utils.js");/*! ./generation/configuration_utils.js */var z=$("./src/utils/tensor.js");/*! ./utils/tensor.js */var w=$("./src/utils/image.js");/*! ./utils/image.js */var R=$("./src/utils/maths.js");/*! ./utils/maths.js */var y=$("./src/generation/stopping_criteria.js");/*! ./generation/stopping_criteria.js */var D=$("./src/generation/logits_sampler.js");/*! ./generation/logits_sampler.js */var j=$("./src/env.js");/*! ./env.js */var v=$("./src/models/whisper/generation_whisper.js");/*! ./models/whisper/generation_whisper.js */var g=$("./src/models/whisper/common_whisper.js");/*! ./models/whisper/common_whisper.js */let A={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12},T=new Map,B=new Map,F=new Map;async function P(X,M,e){let J0=e.config?.["transformers.js_config"]??{},q0=e.device??J0.device;if(q0&&typeof q0!=="string")if(q0.hasOwnProperty(M))q0=q0[M];else console.warn(`device not specified for "${M}". Using the default device.`),q0=null;let H0=q0??(j.apis.IS_NODE_ENV?"cpu":"wasm"),D0=(0,Q.deviceToExecutionProviders)(H0),M0=J0.device_config??{};if(M0.hasOwnProperty(H0))J0={...J0,...M0[H0]};let g0=e.dtype??J0.dtype;if(typeof g0!=="string")if(g0&&g0.hasOwnProperty(M))g0=g0[M];else g0=Y.DEFAULT_DEVICE_DTYPE_MAPPING[H0]??Y.DATA_TYPES.fp32,console.warn(`dtype not specified for "${M}". Using the default dtype (${g0}) for this device (${H0}).`);if(g0===Y.DATA_TYPES.auto){let A6=J0.dtype;if(typeof A6!=="string")A6=A6?.[M];if(A6&&A6!==Y.DATA_TYPES.auto&&Y.DATA_TYPES.hasOwnProperty(A6))g0=A6;else g0=Y.DEFAULT_DEVICE_DTYPE_MAPPING[H0]??Y.DATA_TYPES.fp32}let K6=g0;if(!Y.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(K6))throw Error(`Invalid dtype: ${K6}. Should be one of: ${Object.keys(Y.DATA_TYPES).join(", ")}`);else if(K6===Y.DATA_TYPES.fp16&&H0==="webgpu"&&!await(0,Y.isWebGpuFp16Supported)())throw Error(`The device (${H0}) does not support fp16.`);let W6=J0.kv_cache_dtype,N6=W6?typeof W6==="string"?W6:W6[K6]??"float32":void 0;if(N6&&!["float32","float16"].includes(N6))throw Error(`Invalid kv_cache_dtype: ${N6}. Should be one of: float32, float16`);let o0={dtype:K6,kv_cache_dtype:N6,device:H0},I6=Y.DEFAULT_DTYPE_SUFFIX_MAPPING[K6],G6=`${M}${I6}.onnx`,Y6=`${e.subfolder??""}/${G6}`,U6={...e.session_options};U6.executionProviders??=D0;let D6=J0.free_dimension_overrides;if(D6)U6.freeDimensionOverrides??=D6;else if(H0.startsWith("webnn")&&!U6.freeDimensionOverrides)console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${H0}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);let T6=j.apis.IS_NODE_ENV&&j.env.useFSCache,E4=(0,q.getModelFile)(X,Y6,!0,e,T6),O6=e.use_external_data_format??J0.use_external_data_format,C6=[];if(O6){let A6;if(typeof O6==="object")if(O6.hasOwnProperty(G6))A6=O6[G6];else if(O6.hasOwnProperty(M))A6=O6[M];else A6=!1;else A6=O6;let l6=+A6;if(l6>q.MAX_EXTERNAL_DATA_CHUNKS)throw Error(`The number of external data chunks (${l6}) exceeds the maximum allowed value (${q.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let e4=0;e4<l6;++e4){let K4=`${G6}_data${e4===0?"":"_"+e4}`,f4=`${e.subfolder??""}/${K4}`;C6.push(new Promise(async(dJ,SZ)=>{let uJ=await(0,q.getModelFile)(X,f4,!0,e,T6);dJ(uJ instanceof Uint8Array?{path:K4,data:uJ}:K4)}))}}else if(U6.externalData!==void 0)C6=U6.externalData.map(async(A6)=>{if(typeof A6.data==="string"){let l6=await(0,q.getModelFile)(X,A6.data,!0,e);return{...A6,data:l6}}return A6});if(C6.length>0){let A6=await Promise.all(C6);if(!j.apis.IS_NODE_ENV)U6.externalData=A6}if(H0==="webgpu"){let A6=(0,W.getCacheShapes)(e.config,{prefix:"present"});if(Object.keys(A6).length>0&&!(0,Q.isONNXProxy)()){let l6={};for(let e4 in A6)l6[e4]="gpu-buffer";U6.preferredOutputLocation=l6}}return{buffer_or_path:await E4,session_options:U6,session_config:o0}}async function _(X,M,e){return Object.fromEntries(await Promise.all(Object.keys(M).map(async(J0)=>{let{buffer_or_path:q0,session_options:H0,session_config:D0}=await P(X,M[J0],e),M0=await(0,Q.createInferenceSession)(q0,H0,D0);return[J0,M0]})))}async function h(X,M,e){return Object.fromEntries(await Promise.all(Object.keys(M).map(async(J0)=>{let q0=await(0,q.getModelJSON)(X,M[J0],!1,e);return[J0,q0]})))}function c(X,M){let e=Object.create(null),J0=[];for(let D0 of X.inputNames){let M0=M[D0];if(!(M0 instanceof z.Tensor)){J0.push(D0);continue}e[D0]=(0,Q.isONNXProxy)()?M0.clone():M0}if(J0.length>0)throw Error(`An error occurred during model execution: "Missing the following inputs: ${J0.join(", ")}.`);let q0=Object.keys(M).length,H0=X.inputNames.length;if(q0>H0){let D0=Object.keys(M).filter((M0)=>!X.inputNames.includes(M0));console.warn(`WARNING: Too many inputs were provided (${q0} > ${H0}). The following inputs will be ignored: "${D0.join(", ")}".`)}return e}async function m(X,M){let e=c(X,M);try{let J0=Object.fromEntries(Object.entries(e).map(([H0,D0])=>[H0,D0.ort_tensor])),q0=await(0,Q.runInferenceSession)(X,J0);return d(q0)}catch(J0){let q0=Object.fromEntries(Object.entries(e).map(([H0,D0])=>{let M0={type:D0.type,dims:D0.dims,location:D0.location};if(M0.location!=="gpu-buffer")M0.data=D0.data;return[H0,M0]}));throw console.error(`An error occurred during model execution: "${J0}".`),console.error("Inputs given to model:",q0),J0}}function d(X){for(let M in X)if((0,Q.isONNXTensor)(X[M]))X[M]=new z.Tensor(X[M]);else if(typeof X[M]==="object")d(X[M]);return X}function a(X){if(X instanceof z.Tensor)return X;if(X.length===0)throw Error("items must be non-empty");if(Array.isArray(X[0])){if(X.some((M)=>M.length!==X[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new z.Tensor("int64",BigInt64Array.from(X.flat().map((M)=>BigInt(M))),[X.length,X[0].length])}else return new z.Tensor("int64",BigInt64Array.from(X.map((M)=>BigInt(M))),[1,X.length])}function n(X){return new z.Tensor("bool",[X],[1])}async function t(X,M){let{encoder_outputs:e,input_ids:J0,decoder_input_ids:q0,...H0}=M;if(!e){let M0=(0,G.pick)(M,X.sessions.model.inputNames);e=(await W0(X,M0)).last_hidden_state}if(H0.input_ids=q0,H0.encoder_hidden_states=e,X.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask"))H0.encoder_attention_mask=M.attention_mask;return await N0(X,H0,!0)}async function W0(X,M){let e=X.sessions.model,J0=(0,G.pick)(M,e.inputNames);if(e.inputNames.includes("inputs_embeds")&&!J0.inputs_embeds){if(!M.input_ids)throw Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");J0.inputs_embeds=await X.encode_text({input_ids:M.input_ids})}if(e.inputNames.includes("token_type_ids")&&!J0.token_type_ids){if(!J0.input_ids)throw Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");J0.token_type_ids=(0,z.zeros_like)(J0.input_ids)}if(e.inputNames.includes("pixel_mask")&&!J0.pixel_mask){if(!J0.pixel_values)throw Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");let q0=J0.pixel_values.dims;J0.pixel_mask=(0,z.ones)([q0[0],q0[2],q0[3]])}return await m(e,J0)}async function o(X,M){let e=await X.encode(M);return await X.decode(e)}async function N0(X,M,e=!1){let J0=X.sessions[e?"decoder_model_merged":"model"],{past_key_values:q0,...H0}=M;if(J0.inputNames.includes("use_cache_branch"))H0.use_cache_branch=n(!!q0);if(J0.inputNames.includes("position_ids")&&H0.attention_mask&&!H0.position_ids){let M0=["paligemma","gemma3_text","gemma3"].includes(X.config.model_type)?1:0;H0.position_ids=j0(H0,q0,M0)}X.addPastKeyValues(H0,q0);let D0=(0,G.pick)(H0,J0.inputNames);return await m(J0,D0)}function w0({modality_token_id:X,inputs_embeds:M,modality_features:e,input_ids:J0,attention_mask:q0}){let H0=J0.tolist().map((K6)=>K6.reduce((W6,N6,o0)=>{if(N6==X)W6.push(o0);return W6},[])),D0=H0.reduce((K6,W6)=>K6+W6.length,0),M0=e.dims[0];if(D0!==M0)throw Error(`Number of tokens and features do not match: tokens: ${D0}, features ${M0}`);let g0=0;for(let K6=0;K6<H0.length;++K6){let W6=H0[K6],N6=M[K6];for(let o0=0;o0<W6.length;++o0)N6[W6[o0]].data.set(e[g0++].data)}return{inputs_embeds:M,attention_mask:q0}}function I({image_token_id:X,inputs_embeds:M,image_features:e,input_ids:J0,attention_mask:q0}){return w0({modality_token_id:X,inputs_embeds:M,modality_features:e,input_ids:J0,attention_mask:q0})}function O({audio_token_id:X,inputs_embeds:M,audio_features:e,input_ids:J0,attention_mask:q0}){return w0({modality_token_id:X,inputs_embeds:M,modality_features:e,input_ids:J0,attention_mask:q0})}async function p(X,{encode_function:M,merge_function:e,modality_input_name:J0,modality_output_name:q0,input_ids:H0=null,attention_mask:D0=null,position_ids:M0=null,inputs_embeds:g0=null,past_key_values:K6=null,generation_config:W6=null,logits_processor:N6=null,...o0}){let I6=o0[J0];if(!g0){if(g0=await X.encode_text({input_ids:H0,...o0}),I6&&H0.dims[1]!==1){let Y6=await M({[J0]:I6,...o0});({inputs_embeds:g0,attention_mask:D0}=e({[q0]:Y6,inputs_embeds:g0,input_ids:H0,attention_mask:D0}))}else if(K6&&I6&&H0.dims[1]===1){let Y6=H0.dims[1],U6=Object.values(K6)[0].dims.at(-2);D0=(0,z.cat)([(0,z.ones)([H0.dims[0],U6]),D0.slice(null,[D0.dims[1]-Y6,D0.dims[1]])],1)}}if(!M0){if(X.config.model_type==="qwen2_vl"){let{image_grid_thw:Y6,video_grid_thw:U6}=o0;[M0]=X.get_rope_index(H0,Y6,U6,D0)}}return await N0(X,{inputs_embeds:g0,past_key_values:K6,attention_mask:D0,position_ids:M0,generation_config:W6,logits_processor:N6},!0)}async function Z0(X,M){return await p(X,{...M,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:X.encode_audio.bind(X),merge_function:X._merge_input_ids_with_audio_features.bind(X)})}async function z0(X,M){return await p(X,{...M,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:X.encode_image.bind(X),merge_function:X._merge_input_ids_with_image_features.bind(X)})}function A0(X,M=0){let[e,J0]=X.dims,q0=X.data,H0=new BigInt64Array(q0.length);for(let D0=0;D0<e;++D0){let M0=D0*J0,g0=BigInt(M);for(let K6=0;K6<J0;++K6){let W6=M0+K6;if(q0[W6]===0n)H0[W6]=BigInt(1);else H0[W6]=g0,g0+=q0[W6]}}return{data:H0,dims:X.dims}}function j0(X,M=null,e=0){let{input_ids:J0,inputs_embeds:q0,attention_mask:H0}=X,{data:D0,dims:M0}=A0(H0,e),g0=new z.Tensor("int64",D0,M0);if(M){let K6=-(J0??q0).dims.at(1);g0=g0.slice(null,[K6,null])}return g0}function h0(X,M,e,J0){let q0=e.past_key_values?Object.values(e.past_key_values)[0].dims.at(-2):0;if(!e.attention_mask){let H0;for(let D0 of["input_ids","inputs_embeds","position_ids"])if(e[D0]){H0=e[D0].dims;break}if(!H0)throw Error("attention_mask is not provided, and unable to infer its shape from model inputs.");e.attention_mask=(0,z.ones)([H0[0],q0+H0[1]])}if(e.past_key_values){let{input_ids:H0,attention_mask:D0}=e;if(D0&&D0.dims[1]>H0.dims[1]);else if(q0<H0.dims[1])e.input_ids=H0.slice(null,[q0,null])}return e}function d0(X,M,e,J0){if(e.past_key_values)M=M.map((q0)=>[q0.at(-1)]);return{...e,decoder_input_ids:a(M)}}function T0(X,...M){if(X.config.is_encoder_decoder)return d0(X,...M);else return h0(X,...M)}function b(X,M,e,J0){let q0=!!e.past_key_values;if(J0.guidance_scale!==null&&J0.guidance_scale>1)if(q0)e.input_ids=(0,z.cat)([e.input_ids,e.input_ids],0);else e.input_ids=(0,z.cat)([e.input_ids,(0,z.full_like)(e.input_ids,BigInt(J0.pad_token_id))],0),e.attention_mask=(0,z.cat)([e.attention_mask,(0,z.full_like)(e.attention_mask,0n)],0);if(q0||!e.pixel_values)e.pixel_values=(0,z.full)([0,0,3,384,384],1);if(q0)e.images_seq_mask=new z.Tensor("bool",[,].fill(!0).fill(!1,0,1),[1,1]),e.images_emb_mask=new z.Tensor("bool",[].fill(!1),[1,1,0]);return e}class S extends H.Callable{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(X,M,e){super();this.config=X,this.sessions=M,this.configs=e;let J0=F.get(this.constructor),q0=T.get(J0);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,q0){case A.DecoderOnly:this.can_generate=!0,this._forward=N0,this._prepare_inputs_for_generation=h0;break;case A.Seq2Seq:case A.Vision2Seq:case A.Musicgen:this.can_generate=!0,this._forward=t,this._prepare_inputs_for_generation=d0;break;case A.EncoderDecoder:this._forward=t;break;case A.ImageTextToText:this.can_generate=!0,this._forward=z0,this._prepare_inputs_for_generation=T0;break;case A.AudioTextToText:this.can_generate=!0,this._forward=Z0,this._prepare_inputs_for_generation=T0;break;case A.Phi3V:case A.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=T0;break;case A.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=b;break;case A.AutoEncoder:this._forward=o;break;default:this._forward=W0;break}if(this.can_generate)this.forward_params.push("past_key_values");this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){let X=[];for(let M of Object.values(this.sessions))if(M?.handler?.dispose)X.push(M.handler.dispose());return await Promise.all(X)}static async from_pretrained(X,{progress_callback:M=null,config:e=null,cache_dir:J0=null,local_files_only:q0=!1,revision:H0="main",model_file_name:D0=null,subfolder:M0="onnx",device:g0=null,dtype:K6=null,use_external_data_format:W6=null,session_options:N6={}}={}){let o0={progress_callback:M,config:e,cache_dir:J0,local_files_only:q0,revision:H0,model_file_name:D0,subfolder:M0,device:g0,dtype:K6,use_external_data_format:W6,session_options:N6},I6=F.get(this),G6=T.get(I6);e=o0.config=await W.AutoConfig.from_pretrained(X,o0);let Y6;if(G6===A.DecoderOnly)Y6=await Promise.all([_(X,{model:o0.model_file_name??"model"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.Seq2Seq||G6===A.Vision2Seq)Y6=await Promise.all([_(X,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.MaskGeneration)Y6=await Promise.all([_(X,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},o0)]);else if(G6===A.EncoderDecoder)Y6=await Promise.all([_(X,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},o0)]);else if(G6===A.ImageTextToText){let U6={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};if(e.is_encoder_decoder)U6.model="encoder_model";Y6=await Promise.all([_(X,U6,o0),h(X,{generation_config:"generation_config.json"},o0)])}else if(G6===A.AudioTextToText)Y6=await Promise.all([_(X,{embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.ImageAudioTextToText)Y6=await Promise.all([_(X,{embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.Musicgen)Y6=await Promise.all([_(X,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.MultiModality)Y6=await Promise.all([_(X,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.Phi3V)Y6=await Promise.all([_(X,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.AutoEncoder)Y6=await Promise.all([_(X,{encoder_model:"encoder_model",decoder_model:"decoder_model"},o0)]);else{if(G6!==A.EncoderOnly){let U6=I6??e?.model_type;if(U6!=="custom")console.warn(`Model type for '${U6}' not found, assuming encoder-only architecture. Please report this at ${E.GITHUB_ISSUE_URL}.`)}Y6=await Promise.all([_(X,{model:o0.model_file_name??"model"},o0)])}return new this(e,...Y6)}async _call(X){return await this.forward(X)}async forward(X){return await this._forward(this,X)}get generation_config(){return this.configs?.generation_config??null}_get_logits_processor(X,M,e=null){let J0=new V.LogitsProcessorList;if(X.repetition_penalty!==null&&X.repetition_penalty!==1)J0.push(new V.RepetitionPenaltyLogitsProcessor(X.repetition_penalty));if(X.no_repeat_ngram_size!==null&&X.no_repeat_ngram_size>0)J0.push(new V.NoRepeatNGramLogitsProcessor(X.no_repeat_ngram_size));if(X.bad_words_ids!==null)J0.push(new V.NoBadWordsLogitsProcessor(X.bad_words_ids,X.eos_token_id));if(X.min_length!==null&&X.eos_token_id!==null&&X.min_length>0)J0.push(new V.MinLengthLogitsProcessor(X.min_length,X.eos_token_id));if(X.min_new_tokens!==null&&X.eos_token_id!==null&&X.min_new_tokens>0)J0.push(new V.MinNewTokensLengthLogitsProcessor(M,X.min_new_tokens,X.eos_token_id));if(X.forced_bos_token_id!==null)J0.push(new V.ForcedBOSTokenLogitsProcessor(X.forced_bos_token_id));if(X.forced_eos_token_id!==null)J0.push(new V.ForcedEOSTokenLogitsProcessor(X.max_length,X.forced_eos_token_id));if(X.begin_suppress_tokens!==null){let q0=M>1||X.forced_bos_token_id===null?M:M+1;J0.push(new V.SuppressTokensAtBeginLogitsProcessor(X.begin_suppress_tokens,q0))}if(X.guidance_scale!==null&&X.guidance_scale>1)J0.push(new V.ClassifierFreeGuidanceLogitsProcessor(X.guidance_scale));if(X.temperature===0&&X.do_sample)console.warn("`do_sample` changed to false because `temperature: 0` implies greedy sampling (always selecting the most likely token), which is incompatible with `do_sample: true`."),X.do_sample=!1;if(X.do_sample){if(X.temperature!==null&&X.temperature!==1)J0.push(new V.TemperatureLogitsWarper(X.temperature))}if(e!==null)J0.extend(e);return J0}_prepare_generation_config(X,M,e=N.GenerationConfig){let J0={...this.config};for(let H0 of["decoder","generator","text_config"])if(H0 in J0)Object.assign(J0,J0[H0]);let q0=new e(J0);if(Object.assign(q0,this.generation_config??{}),X)Object.assign(q0,X);if(M)Object.assign(q0,(0,G.pick)(M,Object.getOwnPropertyNames(q0)));return q0}_get_stopping_criteria(X,M=null){let e=new y.StoppingCriteriaList;if(X.max_length!==null)e.push(new y.MaxLengthCriteria(X.max_length,this.config.max_position_embeddings??null));if(X.eos_token_id!==null)e.push(new y.EosTokenCriteria(X.eos_token_id));if(M)e.extend(M);return e}_validate_model_class(){if(!this.can_generate){let X=[gK,lK,uK,dK],M=F.get(this.constructor),e=new Set,J0=this.config.model_type;for(let H0 of X){let D0=H0.get(J0);if(D0)e.add(D0[0])}let q0=`The current model class (${M}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;if(e.size>0)q0+=` Please use the following class instead: ${[...e].join(", ")}`;throw Error(q0)}}prepare_inputs_for_generation(...X){return this._prepare_inputs_for_generation(this,...X)}_update_model_kwargs_for_generation({generated_input_ids:X,outputs:M,model_inputs:e,is_encoder_decoder:J0}){if(e.past_key_values=this.getPastKeyValues(M,e.past_key_values),e.input_ids=new z.Tensor("int64",X.flat(),[X.length,1]),!J0)e.attention_mask=(0,z.cat)([e.attention_mask,(0,z.ones)([e.attention_mask.dims[0],1])],1);else if("decoder_attention_mask"in e);return e.position_ids=null,e}_prepare_model_inputs({inputs:X,bos_token_id:M,model_kwargs:e}){let J0=(0,G.pick)(e,this.forward_params),q0=this.main_input_name;if(q0 in J0){if(X)throw Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else J0[q0]=X;return{inputs_tensor:J0[q0],model_inputs:J0,model_input_name:q0}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:X,model_inputs:M,model_input_name:e,generation_config:J0}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!M.inputs_embeds&&"_prepare_inputs_embeds"in this){let{input_ids:H0,pixel_values:D0,attention_mask:M0,...g0}=M,K6=await this._prepare_inputs_embeds(M);M={...g0,...(0,G.pick)(K6,["inputs_embeds","attention_mask"])}}let{last_hidden_state:q0}=await W0(this,M);if(J0.guidance_scale!==null&&J0.guidance_scale>1){if(q0=(0,z.cat)([q0,(0,z.full_like)(q0,0)],0),"attention_mask"in M)M.attention_mask=(0,z.cat)([M.attention_mask,(0,z.zeros_like)(M.attention_mask)],0)}else if(M.decoder_input_ids){let H0=a(M.decoder_input_ids).dims[0];if(H0!==q0.dims[0]){if(q0.dims[0]!==1)throw Error(`The encoder outputs have a different batch size (${q0.dims[0]}) than the decoder inputs (${H0}).`);q0=(0,z.cat)(Array.from({length:H0},()=>q0),0)}}return M.encoder_outputs=q0,M}_prepare_decoder_input_ids_for_generation({batch_size:X,model_input_name:M,model_kwargs:e,decoder_start_token_id:J0,bos_token_id:q0,generation_config:H0}){let{decoder_input_ids:D0,...M0}=e;if(!(D0 instanceof z.Tensor)){if(!D0)if(J0??=q0,this.config.model_type==="musicgen")D0=Array.from({length:X*this.config.decoder.num_codebooks},()=>[J0]);else if(Array.isArray(J0)){if(J0.length!==X)throw Error(`\`decoder_start_token_id\` expcted to have length ${X} but got ${J0.length}`);D0=J0}else D0=Array.from({length:X},()=>[J0]);else if(!Array.isArray(D0[0]))D0=Array.from({length:X},()=>D0);D0=a(D0)}return e.decoder_attention_mask=(0,z.ones_like)(D0),{input_ids:D0,model_inputs:M0}}async generate({inputs:X=null,generation_config:M=null,logits_processor:e=null,stopping_criteria:J0=null,streamer:q0=null,...H0}){this._validate_model_class(),M=this._prepare_generation_config(M,H0);let{inputs_tensor:D0,model_inputs:M0,model_input_name:g0}=this._prepare_model_inputs({inputs:X,model_kwargs:H0}),K6=this.config.is_encoder_decoder;if(!K6);else if(!("encoder_outputs"in M0))M0=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:D0,model_inputs:M0,model_input_name:g0,generation_config:M});let W6;if(K6)({input_ids:W6,model_inputs:M0}=this._prepare_decoder_input_ids_for_generation({batch_size:M0[g0].dims.at(0),model_input_name:g0,model_kwargs:M0,decoder_start_token_id:M.decoder_start_token_id,bos_token_id:M.bos_token_id,generation_config:M}));else W6=M0[g0];let N6=W6.dims.at(-1);if(M.max_new_tokens!==null)M.max_length=N6+M.max_new_tokens;let o0=this._get_logits_processor(M,N6,e),I6=this._get_stopping_criteria(M,J0),G6=M0[g0].dims.at(0),Y6=D.LogitsSampler.getSampler(M),U6=Array(G6).fill(0),D6=W6.tolist();if(q0)q0.put(D6);let T6,E4={};while(!0){if(M0=this.prepare_inputs_for_generation(D6,M0,M),T6=await this.forward(M0),M.output_attentions&&M.return_dict_in_generate){let K4=this.getAttentions(T6);for(let f4 in K4){if(!(f4 in E4))E4[f4]=[];E4[f4].push(K4[f4])}}let i6=T6.logits.slice(null,-1,null),A6=o0(D6,i6),l6=[];for(let K4=0;K4<A6.dims.at(0);++K4){let f4=A6[K4],dJ=await Y6(f4);for(let[SZ,uJ]of dJ){let O5=BigInt(SZ);U6[K4]+=uJ,D6[K4].push(O5),l6.push([O5]);break}}if(q0)q0.put(l6);if(I6(D6).every((K4)=>K4))break;M0=this._update_model_kwargs_for_generation({generated_input_ids:l6,outputs:T6,model_inputs:M0,is_encoder_decoder:K6})}if(q0)q0.end();let O6=this.getPastKeyValues(T6,M0.past_key_values,!0),C6=new z.Tensor("int64",D6.flat(),[D6.length,D6[0].length]);if(M.return_dict_in_generate)return{sequences:C6,past_key_values:O6,...E4};else{for(let i6 of Object.values(T6))if(i6.location==="gpu-buffer")i6.dispose();return C6}}getPastKeyValues(X,M,e=!1){let J0=Object.create(null);for(let q0 in X)if(q0.startsWith("present")){let H0=q0.replace("present_conv","past_conv").replace("present","past_key_values"),D0=q0.includes("encoder");if(D0&&M)J0[H0]=M[H0];else J0[H0]=X[q0];if(M&&(!D0||e)){let M0=M[H0];if(M0.location==="gpu-buffer")M0.dispose()}}return J0}getAttentions(X){let M={};for(let e of["cross_attentions","encoder_attentions","decoder_attentions"])for(let J0 in X)if(J0.startsWith(e)){if(!(e in M))M[e]=[];M[e].push(X[J0])}return M}addPastKeyValues(X,M){if(M)Object.assign(X,M);else{let e=this.sessions.decoder_model_merged??this.sessions.model,J0=(X[this.main_input_name]??X.attention_mask)?.dims?.[0]??1,q0=e?.config?.kv_cache_dtype??"float32",H0=q0==="float16"?z.DataTypeMap.float16:z.DataTypeMap.float32,D0=(0,W.getCacheShapes)(this.config,{batch_size:J0});for(let M0 in D0){let g0=D0[M0].reduce((K6,W6)=>K6*W6,1);X[M0]=new z.Tensor(q0,new H0(g0),D0[M0])}}}async encode_image({pixel_values:X}){return(await m(this.sessions.vision_encoder,{pixel_values:X})).image_features}async encode_text({input_ids:X}){return(await m(this.sessions.embed_tokens,{input_ids:X})).inputs_embeds}async encode_audio({audio_values:X}){return(await m(this.sessions.audio_encoder,{audio_values:X})).audio_features}}class Q0{}class B0 extends Q0{constructor({last_hidden_state:X,hidden_states:M=null,attentions:e=null}){super();this.last_hidden_state=X,this.hidden_states=M,this.attentions=e}}class I0 extends S{}class F0 extends I0{}class Y0 extends I0{async _call(X){return new c6(await super._call(X))}}class E0 extends I0{async _call(X){return new q6(await super._call(X))}}class X0 extends I0{async _call(X){return new g6(await super._call(X))}}class R0 extends I0{async _call(X){return new J4(await super._call(X))}}class C0 extends S{}class x0 extends C0{}class U0 extends C0{async _call(X){return new c6(await super._call(X))}}class u0 extends C0{async _call(X){return new q6(await super._call(X))}}class b0 extends C0{async _call(X){return new g6(await super._call(X))}}class s0 extends C0{async _call(X){return new J4(await super._call(X))}}class l0 extends S{}class y0 extends l0{}class i0 extends l0{async _call(X){return new c6(await super._call(X))}}class a0 extends l0{async _call(X){return new q6(await super._call(X))}}class n0 extends l0{async _call(X){return new g6(await super._call(X))}}class B6 extends S{}class Q6 extends B6{}class a6 extends B6{}class H4 extends S{}class U4 extends H4{}class k4 extends S{}class _6 extends k4{}class o6 extends k4{async _call(X){return new c6(await super._call(X))}}class IJ extends k4{async _call(X){return new q6(await super._call(X))}}class TJ extends k4{async _call(X){return new g6(await super._call(X))}}class kJ extends k4{async _call(X){return new J4(await super._call(X))}}class v4 extends S{}class Z6 extends v4{}class QJ extends v4{async _call(X){return new c6(await super._call(X))}}class KJ extends v4{async _call(X){return new q6(await super._call(X))}}class H6 extends v4{async _call(X){return new g6(await super._call(X))}}class YJ extends v4{async _call(X){return new J4(await super._call(X))}}class L extends S{}class u extends L{}class C extends L{async _call(X){return new c6(await super._call(X))}}class f extends L{async _call(X){return new q6(await super._call(X))}}class r extends L{async _call(X){return new g6(await super._call(X))}}class G0 extends L{async _call(X){return new J4(await super._call(X))}}class L0 extends S{}class c0 extends L0{}class t0 extends L0{async _call(X){return new c6(await super._call(X))}}class v0 extends L0{async _call(X){return new q6(await super._call(X))}}class V6 extends L0{async _call(X){return new g6(await super._call(X))}}class E6 extends L0{async _call(X){return new J4(await super._call(X))}}class x6 extends S{}class j6 extends x6{}class V4 extends x6{async _call(X){return new c6(await super._call(X))}}class R4 extends x6{async _call(X){return new q6(await super._call(X))}}class Z4 extends x6{async _call(X){return new g6(await super._call(X))}}class p6 extends x6{async _call(X){return new J4(await super._call(X))}}class I4 extends S{}class g4 extends I4{}class l4 extends I4{async _call(X){return new c6(await super._call(X))}}class O4 extends I4{async _call(X){return new q6(await super._call(X))}}class GJ extends I4{async _call(X){return new g6(await super._call(X))}}class c4 extends I4{async _call(X){return new J4(await super._call(X))}}class j4 extends S{}class _4 extends j4{}class x4 extends j4{async _call(X){return new q6(await super._call(X))}}class XJ extends j4{async _call(X){return new g6(await super._call(X))}}class qJ extends j4{async _call(X){return new J4(await super._call(X))}}class m4 extends j4{async _call(X){return new c6(await super._call(X))}}class P4 extends S{}class a4 extends P4{}class HJ extends P4{async _call(X){return new c6(await super._call(X))}}class Y4 extends P4{async _call(X){return new q6(await super._call(X))}}class P0 extends P4{async _call(X){return new g6(await super._call(X))}}class S0 extends S{}class m0 extends S0{}class P6 extends S0{async _call(X){return new c6(await super._call(X))}}class UJ extends S0{async _call(X){return new q6(await super._call(X))}}class p4 extends S0{async _call(X){return new J4(await super._call(X))}}class C4 extends S{}class _J extends C4{}class xJ extends C4{async _call(X){return new c6(await super._call(X))}}class yJ extends C4{async _call(X){return new q6(await super._call(X))}}class oJ extends C4{async _call(X){return new g6(await super._call(X))}}class U extends C4{async _call(X){return new J4(await super._call(X))}}class k extends S{}class l extends k{}class s extends k{async _call(X){return new c6(await super._call(X))}}class $0 extends k{async _call(X){return new q6(await super._call(X))}}class V0 extends k{async _call(X){return new J4(await super._call(X))}}class _0 extends S{}class O0 extends _0{}class f0 extends _0{async _call(X){return new q6(await super._call(X))}}class k0 extends _0{async _call(X){return new J4(await super._call(X))}}class L6 extends _0{async _call(X){return new c6(await super._call(X))}}class X6 extends S{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"]}class y6 extends X6{}class r6 extends X6{}class v6 extends S{}class W4 extends v6{}class e6 extends v6{}class S4 extends S{}class DJ extends S4{}class G4 extends S4{}class b4 extends S{}class M6 extends b4{}class n6 extends b4{}class N4 extends b4{async _call(X){return new q6(await super._call(X))}}class D4 extends S{}class r4 extends D4{}class Q4 extends D4{}class h4 extends D4{async _call(X){return new q6(await super._call(X))}}class s6 extends D4{}class h6 extends S{}class d6 extends h6{}class u6 extends h6{}class z4 extends S{}class vJ extends z4{}class L5 extends z4{}class OJ extends S{}class G8 extends OJ{}class X8 extends OJ{async _call(X){return new c6(await super._call(X))}}class q8 extends OJ{async _call(X){return new q6(await super._call(X))}}class H8 extends OJ{async _call(X){return new g6(await super._call(X))}}class U8 extends OJ{async _call(X){return new J4(await super._call(X))}}class bJ extends S{}class V8 extends bJ{}class N8 extends bJ{async _call(X){return new c6(await super._call(X))}}class z8 extends bJ{async _call(X){return new q6(await super._call(X))}}class E8 extends bJ{async _call(X){return new g6(await super._call(X))}}class L8 extends bJ{async _call(X){return new J4(await super._call(X))}}class hJ extends S{}class A8 extends hJ{}class B8 extends hJ{async _call(X){return new c6(await super._call(X))}}class F8 extends hJ{async _call(X){return new q6(await super._call(X))}}class R8 extends hJ{async _call(X){return new g6(await super._call(X))}}class I8 extends hJ{async _call(X){return new J4(await super._call(X))}}class r5 extends S{}class D8 extends r5{}class w8 extends r5{}class e5 extends S{requires_attention_mask=!1;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"]}class j8 extends e5{}class n5 extends e5{_prepare_generation_config(X,M){return super._prepare_generation_config(X,M,v.WhisperGenerationConfig)}_retrieve_init_tokens(X){let M=[X.decoder_start_token_id],e=X.language,J0=X.task;if(X.is_multilingual){if(!e)console.warn("No language specified - defaulting to English (en)."),e="en";let H0=`<|${(0,g.whisper_language_to_code)(e)}|>`;M.push(X.lang_to_id[H0]),M.push(X.task_to_id[J0??"transcribe"])}else if(e||J0)throw Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");if(!X.return_timestamps&&X.no_timestamps_token_id&&M.at(-1)!==X.no_timestamps_token_id)M.push(X.no_timestamps_token_id);else if(X.return_timestamps&&M.at(-1)===X.no_timestamps_token_id)console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),M.pop();return M.filter((q0)=>q0!=null)}async generate({inputs:X=null,generation_config:M=null,logits_processor:e=null,stopping_criteria:J0=null,...q0}){M=this._prepare_generation_config(M,q0);let H0=q0.decoder_input_ids??this._retrieve_init_tokens(M);if(M.return_timestamps)e??=new V.LogitsProcessorList,e.push(new V.WhisperTimeStampLogitsProcessor(M,H0));if(M.begin_suppress_tokens)e??=new V.LogitsProcessorList,e.push(new V.SuppressTokensAtBeginLogitsProcessor(M.begin_suppress_tokens,H0.length));if(M.return_token_timestamps){if(!M.alignment_heads)throw Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");if(M.task==="translate")console.warn("Token-level timestamps may not be reliable for task 'translate'.");M.output_attentions=!0,M.return_dict_in_generate=!0}let D0=await super.generate({inputs:X,generation_config:M,logits_processor:e,decoder_input_ids:H0,...q0});if(M.return_token_timestamps)D0.token_timestamps=this._extract_token_timestamps(D0,M.alignment_heads,M.num_frames);return D0}_extract_token_timestamps(X,M,e=null,J0=0.02){if(!X.cross_attentions)throw Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");if(e==null)console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let q0=this.config.median_filter_width;if(q0===void 0)console.warn("Model config has no `median_filter_width`, using default value of 7."),q0=7;let H0=X.cross_attentions,D0=Array.from({length:this.config.decoder_layers},(G6,Y6)=>(0,z.cat)(H0.map((U6)=>U6[Y6]),2)),M0=(0,z.stack)(M.map(([G6,Y6])=>{if(G6>=D0.length)throw Error(`Layer index ${G6} is out of bounds for cross attentions (length ${D0.length}).`);return e?D0[G6].slice(null,Y6,null,[0,e]):D0[G6].slice(null,Y6)})).transpose(1,0,2,3),[g0,K6]=(0,z.std_mean)(M0,-2,0,!0),W6=M0.clone();for(let G6=0;G6<W6.dims[0];++G6){let Y6=W6[G6];for(let U6=0;U6<Y6.dims[0];++U6){let D6=Y6[U6],T6=g0[G6][U6][0].data,E4=K6[G6][U6][0].data;for(let O6=0;O6<D6.dims[0];++O6){let C6=D6[O6].data;for(let i6=0;i6<C6.length;++i6)C6[i6]=(C6[i6]-E4[i6])/T6[i6];C6.set((0,R.medianFilter)(C6,q0))}}}let N6=[(0,z.mean)(W6,1)],o0=X.sequences.dims,I6=new z.Tensor("float32",new Float32Array(o0[0]*o0[1]),o0);for(let G6=0;G6<o0[0];++G6){let Y6=N6[G6].neg().squeeze_(0),[U6,D6]=(0,R.dynamic_time_warping)(Y6.tolist()),T6=Array.from({length:U6.length-1},(C6,i6)=>U6[i6+1]-U6[i6]),E4=(0,G.mergeArrays)([1],T6).map((C6)=>!!C6),O6=[];for(let C6=0;C6<E4.length;++C6)if(E4[C6])O6.push(D6[C6]*J0);I6[G6].data.set(O6,1)}return I6}}class P8 extends n5{}class s5 extends S{requires_attention_mask=!1;main_input_name="input_values";forward_params=["input_values","decoder_input_ids","past_key_values"]}class bY extends s5{}class C8 extends s5{}class i5 extends S{main_input_name="pixel_values";forward_params=["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"]}class t5 extends S{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class A5 extends t5{_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return I({image_token_id:this.config.image_token_index,...X,image_features:e})}}class S8 extends A5{}class M8 extends A5{}class T8 extends S{forward_params=["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"];main_input_name="inputs_embeds"}class k8 extends T8{_merge_input_ids_with_image_features({inputs_embeds:X,image_features:M,input_ids:e,attention_mask:J0}){return{inputs_embeds:(0,z.cat)([M,X],1),attention_mask:(0,z.cat)([(0,z.ones)(M.dims.slice(0,2)),J0],1)}}async _prepare_inputs_embeds({input_ids:X,pixel_values:M,inputs_embeds:e,attention_mask:J0}){if(!X&&!M)throw Error("Either `input_ids` or `pixel_values` should be provided.");let q0,H0;if(X)q0=await this.encode_text({input_ids:X});if(M)H0=await this.encode_image({pixel_values:M});if(q0&&H0)({inputs_embeds:e,attention_mask:J0}=this._merge_input_ids_with_image_features({inputs_embeds:q0,image_features:H0,input_ids:X,attention_mask:J0}));else e=q0||H0;return{inputs_embeds:e,attention_mask:J0}}async forward({input_ids:X,pixel_values:M,attention_mask:e,decoder_input_ids:J0,decoder_attention_mask:q0,encoder_outputs:H0,past_key_values:D0,inputs_embeds:M0,decoder_inputs_embeds:g0}){if(!M0)({inputs_embeds:M0,attention_mask:e}=await this._prepare_inputs_embeds({input_ids:X,pixel_values:M,inputs_embeds:M0,attention_mask:e}));if(!H0){let{last_hidden_state:N6}=await W0(this,{inputs_embeds:M0,attention_mask:e});H0=N6}if(!g0){if(!J0)throw Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");g0=await this.encode_text({input_ids:J0})}return await N0(this,{inputs_embeds:g0,attention_mask:q0,encoder_attention_mask:e,encoder_hidden_states:H0,past_key_values:D0},!0)}}class _8 extends S{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class x8 extends _8{_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return I({image_token_id:this.config.image_token_index,...X,image_features:e})}}class y8 extends t5{_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return I({image_token_id:this.config.image_token_index,...X,image_features:e})}}class v8 extends S{forward_params=["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"]}class o5 extends v8{async forward({input_ids:X=null,attention_mask:M=null,pixel_values:e=null,input_features:J0=null,input_features_mask:q0=null,position_ids:H0=null,inputs_embeds:D0=null,per_layer_inputs:M0=null,past_key_values:g0=null,generation_config:K6=null,logits_processor:W6=null,...N6}){if(!D0||!M0){if({inputs_embeds:D0,per_layer_inputs:M0}=await m(this.sessions.embed_tokens,{input_ids:X}),X.dims[1]!==1){if(e){let{image_features:I6}=await m(this.sessions.vision_encoder,{pixel_values:e});({inputs_embeds:D0,attention_mask:M}=this._merge_input_ids_with_image_features({image_features:I6,inputs_embeds:D0,input_ids:X,attention_mask:M}))}if(J0){let{audio_features:I6}=await m(this.sessions.audio_encoder,{input_features:J0,input_features_mask:q0});({inputs_embeds:D0,attention_mask:M}=this._merge_input_ids_with_audio_features({audio_features:I6,inputs_embeds:D0,input_ids:X,attention_mask:M}))}}}return await N0(this,{inputs_embeds:D0,per_layer_inputs:M0,past_key_values:g0,attention_mask:M,position_ids:H0,generation_config:K6,logits_processor:W6},!0)}_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return I({image_token_id:this.config.image_token_id,...X,image_features:e})}_merge_input_ids_with_audio_features(X){let M=X.audio_features.dims.at(-1),e=X.audio_features.view(-1,M);return O({audio_token_id:this.config.audio_token_id,...X,audio_features:e})}}class O8 extends S{forward_params=["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"]}class B5 extends O8{async encode_image({pixel_values:X,pixel_attention_mask:M}){return(await m(this.sessions.vision_encoder,{pixel_values:X,pixel_attention_mask:M})).image_features}_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return I({image_token_id:this.config.image_token_id,...X,image_features:e})}}class J$ extends B5{}class b8 extends S{forward_params=["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"]}class $$ extends b8{async forward({input_ids:X=null,attention_mask:M=null,pixel_values:e=null,image_sizes:J0=null,position_ids:q0=null,inputs_embeds:H0=null,past_key_values:D0=null,generation_config:M0=null,logits_processor:g0=null,...K6}){if(!H0){let N6;if(e&&X.dims[1]!==1){if(!J0)throw Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:N6}=await m(this.sessions.vision_encoder,{pixel_values:e,image_sizes:J0}))}else{let o0=this.config.normalized_config.hidden_size;N6=new z.Tensor("float32",[],[0,o0])}({inputs_embeds:H0}=await m(this.sessions.prepare_inputs_embeds,{input_ids:X,image_features:N6}))}return await N0(this,{inputs_embeds:H0,past_key_values:D0,attention_mask:M,position_ids:q0,generation_config:M0,logits_processor:g0},!1)}}class wJ extends S{}class h8 extends wJ{}class hY extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class f8 extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class fY extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class d8 extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class Z$ extends S{}class u8 extends Z${}class g8 extends Z${static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class l8 extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class c8 extends S{}class m8 extends c8{}class F5 extends S{}class a8 extends F5{async forward(X){let M=!X.input_ids,e=!X.pixel_values;if(M&&e)throw Error("Either `input_ids` or `pixel_values` should be provided.");if(M)X.input_ids=(0,z.ones)([X.pixel_values.dims[0],1]);if(e){let{image_size:g0}=this.config.vision_config;X.pixel_values=(0,z.full)([0,3,g0,g0],0)}let{text_embeddings:J0,image_embeddings:q0,l2norm_text_embeddings:H0,l2norm_image_embeddings:D0}=await super.forward(X),M0={};if(!M)M0.text_embeddings=J0,M0.l2norm_text_embeddings=H0;if(!e)M0.image_embeddings=q0,M0.l2norm_image_embeddings=D0;return M0}}class p8 extends F5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class r8 extends F5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class W$ extends S{}class e8 extends W${}class n8 extends W${}class Q$ extends S{}class s8 extends Q${}class i8 extends Q${}class K$ extends S{}class t8 extends K${}class o8 extends K${}class Y$ extends S{}class JW extends Y${}class $W extends Y${}class G$ extends S{}class ZW extends G${}class WW extends G${}class X$ extends S{}class QW extends X${}class KW extends X${}class q$ extends S{}class YW extends q${}class GW extends q${}class H$ extends S{}class XW extends H${}class qW extends H${}class U$ extends S{}class HW extends U${}class UW extends U${}class VW extends S{}class NW extends VW{}class V$ extends S{}class zW extends V${}class EW extends V${}class N$ extends S{}class LW extends N${}class AW extends N${}class z$ extends S{}class BW extends z${}class FW extends z${}class E$ extends S{}class RW extends E${}class IW extends E${}class L$ extends S{}class DW extends L${}class wW extends L${}class A$ extends S{}class jW extends A${}class PW extends A${}class B$ extends S{}class CW extends B${}class SW extends B${}class F$ extends S{}class MW extends F${}class TW extends F${}class R$ extends S{}class kW extends R${}class _W extends R${}class I$ extends S{}class xW extends I${}class yW extends I${}class D$ extends S{}class vW extends D${}class OW extends D${}class w$ extends S{}class bW extends w${}class hW extends w${}class j$ extends S{}class fW extends j${}class dW extends j${}class P$ extends S{}class uW extends P${}class gW extends P${}class C$ extends S{}class lW extends C${}class cW extends C${}class S$ extends S{}class mW extends S${}class aW extends S${}class M$ extends S{}class pW extends M${}class rW extends M${}class T$ extends S{}class eW extends T${}class nW extends T${}class k$ extends S{}class sW extends k${}class iW extends k${}class _$ extends S{}class tW extends _${}class oW extends _${}class J7 extends S{forward_params=["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"]}class $7 extends J7{get_rope_index(X,M,e,J0){let{vision_config:q0,image_token_id:H0,video_token_id:D0,vision_start_token_id:M0}=this.config,g0=q0.spatial_merge_size??2,K6=[];if(M||e){let W6=X.tolist();if(!J0)J0=(0,z.ones_like)(X);let N6=J0.tolist(),o0=Array.from({length:3},(D6)=>Array.from({length:X.dims[0]},(T6)=>Array.from({length:X.dims[1]},(E4)=>1))),I6=M?M.tolist():[],G6=e?e.tolist():[],Y6=0,U6=0;for(let D6=0;D6<W6.length;++D6){let T6=W6[D6].filter((S6,m6)=>N6[D6][m6]==1),O6=T6.reduce((S6,m6,jJ)=>{if(m6==M0)S6.push(jJ);return S6},[]).map((S6)=>T6[S6+1]),C6=O6.filter((S6)=>S6==H0).length,i6=O6.filter((S6)=>S6==D0).length,A6=[],l6=0,e4=C6,K4=i6;for(let S6=0;S6<O6.length;++S6){let m6=T6.findIndex((lJ,d4)=>d4>l6&&lJ==H0),jJ=T6.findIndex((lJ,d4)=>d4>l6&&lJ==D0),gJ=e4>0&&m6!==-1?m6:T6.length+1,W5=K4>0&&jJ!==-1?jJ:T6.length+1,MZ,pK,rK,eK;if(gJ<W5)[pK,rK,eK]=I6[Y6],++Y6,--e4,MZ=gJ;else[pK,rK,eK]=G6[U6],++U6,--K4,MZ=W5;let[ZV,nK,TZ]=[Number(pK),Math.floor(Number(rK)/g0),Math.floor(Number(eK)/g0)],sK=MZ-l6,nG=A6.length>0?(0,R.max)(A6.at(-1))[0]+1:0;A6.push(Array.from({length:3*sK},(lJ,d4)=>nG+d4%sK));let iK=sK+nG,kZ=ZV*nK*TZ,WV=Array.from({length:kZ},(lJ,d4)=>iK+Math.floor(d4/(nK*TZ))),QV=Array.from({length:kZ},(lJ,d4)=>iK+Math.floor(d4/TZ)%nK),KV=Array.from({length:kZ},(lJ,d4)=>iK+d4%TZ);A6.push([WV,QV,KV].flat()),l6=MZ+kZ}if(l6<T6.length){let S6=A6.length>0?(0,R.max)(A6.at(-1))[0]+1:0,m6=T6.length-l6;A6.push(Array.from({length:3*m6},(jJ,gJ)=>S6+gJ%m6))}let f4=A6.reduce((S6,m6)=>S6+m6.length,0),dJ=Array(f4),SZ=0;for(let S6=0;S6<3;++S6)for(let m6=0;m6<A6.length;++m6){let jJ=A6[m6],gJ=jJ.length/3;for(let W5=S6*gJ;W5<(S6+1)*gJ;++W5)dJ[SZ++]=jJ[W5]}let uJ=0,O5=N6[D6];for(let S6=0;S6<O5.length;++S6)if(O5[S6]==1){for(let m6=0;m6<3;++m6)o0[m6][D6][S6]=dJ[m6*f4/3+uJ];++uJ}let $V=(0,R.max)(dJ)[0];K6.push($V+1-W6[D6].length)}return[new z.Tensor("int64",o0.flat(1/0),[3,X.dims[0],X.dims[1]]),new z.Tensor("int64",K6,[K6.length,1])]}else if(J0){let{data:W6,dims:N6}=A0(J0),o0=BigInt64Array.from({length:3*W6.length},(G6,Y6)=>W6[Y6%W6.length]),I6=Array.from({length:N6[0]},(G6,Y6)=>(0,R.max)(W6.subarray(N6[1]*Y6,N6[1]*(Y6+1)))[0]+1n+BigInt(N6[1]));return[new z.Tensor("int64",o0,[3,...N6]),new z.Tensor("int64",I6,[I6.length,1])]}else{let[W6,N6]=X.dims,o0=BigInt64Array.from({length:3*W6*N6},(I6,G6)=>BigInt(Math.floor(G6%N6/W6)));return[new z.Tensor("int64",o0,[3,...X.dims]),(0,z.zeros)([W6,1])]}}async encode_image({pixel_values:X,image_grid_thw:M}){return(await m(this.sessions.vision_encoder,{pixel_values:X,grid_thw:M})).image_features}_merge_input_ids_with_image_features(X){return I({image_token_id:this.config.image_token_id,...X})}prepare_inputs_for_generation(X,M,e){if(M.attention_mask&&!M.position_ids)if(!M.past_key_values)[M.position_ids,M.rope_deltas]=this.get_rope_index(M.input_ids,M.image_grid_thw,M.video_grid_thw,M.attention_mask);else{M.pixel_values=null;let J0=BigInt(Object.values(M.past_key_values)[0].dims.at(-2)),q0=M.rope_deltas.map((H0)=>J0+H0);M.position_ids=(0,z.stack)([q0,q0,q0],0)}return M}}class x$ extends S{}class Z7 extends x${}class W7 extends x${}class y$ extends S{}class Q7 extends y${}class K7 extends y${}class v$ extends S{}class Y7 extends v${}class G7 extends v${}class O$ extends S{}class X7 extends O${}class q7 extends O${}class b$ extends S{}class H7 extends b${}class U7 extends b${}class h$ extends S{}class V7 extends h${}class N7 extends h${async _call(X){return new q6(await super._call(X))}}class f$ extends S{}class z7 extends f${}class E7 extends f${async _call(X){return new q6(await super._call(X))}}class L7 extends S{}class A7 extends L7{}class d$ extends S{}class B7 extends d${}class F7 extends d${async _call(X){return new q6(await super._call(X))}}class R7 extends S{}class I7 extends R7{}class u$ extends S{}class D7 extends u${}class w7 extends u${async _call(X){return new q6(await super._call(X))}}class j7 extends S{}class P7 extends j7{}class g$ extends S{}class C7 extends g${}class S7 extends g${async _call(X){return new q6(await super._call(X))}}class M7 extends S{}class T7 extends M7{async _call(X){return new mK(await super._call(X))}}class l$ extends S{}class k7 extends l${}class _7 extends l${async _call(X){return new q6(await super._call(X))}}class c$ extends S{}class x7 extends c${}class y7 extends c${async _call(X){return new q6(await super._call(X))}}class m$ extends S{}class v7 extends m${}class O7 extends m${}class a$ extends S{}class b7 extends a${}class h7 extends a${}class p$ extends S{}class f7 extends p${}class d7 extends p${async _call(X){return new q6(await super._call(X))}}class R5 extends S{}class u7 extends R5{}class g7 extends R5{async _call(X){return new e$(await super._call(X))}}class r$ extends R5{async _call(X){return new l7(await super._call(X))}}class e$ extends Q0{constructor({logits:X,pred_boxes:M}){super();this.logits=X,this.pred_boxes=M}}class l7 extends Q0{constructor({logits:X,pred_boxes:M,pred_masks:e}){super();this.logits=X,this.pred_boxes=M,this.pred_masks=e}}class n$ extends S{}class c7 extends n${}class m7 extends n${async _call(X){return new J5(await super._call(X))}}class J5 extends Q0{constructor({logits:X,pred_boxes:M}){super();this.logits=X,this.pred_boxes=M}}class s$ extends S{}class a7 extends s${}class p7 extends s${async _call(X){return new r7(await super._call(X))}}class r7 extends J5{}class i$ extends S{}class e7 extends i${}class n7 extends i${async _call(X){return new s7(await super._call(X))}}class s7 extends J5{}class t$ extends S{}class i7 extends t${}class t7 extends t${async _call(X){return new J5(await super._call(X))}}class o$ extends S{}class o7 extends o${}class JQ extends o${async _call(X){return new $Q(await super._call(X))}}class $Q extends e${}class JZ extends S{}class ZQ extends JZ{}class WQ extends JZ{async _call(X){return new q6(await super._call(X))}}class $Z extends S{}class QQ extends $Z{}class KQ extends $Z{async _call(X){return new q6(await super._call(X))}}class ZZ extends S{}class YQ extends ZZ{}class GQ extends ZZ{async _call(X){return new q6(await super._call(X))}}class I5 extends S{}class XQ extends I5{}class qQ extends I5{async _call(X){return new q6(await super._call(X))}}class HQ extends I5{}class WZ extends S{}class UQ extends WZ{}class VQ extends WZ{}class QZ extends S{}class NQ extends QZ{}class zQ extends QZ{}class EQ extends S{}class LQ extends EQ{}class D5 extends S{}class AQ extends D5{}class BQ extends D5{}class FQ extends D5{}class RQ extends S{}class IQ extends RQ{}class DQ extends S{}class wQ extends DQ{}class jQ extends S{}class PQ extends jQ{}class KZ extends S{}class CQ extends KZ{}class SQ extends KZ{}class YZ extends S{}class MQ extends YZ{}class TQ extends YZ{}class kQ extends S{}class _Q extends kQ{}class GZ extends S{}class xQ extends GZ{}class yQ extends GZ{async _call(X){return new q6(await super._call(X))}}class XZ extends S{}class vQ extends XZ{}class OQ extends XZ{async _call(X){return new q6(await super._call(X))}}class qZ extends S{}class bQ extends qZ{}class hQ extends qZ{async _call(X){return new q6(await super._call(X))}}class HZ extends S{}class fQ extends HZ{}class dQ extends HZ{async _call(X){return new q6(await super._call(X))}}class uQ extends S{}class gQ extends uQ{}class lQ extends S{}class cQ extends lQ{}class mQ extends S{}class aQ extends mQ{}class UZ extends S{}class pQ extends UZ{}class rQ extends UZ{async _call(X){return new eQ(await super._call(X))}}class eQ extends Q0{constructor({logits:X,pred_boxes:M}){super();this.logits=X,this.pred_boxes=M}}class nQ extends S{}class sQ extends nQ{async get_image_embeddings({pixel_values:X}){return await W0(this,{pixel_values:X})}async forward(X){if(!X.image_embeddings||!X.image_positional_embeddings)X={...X,...await this.get_image_embeddings(X)};if(!X.input_labels&&X.input_points){let e=X.input_points.dims.slice(0,-1),J0=e.reduce((q0,H0)=>q0*H0,1);X.input_labels=new z.Tensor("int64",new BigInt64Array(J0).fill(1n),e)}let M={image_embeddings:X.image_embeddings,image_positional_embeddings:X.image_positional_embeddings};if(X.input_points)M.input_points=X.input_points;if(X.input_labels)M.input_labels=X.input_labels;if(X.input_boxes)M.input_boxes=X.input_boxes;return await m(this.sessions.prompt_encoder_mask_decoder,M)}async _call(X){return new iQ(await super._call(X))}}class iQ extends Q0{constructor({iou_scores:X,pred_masks:M}){super();this.iou_scores=X,this.pred_masks=M}}class VZ extends S{}class tQ extends VZ{}class oQ extends VZ{}class NZ extends S{}class J9 extends NZ{}class $9 extends NZ{}class VJ extends S{}class Z9 extends VJ{}class W9 extends VJ{async _call(X){return new NJ(await super._call(X))}}class Q9 extends VJ{async _call(X){return new q6(await super._call(X))}}class K9 extends VJ{async _call(X){return new g6(await super._call(X))}}class Y9 extends S{}class G9 extends Y9{async _call(X){return new NJ(await super._call(X))}}class zZ extends S{}class X9 extends zZ{}class q9 extends zZ{async _call(X){return new g6(await super._call(X))}}class H9 extends S{}class U9 extends H9{}class w5 extends S{}class V9 extends w5{}class N9 extends w5{async _call(X){return new NJ(await super._call(X))}}class z9 extends w5{async _call(X){return new q6(await super._call(X))}}class $5 extends S{}class E9 extends $5{}class L9 extends $5{async _call(X){return new NJ(await super._call(X))}}class A9 extends $5{async _call(X){return new q6(await super._call(X))}}class B9 extends $5{async _call(X){return new g6(await super._call(X))}}class j5 extends S{}class F9 extends j5{}class R9 extends j5{async _call(X){return new NJ(await super._call(X))}}class I9 extends j5{async _call(X){return new q6(await super._call(X))}}class dY extends S{}class D9 extends VJ{}class w9 extends VJ{async _call(X){return new NJ(await super._call(X))}}class j9 extends VJ{async _call(X){return new q6(await super._call(X))}}class fJ extends S{}class P9 extends fJ{}class C9 extends fJ{async _call(X){return new NJ(await super._call(X))}}class S9 extends fJ{async _call(X){return new q6(await super._call(X))}}class M9 extends fJ{async _call(X){return new cK(await super._call(X))}}class T9 extends fJ{async _call(X){return new g6(await super._call(X))}}class k9 extends S{}class _9 extends k9{}class P5 extends S{}class uY extends P5{}class x9 extends P5{}class y9 extends P5{async generate_speech(X,M,{threshold:e=0.5,minlenratio:J0=0,maxlenratio:q0=20,vocoder:H0=null}={}){let D0={input_ids:X},{encoder_outputs:M0,encoder_attention_mask:g0}=await W0(this,D0),K6=M0.dims[1]/this.config.reduction_factor,W6=Math.floor(K6*q0),N6=Math.floor(K6*J0),o0=this.config.num_mel_bins,I6=[],G6=null,Y6=null,U6=0;while(!0){++U6;let E4=n(!!Y6),O6;if(Y6)O6=Y6.output_sequence_out;else O6=new z.Tensor("float32",new Float32Array(o0),[1,1,o0]);let C6={use_cache_branch:E4,output_sequence:O6,encoder_attention_mask:g0,speaker_embeddings:M,encoder_hidden_states:M0};this.addPastKeyValues(C6,G6),Y6=await m(this.sessions.decoder_model_merged,C6),G6=this.getPastKeyValues(Y6,G6);let{prob:i6,spectrum:A6}=Y6;if(I6.push(A6),U6>=N6&&(Array.from(i6.data).filter((l6)=>l6>=e).length>0||U6>=W6))break}let D6=(0,z.cat)(I6),{waveform:T6}=await m(H0.sessions.model,{spectrogram:D6});return{spectrogram:D6,waveform:T6}}}class v9 extends S{main_input_name="spectrogram"}class O9 extends S{}class b9 extends O9{}class EZ extends S{}class h9 extends EZ{}class f9 extends EZ{}class LZ extends S{}class d9 extends LZ{}class u9 extends LZ{}class AZ extends S{}class g9 extends AZ{}class l9 extends AZ{}class BZ extends S{}class c9 extends BZ{}class m9 extends BZ{}class C5 extends S{}class a9 extends C5{}class p9 extends C5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class r9 extends C5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"audio_model"})}}class e9 extends S{}class FZ extends e9{async _call(X){return new aK(await super._call(X))}}class S5 extends S{}class gY extends S5{}class n9 extends S5{}class s9 extends S5{}class RZ extends S{}class i9 extends RZ{}class t9 extends RZ{}class IZ extends S{}class o9 extends IZ{}class JK extends IZ{async _call(X){return new q6(await super._call(X))}}class DZ extends S{}class lY extends DZ{}class cY extends DZ{}class wZ extends S{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];_apply_and_filter_by_delay_pattern_mask(X){let[M,e]=X.dims,J0=this.config.decoder.num_codebooks,q0=e-J0,H0=0;for(let g0=0;g0<X.size;++g0){if(X.data[g0]===this.config.decoder.pad_token_id)continue;let K6=g0%e,W6=Math.floor(g0/e)%J0,N6=K6-W6;if(N6>0&&N6<=q0)X.data[H0++]=X.data[g0]}let D0=Math.floor(M/J0),M0=H0/(D0*J0);return new z.Tensor(X.type,X.data.slice(0,H0),[D0,J0,M0])}prepare_inputs_for_generation(X,M,e){let J0=structuredClone(X);for(let H0=0;H0<J0.length;++H0)for(let D0=0;D0<J0[H0].length;++D0)if(H0%this.config.decoder.num_codebooks>=D0)J0[H0][D0]=BigInt(this.config.decoder.pad_token_id);if(e.guidance_scale!==null&&e.guidance_scale>1)J0=J0.concat(J0);return super.prepare_inputs_for_generation(J0,M,e)}async generate(X){let M=await super.generate(X),e=this._apply_and_filter_by_delay_pattern_mask(M).unsqueeze_(0),{audio_values:J0}=await m(this.sessions.encodec_decode,{audio_codes:e});return J0}}class M5 extends S{}class $K extends M5{}class ZK extends M5{async _call(X){return new q6(await super._call(X))}}class WK extends M5{}class T5 extends S{}class QK extends T5{}class KK extends T5{async _call(X){return new q6(await super._call(X))}}class YK extends T5{}class k5 extends S{}class GK extends k5{}class XK extends k5{async _call(X){return new q6(await super._call(X))}}class qK extends k5{}class _5 extends S{}class HK extends _5{}class UK extends _5{async _call(X){return new q6(await super._call(X))}}class VK extends _5{}class NK extends S{}class zK extends NK{}class EK extends S{}class LK extends EK{forward_params=["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"];constructor(...X){super(...X);this._generation_mode="text"}async forward(X){let M=this._generation_mode??"text",e;if(M==="text"||!X.past_key_values){let M0=this.sessions.prepare_inputs_embeds,g0=(0,G.pick)(X,M0.inputNames);e=await m(M0,g0)}else{let M0=this.sessions.gen_img_embeds,g0=(0,G.pick)({image_ids:X.input_ids},M0.inputNames);e=await m(M0,g0)}let J0={...X,...e},q0=await N0(this,J0),H0=this.sessions[M==="text"?"lm_head":"gen_head"];if(!H0)throw Error(`Unable to find "${H0}" generation head`);let D0=await m(H0,(0,G.pick)(q0,H0.inputNames));return{...e,...q0,...D0}}async generate(X){return this._generation_mode="text",super.generate(X)}async generate_images(X){this._generation_mode="image";let M=(X.inputs??X[this.main_input_name]).dims[1],J0=(await super.generate(X)).slice(null,[M,null]),q0=this.sessions.image_decode,{decoded_image:H0}=await m(q0,{generated_tokens:J0}),D0=H0.add_(1).mul_(127.5).clamp_(0,255).to("uint8"),M0=[];for(let g0 of D0){let K6=w.RawImage.fromTensor(g0);M0.push(K6)}return M0}}class AK extends Q0{constructor({char_logits:X,bpe_logits:M,wp_logits:e}){super();this.char_logits=X,this.bpe_logits=M,this.wp_logits=e}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class BK extends S{}class FK extends BK{async _call(X){return new AK(await super._call(X))}}class jZ extends S{}class RK extends jZ{}class IK extends jZ{}class PZ extends S{}class DK extends PZ{}class wK extends PZ{}class jK extends S{forward_params=["input_ids","attention_mask","position_ids","audio_values","past_key_values"]}class CZ extends jK{_merge_input_ids_with_audio_features(X){let M=X.audio_features.dims.at(-1),e=X.audio_features.view(-1,M);return O({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...X,audio_features:e})}}class PK extends CZ{}class x5 extends S{main_input_name="input_values";forward_params=["input_values"]}class CK extends Q0{constructor({audio_codes:X}){super();this.audio_codes=X}}class SK extends Q0{constructor({audio_values:X}){super();this.audio_values=X}}class MK extends x5{async encode(X){return new CK(await m(this.sessions.encoder_model,X))}async decode(X){return new SK(await m(this.sessions.decoder_model,X))}}class TK extends x5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"encoder_model"})}}class kK extends x5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"decoder_model"})}}class y5 extends S{main_input_name="input_values";forward_params=["input_values"]}class _K extends Q0{constructor({audio_codes:X}){super();this.audio_codes=X}}class xK extends Q0{constructor({audio_values:X}){super();this.audio_values=X}}class yK extends y5{async encode(X){return new _K(await m(this.sessions.encoder_model,X))}async decode(X){return new xK(await m(this.sessions.decoder_model,X))}}class vK extends y5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"encoder_model"})}}class OK extends y5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"decoder_model"})}}class v5 extends S{main_input_name="input_values";forward_params=["input_values"]}class bK extends v5{async encode(X){return await m(this.sessions.encoder_model,X)}async decode(X){return await m(this.sessions.decoder_model,X)}}class hK extends v5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"encoder_model"})}}class fK extends v5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"decoder_model"})}}class F6{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(X,{progress_callback:M=null,config:e=null,cache_dir:J0=null,local_files_only:q0=!1,revision:H0="main",model_file_name:D0=null,subfolder:M0="onnx",device:g0=null,dtype:K6=null,use_external_data_format:W6=null,session_options:N6={}}={}){let o0={progress_callback:M,config:e,cache_dir:J0,local_files_only:q0,revision:H0,model_file_name:D0,subfolder:M0,device:g0,dtype:K6,use_external_data_format:W6,session_options:N6};if(o0.config=await W.AutoConfig.from_pretrained(X,o0),!this.MODEL_CLASS_MAPPINGS)throw Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);let I6=o0.config.model_type;for(let G6 of this.MODEL_CLASS_MAPPINGS){let Y6=G6.get(I6);if(!Y6){for(let U6 of G6.values())if(U6[0]===I6){Y6=U6;break}if(!Y6)continue}return await Y6[1].from_pretrained(X,o0)}if(this.BASE_IF_FAIL){if(!EG.has(I6))console.warn(`Unknown model class "${I6}", attempting to construct from base class.`);return await S.from_pretrained(X,o0)}else throw Error(`Unsupported model type: ${I6}`)}}let rU=new Map([["bert",["BertModel",F0]],["neobert",["NeoBertModel",x0]],["modernbert",["ModernBertModel",y0]],["nomic_bert",["NomicBertModel",U4]],["roformer",["RoFormerModel",_6]],["electra",["ElectraModel",u]],["esm",["EsmModel",a4]],["convbert",["ConvBertModel",Z6]],["camembert",["CamembertModel",c0]],["deberta",["DebertaModel",j6]],["deberta-v2",["DebertaV2Model",g4]],["mpnet",["MPNetModel",_J]],["albert",["AlbertModel",O0]],["distilbert",["DistilBertModel",_4]],["roberta",["RobertaModel",G8]],["xlm",["XLMModel",V8]],["xlm-roberta",["XLMRobertaModel",A8]],["clap",["ClapModel",a9]],["clip",["CLIPModel",h8]],["clipseg",["CLIPSegModel",e8]],["chinese_clip",["ChineseCLIPModel",m8]],["siglip",["SiglipModel",u8]],["jina_clip",["JinaCLIPModel",a8]],["mobilebert",["MobileBertModel",m0]],["squeezebert",["SqueezeBertModel",l]],["wav2vec2",["Wav2Vec2Model",Z9]],["wav2vec2-bert",["Wav2Vec2BertModel",F9]],["unispeech",["UniSpeechModel",V9]],["unispeech-sat",["UniSpeechSatModel",E9]],["hubert",["HubertModel",D9]],["wavlm",["WavLMModel",P9]],["audio-spectrogram-transformer",["ASTModel",D8]],["vits",["VitsModel",FZ]],["pyannote",["PyAnnoteModel",X9]],["wespeaker-resnet",["WeSpeakerResNetModel",U9]],["detr",["DetrModel",u7]],["rt_detr",["RTDetrModel",c7]],["rt_detr_v2",["RTDetrV2Model",a7]],["rf_detr",["RFDetrModel",e7]],["d_fine",["DFineModel",i7]],["table-transformer",["TableTransformerModel",o7]],["vit",["ViTModel",V7]],["ijepa",["IJepaModel",z7]],["pvt",["PvtModel",B7]],["vit_msn",["ViTMSNModel",D7]],["vit_mae",["ViTMAEModel",I7]],["groupvit",["GroupViTModel",P7]],["fastvit",["FastViTModel",C7]],["mobilevit",["MobileViTModel",k7]],["mobilevitv2",["MobileViTV2Model",x7]],["owlvit",["OwlViTModel",v7]],["owlv2",["Owlv2Model",b7]],["beit",["BeitModel",f7]],["deit",["DeiTModel",ZQ]],["hiera",["HieraModel",QQ]],["convnext",["ConvNextModel",xQ]],["convnextv2",["ConvNextV2Model",vQ]],["dinov2",["Dinov2Model",bQ]],["dinov2_with_registers",["Dinov2WithRegistersModel",fQ]],["dinov3_vit",["DINOv3ViTModel",gQ]],["dinov3_convnext",["DINOv3ConvNextModel",cQ]],["resnet",["ResNetModel",YQ]],["swin",["SwinModel",XQ]],["swin2sr",["Swin2SRModel",UQ]],["donut-swin",["DonutSwinModel",_Q]],["yolos",["YolosModel",pQ]],["dpt",["DPTModel",NQ]],["glpn",["GLPNModel",MQ]],["hifigan",["SpeechT5HifiGan",v9]],["efficientnet",["EfficientNetModel",o9]],["decision_transformer",["DecisionTransformerModel",zK]],["patchtst",["PatchTSTForPrediction",RK]],["patchtsmixer",["PatchTSMixerForPrediction",DK]],["mobilenet_v1",["MobileNetV1Model",$K]],["mobilenet_v2",["MobileNetV2Model",QK]],["mobilenet_v3",["MobileNetV3Model",GK]],["mobilenet_v4",["MobileNetV4Model",HK]],["maskformer",["MaskFormerModel",CQ]],["mgp-str",["MgpstrForSceneTextRecognition",FK]],["style_text_to_speech_2",["StyleTextToSpeech2Model",_9]]]),eU=new Map([["t5",["T5Model",y6]],["longt5",["LongT5Model",W4]],["mt5",["MT5Model",DJ]],["bart",["BartModel",M6]],["mbart",["MBartModel",r4]],["marian",["MarianModel",tQ]],["whisper",["WhisperModel",j8]],["m2m_100",["M2M100Model",J9]],["blenderbot",["BlenderbotModel",d6]],["blenderbot-small",["BlenderbotSmallModel",vJ]]]),nU=new Map([["mimi",["MimiModel",MK]],["dac",["DacModel",yK]],["snac",["SnacModel",bK]]]),sU=new Map([["bloom",["BloomModel",Y7]],["jais",["JAISModel",t8]],["gpt2",["GPT2Model",s8]],["gptj",["GPTJModel",QW]],["gpt_bigcode",["GPTBigCodeModel",YW]],["gpt_neo",["GPTNeoModel",JW]],["gpt_neox",["GPTNeoXModel",ZW]],["codegen",["CodeGenModel",XW]],["llama",["LlamaModel",HW]],["nanochat",["NanoChatModel",zW]],["arcee",["ArceeModel",LW]],["lfm2",["Lfm2Model",BW]],["smollm3",["SmolLM3Model",RW]],["exaone",["ExaoneModel",CW]],["olmo",["OlmoModel",kW]],["olmo2",["Olmo2Model",xW]],["mobilellm",["MobileLLMModel",MW]],["granite",["GraniteModel",vW]],["granitemoehybrid",["GraniteMoeHybridModel",bW]],["cohere",["CohereModel",fW]],["gemma",["GemmaModel",uW]],["gemma2",["Gemma2Model",lW]],["vaultgemma",["VaultGemmaModel",mW]],["gemma3_text",["Gemma3Model",pW]],["helium",["HeliumModel",DW]],["glm",["GlmModel",jW]],["openelm",["OpenELMModel",eW]],["qwen2",["Qwen2Model",sW]],["qwen3",["Qwen3Model",tW]],["phi",["PhiModel",Z7]],["phi3",["Phi3Model",Q7]],["mpt",["MptModel",X7]],["opt",["OPTModel",H7]],["mistral",["MistralModel",h9]],["ernie4_5",["Ernie4_5_Model",d9]],["starcoder2",["Starcoder2Model",g9]],["falcon",["FalconModel",c9]],["stablelm",["StableLmModel",i9]],["modernbert-decoder",["ModernBertDecoderModel",Q6]]]),dK=new Map([["speecht5",["SpeechT5ForSpeechToText",x9]],["whisper",["WhisperForConditionalGeneration",n5]],["lite-whisper",["LiteWhisperForConditionalGeneration",P8]],["moonshine",["MoonshineForConditionalGeneration",C8]]]),mY=new Map([["speecht5",["SpeechT5ForTextToSpeech",y9]]]),aY=new Map([["vits",["VitsModel",FZ]],["musicgen",["MusicgenForConditionalGeneration",wZ]]]),pY=new Map([["bert",["BertForSequenceClassification",E0]],["neobert",["NeoBertForSequenceClassification",u0]],["modernbert",["ModernBertForSequenceClassification",a0]],["roformer",["RoFormerForSequenceClassification",IJ]],["electra",["ElectraForSequenceClassification",f]],["esm",["EsmForSequenceClassification",Y4]],["convbert",["ConvBertForSequenceClassification",KJ]],["camembert",["CamembertForSequenceClassification",v0]],["deberta",["DebertaForSequenceClassification",R4]],["deberta-v2",["DebertaV2ForSequenceClassification",O4]],["mpnet",["MPNetForSequenceClassification",yJ]],["albert",["AlbertForSequenceClassification",f0]],["distilbert",["DistilBertForSequenceClassification",x4]],["roberta",["RobertaForSequenceClassification",q8]],["xlm",["XLMForSequenceClassification",z8]],["xlm-roberta",["XLMRobertaForSequenceClassification",F8]],["bart",["BartForSequenceClassification",N4]],["mbart",["MBartForSequenceClassification",h4]],["mobilebert",["MobileBertForSequenceClassification",UJ]],["squeezebert",["SqueezeBertForSequenceClassification",$0]]]),rY=new Map([["bert",["BertForTokenClassification",X0]],["neobert",["NeoBertForTokenClassification",b0]],["modernbert",["ModernBertForTokenClassification",n0]],["roformer",["RoFormerForTokenClassification",TJ]],["electra",["ElectraForTokenClassification",r]],["esm",["EsmForTokenClassification",P0]],["convbert",["ConvBertForTokenClassification",H6]],["camembert",["CamembertForTokenClassification",V6]],["deberta",["DebertaForTokenClassification",Z4]],["deberta-v2",["DebertaV2ForTokenClassification",GJ]],["mpnet",["MPNetForTokenClassification",oJ]],["distilbert",["DistilBertForTokenClassification",XJ]],["roberta",["RobertaForTokenClassification",H8]],["xlm",["XLMForTokenClassification",E8]],["xlm-roberta",["XLMRobertaForTokenClassification",R8]]]),uK=new Map([["t5",["T5ForConditionalGeneration",r6]],["longt5",["LongT5ForConditionalGeneration",e6]],["mt5",["MT5ForConditionalGeneration",G4]],["bart",["BartForConditionalGeneration",n6]],["mbart",["MBartForConditionalGeneration",Q4]],["marian",["MarianMTModel",oQ]],["m2m_100",["M2M100ForConditionalGeneration",$9]],["blenderbot",["BlenderbotForConditionalGeneration",u6]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",L5]]]),gK=new Map([["bloom",["BloomForCausalLM",G7]],["gpt2",["GPT2LMHeadModel",i8]],["jais",["JAISLMHeadModel",o8]],["gptj",["GPTJForCausalLM",KW]],["gpt_bigcode",["GPTBigCodeForCausalLM",GW]],["gpt_neo",["GPTNeoForCausalLM",$W]],["gpt_neox",["GPTNeoXForCausalLM",WW]],["codegen",["CodeGenForCausalLM",qW]],["llama",["LlamaForCausalLM",UW]],["nanochat",["NanoChatForCausalLM",EW]],["llama4_text",["Llama4ForCausalLM",NW]],["arcee",["ArceeForCausalLM",AW]],["lfm2",["Lfm2ForCausalLM",FW]],["smollm3",["SmolLM3ForCausalLM",IW]],["exaone",["ExaoneForCausalLM",SW]],["olmo",["OlmoForCausalLM",_W]],["olmo2",["Olmo2ForCausalLM",yW]],["mobilellm",["MobileLLMForCausalLM",TW]],["granite",["GraniteForCausalLM",OW]],["granitemoehybrid",["GraniteMoeHybridForCausalLM",hW]],["cohere",["CohereForCausalLM",dW]],["gemma",["GemmaForCausalLM",gW]],["gemma2",["Gemma2ForCausalLM",cW]],["vaultgemma",["VaultGemmaForCausalLM",aW]],["gemma3_text",["Gemma3ForCausalLM",rW]],["helium",["HeliumForCausalLM",wW]],["glm",["GlmForCausalLM",PW]],["openelm",["OpenELMForCausalLM",nW]],["qwen2",["Qwen2ForCausalLM",iW]],["qwen3",["Qwen3ForCausalLM",oW]],["phi",["PhiForCausalLM",W7]],["phi3",["Phi3ForCausalLM",K7]],["mpt",["MptForCausalLM",q7]],["opt",["OPTForCausalLM",U7]],["mbart",["MBartForCausalLM",s6]],["mistral",["MistralForCausalLM",f9]],["ernie4_5",["Ernie4_5_ForCausalLM",u9]],["starcoder2",["Starcoder2ForCausalLM",l9]],["falcon",["FalconForCausalLM",m9]],["trocr",["TrOCRForCausalLM",b9]],["stablelm",["StableLmForCausalLM",t9]],["modernbert-decoder",["ModernBertDecoderForCausalLM",a6]],["phi3_v",["Phi3VForCausalLM",$$]]]),iU=new Map([["multi_modality",["MultiModalityCausalLM",LK]]]),eY=new Map([["bert",["BertForMaskedLM",Y0]],["neobert",["NeoBertForMaskedLM",U0]],["modernbert",["ModernBertForMaskedLM",i0]],["roformer",["RoFormerForMaskedLM",o6]],["electra",["ElectraForMaskedLM",C]],["esm",["EsmForMaskedLM",HJ]],["convbert",["ConvBertForMaskedLM",QJ]],["camembert",["CamembertForMaskedLM",t0]],["deberta",["DebertaForMaskedLM",V4]],["deberta-v2",["DebertaV2ForMaskedLM",l4]],["mpnet",["MPNetForMaskedLM",xJ]],["albert",["AlbertForMaskedLM",L6]],["distilbert",["DistilBertForMaskedLM",m4]],["roberta",["RobertaForMaskedLM",X8]],["xlm",["XLMWithLMHeadModel",N8]],["xlm-roberta",["XLMRobertaForMaskedLM",B8]],["mobilebert",["MobileBertForMaskedLM",P6]],["squeezebert",["SqueezeBertForMaskedLM",s]]]),nY=new Map([["bert",["BertForQuestionAnswering",R0]],["neobert",["NeoBertForQuestionAnswering",s0]],["roformer",["RoFormerForQuestionAnswering",kJ]],["electra",["ElectraForQuestionAnswering",G0]],["convbert",["ConvBertForQuestionAnswering",YJ]],["camembert",["CamembertForQuestionAnswering",E6]],["deberta",["DebertaForQuestionAnswering",p6]],["deberta-v2",["DebertaV2ForQuestionAnswering",c4]],["mpnet",["MPNetForQuestionAnswering",U]],["albert",["AlbertForQuestionAnswering",k0]],["distilbert",["DistilBertForQuestionAnswering",qJ]],["roberta",["RobertaForQuestionAnswering",U8]],["xlm",["XLMForQuestionAnswering",L8]],["xlm-roberta",["XLMRobertaForQuestionAnswering",I8]],["mobilebert",["MobileBertForQuestionAnswering",p4]],["squeezebert",["SqueezeBertForQuestionAnswering",V0]]]),lK=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",i5]],["idefics3",["Idefics3ForConditionalGeneration",B5]],["smolvlm",["SmolVLMForConditionalGeneration",J$]]]),sY=new Map([["llava",["LlavaForConditionalGeneration",A5]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",S8]],["moondream1",["Moondream1ForConditionalGeneration",M8]],["florence2",["Florence2ForConditionalGeneration",k8]],["qwen2-vl",["Qwen2VLForConditionalGeneration",$7]],["idefics3",["Idefics3ForConditionalGeneration",B5]],["smolvlm",["SmolVLMForConditionalGeneration",J$]],["paligemma",["PaliGemmaForConditionalGeneration",x8]],["llava_qwen2",["LlavaQwen2ForCausalLM",y8]],["gemma3n",["Gemma3nForConditionalGeneration",o5]]]),iY=new Map([["ultravox",["UltravoxModel",CZ]],["voxtral",["VoxtralForConditionalGeneration",PK]]]),tU=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",i5]]]),tY=new Map([["vit",["ViTForImageClassification",N7]],["ijepa",["IJepaForImageClassification",E7]],["pvt",["PvtForImageClassification",F7]],["vit_msn",["ViTMSNForImageClassification",w7]],["fastvit",["FastViTForImageClassification",S7]],["mobilevit",["MobileViTForImageClassification",_7]],["mobilevitv2",["MobileViTV2ForImageClassification",y7]],["beit",["BeitForImageClassification",d7]],["deit",["DeiTForImageClassification",WQ]],["hiera",["HieraForImageClassification",KQ]],["convnext",["ConvNextForImageClassification",yQ]],["convnextv2",["ConvNextV2ForImageClassification",OQ]],["dinov2",["Dinov2ForImageClassification",hQ]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",dQ]],["resnet",["ResNetForImageClassification",GQ]],["swin",["SwinForImageClassification",qQ]],["segformer",["SegformerForImageClassification",n9]],["efficientnet",["EfficientNetForImageClassification",JK]],["mobilenet_v1",["MobileNetV1ForImageClassification",ZK]],["mobilenet_v2",["MobileNetV2ForImageClassification",KK]],["mobilenet_v3",["MobileNetV3ForImageClassification",XK]],["mobilenet_v4",["MobileNetV4ForImageClassification",UK]]]),oY=new Map([["detr",["DetrForObjectDetection",g7]],["rt_detr",["RTDetrForObjectDetection",m7]],["rt_detr_v2",["RTDetrV2ForObjectDetection",p7]],["rf_detr",["RFDetrForObjectDetection",n7]],["d_fine",["DFineForObjectDetection",t7]],["table-transformer",["TableTransformerForObjectDetection",JQ]],["yolos",["YolosForObjectDetection",rQ]]]),JG=new Map([["owlvit",["OwlViTForObjectDetection",O7]],["owlv2",["Owlv2ForObjectDetection",h7]],["grounding-dino",["GroundingDinoForObjectDetection",aQ]]]),Z5=new Map([["detr",["DetrForSegmentation",r$]],["clipseg",["CLIPSegForImageSegmentation",n8]]]),$G=new Map([["segformer",["SegformerForSemanticSegmentation",s9]],["sapiens",["SapiensForSemanticSegmentation",AQ]],["swin",["SwinForSemanticSegmentation",HQ]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",WK]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",YK]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",qK]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",VK]]]),ZG=new Map([["detr",["DetrForSegmentation",r$]],["maskformer",["MaskFormerForInstanceSegmentation",SQ]]]),WG=new Map([["sam",["SamModel",sQ]]]),QG=new Map([["wav2vec2",["Wav2Vec2ForCTC",W9]],["wav2vec2-bert",["Wav2Vec2BertForCTC",R9]],["unispeech",["UniSpeechForCTC",N9]],["unispeech-sat",["UniSpeechSatForCTC",L9]],["wavlm",["WavLMForCTC",C9]],["hubert",["HubertForCTC",w9]],["parakeet_ctc",["ParakeetForCTC",G9]]]),KG=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Q9]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",I9]],["unispeech",["UniSpeechForSequenceClassification",z9]],["unispeech-sat",["UniSpeechSatForSequenceClassification",A9]],["wavlm",["WavLMForSequenceClassification",S9]],["hubert",["HubertForSequenceClassification",j9]],["audio-spectrogram-transformer",["ASTForAudioClassification",w8]]]),YG=new Map([["wavlm",["WavLMForXVector",M9]]]),GG=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",B9]],["wavlm",["WavLMForAudioFrameClassification",T9]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",K9]],["pyannote",["PyAnnoteForAudioFrameClassification",q9]]]),XG=new Map([["vitmatte",["VitMatteForImageMatting",T7]]]),oU=new Map([["patchtst",["PatchTSTForPrediction",IK]],["patchtsmixer",["PatchTSMixerForPrediction",wK]]]),qG=new Map([["swin2sr",["Swin2SRForImageSuperResolution",VQ]]]),HG=new Map([["dpt",["DPTForDepthEstimation",zQ]],["depth_anything",["DepthAnythingForDepthEstimation",LQ]],["glpn",["GLPNForDepthEstimation",TQ]],["sapiens",["SapiensForDepthEstimation",BQ]],["depth_pro",["DepthProForDepthEstimation",IQ]],["metric3d",["Metric3DForDepthEstimation",wQ]],["metric3dv2",["Metric3Dv2ForDepthEstimation",PQ]]]),UG=new Map([["sapiens",["SapiensForNormalEstimation",FQ]]]),VG=new Map([["vitpose",["VitPoseForPoseEstimation",A7]]]),NG=new Map([["clip",["CLIPVisionModelWithProjection",d8]],["siglip",["SiglipVisionModel",l8]],["jina_clip",["JinaCLIPVisionModel",r8]]]),zG=[[rU,A.EncoderOnly],[eU,A.EncoderDecoder],[sU,A.DecoderOnly],[nU,A.AutoEncoder],[pY,A.EncoderOnly],[rY,A.EncoderOnly],[uK,A.Seq2Seq],[dK,A.Seq2Seq],[gK,A.DecoderOnly],[iU,A.MultiModality],[eY,A.EncoderOnly],[nY,A.EncoderOnly],[lK,A.Vision2Seq],[sY,A.ImageTextToText],[iY,A.AudioTextToText],[tY,A.EncoderOnly],[Z5,A.EncoderOnly],[ZG,A.EncoderOnly],[$G,A.EncoderOnly],[XG,A.EncoderOnly],[oU,A.EncoderOnly],[qG,A.EncoderOnly],[HG,A.EncoderOnly],[UG,A.EncoderOnly],[VG,A.EncoderOnly],[oY,A.EncoderOnly],[JG,A.EncoderOnly],[WG,A.MaskGeneration],[QG,A.EncoderOnly],[KG,A.EncoderOnly],[mY,A.Seq2Seq],[aY,A.EncoderOnly],[YG,A.EncoderOnly],[GG,A.EncoderOnly],[NG,A.EncoderOnly]];for(let[X,M]of zG)for(let[e,J0]of X.values())T.set(e,M),F.set(J0,e),B.set(e,J0);let JV=[["MusicgenForConditionalGeneration",wZ,A.Musicgen],["Phi3VForCausalLM",$$,A.Phi3V],["CLIPTextModelWithProjection",f8,A.EncoderOnly],["SiglipTextModel",g8,A.EncoderOnly],["JinaCLIPTextModel",p8,A.EncoderOnly],["ClapTextModelWithProjection",p9,A.EncoderOnly],["ClapAudioModelWithProjection",r9,A.EncoderOnly],["DacEncoderModel",vK,A.EncoderOnly],["DacDecoderModel",OK,A.EncoderOnly],["MimiEncoderModel",TK,A.EncoderOnly],["MimiDecoderModel",kK,A.EncoderOnly],["SnacEncoderModel",hK,A.EncoderOnly],["SnacDecoderModel",fK,A.EncoderOnly],["Gemma3nForConditionalGeneration",o5,A.ImageAudioTextToText]];for(let[X,M,e]of JV)T.set(X,e),F.set(M,X),B.set(X,M);let EG=new Map([["modnet",Z5],["birefnet",Z5],["isnet",Z5],["ben",Z5]]);for(let[X,M]of EG.entries())M.set(X,["PreTrainedModel",S]),T.set(X,A.EncoderOnly),F.set(S,X),B.set(X,S);class LG extends F6{static MODEL_CLASS_MAPPINGS=zG.map((X)=>X[0]);static BASE_IF_FAIL=!0}class AG extends F6{static MODEL_CLASS_MAPPINGS=[pY]}class BG extends F6{static MODEL_CLASS_MAPPINGS=[rY]}class FG extends F6{static MODEL_CLASS_MAPPINGS=[uK]}class RG extends F6{static MODEL_CLASS_MAPPINGS=[dK]}class IG extends F6{static MODEL_CLASS_MAPPINGS=[mY]}class DG extends F6{static MODEL_CLASS_MAPPINGS=[aY]}class wG extends F6{static MODEL_CLASS_MAPPINGS=[gK]}class jG extends F6{static MODEL_CLASS_MAPPINGS=[eY]}class PG extends F6{static MODEL_CLASS_MAPPINGS=[nY]}class CG extends F6{static MODEL_CLASS_MAPPINGS=[lK]}class SG extends F6{static MODEL_CLASS_MAPPINGS=[tY]}class MG extends F6{static MODEL_CLASS_MAPPINGS=[Z5]}class TG extends F6{static MODEL_CLASS_MAPPINGS=[$G]}class kG extends F6{static MODEL_CLASS_MAPPINGS=[ZG]}class _G extends F6{static MODEL_CLASS_MAPPINGS=[oY]}class xG extends F6{static MODEL_CLASS_MAPPINGS=[JG]}class yG extends F6{static MODEL_CLASS_MAPPINGS=[WG]}class vG extends F6{static MODEL_CLASS_MAPPINGS=[QG]}class OG extends F6{static MODEL_CLASS_MAPPINGS=[KG]}class bG extends F6{static MODEL_CLASS_MAPPINGS=[YG]}class hG extends F6{static MODEL_CLASS_MAPPINGS=[GG]}class fG extends F6{static MODEL_CLASS_MAPPINGS=[tU]}class dG extends F6{static MODEL_CLASS_MAPPINGS=[XG]}class uG extends F6{static MODEL_CLASS_MAPPINGS=[qG]}class gG extends F6{static MODEL_CLASS_MAPPINGS=[HG]}class lG extends F6{static MODEL_CLASS_MAPPINGS=[UG]}class cG extends F6{static MODEL_CLASS_MAPPINGS=[VG]}class mG extends F6{static MODEL_CLASS_MAPPINGS=[NG]}class aG extends F6{static MODEL_CLASS_MAPPINGS=[sY]}class pG extends F6{static MODEL_CLASS_MAPPINGS=[iY]}class rG extends Q0{constructor({logits:X,past_key_values:M,encoder_outputs:e,decoder_attentions:J0=null,cross_attentions:q0=null}){super();this.logits=X,this.past_key_values=M,this.encoder_outputs=e,this.decoder_attentions=J0,this.cross_attentions=q0}}class q6 extends Q0{constructor({logits:X,...M}){super();this.logits=X;let e=Object.values(M);if(e.length>0)this.attentions=e}}class cK extends Q0{constructor({logits:X,embeddings:M}){super();this.logits=X,this.embeddings=M}}class g6 extends Q0{constructor({logits:X}){super();this.logits=X}}class c6 extends Q0{constructor({logits:X}){super();this.logits=X}}class J4 extends Q0{constructor({start_logits:X,end_logits:M}){super();this.start_logits=X,this.end_logits=M}}class NJ extends Q0{constructor({logits:X}){super();this.logits=X}}class eG extends Q0{constructor({logits:X,past_key_values:M}){super();this.logits=X,this.past_key_values=M}}class mK extends Q0{constructor({alphas:X}){super();this.alphas=X}}class aK extends Q0{constructor({waveform:X,spectrogram:M}){super();this.waveform=X,this.spectrogram=M}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(J,Z,$)=>{/*!******************************************************************************************************!*\
  !*** ./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js ***!
  \******************************************************************************************************/$.r(Z),$.d(Z,{ASTFeatureExtractor:()=>H});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends W.FeatureExtractor{constructor(G){super(G);let q=this.config.sampling_rate,E=(0,Y.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(q/2),q,null,"kaldi",!0);this.mel_filters=E,this.window=(0,Y.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(G,q){return(0,Y.spectrogram)(G,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:0.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:0.0000001192092955078125,remove_dc_offset:!0,max_num_frames:q,transpose:!0})}async _call(G){(0,W.validate_audio_inputs)(G,"ASTFeatureExtractor");let q=await this._extract_fbank_features(G,this.config.max_length);if(this.config.do_normalize){let E=this.std*2,V=q.data;for(let N=0;N<V.length;++N)V[N]=(V[N]-this.mean)/E}return{input_values:q.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/auto/feature_extraction_auto.js ***!
  \****************************************************/$.r(Z),$.d(Z,{AutoFeatureExtractor:()=>G});var W=$("./src/utils/constants.js");/*! ../../utils/constants.js */var Q=$("./src/utils/hub.js");/*! ../../utils/hub.js */var Y=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var H=$("./src/models/feature_extractors.js");/*! ../feature_extractors.js */class G{static async from_pretrained(q,E={}){let V=await(0,Q.getModelJSON)(q,W.FEATURE_EXTRACTOR_NAME,!0,E),N=V.feature_extractor_type,z=H[N];if(!z)throw Error(`Unknown feature_extractor_type: '${N}'. Please report this at ${W.GITHUB_ISSUE_URL}.`);return new z(V)}}},"./src/models/auto/image_processing_auto.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/auto/image_processing_auto.js ***!
  \**************************************************/$.r(Z),$.d(Z,{AutoImageProcessor:()=>G});var W=$("./src/utils/constants.js");/*! ../../utils/constants.js */var Q=$("./src/utils/hub.js");/*! ../../utils/hub.js */var Y=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var H=$("./src/models/image_processors.js");/*! ../image_processors.js */class G{static async from_pretrained(q,E={}){let V=await(0,Q.getModelJSON)(q,W.IMAGE_PROCESSOR_NAME,!0,E),N=V.image_processor_type??V.feature_extractor_type,z=H[N?.replace(/Fast$/,"")];if(!z){if(N!==void 0)console.warn(`Image processor type '${N}' not found, assuming base ImageProcessor. Please report this at ${W.GITHUB_ISSUE_URL}.`);z=Y.ImageProcessor}return new z(V)}}},"./src/models/auto/processing_auto.js":(J,Z,$)=>{/*!********************************************!*\
  !*** ./src/models/auto/processing_auto.js ***!
  \********************************************/$.r(Z),$.d(Z,{AutoProcessor:()=>E});var W=$("./src/utils/constants.js");/*! ../../utils/constants.js */var Q=$("./src/utils/hub.js");/*! ../../utils/hub.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var H=$("./src/models/processors.js");/*! ../processors.js */var G=$("./src/models/image_processors.js");/*! ../image_processors.js */var q=$("./src/models/feature_extractors.js");/*! ../feature_extractors.js */class E{static async from_pretrained(V,N={}){let z=await(0,Q.getModelJSON)(V,W.IMAGE_PROCESSOR_NAME,!0,N),{image_processor_type:w,feature_extractor_type:R,processor_class:y}=z;if(y&&H[y])return H[y].from_pretrained(V,N);if(!w&&!R)throw Error("No `image_processor_type` or `feature_extractor_type` found in the config.");let D={};if(w){let v=G[w.replace(/Fast$/,"")];if(!v)throw Error(`Unknown image_processor_type: '${w}'.`);D.image_processor=new v(z)}if(R){let v=G[R];if(v)D.image_processor=new v(z);else{let g=q[R];if(!g)throw Error(`Unknown feature_extractor_type: '${R}'.`);D.feature_extractor=new g(z)}}let j={};return new Y.Processor(j,D,null)}}},"./src/models/beit/image_processing_beit.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/beit/image_processing_beit.js ***!
  \**************************************************/$.r(Z),$.d(Z,{BeitFeatureExtractor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/bit/image_processing_bit.js ***!
  \************************************************/$.r(Z),$.d(Z,{BitImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/chinese_clip/image_processing_chinese_clip.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{ChineseCLIPFeatureExtractor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/clap/feature_extraction_clap.js ***!
  \****************************************************/$.r(Z),$.d(Z,{ClapFeatureExtractor:()=>H});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends W.FeatureExtractor{constructor(G){super(G);this.mel_filters=(0,Y.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,Y.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,Y.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(G,q,E,V){let N,z=!1,w=G.length-q;if(w>0)if(E==="rand_trunc"){z=!0;let R=Math.floor(Math.random()*(w+1));G=G.subarray(R,R+q),N=await this._extract_fbank_features(G,this.mel_filters_slaney,this.config.nb_max_samples)}else throw Error(`Truncation strategy "${E}" not implemented`);else{if(w<0){let R=new Float64Array(q);if(R.set(G),V==="repeat")for(let y=G.length;y<q;y+=G.length)R.set(G.subarray(0,Math.min(G.length,q-y)),y);else if(V==="repeatpad")for(let y=G.length;y<-w;y+=G.length)R.set(G,y);G=R}if(E==="fusion")throw Error(`Truncation strategy "${E}" not implemented`);N=await this._extract_fbank_features(G,this.mel_filters_slaney,this.config.nb_max_samples)}return N.unsqueeze_(0)}async _extract_fbank_features(G,q,E=null){return(0,Y.spectrogram)(G,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:q,log_mel:"dB",max_num_frames:E,do_pad:!1,transpose:!0})}async _call(G,{max_length:q=null}={}){return(0,W.validate_audio_inputs)(G,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(G,q??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/clip/image_processing_clip.js ***!
  \**************************************************/$.r(Z),$.d(Z,{CLIPFeatureExtractor:()=>Y,CLIPImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/convnext/image_processing_convnext.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/convnext/image_processing_convnext.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{ConvNextFeatureExtractor:()=>Y,ConvNextImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{constructor(H){super(H);this.crop_pct=this.config.crop_pct??0.875}async resize(H){let G=this.size?.shortest_edge;if(G===void 0)throw Error("Size dictionary must contain 'shortest_edge' key.");if(G<384){let q=Math.floor(G/this.crop_pct),[E,V]=this.get_resize_output_image_size(H,{shortest_edge:q});H=await H.resize(E,V,{resample:this.resample}),H=await H.center_crop(G,G)}else H=await H.resize(G,G,{resample:this.resample});return H}}class Y extends Q{}},"./src/models/dac/feature_extraction_dac.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/dac/feature_extraction_dac.js ***!
  \**************************************************/$.r(Z),$.d(Z,{DacFeatureExtractor:()=>Q});var W=$("./src/models/encodec/feature_extraction_encodec.js");/*! ../encodec/feature_extraction_encodec.js */class Q extends W.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/deit/image_processing_deit.js ***!
  \**************************************************/$.r(Z),$.d(Z,{DeiTFeatureExtractor:()=>Y,DeiTImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/detr/image_processing_detr.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/detr/image_processing_detr.js ***!
  \**************************************************/$.r(Z),$.d(Z,{DetrFeatureExtractor:()=>H,DetrImageProcessor:()=>Y});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.ImageProcessor{async _call(G){let q=await super._call(G),E=[q.pixel_values.dims[0],64,64],V=(0,Q.full)(E,1n);return{...q,pixel_mask:V}}post_process_object_detection(...G){return(0,W.post_process_object_detection)(...G)}post_process_panoptic_segmentation(...G){return(0,W.post_process_panoptic_segmentation)(...G)}post_process_instance_segmentation(...G){return(0,W.post_process_instance_segmentation)(...G)}}class H extends Y{}},"./src/models/dinov3_vit/image_processing_dinov3_vit.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/dinov3_vit/image_processing_dinov3_vit.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{DINOv3ViTImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/donut/image_processing_donut.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/donut/image_processing_donut.js ***!
  \****************************************************/$.r(Z),$.d(Z,{DonutFeatureExtractor:()=>Y,DonutImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{pad_image(H,G,q,E={}){let[V,N,z]=G,w=this.image_mean;if(!Array.isArray(this.image_mean))w=Array(z).fill(w);let R=this.image_std;if(!Array.isArray(R))R=Array(z).fill(w);let y=w.map((D,j)=>-D/R[j]);return super.pad_image(H,G,q,{center:!0,constant_values:y,...E})}}class Y extends Q{}},"./src/models/dpt/image_processing_dpt.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/dpt/image_processing_dpt.js ***!
  \************************************************/$.r(Z),$.d(Z,{DPTFeatureExtractor:()=>Y,DPTImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/efficientnet/image_processing_efficientnet.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/efficientnet/image_processing_efficientnet.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{EfficientNetImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{constructor(Y){super(Y);if(this.include_top=this.config.include_top??!0,this.include_top)this.image_std=this.image_std.map((H)=>H*H)}}},"./src/models/encodec/feature_extraction_encodec.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/encodec/feature_extraction_encodec.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{EncodecFeatureExtractor:()=>Y});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.FeatureExtractor{async _call(H){if((0,W.validate_audio_inputs)(H,"EncodecFeatureExtractor"),H instanceof Float64Array)H=new Float32Array(H);let G=this.config.feature_size;if(H.length%G!==0)throw Error(`The length of the audio data must be a multiple of the number of channels (${G}).`);let q=[1,G,H.length/G];return{input_values:new Q.Tensor("float32",H,q)}}}},"./src/models/feature_extractors.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/models/feature_extractors.js ***!
  \******************************************/$.r(Z),$.d(Z,{ASTFeatureExtractor:()=>W.ASTFeatureExtractor,ClapFeatureExtractor:()=>Y.ClapFeatureExtractor,DacFeatureExtractor:()=>H.DacFeatureExtractor,EncodecFeatureExtractor:()=>Q.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>G.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>j.ImageProcessor,MoonshineFeatureExtractor:()=>q.MoonshineFeatureExtractor,ParakeetFeatureExtractor:()=>E.ParakeetFeatureExtractor,PyAnnoteFeatureExtractor:()=>V.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>N.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>z.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>w.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>R.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>y.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>D.WhisperFeatureExtractor});var W=$("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js");/*! ./audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js */var Q=$("./src/models/encodec/feature_extraction_encodec.js");/*! ./encodec/feature_extraction_encodec.js */var Y=$("./src/models/clap/feature_extraction_clap.js");/*! ./clap/feature_extraction_clap.js */var H=$("./src/models/dac/feature_extraction_dac.js");/*! ./dac/feature_extraction_dac.js */var G=$("./src/models/gemma3n/feature_extraction_gemma3n.js");/*! ./gemma3n/feature_extraction_gemma3n.js */var q=$("./src/models/moonshine/feature_extraction_moonshine.js");/*! ./moonshine/feature_extraction_moonshine.js */var E=$("./src/models/parakeet/feature_extraction_parakeet.js");/*! ./parakeet/feature_extraction_parakeet.js */var V=$("./src/models/pyannote/feature_extraction_pyannote.js");/*! ./pyannote/feature_extraction_pyannote.js */var N=$("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js");/*! ./seamless_m4t/feature_extraction_seamless_m4t.js */var z=$("./src/models/snac/feature_extraction_snac.js");/*! ./snac/feature_extraction_snac.js */var w=$("./src/models/speecht5/feature_extraction_speecht5.js");/*! ./speecht5/feature_extraction_speecht5.js */var R=$("./src/models/wav2vec2/feature_extraction_wav2vec2.js");/*! ./wav2vec2/feature_extraction_wav2vec2.js */var y=$("./src/models/wespeaker/feature_extraction_wespeaker.js");/*! ./wespeaker/feature_extraction_wespeaker.js */var D=$("./src/models/whisper/feature_extraction_whisper.js");/*! ./whisper/feature_extraction_whisper.js */var j=$("./src/base/image_processors_utils.js");/*! ../base/image_processors_utils.js */},"./src/models/florence2/processing_florence2.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/florence2/processing_florence2.js ***!
  \******************************************************/$.r(Z),$.d(Z,{Florence2Processor:()=>H});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor;constructor(G,q,E){super(G,q,E);let{tasks_answer_post_processing_type:V,task_prompts_without_inputs:N,task_prompts_with_input:z}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(V??{})),this.task_prompts_without_inputs=new Map(Object.entries(N??{})),this.task_prompts_with_input=new Map(Object.entries(z??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1000}construct_prompts(G){if(typeof G==="string")G=[G];let q=[];for(let E of G)if(this.task_prompts_without_inputs.has(E))q.push(this.task_prompts_without_inputs.get(E));else{for(let[V,N]of this.task_prompts_with_input)if(E.includes(V)){q.push(N.replaceAll("{input}",E).replaceAll(V,""));break}if(q.length!==G.length)q.push(E)}return q}post_process_generation(G,q,E){let V=this.tasks_answer_post_processing_type.get(q)??"pure_text";G=G.replaceAll("<s>","").replaceAll("</s>","");let N;switch(V){case"pure_text":N=G;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":let z=V==="ocr"?"quad_boxes":"bboxes",w=G.matchAll(this.regexes[z]),R=[],y=[];for(let[D,j,...v]of w)R.push(j?j.trim():R.at(-1)??""),y.push(v.map((g,A)=>(Number(g)+0.5)/this.size_per_bin*E[A%2]));N={labels:R,[z]:y};break;default:throw Error(`Task "${q}" (of type "${V}") not yet implemented.`)}return{[q]:N}}async _call(G,q=null,E={}){if(!G&&!q)throw Error("Either text or images must be provided");let V=await this.image_processor(G,E),N=q?this.tokenizer(this.construct_prompts(q),E):{};return{...V,...N}}}},"./src/models/gemma3n/feature_extraction_gemma3n.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/gemma3n/feature_extraction_gemma3n.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{Gemma3nAudioFeatureExtractor:()=>H});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends W.FeatureExtractor{constructor(G){super(G);let{fft_length:q,feature_size:E,min_frequency:V,max_frequency:N,sampling_rate:z,frame_length:w}=this.config,R=(0,Y.mel_filter_bank)(Math.floor(1+q/2),E,V,N,z,null,"htk",!1);this.mel_filters=R,this.window=(0,Y.window_function)(w,"hann")}async _extract_fbank_features(G,q){return(0,Y.spectrogram)(G,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(G,{max_length:q=480000,truncation:E=!0,padding:V=!0,pad_to_multiple_of:N=128}={}){if((0,W.validate_audio_inputs)(G,"Gemma3nAudioFeatureExtractor"),E&&G.length>q)G=G.slice(0,q);if(V&&G.length%N!==0){let R=N-G.length%N,y=new Float64Array(G.length+R);if(y.set(G),this.config.padding_value!==0)y.fill(this.config.padding_value,G.length);G=y}let z=await this._extract_fbank_features(G,this.config.max_length),w=(0,Q.full)([1,z.dims[0]],!0);return{input_features:z.unsqueeze_(0),input_features_mask:w}}}},"./src/models/gemma3n/processing_gemma3n.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/gemma3n/processing_gemma3n.js ***!
  \**************************************************/$.r(Z),$.d(Z,{Gemma3nProcessor:()=>E});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var H=$("./src/tokenizers.js");/*! ../../tokenizers.js */var G=$("./src/utils/image.js");/*! ../../utils/image.js */var q=$("./src/utils/audio.js");/*! ../../utils/audio.js */class E extends W.Processor{static image_processor_class=Q.AutoImageProcessor;static feature_extractor_class=Y.AutoFeatureExtractor;static tokenizer_class=H.AutoTokenizer;static uses_processor_config=!0;static uses_chat_template_file=!0;constructor(V,N,z){super(V,N,z);this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;let{audio_token_id:w,boa_token:R,audio_token:y,eoa_token:D,image_token_id:j,boi_token:v,image_token:g,eoi_token:A}=this.tokenizer.config;this.audio_token_id=w,this.boa_token=R,this.audio_token=y;let T=y.repeat(this.audio_seq_length);this.full_audio_sequence=`

${R}${T}${D}

`,this.image_token_id=j,this.boi_token=v,this.image_token=g;let B=g.repeat(this.image_seq_length);this.full_image_sequence=`

${v}${B}${A}

`}async _call(V,N=null,z=null,w={}){if(typeof V==="string")V=[V];let R;if(z)R=await this.feature_extractor(z,w),V=V.map((j)=>j.replaceAll(this.audio_token,this.full_audio_sequence));let y;if(N)y=await this.image_processor(N,w),V=V.map((j)=>j.replaceAll(this.image_token,this.full_image_sequence));return{...this.tokenizer(V,w),...y,...R}}}},"./src/models/glpn/image_processing_glpn.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/glpn/image_processing_glpn.js ***!
  \**************************************************/$.r(Z),$.d(Z,{GLPNFeatureExtractor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(J,Z,$)=>{/*!**********************************************************************!*\
  !*** ./src/models/grounding_dino/image_processing_grounding_dino.js ***!
  \**********************************************************************/$.r(Z),$.d(Z,{GroundingDinoImageProcessor:()=>Y});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.ImageProcessor{async _call(H){let G=await super._call(H),q=G.pixel_values.dims,E=(0,Q.ones)([q[0],q[2],q[3]]);return{...G,pixel_mask:E}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(J,Z,$)=>{/*!****************************************************************!*\
  !*** ./src/models/grounding_dino/processing_grounding_dino.js ***!
  \****************************************************************/$.r(Z),$.d(Z,{GroundingDinoProcessor:()=>q});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */function G(E,V){let z=E.dims.at(-1)-1,w=E.tolist();w.fill(!1,0,1),w.fill(!1,z);let R=V.tolist();return w.map((y,D)=>y?D:null).filter((y)=>y!==null).map((y)=>R[y])}class q extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor;async _call(E,V,N={}){let z=E?await this.image_processor(E,N):{};return{...V?this.tokenizer(V,N):{},...z}}post_process_grounded_object_detection(E,V,{box_threshold:N=0.25,text_threshold:z=0.25,target_sizes:w=null}={}){let{logits:R,pred_boxes:y}=E,D=R.dims[0];if(w!==null&&w.length!==D)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let j=R.dims.at(1),v=R.sigmoid(),g=v.max(-1).tolist(),A=y.tolist().map((B)=>B.map((F)=>(0,H.center_to_corners_format)(F))),T=[];for(let B=0;B<D;++B){let F=w!==null?w[B]:null;if(F!==null)A[B]=A[B].map((m)=>m.map((d,a)=>d*F[(a+1)%2]));let P=g[B],_=[],h=[],c=[];for(let m=0;m<j;++m){let d=P[m];if(d<=N)continue;let a=A[B][m],n=v[B][m];_.push(d),c.push(a);let t=G(n.gt(z),V[B]);h.push(t)}T.push({scores:_,boxes:c,labels:this.batch_decode(h)})}return T}}},"./src/models/idefics3/image_processing_idefics3.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/idefics3/image_processing_idefics3.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{Idefics3ImageProcessor:()=>Y});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.ImageProcessor{constructor(H){super(H);this.do_image_splitting=H.do_image_splitting??!0,this.max_image_size=H.max_image_size}get_resize_for_vision_encoder(H,G){let[q,E]=H.dims.slice(-2),V=E/q;if(E>=q)E=Math.ceil(E/G)*G,q=Math.floor(E/V),q=Math.ceil(q/G)*G;else q=Math.ceil(q/G)*G,E=Math.floor(q*V),E=Math.ceil(E/G)*G;return{height:q,width:E}}async _call(H,{do_image_splitting:G=null,return_row_col_info:q=!1}={}){let E;if(!Array.isArray(H))E=[[H]];else{if(H.length===0||!H[0])throw Error("No images provided.");if(!Array.isArray(H[0]))E=[H];else E=H}let V=[],N=[],z=[],w=[],R=[];for(let B of E){let F=await Promise.all(B.map((h)=>this.preprocess(h)));w.push(...F.map((h)=>h.original_size)),R.push(...F.map((h)=>h.reshaped_input_size)),F.forEach((h)=>h.pixel_values.unsqueeze_(0));let{longest_edge:P}=this.max_image_size,_;if(G??this.do_image_splitting){let h=Array(F.length),c=Array(F.length);_=await Promise.all(F.map(async(m,d)=>{let a=this.get_resize_for_vision_encoder(m.pixel_values,P),n=await(0,Q.interpolate_4d)(m.pixel_values,{size:[a.height,a.width]}),{frames:t,num_splits_h:W0,num_splits_w:o}=await this.split_image(n,this.max_image_size);return h[d]=W0,c[d]=o,(0,Q.cat)(t,0)})),N.push(h),z.push(c)}else{let h=[P,P];_=await Promise.all(F.map((c)=>(0,Q.interpolate_4d)(c.pixel_values,{size:h}))),N.push(Array(F.length).fill(0)),z.push(Array(F.length).fill(0))}V.push((0,Q.cat)(_,0))}let y=V.length,[D,j,v,g]=V[0].dims,A,T;if(y===1)A=V[0].unsqueeze_(0),T=(0,Q.full)([y,D,v,g],!0);else{let B=Math.max(...V.map((_)=>_.dims.at(0)));T=(0,Q.full)([y,B,v,g],!0);let F=T.data,P=B*v*g;for(let _=0;_<y;++_){let h=V[_].dims[0];if(h<B){V[_]=(0,Q.cat)([V[_],(0,Q.full)([B-h,j,v,g],0)],0);let c=_*P+h*v*g,m=(_+1)*P;F.fill(!1,c,m)}}A=(0,Q.stack)(V,0)}return{pixel_values:A,pixel_attention_mask:T,original_sizes:w,reshaped_input_sizes:R,...q?{rows:N,cols:z}:{}}}async split_image(H,{longest_edge:G}){let q=G,E=G,V=[],[N,z]=H.dims.slice(-2),w=0,R=0;if(N>q||z>E){w=Math.ceil(N/q),R=Math.ceil(z/E);let y=Math.ceil(N/w),D=Math.ceil(z/R);for(let g=0;g<w;++g)for(let A=0;A<R;++A){let T,B,F,P;if(g===w-1)B=N-y,P=N;else B=g*y,P=(g+1)*y;if(A===R-1)T=z-D,F=z;else T=A*D,F=(A+1)*D;let _=[B,T],h=[P,F],c=await(0,Q.slice)(H,_,h,[2,3]);V.push(c)}let j=q,v=E;if(N!==j||z!==v)H=await(0,Q.interpolate_4d)(H,{size:[j,v]})}return V.push(H),{frames:V,num_splits_h:w,num_splits_w:R}}}},"./src/models/idefics3/processing_idefics3.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/idefics3/processing_idefics3.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Idefics3Processor:()=>N});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/image.js");/*! ../../utils/image.js */var G=$("./src/utils/core.js");/*! ../../utils/core.js */function q(z,w,R,y,D,j){let v="";for(let g=0;g<w;++g){for(let A=0;A<R;++A)v+=y+`<row_${g+1}_col_${A+1}>`+D.repeat(z);v+=`
`}return v+=`
${y}${j}`+D.repeat(z)+`${y}`,v}function E(z,w,R,y){return`${w}${y}`+R.repeat(z)+`${w}`}function V(z,w,R,y,D,j){if(z===0&&w===0)return E(R,y,D,j);return q(R,z,w,y,D,j)}class N extends W.Processor{static image_processor_class=Q.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;static uses_processor_config=!0;fake_image_token="<fake_token_around_image>";image_token="<image>";global_img_token="<global-img>";async _call(z,w=null,R={}){R.return_row_col_info??=!0;let y;if(w)y=await this.image_processor(w,R);if(!Array.isArray(z))z=[z];let D=y.rows??[Array(z.length).fill(0)],j=y.cols??[Array(z.length).fill(0)],v=this.config.image_seq_len,g=[],A=[];for(let B=0;B<z.length;++B){let F=z[B],P=D[B],_=j[B];g.push((0,G.count)(F,this.image_token));let h=P.map((d,a)=>V(d,_[a],v,this.fake_image_token,this.image_token,this.global_img_token)),c=F.split(this.image_token);if(c.length===0)throw Error("The image token should be present in the text.");let m=c[0];for(let d=0;d<h.length;++d)m+=h[d]+c[d+1];A.push(m)}return{...this.tokenizer(A),...y}}}},"./src/models/image_processors.js":(J,Z,$)=>{/*!****************************************!*\
  !*** ./src/models/image_processors.js ***!
  \****************************************/$.r(Z),$.d(Z,{BeitFeatureExtractor:()=>W.BeitFeatureExtractor,BitImageProcessor:()=>Q.BitImageProcessor,CLIPFeatureExtractor:()=>H.CLIPFeatureExtractor,CLIPImageProcessor:()=>H.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>Y.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>G.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>G.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>V.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>z.DPTFeatureExtractor,DPTImageProcessor:()=>z.DPTImageProcessor,DeiTFeatureExtractor:()=>q.DeiTFeatureExtractor,DeiTImageProcessor:()=>q.DeiTImageProcessor,DetrFeatureExtractor:()=>E.DetrFeatureExtractor,DetrImageProcessor:()=>E.DetrImageProcessor,DonutFeatureExtractor:()=>N.DonutFeatureExtractor,DonutImageProcessor:()=>N.DonutImageProcessor,EfficientNetImageProcessor:()=>w.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>R.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>y.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>D.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>v.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>g.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>A.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>T.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>T.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>B.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>B.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>F.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>F.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>P.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>P.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>_.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>_.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>h.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>h.MobileViTImageProcessor,NougatImageProcessor:()=>c.NougatImageProcessor,OwlViTFeatureExtractor:()=>d.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>d.OwlViTImageProcessor,Owlv2ImageProcessor:()=>m.Owlv2ImageProcessor,Phi3VImageProcessor:()=>a.Phi3VImageProcessor,PvtImageProcessor:()=>n.PvtImageProcessor,Qwen2VLImageProcessor:()=>t.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>W0.RTDetrImageProcessor,SamImageProcessor:()=>o.SamImageProcessor,SegformerFeatureExtractor:()=>N0.SegformerFeatureExtractor,SegformerImageProcessor:()=>N0.SegformerImageProcessor,SiglipImageProcessor:()=>w0.SiglipImageProcessor,SmolVLMImageProcessor:()=>I.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>O.Swin2SRImageProcessor,VLMImageProcessor:()=>j.VLMImageProcessor,ViTFeatureExtractor:()=>p.ViTFeatureExtractor,ViTImageProcessor:()=>p.ViTImageProcessor,VitMatteImageProcessor:()=>Z0.VitMatteImageProcessor,VitPoseImageProcessor:()=>z0.VitPoseImageProcessor,YolosFeatureExtractor:()=>A0.YolosFeatureExtractor,YolosImageProcessor:()=>A0.YolosImageProcessor});var W=$("./src/models/beit/image_processing_beit.js");/*! ./beit/image_processing_beit.js */var Q=$("./src/models/bit/image_processing_bit.js");/*! ./bit/image_processing_bit.js */var Y=$("./src/models/chinese_clip/image_processing_chinese_clip.js");/*! ./chinese_clip/image_processing_chinese_clip.js */var H=$("./src/models/clip/image_processing_clip.js");/*! ./clip/image_processing_clip.js */var G=$("./src/models/convnext/image_processing_convnext.js");/*! ./convnext/image_processing_convnext.js */var q=$("./src/models/deit/image_processing_deit.js");/*! ./deit/image_processing_deit.js */var E=$("./src/models/detr/image_processing_detr.js");/*! ./detr/image_processing_detr.js */var V=$("./src/models/dinov3_vit/image_processing_dinov3_vit.js");/*! ./dinov3_vit/image_processing_dinov3_vit.js */var N=$("./src/models/donut/image_processing_donut.js");/*! ./donut/image_processing_donut.js */var z=$("./src/models/dpt/image_processing_dpt.js");/*! ./dpt/image_processing_dpt.js */var w=$("./src/models/efficientnet/image_processing_efficientnet.js");/*! ./efficientnet/image_processing_efficientnet.js */var R=$("./src/models/glpn/image_processing_glpn.js");/*! ./glpn/image_processing_glpn.js */var y=$("./src/models/grounding_dino/image_processing_grounding_dino.js");/*! ./grounding_dino/image_processing_grounding_dino.js */var D=$("./src/models/idefics3/image_processing_idefics3.js");/*! ./idefics3/image_processing_idefics3.js */var j=$("./src/models/janus/image_processing_janus.js");/*! ./janus/image_processing_janus.js */var v=$("./src/models/jina_clip/image_processing_jina_clip.js");/*! ./jina_clip/image_processing_jina_clip.js */var g=$("./src/models/llava_onevision/image_processing_llava_onevision.js");/*! ./llava_onevision/image_processing_llava_onevision.js */var A=$("./src/models/mask2former/image_processing_mask2former.js");/*! ./mask2former/image_processing_mask2former.js */var T=$("./src/models/maskformer/image_processing_maskformer.js");/*! ./maskformer/image_processing_maskformer.js */var B=$("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js");/*! ./mobilenet_v1/image_processing_mobilenet_v1.js */var F=$("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js");/*! ./mobilenet_v2/image_processing_mobilenet_v2.js */var P=$("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js");/*! ./mobilenet_v3/image_processing_mobilenet_v3.js */var _=$("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js");/*! ./mobilenet_v4/image_processing_mobilenet_v4.js */var h=$("./src/models/mobilevit/image_processing_mobilevit.js");/*! ./mobilevit/image_processing_mobilevit.js */var c=$("./src/models/nougat/image_processing_nougat.js");/*! ./nougat/image_processing_nougat.js */var m=$("./src/models/owlv2/image_processing_owlv2.js");/*! ./owlv2/image_processing_owlv2.js */var d=$("./src/models/owlvit/image_processing_owlvit.js");/*! ./owlvit/image_processing_owlvit.js */var a=$("./src/models/phi3_v/image_processing_phi3_v.js");/*! ./phi3_v/image_processing_phi3_v.js */var n=$("./src/models/pvt/image_processing_pvt.js");/*! ./pvt/image_processing_pvt.js */var t=$("./src/models/qwen2_vl/image_processing_qwen2_vl.js");/*! ./qwen2_vl/image_processing_qwen2_vl.js */var W0=$("./src/models/rt_detr/image_processing_rt_detr.js");/*! ./rt_detr/image_processing_rt_detr.js */var o=$("./src/models/sam/image_processing_sam.js");/*! ./sam/image_processing_sam.js */var N0=$("./src/models/segformer/image_processing_segformer.js");/*! ./segformer/image_processing_segformer.js */var w0=$("./src/models/siglip/image_processing_siglip.js");/*! ./siglip/image_processing_siglip.js */var I=$("./src/models/smolvlm/image_processing_smolvlm.js");/*! ./smolvlm/image_processing_smolvlm.js */var O=$("./src/models/swin2sr/image_processing_swin2sr.js");/*! ./swin2sr/image_processing_swin2sr.js */var p=$("./src/models/vit/image_processing_vit.js");/*! ./vit/image_processing_vit.js */var Z0=$("./src/models/vitmatte/image_processing_vitmatte.js");/*! ./vitmatte/image_processing_vitmatte.js */var z0=$("./src/models/vitpose/image_processing_vitpose.js");/*! ./vitpose/image_processing_vitpose.js */var A0=$("./src/models/yolos/image_processing_yolos.js");/*! ./yolos/image_processing_yolos.js */},"./src/models/janus/image_processing_janus.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/janus/image_processing_janus.js ***!
  \****************************************************/$.r(Z),$.d(Z,{VLMImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{constructor(Y){super({do_pad:!0,pad_size:{width:Y.image_size,height:Y.image_size},...Y});this.constant_values=this.config.background_color.map((H)=>H*this.rescale_factor)}pad_image(Y,H,G,q){return super.pad_image(Y,H,G,{constant_values:this.constant_values,center:!0,...q})}}},"./src/models/janus/processing_janus.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/models/janus/processing_janus.js ***!
  \**********************************************/$.r(Z),$.d(Z,{VLChatProcessor:()=>E});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/core.js");/*! ../../utils/core.js */var G=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var q=$("./src/utils/image.js");/*! ../../utils/image.js */class E extends W.Processor{static image_processor_class=Q.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;static uses_processor_config=!0;constructor(V,N,z){super(V,N,z);this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(V,{images:N=null,chat_template:z="default"}={}){if(!N)N=await Promise.all(V.filter((_)=>_.images).flatMap((_)=>_.images).map((_)=>q.RawImage.read(_)));else if(!Array.isArray(N))N=[N];let w=this.tokenizer,R=w.apply_chat_template(V,{tokenize:!1,add_generation_prompt:!0,chat_template:z}),y=(_)=>w.encode(_,{add_special_tokens:!1}),D=R.split(this.image_tag),j=D.length-1;if(N.length!==j)throw Error(`Number of images provided (${N.length}) does not match number of "${this.image_tag}" image tags (${j})`);let[v,g,A]=w.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]),T=y(D[0]),B=Array(T.length).fill(!1);for(let _=1;_<D.length;++_){let h=Array(this.num_image_tokens).fill(v),c=y(D[_]);T=(0,H.mergeArrays)(T,[g],h,[A],c);let m=Array(this.num_image_tokens).fill(!0);B=(0,H.mergeArrays)(B,[!1],m,[!1],Array(c.length).fill(!1))}let F=[1,T.length],P={input_ids:new G.Tensor("int64",T,F),attention_mask:new G.Tensor("int64",Array(T.length).fill(1),F),images_seq_mask:new G.Tensor("bool",B,F),images_emb_mask:new G.Tensor("bool",Array(j*this.num_image_tokens).fill(!0),[1,j,this.num_image_tokens])};if(N&&N.length>0){let _=await this.image_processor(N);return _.pixel_values.unsqueeze_(0),{...P,..._}}return P}}},"./src/models/jina_clip/image_processing_jina_clip.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/jina_clip/image_processing_jina_clip.js ***!
  \************************************************************/$.r(Z),$.d(Z,{JinaCLIPImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{constructor(Y){let{resize_mode:H,fill_color:G,interpolation:q,size:E,...V}=Y,N=H==="squash"?{width:E,height:E}:H==="shortest"?{shortest_edge:E}:{longest_edge:E},z=q==="bicubic"?3:2;super({...V,size:N,resample:z,do_center_crop:!0,crop_size:E,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/jina_clip/processing_jina_clip.js ***!
  \******************************************************/$.r(Z),$.d(Z,{JinaCLIPProcessor:()=>H});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor;async _call(G=null,q=null,E={}){if(!G&&!q)throw Error("Either text or images must be provided");let V=G?this.tokenizer(G,E):{},N=q?await this.image_processor(q,E):{};return{...V,...N}}}},"./src/models/llava/processing_llava.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/models/llava/processing_llava.js ***!
  \**********************************************/$.r(Z),$.d(Z,{LlavaProcessor:()=>H});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor;static uses_processor_config=!0;async _call(G,q=null,E={}){let V=await this.image_processor(G,E);if(q){let[z,w]=V.pixel_values.dims.slice(-2),{image_token:R,patch_size:y,num_additional_image_tokens:D}=this.config,j=Math.floor(z/y)*Math.floor(w/y)+D;if(q=structuredClone(q),!Array.isArray(q))q=[q];for(let v=0;v<q.length;++v)q[v]=q[v].replace(R,R.repeat(j))}let N=q?this.tokenizer(q,E):{};return{...V,...N}}}},"./src/models/llava_onevision/image_processing_llava_onevision.js":(J,Z,$)=>{/*!************************************************************************!*\
  !*** ./src/models/llava_onevision/image_processing_llava_onevision.js ***!
  \************************************************************************/$.r(Z),$.d(Z,{LlavaOnevisionImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(J,Z,$)=>{/*!****************************************************************!*\
  !*** ./src/models/mask2former/image_processing_mask2former.js ***!
  \****************************************************************/$.r(Z),$.d(Z,{Mask2FormerImageProcessor:()=>Q});var W=$("./src/models/maskformer/image_processing_maskformer.js");/*! ../maskformer/image_processing_maskformer.js */class Q extends W.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/maskformer/image_processing_maskformer.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{MaskFormerFeatureExtractor:()=>Y,MaskFormerImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{post_process_panoptic_segmentation(...H){return(0,W.post_process_panoptic_segmentation)(...H)}post_process_instance_segmentation(...H){return(0,W.post_process_instance_segmentation)(...H)}}class Y extends Q{}},"./src/models/mgp_str/processing_mgp_str.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/mgp_str/processing_mgp_str.js ***!
  \**************************************************/$.r(Z),$.d(Z,{MgpstrProcessor:()=>q});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/maths.js");/*! ../../utils/maths.js */let G={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class q extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor;get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(E,V){if(!G.hasOwnProperty(V))throw Error(`Format ${V} is not supported.`);let[N,z]=G[V],w=this[N].bind(this),[R,y]=E.dims,D=[],j=[],v=E.tolist();for(let A=0;A<R;++A){let T=v[A],B=[],F=[];for(let _=1;_<y;++_){let[h,c]=(0,H.max)((0,H.softmax)(T[_]));if(F.push(h),c==z)break;B.push(c)}let P=F.length>0?F.reduce((_,h)=>_*h,1):0;j.push(B),D.push(P)}return[w(j),D]}char_decode(E){return this.char_tokenizer.batch_decode(E).map((V)=>V.replaceAll(" ",""))}bpe_decode(E){return this.bpe_tokenizer.batch_decode(E)}wp_decode(E){return this.wp_tokenizer.batch_decode(E).map((V)=>V.replaceAll(" ",""))}batch_decode([E,V,N]){let[z,w]=this._decode_helper(E,"char"),[R,y]=this._decode_helper(V,"bpe"),[D,j]=this._decode_helper(N,"wp"),v=[],g=[];for(let A=0;A<z.length;++A){let[T,B]=(0,H.max)([w[A],y[A],j[A]]);v.push([z[A],R[A],D[A]][B]),g.push(T)}return{generated_text:v,scores:g,char_preds:z,bpe_preds:R,wp_preds:D}}static async from_pretrained(...E){let V=await super.from_pretrained(...E),N=await Y.AutoTokenizer.from_pretrained("Xenova/gpt2"),z=await Y.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return V.components={image_processor:V.image_processor,char_tokenizer:V.tokenizer,bpe_tokenizer:N,wp_tokenizer:z},V}async _call(E,V=null){let N=await this.image_processor(E);if(V)N.labels=this.tokenizer(V).input_ids;return N}}},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v1/image_processing_mobilenet_v1.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV1FeatureExtractor:()=>Y,MobileNetV1ImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v2/image_processing_mobilenet_v2.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV2FeatureExtractor:()=>Y,MobileNetV2ImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v3/image_processing_mobilenet_v3.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV3FeatureExtractor:()=>Y,MobileNetV3ImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v4/image_processing_mobilenet_v4.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV4FeatureExtractor:()=>Y,MobileNetV4ImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/mobilevit/image_processing_mobilevit.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/mobilevit/image_processing_mobilevit.js ***!
  \************************************************************/$.r(Z),$.d(Z,{MobileViTFeatureExtractor:()=>Y,MobileViTImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/moonshine/feature_extraction_moonshine.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/moonshine/feature_extraction_moonshine.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{MoonshineFeatureExtractor:()=>Y});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.FeatureExtractor{async _call(H){if((0,W.validate_audio_inputs)(H,"MoonshineFeatureExtractor"),H instanceof Float64Array)H=new Float32Array(H);let G=[1,H.length];return{input_values:new Q.Tensor("float32",H,G)}}}},"./src/models/moonshine/processing_moonshine.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/moonshine/processing_moonshine.js ***!
  \******************************************************/$.r(Z),$.d(Z,{MoonshineProcessor:()=>H});var W=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=W.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/nougat/image_processing_nougat.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/nougat/image_processing_nougat.js ***!
  \******************************************************/$.r(Z),$.d(Z,{NougatImageProcessor:()=>Q});var W=$("./src/models/donut/image_processing_donut.js");/*! ../donut/image_processing_donut.js */class Q extends W.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/owlv2/image_processing_owlv2.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Owlv2ImageProcessor:()=>Q});var W=$("./src/models/owlvit/image_processing_owlvit.js");/*! ../owlvit/image_processing_owlvit.js */class Q extends W.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/owlvit/image_processing_owlvit.js ***!
  \******************************************************/$.r(Z),$.d(Z,{OwlViTFeatureExtractor:()=>Y,OwlViTImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{post_process_object_detection(...H){return(0,W.post_process_object_detection)(...H)}}class Y extends Q{}},"./src/models/owlvit/processing_owlvit.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/owlvit/processing_owlvit.js ***!
  \************************************************/$.r(Z),$.d(Z,{OwlViTProcessor:()=>H});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor}},"./src/models/paligemma/processing_paligemma.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/paligemma/processing_paligemma.js ***!
  \******************************************************/$.r(Z),$.d(Z,{PaliGemmaProcessor:()=>q});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */let H="<image>";function G(E,V,N,z,w){return`${z.repeat(N*w)}${V}${E}
`}class q extends W.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=Q.AutoImageProcessor;static uses_processor_config=!1;async _call(E,V=null,N={}){if(!V)console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),V="";if(!Array.isArray(E))E=[E];if(!Array.isArray(V))V=[V];let z=this.tokenizer.bos_token,w=this.image_processor.config.image_seq_length,R;if(V.some((j)=>j.includes(H)))R=V.map((j)=>{let v=j.replaceAll(H,H.repeat(w)),g=v.lastIndexOf(H),A=g===-1?0:g+H.length;return v.slice(0,A)+z+v.slice(A)+`
`});else console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),R=V.map((j)=>G(j,z,w,H,E.length));let y=this.tokenizer(R,N);return{...await this.image_processor(E,N),...y}}}},"./src/models/parakeet/feature_extraction_parakeet.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/parakeet/feature_extraction_parakeet.js ***!
  \************************************************************/$.r(Z),$.d(Z,{ParakeetFeatureExtractor:()=>G});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */let H=0.00001;class G extends W.FeatureExtractor{constructor(q){super(q);this.config.mel_filters??=(0,Y.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,this.config.sampling_rate/2,this.config.sampling_rate,"slaney","slaney");let E=(0,Y.window_function)(this.config.win_length,"hann",{periodic:!1});this.window=new Float64Array(this.config.n_fft);let V=Math.floor((this.config.n_fft-this.config.win_length)/2);this.window.set(E,V)}async _extract_fbank_features(q){let E=this.config.preemphasis;q=new Float64Array(q);for(let N=q.length-1;N>=1;--N)q[N]-=E*q[N-1];return await(0,Y.spectrogram)(q,this.window,this.window.length,this.config.hop_length,{fft_length:this.config.n_fft,power:2,mel_filters:this.config.mel_filters,log_mel:"log",mel_floor:-1/0,pad_mode:"constant",center:!0,transpose:!0,mel_offset:0.00000005960464477539063})}async _call(q){(0,W.validate_audio_inputs)(q,"ParakeetFeatureExtractor");let E=await this._extract_fbank_features(q),V=Math.floor((q.length+Math.floor(this.config.n_fft/2)*2-this.config.n_fft)/this.config.hop_length),N=E.data;N.fill(0,V*E.dims[1]);let[z,w]=E.dims,R=new Float64Array(w),y=new Float64Array(w);for(let v=0;v<V;++v){let g=v*w;for(let A=0;A<w;++A){let T=N[g+A];R[A]+=T,y[A]+=T*T}}let D=V>1?V-1:1;for(let v=0;v<w;++v){let g=R[v]/V,A=(y[v]-V*g*g)/D,B=1/(Math.sqrt(A)+H);for(let F=0;F<V;++F){let P=F*w+v;N[P]=(N[P]-g)*B}}let j=new BigInt64Array(z);return j.fill(1n,0,V),{input_features:E.unsqueeze_(0),attention_mask:new Q.Tensor("int64",j,[1,z])}}}},"./src/models/phi3_v/image_processing_phi3_v.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/phi3_v/image_processing_phi3_v.js ***!
  \******************************************************/$.r(Z),$.d(Z,{Phi3VImageProcessor:()=>V});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */let Y=336,H=[2,3],{ceil:G,floor:q,sqrt:E}=Math;class V extends W.ImageProcessor{constructor(N){super({...N,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0});this._num_crops=N.num_crops}calc_num_image_tokens_from_image_size(N,z){let{num_img_tokens:w}=this.config;return q((q(z/Y)*q(N/Y)+1)*w+1+(q(z/Y)+1)*E(w))}get_resize_output_image_size(N,z){let w=this._num_crops,[R,y]=N.size,D=R/y,j=1;while(j*Math.ceil(j/D)<=w)j+=1;j-=1;let v=Math.floor(j*336),g=Math.floor(v/D);return[v,g]}pad_image(N,z,w,R={}){let[y,D]=z,j=Y*G(y/Y),v=Y*G(D/Y),g=[1,1,1].map((A,T)=>(A-this.image_mean[T])/this.image_std[T]);return super.pad_image(N,z,{width:v,height:j},{center:!0,constant_values:g,...R})}async _call(N,{num_crops:z=null}={}){if(this._num_crops=z??=this.config.num_crops,z<4||E(z)%1!==0)throw Error("num_crops must be a square number >= 4");if(!Array.isArray(N))N=[N];let w=N.length,R=await Promise.all(N.map((B)=>this.preprocess(B))),y=R.map((B)=>B.original_size),D=R.map((B)=>B.reshaped_input_size),j=[];for(let{pixel_values:B}of R){B.unsqueeze_(0);let[F,P]=B.dims.slice(-2),_=await(0,Q.interpolate_4d)(B,{size:[Y,Y],mode:"bicubic"});if(z>0){let h=[],c=E(z),m=q(P/c),d=q(F/c);for(let n=0;n<c;++n)for(let t=0;t<c;++t){let W0,o,N0,w0;if(n===c-1)o=F-d,w0=F;else o=n*d,w0=(n+1)*d;if(t===c-1)W0=P-m,N0=P;else W0=t*m,N0=(t+1)*m;let I=[o,W0],O=[w0,N0],p=await(0,Q.slice)(B,I,O,H);h.push(p)}let a=await(0,Q.interpolate_4d)((0,Q.cat)(h,0),{size:[Y,Y],mode:"bicubic"});j.push((0,Q.cat)([_,a],0))}else j.push(_)}let v=(0,Q.stack)(j,0),g=D.map((B)=>B.map((F)=>Y*G(F/Y))),A=new Q.Tensor("int64",g.flat(),[w,2]),T=g.map(([B,F])=>this.calc_num_image_tokens_from_image_size(F,B));return{pixel_values:v,original_sizes:y,reshaped_input_sizes:D,image_sizes:A,num_img_tokens:T}}}},"./src/models/phi3_v/processing_phi3_v.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/phi3_v/processing_phi3_v.js ***!
  \************************************************/$.r(Z),$.d(Z,{Phi3VProcessor:()=>E});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/image.js");/*! ../../utils/image.js */let G="<|image|>",q=/<\|image_\d+\|>/g;class E extends W.Processor{static image_processor_class=Q.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;async _call(V,N=null,{padding:z=!0,truncation:w=!0,num_crops:R=null}={}){if(!Array.isArray(V))V=[V];let y,D;if(N){D=await this.image_processor(N,{num_crops:R});let{num_img_tokens:j}=D,v=V.map((A,T)=>A.split(q).join(G.repeat(j[T])));y=this.tokenizer(v,{padding:z,truncation:w});let g=this.tokenizer.model.convert_tokens_to_ids([G])[0];y.input_ids.map_((A)=>A==g?-A:A)}else y=this.tokenizer(V);return{...y,...D}}}},"./src/models/processors.js":(J,Z,$)=>{/*!**********************************!*\
  !*** ./src/models/processors.js ***!
  \**********************************/$.r(Z),$.d(Z,{Florence2Processor:()=>W.Florence2Processor,Gemma3nProcessor:()=>Q.Gemma3nProcessor,GroundingDinoProcessor:()=>Y.GroundingDinoProcessor,Idefics3Processor:()=>H.Idefics3Processor,JinaCLIPProcessor:()=>q.JinaCLIPProcessor,LlavaProcessor:()=>E.LlavaProcessor,MgpstrProcessor:()=>V.MgpstrProcessor,MoonshineProcessor:()=>N.MoonshineProcessor,OwlViTProcessor:()=>z.OwlViTProcessor,PaliGemmaProcessor:()=>R.PaliGemmaProcessor,Phi3VProcessor:()=>w.Phi3VProcessor,PyAnnoteProcessor:()=>y.PyAnnoteProcessor,Qwen2VLProcessor:()=>D.Qwen2VLProcessor,SamProcessor:()=>j.SamProcessor,SmolVLMProcessor:()=>v.SmolVLMProcessor,SpeechT5Processor:()=>g.SpeechT5Processor,UltravoxProcessor:()=>A.UltravoxProcessor,VLChatProcessor:()=>G.VLChatProcessor,VoxtralProcessor:()=>T.VoxtralProcessor,Wav2Vec2Processor:()=>B.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>F.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>P.WhisperProcessor});var W=$("./src/models/florence2/processing_florence2.js");/*! ./florence2/processing_florence2.js */var Q=$("./src/models/gemma3n/processing_gemma3n.js");/*! ./gemma3n/processing_gemma3n.js */var Y=$("./src/models/grounding_dino/processing_grounding_dino.js");/*! ./grounding_dino/processing_grounding_dino.js */var H=$("./src/models/idefics3/processing_idefics3.js");/*! ./idefics3/processing_idefics3.js */var G=$("./src/models/janus/processing_janus.js");/*! ./janus/processing_janus.js */var q=$("./src/models/jina_clip/processing_jina_clip.js");/*! ./jina_clip/processing_jina_clip.js */var E=$("./src/models/llava/processing_llava.js");/*! ./llava/processing_llava.js */var V=$("./src/models/mgp_str/processing_mgp_str.js");/*! ./mgp_str/processing_mgp_str.js */var N=$("./src/models/moonshine/processing_moonshine.js");/*! ./moonshine/processing_moonshine.js */var z=$("./src/models/owlvit/processing_owlvit.js");/*! ./owlvit/processing_owlvit.js */var w=$("./src/models/phi3_v/processing_phi3_v.js");/*! ./phi3_v/processing_phi3_v.js */var R=$("./src/models/paligemma/processing_paligemma.js");/*! ./paligemma/processing_paligemma.js */var y=$("./src/models/pyannote/processing_pyannote.js");/*! ./pyannote/processing_pyannote.js */var D=$("./src/models/qwen2_vl/processing_qwen2_vl.js");/*! ./qwen2_vl/processing_qwen2_vl.js */var j=$("./src/models/sam/processing_sam.js");/*! ./sam/processing_sam.js */var v=$("./src/models/smolvlm/processing_smolvlm.js");/*! ./smolvlm/processing_smolvlm.js */var g=$("./src/models/speecht5/processing_speecht5.js");/*! ./speecht5/processing_speecht5.js */var A=$("./src/models/ultravox/processing_ultravox.js");/*! ./ultravox/processing_ultravox.js */var T=$("./src/models/voxtral/processing_voxtral.js");/*! ./voxtral/processing_voxtral.js */var B=$("./src/models/wav2vec2/processing_wav2vec2.js");/*! ./wav2vec2/processing_wav2vec2.js */var F=$("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js");/*! ./wav2vec2_with_lm/processing_wav2vec2_with_lm.js */var P=$("./src/models/whisper/processing_whisper.js");/*! ./whisper/processing_whisper.js */},"./src/models/pvt/image_processing_pvt.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/pvt/image_processing_pvt.js ***!
  \************************************************/$.r(Z),$.d(Z,{PvtImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/pyannote/feature_extraction_pyannote.js ***!
  \************************************************************/$.r(Z),$.d(Z,{PyAnnoteFeatureExtractor:()=>H});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../../utils/maths.js */class H extends W.FeatureExtractor{async _call(G){if((0,W.validate_audio_inputs)(G,"PyAnnoteFeatureExtractor"),G instanceof Float64Array)G=new Float32Array(G);let q=[1,1,G.length];return{input_values:new Q.Tensor("float32",G,q)}}samples_to_frames(G){return(G-this.config.offset)/this.config.step}post_process_speaker_diarization(G,q){let E=q/this.samples_to_frames(q)/this.config.sampling_rate,V=[];for(let N of G.tolist()){let z=[],w=-1;for(let R=0;R<N.length;++R){let y=(0,Y.softmax)(N[R]),[D,j]=(0,Y.max)(y),[v,g]=[R,R+1];if(j!==w)w=j,z.push({id:j,start:v,end:g,score:D});else z.at(-1).end=g,z.at(-1).score+=D}V.push(z.map(({id:R,start:y,end:D,score:j})=>({id:R,start:y*E,end:D*E,confidence:j/(D-y)})))}return V}}},"./src/models/pyannote/processing_pyannote.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/pyannote/processing_pyannote.js ***!
  \****************************************************/$.r(Z),$.d(Z,{PyAnnoteProcessor:()=>Y});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/pyannote/feature_extraction_pyannote.js");/*! ./feature_extraction_pyannote.js */class Y extends W.Processor{static feature_extractor_class=Q.PyAnnoteFeatureExtractor;async _call(H){return await this.feature_extractor(H)}post_process_speaker_diarization(...H){return this.feature_extractor.post_process_speaker_diarization(...H)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/qwen2_vl/image_processing_qwen2_vl.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{Qwen2VLImageProcessor:()=>Y});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.ImageProcessor{async _call(H,...G){let{pixel_values:q,original_sizes:E,reshaped_input_sizes:V}=await super._call(H,...G),N=q,{temporal_patch_size:z,merge_size:w,patch_size:R}=this.config;if(N.dims[0]===1)N=(0,Q.cat)(Array.from({length:z},()=>N),0);let y=N.dims[0]/z,D=N.dims[1],j=Math.floor(N.dims[2]/R),v=Math.floor(N.dims[3]/R),g=N.view(y,z,D,Math.floor(j/w),w,R,Math.floor(v/w),w,R).permute(0,3,6,4,7,2,1,5,8).view(y*j*v,D*z*R*R),A=new Q.Tensor("int64",[y,j,v],[1,3]);return{pixel_values:g,image_grid_thw:A,original_sizes:E,reshaped_input_sizes:V}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/qwen2_vl/processing_qwen2_vl.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Qwen2VLProcessor:()=>G});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/image.js");/*! ../../utils/image.js */class G extends W.Processor{static image_processor_class=Q.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;async _call(q,E=null,...V){if(!Array.isArray(q))q=[q];let N,z;if(E)N=await this.image_processor(E),z=N.image_grid_thw;if(z){let R=this.image_processor.config.merge_size**2,y=0,D=z.tolist();q=q.map((j)=>{while(j.includes("<|image_pad|>")){let v=Number(D[y++].reduce((g,A)=>g*A,1n));j=j.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(v/R)))}return j.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(q),...N}}}},"./src/models/rt_detr/image_processing_rt_detr.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/rt_detr/image_processing_rt_detr.js ***!
  \********************************************************/$.r(Z),$.d(Z,{RTDetrImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{post_process_object_detection(...Y){return(0,W.post_process_object_detection)(...Y)}}},"./src/models/sam/image_processing_sam.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/sam/image_processing_sam.js ***!
  \************************************************/$.r(Z),$.d(Z,{SamImageProcessor:()=>H});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/core.js");/*! ../../utils/core.js */var Y=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class H extends W.ImageProcessor{reshape_input_points(G,q,E,V=!1){G=structuredClone(G);let N=(0,Q.calculateDimensions)(G);if(N.length===3){if(!V)N=[1,...N];G=[G]}else if(N.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let z=0;z<G.length;++z){let w=q[z],R=E[z],y=[R[0]/w[0],R[1]/w[1]];for(let D=0;D<G[z].length;++D)for(let j=0;j<G[z][D].length;++j)for(let v=0;v<G[z][D][j].length;++v)G[z][D][j][v]*=y[v%2]}return new Y.Tensor("float32",Float32Array.from(G.flat(1/0)),N)}add_input_labels(G,q){let E=(0,Q.calculateDimensions)(G);if(E.length===2)E=[1,...E],G=[G];else if(E.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(E.some((V,N)=>V!==q.dims[N]))throw Error(`The first ${E.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new Y.Tensor("int64",G.flat(1/0).map(BigInt),E)}async _call(G,{input_points:q=null,input_labels:E=null,input_boxes:V=null}={}){let N=await super._call(G);if(q)N.input_points=this.reshape_input_points(q,N.original_sizes,N.reshaped_input_sizes);if(E){if(!N.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");N.input_labels=this.add_input_labels(E,N.input_points)}if(V)N.input_boxes=this.reshape_input_points(V,N.original_sizes,N.reshaped_input_sizes,!0);return N}async post_process_masks(G,q,E,{mask_threshold:V=0,binarize:N=!0,pad_size:z=null}={}){let w=[];z=z??this.pad_size;let R=[z.height,z.width];for(let y=0;y<q.length;++y){let D=q[y],j=E[y],v=await(0,Y.interpolate_4d)(G[y],{mode:"bilinear",size:R});if(v=v.slice(null,null,[0,j[0]],[0,j[1]]),v=await(0,Y.interpolate_4d)(v,{mode:"bilinear",size:D}),N){let g=v.data,A=new Uint8Array(g.length);for(let T=0;T<g.length;++T)if(g[T]>V)A[T]=1;v=new Y.Tensor("bool",A,v.dims)}w.push(v)}return w}generate_crop_boxes(G,q,{crop_n_layers:E=0,overlap_ratio:V=0.3413333333333333,points_per_crop:N=32,crop_n_points_downscale_factor:z=1}={}){}}},"./src/models/sam/processing_sam.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/models/sam/processing_sam.js ***!
  \******************************************/$.r(Z),$.d(Z,{SamProcessor:()=>Y});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */class Y extends W.Processor{static image_processor_class=Q.AutoImageProcessor;async _call(...H){return await this.image_processor(...H)}post_process_masks(...H){return this.image_processor.post_process_masks(...H)}reshape_input_points(...H){return this.image_processor.reshape_input_points(...H)}}},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(J,Z,$)=>{/*!********************************************************************!*\
  !*** ./src/models/seamless_m4t/feature_extraction_seamless_m4t.js ***!
  \********************************************************************/$.r(Z),$.d(Z,{SeamlessM4TFeatureExtractor:()=>H});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends W.FeatureExtractor{constructor(G){super(G);let q=this.config.sampling_rate,E=(0,Y.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(q/2),q,null,"kaldi",!0);this.mel_filters=E,this.window=(0,Y.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(G,q){return G=G.map((E)=>E*32768),(0,Y.spectrogram)(G,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:0.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:0.0000001192092955078125,remove_dc_offset:!0,max_num_frames:q,transpose:!0})}async _call(G,{padding:q=!0,pad_to_multiple_of:E=2,do_normalize_per_mel_bins:V=!0,return_attention_mask:N=!0}={}){(0,W.validate_audio_inputs)(G,"SeamlessM4TFeatureExtractor");let z=await this._extract_fbank_features(G,this.config.max_length);if(V){let[A,T]=z.dims,B=z.data;for(let F=0;F<T;++F){let P=0;for(let m=0;m<A;++m)P+=B[m*T+F];let _=P/A,h=0;for(let m=0;m<A;++m)h+=(B[m*T+F]-_)**2;h/=A-1;let c=Math.sqrt(h+0.0000001);for(let m=0;m<A;++m){let d=m*T+F;B[d]=(B[d]-_)/c}}}let w;if(q){let[A,T]=z.dims,B=z.data,F=A%E;if(F>0){let P=new Float32Array(T*(A+F));P.set(B),P.fill(this.config.padding_value,B.length);let _=A+F;if(z=new Q.Tensor(z.type,P,[_,T]),N)w=new Q.Tensor("int64",new BigInt64Array(_),[1,_]),w.data.fill(1n,0,A)}}let[R,y]=z.dims,D=this.config.stride;if(R%D!==0)throw Error(`The number of frames (${R}) must be a multiple of the stride (${D}).`);let v=z.view(1,Math.floor(R/D),y*D),g={input_features:v};if(N){let A=v.dims[1],T=new BigInt64Array(A);if(w){let B=w.data;for(let F=1,P=0;F<R;F+=D,++P)T[P]=B[F]}else T.fill(1n);g.attention_mask=new Q.Tensor("int64",T,[1,A])}return g}}},"./src/models/segformer/image_processing_segformer.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/segformer/image_processing_segformer.js ***!
  \************************************************************/$.r(Z),$.d(Z,{SegformerFeatureExtractor:()=>Y,SegformerImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{post_process_semantic_segmentation(...H){return(0,W.post_process_semantic_segmentation)(...H)}}class Y extends Q{}},"./src/models/siglip/image_processing_siglip.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/siglip/image_processing_siglip.js ***!
  \******************************************************/$.r(Z),$.d(Z,{SiglipImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/smolvlm/image_processing_smolvlm.js ***!
  \********************************************************/$.r(Z),$.d(Z,{SmolVLMImageProcessor:()=>W.Idefics3ImageProcessor});var W=$("./src/models/idefics3/image_processing_idefics3.js");/*! ../idefics3/image_processing_idefics3.js */},"./src/models/smolvlm/processing_smolvlm.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/smolvlm/processing_smolvlm.js ***!
  \**************************************************/$.r(Z),$.d(Z,{SmolVLMProcessor:()=>W.Idefics3Processor});var W=$("./src/models/idefics3/processing_idefics3.js");/*! ../idefics3/processing_idefics3.js */},"./src/models/snac/feature_extraction_snac.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/snac/feature_extraction_snac.js ***!
  \****************************************************/$.r(Z),$.d(Z,{SnacFeatureExtractor:()=>Q});var W=$("./src/models/dac/feature_extraction_dac.js");/*! ../dac/feature_extraction_dac.js */class Q extends W.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/speecht5/feature_extraction_speecht5.js ***!
  \************************************************************/$.r(Z),$.d(Z,{SpeechT5FeatureExtractor:()=>Q});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */class Q extends W.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/speecht5/processing_speecht5.js ***!
  \****************************************************/$.r(Z),$.d(Z,{SpeechT5Processor:()=>H});var W=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */class H extends W.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=Y.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/swin2sr/image_processing_swin2sr.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/swin2sr/image_processing_swin2sr.js ***!
  \********************************************************/$.r(Z),$.d(Z,{Swin2SRImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{pad_image(Y,H,G,q={}){let[E,V,N]=H;return super.pad_image(Y,H,{width:V+(G-V%G)%G,height:E+(G-E%G)%G},{mode:"symmetric",center:!1,constant_values:-1,...q})}}},"./src/models/ultravox/processing_ultravox.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/ultravox/processing_ultravox.js ***!
  \****************************************************/$.r(Z),$.d(Z,{UltravoxProcessor:()=>H});var W=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=W.AutoFeatureExtractor;static uses_processor_config=!0;async _call(G,q=null,E={}){if(Array.isArray(G))throw Error("Batched inputs are not supported yet.");let V={};if(q){let z=q.length,{input_features:w}=await this.feature_extractor(q,{...E,max_length:z}),R=Math.round(z/this.config.encoder_ds_factor+0.0001),y=1+Math.ceil(R/this.config.stack_factor);V.audio_token_len=[y],V.audio_values=w;let D=this.config.audio_placeholder;if(!G.includes(D))throw Error(`The input text does not contain the image token ${D}.`);G=G.replaceAll(D,D.repeat(y))}return{...this.tokenizer(G,{add_special_tokens:!1,...E}),...V}}}},"./src/models/vit/image_processing_vit.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/vit/image_processing_vit.js ***!
  \************************************************/$.r(Z),$.d(Z,{ViTFeatureExtractor:()=>Y,ViTImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{}class Y extends Q{}},"./src/models/vitmatte/image_processing_vitmatte.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/vitmatte/image_processing_vitmatte.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{VitMatteImageProcessor:()=>Y});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.ImageProcessor{async _call(H,G){if(!Array.isArray(H))H=[H];if(!Array.isArray(G))G=[G];let q=await Promise.all(H.map((N)=>this.preprocess(N))),E=await Promise.all(G.map((N)=>this.preprocess(N,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,Q.stack)(q.map((N,z)=>(0,Q.cat)([N.pixel_values,E[z].pixel_values],0)),0),original_sizes:q.map((N)=>N.original_size),reshaped_input_sizes:q.map((N)=>N.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/vitpose/image_processing_vitpose.js ***!
  \********************************************************/$.r(Z),$.d(Z,{VitPoseImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{post_process_pose_estimation(Y,H,{threshold:G=null}={}){let q=Y.tolist(),[E,V,N,z]=Y.dims,w=[];for(let R=0;R<E;++R){let y=q[R],D=H[R],j=[];for(let v=0;v<D.length;++v){let g=D[v],A=[],T=[],B=[],F=g.at(-2)/z,P=g.at(-1)/N;for(let _=0;_<y.length;++_){let[h,c]=[0,0],m=0,d=-1/0,a=y[_];for(let t=0;t<a.length;++t){let W0=a[t];for(let o=0;o<W0.length;++o){let N0=W0[o];m+=N0,d=Math.max(d,N0),h+=(o+0.5)*N0,c+=t*N0}}if(G!=null&&d<G)continue;let n=[F*h/m,P*c/m];A.push(n),B.push(_),T.push(d)}j.push({bbox:g,scores:T,labels:B,keypoints:A})}w.push(j)}return w}}},"./src/models/voxtral/processing_voxtral.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/voxtral/processing_voxtral.js ***!
  \**************************************************/$.r(Z),$.d(Z,{VoxtralProcessor:()=>N});var W=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var H=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */let G="[AUDIO]",q="[BEGIN_AUDIO]",E=375;function V(z,w){let R=[];for(let y=0;y<z.length;y+=w)R.push(z.subarray(y,Math.min(y+w,z.length)));return R}class N extends Y.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=W.AutoFeatureExtractor;static uses_processor_config=!1;async _call(z,w=null,R={}){if(Array.isArray(z))throw Error("Batched inputs are not supported yet.");let y={};if(w){if(!z.includes(G))throw Error(`The input text does not contain the audio token ${G}.`);if(!Array.isArray(w))w=[w];let j=z.split(G),v=j.length-1;if(v!==w.length)throw Error(`The number of audio inputs (${w.length}) does not match the number of audio tokens in the text (${v}).`);let g=this.feature_extractor.config.n_samples,A=w.map((_)=>V(_,g)),T=A.map((_)=>_.length),B=A.flat(),F=(await Promise.all(B.map((_)=>this.feature_extractor(_,R)))).map((_)=>_.input_features);y.audio_values=F.length>1?(0,H.cat)(F,0):F[0];let P=j[0];for(let _=0;_<T.length;++_){P+=q;for(let h=0;h<T[_];++h)P+=G.repeat(E);P+=j[_+1]}z=P}return{...this.tokenizer(z,{add_special_tokens:!1,...R}),...y}}}},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/wav2vec2/feature_extraction_wav2vec2.js ***!
  \************************************************************/$.r(Z),$.d(Z,{Wav2Vec2FeatureExtractor:()=>Y});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends W.FeatureExtractor{_zero_mean_unit_var_norm(H){let q=H.reduce((V,N)=>V+N,0)/H.length,E=H.reduce((V,N)=>V+(N-q)**2,0)/H.length;return H.map((V)=>(V-q)/Math.sqrt(E+0.0000001))}async _call(H){if((0,W.validate_audio_inputs)(H,"Wav2Vec2FeatureExtractor"),H instanceof Float64Array)H=new Float32Array(H);let G=H;if(this.config.do_normalize)G=this._zero_mean_unit_var_norm(G);let q=[1,G.length];return{input_values:new Q.Tensor("float32",G,q),attention_mask:new Q.Tensor("int64",new BigInt64Array(G.length).fill(1n),q)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/wav2vec2/processing_wav2vec2.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Wav2Vec2Processor:()=>H});var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Q=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Q.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(J,Z,$)=>{/*!********************************************************************!*\
  !*** ./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js ***!
  \********************************************************************/$.r(Z),$.d(Z,{Wav2Vec2ProcessorWithLM:()=>H});var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Q=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Q.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/wespeaker/feature_extraction_wespeaker.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/wespeaker/feature_extraction_wespeaker.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{WeSpeakerFeatureExtractor:()=>H});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends W.FeatureExtractor{constructor(G){super(G);let q=this.config.sampling_rate,E=(0,Y.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(q/2),q,null,"kaldi",!0);this.mel_filters=E,this.window=(0,Y.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(G){return G=G.map((q)=>q*32768),(0,Y.spectrogram)(G,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:0.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:0.0000001192092955078125,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(G){(0,W.validate_audio_inputs)(G,"WeSpeakerFeatureExtractor");let q=(await this._extract_fbank_features(G)).unsqueeze_(0);if(this.config.fbank_centering_span===null){let E=q.mean(1).data,V=q.data,[N,z,w]=q.dims;for(let R=0;R<N;++R){let y=R*z*w,D=R*w;for(let j=0;j<z;++j){let v=y+j*w;for(let g=0;g<w;++g)V[v+g]-=E[D+g]}}}return{input_features:q}}}},"./src/models/whisper/common_whisper.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/models/whisper/common_whisper.js ***!
  \**********************************************/$.r(Z),$.d(Z,{WHISPER_LANGUAGE_MAPPING:()=>Q,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>Y,whisper_language_to_code:()=>H});let W=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],Q=new Map(W),Y=new Map([...W.map(([G,q])=>[q,G]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function H(G){G=G.toLowerCase();let q=Y.get(G);if(q===void 0){let E=G.match(/^<\|([a-z]{2})\|>$/);if(E)G=E[1];if(Q.has(G))q=G;else{let N=G.length===2?Q.keys():Q.values();throw Error(`Language "${G}" is not supported. Must be one of: ${JSON.stringify(Array.from(N))}`)}}return q}},"./src/models/whisper/feature_extraction_whisper.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/whisper/feature_extraction_whisper.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{WhisperFeatureExtractor:()=>G});var W=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var Q=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */var H=$("./src/utils/maths.js");/*! ../../utils/maths.js */class G extends W.FeatureExtractor{constructor(q){super(q);this.config.mel_filters??=(0,Y.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8000,this.config.sampling_rate,"slaney","slaney"),this.window=(0,Y.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(q){let E=await(0,Y.spectrogram)(q,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(q.length/this.config.hop_length),this.config.nb_max_frames)}),V=E.data,N=(0,H.max)(V)[0];for(let z=0;z<V.length;++z)V[z]=(Math.max(V[z],N-8)+4)/4;return E}async _call(q,{max_length:E=null}={}){(0,W.validate_audio_inputs)(q,"WhisperFeatureExtractor");let V,N=E??this.config.n_samples;if(q.length>N){if(q.length>this.config.n_samples)console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`.");V=q.slice(0,N)}else V=new Float32Array(N),V.set(q);return{input_features:(await this._extract_fbank_features(V)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/whisper/generation_whisper.js ***!
  \**************************************************/$.r(Z),$.d(Z,{WhisperGenerationConfig:()=>Q});var W=$("./src/generation/configuration_utils.js");/*! ../../generation/configuration_utils.js */class Q extends W.GenerationConfig{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}},"./src/models/whisper/processing_whisper.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/whisper/processing_whisper.js ***!
  \**************************************************/$.r(Z),$.d(Z,{WhisperProcessor:()=>H});var W=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=W.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/yolos/image_processing_yolos.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/yolos/image_processing_yolos.js ***!
  \****************************************************/$.r(Z),$.d(Z,{YolosFeatureExtractor:()=>Y,YolosImageProcessor:()=>Q});var W=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class Q extends W.ImageProcessor{post_process_object_detection(...H){return(0,W.post_process_object_detection)(...H)}}class Y extends Q{}},"./src/ops/registry.js":(J,Z,$)=>{/*!*****************************!*\
  !*** ./src/ops/registry.js ***!
  \*****************************/$.r(Z),$.d(Z,{TensorOpRegistry:()=>H});var W=$("./src/backends/onnx.js");/*! ../backends/onnx.js */var Q=$("./src/utils/tensor.js");/*! ../utils/tensor.js */let Y=async(G,q,E)=>{let V=await(0,W.createInferenceSession)(new Uint8Array(G),q);return async(N)=>{let z=(0,W.isONNXProxy)(),w=Object.fromEntries(Object.entries(N).map(([y,D])=>[y,(z?D.clone():D).ort_tensor])),R=await(0,W.runInferenceSession)(V,w);if(Array.isArray(E))return E.map((y)=>new Q.Tensor(R[y]));else return new Q.Tensor(R[E])}};class H{static session_options={};static get nearest_interpolate_4d(){if(!this._nearest_interpolate_4d)this._nearest_interpolate_4d=Y([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y");return this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){if(!this._bilinear_interpolate_4d)this._bilinear_interpolate_4d=Y([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y");return this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){if(!this._bicubic_interpolate_4d)this._bicubic_interpolate_4d=Y([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y");return this._bicubic_interpolate_4d}static get matmul(){if(!this._matmul)this._matmul=Y([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c");return this._matmul}static get stft(){if(!this._stft)this._stft=Y([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o");return this._stft}static get rfft(){if(!this._rfft)this._rfft=Y([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y");return this._rfft}static get top_k(){if(!this._top_k)this._top_k=Y([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"]);return this._top_k}static get slice(){if(!this._slice)this._slice=Y([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y");return this._slice}}},"./src/pipelines.js":(J,Z,$)=>{/*!**************************!*\
  !*** ./src/pipelines.js ***!
  \**************************/$.r(Z),$.d(Z,{AudioClassificationPipeline:()=>d,AutomaticSpeechRecognitionPipeline:()=>n,BackgroundRemovalPipeline:()=>N0,DepthEstimationPipeline:()=>A0,DocumentQuestionAnsweringPipeline:()=>p,FeatureExtractionPipeline:()=>c,FillMaskPipeline:()=>A,ImageClassificationPipeline:()=>W0,ImageFeatureExtractionPipeline:()=>m,ImageSegmentationPipeline:()=>o,ImageToImagePipeline:()=>z0,ImageToTextPipeline:()=>t,ObjectDetectionPipeline:()=>I,Pipeline:()=>D,QuestionAnsweringPipeline:()=>g,SummarizationPipeline:()=>B,Text2TextGenerationPipeline:()=>T,TextClassificationPipeline:()=>j,TextGenerationPipeline:()=>_,TextToAudioPipeline:()=>Z0,TokenClassificationPipeline:()=>v,TranslationPipeline:()=>F,ZeroShotAudioClassificationPipeline:()=>a,ZeroShotClassificationPipeline:()=>h,ZeroShotImageClassificationPipeline:()=>w0,ZeroShotObjectDetectionPipeline:()=>O,pipeline:()=>d0});var W=$("./src/tokenizers.js");/*! ./tokenizers.js */var Q=$("./src/models.js");/*! ./models.js */var Y=$("./src/models/auto/processing_auto.js");/*! ./models/auto/processing_auto.js */var H=$("./src/base/processing_utils.js");/*! ./base/processing_utils.js */var G=$("./src/utils/generic.js");/*! ./utils/generic.js */var q=$("./src/utils/core.js");/*! ./utils/core.js */var E=$("./src/utils/maths.js");/*! ./utils/maths.js */var V=$("./src/utils/audio.js");/*! ./utils/audio.js */var N=$("./src/utils/tensor.js");/*! ./utils/tensor.js */var z=$("./src/utils/image.js");/*! ./utils/image.js */async function w(b){if(!Array.isArray(b))b=[b];return await Promise.all(b.map((S)=>z.RawImage.read(S)))}async function R(b,S){if(!Array.isArray(b))b=[b];return await Promise.all(b.map((Q0)=>{if(typeof Q0==="string"||Q0 instanceof URL)return(0,V.read_audio)(Q0,S);else if(Q0 instanceof Float64Array)return new Float32Array(Q0);return Q0}))}function y(b,S){if(S)b=b.map((Y0)=>Y0|0);let[Q0,B0,I0,F0]=b;return{xmin:Q0,ymin:B0,xmax:I0,ymax:F0}}class D extends G.Callable{constructor({task:b,model:S,tokenizer:Q0=null,processor:B0=null}){super();this.task=b,this.model=S,this.tokenizer=Q0,this.processor=B0}async dispose(){await this.model.dispose()}}class j extends D{constructor(b){super(b)}async _call(b,{top_k:S=1}={}){let Q0=this.tokenizer(b,{padding:!0,truncation:!0}),B0=await this.model(Q0),I0=this.model.config.problem_type==="multi_label_classification"?(E0)=>E0.sigmoid():(E0)=>new N.Tensor("float32",(0,E.softmax)(E0.data),E0.dims),F0=this.model.config.id2label,Y0=[];for(let E0 of B0.logits){let X0=I0(E0),R0=await(0,N.topk)(X0,S),C0=R0[0].tolist(),U0=R0[1].tolist().map((u0,b0)=>({label:F0?F0[u0]:`LABEL_${u0}`,score:C0[b0]}));if(S===1)Y0.push(...U0);else Y0.push(U0)}return Array.isArray(b)||S===1?Y0:Y0[0]}}class v extends D{constructor(b){super(b)}async _call(b,{ignore_labels:S=["O"]}={}){let Q0=Array.isArray(b),B0=this.tokenizer(Q0?b:[b],{padding:!0,truncation:!0}),F0=(await this.model(B0)).logits,Y0=this.model.config.id2label,E0=[];for(let X0=0;X0<F0.dims[0];++X0){let R0=B0.input_ids[X0],C0=F0[X0],x0=[];for(let U0=0;U0<C0.dims[0];++U0){let u0=C0[U0],b0=(0,E.max)(u0.data)[1],s0=Y0?Y0[b0]:`LABEL_${b0}`;if(S.includes(s0))continue;let l0=this.tokenizer.decode([R0[U0].item()],{skip_special_tokens:!0});if(l0==="")continue;let y0=(0,E.softmax)(u0.data);x0.push({entity:s0,score:y0[b0],index:U0,word:l0})}E0.push(x0)}return Q0?E0:E0[0]}}class g extends D{constructor(b){super(b)}async _call(b,S,{top_k:Q0=1}={}){let B0=this.tokenizer(b,{text_pair:S,padding:!0,truncation:!0}),{start_logits:I0,end_logits:F0}=await this.model(B0),Y0=B0.input_ids.tolist(),E0=B0.attention_mask.tolist(),X0=this.tokenizer.all_special_ids,R0=[];for(let C0=0;C0<I0.dims[0];++C0){let x0=Y0[C0],U0=x0.findIndex((a0)=>a0==this.tokenizer.sep_token_id),u0=E0[C0].map((a0,n0)=>a0==1&&(n0===0||n0>U0&&X0.findIndex((B6)=>B6==x0[n0])===-1)),b0=I0[C0].tolist(),s0=F0[C0].tolist();for(let a0=1;a0<b0.length;++a0)if(E0[C0]==0||a0<=U0||X0.findIndex((n0)=>n0==x0[a0])!==-1)b0[a0]=-1/0,s0[a0]=-1/0;let l0=(0,E.softmax)(b0).map((a0,n0)=>[a0,n0]),y0=(0,E.softmax)(s0).map((a0,n0)=>[a0,n0]);l0[0][0]=0,y0[0][0]=0;let i0=(0,q.product)(l0,y0).filter((a0)=>a0[0][1]<=a0[1][1]).map((a0)=>[a0[0][1],a0[1][1],a0[0][0]*a0[1][0]]).sort((a0,n0)=>n0[2]-a0[2]);for(let a0=0;a0<Math.min(i0.length,Q0);++a0){let[n0,B6,Q6]=i0[a0],a6=x0.slice(n0,B6+1),H4=this.tokenizer.decode(a6,{skip_special_tokens:!0});R0.push({answer:H4,score:Q6})}}return Q0===1?R0[0]:R0}}class A extends D{constructor(b){super(b)}async _call(b,{top_k:S=5}={}){let Q0=this.tokenizer(b,{padding:!0,truncation:!0}),{logits:B0}=await this.model(Q0),I0=[],F0=Q0.input_ids.tolist();for(let Y0=0;Y0<F0.length;++Y0){let E0=F0[Y0],X0=E0.findIndex((u0)=>u0==this.tokenizer.mask_token_id);if(X0===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let R0=B0[Y0][X0],C0=await(0,N.topk)(new N.Tensor("float32",(0,E.softmax)(R0.data),R0.dims),S),x0=C0[0].tolist(),U0=C0[1].tolist();I0.push(U0.map((u0,b0)=>{let s0=E0.slice();return s0[X0]=u0,{score:x0[b0],token:Number(u0),token_str:this.tokenizer.decode([u0]),sequence:this.tokenizer.decode(s0,{skip_special_tokens:!0})}}))}return Array.isArray(b)?I0:I0[0]}}class T extends D{_key="generated_text";constructor(b){super(b)}async _call(b,S={}){if(!Array.isArray(b))b=[b];if(this.model.config.prefix)b=b.map((E0)=>this.model.config.prefix+E0);let Q0=this.model.config.task_specific_params;if(Q0&&Q0[this.task]){if(Q0[this.task].prefix)b=b.map((E0)=>Q0[this.task].prefix+E0)}let B0=this.tokenizer,I0={padding:!0,truncation:!0},F0;if(this instanceof F&&"_build_translation_inputs"in B0)F0=B0._build_translation_inputs(b,I0,S);else F0=B0(b,I0);let Y0=await this.model.generate({...F0,...S});return B0.batch_decode(Y0,{skip_special_tokens:!0}).map((E0)=>({[this._key]:E0}))}}class B extends T{_key="summary_text";constructor(b){super(b)}}class F extends T{_key="translation_text";constructor(b){super(b)}}function P(b){return Array.isArray(b)&&b.every((S)=>("role"in S)&&("content"in S))}class _ extends D{constructor(b){super(b)}async _call(b,S={}){let Q0=!1,B0=!1,I0=S.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,F0;if(typeof b==="string")F0=b=[b];else if(Array.isArray(b)&&b.every((U0)=>typeof U0==="string"))Q0=!0,F0=b;else{if(P(b))b=[b];else if(Array.isArray(b)&&b.every(P))Q0=!0;else throw Error("Input must be a string, an array of strings, a Chat, or an array of Chats");B0=!0,F0=b.map((U0)=>this.tokenizer.apply_chat_template(U0,{tokenize:!1,add_generation_prompt:!0})),I0=!1}let Y0=B0?!1:S.return_full_text??!0;this.tokenizer.padding_side="left";let E0=this.tokenizer(F0,{add_special_tokens:I0,padding:!0,truncation:!0}),X0=await this.model.generate({...E0,...S}),R0=this.tokenizer.batch_decode(X0,{skip_special_tokens:!0}),C0;if(!Y0&&E0.input_ids.dims.at(-1)>0)C0=this.tokenizer.batch_decode(E0.input_ids,{skip_special_tokens:!0}).map((U0)=>U0.length);let x0=Array.from({length:b.length},(U0)=>[]);for(let U0=0;U0<R0.length;++U0){let u0=Math.floor(U0/X0.dims[0]*b.length);if(C0)R0[U0]=R0[U0].slice(C0[u0]);x0[u0].push({generated_text:B0?[...b[u0],{role:"assistant",content:R0[U0]}]:R0[U0]})}return!Q0&&x0.length===1?x0[0]:x0}}class h extends D{constructor(b){super(b);if(this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([S,Q0])=>[S.toLowerCase(),Q0])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0)console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2;if(this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0)console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0}async _call(b,S,{hypothesis_template:Q0="This example is {}.",multi_label:B0=!1}={}){let I0=Array.isArray(b);if(!I0)b=[b];if(!Array.isArray(S))S=[S];let F0=S.map((X0)=>Q0.replace("{}",X0)),Y0=B0||S.length===1,E0=[];for(let X0 of b){let R0=[];for(let U0 of F0){let u0=this.tokenizer(X0,{text_pair:U0,padding:!0,truncation:!0}),b0=await this.model(u0);if(Y0)R0.push([b0.logits.data[this.contradiction_id],b0.logits.data[this.entailment_id]]);else R0.push(b0.logits.data[this.entailment_id])}let x0=(Y0?R0.map((U0)=>(0,E.softmax)(U0)[1]):(0,E.softmax)(R0)).map((U0,u0)=>[U0,u0]).sort((U0,u0)=>u0[0]-U0[0]);E0.push({sequence:X0,labels:x0.map((U0)=>S[U0[1]]),scores:x0.map((U0)=>U0[0])})}return I0?E0:E0[0]}}class c extends D{constructor(b){super(b)}async _call(b,{pooling:S="none",normalize:Q0=!1,quantize:B0=!1,precision:I0="binary"}={}){let F0=this.tokenizer(b,{padding:!0,truncation:!0}),Y0=await this.model(F0),E0=Y0.last_hidden_state??Y0.logits??Y0.token_embeddings;switch(S){case"none":break;case"mean":E0=(0,N.mean_pooling)(E0,F0.attention_mask);break;case"first_token":case"cls":E0=E0.slice(null,0);break;case"last_token":case"eos":E0=E0.slice(null,-1);break;default:throw Error(`Pooling method '${S}' not supported.`)}if(Q0)E0=E0.normalize(2,-1);if(B0)E0=(0,N.quantize_embeddings)(E0,I0);return E0}}class m extends D{constructor(b){super(b)}async _call(b,{pool:S=null}={}){let Q0=await w(b),{pixel_values:B0}=await this.processor(Q0),I0=await this.model({pixel_values:B0}),F0;if(S){if(!("pooler_output"in I0))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");F0=I0.pooler_output}else F0=I0.last_hidden_state??I0.logits??I0.image_embeds;return F0}}class d extends D{constructor(b){super(b)}async _call(b,{top_k:S=5}={}){let Q0=this.processor.feature_extractor.config.sampling_rate,B0=await R(b,Q0),I0=this.model.config.id2label,F0=[];for(let Y0 of B0){let E0=await this.processor(Y0),R0=(await this.model(E0)).logits[0],C0=await(0,N.topk)(new N.Tensor("float32",(0,E.softmax)(R0.data),R0.dims),S),x0=C0[0].tolist(),u0=C0[1].tolist().map((b0,s0)=>({label:I0?I0[b0]:`LABEL_${b0}`,score:x0[s0]}));F0.push(u0)}return Array.isArray(b)?F0:F0[0]}}class a extends D{constructor(b){super(b)}async _call(b,S,{hypothesis_template:Q0="This is a sound of {}."}={}){let B0=!Array.isArray(b);if(B0)b=[b];let I0=S.map((R0)=>Q0.replace("{}",R0)),F0=this.tokenizer(I0,{padding:!0,truncation:!0}),Y0=this.processor.feature_extractor.config.sampling_rate,E0=await R(b,Y0),X0=[];for(let R0 of E0){let C0=await this.processor(R0),x0=await this.model({...F0,...C0}),U0=(0,E.softmax)(x0.logits_per_audio.data);X0.push([...U0].map((u0,b0)=>({score:u0,label:S[b0]})))}return B0?X0[0]:X0}}class n extends D{constructor(b){super(b)}async _call(b,S={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(b,S);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":case"parakeet_ctc":return this._call_wav2vec2(b,S);case"moonshine":return this._call_moonshine(b,S);default:throw Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(b,S){if(S.language)console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".');if(S.task)console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let Q0=!Array.isArray(b);if(Q0)b=[b];let B0=this.processor.feature_extractor.config.sampling_rate,I0=await R(b,B0),F0=[];for(let Y0 of I0){let E0=await this.processor(Y0),R0=(await this.model(E0)).logits[0],C0=[];for(let U0 of R0)C0.push((0,E.max)(U0.data)[1]);let x0=this.tokenizer.decode(C0,{skip_special_tokens:!0}).trim();F0.push({text:x0})}return Q0?F0[0]:F0}async _call_whisper(b,S){let Q0=S.return_timestamps??!1,B0=S.chunk_length_s??0,I0=S.force_full_sequences??!1,F0=S.stride_length_s??null,Y0={...S};if(Q0==="word")Y0.return_token_timestamps=!0,Y0.return_timestamps=!1;let E0=!Array.isArray(b);if(E0)b=[b];let X0=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,R0=this.processor.feature_extractor.config.hop_length,C0=this.processor.feature_extractor.config.sampling_rate,x0=await R(b,C0),U0=[];for(let u0 of x0){let b0=[];if(B0>0){if(F0===null)F0=B0/6;else if(B0<=F0)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let y0=C0*B0,i0=C0*F0,a0=y0-2*i0,n0=0;while(!0){let B6=n0+y0,Q6=u0.subarray(n0,B6),a6=await this.processor(Q6),H4=n0===0,U4=B6>=u0.length;if(b0.push({stride:[Q6.length,H4?0:i0,U4?0:i0],input_features:a6.input_features,is_last:U4}),U4)break;n0+=a0}}else b0=[{stride:[u0.length,0,0],input_features:(await this.processor(u0)).input_features,is_last:!0}];for(let y0 of b0){Y0.num_frames=Math.floor(y0.stride[0]/R0);let i0=await this.model.generate({inputs:y0.input_features,...Y0});if(Q0==="word")y0.tokens=i0.sequences.tolist()[0],y0.token_timestamps=i0.token_timestamps.tolist()[0].map((a0)=>(0,E.round)(a0,2));else y0.tokens=i0[0].tolist();y0.stride=y0.stride.map((a0)=>a0/C0)}let[s0,l0]=this.tokenizer._decode_asr(b0,{time_precision:X0,return_timestamps:Q0,force_full_sequences:I0});U0.push({text:s0,...l0})}return E0?U0[0]:U0}async _call_moonshine(b,S){let Q0=!Array.isArray(b);if(Q0)b=[b];let B0=this.processor.feature_extractor.config.sampling_rate,I0=await R(b,B0),F0=[];for(let Y0 of I0){let E0=await this.processor(Y0),X0=Math.floor(Y0.length/B0)*6,R0=await this.model.generate({max_new_tokens:X0,...S,...E0}),C0=this.processor.batch_decode(R0,{skip_special_tokens:!0})[0];F0.push({text:C0})}return Q0?F0[0]:F0}}class t extends D{constructor(b){super(b)}async _call(b,S={}){let Q0=Array.isArray(b),B0=await w(b),{pixel_values:I0}=await this.processor(B0),F0=[];for(let Y0 of I0){Y0.dims=[1,...Y0.dims];let E0=await this.model.generate({inputs:Y0,...S}),X0=this.tokenizer.batch_decode(E0,{skip_special_tokens:!0}).map((R0)=>({generated_text:R0.trim()}));F0.push(X0)}return Q0?F0:F0[0]}}class W0 extends D{constructor(b){super(b)}async _call(b,{top_k:S=5}={}){let Q0=await w(b),{pixel_values:B0}=await this.processor(Q0),I0=await this.model({pixel_values:B0}),F0=this.model.config.id2label,Y0=[];for(let E0 of I0.logits){let X0=await(0,N.topk)(new N.Tensor("float32",(0,E.softmax)(E0.data),E0.dims),S),R0=X0[0].tolist(),x0=X0[1].tolist().map((U0,u0)=>({label:F0?F0[U0]:`LABEL_${U0}`,score:R0[u0]}));Y0.push(x0)}return Array.isArray(b)?Y0:Y0[0]}}class o extends D{constructor(b){super(b);this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(b,{threshold:S=0.5,mask_threshold:Q0=0.5,overlap_mask_area_threshold:B0=0.8,label_ids_to_fuse:I0=null,target_sizes:F0=null,subtask:Y0=null}={}){if(Array.isArray(b)&&b.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let X0=await w(b),R0=X0.map((y0)=>[y0.height,y0.width]),C0=await this.processor(X0),{inputNames:x0,outputNames:U0}=this.model.sessions.model;if(!x0.includes("pixel_values")){if(x0.length!==1)throw Error(`Expected a single input name, but got ${x0.length} inputs: ${x0}.`);let y0=x0[0];if(y0 in C0)throw Error(`Input name ${y0} already exists in the inputs.`);C0[y0]=C0.pixel_values}let u0=await this.model(C0),b0=null;if(Y0!==null)b0=this.subtasks_mapping[Y0];else if(this.processor.image_processor){for(let[y0,i0]of Object.entries(this.subtasks_mapping))if(i0 in this.processor.image_processor){b0=this.processor.image_processor[i0].bind(this.processor.image_processor),Y0=y0;break}}let s0=this.model.config.id2label,l0=[];if(!Y0){let i0=u0[U0[0]];for(let a0=0;a0<R0.length;++a0){let n0=R0[a0],B6=i0[a0];if(B6.data.some((a6)=>a6<-0.00001||a6>1.00001))B6.sigmoid_();let Q6=await z.RawImage.fromTensor(B6.mul_(255).to("uint8")).resize(n0[1],n0[0]);l0.push({label:null,score:null,mask:Q6})}}else if(Y0==="panoptic"||Y0==="instance"){let y0=b0(u0,S,Q0,B0,I0,F0??R0)[0],i0=y0.segmentation;for(let a0 of y0.segments_info){let n0=new Uint8ClampedArray(i0.data.length);for(let Q6=0;Q6<i0.data.length;++Q6)if(i0.data[Q6]===a0.id)n0[Q6]=255;let B6=new z.RawImage(n0,i0.dims[1],i0.dims[0],1);l0.push({score:a0.score,label:s0[a0.label_id],mask:B6})}}else if(Y0==="semantic"){let{segmentation:y0,labels:i0}=b0(u0,F0??R0)[0];for(let a0 of i0){let n0=new Uint8ClampedArray(y0.data.length);for(let Q6=0;Q6<y0.data.length;++Q6)if(y0.data[Q6]===a0)n0[Q6]=255;let B6=new z.RawImage(n0,y0.dims[1],y0.dims[0],1);l0.push({score:null,label:s0[a0],mask:B6})}}else throw Error(`Subtask ${Y0} not supported.`);return l0}}class N0 extends o{constructor(b){super(b)}async _call(b,S={}){if(Array.isArray(b)&&b.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");let B0=await w(b),I0=await super._call(b,S);return B0.map((Y0,E0)=>{let X0=Y0.clone();return X0.putAlpha(I0[E0].mask),X0})}}class w0 extends D{constructor(b){super(b)}async _call(b,S,{hypothesis_template:Q0="This is a photo of {}"}={}){let B0=Array.isArray(b),I0=await w(b),F0=S.map((x0)=>Q0.replace("{}",x0)),Y0=this.tokenizer(F0,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:E0}=await this.processor(I0),X0=await this.model({...Y0,pixel_values:E0}),R0=this.model.config.model_type==="siglip"?(x0)=>x0.sigmoid().data:(x0)=>(0,E.softmax)(x0.data),C0=[];for(let x0 of X0.logits_per_image){let u0=[...R0(x0)].map((b0,s0)=>({score:b0,label:S[s0]}));u0.sort((b0,s0)=>s0.score-b0.score),C0.push(u0)}return B0?C0:C0[0]}}class I extends D{constructor(b){super(b)}async _call(b,{threshold:S=0.9,percentage:Q0=!1}={}){let B0=Array.isArray(b);if(B0&&b.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");let I0=await w(b),F0=Q0?null:I0.map((U0)=>[U0.height,U0.width]),{pixel_values:Y0,pixel_mask:E0}=await this.processor(I0),X0=await this.model({pixel_values:Y0,pixel_mask:E0}),R0=this.processor.image_processor.post_process_object_detection(X0,S,F0),C0=this.model.config.id2label,x0=R0.map((U0)=>U0.boxes.map((u0,b0)=>({score:U0.scores[b0],label:C0[U0.classes[b0]],box:y(u0,!Q0)})));return B0?x0:x0[0]}}class O extends D{constructor(b){super(b)}async _call(b,S,{threshold:Q0=0.1,top_k:B0=null,percentage:I0=!1}={}){let F0=Array.isArray(b),Y0=await w(b),E0=this.tokenizer(S,{padding:!0,truncation:!0}),X0=await this.processor(Y0),R0=[];for(let C0=0;C0<Y0.length;++C0){let x0=Y0[C0],U0=I0?null:[[x0.height,x0.width]],u0=X0.pixel_values[C0].unsqueeze_(0),b0=await this.model({...E0,pixel_values:u0}),s0;if("post_process_grounded_object_detection"in this.processor){let l0=this.processor.post_process_grounded_object_detection(b0,E0.input_ids,{box_threshold:Q0,text_threshold:Q0,target_sizes:U0})[0];s0=l0.boxes.map((y0,i0)=>({score:l0.scores[i0],label:l0.labels[i0],box:y(y0,!I0)}))}else{let l0=this.processor.image_processor.post_process_object_detection(b0,Q0,U0,!0)[0];s0=l0.boxes.map((y0,i0)=>({score:l0.scores[i0],label:S[l0.classes[i0]],box:y(y0,!I0)}))}if(s0.sort((l0,y0)=>y0.score-l0.score),B0!==null)s0=s0.slice(0,B0);R0.push(s0)}return F0?R0:R0[0]}}class p extends D{constructor(b){super(b)}async _call(b,S,Q0={}){let B0=(await w(b))[0],{pixel_values:I0}=await this.processor(B0),F0=`<s_docvqa><s_question>${S}</s_question><s_answer>`,Y0=this.tokenizer(F0,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,E0=await this.model.generate({inputs:I0,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:Y0,...Q0}),R0=this.tokenizer.batch_decode(E0)[0].match(/<s_answer>(.*?)<\/s_answer>/),C0=null;if(R0&&R0.length>=2)C0=R0[1].trim();return[{answer:C0}]}}class Z0 extends D{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(b){super(b);this.vocoder=b.vocoder??null}async _call(b,{speaker_embeddings:S=null}={}){if(this.processor)return this._call_text_to_spectrogram(b,{speaker_embeddings:S});else return this._call_text_to_waveform(b)}async _call_text_to_waveform(b){let S=this.tokenizer(b,{padding:!0,truncation:!0}),{waveform:Q0}=await this.model(S),B0=this.model.config.sampling_rate;return new V.RawAudio(Q0.data,B0)}async _call_text_to_spectrogram(b,{speaker_embeddings:S}){if(!this.vocoder)console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await Q.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"});if(typeof S==="string"||S instanceof URL)S=new Float32Array(await(await fetch(S)).arrayBuffer());if(S instanceof Float32Array)S=new N.Tensor("float32",S,[1,S.length]);else if(!(S instanceof N.Tensor))throw Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:Q0}=this.tokenizer(b,{padding:!0,truncation:!0}),{waveform:B0}=await this.model.generate_speech(Q0,S,{vocoder:this.vocoder}),I0=this.processor.feature_extractor.config.sampling_rate;return new V.RawAudio(B0.data,I0)}}class z0 extends D{constructor(b){super(b)}async _call(b){let S=await w(b),Q0=await this.processor(S),B0=await this.model(Q0),I0=[];for(let F0 of B0.reconstruction){let Y0=F0.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");I0.push(z.RawImage.fromTensor(Y0))}return I0.length>1?I0:I0[0]}}class A0 extends D{constructor(b){super(b)}async _call(b){let S=await w(b),Q0=await this.processor(S),{predicted_depth:B0}=await this.model(Q0),I0=[];for(let F0=0;F0<S.length;++F0){let Y0=B0[F0],[E0,X0]=Y0.dims.slice(-2),[R0,C0]=S[F0].size,x0=(await(0,N.interpolate_4d)(Y0.view(1,1,E0,X0),{size:[C0,R0],mode:"bilinear"})).view(C0,R0),U0=x0.min().item(),u0=x0.max().item(),b0=x0.sub(U0).div_(u0-U0).mul_(255).to("uint8").unsqueeze(0),s0=z.RawImage.fromTensor(b0);I0.push({predicted_depth:x0,depth:s0})}return I0.length>1?I0:I0[0]}}let j0=Object.freeze({"text-classification":{tokenizer:W.AutoTokenizer,pipeline:j,model:Q.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:W.AutoTokenizer,pipeline:v,model:Q.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:W.AutoTokenizer,pipeline:g,model:Q.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:W.AutoTokenizer,pipeline:A,model:Q.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:W.AutoTokenizer,pipeline:B,model:Q.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:W.AutoTokenizer,pipeline:F,model:Q.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:W.AutoTokenizer,pipeline:T,model:Q.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:W.AutoTokenizer,pipeline:_,model:Q.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:W.AutoTokenizer,pipeline:h,model:Q.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:d,model:Q.AutoModelForAudioClassification,processor:Y.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:W.AutoTokenizer,pipeline:a,model:Q.AutoModel,processor:Y.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:W.AutoTokenizer,pipeline:n,model:[Q.AutoModelForSpeechSeq2Seq,Q.AutoModelForCTC],processor:Y.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:W.AutoTokenizer,pipeline:Z0,model:[Q.AutoModelForTextToWaveform,Q.AutoModelForTextToSpectrogram],processor:[Y.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:W.AutoTokenizer,pipeline:t,model:Q.AutoModelForVision2Seq,processor:Y.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:W0,model:Q.AutoModelForImageClassification,processor:Y.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:o,model:[Q.AutoModelForImageSegmentation,Q.AutoModelForSemanticSegmentation,Q.AutoModelForUniversalSegmentation],processor:Y.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:N0,model:[Q.AutoModelForImageSegmentation,Q.AutoModelForSemanticSegmentation,Q.AutoModelForUniversalSegmentation],processor:Y.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:W.AutoTokenizer,pipeline:w0,model:Q.AutoModel,processor:Y.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:I,model:Q.AutoModelForObjectDetection,processor:Y.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:W.AutoTokenizer,pipeline:O,model:Q.AutoModelForZeroShotObjectDetection,processor:Y.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:W.AutoTokenizer,pipeline:p,model:Q.AutoModelForDocumentQuestionAnswering,processor:Y.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:z0,model:Q.AutoModelForImageToImage,processor:Y.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:A0,model:Q.AutoModelForDepthEstimation,processor:Y.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:W.AutoTokenizer,pipeline:c,model:Q.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:Y.AutoProcessor,pipeline:m,model:[Q.AutoModelForImageFeatureExtraction,Q.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),h0=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function d0(b,S=null,{progress_callback:Q0=null,config:B0=null,cache_dir:I0=null,local_files_only:F0=!1,revision:Y0="main",device:E0=null,dtype:X0=null,subfolder:R0="onnx",use_external_data_format:C0=null,model_file_name:x0=null,session_options:U0={}}={}){b=h0[b]??b;let u0=j0[b.split("_",1)[0]];if(!u0)throw Error(`Unsupported pipeline: ${b}. Must be one of [${Object.keys(j0)}]`);if(!S)S=u0.default.model,console.log(`No model specified. Using default model: "${S}".`);let b0={progress_callback:Q0,config:B0,cache_dir:I0,local_files_only:F0,revision:Y0,device:E0,dtype:X0,subfolder:R0,use_external_data_format:C0,model_file_name:x0,session_options:U0},s0=new Map([["tokenizer",u0.tokenizer],["model",u0.model],["processor",u0.processor]]),l0=await T0(s0,S,b0);return l0.task=b,(0,q.dispatchCallback)(Q0,{status:"ready",task:b,model:S}),new u0.pipeline(l0)}async function T0(b,S,Q0){let B0=Object.create(null),I0=[];for(let[F0,Y0]of b.entries()){if(!Y0)continue;let E0;if(Array.isArray(Y0))E0=new Promise(async(X0,R0)=>{let C0;for(let x0 of Y0){if(x0===null){X0(null);return}try{X0(await x0.from_pretrained(S,Q0));return}catch(U0){if(U0.message?.includes("Unsupported model type"))C0=U0;else if(U0.message?.includes("Could not locate file"))C0=U0;else{R0(U0);return}}}R0(C0)});else E0=Y0.from_pretrained(S,Q0);B0[F0]=E0,I0.push(E0)}await Promise.all(I0);for(let[F0,Y0]of Object.entries(B0))B0[F0]=await Y0;return B0}},"./src/tokenizers.js":(J,Z,$)=>{/*!***************************!*\
  !*** ./src/tokenizers.js ***!
  \***************************/$.r(Z),$.d(Z,{AlbertTokenizer:()=>KJ,AutoTokenizer:()=>oJ,BartTokenizer:()=>E6,BertTokenizer:()=>QJ,BlenderbotSmallTokenizer:()=>P6,BlenderbotTokenizer:()=>m0,BloomTokenizer:()=>R4,CLIPTokenizer:()=>HJ,CamembertTokenizer:()=>L0,CodeGenTokenizer:()=>a4,CodeLlamaTokenizer:()=>I4,CohereTokenizer:()=>_J,ConvBertTokenizer:()=>f,DebertaTokenizer:()=>L,DebertaV2Tokenizer:()=>u,DistilBertTokenizer:()=>G0,ElectraTokenizer:()=>t0,Ernie4_5_Tokenizer:()=>yJ,EsmTokenizer:()=>c4,FalconTokenizer:()=>O4,GPT2Tokenizer:()=>V6,GPTNeoXTokenizer:()=>GJ,GemmaTokenizer:()=>_4,Grok1Tokenizer:()=>x4,HerbertTokenizer:()=>C,LlamaTokenizer:()=>p6,M2M100Tokenizer:()=>m4,MBart50Tokenizer:()=>j6,MBartTokenizer:()=>x6,MPNetTokenizer:()=>l4,MarianTokenizer:()=>P0,MgpstrTokenizer:()=>xJ,MobileBertTokenizer:()=>H6,NllbTokenizer:()=>qJ,NougatTokenizer:()=>p4,PreTrainedTokenizer:()=>Z6,Qwen2Tokenizer:()=>j4,RoFormerTokenizer:()=>r,RobertaTokenizer:()=>V4,SiglipTokenizer:()=>Y4,SpeechT5Tokenizer:()=>UJ,SqueezeBertTokenizer:()=>YJ,T5Tokenizer:()=>v0,TokenizerModel:()=>c,VitsTokenizer:()=>C4,Wav2Vec2CTCTokenizer:()=>S0,WhisperTokenizer:()=>P4,XLMRobertaTokenizer:()=>g4,XLMTokenizer:()=>c0,is_chinese_char:()=>g});var W=$("./src/utils/generic.js");/*! ./utils/generic.js */var Q=$("./src/utils/core.js");/*! ./utils/core.js */var Y=$("./src/utils/hub.js");/*! ./utils/hub.js */var H=$("./src/utils/maths.js");/*! ./utils/maths.js */var G=$("./src/utils/tensor.js");/*! ./utils/tensor.js */var q=$("./src/utils/data-structures.js");/*! ./utils/data-structures.js */var E=$("./node_modules/@huggingface/jinja/dist/index.js");/*! @huggingface/jinja */var V=$("./src/models/whisper/common_whisper.js");/*! ./models/whisper/common_whisper.js */async function N(U,k){let l=await Promise.all([(0,Y.getModelJSON)(U,"tokenizer.json",!0,k),(0,Y.getModelJSON)(U,"tokenizer_config.json",!0,k)]);if(k.legacy!==null)l[1].legacy=k.legacy;return l}function z(U,k){let l=[],s=0;for(let $0 of U.matchAll(k)){let V0=$0[0];if(s<$0.index)l.push(U.slice(s,$0.index));if(V0.length>0)l.push(V0);s=$0.index+V0.length}if(s<U.length)l.push(U.slice(s));return l}function w(U,k=!0){if(U.Regex!==void 0){let l=U.Regex.replace(/\\([#&~])/g,"$1");for(let[s,$0]of _)l=l.replaceAll(s,$0);return new RegExp(l,"gu")}else if(U.String!==void 0){let l=(0,Q.escapeRegExp)(U.String);return new RegExp(k?l:`(${l})`,"gu")}else return console.warn("Unknown pattern type:",U),null}function R(U){return new Map(Object.entries(U))}function y(U){let k=U.dims;switch(k.length){case 1:return U.tolist();case 2:if(k[0]!==1)throw Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return U.tolist()[0];default:throw Error(`Expected tensor to have 1-2 dimensions, got ${k.length}.`)}}function D(U){return U.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function j(U){return U.replace(/\p{M}/gu,"")}function v(U){return j(U.toLowerCase())}function g(U){return U>=19968&&U<=40959||U>=13312&&U<=19903||U>=131072&&U<=173791||U>=173824&&U<=177983||U>=177984&&U<=178207||U>=178208&&U<=183983||U>=63744&&U<=64255||U>=194560&&U<=195103}function A(U,k,l){let s=[],$0=0;while($0<U.length){if(s.push(U[$0]),(k.get(U[$0])??l)!==l){++$0;continue}while(++$0<U.length&&(k.get(U[$0])??l)===l)if(k.get(s.at(-1))!==l)s[s.length-1]+=U[$0]}return s}function T(U){return U.match(/\S+/g)||[]}let B="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",F=new RegExp(`^[${B}]+$`,"gu"),P=".,!?…。，、।۔،",_=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${P}])]+`,` ?[^\\s${P}]+`]]);class h{constructor(U){this.content=U.content,this.id=U.id,this.single_word=U.single_word??!1,this.lstrip=U.lstrip??!1,this.rstrip=U.rstrip??!1,this.special=U.special??!1,this.normalized=U.normalized??null}}class c extends W.Callable{constructor(U){super();this.config=U,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(U,...k){switch(U.type){case"WordPiece":return new m(U);case"Unigram":return new d(U,...k);case"BPE":return new t(U);default:if(U.vocab)if(Array.isArray(U.vocab))return new d(U,...k);else if(Object.hasOwn(U,"continuing_subword_prefix")&&Object.hasOwn(U,"unk_token"))if(Object.hasOwn(U,"merges"))return new t(U);else return new m(U);else return new W0(U,...k);throw Error(`Unknown TokenizerModel type: ${U.type}`)}}_call(U){if(U=this.encode(U),this.fuse_unk)U=A(U,this.tokens_to_ids,this.unk_token_id);return U}encode(U){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(U){return U.map((k)=>this.tokens_to_ids.get(k)??this.unk_token_id)}convert_ids_to_tokens(U){return U.map((k)=>this.vocab[k]??this.unk_token)}}class m extends c{constructor(U){super(U);this.tokens_to_ids=R(U.vocab),this.unk_token_id=this.tokens_to_ids.get(U.unk_token),this.unk_token=U.unk_token,this.max_input_chars_per_word=U.max_input_chars_per_word??100,this.vocab=Array(this.tokens_to_ids.size);for(let[k,l]of this.tokens_to_ids)this.vocab[l]=k}encode(U){let k=[];for(let l of U){let s=[...l];if(s.length>this.max_input_chars_per_word){k.push(this.unk_token);continue}let $0=!1,V0=0,_0=[];while(V0<s.length){let O0=s.length,f0=null;while(V0<O0){let k0=s.slice(V0,O0).join("");if(V0>0)k0=this.config.continuing_subword_prefix+k0;if(this.tokens_to_ids.has(k0)){f0=k0;break}--O0}if(f0===null){$0=!0;break}_0.push(f0),V0=O0}if($0)k.push(this.unk_token);else k.push(..._0)}return k}}class d extends c{constructor(U,k){super(U);let l=U.vocab.length;this.vocab=Array(l),this.scores=Array(l);for(let s=0;s<l;++s)[this.vocab[s],this.scores[s]]=U.vocab[s];this.unk_token_id=U.unk_id,this.unk_token=this.vocab[U.unk_id],this.tokens_to_ids=new Map(this.vocab.map((s,$0)=>[s,$0])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=k.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,H.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new q.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(U){let k=U.chars,l=1,s=0;while(s<k.length){let $0=!1,V0=[],_0=k.slice(s).join(""),O0=this.trie.commonPrefixSearch(_0);for(let f0 of O0){V0.push(f0);let k0=this.tokens_to_ids.get(f0),L6=this.scores[k0],X6=(0,Q.len)(f0);if(U.insert(s,X6,L6,k0),!$0&&X6===1)$0=!0}if(!$0)U.insert(s,1,this.unk_score,this.unk_token_id);s+=1}}tokenize(U){let k=new q.TokenLattice(U,this.bos_token_id,this.eos_token_id);return this.populateNodes(k),k.tokens()}encode(U){let k=[];for(let l of U){let s=this.tokenize(l);k.push(...s)}return k}}let a=(()=>{let U=[...Array.from({length:94},($0,V0)=>V0+33),...Array.from({length:"¬".charCodeAt(0)-"¡".charCodeAt(0)+1},($0,V0)=>V0+"¡".charCodeAt(0)),...Array.from({length:"ÿ".charCodeAt(0)-"®".charCodeAt(0)+1},($0,V0)=>V0+"®".charCodeAt(0))],k=U.slice(),l=0;for(let $0=0;$0<256;++$0)if(!U.includes($0))U.push($0),k.push(256+l),l+=1;let s=k.map(($0)=>String.fromCharCode($0));return Object.fromEntries(U.map(($0,V0)=>[$0,s[V0]]))})(),n=(0,Q.reverseDictionary)(a);class t extends c{constructor(U){super(U);this.tokens_to_ids=R(U.vocab),this.unk_token_id=this.tokens_to_ids.get(U.unk_token),this.unk_token=U.unk_token,this.vocab=Array(this.tokens_to_ids.size);for(let[l,s]of this.tokens_to_ids)this.vocab[s]=l;let k=Array.isArray(U.merges[0]);if(this.merges=k?U.merges:U.merges.map((l)=>l.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((l,s)=>[JSON.stringify(l),s])),this.end_of_word_suffix=U.end_of_word_suffix,this.continuing_subword_suffix=U.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback)this.text_encoder=new TextEncoder;this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new q.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(U){if(U.length===0)return[];let k=this.cache.get(U);if(k!==void 0)return k;let l=Array.from(U);if(this.end_of_word_suffix)l[l.length-1]+=this.end_of_word_suffix;let s=[];if(l.length>1){let $0=new q.PriorityQueue((O0,f0)=>O0.score<f0.score),V0={token:l[0],bias:0,prev:null,next:null},_0=V0;for(let O0=1;O0<l.length;++O0){let f0={bias:O0/l.length,token:l[O0],prev:_0,next:null};_0.next=f0,this._add_node($0,_0),_0=f0}while(!$0.isEmpty()){let O0=$0.pop();if(O0.deleted||!O0.next||O0.next.deleted)continue;if(O0.deleted=!0,O0.next.deleted=!0,O0.prev){let k0={...O0.prev};if(O0.prev.deleted=!0,O0.prev=k0,k0.prev)k0.prev.next=k0;else V0=k0}let f0={token:O0.token+O0.next.token,bias:O0.bias,prev:O0.prev,next:O0.next.next};if(f0.prev)f0.prev.next=f0,this._add_node($0,f0.prev);else V0=f0;if(f0.next)f0.next.prev=f0,this._add_node($0,f0)}for(let O0=V0;O0!==null;O0=O0.next)s.push(O0.token)}else s=l;if(this.continuing_subword_suffix)for(let $0=0;$0<s.length-1;++$0)s[$0]+=this.continuing_subword_suffix;if(U.length<this.max_length_to_cache)this.cache.put(U,s);return s}_add_node(U,k){let l=this.bpe_ranks.get(JSON.stringify([k.token,k.next.token]));if(l!==void 0)k.score=l+k.bias,U.push(k)}encode(U){let k=[];for(let l of U){if(this.ignore_merges&&this.tokens_to_ids.has(l)){k.push(l);continue}let s=this.bpe(l);for(let $0 of s)if(this.tokens_to_ids.has($0))k.push($0);else if(this.byte_fallback){let V0=Array.from(this.text_encoder.encode($0)).map((_0)=>`<0x${_0.toString(16).toUpperCase().padStart(2,"0")}>`);if(V0.every((_0)=>this.tokens_to_ids.has(_0)))k.push(...V0);else k.push(this.unk_token)}else k.push(this.unk_token)}return k}}class W0 extends c{constructor(U,k){super(U);this.tokens_to_ids=R(k.target_lang?U.vocab[k.target_lang]:U.vocab),this.bos_token=k.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=k.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=k.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=k.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=Array(this.tokens_to_ids.size);for(let[l,s]of this.tokens_to_ids)this.vocab[s]=l}encode(U){return U}}class o extends W.Callable{constructor(U){super();this.config=U}static fromConfig(U){if(U===null)return null;switch(U.type){case"BertNormalizer":return new T0(U);case"Precompiled":return new U4(U);case"Sequence":return new d0(U);case"Replace":return new N0(U);case"NFC":return new I(U);case"NFD":return new O(U);case"NFKC":return new p(U);case"NFKD":return new Z0(U);case"Strip":return new z0(U);case"StripAccents":return new A0(U);case"Lowercase":return new j0(U);case"Prepend":return new h0(U);default:throw Error(`Unknown Normalizer type: ${U.type}`)}}normalize(U){throw Error("normalize should be implemented in subclass.")}_call(U){return this.normalize(U)}}class N0 extends o{normalize(U){let k=w(this.config.pattern);return k===null?U:U.replaceAll(k,this.config.content)}}class w0 extends o{form=void 0;normalize(U){return U=U.normalize(this.form),U}}class I extends w0{form="NFC"}class O extends w0{form="NFD"}class p extends w0{form="NFKC"}class Z0 extends w0{form="NFKD"}class z0 extends o{normalize(U){if(this.config.strip_left&&this.config.strip_right)U=U.trim();else{if(this.config.strip_left)U=U.trimStart();if(this.config.strip_right)U=U.trimEnd()}return U}}class A0 extends o{normalize(U){return U=j(U),U}}class j0 extends o{normalize(U){return U=U.toLowerCase(),U}}class h0 extends o{normalize(U){return U=this.config.prepend+U,U}}class d0 extends o{constructor(U){super(U);this.normalizers=U.normalizers.map((k)=>o.fromConfig(k))}normalize(U){return this.normalizers.reduce((k,l)=>{return l.normalize(k)},U)}}class T0 extends o{_tokenize_chinese_chars(U){let k=[];for(let l=0;l<U.length;++l){let s=U[l],$0=s.charCodeAt(0);if(g($0))k.push(" "),k.push(s),k.push(" ");else k.push(s)}return k.join("")}stripAccents(U){return U.normalize("NFD").replace(/\p{Mn}/gu,"")}_is_control(U){switch(U){case"\t":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(U)}}_clean_text(U){let k=[];for(let l of U){let s=l.charCodeAt(0);if(s===0||s===65533||this._is_control(l))continue;if(/^\s$/.test(l))k.push(" ");else k.push(l)}return k.join("")}normalize(U){if(this.config.clean_text)U=this._clean_text(U);if(this.config.handle_chinese_chars)U=this._tokenize_chinese_chars(U);if(this.config.lowercase){if(U=U.toLowerCase(),this.config.strip_accents!==!1)U=this.stripAccents(U)}else if(this.config.strip_accents)U=this.stripAccents(U);return U}}class b extends W.Callable{static fromConfig(U){if(U===null)return null;switch(U.type){case"BertPreTokenizer":return new S(U);case"Sequence":return new k4(U);case"Whitespace":return new _6(U);case"WhitespaceSplit":return new o6(U);case"Metaspace":return new a6(U);case"ByteLevel":return new Q0(U);case"Split":return new B0(U);case"Punctuation":return new I0(U);case"Digits":return new F0(U);case"Replace":return new IJ(U);default:throw Error(`Unknown PreTokenizer type: ${U.type}`)}}pre_tokenize_text(U,k){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(U,k){return(Array.isArray(U)?U.map((l)=>this.pre_tokenize_text(l,k)):this.pre_tokenize_text(U,k)).flat()}_call(U,k){return this.pre_tokenize(U,k)}}class S extends b{constructor(U){super();this.pattern=new RegExp(`[^\\s${B}]+|[${B}]`,"gu")}pre_tokenize_text(U,k){return U.trim().match(this.pattern)||[]}}class Q0 extends b{constructor(U){super();this.config=U,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=a,this.text_encoder=new TextEncoder}pre_tokenize_text(U,k){if(this.add_prefix_space&&!U.startsWith(" "))U=" "+U;return(this.use_regex?U.match(this.pattern)||[]:[U]).map((s)=>Array.from(this.text_encoder.encode(s),($0)=>this.byte_encoder[$0]).join(""))}}class B0 extends b{constructor(U){super();this.config=U,this.pattern=w(this.config.pattern,this.config.invert)}pre_tokenize_text(U,k){if(this.pattern===null)return[];if(this.config.invert)return U.match(this.pattern)||[];else if(this.config.behavior?.toLowerCase()==="removed")return U.split(this.pattern).filter((l)=>l);else return z(U,this.pattern)}}class I0 extends b{constructor(U){super();this.config=U,this.pattern=new RegExp(`[^${B}]+|[${B}]+`,"gu")}pre_tokenize_text(U,k){return U.match(this.pattern)||[]}}class F0 extends b{constructor(U){super();this.config=U;let k=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(k,"gu")}pre_tokenize_text(U,k){return U.match(this.pattern)||[]}}class Y0 extends W.Callable{constructor(U){super();this.config=U}static fromConfig(U){if(U===null)return null;switch(U.type){case"TemplateProcessing":return new R0(U);case"ByteLevel":return new C0(U);case"RobertaProcessing":return new X0(U);case"BertProcessing":return new E0(U);case"Sequence":return new x0(U);default:throw Error(`Unknown PostProcessor type: ${U.type}`)}}post_process(U,...k){throw Error("post_process should be implemented in subclass.")}_call(U,...k){return this.post_process(U,...k)}}class E0 extends Y0{constructor(U){super(U);this.cls=U.cls[0],this.sep=U.sep[0]}post_process(U,k=null,{add_special_tokens:l=!0}={}){if(l)U=(0,Q.mergeArrays)([this.cls],U,[this.sep]);let s=Array(U.length).fill(0);if(k!==null){let $0=l&&this instanceof X0?[this.sep]:[],V0=l?[this.sep]:[];U=(0,Q.mergeArrays)(U,$0,k,V0),s=(0,Q.mergeArrays)(s,Array(k.length+$0.length+V0.length).fill(1))}return{tokens:U,token_type_ids:s}}}class X0 extends E0{}class R0 extends Y0{constructor(U){super(U);this.single=U.single,this.pair=U.pair}post_process(U,k=null,{add_special_tokens:l=!0}={}){let s=k===null?this.single:this.pair,$0=[],V0=[];for(let _0 of s)if("SpecialToken"in _0){if(l)$0.push(_0.SpecialToken.id),V0.push(_0.SpecialToken.type_id)}else if("Sequence"in _0){if(_0.Sequence.id==="A")$0=(0,Q.mergeArrays)($0,U),V0=(0,Q.mergeArrays)(V0,Array(U.length).fill(_0.Sequence.type_id));else if(_0.Sequence.id==="B")$0=(0,Q.mergeArrays)($0,k),V0=(0,Q.mergeArrays)(V0,Array(k.length).fill(_0.Sequence.type_id))}return{tokens:$0,token_type_ids:V0}}}class C0 extends Y0{post_process(U,k=null){if(k)U=(0,Q.mergeArrays)(U,k);return{tokens:U}}}class x0 extends Y0{constructor(U){super(U);this.processors=U.processors.map((k)=>Y0.fromConfig(k))}post_process(U,k=null,l={}){let s;for(let $0 of this.processors)if($0 instanceof C0){if(U=$0.post_process(U).tokens,k)k=$0.post_process(k).tokens}else{let V0=$0.post_process(U,k,l);U=V0.tokens,s=V0.token_type_ids}return{tokens:U,token_type_ids:s}}}class U0 extends W.Callable{constructor(U){super();this.config=U,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=U.trim_offsets}static fromConfig(U){if(U===null)return null;switch(U.type){case"WordPiece":return new y0(U);case"Metaspace":return new H4(U);case"ByteLevel":return new i0(U);case"Replace":return new u0(U);case"ByteFallback":return new b0(U);case"Fuse":return new s0(U);case"Strip":return new l0(U);case"Sequence":return new n0(U);case"CTC":return new a0(U);case"BPEDecoder":return new B6(U);default:throw Error(`Unknown Decoder type: ${U.type}`)}}_call(U){return this.decode(U)}decode(U){return this.decode_chain(U).join("")}decode_chain(U){throw Error("`decode_chain` should be implemented in subclass.")}}class u0 extends U0{decode_chain(U){let k=w(this.config.pattern);return k===null?U:U.map((l)=>l.replaceAll(k,this.config.content))}}class b0 extends U0{constructor(U){super(U);this.text_decoder=new TextDecoder}decode_chain(U){let k=[],l=[];for(let s of U){let $0=null;if(s.length===6&&s.startsWith("<0x")&&s.endsWith(">")){let V0=parseInt(s.slice(3,5),16);if(!isNaN(V0))$0=V0}if($0!==null)l.push($0);else{if(l.length>0){let V0=this.text_decoder.decode(Uint8Array.from(l));k.push(V0),l=[]}k.push(s)}}if(l.length>0){let s=this.text_decoder.decode(Uint8Array.from(l));k.push(s),l=[]}return k}}class s0 extends U0{decode_chain(U){return[U.join("")]}}class l0 extends U0{constructor(U){super(U);this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(U){return U.map((k)=>{let l=0;for(let $0=0;$0<this.start;++$0)if(k[$0]===this.content){l=$0+1;continue}else break;let s=k.length;for(let $0=0;$0<this.stop;++$0){let V0=k.length-$0-1;if(k[V0]===this.content){s=V0;continue}else break}return k.slice(l,s)})}}class y0 extends U0{constructor(U){super(U);this.cleanup=U.cleanup}decode_chain(U){return U.map((k,l)=>{if(l!==0)if(k.startsWith(this.config.prefix))k=k.replace(this.config.prefix,"");else k=" "+k;if(this.cleanup)k=D(k);return k})}}class i0 extends U0{constructor(U){super(U);this.byte_decoder=n,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(U){let k=U.join(""),l=new Uint8Array([...k].map(($0)=>this.byte_decoder[$0]));return this.text_decoder.decode(l)}decode_chain(U){let k=[],l=[];for(let s of U)if(this.added_tokens.find(($0)=>$0.content===s)!==void 0){if(l.length>0)k.push(this.convert_tokens_to_string(l)),l=[];k.push(s)}else l.push(s);if(l.length>0)k.push(this.convert_tokens_to_string(l));return k}}class a0 extends U0{constructor(U){super(U);this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(U){if(U.length===0)return"";let k=[U[0]];for(let $0=1;$0<U.length;++$0)if(U[$0]!==k.at(-1))k.push(U[$0]);let s=k.filter(($0)=>$0!==this.pad_token).join("");if(this.cleanup)s=D(s).replaceAll(this.word_delimiter_token," ").trim();return s}decode_chain(U){return[this.convert_tokens_to_string(U)]}}class n0 extends U0{constructor(U){super(U);this.decoders=U.decoders.map((k)=>U0.fromConfig(k))}decode_chain(U){return this.decoders.reduce((k,l)=>{return l.decode_chain(k)},U)}}class B6 extends U0{constructor(U){super(U);this.suffix=this.config.suffix}decode_chain(U){return U.map((k,l)=>{return k.replaceAll(this.suffix,l===U.length-1?"":" ")})}}class Q6 extends U0{decode_chain(U){let k="";for(let l=1;l<U.length;l+=2)k+=U[l];return[k]}}class a6 extends b{constructor(U){super();this.addPrefixSpace=U.add_prefix_space,this.replacement=U.replacement,this.strRep=U.str_rep||this.replacement,this.prepend_scheme=U.prepend_scheme??"always"}pre_tokenize_text(U,{section_index:k=void 0}={}){let l=U.replaceAll(" ",this.strRep);if(this.addPrefixSpace&&!l.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&k===0))l=this.strRep+l;return[l]}}class H4 extends U0{constructor(U){super(U);this.addPrefixSpace=U.add_prefix_space,this.replacement=U.replacement}decode_chain(U){let k=[];for(let l=0;l<U.length;++l){let s=U[l].replaceAll(this.replacement," ");if(this.addPrefixSpace&&l==0&&s.startsWith(" "))s=s.substring(1);k.push(s)}return k}}class U4 extends o{constructor(U){super(U);this.charsmap=U.precompiled_charsmap}normalize(U){if(U=U.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),U=U.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),U.includes("～"))U=U.split("～").map((l)=>l.normalize("NFKC")).join("～");else U=U.normalize("NFKC");return U}}class k4 extends b{constructor(U){super();this.tokenizers=U.pretokenizers.map((k)=>b.fromConfig(k))}pre_tokenize_text(U,k){return this.tokenizers.reduce((l,s)=>{return s.pre_tokenize(l,k)},[U])}}class _6 extends b{constructor(U){super()}pre_tokenize_text(U,k){return U.match(/\w+|[^\w\s]+/g)||[]}}class o6 extends b{constructor(U){super()}pre_tokenize_text(U,k){return T(U)}}class IJ extends b{constructor(U){super();this.config=U,this.pattern=w(this.config.pattern),this.content=this.config.content}pre_tokenize_text(U,k){if(this.pattern===null)return[U];return[U.replaceAll(this.pattern,this.config.content)]}}let TJ=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function kJ(U,k,l,s){for(let $0 of Object.keys(U)){let V0=k-U[$0].length,_0=l($0),O0=Array(V0).fill(_0);U[$0]=s==="right"?(0,Q.mergeArrays)(U[$0],O0):(0,Q.mergeArrays)(O0,U[$0])}}function v4(U,k){for(let l of Object.keys(U))U[l].length=k}class Z6 extends W.Callable{return_token_type_ids=!1;padding_side="right";constructor(U,k){super();this.config=k,this.normalizer=o.fromConfig(U.normalizer),this.pre_tokenizer=b.fromConfig(U.pre_tokenizer),this.model=c.fromConfig(U.model,k),this.post_processor=Y0.fromConfig(U.post_processor),this.decoder=U0.fromConfig(U.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(let l of U.added_tokens){let s=new h(l);if(this.added_tokens.push(s),this.model.tokens_to_ids.set(s.content,s.id),this.model.vocab[s.id]=s.content,s.special)this.special_tokens.push(s.content),this.all_special_ids.push(s.id)}if(this.additional_special_tokens=k.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder)this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix;if(this.added_tokens_splitter=new q.DictionarySplitter(this.added_tokens.map((l)=>l.content)),this.added_tokens_map=new Map(this.added_tokens.map((l)=>[l.content,l])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=k.model_max_length,this.remove_space=k.remove_space,this.clean_up_tokenization_spaces=k.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=k.do_lowercase_and_remove_accent??!1,k.padding_side)this.padding_side=k.padding_side;if(this.add_bos_token=k.add_bos_token,this.add_eos_token=k.add_eos_token,this.legacy=!1,this.chat_template=k.chat_template??null,Array.isArray(this.chat_template)){let l=Object.create(null);for(let{name:s,template:$0}of this.chat_template){if(typeof s!=="string"||typeof $0!=="string")throw Error('Chat template must be a list of objects with "name" and "template" properties');l[s]=$0}this.chat_template=l}this._compiled_template_cache=new Map}getToken(...U){for(let k of U){let l=this.config[k];if(!l)continue;if(typeof l==="object")if(l.__type==="AddedToken")return l.content;else throw Error(`Unknown token: ${l}`);else return l}return null}static async from_pretrained(U,{progress_callback:k=null,config:l=null,cache_dir:s=null,local_files_only:$0=!1,revision:V0="main",legacy:_0=null}={}){let O0=await N(U,{progress_callback:k,config:l,cache_dir:s,local_files_only:$0,revision:V0,legacy:_0});return new this(...O0)}_call(U,{text_pair:k=null,add_special_tokens:l=!0,padding:s=!1,truncation:$0=null,max_length:V0=null,return_tensor:_0=!0,return_token_type_ids:O0=null}={}){let f0=Array.isArray(U),k0;if(f0){if(U.length===0)throw Error("text array must be non-empty");if(k!==null){if(!Array.isArray(k))throw Error("text_pair must also be an array");else if(U.length!==k.length)throw Error("text and text_pair must have the same length");k0=U.map((X6,y6)=>this._encode_plus(X6,{text_pair:k[y6],add_special_tokens:l,return_token_type_ids:O0}))}else k0=U.map((X6)=>this._encode_plus(X6,{add_special_tokens:l,return_token_type_ids:O0}))}else{if(U===null||U===void 0)throw Error("text may not be null or undefined");if(Array.isArray(k))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");k0=[this._encode_plus(U,{text_pair:k,add_special_tokens:l,return_token_type_ids:O0})]}if(V0===null)V0=this.model_max_length;else if($0===null){if(s===!0)console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),V0=this.model_max_length;else if(s===!1)console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),$0=!0}if(s===!0)V0=Math.min((0,H.max)(k0.map((X6)=>X6.input_ids.length))[0],V0??1/0);if(V0=Math.min(V0,this.model_max_length??1/0),s||$0){for(let X6=0;X6<k0.length;++X6)if(k0[X6].input_ids.length===V0)continue;else if(k0[X6].input_ids.length>V0){if($0)v4(k0[X6],V0)}else if(s)kJ(k0[X6],V0,(y6)=>y6==="input_ids"?this.pad_token_id:0,this.padding_side)}let L6={};if(_0){if(!(s&&$0)){if(k0.some((y6)=>{for(let r6 of Object.keys(y6))if(y6[r6].length!==k0[0][r6]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.")}let X6=[k0.length,k0[0].input_ids.length];for(let y6 of Object.keys(k0[0]))L6[y6]=new G.Tensor("int64",BigInt64Array.from(k0.flatMap((r6)=>r6[y6]).map(BigInt)),X6)}else{for(let X6 of Object.keys(k0[0]))L6[X6]=k0.map((y6)=>y6[X6]);if(!f0)for(let X6 of Object.keys(L6))L6[X6]=L6[X6][0]}return L6}_encode_text(U){if(U===null)return null;let k=this.added_tokens_splitter.split(U);for(let s=0;s<k.length;++s){let $0=this.added_tokens_map.get(k[s]);if($0){if($0.lstrip&&s>0)k[s-1]=k[s-1].trimEnd();if($0.rstrip&&s<k.length-1)k[s+1]=k[s+1].trimStart()}}return k.flatMap((s,$0)=>{if(s.length===0)return[];if(this.added_tokens_map.has(s))return[s];if(this.remove_space===!0)s=s.trim().split(/\s+/).join(" ");if(this.do_lowercase_and_remove_accent)s=v(s);if(this.normalizer!==null)s=this.normalizer(s);if(s.length===0)return[];let V0=this.pre_tokenizer!==null?this.pre_tokenizer(s,{section_index:$0}):[s];return this.model(V0)})}_encode_plus(U,{text_pair:k=null,add_special_tokens:l=!0,return_token_type_ids:s=null}={}){let{tokens:$0,token_type_ids:V0}=this._tokenize_helper(U,{pair:k,add_special_tokens:l}),_0=this.model.convert_tokens_to_ids($0),O0={input_ids:_0,attention_mask:Array(_0.length).fill(1)};if((s??this.return_token_type_ids)&&V0)O0.token_type_ids=V0;return O0}_tokenize_helper(U,{pair:k=null,add_special_tokens:l=!1}={}){let s=this._encode_text(U),$0=this._encode_text(k);return this.post_processor?this.post_processor(s,$0,{add_special_tokens:l}):{tokens:(0,Q.mergeArrays)(s??[],$0??[])}}tokenize(U,{pair:k=null,add_special_tokens:l=!1}={}){return this._tokenize_helper(U,{pair:k,add_special_tokens:l}).tokens}encode(U,{text_pair:k=null,add_special_tokens:l=!0,return_token_type_ids:s=null}={}){return this._encode_plus(U,{text_pair:k,add_special_tokens:l,return_token_type_ids:s}).input_ids}batch_decode(U,k={}){if(U instanceof G.Tensor)U=U.tolist();return U.map((l)=>this.decode(l,k))}decode(U,k={}){if(U instanceof G.Tensor)U=y(U);if(!Array.isArray(U)||U.length===0||!(0,Q.isIntegralNumber)(U[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(U,k)}decode_single(U,{skip_special_tokens:k=!1,clean_up_tokenization_spaces:l=null}){let s=this.model.convert_ids_to_tokens(U);if(k)s=s.filter((V0)=>!this.special_tokens.includes(V0));let $0=this.decoder?this.decoder(s):s.join(" ");if(this.decoder&&this.decoder.end_of_word_suffix){if($0=$0.replaceAll(this.decoder.end_of_word_suffix," "),k)$0=$0.trim()}if(l??this.clean_up_tokenization_spaces)$0=D($0);return $0}get_chat_template({chat_template:U=null,tools:k=null}={}){if(this.chat_template&&typeof this.chat_template==="object"){let l=this.chat_template;if(U!==null&&Object.hasOwn(l,U))U=l[U];else if(U===null)if(k!==null&&"tool_use"in l)U=l.tool_use;else if("default"in l)U=l.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(l).sort()}.`)}else if(U===null)if(this.chat_template)U=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return U}apply_chat_template(U,{tools:k=null,documents:l=null,chat_template:s=null,add_generation_prompt:$0=!1,tokenize:V0=!0,padding:_0=!1,truncation:O0=!1,max_length:f0=null,return_tensor:k0=!0,return_dict:L6=!1,tokenizer_kwargs:X6={},...y6}={}){if(s=this.get_chat_template({chat_template:s,tools:k}),typeof s!=="string")throw Error(`chat_template must be a string, but got ${typeof s}`);let r6=this._compiled_template_cache.get(s);if(r6===void 0)r6=new E.Template(s),this._compiled_template_cache.set(s,r6);let v6=Object.create(null);for(let e6 of TJ){let S4=this.getToken(e6);if(S4)v6[e6]=S4}let W4=r6.render({messages:U,add_generation_prompt:$0,tools:k,documents:l,...v6,...y6});if(V0){let e6=this._call(W4,{add_special_tokens:!1,padding:_0,truncation:O0,max_length:f0,return_tensor:k0,...X6});return L6?e6:e6.input_ids}return W4}}class QJ extends Z6{return_token_type_ids=!0}class KJ extends Z6{return_token_type_ids=!0}class H6 extends Z6{return_token_type_ids=!0}class YJ extends Z6{return_token_type_ids=!0}class L extends Z6{return_token_type_ids=!0}class u extends Z6{return_token_type_ids=!0}class C extends Z6{return_token_type_ids=!0}class f extends Z6{return_token_type_ids=!0}class r extends Z6{return_token_type_ids=!0}class G0 extends Z6{}class L0 extends Z6{}class c0 extends Z6{return_token_type_ids=!0;constructor(U,k){super(U,k);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class t0 extends Z6{return_token_type_ids=!0}class v0 extends Z6{}class V6 extends Z6{}class E6 extends Z6{}class x6 extends Z6{constructor(U,k){super(U,k);this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter((l)=>this.languageRegex.test(l)),this.lang_to_token=(l)=>l}_build_translation_inputs(U,k,l){return XJ(this,U,k,l)}}class j6 extends x6{}class V4 extends Z6{}class R4 extends Z6{}let Z4="▁";class p6 extends Z6{padding_side="left";constructor(U,k){super(U,k);if(this.legacy=k.legacy??!0,!this.legacy)this.normalizer=null,this.pre_tokenizer=new a6({replacement:Z4,add_prefix_space:!0,prepend_scheme:"first"})}_encode_text(U){if(U===null)return null;if(this.legacy||U.length===0)return super._encode_text(U);let k=super._encode_text(Z4+U.replaceAll(Z4," "));if(k.length>1&&k[0]===Z4&&this.special_tokens.includes(k[1]))k=k.slice(1);return k}}class I4 extends Z6{}class g4 extends Z6{}class l4 extends Z6{}class O4 extends Z6{}class GJ extends Z6{}class c4 extends Z6{}class j4 extends Z6{}class _4 extends Z6{}class x4 extends Z6{}function XJ(U,k,l,s){if(!("language_codes"in U)||!Array.isArray(U.language_codes))throw Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in U)||!(U.languageRegex instanceof RegExp))throw Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in U)||typeof U.lang_to_token!=="function")throw Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let{src_lang:$0,tgt_lang:V0}=s;if(!U.language_codes.includes(V0))throw Error(`Target language code "${V0}" is not valid. Must be one of: {${U.language_codes.join(", ")}}`);if($0!==void 0){if(!U.language_codes.includes($0))throw Error(`Source language code "${$0}" is not valid. Must be one of: {${U.language_codes.join(", ")}}`);for(let _0 of U.post_processor.config.single)if("SpecialToken"in _0&&U.languageRegex.test(_0.SpecialToken.id)){_0.SpecialToken.id=U.lang_to_token($0);break}}return s.forced_bos_token_id=U.model.convert_tokens_to_ids([U.lang_to_token(V0)])[0],U._call(k,l)}class qJ extends Z6{constructor(U,k){super(U,k);this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter((l)=>this.languageRegex.test(l)),this.lang_to_token=(l)=>l}_build_translation_inputs(U,k,l){return XJ(this,U,k,l)}}class m4 extends Z6{constructor(U,k){super(U,k);this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter((l)=>this.languageRegex.test(l)).map((l)=>l.slice(2,-2)),this.lang_to_token=(l)=>`__${l}__`}_build_translation_inputs(U,k,l){return XJ(this,U,k,l)}}class P4 extends Z6{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(U,{return_timestamps:k=!1,return_language:l=!1,time_precision:s=null,force_full_sequences:$0=!0}={}){if(s===null)throw Error("Must specify time_precision");let V0=null,_0=k==="word";function O0(){return{language:V0,timestamp:[null,null],text:""}}let f0=[],k0=O0(),L6=0,X6=this.timestamp_begin,r6=X6+1500,v6=[],W4=[],e6=!1,S4=null,DJ=new Set(this.all_special_ids);for(let M6 of U){let n6=M6.tokens,N4=_0?M6.token_timestamps:null,D4=null,r4=X6;if("stride"in M6){let[s6,h6,d6]=M6.stride;if(L6-=h6,S4=s6-d6,h6)r4=h6/s+X6;if(d6)for(let u6=n6.length-1;u6>=0;--u6){let z4=Number(n6[u6]);if(z4>=X6){if(D4!==null&&(z4-X6)*s<S4)break;D4=z4}}}let Q4=[],h4=[];for(let s6=0;s6<n6.length;++s6){let h6=Number(n6[s6]);if(DJ.has(h6)){let d6=this.decode([h6]),u6=V.WHISPER_LANGUAGE_MAPPING.get(d6.slice(2,-2));if(u6!==void 0){if(V0!==null&&u6!==V0&&!k){v6.push(Q4);let z4=this.findLongestCommonSequence(v6)[0],vJ=this.decode(z4);k0.text=vJ,f0.push(k0),v6=[],Q4=[],k0=O0()}V0=k0.language=u6}}else if(h6>=X6&&h6<=r6){let d6=(h6-X6)*s+L6,u6=(0,H.round)(d6,2);if(D4!==null&&h6>=D4)e6=!0;else if(e6||v6.length>0&&h6<r4)e6=!1;else if(k0.timestamp[0]===null)k0.timestamp[0]=u6;else if(u6===k0.timestamp[0]);else{if(k0.timestamp[1]=u6,v6.push(Q4),_0)W4.push(h4);let[z4,vJ]=this.findLongestCommonSequence(v6,W4),L5=this.decode(z4);if(k0.text=L5,_0)k0.words=this.collateWordTimestamps(z4,vJ,V0);f0.push(k0),v6=[],Q4=[],W4=[],h4=[],k0=O0()}}else if(Q4.push(h6),_0){let d6=(0,H.round)(N4[s6]+L6,2),u6;if(s6+1<N4.length){u6=(0,H.round)(N4[s6+1]+L6,2);let z4=this.decode([h6]);if(F.test(z4))u6=(0,H.round)(Math.min(d6+s,u6),2)}else u6=null;h4.push([d6,u6])}}if("stride"in M6){let[s6,h6,d6]=M6.stride;L6+=s6-d6}if(Q4.length>0){if(v6.push(Q4),_0)W4.push(h4)}else if(v6.every((s6)=>s6.length===0))k0=O0(),v6=[],Q4=[],W4=[],h4=[]}if(v6.length>0){if($0&&k)throw Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[M6,n6]=this.findLongestCommonSequence(v6,W4),N4=this.decode(M6);if(k0.text=N4,_0)k0.words=this.collateWordTimestamps(M6,n6,V0);f0.push(k0)}let G4=Object.create(null),b4=f0.map((M6)=>M6.text).join("");if(k||l){for(let M6=0;M6<f0.length;++M6){let n6=f0[M6];if(!k)delete n6.timestamp;if(!l)delete n6.language}if(_0){let M6=[];for(let n6 of f0)for(let N4 of n6.words)M6.push(N4);G4={chunks:M6}}else G4={chunks:f0}}return[b4,G4]}findLongestCommonSequence(U,k=null){let l=U[0],s=l.length,$0=[],V0=Array.isArray(k)&&k.length>0,_0=V0?[]:null,O0=V0?k[0]:null;for(let f0=1;f0<U.length;++f0){let k0=U[f0],L6=0,X6=[s,s,0,0],y6=k0.length;for(let G4=1;G4<s+y6;++G4){let b4=Math.max(0,s-G4),M6=Math.min(s,s+y6-G4),n6=l.slice(b4,M6),N4=Math.max(0,G4-s),D4=Math.min(y6,G4),r4=k0.slice(N4,D4);if(n6.length!==r4.length)throw Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let Q4;if(V0)Q4=n6.filter((h6,d6)=>h6===r4[d6]&&O0[b4+d6]<=k[f0][N4+d6]).length;else Q4=n6.filter((h6,d6)=>h6===r4[d6]).length;let h4=G4/1e4,s6=Q4/G4+h4;if(Q4>1&&s6>L6)L6=s6,X6=[b4,M6,N4,D4]}let[r6,v6,W4,e6]=X6,S4=Math.floor((v6+r6)/2),DJ=Math.floor((e6+W4)/2);if($0.push(...l.slice(0,S4)),l=k0.slice(DJ),s=l.length,V0)_0.push(...O0.slice(0,S4)),O0=k[f0].slice(DJ)}if($0.push(...l),V0)return _0.push(...O0),[$0,_0];else return[$0,[]]}collateWordTimestamps(U,k,l){let[s,$0,V0]=this.combineTokensIntoWords(U,l),_0=[];for(let O0=0;O0<s.length;++O0){let f0=V0[O0];_0.push({text:s[O0],timestamp:[k[f0.at(0)][0],k[f0.at(-1)][1]]})}return _0}combineTokensIntoWords(U,k,l=`"'“¡¿([{-`,s=`"'.。,，!！?？:：”)]}、`){k=k??"english";let $0,V0,_0;if(["chinese","japanese","thai","lao","myanmar"].includes(k))[$0,V0,_0]=this.splitTokensOnUnicode(U);else[$0,V0,_0]=this.splitTokensOnSpaces(U);return this.mergePunctuations($0,V0,_0,l,s)}decode(U,k){let l;if(k?.decode_with_timestamps){if(U instanceof G.Tensor)U=y(U);l=this.decodeWithTimestamps(U,k)}else l=super.decode(U,k);return l}decodeWithTimestamps(U,k){let l=k?.time_precision??0.02,s=Array.from(this.all_special_ids).at(-1)+1,$0=[[]];for(let V0 of U)if(V0=Number(V0),V0>=s){let _0=((V0-s)*l).toFixed(2);$0.push(`<|${_0}|>`),$0.push([])}else $0[$0.length-1].push(V0);return $0=$0.map((V0)=>typeof V0==="string"?V0:super.decode(V0,k)),$0.join("")}splitTokensOnUnicode(U){let k=this.decode(U,{decode_with_timestamps:!0}),l="�",s=[],$0=[],V0=[],_0=[],O0=[],f0=0;for(let k0=0;k0<U.length;++k0){let L6=U[k0];_0.push(L6),O0.push(k0);let X6=this.decode(_0,{decode_with_timestamps:!0});if(!X6.includes("�")||k[f0+X6.indexOf("�")]==="�")s.push(X6),$0.push(_0),V0.push(O0),_0=[],O0=[],f0+=X6.length}return[s,$0,V0]}splitTokensOnSpaces(U){let[k,l,s]=this.splitTokensOnUnicode(U),$0=[],V0=[],_0=[],O0=new RegExp(`^[${B}]$`,"gu");for(let f0=0;f0<k.length;++f0){let k0=k[f0],L6=l[f0],X6=s[f0],y6=L6[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),r6=k0.startsWith(" "),v6=k0.trim(),W4=O0.test(v6);if(y6||r6||W4||$0.length===0)$0.push(k0),V0.push(L6),_0.push(X6);else{let e6=$0.length-1;$0[e6]+=k0,V0[e6].push(...L6),_0[e6].push(...X6)}}return[$0,V0,_0]}mergePunctuations(U,k,l,s,$0){let V0=structuredClone(U),_0=structuredClone(k),O0=structuredClone(l),f0=V0.length-2,k0=V0.length-1;while(f0>=0){if(V0[f0].startsWith(" ")&&s.includes(V0[f0].trim()))V0[k0]=V0[f0]+V0[k0],_0[k0]=(0,Q.mergeArrays)(_0[f0],_0[k0]),O0[k0]=(0,Q.mergeArrays)(O0[f0],O0[k0]),V0[f0]="",_0[f0]=[],O0[f0]=[];else k0=f0;--f0}f0=0,k0=1;while(k0<V0.length){if(!V0[f0].endsWith(" ")&&$0.includes(V0[k0]))V0[f0]+=V0[k0],_0[f0]=(0,Q.mergeArrays)(_0[f0],_0[k0]),O0[f0]=(0,Q.mergeArrays)(O0[f0],O0[k0]),V0[k0]="",_0[k0]=[],O0[k0]=[];else f0=k0;++k0}return[V0.filter((L6)=>L6),_0.filter((L6)=>L6.length>0),O0.filter((L6)=>L6.length>0)]}}class a4 extends Z6{}class HJ extends Z6{}class Y4 extends Z6{}class P0 extends Z6{constructor(U,k){super(U,k);this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter((l)=>this.languageRegex.test(l)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(U){if(U===null)return null;let[k,...l]=U.trim().split(this.languageRegex);if(l.length===0)return super._encode_text(k);else if(l.length===2){let[s,$0]=l;if(!this.supported_language_codes.includes(s))console.warn(`Unsupported language code "${s}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`);return(0,Q.mergeArrays)([s],super._encode_text($0))}}}class S0 extends Z6{}class m0 extends Z6{}class P6 extends Z6{}class UJ extends Z6{}class p4 extends Z6{}class C4 extends Z6{constructor(U,k){super(U,k);this.decoder=new Q6({})}}class _J extends Z6{}class xJ extends Z6{}class yJ extends Z6{}class oJ{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:v0,DistilBertTokenizer:G0,CamembertTokenizer:L0,DebertaTokenizer:L,DebertaV2Tokenizer:u,BertTokenizer:QJ,HerbertTokenizer:C,ConvBertTokenizer:f,RoFormerTokenizer:r,XLMTokenizer:c0,ElectraTokenizer:t0,MobileBertTokenizer:H6,SqueezeBertTokenizer:YJ,AlbertTokenizer:KJ,GPT2Tokenizer:V6,BartTokenizer:E6,MBartTokenizer:x6,MBart50Tokenizer:j6,RobertaTokenizer:V4,WhisperTokenizer:P4,CodeGenTokenizer:a4,CLIPTokenizer:HJ,SiglipTokenizer:Y4,MarianTokenizer:P0,BloomTokenizer:R4,NllbTokenizer:qJ,M2M100Tokenizer:m4,LlamaTokenizer:p6,CodeLlamaTokenizer:I4,XLMRobertaTokenizer:g4,MPNetTokenizer:l4,FalconTokenizer:O4,GPTNeoXTokenizer:GJ,EsmTokenizer:c4,Wav2Vec2CTCTokenizer:S0,BlenderbotTokenizer:m0,BlenderbotSmallTokenizer:P6,SpeechT5Tokenizer:UJ,NougatTokenizer:p4,VitsTokenizer:C4,Qwen2Tokenizer:j4,GemmaTokenizer:_4,Grok1Tokenizer:x4,CohereTokenizer:_J,MgpstrTokenizer:xJ,Ernie4_5_Tokenizer:yJ,PreTrainedTokenizer:Z6};static async from_pretrained(U,{progress_callback:k=null,config:l=null,cache_dir:s=null,local_files_only:$0=!1,revision:V0="main",legacy:_0=null}={}){let[O0,f0]=await N(U,{progress_callback:k,config:l,cache_dir:s,local_files_only:$0,revision:V0,legacy:_0}),k0=f0.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer",L6=this.TOKENIZER_CLASS_MAPPING[k0];if(!L6)console.warn(`Unknown tokenizer class "${k0}", attempting to construct from base class.`),L6=Z6;return new L6(O0,f0)}}},"./src/utils/audio.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/audio.js ***!
  \****************************/$.r(Z),$.d(Z,{RawAudio:()=>m,hamming:()=>z,hanning:()=>N,mel_filter_bank:()=>g,read_audio:()=>E,spectrogram:()=>P,window_function:()=>_});var W=$("./src/utils/hub.js");/*! ./hub.js */var Q=$("./src/utils/maths.js");/*! ./maths.js */var Y=$("./src/utils/core.js");/*! ./core.js */var H=$("./src/env.js");/*! ../env.js */var G=$("./src/utils/tensor.js");/*! ./tensor.js */var q=$("node:fs");/*! node:fs */async function E(d,a){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let n=await(await(0,W.getFile)(d)).arrayBuffer(),t=new AudioContext({sampleRate:a});if(typeof a>"u")console.warn(`No sampling rate provided, using default of ${t.sampleRate}Hz.`);let W0=await t.decodeAudioData(n),o;if(W0.numberOfChannels===2){let N0=Math.sqrt(2),w0=W0.getChannelData(0),I=W0.getChannelData(1);o=new Float32Array(w0.length);for(let O=0;O<W0.length;++O)o[O]=N0*(w0[O]+I[O])/2}else o=W0.getChannelData(0);return o}function V(d,a){if(d<1)return new Float64Array;if(d===1)return new Float64Array([1]);let n=1-a,t=2*Math.PI/(d-1),W0=new Float64Array(d);for(let o=0;o<d;++o)W0[o]=a-n*Math.cos(o*t);return W0}function N(d){return V(d,0.5)}function z(d){return V(d,0.54)}let w={htk:(d)=>2595*Math.log10(1+d/700),kaldi:(d)=>1127*Math.log(1+d/700),slaney:(d,a=1000,n=15,t=27/Math.log(6.4))=>d>=a?n+Math.log(d/a)*t:3*d/200};function R(d,a="htk"){let n=w[a];if(!n)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof d==="number"?n(d):d.map((t)=>n(t))}let y={htk:(d)=>700*(10**(d/2595)-1),kaldi:(d)=>700*(Math.exp(d/1127)-1),slaney:(d,a=1000,n=15,t=Math.log(6.4)/27)=>d>=n?a*Math.exp(t*(d-n)):200*d/3};function D(d,a="htk"){let n=y[a];if(!n)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof d==="number"?n(d):d.map((t)=>n(t))}function j(d,a){let n=Float64Array.from({length:a.length-1},(N0,w0)=>a[w0+1]-a[w0]),t=Array.from({length:d.length},()=>Array(a.length));for(let N0=0;N0<d.length;++N0){let w0=t[N0];for(let I=0;I<a.length;++I)w0[I]=a[I]-d[N0]}let W0=a.length-2,o=Array.from({length:W0},()=>Array(d.length));for(let N0=0;N0<d.length;++N0){let w0=t[N0];for(let I=0;I<W0;++I){let O=-w0[I]/n[I],p=w0[I+2]/n[I+1];o[I][N0]=Math.max(0,Math.min(O,p))}}return o}function v(d,a,n){let t=(a-d)/(n-1);return Float64Array.from({length:n},(W0,o)=>d+t*o)}function g(d,a,n,t,W0,o=null,N0="htk",w0=!1){if(o!==null&&o!=="slaney")throw Error('norm must be one of null or "slaney"');if(d<2)throw Error(`Require num_frequency_bins: ${d} >= 2`);if(n>t)throw Error(`Require min_frequency: ${n} <= max_frequency: ${t}`);let I=R(n,N0),O=R(t,N0),p=v(I,O,a+2),Z0=D(p,N0),z0;if(w0){let j0=W0/((d-1)*2);z0=R(Float64Array.from({length:d},(h0,d0)=>d0*j0),N0),Z0=p}else z0=v(0,Math.floor(W0/2),d);let A0=j(z0,Z0);if(o!==null&&o==="slaney")for(let j0=0;j0<a;++j0){let h0=A0[j0],d0=2/(Z0[j0+2]-Z0[j0]);for(let T0=0;T0<d;++T0)h0[T0]*=d0}return A0}function A(d,a,n){let t=new d.constructor(d.length+a+n),W0=d.length-1;for(let o=0;o<d.length;++o)t[a+o]=d[o];for(let o=1;o<=a;++o)t[a-o]=d[(0,Y.calculateReflectOffset)(o,W0)];for(let o=1;o<=n;++o)t[W0+a+o]=d[(0,Y.calculateReflectOffset)(W0-o,W0)];return t}function T(d,a,n,t,W0){if(n<=0)throw Error("reference must be greater than zero");if(t<=0)throw Error("min_value must be greater than zero");n=Math.max(t,n);let o=Math.log10(n);for(let N0=0;N0<d.length;++N0)d[N0]=a*Math.log10(Math.max(t,d[N0])-o);if(W0!==null){if(W0<=0)throw Error("db_range must be greater than zero");let N0=(0,Q.max)(d)[0]-W0;for(let w0=0;w0<d.length;++w0)d[w0]=Math.max(d[w0],N0)}return d}function B(d,a=1,n=0.00001,t=null){return T(d,20,a,n,t)}function F(d,a=1,n=0.0000000001,t=null){return T(d,10,a,n,t)}async function P(d,a,n,t,{fft_length:W0=null,power:o=1,center:N0=!0,pad_mode:w0="reflect",onesided:I=!0,preemphasis:O=null,preemphasis_htk_flavor:p=!0,mel_filters:Z0=null,mel_floor:z0=0.0000000001,log_mel:A0=null,reference:j0=1,min_value:h0=0.0000000001,db_range:d0=null,remove_dc_offset:T0=null,min_num_frames:b=null,max_num_frames:S=null,do_pad:Q0=!0,transpose:B0=!1,mel_offset:I0=0}={}){let F0=a.length;if(W0===null)W0=n;if(n>W0)throw Error(`frame_length (${n}) may not be larger than fft_length (${W0})`);if(F0!==n)throw Error(`Length of the window (${F0}) must equal frame_length (${n})`);if(t<=0)throw Error("hop_length must be greater than zero");if(o===null&&Z0!==null)throw Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!p)throw Error("`preemphasis_htk_flavor=false` is not currently supported.");if(N0)switch(w0){case"reflect":{let y0=Math.floor((W0-1)/2)+1;d=A(d,y0,y0);break}case"constant":{let y0=Math.floor(W0/2),i0=new d.constructor(d.length+2*y0);i0.set(d,y0),d=i0;break}default:throw Error(`pad_mode="${w0}" not implemented yet.`)}let Y0=Math.floor(1+Math.floor((d.length-n)/t));if(b!==null&&Y0<b)Y0=b;let E0=I?Math.floor(W0/2)+1:W0,X0=Y0,R0=Y0;if(S!==null)if(S>Y0){if(Q0)R0=S}else R0=X0=S;let C0=new Q.FFT(W0),x0=new Float64Array(W0),U0=new Float64Array(C0.outputBufferSize),u0=new Float32Array(E0*R0);for(let y0=0;y0<X0;++y0){let i0=y0*t,a0=Math.min(d.length-i0,n);if(a0!==n)x0.fill(0,0,n);for(let n0=0;n0<a0;++n0)x0[n0]=d[i0+n0];if(T0){let n0=0;for(let Q6=0;Q6<a0;++Q6)n0+=x0[Q6];let B6=n0/a0;for(let Q6=0;Q6<a0;++Q6)x0[Q6]-=B6}if(O!==null){for(let n0=a0-1;n0>=1;--n0)x0[n0]-=O*x0[n0-1];x0[0]*=1-O}for(let n0=0;n0<a.length;++n0)x0[n0]*=a[n0];C0.realTransform(U0,x0);for(let n0=0;n0<E0;++n0){let B6=n0<<1;u0[n0*R0+y0]=U0[B6]**2+U0[B6+1]**2}}if(o!==null&&o!==2){let y0=o/2;for(let i0=0;i0<u0.length;++i0)u0[i0]**=y0}let b0=Z0.length,s0=await(0,G.matmul)(new G.Tensor("float32",Z0.flat(),[b0,E0]),new G.Tensor("float32",u0,[E0,R0]));if(B0)s0=s0.transpose(1,0);let l0=s0.data;for(let y0=0;y0<l0.length;++y0)l0[y0]=I0+Math.max(z0,l0[y0]);if(o!==null&&A0!==null){let y0=Math.min(l0.length,X0*b0);switch(A0){case"log":for(let i0=0;i0<y0;++i0)l0[i0]=Math.log(l0[i0]);break;case"log10":for(let i0=0;i0<y0;++i0)l0[i0]=Math.log10(l0[i0]);break;case"dB":if(o===1)B(l0,j0,h0,d0);else if(o===2)F(l0,j0,h0,d0);else throw Error(`Cannot use log_mel option '${A0}' with power ${o}`);break;default:throw Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${A0}'`)}}return s0}function _(d,a,{periodic:n=!0,frame_length:t=null,center:W0=!0}={}){let o=n?d+1:d,N0;switch(a){case"boxcar":N0=new Float64Array(o).fill(1);break;case"hann":case"hann_window":N0=N(o);break;case"hamming":N0=z(o);break;case"povey":N0=N(o).map((w0)=>Math.pow(w0,0.85));break;default:throw Error(`Unknown window type ${a}.`)}if(n)N0=N0.subarray(0,d);if(t===null)return N0;if(d>t)throw Error(`Length of the window (${d}) may not be larger than frame_length (${t})`);return N0}function h(d,a){let n=44,t=new ArrayBuffer(n+d.length*4),W0=new DataView(t);c(W0,0,"RIFF"),W0.setUint32(4,36+d.length*4,!0),c(W0,8,"WAVE"),c(W0,12,"fmt "),W0.setUint32(16,16,!0),W0.setUint16(20,3,!0),W0.setUint16(22,1,!0),W0.setUint32(24,a,!0),W0.setUint32(28,a*4,!0),W0.setUint16(32,4,!0),W0.setUint16(34,32,!0),c(W0,36,"data"),W0.setUint32(40,d.length*4,!0);for(let o=0;o<d.length;++o,n+=4)W0.setFloat32(n,d[o],!0);return t}function c(d,a,n){for(let t=0;t<n.length;++t)d.setUint8(a+t,n.charCodeAt(t))}class m{constructor(d,a){this.audio=d,this.sampling_rate=a}toWav(){return h(this.audio,this.sampling_rate)}toBlob(){let d=this.toWav();return new Blob([d],{type:"audio/wav"})}async save(d){let a;if(H.apis.IS_BROWSER_ENV){if(H.apis.IS_WEBWORKER_ENV)throw Error("Unable to save a file from a Web Worker.");a=Y.saveBlob}else if(H.apis.IS_FS_AVAILABLE)a=async(n,t)=>{let W0=await t.arrayBuffer();q.default.writeFileSync(n,Buffer.from(W0))};else throw Error("Unable to save because filesystem is disabled in this environment.");await a(d,this.toBlob())}}},"./src/utils/constants.js":(J,Z,$)=>{/*!********************************!*\
  !*** ./src/utils/constants.js ***!
  \********************************/$.r(Z),$.d(Z,{CHAT_TEMPLATE_NAME:()=>q,CONFIG_NAME:()=>Q,FEATURE_EXTRACTOR_NAME:()=>Y,GENERATION_CONFIG_NAME:()=>E,GITHUB_ISSUE_URL:()=>W,IMAGE_PROCESSOR_NAME:()=>H,PROCESSOR_NAME:()=>G});let W="https://github.com/huggingface/transformers.js/issues/new/choose",Q="config.json",Y="preprocessor_config.json",H=Y,G="processor_config.json",q="chat_template.jinja",E="generation_config.json"},"./src/utils/core.js":(J,Z,$)=>{/*!***************************!*\
  !*** ./src/utils/core.js ***!
  \***************************/$.r(Z),$.d(Z,{calculateDimensions:()=>E,calculateReflectOffset:()=>w,count:()=>j,dispatchCallback:()=>W,escapeRegExp:()=>Y,isIntegralNumber:()=>G,isNullishDimension:()=>q,isTypedArray:()=>H,len:()=>D,mergeArrays:()=>N,pick:()=>y,pop:()=>V,product:()=>z,reverseDictionary:()=>Q,saveBlob:()=>R});function W(v,g){if(v)v(g)}function Q(v){return Object.fromEntries(Object.entries(v).map(([g,A])=>[A,g]))}function Y(v){return v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(v){return v?.prototype?.__proto__?.constructor?.name==="TypedArray"}function G(v){return Number.isInteger(v)||typeof v==="bigint"}function q(v){return v===null||v===void 0||v===-1}function E(v){let g=[],A=v;while(Array.isArray(A))g.push(A.length),A=A[0];return g}function V(v,g,A=void 0){let T=v[g];if(T!==void 0)return delete v[g],T;if(A===void 0)throw Error(`Key ${g} does not exist in object.`);return A}function N(...v){return Array.prototype.concat.apply([],v)}function z(...v){return v.reduce((g,A)=>g.flatMap((T)=>A.map((B)=>[T,B])))}function w(v,g){return Math.abs((v+g)%(2*g)-g)}function R(v,g){let A=URL.createObjectURL(g),T=document.createElement("a");T.href=A,T.download=v,T.click(),T.remove(),URL.revokeObjectURL(A)}function y(v,g){return Object.assign({},...g.map((A)=>{if(v[A]!==void 0)return{[A]:v[A]}}))}function D(v){let g=0;for(let A of v)++g;return g}function j(v,g){let A=0;for(let T of v)if(T===g)++A;return A}},"./src/utils/data-structures.js":(J,Z,$)=>{/*!**************************************!*\
  !*** ./src/utils/data-structures.js ***!
  \**************************************/$.r(Z),$.d(Z,{CharTrie:()=>Q,DictionarySplitter:()=>q,LRUCache:()=>E,PriorityQueue:()=>W,TokenLattice:()=>H});class W{constructor(V=(z,w)=>z>w,N=1/0){this._heap=[],this._comparator=V,this._maxSize=N}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...V){return this.extend(V)}extend(V){for(let N of V)if(this.size<this._maxSize)this._heap.push(N),this._siftUp();else{let z=this._smallest();if(this._comparator(N,this._heap[z]))this._heap[z]=N,this._siftUpFrom(z)}return this.size}pop(){let V=this.peek(),N=this.size-1;if(N>0)this._swap(0,N);return this._heap.pop(),this._siftDown(),V}replace(V){let N=this.peek();return this._heap[0]=V,this._siftDown(),N}_parent(V){return(V+1>>>1)-1}_left(V){return(V<<1)+1}_right(V){return V+1<<1}_greater(V,N){return this._comparator(this._heap[V],this._heap[N])}_swap(V,N){let z=this._heap[V];this._heap[V]=this._heap[N],this._heap[N]=z}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(V){while(V>0&&this._greater(V,this._parent(V)))this._swap(V,this._parent(V)),V=this._parent(V)}_siftDown(){let V=0;while(this._left(V)<this.size&&this._greater(this._left(V),V)||this._right(V)<this.size&&this._greater(this._right(V),V)){let N=this._right(V)<this.size&&this._greater(this._right(V),this._left(V))?this._right(V):this._left(V);this._swap(V,N),V=N}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class Q{constructor(){this.root=Y.default()}extend(V){for(let N of V)this.push(N)}push(V){let N=this.root;for(let z of V){let w=N.children.get(z);if(w===void 0)w=Y.default(),N.children.set(z,w);N=w}N.isLeaf=!0}*commonPrefixSearch(V){let N=this.root;if(N===void 0)return;let z="";for(let w of V){if(z+=w,N=N.children.get(w),N===void 0)return;if(N.isLeaf)yield z}}}class Y{constructor(V,N){this.isLeaf=V,this.children=N}static default(){return new Y(!1,new Map)}}class H{constructor(V,N,z){this.chars=Array.from(V),this.len=this.chars.length,this.bosTokenId=N,this.eosTokenId=z,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let w=new G(this.bosTokenId,0,0,0,0),R=new G(this.eosTokenId,1,this.len,0,0);this.nodes.push(w.clone()),this.nodes.push(R.clone()),this.beginNodes[this.len].push(R),this.endNodes[0].push(w)}insert(V,N,z,w){let R=this.nodes.length,y=new G(w,R,V,N,z);this.beginNodes[V].push(y),this.endNodes[V+N].push(y),this.nodes.push(y)}viterbi(){let V=this.len,N=0;while(N<=V){if(this.beginNodes[N].length==0)return[];for(let D of this.beginNodes[N]){D.prev=null;let j=0,v=null;for(let g of this.endNodes[N]){let A=g.backtraceScore+D.score;if(v===null||A>j)v=g.clone(),j=A}if(v!==null)D.prev=v,D.backtraceScore=j;else return[]}++N}let z=[],R=this.beginNodes[V][0].prev;if(R===null)return[];let y=R.clone();while(y.prev!==null)z.push(y.clone()),y=y.clone().prev.clone();return z.reverse(),z}piece(V){return this.chars.slice(V.pos,V.pos+V.length).join("")}tokens(){return this.viterbi().map((N)=>this.piece(N))}tokenIds(){return this.viterbi().map((N)=>N.tokenId)}}class G{constructor(V,N,z,w,R){this.tokenId=V,this.nodeId=N,this.pos=z,this.length=w,this.score=R,this.prev=null,this.backtraceScore=0}clone(){let V=new G(this.tokenId,this.nodeId,this.pos,this.length,this.score);return V.prev=this.prev,V.backtraceScore=this.backtraceScore,V}}class q{constructor(V){this.trie=this._buildTrie(V)}_buildTrie(V){let N=Object.create(null);for(let z of V){let w=N;for(let R=0;R<z.length;++R)w=w[z[R]]??=Object.create(null);w.end=z}return N}split(V){let N=[],z=V.length,w=0,R=0;while(R<z){let y=this.trie,D=null,j=R;while(j<z&&(y=y[V[j]])){if(y.end)D=y.end;++j}if(D){if(R>w)N.push(V.slice(w,R));N.push(D),R+=D.length,w=R}else++R}if(w<z)N.push(V.slice(w));return N}}class E{constructor(V){this.capacity=V,this.cache=new Map}get(V){if(!this.cache.has(V))return;let N=this.cache.get(V);return this.cache.delete(V),this.cache.set(V,N),N}put(V,N){if(this.cache.has(V))this.cache.delete(V);if(this.cache.set(V,N),this.cache.size>this.capacity)this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(J,Z,$)=>{/*!******************************!*\
  !*** ./src/utils/devices.js ***!
  \******************************/$.r(Z),$.d(Z,{DEVICE_TYPES:()=>W});let W=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(J,Z,$)=>{/*!*****************************!*\
  !*** ./src/utils/dtypes.js ***!
  \*****************************/$.r(Z),$.d(Z,{DATA_TYPES:()=>H,DEFAULT_DEVICE_DTYPE_MAPPING:()=>G,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>q,isWebGpuFp16Supported:()=>Y});var W=$("./src/env.js");/*! ../env.js */var Q=$("./src/utils/devices.js");/*! ./devices.js */let Y=function(){let E;return async function(){if(E===void 0)if(!W.apis.IS_WEBGPU_AVAILABLE)E=!1;else try{E=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch(V){E=!1}return E}}(),H=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),G=Object.freeze({[Q.DEVICE_TYPES.wasm]:H.q8}),q=Object.freeze({[H.fp32]:"",[H.fp16]:"_fp16",[H.int8]:"_int8",[H.uint8]:"_uint8",[H.q8]:"_quantized",[H.q4]:"_q4",[H.q4f16]:"_q4f16",[H.bnb4]:"_bnb4"})},"./src/utils/generic.js":(J,Z,$)=>{/*!******************************!*\
  !*** ./src/utils/generic.js ***!
  \******************************/$.r(Z),$.d(Z,{Callable:()=>W});let W=class{constructor(){let Q=function(...Y){return Q._call(...Y)};return Object.setPrototypeOf(Q,new.target.prototype)}_call(...Q){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(J,Z,$)=>{/*!**************************!*\
  !*** ./src/utils/hub.js ***!
  \**************************/$.r(Z),$.d(Z,{MAX_EXTERNAL_DATA_CHUNKS:()=>G,getFile:()=>w,getModelFile:()=>v,getModelJSON:()=>A,getModelText:()=>g});var W=$("node:fs");/*! node:fs */var Q=$("node:path");/*! node:path */var Y=$("./src/env.js");/*! ../env.js */var H=$("./src/utils/core.js");/*! ./core.js */let G=100,q={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class E{constructor(F){if(this.filePath=F,this.headers=new Headers,this.exists=W.default.existsSync(F),this.exists){this.status=200,this.statusText="OK";let P=W.default.statSync(F);this.headers.set("content-length",P.size.toString()),this.updateContentType();let _=W.default.createReadStream(F);this.body=new ReadableStream({start(h){_.on("data",(c)=>h.enqueue(c)),_.on("end",()=>h.close()),_.on("error",(c)=>h.error(c))},cancel(){_.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){let F=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",q[F]??"application/octet-stream")}clone(){let F=new E(this.filePath);return F.exists=this.exists,F.status=this.status,F.statusText=this.statusText,F.headers=new Headers(this.headers),F}async arrayBuffer(){return(await W.default.promises.readFile(this.filePath)).buffer}async blob(){let F=await W.default.promises.readFile(this.filePath);return new Blob([F],{type:this.headers.get("content-type")})}async text(){return await W.default.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function V(F,P=null,_=null){let h;try{h=new URL(F)}catch(c){return!1}if(P&&!P.includes(h.protocol))return!1;if(_&&!_.includes(h.hostname))return!1;return!0}let N=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function z(F){if(!N.test(F))return!1;if(F.includes("..")||F.includes("--"))return!1;if(F.endsWith(".git")||F.endsWith(".ipynb"))return!1;return!0}async function w(F){if(Y.env.useFS&&!V(F,["http:","https:","blob:"]))return new E(F instanceof URL?F.protocol==="file:"?F.pathname:F.toString():F);else if(typeof process<"u"&&process?.release?.name==="node"){let P=!!process.env?.TESTING_REMOTELY,_=Y.env.version,h=new Headers;if(h.set("User-Agent",`transformers.js/${_}; is_ci/${P};`),V(F,["http:","https:"],["huggingface.co","hf.co"])){let m=process.env?.HF_TOKEN??process.env?.HF_ACCESS_TOKEN;if(m)h.set("Authorization",`Bearer ${m}`)}return fetch(F,{headers:h})}else return fetch(F)}let R={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function y(F,P,_){if(!_)return null;let h=R[F]??`Error (${F}) occurred while trying to load file`;throw Error(`${h}: "${P}".`)}class D{constructor(F){this.path=F}async match(F){let P=Q.default.join(this.path,F),_=new E(P);if(_.exists)return _;else return}async put(F,P,_=void 0){let h=Q.default.join(this.path,F);try{let c=P.headers.get("Content-Length"),m=parseInt(c??"0"),d=0;await W.default.promises.mkdir(Q.default.dirname(h),{recursive:!0});let a=W.default.createWriteStream(h),n=P.body.getReader();while(!0){let{done:t,value:W0}=await n.read();if(t)break;await new Promise((N0,w0)=>{a.write(W0,(I)=>{if(I){w0(I);return}N0()})}),d+=W0.length;let o=m?d/m*100:0;_?.({progress:o,loaded:d,total:m})}a.close()}catch(c){try{await W.default.promises.unlink(h)}catch{}throw c}}}async function j(F,...P){for(let _ of P)try{let h=await F.match(_);if(h)return h}catch(h){continue}return}async function v(F,P,_=!0,h={},c=!1){if(!Y.env.allowLocalModels){if(h.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");else if(!Y.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,H.dispatchCallback)(h.progress_callback,{status:"initiate",name:F,file:P});let m;if(!m&&Y.env.useCustomCache){if(!Y.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!Y.env.customCache.match||!Y.env.customCache.put)throw Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");m=Y.env.customCache}if(!m&&Y.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{m=await caches.open("transformers-cache")}catch(z0){console.warn("An error occurred while opening the browser cache:",z0)}}if(!m&&Y.env.useFSCache){if(!Y.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");m=new D(h.cache_dir??Y.env.cacheDir)}let d=h.revision??"main",a=B(F,P),n=z(F),t=n?B(Y.env.localModelPath,a):a,W0=B(Y.env.remoteHost,Y.env.remotePathTemplate.replaceAll("{model}",F).replaceAll("{revision}",encodeURIComponent(d)),P),o,N0=m instanceof D?d==="main"?a:B(F,d,P):W0,w0=!1,I;if(m)I=await j(m,t,N0);let O=I!==void 0;if(I===void 0){if(Y.env.allowLocalModels){if(!V(a,["http:","https:"]))try{I=await w(t),o=t}catch(A0){console.warn(`Unable to load from local path "${t}": "${A0}"`)}else if(h.local_files_only)throw Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${a}.`);else if(!Y.env.allowRemoteModels)throw Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${a}.`)}if(I===void 0||I.status===404){if(h.local_files_only||!Y.env.allowRemoteModels)if(_)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${t}".`);else return null;if(!n)throw Error(`Local file missing at "${t}" and download aborted due to invalid model ID "${F}".`);if(I=await w(W0),I.status!==200)return y(I.status,W0,_);o=N0}w0=m&&typeof Response<"u"&&I instanceof Response&&I.status===200}(0,H.dispatchCallback)(h.progress_callback,{status:"download",name:F,file:P});let p;if(!(Y.apis.IS_NODE_ENV&&c)){let z0;if(!h.progress_callback)z0=new Uint8Array(await I.arrayBuffer());else if(O&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent))z0=new Uint8Array(await I.arrayBuffer()),(0,H.dispatchCallback)(h.progress_callback,{status:"progress",name:F,file:P,progress:100,loaded:z0.length,total:z0.length});else z0=await T(I,(A0)=>{(0,H.dispatchCallback)(h.progress_callback,{status:"progress",name:F,file:P,...A0})});p=z0}if(w0&&o&&await m.match(o)===void 0)if(!p){let z0=h.progress_callback?(A0)=>(0,H.dispatchCallback)(h.progress_callback,{status:"progress",name:F,file:P,...A0}):void 0;await m.put(o,I,z0)}else await m.put(o,new Response(p,{headers:I.headers})).catch((z0)=>{console.warn(`Unable to add response to browser cache: ${z0}.`)});if((0,H.dispatchCallback)(h.progress_callback,{status:"done",name:F,file:P}),p){if(!Y.apis.IS_NODE_ENV&&c)throw Error("Cannot return path in a browser environment.");return p}if(I instanceof E)return I.filePath;let Z0=await m?.match(o);if(Z0 instanceof E)return Z0.filePath;else if(Z0 instanceof Response)return new Uint8Array(await Z0.arrayBuffer());else if(typeof Z0==="string")return Z0;throw Error("Unable to get model file path or buffer.")}async function g(F,P,_=!0,h={}){let c=await v(F,P,_,h,!1);if(c===null)return null;return new TextDecoder("utf-8").decode(c)}async function A(F,P,_=!0,h={}){let c=await g(F,P,_,h);if(c===null)return{};return JSON.parse(c)}async function T(F,P){let _=F.headers.get("Content-Length");if(_===null)console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let h=parseInt(_??"0"),c=new Uint8Array(h),m=0,d=F.body.getReader();async function a(){let{done:n,value:t}=await d.read();if(n)return;let W0=m+t.length;if(W0>h){h=W0;let N0=new Uint8Array(h);N0.set(c),c=N0}c.set(t,m),m=W0;let o=m/h*100;return P({progress:o,loaded:m,total:h}),a()}return await a(),c}function B(...F){return F=F.map((P,_)=>{if(_)P=P.replace(new RegExp("^/"),"");if(_!==F.length-1)P=P.replace(new RegExp("/$"),"");return P}),F.join("/")}},"./src/utils/image.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/image.js ***!
  \****************************/$.r(Z),$.d(Z,{RawImage:()=>R,load_image:()=>y});var W=$("./src/utils/core.js");/*! ./core.js */var Q=$("./src/utils/hub.js");/*! ./hub.js */var Y=$("./src/env.js");/*! ../env.js */var H=$("./src/utils/tensor.js");/*! ./tensor.js */var G=$("sharp");/*! sharp */let q,E,V,N=Y.apis.IS_BROWSER_ENV||Y.apis.IS_WEBWORKER_ENV;if(N)q=(D,j)=>{if(!self.OffscreenCanvas)throw Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(D,j)},V=self.createImageBitmap,E=self.ImageData;else if(G.default)V=async(D)=>{let v=(await D.metadata()).channels,{data:g,info:A}=await D.rotate().raw().toBuffer({resolveWithObject:!0}),T=new R(new Uint8ClampedArray(g),A.width,A.height,A.channels);if(v!==void 0&&v!==A.channels)T.convert(v);return T};else throw Error("Unable to load image processing library.");let z={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},w=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class R{constructor(D,j,v,g){this.data=D,this.width=j,this.height=v,this.channels=g}get size(){return[this.width,this.height]}static async read(D){if(D instanceof R)return D;else if(typeof D==="string"||D instanceof URL)return await this.fromURL(D);else if(D instanceof Blob)return await this.fromBlob(D);else if(typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&D instanceof OffscreenCanvas)return this.fromCanvas(D);else throw Error(`Unsupported input type: ${typeof D}`)}static fromCanvas(D){if(!N)throw Error("fromCanvas() is only supported in browser environments.");let v=D.getContext("2d").getImageData(0,0,D.width,D.height).data;return new R(v,D.width,D.height,4)}static async fromURL(D){let j=await(0,Q.getFile)(D);if(j.status!==200)throw Error(`Unable to read image from "${D}" (${j.status} ${j.statusText})`);let v=await j.blob();return this.fromBlob(v)}static async fromBlob(D){if(N){let j=await V(D),v=q(j.width,j.height).getContext("2d");return v.drawImage(j,0,0),new this(v.getImageData(0,0,j.width,j.height).data,j.width,j.height,4)}else{let j=(0,G.default)(await D.arrayBuffer());return await V(j)}}static fromTensor(D,j="CHW"){if(D.dims.length!==3)throw Error(`Tensor should have 3 dimensions, but has ${D.dims.length} dimensions.`);if(j==="CHW")D=D.transpose(1,2,0);else if(j==="HWC");else throw Error(`Unsupported channel format: ${j}`);if(!(D.data instanceof Uint8ClampedArray||D.data instanceof Uint8Array))throw Error(`Unsupported tensor type: ${D.type}`);switch(D.dims[2]){case 1:case 2:case 3:case 4:return new R(D.data,D.dims[1],D.dims[0],D.dims[2]);default:throw Error(`Unsupported number of channels: ${D.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let D=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let j=0,v=0;j<this.data.length;j+=this.channels){let g=this.data[j],A=this.data[j+1],T=this.data[j+2];D[v++]=Math.round(0.2989*g+0.587*A+0.114*T)}break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(D,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let D=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let j=0,v=0;j<this.data.length;++j)D[v++]=this.data[j],D[v++]=this.data[j],D[v++]=this.data[j];break;case 4:for(let j=0,v=0;j<this.data.length;j+=4)D[v++]=this.data[j],D[v++]=this.data[j+1],D[v++]=this.data[j+2];break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(D,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let D=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let j=0,v=0;j<this.data.length;++j)D[v++]=this.data[j],D[v++]=this.data[j],D[v++]=this.data[j],D[v++]=255;break;case 3:for(let j=0,v=0;j<this.data.length;j+=3)D[v++]=this.data[j],D[v++]=this.data[j+1],D[v++]=this.data[j+2],D[v++]=255;break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(D,this.width,this.height,4)}putAlpha(D){if(D.width!==this.width||D.height!==this.height)throw Error(`Expected mask size to be ${this.width}x${this.height}, but got ${D.width}x${D.height}`);if(D.channels!==1)throw Error(`Expected mask to have 1 channel, but got ${D.channels}`);let j=this.data,v=D.data,g=this.width*this.height;if(this.channels===3){let A=new Uint8ClampedArray(g*4);for(let T=0,B=0,F=0;T<g;++T)A[F++]=j[B++],A[F++]=j[B++],A[F++]=j[B++],A[F++]=v[T];return this._update(A,this.width,this.height,4)}else if(this.channels===4){for(let A=0;A<g;++A)j[4*A+3]=v[A];return this}throw Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(D,j,{resample:v=2}={}){if(this.width===D&&this.height===j)return this;let g=z[v]??v,A=(0,W.isNullishDimension)(D),T=(0,W.isNullishDimension)(j);if(A&&T)return this;else if(A)D=j/this.height*this.width;else if(T)j=D/this.width*this.height;if(N){let B=this.channels,F=this.toCanvas(),P=q(D,j).getContext("2d");return P.drawImage(F,0,0,D,j),new R(P.getImageData(0,0,D,j).data,D,j,4).convert(B)}else{let B=this.toSharp();switch(g){case"box":case"hamming":if(g==="box"||g==="hamming")console.warn(`Resampling method ${g} is not yet supported. Using bilinear instead.`),g="bilinear";case"nearest":case"bilinear":case"bicubic":B=B.affine([D/this.width,0,0,j/this.height],{interpolator:g});break;case"lanczos":B=B.resize({width:D,height:j,fit:"fill",kernel:"lanczos3"});break;default:throw Error(`Resampling method ${g} is not supported.`)}return await V(B)}}async pad([D,j,v,g]){if(D=Math.max(D,0),j=Math.max(j,0),v=Math.max(v,0),g=Math.max(g,0),D===0&&j===0&&v===0&&g===0)return this;if(N){let A=this.channels,T=this.toCanvas(),B=this.width+D+j,F=this.height+v+g,P=q(B,F).getContext("2d");return P.drawImage(T,0,0,this.width,this.height,D,v,this.width,this.height),new R(P.getImageData(0,0,B,F).data,B,F,4).convert(A)}else{let A=this.toSharp().extend({left:D,right:j,top:v,bottom:g});return await V(A)}}async crop([D,j,v,g]){if(D=Math.max(D,0),j=Math.max(j,0),v=Math.min(v,this.width-1),g=Math.min(g,this.height-1),D===0&&j===0&&v===this.width-1&&g===this.height-1)return this;let A=v-D+1,T=g-j+1;if(N){let B=this.channels,F=this.toCanvas(),P=q(A,T).getContext("2d");return P.drawImage(F,D,j,A,T,0,0,A,T),new R(P.getImageData(0,0,A,T).data,A,T,4).convert(B)}else{let B=this.toSharp().extract({left:D,top:j,width:A,height:T});return await V(B)}}async center_crop(D,j){if(this.width===D&&this.height===j)return this;let v=(this.width-D)/2,g=(this.height-j)/2;if(N){let A=this.channels,T=this.toCanvas(),B=q(D,j).getContext("2d"),F=0,P=0,_=0,h=0;if(v>=0)F=v;else _=-v;if(g>=0)P=g;else h=-g;return B.drawImage(T,F,P,D,j,_,h,D,j),new R(B.getImageData(0,0,D,j).data,D,j,4).convert(A)}else{let A=this.toSharp();if(v>=0&&g>=0)A=A.extract({left:Math.floor(v),top:Math.floor(g),width:D,height:j});else if(v<=0&&g<=0){let T=Math.floor(-g),B=Math.floor(-v);A=A.extend({top:T,left:B,right:D-this.width-B,bottom:j-this.height-T})}else{let T=[0,0],B=0;if(g<0)T[0]=Math.floor(-g),T[1]=j-this.height-T[0];else B=Math.floor(g);let F=[0,0],P=0;if(v<0)F[0]=Math.floor(-v),F[1]=D-this.width-F[0];else P=Math.floor(v);A=A.extend({top:T[0],bottom:T[1],left:F[0],right:F[1]}).extract({left:P,top:B,width:D,height:j})}return await V(A)}}async toBlob(D="image/png",j=1){if(!N)throw Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:D,quality:j})}toTensor(D="CHW"){let j=new H.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(D==="HWC");else if(D==="CHW")j=j.permute(2,0,1);else throw Error(`Unsupported channel format: ${D}`);return j}toCanvas(){if(!N)throw Error("toCanvas() is only supported in browser environments.");let D=this.clone().rgba(),j=q(D.width,D.height),v=new E(D.data,D.width,D.height);return j.getContext("2d").putImageData(v,0,0),j}split(){let{data:D,width:j,height:v,channels:g}=this,A=D.constructor,T=D.length/g,B=Array.from({length:g},()=>new A(T));for(let F=0;F<T;++F){let P=g*F;for(let _=0;_<g;++_)B[_][F]=D[P+_]}return B.map((F)=>new R(F,j,v,1))}_update(D,j,v,g=null){if(this.data=D,this.width=j,this.height=v,g!==null)this.channels=g;return this}clone(){return new R(this.data.slice(),this.width,this.height,this.channels)}convert(D){if(this.channels===D)return this;switch(D){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(D){if(N){if(Y.apis.IS_WEBWORKER_ENV)throw Error("Unable to save an image from a Web Worker.");let j=D.split(".").pop().toLowerCase(),v=w.get(j)??"image/png",g=await this.toBlob(v);(0,W.saveBlob)(D,g)}else if(!Y.apis.IS_FS_AVAILABLE)throw Error("Unable to save the image because filesystem is disabled in this environment.");else return await this.toSharp().toFile(D)}toSharp(){if(N)throw Error("toSharp() is only supported in server-side environments.");return(0,G.default)(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}let y=R.read.bind(R)},"./src/utils/maths.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/maths.js ***!
  \****************************/$.r(Z),$.d(Z,{FFT:()=>y,bankers_round:()=>v,cos_sim:()=>q,dot:()=>G,dynamic_time_warping:()=>g,interpolate_data:()=>W,log_softmax:()=>H,magnitude:()=>E,max:()=>N,medianFilter:()=>D,min:()=>V,permute_data:()=>Q,round:()=>j,softmax:()=>Y});function W(A,[T,B,F],[P,_],h="bilinear",c=!1){let m=_/F,d=P/B,a=new A.constructor(P*_*T),n=B*F,t=P*_;for(let W0=0;W0<P;++W0)for(let o=0;o<_;++o){let N0=W0*_+o,w0=(o+0.5)/m-0.5,I=(W0+0.5)/d-0.5,O=Math.floor(w0),p=Math.floor(I),Z0=Math.min(O+1,F-1),z0=Math.min(p+1,B-1);O=Math.max(O,0),p=Math.max(p,0);let A0=w0-O,j0=I-p,h0=(1-A0)*(1-j0),d0=A0*(1-j0),T0=(1-A0)*j0,b=A0*j0,S=p*F,Q0=z0*F,B0=S+O,I0=S+Z0,F0=Q0+O,Y0=Q0+Z0;for(let E0=0;E0<T;++E0){let X0=E0*n;a[E0*t+N0]=h0*A[X0+B0]+d0*A[X0+I0]+T0*A[X0+F0]+b*A[X0+Y0]}}return a}function Q(A,T,B){let F=Array(B.length),P=Array(B.length);for(let c=B.length-1,m=1;c>=0;--c)P[c]=m,F[c]=T[B[c]],m*=F[c];let _=B.map((c,m)=>P[B.indexOf(m)]),h=new A.constructor(A.length);for(let c=0;c<A.length;++c){let m=0;for(let d=T.length-1,a=c;d>=0;--d)m+=a%T[d]*_[d],a=Math.floor(a/T[d]);h[m]=A[c]}return[h,F]}function Y(A){let T=N(A)[0],B=A.map((_)=>Math.exp(_-T)),F=B.reduce((_,h)=>_+h,0);return B.map((_)=>_/F)}function H(A){let T=N(A)[0],B=0;for(let _=0;_<A.length;++_)B+=Math.exp(A[_]-T);let F=Math.log(B);return A.map((_)=>_-T-F)}function G(A,T){let B=0;for(let F=0;F<A.length;++F)B+=A[F]*T[F];return B}function q(A,T){let B=G(A,T),F=E(A),P=E(T);return B/(F*P)}function E(A){return Math.sqrt(A.reduce((T,B)=>T+B*B,0))}function V(A){if(A.length===0)throw Error("Array must not be empty");let T=A[0],B=0;for(let F=1;F<A.length;++F)if(A[F]<T)T=A[F],B=F;return[T,B]}function N(A){if(A.length===0)throw Error("Array must not be empty");let T=A[0],B=0;for(let F=1;F<A.length;++F)if(A[F]>T)T=A[F],B=F;return[T,B]}function z(A){return A>0&&(A&A-1)===0}class w{constructor(A){if(this.size=A|0,this.size<=1||!z(this.size))throw Error("FFT size must be a power of two larger than 1");this._csize=A<<1,this.table=new Float64Array(this.size*2);for(let B=0;B<this.table.length;B+=2){let F=Math.PI*B/this.size;this.table[B]=Math.cos(F),this.table[B+1]=-Math.sin(F)}let T=0;for(let B=1;this.size>B;B<<=1)++T;this._width=T%2===0?T-1:T,this._bitrev=new Int32Array(1<<this._width);for(let B=0;B<this._bitrev.length;++B){this._bitrev[B]=0;for(let F=0;F<this._width;F+=2){let P=this._width-F-2;this._bitrev[B]|=(B>>>F&3)<<P}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(A,T){let B=T||Array(A.length>>>1);for(let F=0;F<A.length;F+=2)B[F>>>1]=A[F];return B}toComplexArray(A,T){let B=T||this.createComplexArray();for(let F=0;F<B.length;F+=2)B[F]=A[F>>>1],B[F+1]=0;return B}transform(A,T){if(A===T)throw Error("Input and output buffers must be different");this._transform4(A,T,1)}realTransform(A,T){if(A===T)throw Error("Input and output buffers must be different");this._realTransform4(A,T,1)}inverseTransform(A,T){if(A===T)throw Error("Input and output buffers must be different");this._transform4(A,T,-1);for(let B=0;B<A.length;++B)A[B]/=this.size}_transform4(A,T,B){let F=this._csize,_=1<<this._width,h=F/_<<1,c,m,d=this._bitrev;if(h===4)for(c=0,m=0;c<F;c+=h,++m){let n=d[m];this._singleTransform2(T,A,c,n,_)}else for(c=0,m=0;c<F;c+=h,++m){let n=d[m];this._singleTransform4(T,A,c,n,_,B)}let a=this.table;for(_>>=2;_>=2;_>>=2){h=F/_<<1;let n=h>>>2;for(c=0;c<F;c+=h){let t=c+n-1;for(let W0=c,o=0;W0<t;W0+=2,o+=_){let N0=W0,w0=N0+n,I=w0+n,O=I+n,p=A[N0],Z0=A[N0+1],z0=A[w0],A0=A[w0+1],j0=A[I],h0=A[I+1],d0=A[O],T0=A[O+1],b=a[o],S=B*a[o+1],Q0=z0*b-A0*S,B0=z0*S+A0*b,I0=a[2*o],F0=B*a[2*o+1],Y0=j0*I0-h0*F0,E0=j0*F0+h0*I0,X0=a[3*o],R0=B*a[3*o+1],C0=d0*X0-T0*R0,x0=d0*R0+T0*X0,U0=p+Y0,u0=Z0+E0,b0=p-Y0,s0=Z0-E0,l0=Q0+C0,y0=B0+x0,i0=B*(Q0-C0),a0=B*(B0-x0);A[N0]=U0+l0,A[N0+1]=u0+y0,A[w0]=b0+a0,A[w0+1]=s0-i0,A[I]=U0-l0,A[I+1]=u0-y0,A[O]=b0-a0,A[O+1]=s0+i0}}}}_singleTransform2(A,T,B,F,P){let _=A[F],h=A[F+1],c=A[F+P],m=A[F+P+1];T[B]=_+c,T[B+1]=h+m,T[B+2]=_-c,T[B+3]=h-m}_singleTransform4(A,T,B,F,P,_){let h=P*2,c=P*3,m=A[F],d=A[F+1],a=A[F+P],n=A[F+P+1],t=A[F+h],W0=A[F+h+1],o=A[F+c],N0=A[F+c+1],w0=m+t,I=d+W0,O=m-t,p=d-W0,Z0=a+o,z0=n+N0,A0=_*(a-o),j0=_*(n-N0);T[B]=w0+Z0,T[B+1]=I+z0,T[B+2]=O+j0,T[B+3]=p-A0,T[B+4]=w0-Z0,T[B+5]=I-z0,T[B+6]=O-j0,T[B+7]=p+A0}_realTransform4(A,T,B){let F=this._csize,_=1<<this._width,h=F/_<<1,c,m,d=this._bitrev;if(h===4)for(c=0,m=0;c<F;c+=h,++m){let t=d[m];this._singleRealTransform2(T,A,c,t>>>1,_>>>1)}else for(c=0,m=0;c<F;c+=h,++m){let t=d[m];this._singleRealTransform4(T,A,c,t>>>1,_>>>1,B)}let a=this.table;for(_>>=2;_>=2;_>>=2){h=F/_<<1;let t=h>>>1,W0=t>>>1,o=W0>>>1;for(c=0;c<F;c+=h)for(let N0=0,w0=0;N0<=o;N0+=2,w0+=_){let I=c+N0,O=I+W0,p=O+W0,Z0=p+W0,z0=A[I],A0=A[I+1],j0=A[O],h0=A[O+1],d0=A[p],T0=A[p+1],b=A[Z0],S=A[Z0+1],Q0=z0,B0=A0,I0=a[w0],F0=B*a[w0+1],Y0=j0*I0-h0*F0,E0=j0*F0+h0*I0,X0=a[2*w0],R0=B*a[2*w0+1],C0=d0*X0-T0*R0,x0=d0*R0+T0*X0,U0=a[3*w0],u0=B*a[3*w0+1],b0=b*U0-S*u0,s0=b*u0+S*U0,l0=Q0+C0,y0=B0+x0,i0=Q0-C0,a0=B0-x0,n0=Y0+b0,B6=E0+s0,Q6=B*(Y0-b0),a6=B*(E0-s0);if(A[I]=l0+n0,A[I+1]=y0+B6,A[O]=i0+a6,A[O+1]=a0-Q6,N0===0){A[p]=l0-n0,A[p+1]=y0-B6;continue}if(N0===o)continue;let H4=c+W0-N0,U4=c+t-N0;A[H4]=i0-B*a6,A[H4+1]=-a0-B*Q6,A[U4]=l0-B*n0,A[U4+1]=-y0+B*B6}}let n=F>>>1;for(let t=2;t<n;t+=2)A[F-t]=A[t],A[F-t+1]=-A[t+1]}_singleRealTransform2(A,T,B,F,P){let _=A[F],h=A[F+P];T[B]=_+h,T[B+1]=0,T[B+2]=_-h,T[B+3]=0}_singleRealTransform4(A,T,B,F,P,_){let h=P*2,c=P*3,m=A[F],d=A[F+P],a=A[F+h],n=A[F+c],t=m+a,W0=m-a,o=d+n,N0=_*(d-n);T[B]=t+o,T[B+1]=0,T[B+2]=W0,T[B+3]=-N0,T[B+4]=t-o,T[B+5]=0,T[B+6]=W0,T[B+7]=N0}}class R{constructor(A){let T=2*(A-1),B=2*(2*A-1),F=2**Math.ceil(Math.log2(B));this.bufferSize=F,this._a=T;let P=new Float64Array(B),_=new Float64Array(F);this._chirpBuffer=new Float64Array(F),this._buffer1=new Float64Array(F),this._buffer2=new Float64Array(F),this._outBuffer1=new Float64Array(F),this._outBuffer2=new Float64Array(F);let h=-2*Math.PI/A,c=Math.cos(h),m=Math.sin(h);for(let d=0;d<B>>1;++d){let a=(d+1-A)**2/2,n=Math.sqrt(c**2+m**2)**a,t=a*Math.atan2(m,c),W0=2*d;P[W0]=n*Math.cos(t),P[W0+1]=n*Math.sin(t),_[W0]=P[W0],_[W0+1]=-P[W0+1]}this._slicedChirpBuffer=P.subarray(T,B),this._f=new w(F>>1),this._f.transform(this._chirpBuffer,_)}_transform(A,T,B){let F=this._buffer1,P=this._buffer2,_=this._outBuffer1,h=this._outBuffer2,c=this._chirpBuffer,m=this._slicedChirpBuffer,d=this._a;if(B)for(let a=0;a<m.length;a+=2){let n=a+1,t=a>>1,W0=T[t];F[a]=W0*m[a],F[n]=W0*m[n]}else for(let a=0;a<m.length;a+=2){let n=a+1;F[a]=T[a]*m[a]-T[n]*m[n],F[n]=T[a]*m[n]+T[n]*m[a]}this._f.transform(_,F);for(let a=0;a<c.length;a+=2){let n=a+1;P[a]=_[a]*c[a]-_[n]*c[n],P[n]=_[a]*c[n]+_[n]*c[a]}this._f.inverseTransform(h,P);for(let a=0;a<h.length;a+=2){let n=h[a+d],t=h[a+d+1],W0=m[a],o=m[a+1];A[a]=n*W0-t*o,A[a+1]=n*o+t*W0}}transform(A,T){this._transform(A,T,!1)}realTransform(A,T){this._transform(A,T,!0)}}class y{constructor(A){if(this.fft_length=A,this.isPowerOfTwo=z(A),this.isPowerOfTwo)this.fft=new w(A),this.outputBufferSize=2*A;else this.fft=new R(A),this.outputBufferSize=this.fft.bufferSize}realTransform(A,T){this.fft.realTransform(A,T)}transform(A,T){this.fft.transform(A,T)}}function D(A,T){if(T%2===0||T<=0)throw Error("Window size must be a positive odd number");let B=new A.constructor(A.length),F=new A.constructor(T),P=Math.floor(T/2);for(let _=0;_<A.length;++_){let h=0;for(let c=-P;c<=P;++c){let m=_+c;if(m<0)m=Math.abs(m);else if(m>=A.length)m=2*(A.length-1)-m;F[h++]=A[m]}F.sort(),B[_]=F[P]}return B}function j(A,T){let B=Math.pow(10,T);return Math.round(A*B)/B}function v(A){let T=Math.round(A);return Math.abs(A)%1===0.5?T%2===0?T:T-1:T}function g(A){let T=A.length,B=A[0].length,F=[T+1,B+1],P=Array.from({length:F[0]},()=>Array(F[1]).fill(1/0));P[0][0]=0;let _=Array.from({length:F[0]},()=>Array(F[1]).fill(-1));for(let a=1;a<F[1];++a)for(let n=1;n<F[0];++n){let t=P[n-1][a-1],W0=P[n-1][a],o=P[n][a-1],N0,w0;if(t<W0&&t<o)N0=t,w0=0;else if(W0<t&&W0<o)N0=W0,w0=1;else N0=o,w0=2;P[n][a]=A[n-1][a-1]+N0,_[n][a]=w0}for(let a=0;a<F[1];++a)_[0][a]=2;for(let a=0;a<F[0];++a)_[a][0]=1;let h=T,c=B,m=[],d=[];while(h>0||c>0)switch(m.push(h-1),d.push(c-1),_[h][c]){case 0:--h,--c;break;case 1:--h;break;case 2:--c;break;default:throw Error(`Internal error in dynamic time warping. Unexpected trace[${h}, ${c}]. Please file a bug report.`)}return m.reverse(),d.reverse(),[m,d]}},"./src/utils/tensor.js":(J,Z,$)=>{/*!*****************************!*\
  !*** ./src/utils/tensor.js ***!
  \*****************************/$.r(Z),$.d(Z,{DataTypeMap:()=>H,Tensor:()=>G,cat:()=>B,full:()=>d,full_like:()=>a,interpolate:()=>V,interpolate_4d:()=>N,layer_norm:()=>v,matmul:()=>z,mean:()=>h,mean_pooling:()=>j,ones:()=>n,ones_like:()=>t,permute:()=>E,quantize_embeddings:()=>w0,rand:()=>N0,rfft:()=>w,slice:()=>D,stack:()=>F,std_mean:()=>_,topk:()=>R,zeros:()=>W0,zeros_like:()=>o});var W=$("./src/utils/maths.js");/*! ./maths.js */var Q=$("./src/backends/onnx.js");/*! ../backends/onnx.js */var Y=$("./src/ops/registry.js");/*! ../ops/registry.js */let H=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class G{get dims(){return this.ort_tensor.dims}set dims(I){this.ort_tensor.dims=I}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...I){if((0,Q.isONNXTensor)(I[0]))this.ort_tensor=I[0];else this.ort_tensor=new Q.Tensor(I[0],I[1],I[2]);return new Proxy(this,{get:(O,p)=>{if(typeof p==="string"){let Z0=Number(p);if(Number.isInteger(Z0))return O._getitem(Z0)}return O[p]},set:(O,p,Z0)=>{return O[p]=Z0}})}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){let[I,...O]=this.dims;if(O.length>0){let p=O.reduce((Z0,z0)=>Z0*z0);for(let Z0=0;Z0<I;++Z0)yield this._subarray(Z0,p,O)}else yield*this.data}_getitem(I){let[O,...p]=this.dims;if(I=T(I,O),p.length>0){let Z0=p.reduce((z0,A0)=>z0*A0);return this._subarray(I,Z0,p)}else return new G(this.type,[this.data[I]],p)}indexOf(I){let O=this.data;for(let p=0;p<O.length;++p)if(O[p]==I)return p;return-1}_subarray(I,O,p){let Z0=I*O,z0=(I+1)*O,A0="subarray"in this.data?this.data.subarray(Z0,z0):this.data.slice(Z0,z0);return new G(this.type,A0,p)}item(){let I=this.data;if(I.length!==1)throw Error(`a Tensor with ${I.length} elements cannot be converted to Scalar`);return I[0]}tolist(){return q(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){let I=this.data;for(let O=0;O<I.length;++O)I[O]=1/(1+Math.exp(-I[O]));return this}map(I){return this.clone().map_(I)}map_(I){let O=this.data;for(let p=0;p<O.length;++p)O[p]=I(O[p],p,O);return this}mul(I){return this.clone().mul_(I)}mul_(I){let O=this.data;for(let p=0;p<O.length;++p)O[p]*=I;return this}div(I){return this.clone().div_(I)}div_(I){let O=this.data;for(let p=0;p<O.length;++p)O[p]/=I;return this}add(I){return this.clone().add_(I)}add_(I){let O=this.data;for(let p=0;p<O.length;++p)O[p]+=I;return this}sub(I){return this.clone().sub_(I)}sub_(I){let O=this.data;for(let p=0;p<O.length;++p)O[p]-=I;return this}clone(){return new G(this.type,this.data.slice(),this.dims.slice())}slice(...I){let O=[],p=[];for(let T0=0;T0<this.dims.length;++T0){let b=I[T0];if(b===null||b===void 0)p.push([0,this.dims[T0]]),O.push(this.dims[T0]);else if(typeof b==="number")b=T(b,this.dims[T0],T0),p.push([b,b+1]);else if(Array.isArray(b)&&b.length===2){let[S,Q0]=b;if(S=S===null?0:T(S,this.dims[T0],T0,!1),Q0=Q0===null?this.dims[T0]:T(Q0,this.dims[T0],T0,!1),S>Q0)throw Error(`Invalid slice: ${b}`);let B0=[Math.max(S,0),Math.min(Q0,this.dims[T0])];p.push(B0),O.push(B0[1]-B0[0])}else throw Error(`Invalid slice: ${b}`)}let Z0=p.map(([T0,b])=>b-T0),z0=Z0.reduce((T0,b)=>T0*b),A0=this.data,j0=new A0.constructor(z0),h0=this.stride(),d0=!0;for(let T0=1;T0<Z0.length;++T0)if(p[T0][0]!==0||p[T0][1]!==this.dims[T0]){d0=!1;break}if(d0){let T0=p[0][0]*h0[0],b=p[0][1]*h0[0];if(ArrayBuffer.isView(A0))j0.set(A0.subarray(T0,b));else if(Array.isArray(A0)){let S=A0.slice(T0,b);for(let Q0=0;Q0<S.length;++Q0)j0[Q0]=S[Q0]}else throw Error("Unsupported data type for slicing")}else for(let T0=0;T0<z0;++T0){let b=0;for(let S=Z0.length-1,Q0=T0;S>=0;--S){let B0=Z0[S];b+=(Q0%B0+p[S][0])*h0[S],Q0=Math.floor(Q0/B0)}j0[T0]=A0[b]}return new G(this.type,j0,O)}permute(...I){return E(this,I)}transpose(...I){return this.permute(...I)}sum(I=null,O=!1){return this.norm(1,I,O)}norm(I="fro",O=null,p=!1){if(I==="fro")I=2;else if(typeof I==="string")throw Error(`Unsupported norm: ${I}`);let Z0=this.data,z0=(d0,T0)=>d0+T0**I;if(O===null){let d0=Z0.reduce(z0,0)**(1/I);return new G(this.type,[d0],[])}let[A0,j0,h0]=P(z0,this,O,p);if(I!==1)for(let d0=0;d0<j0.length;++d0)j0[d0]=j0[d0]**(1/I);return new G(A0,j0,h0)}normalize_(I=2,O=1){O=T(O,this.dims.length);let p=this.norm(I,O,!0),Z0=this.data,z0=p.data;for(let A0=0;A0<Z0.length;++A0){let j0=0;for(let h0=this.dims.length-1,d0=A0,T0=1;h0>=0;--h0){let b=this.dims[h0];if(h0!==O){let S=d0%b;j0+=S*T0,T0*=this.dims[h0]}d0=Math.floor(d0/b)}Z0[A0]/=z0[j0]}return this}normalize(I=2,O=1){return this.clone().normalize_(I,O)}stride(){return c(this.dims)}squeeze(I=null){return new G(this.type,this.data,g(this.dims,I))}squeeze_(I=null){return this.dims=g(this.dims,I),this}unsqueeze(I=null){return new G(this.type,this.data,A(this.dims,I))}unsqueeze_(I=null){return this.dims=A(this.dims,I),this}flatten_(I=0,O=-1){O=(O+this.dims.length)%this.dims.length;let p=this.dims.slice(0,I),Z0=this.dims.slice(I,O+1),z0=this.dims.slice(O+1);return this.dims=[...p,Z0.reduce((A0,j0)=>A0*j0,1),...z0],this}flatten(I=0,O=-1){return this.clone().flatten_(I,O)}view(...I){let O=-1;for(let Z0=0;Z0<I.length;++Z0)if(I[Z0]===-1){if(O!==-1)throw Error("Only one dimension can be inferred");O=Z0}let p=this.data;if(O!==-1){let Z0=I.reduce((z0,A0,j0)=>{return j0!==O?z0*A0:z0},1);I[O]=p.length/Z0}return new G(this.type,p,I)}neg_(){let I=this.data;for(let O=0;O<I.length;++O)I[O]=-I[O];return this}neg(){return this.clone().neg_()}gt(I){let O=new Uint8Array(this.data.length),p=this.data;for(let Z0=0;Z0<p.length;++Z0)O[Z0]=p[Z0]>I?1:0;return new G("bool",O,this.dims)}lt(I){let O=new Uint8Array(this.data.length),p=this.data;for(let Z0=0;Z0<p.length;++Z0)O[Z0]=p[Z0]<I?1:0;return new G("bool",O,this.dims)}clamp_(I,O){let p=this.data;for(let Z0=0;Z0<p.length;++Z0)p[Z0]=Math.min(Math.max(p[Z0],I),O);return this}clamp(I,O){return this.clone().clamp_(I,O)}round_(){let I=this.data;for(let O=0;O<I.length;++O)I[O]=Math.round(I[O]);return this}round(){return this.clone().round_()}mean(I=null,O=!1){return h(this,I,O)}min(I=null,O=!1){if(I===null){let A0=(0,W.min)(this.data)[0];return new G(this.type,[A0],[])}let[p,Z0,z0]=P((A0,j0)=>Math.min(A0,j0),this,I,O,1/0);return new G(p,Z0,z0)}max(I=null,O=!1){if(I===null){let A0=(0,W.max)(this.data)[0];return new G(this.type,[A0],[])}let[p,Z0,z0]=P((A0,j0)=>Math.max(A0,j0),this,I,O,-1/0);return new G(p,Z0,z0)}argmin(I=null,O=!1){if(I!==null)throw Error("`dim !== null` not yet implemented.");let p=(0,W.min)(this.data)[1];return new G("int64",[BigInt(p)],[])}argmax(I=null,O=!1){if(I!==null)throw Error("`dim !== null` not yet implemented.");let p=(0,W.max)(this.data)[1];return new G("int64",[BigInt(p)],[])}to(I){if(this.type===I)return this;if(!H.hasOwnProperty(I))throw Error(`Unsupported type: ${I}`);let O,p=["int64","uint64"].includes(this.type),Z0=["int64","uint64"].includes(I);if(p&&!Z0)O=Number;else if(!p&&Z0)O=BigInt;return new G(I,H[I].from(this.data,O),this.dims)}}function q(I,O){let p=I.length,Z0=O.reduce((A0,j0)=>A0*j0);if(p!==Z0)throw Error(`cannot reshape array of size ${p} into shape (${O})`);let z0=I;for(let A0=O.length-1;A0>=0;A0--)z0=z0.reduce((j0,h0)=>{let d0=j0[j0.length-1];if(d0.length<O[A0])d0.push(h0);else j0.push([h0]);return j0},[[]]);return z0[0]}function E(I,O){let[p,Z0]=(0,W.permute_data)(I.data,I.dims,O);return new G(I.type,p,Z0)}function V(I,[O,p],Z0="bilinear",z0=!1){let A0=I.dims.at(-3)??1,j0=I.dims.at(-2),h0=I.dims.at(-1),d0=(0,W.interpolate_data)(I.data,[A0,j0,h0],[O,p],Z0,z0);return new G(I.type,d0,[A0,O,p])}async function N(I,{size:O=null,mode:p="bilinear"}={}){if(I.dims.length!==4)throw Error("`interpolate_4d` currently only supports 4D input.");if(!O)throw Error("`interpolate_4d` requires a `size` argument.");let Z0;if(O.length===2)Z0=[...I.dims.slice(0,2),...O];else if(O.length===3)Z0=[I.dims[0],...O];else if(O.length===4)Z0=O;else throw Error("`size` must be of length 2, 3, or 4.");let z0;if(p==="nearest")z0=await Y.TensorOpRegistry.nearest_interpolate_4d;else if(p==="bilinear")z0=await Y.TensorOpRegistry.bilinear_interpolate_4d;else if(p==="bicubic")z0=await Y.TensorOpRegistry.bicubic_interpolate_4d;else throw Error(`Unsupported mode: ${p}`);let A0=new G("int64",new BigInt64Array(Z0.map(BigInt)),[Z0.length]);return await z0({x:I,s:A0})}async function z(I,O){return await(await Y.TensorOpRegistry.matmul)({a:I,b:O})}async function w(I,O){return await(await Y.TensorOpRegistry.rfft)({x:I,a:O})}async function R(I,O){let p=await Y.TensorOpRegistry.top_k;if(O==null)O=I.dims.at(-1);else O=Math.min(O,I.dims.at(-1));return await p({x:I,k:new G("int64",[BigInt(O)],[1])})}let y=(I)=>new G("int64",I,[I.length]);async function D(I,O,p,Z0,z0){return await(await Y.TensorOpRegistry.slice)({x:I,s:y(O),e:y(p),a:y(Z0),t:y(z0??Array(Z0.length).fill(1))})}function j(I,O){let p=I.data,Z0=O.data,z0=[I.dims[0],I.dims[2]],A0=new p.constructor(z0[0]*z0[1]),[j0,h0,d0]=I.dims,T0=0;for(let b=0;b<j0;++b){let S=b*d0*h0;for(let Q0=0;Q0<d0;++Q0){let B0=0,I0=0,F0=b*h0,Y0=S+Q0;for(let X0=0;X0<h0;++X0){let R0=Number(Z0[F0+X0]);I0+=R0,B0+=p[Y0+X0*d0]*R0}let E0=B0/I0;A0[T0++]=E0}}return new G(I.type,A0,z0)}function v(I,O,{eps:p=0.00001}={}){if(I.dims.length!==2)throw Error("`layer_norm` currently only supports 2D input.");let[Z0,z0]=I.dims;if(O.length!==1&&O[0]!==z0)throw Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");let[A0,j0]=_(I,1,0,!0),h0=A0.data,d0=j0.data,T0=I.data,b=new T0.constructor(T0.length);for(let S=0;S<Z0;++S){let Q0=S*z0;for(let B0=0;B0<z0;++B0){let I0=Q0+B0;b[I0]=(T0[I0]-d0[S])/(h0[S]+p)}}return new G(I.type,b,I.dims)}function g(I,O){if(I=I.slice(),O===null)I=I.filter((p)=>p!==1);else if(typeof O==="number"){if(I[O]===1)I.splice(O,1)}else if(Array.isArray(O))I=I.filter((p,Z0)=>{return p!==1||!O.includes(Z0)});return I}function A(I,O){return O=T(O,I.length+1),I=I.slice(),I.splice(O,0,1),I}function T(I,O,p=null,Z0=!0){if(I<-O||I>=O)if(Z0)throw Error(`IndexError: index ${I} is out of bounds for dimension${p===null?"":" "+p} with size ${O}`);else return I<-O?0:O;if(I<0)I=(I%O+O)%O;return I}function B(I,O=0){O=T(O,I[0].dims.length);let p=I[0].dims.slice();p[O]=I.reduce((j0,h0)=>j0+h0.dims[O],0);let Z0=p.reduce((j0,h0)=>j0*h0,1),z0=new I[0].data.constructor(Z0),A0=I[0].type;if(O===0){let j0=0;for(let h0 of I){let d0=h0.data;z0.set(d0,j0),j0+=d0.length}}else{let j0=0;for(let h0=0;h0<I.length;++h0){let{data:d0,dims:T0}=I[h0];for(let b=0;b<d0.length;++b){let S=0;for(let Q0=T0.length-1,B0=b,I0=1;Q0>=0;--Q0){let F0=T0[Q0],Y0=B0%F0;if(Q0===O)Y0+=j0;S+=Y0*I0,I0*=p[Q0],B0=Math.floor(B0/F0)}z0[S]=d0[b]}j0+=T0[O]}}return new G(A0,z0,p)}function F(I,O=0){return B(I.map((p)=>p.unsqueeze(O)),O)}function P(I,O,p=null,Z0=!1,z0=null){let{data:A0,dims:j0}=O;p=T(p,j0.length);let h0=j0.slice();h0[p]=1;let d0=new A0.constructor(A0.length/j0[p]);if(z0!==null)d0.fill(z0);for(let T0=0;T0<A0.length;++T0){let b=0;for(let S=j0.length-1,Q0=T0,B0=1;S>=0;--S){let I0=j0[S];if(S!==p){let F0=Q0%I0;b+=F0*B0,B0*=h0[S]}Q0=Math.floor(Q0/I0)}d0[b]=I(d0[b],A0[T0],T0,b)}if(!Z0)h0.splice(p,1);return[O.type,d0,h0]}function _(I,O=null,p=1,Z0=!1){let{data:z0,dims:A0}=I;if(O===null){let B0=z0.reduce((E0,X0)=>E0+X0,0)/z0.length,I0=Math.sqrt(z0.reduce((E0,X0)=>E0+(X0-B0)**2,0)/(z0.length-p)),F0=new G(I.type,[B0],[]);return[new G(I.type,[I0],[]),F0]}O=T(O,A0.length);let j0=h(I,O,Z0),h0=j0.data,[d0,T0,b]=P((Q0,B0,I0,F0)=>Q0+(B0-h0[F0])**2,I,O,Z0);for(let Q0=0;Q0<T0.length;++Q0)T0[Q0]=Math.sqrt(T0[Q0]/(A0[O]-p));return[new G(d0,T0,b),j0]}function h(I,O=null,p=!1){let{dims:Z0,data:z0}=I;if(O===null){let d0=z0.reduce((T0,b)=>T0+b,0);return new G(I.type,[d0/z0.length],[])}O=T(O,Z0.length);let[A0,j0,h0]=P((d0,T0)=>d0+T0,I,O,p);if(Z0[O]!==1)for(let d0=0;d0<j0.length;++d0)j0[d0]/=Z0[O];return new G(A0,j0,h0)}function c(I){let O=Array(I.length);for(let p=I.length-1,Z0=1;p>=0;--p)O[p]=Z0,Z0*=I[p];return O}function m(I,O,p,Z0){let z0=I.reduce((A0,j0)=>A0*j0,1);return new G(p,new Z0(z0).fill(O),I)}function d(I,O){let p,Z0;if(typeof O==="number")p="float32",Z0=Float32Array;else if(typeof O==="bigint")p="int64",Z0=BigInt64Array;else if(typeof O==="boolean")p="bool",Z0=Uint8Array;else throw Error(`Unsupported data type: ${typeof O}`);return m(I,O,p,Z0)}function a(I,O){return d(I.dims,O)}function n(I){return m(I,1n,"int64",BigInt64Array)}function t(I){return n(I.dims)}function W0(I){return m(I,0n,"int64",BigInt64Array)}function o(I){return W0(I.dims)}function N0(I){let O=I.reduce((p,Z0)=>p*Z0,1);return new G("float32",Float32Array.from({length:O},()=>Math.random()),I)}function w0(I,O){if(I.dims.length!==2)throw Error("The tensor must have 2 dimensions");if(I.dims.at(-1)%8!==0)throw Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(O))throw Error("The precision must be either 'binary' or 'ubinary'");let p=O==="binary",Z0=p?"int8":"uint8",z0=p?Int8Array:Uint8Array,A0=I.data,j0=new z0(A0.length/8);for(let h0=0;h0<A0.length;++h0){let d0=A0[h0]>0?1:0,T0=Math.floor(h0/8),b=h0%8;if(j0[T0]|=d0<<7-b,p&&b===0)j0[T0]-=128}return new G(Z0,j0,[I.dims[0],I.dims[1]/8])}},"./src/utils/video.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/video.js ***!
  \****************************/$.r(Z),$.d(Z,{RawVideo:()=>H,RawVideoFrame:()=>Y,load_video:()=>G});var W=$("./src/utils/image.js");/*! ./image.js */var Q=$("./src/env.js");/*! ../env.js */class Y{constructor(q,E){this.image=q,this.timestamp=E}}class H{constructor(q,E){if(q.length>0&&q[0]instanceof W.RawImage)q=q.map((V,N)=>new Y(V,(N+1)/(q.length+1)*E));this.frames=q,this.duration=E}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function G(q,{num_frames:E=null,fps:V=null}={}){if(!Q.apis.IS_BROWSER_ENV)throw Error("`load_video` is currently only supported in browser environments.");if(E==null&&V==null)throw Error("Either num_frames or fps must be provided.");let N=[],z=document.createElement("video");if(z.crossOrigin="anonymous",z.muted=!0,typeof q==="string")z.src=q;else if(q instanceof Blob)z.src=URL.createObjectURL(q);else if(q instanceof HTMLVideoElement)z.src=q.src;else throw Error("Invalid URL or video element provided.");if(await new Promise((g)=>z.onloadedmetadata=g),z.seekable.start(0)===z.seekable.end(0)){let A=await(await fetch(z.src)).blob();z.src=URL.createObjectURL(A),await new Promise((T)=>z.onloadedmetadata=T)}let w=z.duration,R,y;if(E!=null)R=E,y=E===1?0:w/(E-1);else y=1/V,R=Math.floor(w/y);let D=[];for(let g=0;g<R;++g)D.push(E===1?w/2:g*y);let j=document.createElement("canvas");j.width=z.videoWidth,j.height=z.videoHeight;let v=j.getContext("2d",{willReadFrequently:!0});for(let g of D){z.currentTime=g,await new Promise((F)=>{z.onseeked=F}),v.drawImage(z,0,0,j.width,j.height);let A=v.getImageData(0,0,j.width,j.height),T=new W.RawImage(A.data,j.width,j.height,4),B=new Y(T,g);N.push(B)}return z.remove(),new H(N,w)}}},gU={};function R6(J){var Z=gU[J];if(Z!==void 0)return Z.exports;var $=gU[J]={exports:{}};return RL[J]($,$.exports,R6),$.exports}(()=>{var J=Object.getPrototypeOf?($)=>Object.getPrototypeOf($):($)=>$.__proto__,Z;R6.t=function($,W){if(W&1)$=this($);if(W&8)return $;if(typeof $==="object"&&$){if(W&4&&$.__esModule)return $;if(W&16&&typeof $.then==="function")return $}var Q=Object.create(null);R6.r(Q);var Y={};Z=Z||[null,J({}),J([]),J(J)];for(var H=W&2&&$;typeof H=="object"&&!~Z.indexOf(H);H=J(H))Object.getOwnPropertyNames(H).forEach((G)=>Y[G]=()=>$[G]);return Y.default=()=>$,R6.d(Q,Y),Q}})();(()=>{R6.d=(J,Z)=>{for(var $ in Z)if(R6.o(Z,$)&&!R6.o(J,$))Object.defineProperty(J,$,{enumerable:!0,get:Z[$]})}})();(()=>{R6.o=(J,Z)=>Object.prototype.hasOwnProperty.call(J,Z)})();(()=>{R6.r=(J)=>{if(typeof Symbol<"u"&&Symbol.toStringTag)Object.defineProperty(J,Symbol.toStringTag,{value:"Module"});Object.defineProperty(J,"__esModule",{value:!0})}})();var K={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/R6.r(K),R6.d(K,{ASTFeatureExtractor:()=>N.ASTFeatureExtractor,ASTForAudioClassification:()=>$.ASTForAudioClassification,ASTModel:()=>$.ASTModel,ASTPreTrainedModel:()=>$.ASTPreTrainedModel,AlbertForMaskedLM:()=>$.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>$.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>$.AlbertForSequenceClassification,AlbertModel:()=>$.AlbertModel,AlbertPreTrainedModel:()=>$.AlbertPreTrainedModel,AlbertTokenizer:()=>W.AlbertTokenizer,ArceeForCausalLM:()=>$.ArceeForCausalLM,ArceeModel:()=>$.ArceeModel,ArceePreTrainedModel:()=>$.ArceePreTrainedModel,AudioClassificationPipeline:()=>Z.AudioClassificationPipeline,AutoConfig:()=>Q.AutoConfig,AutoFeatureExtractor:()=>z.AutoFeatureExtractor,AutoImageProcessor:()=>y.AutoImageProcessor,AutoModel:()=>$.AutoModel,AutoModelForAudioClassification:()=>$.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>$.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>$.AutoModelForAudioTextToText,AutoModelForCTC:()=>$.AutoModelForCTC,AutoModelForCausalLM:()=>$.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>$.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>$.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>$.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>$.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>$.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>$.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>$.AutoModelForImageTextToText,AutoModelForImageToImage:()=>$.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>$.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>$.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>$.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>$.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>$.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>$.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>$.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>$.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>$.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>$.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>$.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>$.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>$.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>$.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>$.AutoModelForVision2Seq,AutoModelForXVector:()=>$.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>$.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>v.AutoProcessor,AutoTokenizer:()=>W.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>Z.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>Z.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>$.BartForConditionalGeneration,BartForSequenceClassification:()=>$.BartForSequenceClassification,BartModel:()=>$.BartModel,BartPretrainedModel:()=>$.BartPretrainedModel,BartTokenizer:()=>W.BartTokenizer,BaseModelOutput:()=>$.BaseModelOutput,BaseStreamer:()=>g.BaseStreamer,BeitFeatureExtractor:()=>R.BeitFeatureExtractor,BeitForImageClassification:()=>$.BeitForImageClassification,BeitModel:()=>$.BeitModel,BeitPreTrainedModel:()=>$.BeitPreTrainedModel,BertForMaskedLM:()=>$.BertForMaskedLM,BertForQuestionAnswering:()=>$.BertForQuestionAnswering,BertForSequenceClassification:()=>$.BertForSequenceClassification,BertForTokenClassification:()=>$.BertForTokenClassification,BertModel:()=>$.BertModel,BertPreTrainedModel:()=>$.BertPreTrainedModel,BertTokenizer:()=>W.BertTokenizer,BitImageProcessor:()=>R.BitImageProcessor,BlenderbotForConditionalGeneration:()=>$.BlenderbotForConditionalGeneration,BlenderbotModel:()=>$.BlenderbotModel,BlenderbotPreTrainedModel:()=>$.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>$.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>$.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>$.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>W.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>W.BlenderbotTokenizer,BloomForCausalLM:()=>$.BloomForCausalLM,BloomModel:()=>$.BloomModel,BloomPreTrainedModel:()=>$.BloomPreTrainedModel,BloomTokenizer:()=>W.BloomTokenizer,CLIPFeatureExtractor:()=>R.CLIPFeatureExtractor,CLIPImageProcessor:()=>R.CLIPImageProcessor,CLIPModel:()=>$.CLIPModel,CLIPPreTrainedModel:()=>$.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>$.CLIPSegForImageSegmentation,CLIPSegModel:()=>$.CLIPSegModel,CLIPSegPreTrainedModel:()=>$.CLIPSegPreTrainedModel,CLIPTextModel:()=>$.CLIPTextModel,CLIPTextModelWithProjection:()=>$.CLIPTextModelWithProjection,CLIPTokenizer:()=>W.CLIPTokenizer,CLIPVisionModel:()=>$.CLIPVisionModel,CLIPVisionModelWithProjection:()=>$.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>$.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>$.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>$.CamembertForSequenceClassification,CamembertForTokenClassification:()=>$.CamembertForTokenClassification,CamembertModel:()=>$.CamembertModel,CamembertPreTrainedModel:()=>$.CamembertPreTrainedModel,CamembertTokenizer:()=>W.CamembertTokenizer,CausalLMOutput:()=>$.CausalLMOutput,CausalLMOutputWithPast:()=>$.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>R.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>$.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>$.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>$.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>N.ClapFeatureExtractor,ClapModel:()=>$.ClapModel,ClapPreTrainedModel:()=>$.ClapPreTrainedModel,ClapTextModelWithProjection:()=>$.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>T.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>$.CodeGenForCausalLM,CodeGenModel:()=>$.CodeGenModel,CodeGenPreTrainedModel:()=>$.CodeGenPreTrainedModel,CodeGenTokenizer:()=>W.CodeGenTokenizer,CodeLlamaTokenizer:()=>W.CodeLlamaTokenizer,CohereForCausalLM:()=>$.CohereForCausalLM,CohereModel:()=>$.CohereModel,CoherePreTrainedModel:()=>$.CoherePreTrainedModel,CohereTokenizer:()=>W.CohereTokenizer,ConvBertForMaskedLM:()=>$.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>$.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>$.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>$.ConvBertForTokenClassification,ConvBertModel:()=>$.ConvBertModel,ConvBertPreTrainedModel:()=>$.ConvBertPreTrainedModel,ConvBertTokenizer:()=>W.ConvBertTokenizer,ConvNextFeatureExtractor:()=>R.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>$.ConvNextForImageClassification,ConvNextImageProcessor:()=>R.ConvNextImageProcessor,ConvNextModel:()=>$.ConvNextModel,ConvNextPreTrainedModel:()=>$.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>$.ConvNextV2ForImageClassification,ConvNextV2Model:()=>$.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>$.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>$.DFineForObjectDetection,DFineModel:()=>$.DFineModel,DFinePreTrainedModel:()=>$.DFinePreTrainedModel,DINOv3ConvNextModel:()=>$.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>$.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>R.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>$.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>$.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>R.DPTFeatureExtractor,DPTForDepthEstimation:()=>$.DPTForDepthEstimation,DPTImageProcessor:()=>R.DPTImageProcessor,DPTModel:()=>$.DPTModel,DPTPreTrainedModel:()=>$.DPTPreTrainedModel,DacDecoderModel:()=>$.DacDecoderModel,DacDecoderOutput:()=>$.DacDecoderOutput,DacEncoderModel:()=>$.DacEncoderModel,DacEncoderOutput:()=>$.DacEncoderOutput,DacFeatureExtractor:()=>N.DacFeatureExtractor,DacModel:()=>$.DacModel,DacPreTrainedModel:()=>$.DacPreTrainedModel,DataTypeMap:()=>q.DataTypeMap,DebertaForMaskedLM:()=>$.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>$.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>$.DebertaForSequenceClassification,DebertaForTokenClassification:()=>$.DebertaForTokenClassification,DebertaModel:()=>$.DebertaModel,DebertaPreTrainedModel:()=>$.DebertaPreTrainedModel,DebertaTokenizer:()=>W.DebertaTokenizer,DebertaV2ForMaskedLM:()=>$.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>$.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>$.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>$.DebertaV2ForTokenClassification,DebertaV2Model:()=>$.DebertaV2Model,DebertaV2PreTrainedModel:()=>$.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>W.DebertaV2Tokenizer,DecisionTransformerModel:()=>$.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>$.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>R.DeiTFeatureExtractor,DeiTForImageClassification:()=>$.DeiTForImageClassification,DeiTImageProcessor:()=>R.DeiTImageProcessor,DeiTModel:()=>$.DeiTModel,DeiTPreTrainedModel:()=>$.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>$.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>$.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>Z.DepthEstimationPipeline,DepthProForDepthEstimation:()=>$.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>$.DepthProPreTrainedModel,DetrFeatureExtractor:()=>R.DetrFeatureExtractor,DetrForObjectDetection:()=>$.DetrForObjectDetection,DetrForSegmentation:()=>$.DetrForSegmentation,DetrImageProcessor:()=>R.DetrImageProcessor,DetrModel:()=>$.DetrModel,DetrObjectDetectionOutput:()=>$.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>$.DetrPreTrainedModel,DetrSegmentationOutput:()=>$.DetrSegmentationOutput,Dinov2ForImageClassification:()=>$.Dinov2ForImageClassification,Dinov2Model:()=>$.Dinov2Model,Dinov2PreTrainedModel:()=>$.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>$.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>$.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>$.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>$.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>$.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>$.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>$.DistilBertForTokenClassification,DistilBertModel:()=>$.DistilBertModel,DistilBertPreTrainedModel:()=>$.DistilBertPreTrainedModel,DistilBertTokenizer:()=>W.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>Z.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>R.DonutFeatureExtractor,DonutImageProcessor:()=>R.DonutImageProcessor,DonutSwinModel:()=>$.DonutSwinModel,DonutSwinPreTrainedModel:()=>$.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>$.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>R.EfficientNetImageProcessor,EfficientNetModel:()=>$.EfficientNetModel,EfficientNetPreTrainedModel:()=>$.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>$.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>$.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>$.ElectraForSequenceClassification,ElectraForTokenClassification:()=>$.ElectraForTokenClassification,ElectraModel:()=>$.ElectraModel,ElectraPreTrainedModel:()=>$.ElectraPreTrainedModel,ElectraTokenizer:()=>W.ElectraTokenizer,EncodecFeatureExtractor:()=>N.EncodecFeatureExtractor,EosTokenCriteria:()=>A.EosTokenCriteria,Ernie4_5_ForCausalLM:()=>$.Ernie4_5_ForCausalLM,Ernie4_5_Model:()=>$.Ernie4_5_Model,Ernie4_5_PretrainedModel:()=>$.Ernie4_5_PretrainedModel,Ernie4_5_Tokenizer:()=>W.Ernie4_5_Tokenizer,EsmForMaskedLM:()=>$.EsmForMaskedLM,EsmForSequenceClassification:()=>$.EsmForSequenceClassification,EsmForTokenClassification:()=>$.EsmForTokenClassification,EsmModel:()=>$.EsmModel,EsmPreTrainedModel:()=>$.EsmPreTrainedModel,EsmTokenizer:()=>W.EsmTokenizer,ExaoneForCausalLM:()=>$.ExaoneForCausalLM,ExaoneModel:()=>$.ExaoneModel,ExaonePreTrainedModel:()=>$.ExaonePreTrainedModel,FFT:()=>E.FFT,FalconForCausalLM:()=>$.FalconForCausalLM,FalconModel:()=>$.FalconModel,FalconPreTrainedModel:()=>$.FalconPreTrainedModel,FalconTokenizer:()=>W.FalconTokenizer,FastViTForImageClassification:()=>$.FastViTForImageClassification,FastViTModel:()=>$.FastViTModel,FastViTPreTrainedModel:()=>$.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>Z.FeatureExtractionPipeline,FeatureExtractor:()=>V.FeatureExtractor,FillMaskPipeline:()=>Z.FillMaskPipeline,Florence2ForConditionalGeneration:()=>$.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>$.Florence2PreTrainedModel,Florence2Processor:()=>j.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>T.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>T.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>R.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>$.GLPNForDepthEstimation,GLPNModel:()=>$.GLPNModel,GLPNPreTrainedModel:()=>$.GLPNPreTrainedModel,GPT2LMHeadModel:()=>$.GPT2LMHeadModel,GPT2Model:()=>$.GPT2Model,GPT2PreTrainedModel:()=>$.GPT2PreTrainedModel,GPT2Tokenizer:()=>W.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>$.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>$.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>$.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>$.GPTJForCausalLM,GPTJModel:()=>$.GPTJModel,GPTJPreTrainedModel:()=>$.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>$.GPTNeoForCausalLM,GPTNeoModel:()=>$.GPTNeoModel,GPTNeoPreTrainedModel:()=>$.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>$.GPTNeoXForCausalLM,GPTNeoXModel:()=>$.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>$.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>W.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>$.Gemma2ForCausalLM,Gemma2Model:()=>$.Gemma2Model,Gemma2PreTrainedModel:()=>$.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>$.Gemma3ForCausalLM,Gemma3Model:()=>$.Gemma3Model,Gemma3PreTrainedModel:()=>$.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>N.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>$.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>$.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>j.Gemma3nProcessor,GemmaForCausalLM:()=>$.GemmaForCausalLM,GemmaModel:()=>$.GemmaModel,GemmaPreTrainedModel:()=>$.GemmaPreTrainedModel,GemmaTokenizer:()=>W.GemmaTokenizer,GlmForCausalLM:()=>$.GlmForCausalLM,GlmModel:()=>$.GlmModel,GlmPreTrainedModel:()=>$.GlmPreTrainedModel,GraniteForCausalLM:()=>$.GraniteForCausalLM,GraniteModel:()=>$.GraniteModel,GraniteMoeHybridForCausalLM:()=>$.GraniteMoeHybridForCausalLM,GraniteMoeHybridModel:()=>$.GraniteMoeHybridModel,GraniteMoeHybridPreTrainedModel:()=>$.GraniteMoeHybridPreTrainedModel,GranitePreTrainedModel:()=>$.GranitePreTrainedModel,Grok1Tokenizer:()=>W.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>$.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>R.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>$.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>j.GroundingDinoProcessor,GroupViTModel:()=>$.GroupViTModel,GroupViTPreTrainedModel:()=>$.GroupViTPreTrainedModel,HeliumForCausalLM:()=>$.HeliumForCausalLM,HeliumModel:()=>$.HeliumModel,HeliumPreTrainedModel:()=>$.HeliumPreTrainedModel,HerbertTokenizer:()=>W.HerbertTokenizer,HieraForImageClassification:()=>$.HieraForImageClassification,HieraModel:()=>$.HieraModel,HieraPreTrainedModel:()=>$.HieraPreTrainedModel,HubertForCTC:()=>$.HubertForCTC,HubertForSequenceClassification:()=>$.HubertForSequenceClassification,HubertModel:()=>$.HubertModel,HubertPreTrainedModel:()=>$.HubertPreTrainedModel,IJepaForImageClassification:()=>$.IJepaForImageClassification,IJepaModel:()=>$.IJepaModel,IJepaPreTrainedModel:()=>$.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>$.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>R.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>$.Idefics3PreTrainedModel,Idefics3Processor:()=>j.Idefics3Processor,ImageClassificationPipeline:()=>Z.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>Z.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>N.ImageFeatureExtractor,ImageMattingOutput:()=>$.ImageMattingOutput,ImageProcessor:()=>w.ImageProcessor,ImageSegmentationPipeline:()=>Z.ImageSegmentationPipeline,ImageToImagePipeline:()=>Z.ImageToImagePipeline,ImageToTextPipeline:()=>Z.ImageToTextPipeline,InterruptableStoppingCriteria:()=>A.InterruptableStoppingCriteria,JAISLMHeadModel:()=>$.JAISLMHeadModel,JAISModel:()=>$.JAISModel,JAISPreTrainedModel:()=>$.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>R.JinaCLIPImageProcessor,JinaCLIPModel:()=>$.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>$.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>j.JinaCLIPProcessor,JinaCLIPTextModel:()=>$.JinaCLIPTextModel,JinaCLIPVisionModel:()=>$.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>$.Lfm2ForCausalLM,Lfm2Model:()=>$.Lfm2Model,Lfm2PreTrainedModel:()=>$.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>$.LiteWhisperForConditionalGeneration,Llama4ForCausalLM:()=>$.Llama4ForCausalLM,Llama4PreTrainedModel:()=>$.Llama4PreTrainedModel,LlamaForCausalLM:()=>$.LlamaForCausalLM,LlamaModel:()=>$.LlamaModel,LlamaPreTrainedModel:()=>$.LlamaPreTrainedModel,LlamaTokenizer:()=>W.LlamaTokenizer,LlavaForConditionalGeneration:()=>$.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>$.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>R.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>$.LlavaPreTrainedModel,LlavaProcessor:()=>j.LlavaProcessor,LlavaQwen2ForCausalLM:()=>$.LlavaQwen2ForCausalLM,LogitsProcessor:()=>T.LogitsProcessor,LogitsProcessorList:()=>T.LogitsProcessorList,LogitsWarper:()=>T.LogitsWarper,LongT5ForConditionalGeneration:()=>$.LongT5ForConditionalGeneration,LongT5Model:()=>$.LongT5Model,LongT5PreTrainedModel:()=>$.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>$.M2M100ForConditionalGeneration,M2M100Model:()=>$.M2M100Model,M2M100PreTrainedModel:()=>$.M2M100PreTrainedModel,M2M100Tokenizer:()=>W.M2M100Tokenizer,MBart50Tokenizer:()=>W.MBart50Tokenizer,MBartForCausalLM:()=>$.MBartForCausalLM,MBartForConditionalGeneration:()=>$.MBartForConditionalGeneration,MBartForSequenceClassification:()=>$.MBartForSequenceClassification,MBartModel:()=>$.MBartModel,MBartPreTrainedModel:()=>$.MBartPreTrainedModel,MBartTokenizer:()=>W.MBartTokenizer,MPNetForMaskedLM:()=>$.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>$.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>$.MPNetForSequenceClassification,MPNetForTokenClassification:()=>$.MPNetForTokenClassification,MPNetModel:()=>$.MPNetModel,MPNetPreTrainedModel:()=>$.MPNetPreTrainedModel,MPNetTokenizer:()=>W.MPNetTokenizer,MT5ForConditionalGeneration:()=>$.MT5ForConditionalGeneration,MT5Model:()=>$.MT5Model,MT5PreTrainedModel:()=>$.MT5PreTrainedModel,MarianMTModel:()=>$.MarianMTModel,MarianModel:()=>$.MarianModel,MarianPreTrainedModel:()=>$.MarianPreTrainedModel,MarianTokenizer:()=>W.MarianTokenizer,Mask2FormerImageProcessor:()=>R.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>R.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>$.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>R.MaskFormerImageProcessor,MaskFormerModel:()=>$.MaskFormerModel,MaskFormerPreTrainedModel:()=>$.MaskFormerPreTrainedModel,MaskedLMOutput:()=>$.MaskedLMOutput,MaxLengthCriteria:()=>A.MaxLengthCriteria,Metric3DForDepthEstimation:()=>$.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>$.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>$.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>$.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>$.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>$.MgpstrModelOutput,MgpstrPreTrainedModel:()=>$.MgpstrPreTrainedModel,MgpstrProcessor:()=>j.MgpstrProcessor,MgpstrTokenizer:()=>W.MgpstrTokenizer,MimiDecoderModel:()=>$.MimiDecoderModel,MimiDecoderOutput:()=>$.MimiDecoderOutput,MimiEncoderModel:()=>$.MimiEncoderModel,MimiEncoderOutput:()=>$.MimiEncoderOutput,MimiModel:()=>$.MimiModel,MimiPreTrainedModel:()=>$.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>T.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>T.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>$.MistralForCausalLM,MistralModel:()=>$.MistralModel,MistralPreTrainedModel:()=>$.MistralPreTrainedModel,MobileBertForMaskedLM:()=>$.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>$.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>$.MobileBertForSequenceClassification,MobileBertModel:()=>$.MobileBertModel,MobileBertPreTrainedModel:()=>$.MobileBertPreTrainedModel,MobileBertTokenizer:()=>W.MobileBertTokenizer,MobileLLMForCausalLM:()=>$.MobileLLMForCausalLM,MobileLLMModel:()=>$.MobileLLMModel,MobileLLMPreTrainedModel:()=>$.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>R.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>$.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>$.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>R.MobileNetV1ImageProcessor,MobileNetV1Model:()=>$.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>$.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>R.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>$.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>$.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>R.MobileNetV2ImageProcessor,MobileNetV2Model:()=>$.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>$.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>R.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>$.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>$.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>R.MobileNetV3ImageProcessor,MobileNetV3Model:()=>$.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>$.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>R.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>$.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>$.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>R.MobileNetV4ImageProcessor,MobileNetV4Model:()=>$.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>$.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>R.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>$.MobileViTForImageClassification,MobileViTImageProcessor:()=>R.MobileViTImageProcessor,MobileViTModel:()=>$.MobileViTModel,MobileViTPreTrainedModel:()=>$.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>$.MobileViTV2ForImageClassification,MobileViTV2Model:()=>$.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>$.MobileViTV2PreTrainedModel,ModelOutput:()=>$.ModelOutput,ModernBertDecoderForCausalLM:()=>$.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>$.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>$.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>$.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>$.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>$.ModernBertForTokenClassification,ModernBertModel:()=>$.ModernBertModel,ModernBertPreTrainedModel:()=>$.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>$.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>N.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>$.MoonshineForConditionalGeneration,MoonshineModel:()=>$.MoonshineModel,MoonshinePreTrainedModel:()=>$.MoonshinePreTrainedModel,MoonshineProcessor:()=>j.MoonshineProcessor,MptForCausalLM:()=>$.MptForCausalLM,MptModel:()=>$.MptModel,MptPreTrainedModel:()=>$.MptPreTrainedModel,MultiModalityCausalLM:()=>$.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>$.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>$.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>$.MusicgenForConditionalGeneration,MusicgenModel:()=>$.MusicgenModel,MusicgenPreTrainedModel:()=>$.MusicgenPreTrainedModel,NanoChatForCausalLM:()=>$.NanoChatForCausalLM,NanoChatModel:()=>$.NanoChatModel,NanoChatPreTrainedModel:()=>$.NanoChatPreTrainedModel,NeoBertForMaskedLM:()=>$.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>$.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>$.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>$.NeoBertForTokenClassification,NeoBertModel:()=>$.NeoBertModel,NeoBertPreTrainedModel:()=>$.NeoBertPreTrainedModel,NllbTokenizer:()=>W.NllbTokenizer,NoBadWordsLogitsProcessor:()=>T.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>T.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>$.NomicBertModel,NomicBertPreTrainedModel:()=>$.NomicBertPreTrainedModel,NougatImageProcessor:()=>R.NougatImageProcessor,NougatTokenizer:()=>W.NougatTokenizer,OPTForCausalLM:()=>$.OPTForCausalLM,OPTModel:()=>$.OPTModel,OPTPreTrainedModel:()=>$.OPTPreTrainedModel,ObjectDetectionPipeline:()=>Z.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>$.Olmo2ForCausalLM,Olmo2Model:()=>$.Olmo2Model,Olmo2PreTrainedModel:()=>$.Olmo2PreTrainedModel,OlmoForCausalLM:()=>$.OlmoForCausalLM,OlmoModel:()=>$.OlmoModel,OlmoPreTrainedModel:()=>$.OlmoPreTrainedModel,OpenELMForCausalLM:()=>$.OpenELMForCausalLM,OpenELMModel:()=>$.OpenELMModel,OpenELMPreTrainedModel:()=>$.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>R.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>$.OwlViTForObjectDetection,OwlViTImageProcessor:()=>R.OwlViTImageProcessor,OwlViTModel:()=>$.OwlViTModel,OwlViTPreTrainedModel:()=>$.OwlViTPreTrainedModel,OwlViTProcessor:()=>j.OwlViTProcessor,Owlv2ForObjectDetection:()=>$.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>R.Owlv2ImageProcessor,Owlv2Model:()=>$.Owlv2Model,Owlv2PreTrainedModel:()=>$.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>$.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>$.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>j.PaliGemmaProcessor,ParakeetFeatureExtractor:()=>N.ParakeetFeatureExtractor,ParakeetForCTC:()=>$.ParakeetForCTC,ParakeetPreTrainedModel:()=>$.ParakeetPreTrainedModel,PatchTSMixerForPrediction:()=>$.PatchTSMixerForPrediction,PatchTSMixerModel:()=>$.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>$.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>$.PatchTSTForPrediction,PatchTSTModel:()=>$.PatchTSTModel,PatchTSTPreTrainedModel:()=>$.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>$.Phi3ForCausalLM,Phi3Model:()=>$.Phi3Model,Phi3PreTrainedModel:()=>$.Phi3PreTrainedModel,Phi3VForCausalLM:()=>$.Phi3VForCausalLM,Phi3VImageProcessor:()=>R.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>$.Phi3VPreTrainedModel,Phi3VProcessor:()=>j.Phi3VProcessor,PhiForCausalLM:()=>$.PhiForCausalLM,PhiModel:()=>$.PhiModel,PhiPreTrainedModel:()=>$.PhiPreTrainedModel,Pipeline:()=>Z.Pipeline,PreTrainedModel:()=>$.PreTrainedModel,PreTrainedTokenizer:()=>W.PreTrainedTokenizer,PretrainedConfig:()=>Q.PretrainedConfig,PretrainedMixin:()=>$.PretrainedMixin,Processor:()=>D.Processor,PvtForImageClassification:()=>$.PvtForImageClassification,PvtImageProcessor:()=>R.PvtImageProcessor,PvtModel:()=>$.PvtModel,PvtPreTrainedModel:()=>$.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>N.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>$.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>$.PyAnnoteModel,PyAnnotePreTrainedModel:()=>$.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>j.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>$.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>Z.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>$.Qwen2ForCausalLM,Qwen2Model:()=>$.Qwen2Model,Qwen2PreTrainedModel:()=>$.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>W.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>$.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>R.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>$.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>j.Qwen2VLProcessor,Qwen3ForCausalLM:()=>$.Qwen3ForCausalLM,Qwen3Model:()=>$.Qwen3Model,Qwen3PreTrainedModel:()=>$.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>$.RFDetrForObjectDetection,RFDetrModel:()=>$.RFDetrModel,RFDetrObjectDetectionOutput:()=>$.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>$.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>$.RTDetrForObjectDetection,RTDetrImageProcessor:()=>R.RTDetrImageProcessor,RTDetrModel:()=>$.RTDetrModel,RTDetrObjectDetectionOutput:()=>$.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>$.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>$.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>$.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>$.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>$.RTDetrV2PreTrainedModel,RawAudio:()=>Y.RawAudio,RawImage:()=>H.RawImage,RawVideo:()=>G.RawVideo,RawVideoFrame:()=>G.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>T.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>$.ResNetForImageClassification,ResNetModel:()=>$.ResNetModel,ResNetPreTrainedModel:()=>$.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>$.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>$.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>$.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>$.RoFormerForTokenClassification,RoFormerModel:()=>$.RoFormerModel,RoFormerPreTrainedModel:()=>$.RoFormerPreTrainedModel,RoFormerTokenizer:()=>W.RoFormerTokenizer,RobertaForMaskedLM:()=>$.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>$.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>$.RobertaForSequenceClassification,RobertaForTokenClassification:()=>$.RobertaForTokenClassification,RobertaModel:()=>$.RobertaModel,RobertaPreTrainedModel:()=>$.RobertaPreTrainedModel,RobertaTokenizer:()=>W.RobertaTokenizer,SamImageProcessor:()=>R.SamImageProcessor,SamImageSegmentationOutput:()=>$.SamImageSegmentationOutput,SamModel:()=>$.SamModel,SamPreTrainedModel:()=>$.SamPreTrainedModel,SamProcessor:()=>j.SamProcessor,SapiensForDepthEstimation:()=>$.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>$.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>$.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>$.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>N.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>R.SegformerFeatureExtractor,SegformerForImageClassification:()=>$.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>$.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>R.SegformerImageProcessor,SegformerModel:()=>$.SegformerModel,SegformerPreTrainedModel:()=>$.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>$.Seq2SeqLMOutput,SequenceClassifierOutput:()=>$.SequenceClassifierOutput,SiglipImageProcessor:()=>R.SiglipImageProcessor,SiglipModel:()=>$.SiglipModel,SiglipPreTrainedModel:()=>$.SiglipPreTrainedModel,SiglipTextModel:()=>$.SiglipTextModel,SiglipTokenizer:()=>W.SiglipTokenizer,SiglipVisionModel:()=>$.SiglipVisionModel,SmolLM3ForCausalLM:()=>$.SmolLM3ForCausalLM,SmolLM3Model:()=>$.SmolLM3Model,SmolLM3PreTrainedModel:()=>$.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>$.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>R.SmolVLMImageProcessor,SmolVLMProcessor:()=>j.SmolVLMProcessor,SnacDecoderModel:()=>$.SnacDecoderModel,SnacEncoderModel:()=>$.SnacEncoderModel,SnacFeatureExtractor:()=>N.SnacFeatureExtractor,SnacModel:()=>$.SnacModel,SnacPreTrainedModel:()=>$.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>N.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>$.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>$.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>$.SpeechT5HifiGan,SpeechT5Model:()=>$.SpeechT5Model,SpeechT5PreTrainedModel:()=>$.SpeechT5PreTrainedModel,SpeechT5Processor:()=>j.SpeechT5Processor,SpeechT5Tokenizer:()=>W.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>$.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>$.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>$.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>$.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>$.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>W.SqueezeBertTokenizer,StableLmForCausalLM:()=>$.StableLmForCausalLM,StableLmModel:()=>$.StableLmModel,StableLmPreTrainedModel:()=>$.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>$.Starcoder2ForCausalLM,Starcoder2Model:()=>$.Starcoder2Model,Starcoder2PreTrainedModel:()=>$.Starcoder2PreTrainedModel,StoppingCriteria:()=>A.StoppingCriteria,StoppingCriteriaList:()=>A.StoppingCriteriaList,StyleTextToSpeech2Model:()=>$.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>$.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>Z.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>T.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>$.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>R.Swin2SRImageProcessor,Swin2SRModel:()=>$.Swin2SRModel,Swin2SRPreTrainedModel:()=>$.Swin2SRPreTrainedModel,SwinForImageClassification:()=>$.SwinForImageClassification,SwinForSemanticSegmentation:()=>$.SwinForSemanticSegmentation,SwinModel:()=>$.SwinModel,SwinPreTrainedModel:()=>$.SwinPreTrainedModel,T5ForConditionalGeneration:()=>$.T5ForConditionalGeneration,T5Model:()=>$.T5Model,T5PreTrainedModel:()=>$.T5PreTrainedModel,T5Tokenizer:()=>W.T5Tokenizer,TableTransformerForObjectDetection:()=>$.TableTransformerForObjectDetection,TableTransformerModel:()=>$.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>$.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>$.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>T.TemperatureLogitsWarper,Tensor:()=>q.Tensor,Text2TextGenerationPipeline:()=>Z.Text2TextGenerationPipeline,TextClassificationPipeline:()=>Z.TextClassificationPipeline,TextGenerationPipeline:()=>Z.TextGenerationPipeline,TextStreamer:()=>g.TextStreamer,TextToAudioPipeline:()=>Z.TextToAudioPipeline,TokenClassificationPipeline:()=>Z.TokenClassificationPipeline,TokenClassifierOutput:()=>$.TokenClassifierOutput,TokenizerModel:()=>W.TokenizerModel,TopKLogitsWarper:()=>T.TopKLogitsWarper,TopPLogitsWarper:()=>T.TopPLogitsWarper,TrOCRForCausalLM:()=>$.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>$.TrOCRPreTrainedModel,TranslationPipeline:()=>Z.TranslationPipeline,UltravoxModel:()=>$.UltravoxModel,UltravoxPreTrainedModel:()=>$.UltravoxPreTrainedModel,UltravoxProcessor:()=>j.UltravoxProcessor,UniSpeechForCTC:()=>$.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>$.UniSpeechForSequenceClassification,UniSpeechModel:()=>$.UniSpeechModel,UniSpeechPreTrainedModel:()=>$.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>$.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>$.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>$.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>$.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>$.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>j.VLChatProcessor,VLMImageProcessor:()=>R.VLMImageProcessor,VaultGemmaForCausalLM:()=>$.VaultGemmaForCausalLM,VaultGemmaModel:()=>$.VaultGemmaModel,VaultGemmaPreTrainedModel:()=>$.VaultGemmaPreTrainedModel,ViTFeatureExtractor:()=>R.ViTFeatureExtractor,ViTForImageClassification:()=>$.ViTForImageClassification,ViTImageProcessor:()=>R.ViTImageProcessor,ViTMAEModel:()=>$.ViTMAEModel,ViTMAEPreTrainedModel:()=>$.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>$.ViTMSNForImageClassification,ViTMSNModel:()=>$.ViTMSNModel,ViTMSNPreTrainedModel:()=>$.ViTMSNPreTrainedModel,ViTModel:()=>$.ViTModel,ViTPreTrainedModel:()=>$.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>$.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>$.VitMatteForImageMatting,VitMatteImageProcessor:()=>R.VitMatteImageProcessor,VitMattePreTrainedModel:()=>$.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>$.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>R.VitPoseImageProcessor,VitPosePreTrainedModel:()=>$.VitPosePreTrainedModel,VitsModel:()=>$.VitsModel,VitsModelOutput:()=>$.VitsModelOutput,VitsPreTrainedModel:()=>$.VitsPreTrainedModel,VitsTokenizer:()=>W.VitsTokenizer,VoxtralForConditionalGeneration:()=>$.VoxtralForConditionalGeneration,VoxtralProcessor:()=>j.VoxtralProcessor,Wav2Vec2BertForCTC:()=>$.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>$.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>$.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>$.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>W.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>N.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>$.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>$.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>$.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>$.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>$.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>j.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>j.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>$.WavLMForAudioFrameClassification,WavLMForCTC:()=>$.WavLMForCTC,WavLMForSequenceClassification:()=>$.WavLMForSequenceClassification,WavLMForXVector:()=>$.WavLMForXVector,WavLMModel:()=>$.WavLMModel,WavLMPreTrainedModel:()=>$.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>N.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>$.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>$.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>N.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>$.WhisperForConditionalGeneration,WhisperModel:()=>$.WhisperModel,WhisperPreTrainedModel:()=>$.WhisperPreTrainedModel,WhisperProcessor:()=>j.WhisperProcessor,WhisperTextStreamer:()=>g.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>T.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>W.WhisperTokenizer,XLMForQuestionAnswering:()=>$.XLMForQuestionAnswering,XLMForSequenceClassification:()=>$.XLMForSequenceClassification,XLMForTokenClassification:()=>$.XLMForTokenClassification,XLMModel:()=>$.XLMModel,XLMPreTrainedModel:()=>$.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>$.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>$.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>$.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>$.XLMRobertaForTokenClassification,XLMRobertaModel:()=>$.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>$.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>W.XLMRobertaTokenizer,XLMTokenizer:()=>W.XLMTokenizer,XLMWithLMHeadModel:()=>$.XLMWithLMHeadModel,XVectorOutput:()=>$.XVectorOutput,YolosFeatureExtractor:()=>R.YolosFeatureExtractor,YolosForObjectDetection:()=>$.YolosForObjectDetection,YolosImageProcessor:()=>R.YolosImageProcessor,YolosModel:()=>$.YolosModel,YolosObjectDetectionOutput:()=>$.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>$.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>Z.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>Z.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>Z.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>Z.ZeroShotObjectDetectionPipeline,bankers_round:()=>E.bankers_round,cat:()=>q.cat,cos_sim:()=>E.cos_sim,dot:()=>E.dot,dynamic_time_warping:()=>E.dynamic_time_warping,env:()=>J.env,full:()=>q.full,full_like:()=>q.full_like,getCacheShapes:()=>Q.getCacheShapes,hamming:()=>Y.hamming,hanning:()=>Y.hanning,interpolate:()=>q.interpolate,interpolate_4d:()=>q.interpolate_4d,interpolate_data:()=>E.interpolate_data,is_chinese_char:()=>W.is_chinese_char,layer_norm:()=>q.layer_norm,load_image:()=>H.load_image,load_video:()=>G.load_video,log_softmax:()=>E.log_softmax,magnitude:()=>E.magnitude,matmul:()=>q.matmul,max:()=>E.max,mean:()=>q.mean,mean_pooling:()=>q.mean_pooling,medianFilter:()=>E.medianFilter,mel_filter_bank:()=>Y.mel_filter_bank,min:()=>E.min,ones:()=>q.ones,ones_like:()=>q.ones_like,permute:()=>q.permute,permute_data:()=>E.permute_data,pipeline:()=>Z.pipeline,quantize_embeddings:()=>q.quantize_embeddings,rand:()=>q.rand,read_audio:()=>Y.read_audio,rfft:()=>q.rfft,round:()=>E.round,slice:()=>q.slice,softmax:()=>E.softmax,spectrogram:()=>Y.spectrogram,stack:()=>q.stack,std_mean:()=>q.std_mean,topk:()=>q.topk,window_function:()=>Y.window_function,zeros:()=>q.zeros,zeros_like:()=>q.zeros_like});var J=R6("./src/env.js");/*! ./env.js */var Z=R6("./src/pipelines.js");/*! ./pipelines.js */var $=R6("./src/models.js");/*! ./models.js */var W=R6("./src/tokenizers.js");/*! ./tokenizers.js */var Q=R6("./src/configs.js");/*! ./configs.js */var Y=R6("./src/utils/audio.js");/*! ./utils/audio.js */var H=R6("./src/utils/image.js");/*! ./utils/image.js */var G=R6("./src/utils/video.js");/*! ./utils/video.js */var q=R6("./src/utils/tensor.js");/*! ./utils/tensor.js */var E=R6("./src/utils/maths.js");/*! ./utils/maths.js */var V=R6("./src/base/feature_extraction_utils.js");/*! ./base/feature_extraction_utils.js */var N=R6("./src/models/feature_extractors.js");/*! ./models/feature_extractors.js */var z=R6("./src/models/auto/feature_extraction_auto.js");/*! ./models/auto/feature_extraction_auto.js */var w=R6("./src/base/image_processors_utils.js");/*! ./base/image_processors_utils.js */var R=R6("./src/models/image_processors.js");/*! ./models/image_processors.js */var y=R6("./src/models/auto/image_processing_auto.js");/*! ./models/auto/image_processing_auto.js */var D=R6("./src/base/processing_utils.js");/*! ./base/processing_utils.js */var j=R6("./src/models/processors.js");/*! ./models/processors.js */var v=R6("./src/models/auto/processing_auto.js");/*! ./models/auto/processing_auto.js */var g=R6("./src/generation/streamers.js");/*! ./generation/streamers.js */var A=R6("./src/generation/stopping_criteria.js");/*! ./generation/stopping_criteria.js */var T=R6("./src/generation/logits_process.js");/*! ./generation/logits_process.js */})();var{ASTFeatureExtractor:SB,ASTForAudioClassification:MB,ASTModel:TB,ASTPreTrainedModel:kB,AlbertForMaskedLM:_B,AlbertForQuestionAnswering:xB,AlbertForSequenceClassification:yB,AlbertModel:vB,AlbertPreTrainedModel:OB,AlbertTokenizer:bB,ArceeForCausalLM:hB,ArceeModel:fB,ArceePreTrainedModel:dB,AudioClassificationPipeline:uB,AutoConfig:gB,AutoFeatureExtractor:lB,AutoImageProcessor:cB,AutoModel:mB,AutoModelForAudioClassification:aB,AutoModelForAudioFrameClassification:pB,AutoModelForAudioTextToText:rB,AutoModelForCTC:eB,AutoModelForCausalLM:nB,AutoModelForDepthEstimation:sB,AutoModelForDocumentQuestionAnswering:iB,AutoModelForImageClassification:tB,AutoModelForImageFeatureExtraction:oB,AutoModelForImageMatting:JF,AutoModelForImageSegmentation:$F,AutoModelForImageTextToText:ZF,AutoModelForImageToImage:WF,AutoModelForMaskGeneration:QF,AutoModelForMaskedLM:KF,AutoModelForNormalEstimation:YF,AutoModelForObjectDetection:GF,AutoModelForPoseEstimation:XF,AutoModelForQuestionAnswering:qF,AutoModelForSemanticSegmentation:HF,AutoModelForSeq2SeqLM:UF,AutoModelForSequenceClassification:VF,AutoModelForSpeechSeq2Seq:NF,AutoModelForTextToSpectrogram:zF,AutoModelForTextToWaveform:EF,AutoModelForTokenClassification:LF,AutoModelForUniversalSegmentation:AF,AutoModelForVision2Seq:BF,AutoModelForXVector:FF,AutoModelForZeroShotObjectDetection:RF,AutoProcessor:IF,AutoTokenizer:lU,AutomaticSpeechRecognitionPipeline:DF,BackgroundRemovalPipeline:wF,BartForConditionalGeneration:jF,BartForSequenceClassification:PF,BartModel:CF,BartPretrainedModel:SF,BartTokenizer:MF,BaseModelOutput:TF,BaseStreamer:kF,BeitFeatureExtractor:_F,BeitForImageClassification:xF,BeitModel:yF,BeitPreTrainedModel:vF,BertForMaskedLM:OF,BertForQuestionAnswering:bF,BertForSequenceClassification:hF,BertForTokenClassification:fF,BertModel:dF,BertPreTrainedModel:uF,BertTokenizer:gF,BitImageProcessor:lF,BlenderbotForConditionalGeneration:cF,BlenderbotModel:mF,BlenderbotPreTrainedModel:aF,BlenderbotSmallForConditionalGeneration:pF,BlenderbotSmallModel:rF,BlenderbotSmallPreTrainedModel:eF,BlenderbotSmallTokenizer:nF,BlenderbotTokenizer:sF,BloomForCausalLM:iF,BloomModel:tF,BloomPreTrainedModel:oF,BloomTokenizer:JR,CLIPFeatureExtractor:$R,CLIPImageProcessor:ZR,CLIPModel:WR,CLIPPreTrainedModel:QR,CLIPSegForImageSegmentation:KR,CLIPSegModel:YR,CLIPSegPreTrainedModel:GR,CLIPTextModel:XR,CLIPTextModelWithProjection:qR,CLIPTokenizer:HR,CLIPVisionModel:UR,CLIPVisionModelWithProjection:VR,CamembertForMaskedLM:NR,CamembertForQuestionAnswering:zR,CamembertForSequenceClassification:ER,CamembertForTokenClassification:LR,CamembertModel:AR,CamembertPreTrainedModel:BR,CamembertTokenizer:FR,CausalLMOutput:RR,CausalLMOutputWithPast:IR,ChineseCLIPFeatureExtractor:DR,ChineseCLIPModel:wR,ChineseCLIPPreTrainedModel:jR,ClapAudioModelWithProjection:PR,ClapFeatureExtractor:CR,ClapModel:SR,ClapPreTrainedModel:MR,ClapTextModelWithProjection:TR,ClassifierFreeGuidanceLogitsProcessor:kR,CodeGenForCausalLM:_R,CodeGenModel:xR,CodeGenPreTrainedModel:yR,CodeGenTokenizer:vR,CodeLlamaTokenizer:OR,CohereForCausalLM:bR,CohereModel:hR,CoherePreTrainedModel:fR,CohereTokenizer:dR,ConvBertForMaskedLM:uR,ConvBertForQuestionAnswering:gR,ConvBertForSequenceClassification:lR,ConvBertForTokenClassification:cR,ConvBertModel:mR,ConvBertPreTrainedModel:aR,ConvBertTokenizer:pR,ConvNextFeatureExtractor:rR,ConvNextForImageClassification:eR,ConvNextImageProcessor:nR,ConvNextModel:sR,ConvNextPreTrainedModel:iR,ConvNextV2ForImageClassification:tR,ConvNextV2Model:oR,ConvNextV2PreTrainedModel:J1,DFineForObjectDetection:$1,DFineModel:Z1,DFinePreTrainedModel:W1,DINOv3ConvNextModel:Q1,DINOv3ConvNextPreTrainedModel:K1,DINOv3ViTImageProcessor:Y1,DINOv3ViTModel:G1,DINOv3ViTPreTrainedModel:X1,DPTFeatureExtractor:q1,DPTForDepthEstimation:H1,DPTImageProcessor:U1,DPTModel:V1,DPTPreTrainedModel:N1,DacDecoderModel:z1,DacDecoderOutput:E1,DacEncoderModel:L1,DacEncoderOutput:A1,DacFeatureExtractor:B1,DacModel:F1,DacPreTrainedModel:R1,DataTypeMap:I1,DebertaForMaskedLM:D1,DebertaForQuestionAnswering:w1,DebertaForSequenceClassification:j1,DebertaForTokenClassification:P1,DebertaModel:C1,DebertaPreTrainedModel:S1,DebertaTokenizer:M1,DebertaV2ForMaskedLM:T1,DebertaV2ForQuestionAnswering:k1,DebertaV2ForSequenceClassification:_1,DebertaV2ForTokenClassification:x1,DebertaV2Model:y1,DebertaV2PreTrainedModel:v1,DebertaV2Tokenizer:O1,DecisionTransformerModel:b1,DecisionTransformerPreTrainedModel:h1,DeiTFeatureExtractor:f1,DeiTForImageClassification:d1,DeiTImageProcessor:u1,DeiTModel:g1,DeiTPreTrainedModel:l1,DepthAnythingForDepthEstimation:c1,DepthAnythingPreTrainedModel:m1,DepthEstimationPipeline:a1,DepthProForDepthEstimation:p1,DepthProPreTrainedModel:r1,DetrFeatureExtractor:e1,DetrForObjectDetection:n1,DetrForSegmentation:s1,DetrImageProcessor:i1,DetrModel:t1,DetrObjectDetectionOutput:o1,DetrPreTrainedModel:JI,DetrSegmentationOutput:$I,Dinov2ForImageClassification:ZI,Dinov2Model:WI,Dinov2PreTrainedModel:QI,Dinov2WithRegistersForImageClassification:KI,Dinov2WithRegistersModel:YI,Dinov2WithRegistersPreTrainedModel:GI,DistilBertForMaskedLM:XI,DistilBertForQuestionAnswering:qI,DistilBertForSequenceClassification:HI,DistilBertForTokenClassification:UI,DistilBertModel:VI,DistilBertPreTrainedModel:NI,DistilBertTokenizer:zI,DocumentQuestionAnsweringPipeline:EI,DonutFeatureExtractor:LI,DonutImageProcessor:AI,DonutSwinModel:BI,DonutSwinPreTrainedModel:FI,EfficientNetForImageClassification:RI,EfficientNetImageProcessor:II,EfficientNetModel:DI,EfficientNetPreTrainedModel:wI,ElectraForMaskedLM:jI,ElectraForQuestionAnswering:PI,ElectraForSequenceClassification:CI,ElectraForTokenClassification:SI,ElectraModel:MI,ElectraPreTrainedModel:TI,ElectraTokenizer:kI,EncodecFeatureExtractor:_I,EosTokenCriteria:xI,Ernie4_5_ForCausalLM:yI,Ernie4_5_Model:vI,Ernie4_5_PretrainedModel:OI,Ernie4_5_Tokenizer:bI,EsmForMaskedLM:hI,EsmForSequenceClassification:fI,EsmForTokenClassification:dI,EsmModel:uI,EsmPreTrainedModel:gI,EsmTokenizer:lI,ExaoneForCausalLM:cI,ExaoneModel:mI,ExaonePreTrainedModel:aI,FFT:pI,FalconForCausalLM:rI,FalconModel:eI,FalconPreTrainedModel:nI,FalconTokenizer:sI,FastViTForImageClassification:iI,FastViTModel:tI,FastViTPreTrainedModel:oI,FeatureExtractionPipeline:JD,FeatureExtractor:$D,FillMaskPipeline:ZD,Florence2ForConditionalGeneration:WD,Florence2PreTrainedModel:QD,Florence2Processor:KD,ForcedBOSTokenLogitsProcessor:YD,ForcedEOSTokenLogitsProcessor:GD,GLPNFeatureExtractor:XD,GLPNForDepthEstimation:qD,GLPNModel:HD,GLPNPreTrainedModel:UD,GPT2LMHeadModel:VD,GPT2Model:ND,GPT2PreTrainedModel:zD,GPT2Tokenizer:ED,GPTBigCodeForCausalLM:LD,GPTBigCodeModel:AD,GPTBigCodePreTrainedModel:BD,GPTJForCausalLM:FD,GPTJModel:RD,GPTJPreTrainedModel:ID,GPTNeoForCausalLM:DD,GPTNeoModel:wD,GPTNeoPreTrainedModel:jD,GPTNeoXForCausalLM:PD,GPTNeoXModel:CD,GPTNeoXPreTrainedModel:SD,GPTNeoXTokenizer:MD,Gemma2ForCausalLM:TD,Gemma2Model:kD,Gemma2PreTrainedModel:_D,Gemma3ForCausalLM:xD,Gemma3Model:yD,Gemma3PreTrainedModel:vD,Gemma3nAudioFeatureExtractor:OD,Gemma3nForConditionalGeneration:bD,Gemma3nPreTrainedModel:hD,Gemma3nProcessor:fD,GemmaForCausalLM:dD,GemmaModel:uD,GemmaPreTrainedModel:gD,GemmaTokenizer:lD,GlmForCausalLM:cD,GlmModel:mD,GlmPreTrainedModel:aD,GraniteForCausalLM:pD,GraniteModel:rD,GraniteMoeHybridForCausalLM:eD,GraniteMoeHybridModel:nD,GraniteMoeHybridPreTrainedModel:sD,GranitePreTrainedModel:iD,Grok1Tokenizer:tD,GroundingDinoForObjectDetection:oD,GroundingDinoImageProcessor:J2,GroundingDinoPreTrainedModel:$2,GroundingDinoProcessor:Z2,GroupViTModel:W2,GroupViTPreTrainedModel:Q2,HeliumForCausalLM:K2,HeliumModel:Y2,HeliumPreTrainedModel:G2,HerbertTokenizer:X2,HieraForImageClassification:q2,HieraModel:H2,HieraPreTrainedModel:U2,HubertForCTC:V2,HubertForSequenceClassification:N2,HubertModel:z2,HubertPreTrainedModel:E2,IJepaForImageClassification:L2,IJepaModel:A2,IJepaPreTrainedModel:B2,Idefics3ForConditionalGeneration:F2,Idefics3ImageProcessor:R2,Idefics3PreTrainedModel:I2,Idefics3Processor:D2,ImageClassificationPipeline:w2,ImageFeatureExtractionPipeline:j2,ImageFeatureExtractor:P2,ImageMattingOutput:C2,ImageProcessor:S2,ImageSegmentationPipeline:M2,ImageToImagePipeline:T2,ImageToTextPipeline:k2,InterruptableStoppingCriteria:_2,JAISLMHeadModel:x2,JAISModel:y2,JAISPreTrainedModel:v2,JinaCLIPImageProcessor:O2,JinaCLIPModel:b2,JinaCLIPPreTrainedModel:h2,JinaCLIPProcessor:f2,JinaCLIPTextModel:d2,JinaCLIPVisionModel:u2,Lfm2ForCausalLM:g2,Lfm2Model:l2,Lfm2PreTrainedModel:c2,LiteWhisperForConditionalGeneration:m2,Llama4ForCausalLM:a2,Llama4PreTrainedModel:p2,LlamaForCausalLM:r2,LlamaModel:e2,LlamaPreTrainedModel:n2,LlamaTokenizer:s2,LlavaForConditionalGeneration:i2,LlavaOnevisionForConditionalGeneration:t2,LlavaOnevisionImageProcessor:o2,LlavaPreTrainedModel:Jw,LlavaProcessor:$w,LlavaQwen2ForCausalLM:Zw,LogitsProcessor:Ww,LogitsProcessorList:Qw,LogitsWarper:Kw,LongT5ForConditionalGeneration:Yw,LongT5Model:Gw,LongT5PreTrainedModel:Xw,M2M100ForConditionalGeneration:qw,M2M100Model:Hw,M2M100PreTrainedModel:Uw,M2M100Tokenizer:Vw,MBart50Tokenizer:Nw,MBartForCausalLM:zw,MBartForConditionalGeneration:Ew,MBartForSequenceClassification:Lw,MBartModel:Aw,MBartPreTrainedModel:Bw,MBartTokenizer:Fw,MPNetForMaskedLM:Rw,MPNetForQuestionAnswering:Iw,MPNetForSequenceClassification:Dw,MPNetForTokenClassification:ww,MPNetModel:jw,MPNetPreTrainedModel:Pw,MPNetTokenizer:Cw,MT5ForConditionalGeneration:Sw,MT5Model:Mw,MT5PreTrainedModel:Tw,MarianMTModel:kw,MarianModel:_w,MarianPreTrainedModel:xw,MarianTokenizer:yw,Mask2FormerImageProcessor:vw,MaskFormerFeatureExtractor:Ow,MaskFormerForInstanceSegmentation:bw,MaskFormerImageProcessor:hw,MaskFormerModel:fw,MaskFormerPreTrainedModel:dw,MaskedLMOutput:uw,MaxLengthCriteria:gw,Metric3DForDepthEstimation:lw,Metric3DPreTrainedModel:cw,Metric3Dv2ForDepthEstimation:mw,Metric3Dv2PreTrainedModel:aw,MgpstrForSceneTextRecognition:pw,MgpstrModelOutput:rw,MgpstrPreTrainedModel:ew,MgpstrProcessor:nw,MgpstrTokenizer:sw,MimiDecoderModel:iw,MimiDecoderOutput:tw,MimiEncoderModel:ow,MimiEncoderOutput:Jj,MimiModel:$j,MimiPreTrainedModel:Zj,MinLengthLogitsProcessor:Wj,MinNewTokensLengthLogitsProcessor:Qj,MistralForCausalLM:Kj,MistralModel:Yj,MistralPreTrainedModel:Gj,MobileBertForMaskedLM:Xj,MobileBertForQuestionAnswering:qj,MobileBertForSequenceClassification:Hj,MobileBertModel:Uj,MobileBertPreTrainedModel:Vj,MobileBertTokenizer:Nj,MobileLLMForCausalLM:zj,MobileLLMModel:Ej,MobileLLMPreTrainedModel:Lj,MobileNetV1FeatureExtractor:Aj,MobileNetV1ForImageClassification:Bj,MobileNetV1ForSemanticSegmentation:Fj,MobileNetV1ImageProcessor:Rj,MobileNetV1Model:Ij,MobileNetV1PreTrainedModel:Dj,MobileNetV2FeatureExtractor:wj,MobileNetV2ForImageClassification:jj,MobileNetV2ForSemanticSegmentation:Pj,MobileNetV2ImageProcessor:Cj,MobileNetV2Model:Sj,MobileNetV2PreTrainedModel:Mj,MobileNetV3FeatureExtractor:Tj,MobileNetV3ForImageClassification:kj,MobileNetV3ForSemanticSegmentation:_j,MobileNetV3ImageProcessor:xj,MobileNetV3Model:yj,MobileNetV3PreTrainedModel:vj,MobileNetV4FeatureExtractor:Oj,MobileNetV4ForImageClassification:bj,MobileNetV4ForSemanticSegmentation:hj,MobileNetV4ImageProcessor:fj,MobileNetV4Model:dj,MobileNetV4PreTrainedModel:uj,MobileViTFeatureExtractor:gj,MobileViTForImageClassification:lj,MobileViTImageProcessor:cj,MobileViTModel:mj,MobileViTPreTrainedModel:aj,MobileViTV2ForImageClassification:pj,MobileViTV2Model:rj,MobileViTV2PreTrainedModel:ej,ModelOutput:nj,ModernBertDecoderForCausalLM:sj,ModernBertDecoderModel:ij,ModernBertDecoderPreTrainedModel:tj,ModernBertForMaskedLM:oj,ModernBertForSequenceClassification:JP,ModernBertForTokenClassification:$P,ModernBertModel:ZP,ModernBertPreTrainedModel:WP,Moondream1ForConditionalGeneration:QP,MoonshineFeatureExtractor:KP,MoonshineForConditionalGeneration:YP,MoonshineModel:GP,MoonshinePreTrainedModel:XP,MoonshineProcessor:qP,MptForCausalLM:HP,MptModel:UP,MptPreTrainedModel:VP,MultiModalityCausalLM:NP,MultiModalityPreTrainedModel:zP,MusicgenForCausalLM:EP,MusicgenForConditionalGeneration:LP,MusicgenModel:AP,MusicgenPreTrainedModel:BP,NanoChatForCausalLM:FP,NanoChatModel:RP,NanoChatPreTrainedModel:IP,NeoBertForMaskedLM:DP,NeoBertForQuestionAnswering:wP,NeoBertForSequenceClassification:jP,NeoBertForTokenClassification:PP,NeoBertModel:CP,NeoBertPreTrainedModel:SP,NllbTokenizer:MP,NoBadWordsLogitsProcessor:TP,NoRepeatNGramLogitsProcessor:kP,NomicBertModel:_P,NomicBertPreTrainedModel:xP,NougatImageProcessor:yP,NougatTokenizer:vP,OPTForCausalLM:OP,OPTModel:bP,OPTPreTrainedModel:hP,ObjectDetectionPipeline:fP,Olmo2ForCausalLM:dP,Olmo2Model:uP,Olmo2PreTrainedModel:gP,OlmoForCausalLM:lP,OlmoModel:cP,OlmoPreTrainedModel:mP,OpenELMForCausalLM:aP,OpenELMModel:pP,OpenELMPreTrainedModel:rP,OwlViTFeatureExtractor:eP,OwlViTForObjectDetection:nP,OwlViTImageProcessor:sP,OwlViTModel:iP,OwlViTPreTrainedModel:tP,OwlViTProcessor:oP,Owlv2ForObjectDetection:JC,Owlv2ImageProcessor:$C,Owlv2Model:ZC,Owlv2PreTrainedModel:WC,PaliGemmaForConditionalGeneration:QC,PaliGemmaPreTrainedModel:KC,PaliGemmaProcessor:YC,ParakeetFeatureExtractor:GC,ParakeetForCTC:XC,ParakeetPreTrainedModel:qC,PatchTSMixerForPrediction:HC,PatchTSMixerModel:UC,PatchTSMixerPreTrainedModel:VC,PatchTSTForPrediction:NC,PatchTSTModel:zC,PatchTSTPreTrainedModel:EC,Phi3ForCausalLM:LC,Phi3Model:AC,Phi3PreTrainedModel:BC,Phi3VForCausalLM:FC,Phi3VImageProcessor:RC,Phi3VPreTrainedModel:IC,Phi3VProcessor:DC,PhiForCausalLM:wC,PhiModel:jC,PhiPreTrainedModel:PC,Pipeline:CC,PreTrainedModel:SC,PreTrainedTokenizer:MC,PretrainedConfig:TC,PretrainedMixin:kC,Processor:_C,PvtForImageClassification:xC,PvtImageProcessor:yC,PvtModel:vC,PvtPreTrainedModel:OC,PyAnnoteFeatureExtractor:bC,PyAnnoteForAudioFrameClassification:hC,PyAnnoteModel:fC,PyAnnotePreTrainedModel:dC,PyAnnoteProcessor:uC,QuestionAnsweringModelOutput:gC,QuestionAnsweringPipeline:lC,Qwen2ForCausalLM:cC,Qwen2Model:mC,Qwen2PreTrainedModel:aC,Qwen2Tokenizer:pC,Qwen2VLForConditionalGeneration:rC,Qwen2VLImageProcessor:eC,Qwen2VLPreTrainedModel:nC,Qwen2VLProcessor:sC,Qwen3ForCausalLM:iC,Qwen3Model:tC,Qwen3PreTrainedModel:oC,RFDetrForObjectDetection:JS,RFDetrModel:$S,RFDetrObjectDetectionOutput:ZS,RFDetrPreTrainedModel:WS,RTDetrForObjectDetection:QS,RTDetrImageProcessor:KS,RTDetrModel:YS,RTDetrObjectDetectionOutput:GS,RTDetrPreTrainedModel:XS,RTDetrV2ForObjectDetection:qS,RTDetrV2Model:HS,RTDetrV2ObjectDetectionOutput:US,RTDetrV2PreTrainedModel:VS,RawAudio:NS,RawImage:zS,RawVideo:ES,RawVideoFrame:LS,RepetitionPenaltyLogitsProcessor:AS,ResNetForImageClassification:BS,ResNetModel:FS,ResNetPreTrainedModel:RS,RoFormerForMaskedLM:IS,RoFormerForQuestionAnswering:DS,RoFormerForSequenceClassification:wS,RoFormerForTokenClassification:jS,RoFormerModel:PS,RoFormerPreTrainedModel:CS,RoFormerTokenizer:SS,RobertaForMaskedLM:MS,RobertaForQuestionAnswering:TS,RobertaForSequenceClassification:kS,RobertaForTokenClassification:_S,RobertaModel:xS,RobertaPreTrainedModel:yS,RobertaTokenizer:vS,SamImageProcessor:OS,SamImageSegmentationOutput:bS,SamModel:hS,SamPreTrainedModel:fS,SamProcessor:dS,SapiensForDepthEstimation:uS,SapiensForNormalEstimation:gS,SapiensForSemanticSegmentation:lS,SapiensPreTrainedModel:cS,SeamlessM4TFeatureExtractor:mS,SegformerFeatureExtractor:aS,SegformerForImageClassification:pS,SegformerForSemanticSegmentation:rS,SegformerImageProcessor:eS,SegformerModel:nS,SegformerPreTrainedModel:sS,Seq2SeqLMOutput:iS,SequenceClassifierOutput:tS,SiglipImageProcessor:oS,SiglipModel:JM,SiglipPreTrainedModel:$M,SiglipTextModel:ZM,SiglipTokenizer:WM,SiglipVisionModel:QM,SmolLM3ForCausalLM:KM,SmolLM3Model:YM,SmolLM3PreTrainedModel:GM,SmolVLMForConditionalGeneration:XM,SmolVLMImageProcessor:qM,SmolVLMProcessor:HM,SnacDecoderModel:UM,SnacEncoderModel:VM,SnacFeatureExtractor:NM,SnacModel:zM,SnacPreTrainedModel:EM,SpeechT5FeatureExtractor:LM,SpeechT5ForSpeechToText:AM,SpeechT5ForTextToSpeech:BM,SpeechT5HifiGan:FM,SpeechT5Model:RM,SpeechT5PreTrainedModel:IM,SpeechT5Processor:DM,SpeechT5Tokenizer:wM,SqueezeBertForMaskedLM:jM,SqueezeBertForQuestionAnswering:PM,SqueezeBertForSequenceClassification:CM,SqueezeBertModel:SM,SqueezeBertPreTrainedModel:MM,SqueezeBertTokenizer:TM,StableLmForCausalLM:kM,StableLmModel:_M,StableLmPreTrainedModel:xM,Starcoder2ForCausalLM:yM,Starcoder2Model:vM,Starcoder2PreTrainedModel:OM,StoppingCriteria:bM,StoppingCriteriaList:hM,StyleTextToSpeech2Model:fM,StyleTextToSpeech2PreTrainedModel:dM,SummarizationPipeline:uM,SuppressTokensAtBeginLogitsProcessor:gM,Swin2SRForImageSuperResolution:lM,Swin2SRImageProcessor:cM,Swin2SRModel:mM,Swin2SRPreTrainedModel:aM,SwinForImageClassification:pM,SwinForSemanticSegmentation:rM,SwinModel:eM,SwinPreTrainedModel:nM,T5ForConditionalGeneration:sM,T5Model:iM,T5PreTrainedModel:tM,T5Tokenizer:oM,TableTransformerForObjectDetection:JT,TableTransformerModel:$T,TableTransformerObjectDetectionOutput:ZT,TableTransformerPreTrainedModel:WT,TemperatureLogitsWarper:QT,Tensor:KT,Text2TextGenerationPipeline:YT,TextClassificationPipeline:GT,TextGenerationPipeline:XT,TextStreamer:qT,TextToAudioPipeline:HT,TokenClassificationPipeline:UT,TokenClassifierOutput:VT,TokenizerModel:NT,TopKLogitsWarper:zT,TopPLogitsWarper:ET,TrOCRForCausalLM:LT,TrOCRPreTrainedModel:AT,TranslationPipeline:BT,UltravoxModel:FT,UltravoxPreTrainedModel:RT,UltravoxProcessor:IT,UniSpeechForCTC:DT,UniSpeechForSequenceClassification:wT,UniSpeechModel:jT,UniSpeechPreTrainedModel:PT,UniSpeechSatForAudioFrameClassification:CT,UniSpeechSatForCTC:ST,UniSpeechSatForSequenceClassification:MT,UniSpeechSatModel:TT,UniSpeechSatPreTrainedModel:kT,VLChatProcessor:_T,VLMImageProcessor:xT,VaultGemmaForCausalLM:yT,VaultGemmaModel:vT,VaultGemmaPreTrainedModel:OT,ViTFeatureExtractor:bT,ViTForImageClassification:hT,ViTImageProcessor:fT,ViTMAEModel:dT,ViTMAEPreTrainedModel:uT,ViTMSNForImageClassification:gT,ViTMSNModel:lT,ViTMSNPreTrainedModel:cT,ViTModel:mT,ViTPreTrainedModel:aT,VisionEncoderDecoderModel:pT,VitMatteForImageMatting:rT,VitMatteImageProcessor:eT,VitMattePreTrainedModel:nT,VitPoseForPoseEstimation:sT,VitPoseImageProcessor:iT,VitPosePreTrainedModel:tT,VitsModel:oT,VitsModelOutput:Jk,VitsPreTrainedModel:$k,VitsTokenizer:Zk,VoxtralForConditionalGeneration:Wk,VoxtralProcessor:Qk,Wav2Vec2BertForCTC:Kk,Wav2Vec2BertForSequenceClassification:Yk,Wav2Vec2BertModel:Gk,Wav2Vec2BertPreTrainedModel:Xk,Wav2Vec2CTCTokenizer:qk,Wav2Vec2FeatureExtractor:Hk,Wav2Vec2ForAudioFrameClassification:Uk,Wav2Vec2ForCTC:Vk,Wav2Vec2ForSequenceClassification:Nk,Wav2Vec2Model:zk,Wav2Vec2PreTrainedModel:Ek,Wav2Vec2Processor:Lk,Wav2Vec2ProcessorWithLM:Ak,WavLMForAudioFrameClassification:Bk,WavLMForCTC:Fk,WavLMForSequenceClassification:Rk,WavLMForXVector:Ik,WavLMModel:Dk,WavLMPreTrainedModel:wk,WeSpeakerFeatureExtractor:jk,WeSpeakerResNetModel:Pk,WeSpeakerResNetPreTrainedModel:Ck,WhisperFeatureExtractor:Sk,WhisperForConditionalGeneration:Mk,WhisperModel:Tk,WhisperPreTrainedModel:kk,WhisperProcessor:_k,WhisperTextStreamer:xk,WhisperTimeStampLogitsProcessor:yk,WhisperTokenizer:vk,XLMForQuestionAnswering:Ok,XLMForSequenceClassification:bk,XLMForTokenClassification:hk,XLMModel:fk,XLMPreTrainedModel:dk,XLMRobertaForMaskedLM:uk,XLMRobertaForQuestionAnswering:gk,XLMRobertaForSequenceClassification:lk,XLMRobertaForTokenClassification:ck,XLMRobertaModel:mk,XLMRobertaPreTrainedModel:ak,XLMRobertaTokenizer:pk,XLMTokenizer:rk,XLMWithLMHeadModel:ek,XVectorOutput:nk,YolosFeatureExtractor:sk,YolosForObjectDetection:ik,YolosImageProcessor:tk,YolosModel:ok,YolosObjectDetectionOutput:J_,YolosPreTrainedModel:$_,ZeroShotAudioClassificationPipeline:Z_,ZeroShotClassificationPipeline:W_,ZeroShotImageClassificationPipeline:Q_,ZeroShotObjectDetectionPipeline:K_,bankers_round:Y_,cat:G_,cos_sim:X_,dot:q_,dynamic_time_warping:H_,env:U_,full:V_,full_like:N_,getCacheShapes:z_,hamming:E_,hanning:L_,interpolate:A_,interpolate_4d:B_,interpolate_data:F_,is_chinese_char:R_,layer_norm:I_,load_image:D_,load_video:w_,log_softmax:j_,magnitude:P_,matmul:C_,max:S_,mean:M_,mean_pooling:T_,medianFilter:k_,mel_filter_bank:__,min:x_,ones:y_,ones_like:v_,permute:O_,permute_data:b_,pipeline:h_,quantize_embeddings:f_,rand:d_,read_audio:u_,rfft:g_,round:l_,slice:c_,softmax:m_,spectrogram:a_,stack:p_,std_mean:r_,topk:e_,window_function:n_,zeros:s_,zeros_like:i_}=K;class OY{tokenizer;initialized=!1;modelPath;constructor(J={}){this.modelPath=J.modelPath||"./models/starcoder2"}async initialize(){if(this.initialized)return;try{this.tokenizer=await lU.from_pretrained(this.modelPath),this.initialized=!0}catch(J){throw Error(`Tokenizer initialization failed: ${J.message}`)}}async tokenize(J){if(!this.initialized)await this.initialize();let Z=Date.now();try{let W=(await this.tokenizer(J)).input_ids.tolist()[0],Q=await this.tokenizer.decode(W),Y=await this.createDirectTokens(Q,W),H=Date.now()-Z;return{tokens:Y,metadata:{totalTokens:Y.length,vocabSize:49152,processingTime:H,averageConfidence:0.95},raw:{inputIds:W,decodedText:Q}}}catch($){throw Error(`Tokenization failed: ${$.message}`)}}async createDirectTokens(J,Z){let $=[];for(let W=0;W<Z.length;W++){let Q=Z[W];try{let H=(await this.tokenizer.decode([Q],{skip_special_tokens:!0})).trim().toLowerCase();if(H.length>0)$.push({text:H,id:Q,score:1,confidence:1,relevance:"high"})}catch(Y){continue}}return $}async getTopTokens(J,Z=20){return(await this.tokenize(J)).tokens.slice(0,Z)}async getTechnicalTokens(J){return(await this.tokenize(J)).tokens}async decode(J){if(!this.initialized)throw Error("Tokenizer not initialized. Call initialize() first.");return await this.tokenizer.decode(J)}async encode(J){if(!this.initialized)throw Error("Tokenizer not initialized. Call initialize() first.");return(await this.tokenizer(J)).input_ids.tolist()[0]}}async function tx(J,Z){try{let $=await J.getAllCodebaseFiles();if(Z){if(Z.file_extensions&&Z.file_extensions.length>0)$=$.filter((H)=>Z.file_extensions?.some((G)=>H.path.endsWith(G)));if(Z.path_filter)$=$.filter((H)=>H.path.includes(Z.path_filter));if(Z.exclude_paths&&Z.exclude_paths.length>0)$=$.filter((H)=>!Z.exclude_paths?.some((G)=>H.path.includes(G)))}if($.length===0)return null;let W=[];for(let H of $){let G=await J.getTFIDFDocument(H.path);if(G){let q=await J.getTFIDFTerms(H.path),E=new Map,V=new Map;for(let[z,w]of Object.entries(q))E.set(z,w);let N=G.rawTerms||{};for(let[z,w]of Object.entries(N))V.set(z,w);W.push({uri:`file://${H.path}`,terms:E,rawTerms:V,magnitude:G.magnitude})}}if(W.length===0)return null;let Q=await J.getIDFValues(),Y=new Map;for(let[H,G]of Object.entries(Q))Y.set(H,G);return{documents:W,idf:Y,totalDocuments:W.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch($){return console.error("[ERROR] Failed to build search index from database:",$),null}}function IL(J){let Z=Array.from(J.values()).reduce((W,Q)=>W+Q,0),$=new Map;for(let[W,Q]of J.entries())$.set(W,Q/Z);return $}function DL(J,Z){let $=new Map;for(let Q of J){let Y=new Set(Q.keys());for(let H of Y)$.set(H,($.get(H)||0)+1)}let W=new Map;for(let[Q,Y]of $.entries())W.set(Q,Math.log(Z/Y));return W}function wL(J,Z){let $=new Map;for(let[W,Q]of J.entries()){let Y=Z.get(W)||0;$.set(W,Q*Y)}return $}function mU(J){let Z=0;for(let $ of J.values())Z+=$*$;return Math.sqrt(Z)}var Y8=null,cU=!1;async function aU(){if(!Y8)console.log("\uD83D\uDD27 Initializing advanced tokenizer (once per session)..."),Y8=new OY({modelPath:"./models/starcoder2"});if(!cU){let{log:J,error:Z}=console;console.log=()=>{},console.error=()=>{};try{await Y8.initialize(),cU=!0,console.log("✅ Tokenizer initialized successfully")}finally{console.log=J,console.error=Z}}return Y8}async function jL(J){let $=await(await aU()).tokenize(J),W=new Map;for(let Q of $.tokens){let Y=Q.text.toLowerCase(),H=W.get(Y)||0;W.set(Y,H+Q.score)}return W}async function pU(J){let $=await(await aU()).tokenize(J),W=new Map;for(let Q of $.tokens){let Y=Q.text.toLowerCase();if(!W.has(Y)||Q.score>0.8)W.set(Y,Q.text)}return Array.from(W.values())}async function ox(J){console.log(`\uD83D\uDD24 Building search index with advanced tokenizer (${J.length} documents)...`);let Z=1,$=[];for(let Y=0;Y<J.length;Y+=Z){let H=J.slice(Y,Y+Z),G=Math.floor(Y/Z)+1,q=Math.ceil(J.length/Z);console.log(`\uD83D\uDD24 Batch ${G}/${q} (${H.length} docs)...`),console.log(`\uD83D\uDCC4 Files: ${H.map((z)=>z.uri.split("/").pop()).join(", ")}`);let E=Date.now(),V=[];for(let z=0;z<H.length;z++){let w=H[z],R=Date.now();try{let y=await jL(w.content),D=Date.now()-R;console.log(`   \uD83D\uDCC4 ${G}-${z+1}: ${D}ms`),V.push({uri:w.uri,terms:y})}catch(y){console.log(`   ⚠️ ${G}-${z+1}: Skipped (${y instanceof Error?y.message:"Unknown error"})`),V.push({uri:w.uri,terms:new Map})}}let N=Date.now()-E;$.push(...V),console.log(`✅ Batch ${G}/${q} (${N}ms, ${Math.round(N/H.length)}ms/doc)`)}let W=DL($.map((Y)=>Y.terms),J.length),Q=$.map((Y)=>{let H=IL(Y.terms),G=wL(H,W),q=mU(G);return{uri:Y.uri,terms:G,rawTerms:Y.terms,magnitude:q}});return console.log(`✅ Search index built with ${Q.length} documents, ${W.size} unique terms`),{documents:Q,idf:W,totalDocuments:J.length,metadata:{generatedAt:new Date().toISOString(),version:"5.0.0",tokenizer:"AdvancedCodeTokenizer",features:["Industry-leading code understanding","Advanced technical term recognition","Optimized for code search","Simple and effective approach","No unnecessary complexity"]}}}function PL(J,Z){let $=0;for(let[Q,Y]of J.entries()){let H=Z.terms.get(Q)||0;$+=Y*H}let W=mU(J);if(W===0||Z.magnitude===0)return 0;return $/(W*Z.magnitude)}async function CL(J,Z){let $=await pU(J),W=new Map;for(let Q of $){let Y=Q.toLowerCase(),H=Z.get(Y)||0;if(H>0)W.set(Y,H)}return W}async function Jy(J,Z,$={}){let{limit:W=10,minScore:Q=0,boostFactors:Y={}}=$,{exactMatch:H=1.5,phraseMatch:G=2,technicalMatch:q=1.8,identifierMatch:E=1.3}=Y,V=await CL(J,Z.idf),N=(await pU(J)).map((w)=>w.toLowerCase());return Z.documents.map((w)=>{let R=PL(V,w),y=[];for(let D of N)if(w.rawTerms.has(D)){let j=H;if(SL(D))j=Math.max(j,q);if(ML(D))j=Math.max(j,E);R*=j,y.push(D)}if(y.length===N.length&&N.length>1)R*=G;if(N.length>3&&y.length>=N.length*0.7)R*=1.2;return{uri:w.uri,score:R,matchedTerms:y}}).filter((w)=>w.score>=Q).sort((w,R)=>R.score-w.score).slice(0,W)}function SL(J){return[/\b[A-Z]{2,}\b/,/\b[A-Z][a-z]+(?:[A-Z][a-z]+)+\b/,/\b[a-z]+[A-Z][a-z]*\b/,/\b\w+(?:Dir|Config|File|Path|Data|Service|Manager|Handler)\b/,/\b(?:get|set|is|has|can|should|will|do)[A-Z]\w*\b/,/\b(?:http|https|json|xml|yaml|sql|api|url|uri)\b/].some(($)=>$.test(J))}function ML(J){return/^[a-zA-Z][a-zA-Z0-9_]*$/.test(J)&&J.length>1}function $y(J){let Z={documents:J.documents.map(($)=>({uri:$.uri,terms:Array.from($.terms.entries()),rawTerms:Array.from($.rawTerms.entries()),magnitude:$.magnitude})),idf:Array.from(J.idf.entries()),totalDocuments:J.totalDocuments,metadata:J.metadata};return JSON.stringify(Z,null,2)}function Zy(J){let Z=JSON.parse(J);return{documents:Z.documents.map(($)=>({uri:$.uri,terms:new Map($.terms),rawTerms:new Map($.rawTerms),magnitude:$.magnitude})),idf:new Map(Z.idf),totalDocuments:Z.totalDocuments,metadata:Z.metadata}}export{$y as serializeIndex,Jy as searchDocuments,CL as processQuery,Zy as deserializeIndex,PL as calculateCosineSimilarity,tx as buildSearchIndexFromDB,ox as buildSearchIndex};
export{sG as a,J6 as b,HV as c,b6 as d,ox as e,Jy as f};
