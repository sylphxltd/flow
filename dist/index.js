#!/usr/bin/env node
import{a as K8,b as R5,c as IZ}from"./paths-2re3k191.js";import{e as H8}from"./index-wyc164dh.js";import{f as S,g as sZ}from"./error-handler-s33btwbj.js";import{h as A0,i as rZ}from"./servers-kk8achc3.js";import{j as c,k as SZ,l as v}from"./index-jxkn0z7w.js";import"./targets-eqj2n0rv.js";import{s as U8}from"./secret-utils-zft4mj2q.js";import{u as M5}from"./index-bj3p86hf.js";import{A as h,x as j0,y as d,z as H6}from"./index-cq9vs79a.js";var __=d((XJ)=>{class O8 extends Error{constructor(_,$,X){super(X);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=_,this.nestedError=void 0}}class C5 extends O8{constructor(_){super(1,"commander.invalidArgument",_);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}XJ.CommanderError=O8;XJ.InvalidArgumentError=C5});var $6=d((zJ)=>{var{InvalidArgumentError:GJ}=__();class S5{constructor(_,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,_[0]){case"<":this.required=!0,this._name=_.slice(1,-1);break;case"[":this.required=!1,this._name=_.slice(1,-1);break;default:this.required=!0,this._name=_;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}argParser(_){return this.parseArg=_,this}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new GJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function YJ(_){let $=_.name()+(_.variadic===!0?"...":"");return _.required?"<"+$+">":"["+$+"]"}zJ.Argument=S5;zJ.humanReadableArgName=YJ});var R8=d((UJ)=>{var{humanReadableArgName:WJ}=$6();class k5{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(_){let $=_.commands.filter((Z)=>!Z._hidden),X=_._getHelpCommand();if(X&&!X._hidden)$.push(X);if(this.sortSubcommands)$.sort((Z,J)=>{return Z.name().localeCompare(J.name())});return $}compareOptions(_,$){let X=(Z)=>{return Z.short?Z.short.replace(/^-/,""):Z.long.replace(/^--/,"")};return X(_).localeCompare(X($))}visibleOptions(_){let $=_.options.filter((Z)=>!Z.hidden),X=_._getHelpOption();if(X&&!X.hidden){let Z=X.short&&_._findOption(X.short),J=X.long&&_._findOption(X.long);if(!Z&&!J)$.push(X);else if(X.long&&!J)$.push(_.createOption(X.long,X.description));else if(X.short&&!Z)$.push(_.createOption(X.short,X.description))}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(_){if(!this.showGlobalOptions)return[];let $=[];for(let X=_.parent;X;X=X.parent){let Z=X.options.filter((J)=>!J.hidden);$.push(...Z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(_){if(_._argsDescription)_.registeredArguments.forEach(($)=>{$.description=$.description||_._argsDescription[$.name()]||""});if(_.registeredArguments.find(($)=>$.description))return _.registeredArguments;return[]}subcommandTerm(_){let $=_.registeredArguments.map((X)=>WJ(X)).join(" ");return _._name+(_._aliases[0]?"|"+_._aliases[0]:"")+(_.options.length?" [options]":"")+($?" "+$:"")}optionTerm(_){return _.flags}argumentTerm(_){return _.name()}longestSubcommandTermLength(_,$){return $.visibleCommands(_).reduce((X,Z)=>{return Math.max(X,$.subcommandTerm(Z).length)},0)}longestOptionTermLength(_,$){return $.visibleOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestGlobalOptionTermLength(_,$){return $.visibleGlobalOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestArgumentTermLength(_,$){return $.visibleArguments(_).reduce((X,Z)=>{return Math.max(X,$.argumentTerm(Z).length)},0)}commandUsage(_){let $=_._name;if(_._aliases[0])$=$+"|"+_._aliases[0];let X="";for(let Z=_.parent;Z;Z=Z.parent)X=Z.name()+" "+X;return X+$+" "+_.usage()}commandDescription(_){return _.description()}subcommandDescription(_){return _.summary()||_.description()}optionDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0){if(_.required||_.optional||_.isBoolean()&&typeof _.defaultValue==="boolean")$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`)}if(_.presetArg!==void 0&&_.optional)$.push(`preset: ${JSON.stringify(_.presetArg)}`);if(_.envVar!==void 0)$.push(`env: ${_.envVar}`);if($.length>0)return`${_.description} (${$.join(", ")})`;return _.description}argumentDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0)$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`);if($.length>0){let X=`(${$.join(", ")})`;if(_.description)return`${_.description} ${X}`;return X}return _.description}formatHelp(_,$){let X=$.padWidth(_,$),Z=$.helpWidth||80,J=2,G=2;function Y(R,O){if(O){let N=`${R.padEnd(X+2)}${O}`;return $.wrap(N,Z-2,X+2)}return R}function z(R){return R.join(`
`).replace(/^/gm," ".repeat(2))}let H=[`Usage: ${$.commandUsage(_)}`,""],F=$.commandDescription(_);if(F.length>0)H=H.concat([$.wrap(F,Z,0),""]);let W=$.visibleArguments(_).map((R)=>{return Y($.argumentTerm(R),$.argumentDescription(R))});if(W.length>0)H=H.concat(["Arguments:",z(W),""]);let A=$.visibleOptions(_).map((R)=>{return Y($.optionTerm(R),$.optionDescription(R))});if(A.length>0)H=H.concat(["Options:",z(A),""]);if(this.showGlobalOptions){let R=$.visibleGlobalOptions(_).map((O)=>{return Y($.optionTerm(O),$.optionDescription(O))});if(R.length>0)H=H.concat(["Global Options:",z(R),""])}let D=$.visibleCommands(_).map((R)=>{return Y($.subcommandTerm(R),$.subcommandDescription(R))});if(D.length>0)H=H.concat(["Commands:",z(D),""]);return H.join(`
`)}padWidth(_,$){return Math.max($.longestOptionTermLength(_,$),$.longestGlobalOptionTermLength(_,$),$.longestSubcommandTermLength(_,$),$.longestArgumentTermLength(_,$))}wrap(_,$,X,Z=40){let G=new RegExp(`[\\n][${" \\f\\t\\v   -   　\uFEFF"}]+`);if(_.match(G))return _;let Y=$-X;if(Y<Z)return _;let z=_.slice(0,X),H=_.slice(X).replace(`\r
`,`
`),F=" ".repeat(X),A=`\\s${"​"}`,D=new RegExp(`
|.{1,${Y-1}}([${A}]|$)|[^${A}]+?([${A}]|$)`,"g"),R=H.match(D)||[];return z+R.map((O,N)=>{if(O===`
`)return"";return(N>0?F:"")+O.trimEnd()}).join(`
`)}}UJ.Help=k5});var V8=d((RJ)=>{var{InvalidArgumentError:KJ}=__();class v5{constructor(_,$){this.flags=_,this.description=$||"",this.required=_.includes("<"),this.optional=_.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(_),this.mandatory=!1;let X=OJ(_);if(this.short=X.shortFlag,this.long=X.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}preset(_){return this.presetArg=_,this}conflicts(_){return this.conflictsWith=this.conflictsWith.concat(_),this}implies(_){let $=_;if(typeof _==="string")$={[_]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(_){return this.envVar=_,this}argParser(_){return this.parseArg=_,this}makeOptionMandatory(_=!0){return this.mandatory=!!_,this}hideHelp(_=!0){return this.hidden=!!_,this}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new KJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return DJ(this.name().replace(/^no-/,""))}is(_){return this.short===_||this.long===_}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class h5{constructor(_){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,_.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,X)=>{if(this.positiveOptions.has(X))this.dualOptions.add(X)})}valueFromOption(_,$){let X=$.attributeName();if(!this.dualOptions.has(X))return!0;let Z=this.negativeOptions.get(X).presetArg,J=Z!==void 0?Z:!1;return $.negate===(J===_)}}function DJ(_){return _.split("-").reduce(($,X)=>{return $+X[0].toUpperCase()+X.slice(1)})}function OJ(_){let $,X,Z=_.split(/[ |,]+/);if(Z.length>1&&!/^[[<]/.test(Z[1]))$=Z.shift();if(X=Z.shift(),!$&&/^-[^-]$/.test(X))$=X,X=void 0;return{shortFlag:$,longFlag:X}}RJ.Option=v5;RJ.DualOptions=h5});var y5=d((IJ)=>{function MJ(_,$){if(Math.abs(_.length-$.length)>3)return Math.max(_.length,$.length);let X=[];for(let Z=0;Z<=_.length;Z++)X[Z]=[Z];for(let Z=0;Z<=$.length;Z++)X[0][Z]=Z;for(let Z=1;Z<=$.length;Z++)for(let J=1;J<=_.length;J++){let G=1;if(_[J-1]===$[Z-1])G=0;else G=1;if(X[J][Z]=Math.min(X[J-1][Z]+1,X[J][Z-1]+1,X[J-1][Z-1]+G),J>1&&Z>1&&_[J-1]===$[Z-2]&&_[J-2]===$[Z-1])X[J][Z]=Math.min(X[J][Z],X[J-2][Z-2]+1)}return X[_.length][$.length]}function BJ(_,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let X=_.startsWith("--");if(X)_=_.slice(2),$=$.map((Y)=>Y.slice(2));let Z=[],J=3,G=0.4;if($.forEach((Y)=>{if(Y.length<=1)return;let z=MJ(_,Y),H=Math.max(_.length,Y.length);if((H-z)/H>G){if(z<J)J=z,Z=[Y];else if(z===J)Z.push(Y)}}),Z.sort((Y,z)=>Y.localeCompare(z)),X)Z=Z.map((Y)=>`--${Y}`);if(Z.length>1)return`
(Did you mean one of ${Z.join(", ")}?)`;if(Z.length===1)return`
(Did you mean ${Z[0]}?)`;return""}IJ.suggestSimilar=BJ});var p5=d((PJ)=>{var EJ=h("node:events").EventEmitter,N8=h("node:child_process"),K1=h("node:path"),M8=h("node:fs"),e=h("node:process"),{Argument:jJ,humanReadableArgName:TJ}=$6(),{CommanderError:B8}=__(),{Help:LJ}=R8(),{Option:f5,DualOptions:wJ}=V8(),{suggestSimilar:b5}=y5();class I8 extends EJ{constructor(_){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=_||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>e.stdout.write($),writeErr:($)=>e.stderr.write($),getOutHelpWidth:()=>e.stdout.isTTY?e.stdout.columns:void 0,getErrHelpWidth:()=>e.stderr.isTTY?e.stderr.columns:void 0,outputError:($,X)=>X($)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(_){return this._outputConfiguration=_._outputConfiguration,this._helpOption=_._helpOption,this._helpCommand=_._helpCommand,this._helpConfiguration=_._helpConfiguration,this._exitCallback=_._exitCallback,this._storeOptionsAsProperties=_._storeOptionsAsProperties,this._combineFlagAndOptionalValue=_._combineFlagAndOptionalValue,this._allowExcessArguments=_._allowExcessArguments,this._enablePositionalOptions=_._enablePositionalOptions,this._showHelpAfterError=_._showHelpAfterError,this._showSuggestionAfterError=_._showSuggestionAfterError,this}_getCommandAndAncestors(){let _=[];for(let $=this;$;$=$.parent)_.push($);return _}command(_,$,X){let Z=$,J=X;if(typeof Z==="object"&&Z!==null)J=Z,Z=null;J=J||{};let[,G,Y]=_.match(/([^ ]+) *(.*)/),z=this.createCommand(G);if(Z)z.description(Z),z._executableHandler=!0;if(J.isDefault)this._defaultCommandName=z._name;if(z._hidden=!!(J.noHelp||J.hidden),z._executableFile=J.executableFile||null,Y)z.arguments(Y);if(this._registerCommand(z),z.parent=this,z.copyInheritedSettings(this),Z)return this;return z}createCommand(_){return new I8(_)}createHelp(){return Object.assign(new LJ,this.configureHelp())}configureHelp(_){if(_===void 0)return this._helpConfiguration;return this._helpConfiguration=_,this}configureOutput(_){if(_===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,_),this}showHelpAfterError(_=!0){if(typeof _!=="string")_=!!_;return this._showHelpAfterError=_,this}showSuggestionAfterError(_=!0){return this._showSuggestionAfterError=!!_,this}addCommand(_,$){if(!_._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=_._name;if($.noHelp||$.hidden)_._hidden=!0;return this._registerCommand(_),_.parent=this,_._checkForBrokenPassThrough(),this}createArgument(_,$){return new jJ(_,$)}argument(_,$,X,Z){let J=this.createArgument(_,$);if(typeof X==="function")J.default(Z).argParser(X);else J.default(X);return this.addArgument(J),this}arguments(_){return _.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(_){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw Error(`only the last argument can be variadic '${$.name()}'`);if(_.required&&_.defaultValue!==void 0&&_.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${_.name()}'`);return this.registeredArguments.push(_),this}helpCommand(_,$){if(typeof _==="boolean")return this._addImplicitHelpCommand=_,this;_=_??"help [command]";let[,X,Z]=_.match(/([^ ]+) *(.*)/),J=$??"display help for command",G=this.createCommand(X);if(G.helpOption(!1),Z)G.arguments(Z);if(J)G.description(J);return this._addImplicitHelpCommand=!0,this._helpCommand=G,this}addHelpCommand(_,$){if(typeof _!=="object")return this.helpCommand(_,$),this;return this._addImplicitHelpCommand=!0,this._helpCommand=_,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook(_,$){let X=["preSubcommand","preAction","postAction"];if(!X.includes(_))throw Error(`Unexpected value for event passed to hook : '${_}'.
Expecting one of '${X.join("', '")}'`);if(this._lifeCycleHooks[_])this._lifeCycleHooks[_].push($);else this._lifeCycleHooks[_]=[$];return this}exitOverride(_){if(_)this._exitCallback=_;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(_,$,X){if(this._exitCallback)this._exitCallback(new B8(_,$,X));e.exit(_)}action(_){let $=(X)=>{let Z=this.registeredArguments.length,J=X.slice(0,Z);if(this._storeOptionsAsProperties)J[Z]=this;else J[Z]=this.opts();return J.push(this),_.apply(this,J)};return this._actionHandler=$,this}createOption(_,$){return new f5(_,$)}_callParseArg(_,$,X,Z){try{return _.parseArg($,X)}catch(J){if(J.code==="commander.invalidArgument"){let G=`${Z} ${J.message}`;this.error(G,{exitCode:J.exitCode,code:J.code})}throw J}}_registerOption(_){let $=_.short&&this._findOption(_.short)||_.long&&this._findOption(_.long);if($){let X=_.long&&this._findOption(_.long)?_.long:_.short;throw Error(`Cannot add option '${_.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${X}'
-  already used by option '${$.flags}'`)}this.options.push(_)}_registerCommand(_){let $=(Z)=>{return[Z.name()].concat(Z.aliases())},X=$(_).find((Z)=>this._findCommand(Z));if(X){let Z=$(this._findCommand(X)).join("|"),J=$(_).join("|");throw Error(`cannot add command '${J}' as already have command '${Z}'`)}this.commands.push(_)}addOption(_){this._registerOption(_);let $=_.name(),X=_.attributeName();if(_.negate){let J=_.long.replace(/^--no-/,"--");if(!this._findOption(J))this.setOptionValueWithSource(X,_.defaultValue===void 0?!0:_.defaultValue,"default")}else if(_.defaultValue!==void 0)this.setOptionValueWithSource(X,_.defaultValue,"default");let Z=(J,G,Y)=>{if(J==null&&_.presetArg!==void 0)J=_.presetArg;let z=this.getOptionValue(X);if(J!==null&&_.parseArg)J=this._callParseArg(_,J,z,G);else if(J!==null&&_.variadic)J=_._concatValue(J,z);if(J==null)if(_.negate)J=!1;else if(_.isBoolean()||_.optional)J=!0;else J="";this.setOptionValueWithSource(X,J,Y)};if(this.on("option:"+$,(J)=>{let G=`error: option '${_.flags}' argument '${J}' is invalid.`;Z(J,G,"cli")}),_.envVar)this.on("optionEnv:"+$,(J)=>{let G=`error: option '${_.flags}' value '${J}' from env '${_.envVar}' is invalid.`;Z(J,G,"env")});return this}_optionEx(_,$,X,Z,J){if(typeof $==="object"&&$ instanceof f5)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let G=this.createOption($,X);if(G.makeOptionMandatory(!!_.mandatory),typeof Z==="function")G.default(J).argParser(Z);else if(Z instanceof RegExp){let Y=Z;Z=(z,H)=>{let F=Y.exec(z);return F?F[0]:H},G.default(J).argParser(Z)}else G.default(Z);return this.addOption(G)}option(_,$,X,Z){return this._optionEx({},_,$,X,Z)}requiredOption(_,$,X,Z){return this._optionEx({mandatory:!0},_,$,X,Z)}combineFlagAndOptionalValue(_=!0){return this._combineFlagAndOptionalValue=!!_,this}allowUnknownOption(_=!0){return this._allowUnknownOption=!!_,this}allowExcessArguments(_=!0){return this._allowExcessArguments=!!_,this}enablePositionalOptions(_=!0){return this._enablePositionalOptions=!!_,this}passThroughOptions(_=!0){return this._passThroughOptions=!!_,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(_=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!_,this}getOptionValue(_){if(this._storeOptionsAsProperties)return this[_];return this._optionValues[_]}setOptionValue(_,$){return this.setOptionValueWithSource(_,$,void 0)}setOptionValueWithSource(_,$,X){if(this._storeOptionsAsProperties)this[_]=$;else this._optionValues[_]=$;return this._optionValueSources[_]=X,this}getOptionValueSource(_){return this._optionValueSources[_]}getOptionValueSourceWithGlobals(_){let $;return this._getCommandAndAncestors().forEach((X)=>{if(X.getOptionValueSource(_)!==void 0)$=X.getOptionValueSource(_)}),$}_prepareUserArgs(_,$){if(_!==void 0&&!Array.isArray(_))throw Error("first parameter to parse must be array or undefined");if($=$||{},_===void 0&&$.from===void 0){if(e.versions?.electron)$.from="electron";let Z=e.execArgv??[];if(Z.includes("-e")||Z.includes("--eval")||Z.includes("-p")||Z.includes("--print"))$.from="eval"}if(_===void 0)_=e.argv;this.rawArgs=_.slice();let X;switch($.from){case void 0:case"node":this._scriptPath=_[1],X=_.slice(2);break;case"electron":if(e.defaultApp)this._scriptPath=_[1],X=_.slice(2);else X=_.slice(1);break;case"user":X=_.slice(0);break;case"eval":X=_.slice(1);break;default:throw Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",X}parse(_,$){let X=this._prepareUserArgs(_,$);return this._parseCommand([],X),this}async parseAsync(_,$){let X=this._prepareUserArgs(_,$);return await this._parseCommand([],X),this}_executeSubCommand(_,$){$=$.slice();let X=!1,Z=[".js",".ts",".tsx",".mjs",".cjs"];function J(F,W){let A=K1.resolve(F,W);if(M8.existsSync(A))return A;if(Z.includes(K1.extname(W)))return;let D=Z.find((R)=>M8.existsSync(`${A}${R}`));if(D)return`${A}${D}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let G=_._executableFile||`${this._name}-${_._name}`,Y=this._executableDir||"";if(this._scriptPath){let F;try{F=M8.realpathSync(this._scriptPath)}catch(W){F=this._scriptPath}Y=K1.resolve(K1.dirname(F),Y)}if(Y){let F=J(Y,G);if(!F&&!_._executableFile&&this._scriptPath){let W=K1.basename(this._scriptPath,K1.extname(this._scriptPath));if(W!==this._name)F=J(Y,`${W}-${_._name}`)}G=F||G}X=Z.includes(K1.extname(G));let z;if(e.platform!=="win32")if(X)$.unshift(G),$=g5(e.execArgv).concat($),z=N8.spawn(e.argv[0],$,{stdio:"inherit"});else z=N8.spawn(G,$,{stdio:"inherit"});else $.unshift(G),$=g5(e.execArgv).concat($),z=N8.spawn(e.execPath,$,{stdio:"inherit"});if(!z.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((W)=>{e.on(W,()=>{if(z.killed===!1&&z.exitCode===null)z.kill(W)})});let H=this._exitCallback;z.on("close",(F)=>{if(F=F??1,!H)e.exit(F);else H(new B8(F,"commander.executeSubCommandAsync","(close)"))}),z.on("error",(F)=>{if(F.code==="ENOENT"){let W=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",A=`'${G}' does not exist
 - if '${_._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${W}`;throw Error(A)}else if(F.code==="EACCES")throw Error(`'${G}' not executable`);if(!H)e.exit(1);else{let W=new B8(1,"commander.executeSubCommandAsync","(error)");W.nestedError=F,H(W)}}),this.runningCommand=z}_dispatchSubcommand(_,$,X){let Z=this._findCommand(_);if(!Z)this.help({error:!0});let J;return J=this._chainOrCallSubCommandHook(J,Z,"preSubcommand"),J=this._chainOrCall(J,()=>{if(Z._executableHandler)this._executeSubCommand(Z,$.concat(X));else return Z._parseCommand($,X)}),J}_dispatchHelpCommand(_){if(!_)this.help();let $=this._findCommand(_);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(_,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((_,$)=>{if(_.required&&this.args[$]==null)this.missingArgument(_.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let _=(X,Z,J)=>{let G=Z;if(Z!==null&&X.parseArg){let Y=`error: command-argument value '${Z}' is invalid for argument '${X.name()}'.`;G=this._callParseArg(X,Z,J,Y)}return G};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((X,Z)=>{let J=X.defaultValue;if(X.variadic){if(Z<this.args.length){if(J=this.args.slice(Z),X.parseArg)J=J.reduce((G,Y)=>{return _(X,Y,G)},X.defaultValue)}else if(J===void 0)J=[]}else if(Z<this.args.length){if(J=this.args[Z],X.parseArg)J=_(X,J,X.defaultValue)}$[Z]=J}),this.processedArgs=$}_chainOrCall(_,$){if(_&&_.then&&typeof _.then==="function")return _.then(()=>$());return $()}_chainOrCallHooks(_,$){let X=_,Z=[];if(this._getCommandAndAncestors().reverse().filter((J)=>J._lifeCycleHooks[$]!==void 0).forEach((J)=>{J._lifeCycleHooks[$].forEach((G)=>{Z.push({hookedCommand:J,callback:G})})}),$==="postAction")Z.reverse();return Z.forEach((J)=>{X=this._chainOrCall(X,()=>{return J.callback(J.hookedCommand,this)})}),X}_chainOrCallSubCommandHook(_,$,X){let Z=_;if(this._lifeCycleHooks[X]!==void 0)this._lifeCycleHooks[X].forEach((J)=>{Z=this._chainOrCall(Z,()=>{return J(this,$)})});return Z}_parseCommand(_,$){let X=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),_=_.concat(X.operands),$=X.unknown,this.args=_.concat($),_&&this._findCommand(_[0]))return this._dispatchSubcommand(_[0],_.slice(1),$);if(this._getHelpCommand()&&_[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(_[1]);if(this._defaultCommandName)return this._outputHelpIfRequested($),this._dispatchSubcommand(this._defaultCommandName,_,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(X.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Z=()=>{if(X.unknown.length>0)this.unknownOption(X.unknown[0])},J=`command:${this.name()}`;if(this._actionHandler){Z(),this._processArguments();let G;if(G=this._chainOrCallHooks(G,"preAction"),G=this._chainOrCall(G,()=>this._actionHandler(this.processedArgs)),this.parent)G=this._chainOrCall(G,()=>{this.parent.emit(J,_,$)});return G=this._chainOrCallHooks(G,"postAction"),G}if(this.parent&&this.parent.listenerCount(J))Z(),this._processArguments(),this.parent.emit(J,_,$);else if(_.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",_,$);if(this.listenerCount("command:*"))this.emit("command:*",_,$);else if(this.commands.length)this.unknownCommand();else Z(),this._processArguments()}else if(this.commands.length)Z(),this.help({error:!0});else Z(),this._processArguments()}_findCommand(_){if(!_)return;return this.commands.find(($)=>$._name===_||$._aliases.includes(_))}_findOption(_){return this.options.find(($)=>$.is(_))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((_)=>{_.options.forEach(($)=>{if($.mandatory&&_.getOptionValue($.attributeName())===void 0)_.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let _=this.options.filter((X)=>{let Z=X.attributeName();if(this.getOptionValue(Z)===void 0)return!1;return this.getOptionValueSource(Z)!=="default"});_.filter((X)=>X.conflictsWith.length>0).forEach((X)=>{let Z=_.find((J)=>X.conflictsWith.includes(J.attributeName()));if(Z)this._conflictingOption(X,Z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((_)=>{_._checkForConflictingLocalOptions()})}parseOptions(_){let $=[],X=[],Z=$,J=_.slice();function G(z){return z.length>1&&z[0]==="-"}let Y=null;while(J.length){let z=J.shift();if(z==="--"){if(Z===X)Z.push(z);Z.push(...J);break}if(Y&&!G(z)){this.emit(`option:${Y.name()}`,z);continue}if(Y=null,G(z)){let H=this._findOption(z);if(H){if(H.required){let F=J.shift();if(F===void 0)this.optionMissingArgument(H);this.emit(`option:${H.name()}`,F)}else if(H.optional){let F=null;if(J.length>0&&!G(J[0]))F=J.shift();this.emit(`option:${H.name()}`,F)}else this.emit(`option:${H.name()}`);Y=H.variadic?H:null;continue}}if(z.length>2&&z[0]==="-"&&z[1]!=="-"){let H=this._findOption(`-${z[1]}`);if(H){if(H.required||H.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${H.name()}`,z.slice(2));else this.emit(`option:${H.name()}`),J.unshift(`-${z.slice(2)}`);continue}}if(/^--[^=]+=/.test(z)){let H=z.indexOf("="),F=this._findOption(z.slice(0,H));if(F&&(F.required||F.optional)){this.emit(`option:${F.name()}`,z.slice(H+1));continue}}if(G(z))Z=X;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&X.length===0){if(this._findCommand(z)){if($.push(z),J.length>0)X.push(...J);break}else if(this._getHelpCommand()&&z===this._getHelpCommand().name()){if($.push(z),J.length>0)$.push(...J);break}else if(this._defaultCommandName){if(X.push(z),J.length>0)X.push(...J);break}}if(this._passThroughOptions){if(Z.push(z),J.length>0)Z.push(...J);break}Z.push(z)}return{operands:$,unknown:X}}opts(){if(this._storeOptionsAsProperties){let _={},$=this.options.length;for(let X=0;X<$;X++){let Z=this.options[X].attributeName();_[Z]=Z===this._versionOptionName?this._version:this[Z]}return _}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((_,$)=>Object.assign(_,$.opts()),{})}error(_,$){if(this._outputConfiguration.outputError(`${_}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let X=$||{},Z=X.exitCode||1,J=X.code||"commander.error";this._exit(Z,J,_)}_parseOptionsEnv(){this.options.forEach((_)=>{if(_.envVar&&_.envVar in e.env){let $=_.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(_.required||_.optional)this.emit(`optionEnv:${_.name()}`,e.env[_.envVar]);else this.emit(`optionEnv:${_.name()}`)}})}_parseOptionsImplied(){let _=new wJ(this.options),$=(X)=>{return this.getOptionValue(X)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(X))};this.options.filter((X)=>X.implied!==void 0&&$(X.attributeName())&&_.valueFromOption(this.getOptionValue(X.attributeName()),X)).forEach((X)=>{Object.keys(X.implied).filter((Z)=>!$(Z)).forEach((Z)=>{this.setOptionValueWithSource(Z,X.implied[Z],"implied")})})}missingArgument(_){let $=`error: missing required argument '${_}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(_){let $=`error: option '${_.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(_){let $=`error: required option '${_.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(_,$){let X=(G)=>{let Y=G.attributeName(),z=this.getOptionValue(Y),H=this.options.find((W)=>W.negate&&Y===W.attributeName()),F=this.options.find((W)=>!W.negate&&Y===W.attributeName());if(H&&(H.presetArg===void 0&&z===!1||H.presetArg!==void 0&&z===H.presetArg))return H;return F||G},Z=(G)=>{let Y=X(G),z=Y.attributeName();if(this.getOptionValueSource(z)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},J=`error: ${Z(_)} cannot be used with ${Z($)}`;this.error(J,{code:"commander.conflictingOption"})}unknownOption(_){if(this._allowUnknownOption)return;let $="";if(_.startsWith("--")&&this._showSuggestionAfterError){let Z=[],J=this;do{let G=J.createHelp().visibleOptions(J).filter((Y)=>Y.long).map((Y)=>Y.long);Z=Z.concat(G),J=J.parent}while(J&&!J._enablePositionalOptions);$=b5(_,Z)}let X=`error: unknown option '${_}'${$}`;this.error(X,{code:"commander.unknownOption"})}_excessArguments(_){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,X=$===1?"":"s",J=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${X} but got ${_.length}.`;this.error(J,{code:"commander.excessArguments"})}unknownCommand(){let _=this.args[0],$="";if(this._showSuggestionAfterError){let Z=[];this.createHelp().visibleCommands(this).forEach((J)=>{if(Z.push(J.name()),J.alias())Z.push(J.alias())}),$=b5(_,Z)}let X=`error: unknown command '${_}'${$}`;this.error(X,{code:"commander.unknownCommand"})}version(_,$,X){if(_===void 0)return this._version;this._version=_,$=$||"-V, --version",X=X||"output the version number";let Z=this.createOption($,X);return this._versionOptionName=Z.attributeName(),this._registerOption(Z),this.on("option:"+Z.name(),()=>{this._outputConfiguration.writeOut(`${_}
`),this._exit(0,"commander.version",_)}),this}description(_,$){if(_===void 0&&$===void 0)return this._description;if(this._description=_,$)this._argsDescription=$;return this}summary(_){if(_===void 0)return this._summary;return this._summary=_,this}alias(_){if(_===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(_===$._name)throw Error("Command alias can't be the same as its name");let X=this.parent?._findCommand(_);if(X){let Z=[X.name()].concat(X.aliases()).join("|");throw Error(`cannot add alias '${_}' to command '${this.name()}' as already have command '${Z}'`)}return $._aliases.push(_),this}aliases(_){if(_===void 0)return this._aliases;return _.forEach(($)=>this.alias($)),this}usage(_){if(_===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((X)=>{return TJ(X)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=_,this}name(_){if(_===void 0)return this._name;return this._name=_,this}nameFromFilename(_){return this._name=K1.basename(_,K1.extname(_)),this}executableDir(_){if(_===void 0)return this._executableDir;return this._executableDir=_,this}helpInformation(_){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=_&&_.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(_){_=_||{};let $={error:!!_.error},X;if($.error)X=(Z)=>this._outputConfiguration.writeErr(Z);else X=(Z)=>this._outputConfiguration.writeOut(Z);return $.write=_.write||X,$.command=this,$}outputHelp(_){let $;if(typeof _==="function")$=_,_=void 0;let X=this._getHelpContext(_);this._getCommandAndAncestors().reverse().forEach((J)=>J.emit("beforeAllHelp",X)),this.emit("beforeHelp",X);let Z=this.helpInformation(X);if($){if(Z=$(Z),typeof Z!=="string"&&!Buffer.isBuffer(Z))throw Error("outputHelp callback must return a string or a Buffer")}if(X.write(Z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",X),this._getCommandAndAncestors().forEach((J)=>J.emit("afterAllHelp",X))}helpOption(_,$){if(typeof _==="boolean"){if(_)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return _=_??"-h, --help",$=$??"display help for command",this._helpOption=this.createOption(_,$),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption(_){return this._helpOption=_,this}help(_){this.outputHelp(_);let $=e.exitCode||0;if($===0&&_&&typeof _!=="function"&&_.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(_,$){let X=["beforeAll","before","after","afterAll"];if(!X.includes(_))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${X.join("', '")}'`);let Z=`${_}Help`;return this.on(Z,(J)=>{let G;if(typeof $==="function")G=$({error:J.error,command:J.command});else G=$;if(G)J.write(`${G}
`)}),this}_outputHelpIfRequested(_){let $=this._getHelpOption();if($&&_.find((Z)=>$.is(Z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function g5(_){return _.map(($)=>{if(!$.startsWith("--inspect"))return $;let X,Z="127.0.0.1",J="9229",G;if((G=$.match(/^(--inspect(-brk)?)$/))!==null)X=G[1];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(X=G[1],/^\d+$/.test(G[3]))J=G[3];else Z=G[3];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)X=G[1],Z=G[3],J=G[4];if(X&&J!=="0")return`${X}=${Z}:${parseInt(J)+1}`;return $})}PJ.Command=I8});var c5=d((SJ)=>{var{Argument:m5}=$6(),{Command:Q8}=p5(),{CommanderError:qJ,InvalidArgumentError:u5}=__(),{Help:CJ}=R8(),{Option:d5}=V8();SJ.program=new Q8;SJ.createCommand=(_)=>new Q8(_);SJ.createOption=(_,$)=>new d5(_,$);SJ.createArgument=(_,$)=>new m5(_,$);SJ.Command=Q8;SJ.Option=d5;SJ.Argument=m5;SJ.Help=CJ;SJ.CommanderError=qJ;SJ.InvalidArgumentError=u5;SJ.InvalidOptionArgumentError=u5});var k3=d((MK,K6)=>{function j3(_){return Array.isArray(_)?_:[_]}var kG=void 0,p8="",Q3=" ",g8="\\",vG=/^\s+$/,hG=/(?:[^\\]|^)\\$/,yG=/^\\!/,fG=/^\\#/,bG=/\r?\n/g,gG=/^\.{0,2}\/|^\.{1,2}$/,pG=/\/$/,O2="/",T3="node-ignore";if(typeof Symbol<"u")T3=Symbol.for("node-ignore");var L3=T3,R2=(_,$,X)=>{return Object.defineProperty(_,$,{value:X}),X},mG=/([0-z])-([0-z])/g,w3=()=>!1,uG=(_)=>_.replace(mG,($,X,Z)=>X.charCodeAt(0)<=Z.charCodeAt(0)?$:p8),dG=(_)=>{let{length:$}=_;return _.slice(0,$-$%2)},cG=[[/^\uFEFF/,()=>p8],[/((?:\\\\)*?)(\\?\s+)$/,(_,$,X)=>$+(X.indexOf("\\")===0?Q3:p8)],[/(\\+?)\s/g,(_,$)=>{let{length:X}=$;return $.slice(0,X-X%2)+Q3}],[/[\\$.|*+(){^]/g,(_)=>`\\${_}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return!/\/(?!$)/.test(this)?"(?:^|\\/)":"^"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(_,$,X)=>$+6<X.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(_,$,X)=>{let Z=X.replace(/\\\*/g,"[^\\/]*");return $+Z}],[/\\\\\\(?=[$.|*+(){^])/g,()=>g8],[/\\\\/g,()=>g8],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(_,$,X,Z,J)=>$===g8?`\\[${X}${dG(Z)}${J}`:J==="]"?Z.length%2===0?`[${uG(X)}${Z}]`:"[]":"[]"],[/(?:[^*])$/,(_)=>/\/$/.test(_)?`${_}$`:`${_}(?=$|\\/$)`]],lG=/(^|\\\/)?\\\*$/,Y_="regex",U6="checkRegex",E3="_",iG={[Y_](_,$){return`${$?`${$}[^/]+`:"[^/]*"}(?=$|\\/$)`},[U6](_,$){return`${$?`${$}[^/]*`:"[^/]*"}(?=$|\\/$)`}},nG=(_)=>cG.reduce(($,[X,Z])=>$.replace(X,Z.bind(_)),_),A6=(_)=>typeof _==="string",oG=(_)=>_&&A6(_)&&!vG.test(_)&&!hG.test(_)&&_.indexOf("#")!==0,sG=(_)=>_.split(bG).filter(Boolean);class P3{constructor(_,$,X,Z,J,G){this.pattern=_,this.mark=$,this.negative=J,R2(this,"body",X),R2(this,"ignoreCase",Z),R2(this,"regexPrefix",G)}get regex(){let _=E3+Y_;if(this[_])return this[_];return this._make(Y_,_)}get checkRegex(){let _=E3+U6;if(this[_])return this[_];return this._make(U6,_)}_make(_,$){let X=this.regexPrefix.replace(lG,iG[_]),Z=this.ignoreCase?new RegExp(X,"i"):new RegExp(X);return R2(this,$,Z)}}var rG=({pattern:_,mark:$},X)=>{let Z=!1,J=_;if(J.indexOf("!")===0)Z=!0,J=J.substr(1);J=J.replace(yG,"!").replace(fG,"#");let G=nG(J);return new P3(_,$,J,X,Z,G)};class x3{constructor(_){this._ignoreCase=_,this._rules=[]}_add(_){if(_&&_[L3]){this._rules=this._rules.concat(_._rules._rules),this._added=!0;return}if(A6(_))_={pattern:_};if(oG(_.pattern)){let $=rG(_,this._ignoreCase);this._added=!0,this._rules.push($)}}add(_){return this._added=!1,j3(A6(_)?sG(_):_).forEach(this._add,this),this._added}test(_,$,X){let Z=!1,J=!1,G;this._rules.forEach((z)=>{let{negative:H}=z;if(J===H&&Z!==J||H&&!Z&&!J&&!$)return;if(!z[X].test(_))return;Z=!H,J=H,G=H?kG:z});let Y={ignored:Z,unignored:J};if(G)Y.rule=G;return Y}}var aG=(_,$)=>{throw new $(_)},D1=(_,$,X)=>{if(!A6(_))return X(`path must be a string, but got \`${$}\``,TypeError);if(!_)return X("path must not be empty",TypeError);if(D1.isNotRelative(_))return X(`path should be a \`path.relative()\`d string, but got "${$}"`,RangeError);return!0},q3=(_)=>gG.test(_);D1.isNotRelative=q3;D1.convert=(_)=>_;class C3{constructor({ignorecase:_=!0,ignoreCase:$=_,allowRelativePaths:X=!1}={}){R2(this,L3,!0),this._rules=new x3($),this._strictPathCheck=!X,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(_){if(this._rules.add(_))this._initCache();return this}addPattern(_){return this.add(_)}_test(_,$,X,Z){let J=_&&D1.convert(_);return D1(J,_,this._strictPathCheck?aG:w3),this._t(J,$,X,Z)}checkIgnore(_){if(!pG.test(_))return this.test(_);let $=_.split(O2).filter(Boolean);if($.pop(),$.length){let X=this._t($.join(O2)+O2,this._testCache,!0,$);if(X.ignored)return X}return this._rules.test(_,!1,U6)}_t(_,$,X,Z){if(_ in $)return $[_];if(!Z)Z=_.split(O2).filter(Boolean);if(Z.pop(),!Z.length)return $[_]=this._rules.test(_,X,Y_);let J=this._t(Z.join(O2)+O2,$,X,Z);return $[_]=J.ignored?J:this._rules.test(_,X,Y_)}ignores(_){return this._test(_,this._ignoreCache,!1).ignored}createFilter(){return(_)=>!this.ignores(_)}filter(_){return j3(_).filter(this.createFilter())}test(_){return this._test(_,this._testCache,!0)}}var m8=(_)=>new C3(_),tG=(_)=>D1(_&&D1.convert(_),_,w3),S3=()=>{let _=(X)=>/^\\\\\?\\/.test(X)||/["<>|\u0000-\u001F]+/u.test(X)?X:X.replace(/\\/g,"/");D1.convert=_;let $=/^[a-z]:\//i;D1.isNotRelative=(X)=>$.test(X)||q3(X)};if(typeof process<"u"&&process.platform==="win32")S3();K6.exports=m8;m8.default=m8;K6.exports.isPathValid=tG;R2(K6.exports,Symbol.for("setupWindows"),S3)});var d7=d((p0)=>{var jY=p0&&p0.__createBinding||(Object.create?function(_,$,X,Z){if(Z===void 0)Z=X;var J=Object.getOwnPropertyDescriptor($,X);if(!J||("get"in J?!$.__esModule:J.writable||J.configurable))J={enumerable:!0,get:function(){return $[X]}};Object.defineProperty(_,Z,J)}:function(_,$,X,Z){if(Z===void 0)Z=X;_[Z]=$[X]}),TY=p0&&p0.__setModuleDefault||(Object.create?function(_,$){Object.defineProperty(_,"default",{enumerable:!0,value:$})}:function(_,$){_.default=$}),u7=p0&&p0.__importStar||function(_){if(_&&_.__esModule)return _;var $={};if(_!=null){for(var X in _)if(X!=="default"&&Object.prototype.hasOwnProperty.call(_,X))jY($,_,X)}return TY($,_),$};Object.defineProperty(p0,"__esModule",{value:!0});p0.load=p0.currentTarget=void 0;var LY=u7(h("path")),wY=u7(h("fs"));function PY(){let _=null;switch(process.platform){case"android":switch(process.arch){case"arm":return"android-arm-eabi";case"arm64":return"android-arm64"}_="Android";break;case"win32":switch(process.arch){case"x64":return"win32-x64-msvc";case"arm64":return"win32-arm64-msvc";case"ia32":return"win32-ia32-msvc"}_="Windows";break;case"darwin":switch(process.arch){case"x64":return"darwin-x64";case"arm64":return"darwin-arm64"}_="macOS";break;case"linux":switch(process.arch){case"x64":case"arm64":return xY()?`linux-${process.arch}-gnu`:`linux-${process.arch}-musl`;case"arm":return"linux-arm-gnueabihf"}_="Linux";break;case"freebsd":if(process.arch==="x64")return"freebsd-x64";_="FreeBSD";break}if(_)throw Error(`Neon: unsupported ${_} architecture: ${process.arch}`);throw Error(`Neon: unsupported system: ${process.platform}`)}p0.currentTarget=PY;function xY(){let _=process.report?.getReport();if(typeof _!=="object"||!_||!("header"in _))return!1;let $=_.header;return typeof $==="object"&&!!$&&"glibcVersionRuntime"in $}function qY(_){let $=LY.join(_,"index.node");return wY.existsSync($)?h($):null}p0.load=qY});var i7=d((XO,l7)=>{var c7=()=>process.platform==="linux",z4=null,CY=()=>{if(!z4)z4=c7()&&process.report?process.report.getReport():{};return z4};l7.exports={isLinux:c7,getReport:CY}});var s7=d((ZO,o7)=>{var n7=h("fs"),SY=(_)=>n7.readFileSync(_,"utf-8"),kY=(_)=>new Promise(($,X)=>{n7.readFile(_,"utf-8",(Z,J)=>{if(Z)X(Z);else $(J)})});o7.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:SY,readFile:kY}});var A9=d((JO,U9)=>{var a7=h("child_process"),{isLinux:E2,getReport:t7}=i7(),{LDD_PATH:E6,readFile:e7,readFileSync:_9}=s7(),G1,Y1,x1="",$9=()=>{if(!x1)return new Promise((_)=>{a7.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",($,X)=>{x1=$?" ":X,_(x1)})});return x1},X9=()=>{if(!x1)try{x1=a7.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(_){x1=" "}return x1},R1="glibc",Z9=/GLIBC\s(\d+\.\d+)/,o1="musl",vY=R1.toUpperCase(),hY=o1.toLowerCase(),yY=(_)=>_.includes("libc.musl-")||_.includes("ld-musl-"),J9=()=>{let _=t7();if(_.header&&_.header.glibcVersionRuntime)return R1;if(Array.isArray(_.sharedObjects)){if(_.sharedObjects.some(yY))return o1}return null},G9=(_)=>{let[$,X]=_.split(/[\r\n]+/);if($&&$.includes(R1))return R1;if(X&&X.includes(o1))return o1;return null},Y9=(_)=>{if(_.includes(hY))return o1;if(_.includes(vY))return R1;return null},fY=async()=>{if(G1!==void 0)return G1;G1=null;try{let _=await e7(E6);G1=Y9(_)}catch(_){}return G1},bY=()=>{if(G1!==void 0)return G1;G1=null;try{let _=_9(E6);G1=Y9(_)}catch(_){}return G1},z9=async()=>{let _=null;if(E2()){if(_=await fY(),!_)_=J9();if(!_){let $=await $9();_=G9($)}}return _},H9=()=>{let _=null;if(E2()){if(_=bY(),!_)_=J9();if(!_){let $=X9();_=G9($)}}return _},gY=async()=>E2()&&await z9()!==R1,pY=()=>E2()&&H9()!==R1,mY=async()=>{if(Y1!==void 0)return Y1;Y1=null;try{let $=(await e7(E6)).match(Z9);if($)Y1=$[1]}catch(_){}return Y1},uY=()=>{if(Y1!==void 0)return Y1;Y1=null;try{let $=_9(E6).match(Z9);if($)Y1=$[1]}catch(_){}return Y1},F9=()=>{let _=t7();if(_.header&&_.header.glibcVersionRuntime)return _.header.glibcVersionRuntime;return null},r7=(_)=>_.trim().split(/\s+/)[1],W9=(_)=>{let[$,X,Z]=_.split(/[\r\n]+/);if($&&$.includes(R1))return r7($);if(X&&Z&&X.includes(o1))return r7(Z);return null},dY=async()=>{let _=null;if(E2()){if(_=await mY(),!_)_=F9();if(!_){let $=await $9();_=W9($)}}return _},cY=()=>{let _=null;if(E2()){if(_=uY(),!_)_=F9();if(!_){let $=X9();_=W9($)}}return _};U9.exports={GLIBC:R1,MUSL:o1,family:z9,familySync:H9,isNonGlibcLinux:gY,isNonGlibcLinuxSync:pY,version:dY,versionSync:cY}});var D9=d((GO,K9)=>{var lY={ALLOW:0,DENY:1};K9.exports=lY});var R9=d((YO,O9)=>{var H4={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function s1(_,$,X){if(new.target!==s1)return new s1(_,$);if(typeof $!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,_),H4.value=""+_,Object.defineProperty(this,"message",H4),Error.captureStackTrace(this,s1),this.code=$,this.rawCode=X}Object.setPrototypeOf(s1,Error);Object.setPrototypeOf(s1.prototype,Error.prototype);Object.defineProperty(s1.prototype,"name",H4);O9.exports=s1});var j9=d((zO,j6)=>{var __dirname="/Users/kyle/rules/node_modules/libsql",{load:iY,currentTarget:nY}=d7(),{familySync:V9,GLIBC:oY,MUSL:sY}=A9();function rY(){if(process.env.LIBSQL_JS_DEV)return iY(__dirname);let _=nY();if(V9()==oY)switch(_){case"linux-x64-musl":_="linux-x64-gnu";break;case"linux-arm64-musl":_="linux-arm64-gnu";break}if(_==="linux-arm-gnueabihf"&&V9()==sY)_="linux-arm-musleabihf";return h(`@libsql/${_}`)}var{databaseOpen:aY,databaseOpenWithSync:tY,databaseInTransaction:eY,databaseInterrupt:_z,databaseClose:$z,databaseSyncSync:Xz,databaseSyncUntilSync:Zz,databaseExecSync:Jz,databasePrepareSync:Gz,databaseDefaultSafeIntegers:Yz,databaseAuthorizer:zz,databaseLoadExtension:Hz,databaseMaxWriteReplicationIndex:Fz,statementRaw:Wz,statementIsReader:Uz,statementGet:N9,statementRun:M9,statementInterrupt:Az,statementRowsSync:B9,statementColumns:Kz,statementSafeIntegers:Dz,rowsNext:Oz}=rY(),Rz=D9(),I9=R9();function j2(_){if(_.libsqlError)return new I9(_.message,_.code,_.rawCode);return _}class Q9{constructor(_,$){let X=$?.encryptionCipher??"aes256cbc";if($&&$.syncUrl){var Z="";if($.syncAuth)console.warn("Warning: The `syncAuth` option is deprecated, please use `authToken` option instead."),Z=$.syncAuth;else if($.authToken)Z=$.authToken;let G=$?.encryptionKey??"",Y=$?.syncPeriod??0,z=$?.readYourWrites??!0,H=$?.offline??!1,F=$?.remoteEncryptionKey??"";this.db=tY(_,$.syncUrl,Z,X,G,Y,z,H,F)}else{let G=$?.authToken??"",Y=$?.encryptionKey??"",z=$?.timeout??0,H=$?.remoteEncryptionKey??"";this.db=aY(_,G,X,Y,z,H)}this.memory=_===":memory:",this.readonly=!1,this.name="",this.open=!0;let J=this.db;Object.defineProperties(this,{inTransaction:{get(){return eY(J)}}})}sync(){return Xz.call(this.db)}syncUntil(_){return Zz.call(this.db,_)}prepare(_){try{let $=Gz.call(this.db,_);return new E9($)}catch($){throw j2($)}}transaction(_){if(typeof _!=="function")throw TypeError("Expected first argument to be a function");let $=this,X=(J)=>{return(...G)=>{$.exec("BEGIN "+J);try{let Y=_(...G);return $.exec("COMMIT"),Y}catch(Y){throw $.exec("ROLLBACK"),Y}}},Z={default:{value:X("")},deferred:{value:X("DEFERRED")},immediate:{value:X("IMMEDIATE")},exclusive:{value:X("EXCLUSIVE")},database:{value:this,enumerable:!0}};return Object.defineProperties(Z.default.value,Z),Object.defineProperties(Z.deferred.value,Z),Object.defineProperties(Z.immediate.value,Z),Object.defineProperties(Z.exclusive.value,Z),Z.default.value}pragma(_,$){if($==null)$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");let X=$.simple,Z=this.prepare(`PRAGMA ${_}`,this,!0);return X?Z.pluck().get():Z.all()}backup(_,$){throw Error("not implemented")}serialize(_){throw Error("not implemented")}function(_,$,X){if($==null)$={};if(typeof $==="function")X=$,$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="function")throw TypeError("Expected last argument to be a function");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}aggregate(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object"||$===null)throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}table(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(!_)throw TypeError("Virtual table module name cannot be an empty string");throw Error("not implemented")}authorizer(_){zz.call(this.db,_)}loadExtension(..._){Hz.call(this.db,..._)}maxWriteReplicationIndex(){return Fz.call(this.db)}exec(_){try{Jz.call(this.db,_)}catch($){throw j2($)}}interrupt(){_z.call(this.db)}close(){$z.call(this.db),this.open=!1}defaultSafeIntegers(_){return Yz.call(this.db,_??!0),this}unsafeMode(..._){throw Error("not implemented")}}class E9{constructor(_){this.stmt=_,this.pluckMode=!1}raw(_){return Wz.call(this.stmt,_??!0),this}pluck(_){return this.pluckMode=_??!0,this}get reader(){return Uz.call(this.stmt)}run(..._){try{if(_.length==1&&typeof _[0]==="object")return M9.call(this.stmt,_[0]);else return M9.call(this.stmt,_.flat())}catch($){throw j2($)}}get(..._){try{if(_.length==1&&typeof _[0]==="object")return N9.call(this.stmt,_[0]);else return N9.call(this.stmt,_.flat())}catch($){throw j2($)}}iterate(..._){var $=void 0;if(_.length==1&&typeof _[0]==="object")$=B9.call(this.stmt,_[0]);else $=B9.call(this.stmt,_.flat());return{nextRows:Array(100),nextRowIndex:100,next(){try{if(this.nextRowIndex===100)Oz.call($,this.nextRows),this.nextRowIndex=0;let Z=this.nextRows[this.nextRowIndex];if(this.nextRows[this.nextRowIndex]=void 0,!Z)return{done:!0};return this.nextRowIndex++,{value:Z,done:!1}}catch(Z){throw j2(Z)}},[Symbol.iterator](){return this}}}all(..._){try{let $=[];for(let X of this.iterate(..._))if(this.pluckMode)$.push(X[Object.keys(X)[0]]);else $.push(X);return $}catch($){throw j2($)}}interrupt(){Az.call(this.stmt)}columns(){return Kz.call(this.stmt)}safeIntegers(_){return Dz.call(this.stmt,_??!0),this}}j6.exports=Q9;j6.exports.Authorization=Rz;j6.exports.SqliteError=I9});var V1=d((OO,v9)=>{var S9=["nodebuffer","arraybuffer","fragments"],k9=typeof Blob<"u";if(k9)S9.push("blob");v9.exports={BINARY_TYPES:S9,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:k9,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Q_=d((RO,T6)=>{var{EMPTY_BUFFER:Ez}=V1(),F4=Buffer[Symbol.species];function jz(_,$){if(_.length===0)return Ez;if(_.length===1)return _[0];let X=Buffer.allocUnsafe($),Z=0;for(let J=0;J<_.length;J++){let G=_[J];X.set(G,Z),Z+=G.length}if(Z<$)return new F4(X.buffer,X.byteOffset,Z);return X}function h9(_,$,X,Z,J){for(let G=0;G<J;G++)X[Z+G]=_[G]^$[G&3]}function y9(_,$){for(let X=0;X<_.length;X++)_[X]^=$[X&3]}function Tz(_){if(_.length===_.buffer.byteLength)return _.buffer;return _.buffer.slice(_.byteOffset,_.byteOffset+_.length)}function W4(_){if(W4.readOnly=!0,Buffer.isBuffer(_))return _;let $;if(_ instanceof ArrayBuffer)$=new F4(_);else if(ArrayBuffer.isView(_))$=new F4(_.buffer,_.byteOffset,_.byteLength);else $=Buffer.from(_),W4.readOnly=!1;return $}T6.exports={concat:jz,mask:h9,toArrayBuffer:Tz,toBuffer:W4,unmask:y9};if(!process.env.WS_NO_BUFFER_UTIL)try{let _=(()=>{throw new Error("Cannot require module "+"bufferutil");})();T6.exports.mask=function($,X,Z,J,G){if(G<48)h9($,X,Z,J,G);else _.mask($,X,Z,J,G)},T6.exports.unmask=function($,X){if($.length<32)y9($,X);else _.unmask($,X)}}catch(_){}});var p9=d((VO,g9)=>{var f9=Symbol("kDone"),U4=Symbol("kRun");class b9{constructor(_){this[f9]=()=>{this.pending--,this[U4]()},this.concurrency=_||1/0,this.jobs=[],this.pending=0}add(_){this.jobs.push(_),this[U4]()}[U4](){if(this.pending===this.concurrency)return;if(this.jobs.length){let _=this.jobs.shift();this.pending++,_(this[f9])}}}g9.exports=b9});var j_=d((NO,l9)=>{var E_=h("zlib"),m9=Q_(),Lz=p9(),{kStatusCode:u9}=V1(),wz=Buffer[Symbol.species],Pz=Buffer.from([0,0,255,255]),w6=Symbol("permessage-deflate"),N1=Symbol("total-length"),T2=Symbol("callback"),q1=Symbol("buffers"),L2=Symbol("error"),L6;class d9{constructor(_,$,X){if(this._maxPayload=X|0,this._options=_||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!$,this._deflate=null,this._inflate=null,this.params=null,!L6){let Z=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;L6=new Lz(Z)}}static get extensionName(){return"permessage-deflate"}offer(){let _={};if(this._options.serverNoContextTakeover)_.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)_.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)_.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)_.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)_.client_max_window_bits=!0;return _}accept(_){return _=this.normalizeParams(_),this.params=this._isServer?this.acceptAsServer(_):this.acceptAsClient(_),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let _=this._deflate[T2];if(this._deflate.close(),this._deflate=null,_)_(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(_){let $=this._options,X=_.find((Z)=>{if($.serverNoContextTakeover===!1&&Z.server_no_context_takeover||Z.server_max_window_bits&&($.serverMaxWindowBits===!1||typeof $.serverMaxWindowBits==="number"&&$.serverMaxWindowBits>Z.server_max_window_bits)||typeof $.clientMaxWindowBits==="number"&&!Z.client_max_window_bits)return!1;return!0});if(!X)throw Error("None of the extension offers can be accepted");if($.serverNoContextTakeover)X.server_no_context_takeover=!0;if($.clientNoContextTakeover)X.client_no_context_takeover=!0;if(typeof $.serverMaxWindowBits==="number")X.server_max_window_bits=$.serverMaxWindowBits;if(typeof $.clientMaxWindowBits==="number")X.client_max_window_bits=$.clientMaxWindowBits;else if(X.client_max_window_bits===!0||$.clientMaxWindowBits===!1)delete X.client_max_window_bits;return X}acceptAsClient(_){let $=_[0];if(this._options.clientNoContextTakeover===!1&&$.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!$.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")$.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&$.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return $}normalizeParams(_){return _.forEach(($)=>{Object.keys($).forEach((X)=>{let Z=$[X];if(Z.length>1)throw Error(`Parameter "${X}" must have only a single value`);if(Z=Z[0],X==="client_max_window_bits"){if(Z!==!0){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else if(X==="server_max_window_bits"){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(X==="client_no_context_takeover"||X==="server_no_context_takeover"){if(Z!==!0)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else throw Error(`Unknown parameter "${X}"`);$[X]=Z})}),_}decompress(_,$,X){L6.add((Z)=>{this._decompress(_,$,(J,G)=>{Z(),X(J,G)})})}compress(_,$,X){L6.add((Z)=>{this._compress(_,$,(J,G)=>{Z(),X(J,G)})})}_decompress(_,$,X){let Z=this._isServer?"client":"server";if(!this._inflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?E_.Z_DEFAULT_WINDOWBITS:this.params[J];this._inflate=E_.createInflateRaw({...this._options.zlibInflateOptions,windowBits:G}),this._inflate[w6]=this,this._inflate[N1]=0,this._inflate[q1]=[],this._inflate.on("error",qz),this._inflate.on("data",c9)}if(this._inflate[T2]=X,this._inflate.write(_),$)this._inflate.write(Pz);this._inflate.flush(()=>{let J=this._inflate[L2];if(J){this._inflate.close(),this._inflate=null,X(J);return}let G=m9.concat(this._inflate[q1],this._inflate[N1]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[N1]=0,this._inflate[q1]=[],$&&this.params[`${Z}_no_context_takeover`])this._inflate.reset();X(null,G)})}_compress(_,$,X){let Z=this._isServer?"server":"client";if(!this._deflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?E_.Z_DEFAULT_WINDOWBITS:this.params[J];this._deflate=E_.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:G}),this._deflate[N1]=0,this._deflate[q1]=[],this._deflate.on("data",xz)}this._deflate[T2]=X,this._deflate.write(_),this._deflate.flush(E_.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let J=m9.concat(this._deflate[q1],this._deflate[N1]);if($)J=new wz(J.buffer,J.byteOffset,J.length-4);if(this._deflate[T2]=null,this._deflate[N1]=0,this._deflate[q1]=[],$&&this.params[`${Z}_no_context_takeover`])this._deflate.reset();X(null,J)})}}l9.exports=d9;function xz(_){this[q1].push(_),this[N1]+=_.length}function c9(_){if(this[N1]+=_.length,this[w6]._maxPayload<1||this[N1]<=this[w6]._maxPayload){this[q1].push(_);return}this[L2]=RangeError("Max payload size exceeded"),this[L2].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[L2][u9]=1009,this.removeListener("data",c9),this.reset()}function qz(_){if(this[w6]._inflate=null,this[L2]){this[T2](this[L2]);return}_[u9]=1007,this[T2](_)}});var w2=d((MO,P6)=>{var{isUtf8:i9}=h("buffer"),{hasBlob:Cz}=V1(),Sz=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function kz(_){return _>=1000&&_<=1014&&_!==1004&&_!==1005&&_!==1006||_>=3000&&_<=4999}function A4(_){let $=_.length,X=0;while(X<$)if((_[X]&128)===0)X++;else if((_[X]&224)===192){if(X+1===$||(_[X+1]&192)!==128||(_[X]&254)===192)return!1;X+=2}else if((_[X]&240)===224){if(X+2>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||_[X]===224&&(_[X+1]&224)===128||_[X]===237&&(_[X+1]&224)===160)return!1;X+=3}else if((_[X]&248)===240){if(X+3>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||(_[X+3]&192)!==128||_[X]===240&&(_[X+1]&240)===128||_[X]===244&&_[X+1]>143||_[X]>244)return!1;X+=4}else return!1;return!0}function vz(_){return Cz&&typeof _==="object"&&typeof _.arrayBuffer==="function"&&typeof _.type==="string"&&typeof _.stream==="function"&&(_[Symbol.toStringTag]==="Blob"||_[Symbol.toStringTag]==="File")}P6.exports={isBlob:vz,isValidStatusCode:kz,isValidUTF8:A4,tokenChars:Sz};if(i9)P6.exports.isValidUTF8=function(_){return _.length<24?A4(_):i9(_)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let _=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();P6.exports.isValidUTF8=function($){return $.length<32?A4($):_($)}}catch(_){}});var D4=d((BO,a9)=>{var{Writable:hz}=h("stream"),n9=j_(),{BINARY_TYPES:yz,EMPTY_BUFFER:o9,kStatusCode:fz,kWebSocket:bz}=V1(),{concat:K4,toArrayBuffer:gz,unmask:pz}=Q_(),{isValidStatusCode:mz,isValidUTF8:s9}=w2(),x6=Buffer[Symbol.species];class r9 extends hz{constructor(_={}){super();this._allowSynchronousEvents=_.allowSynchronousEvents!==void 0?_.allowSynchronousEvents:!0,this._binaryType=_.binaryType||yz[0],this._extensions=_.extensions||{},this._isServer=!!_.isServer,this._maxPayload=_.maxPayload|0,this._skipUTF8Validation=!!_.skipUTF8Validation,this[bz]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(_,$,X){if(this._opcode===8&&this._state==0)return X();this._bufferedBytes+=_.length,this._buffers.push(_),this.startLoop(X)}consume(_){if(this._bufferedBytes-=_,_===this._buffers[0].length)return this._buffers.shift();if(_<this._buffers[0].length){let X=this._buffers[0];return this._buffers[0]=new x6(X.buffer,X.byteOffset+_,X.length-_),new x6(X.buffer,X.byteOffset,_)}let $=Buffer.allocUnsafe(_);do{let X=this._buffers[0],Z=$.length-_;if(_>=X.length)$.set(this._buffers.shift(),Z);else $.set(new Uint8Array(X.buffer,X.byteOffset,_),Z),this._buffers[0]=new x6(X.buffer,X.byteOffset+_,X.length-_);_-=X.length}while(_>0);return $}startLoop(_){this._loop=!0;do switch(this._state){case 0:this.getInfo(_);break;case 1:this.getPayloadLength16(_);break;case 2:this.getPayloadLength64(_);break;case 3:this.getMask();break;case 4:this.getData(_);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)_()}getInfo(_){if(this._bufferedBytes<2){this._loop=!1;return}let $=this.consume(2);if(($[0]&48)!==0){let Z=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");_(Z);return}let X=($[0]&64)===64;if(X&&!this._extensions[n9.extensionName]){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._fin=($[0]&128)===128,this._opcode=$[0]&15,this._payloadLength=$[1]&127,this._opcode===0){if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(!this._fragmented){let Z=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._compressed=X}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let Z=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");_(Z);return}if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let Z=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");_(Z);return}}else{let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=($[1]&128)===128,this._isServer){if(!this._masked){let Z=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");_(Z);return}}else if(this._masked){let Z=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");_(Z);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(_)}getPayloadLength16(_){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(_)}getPayloadLength64(_){if(this._bufferedBytes<8){this._loop=!1;return}let $=this.consume(8),X=$.readUInt32BE(0);if(X>Math.pow(2,21)-1){let Z=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");_(Z);return}this._payloadLength=X*Math.pow(2,32)+$.readUInt32BE(4),this.haveLength(_)}haveLength(_){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let $=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");_($);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(_){let $=o9;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if($=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)pz($,this._mask)}if(this._opcode>7){this.controlMessage($,_);return}if(this._compressed){this._state=5,this.decompress($,_);return}if($.length)this._messageLength=this._totalPayloadLength,this._fragments.push($);this.dataMessage(_)}decompress(_,$){this._extensions[n9.extensionName].decompress(_,this._fin,(Z,J)=>{if(Z)return $(Z);if(J.length){if(this._messageLength+=J.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let G=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");$(G);return}this._fragments.push(J)}if(this.dataMessage($),this._state===0)this.startLoop($)})}dataMessage(_){if(!this._fin){this._state=0;return}let $=this._messageLength,X=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let Z;if(this._binaryType==="nodebuffer")Z=K4(X,$);else if(this._binaryType==="arraybuffer")Z=gz(K4(X,$));else if(this._binaryType==="blob")Z=new Blob(X);else Z=X;if(this._allowSynchronousEvents)this.emit("message",Z,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!0),this._state=0,this.startLoop(_)})}else{let Z=K4(X,$);if(!this._skipUTF8Validation&&!s9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");_(J);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",Z,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!1),this._state=0,this.startLoop(_)})}}controlMessage(_,$){if(this._opcode===8){if(_.length===0)this._loop=!1,this.emit("conclude",1005,o9),this.end();else{let X=_.readUInt16BE(0);if(!mz(X)){let J=this.createError(RangeError,`invalid status code ${X}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");$(J);return}let Z=new x6(_.buffer,_.byteOffset+2,_.length-2);if(!this._skipUTF8Validation&&!s9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");$(J);return}this._loop=!1,this.emit("conclude",X,Z),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",_),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",_),this._state=0,this.startLoop($)})}createError(_,$,X,Z,J){this._loop=!1,this._errored=!0;let G=new _(X?`Invalid WebSocket frame: ${$}`:$);return Error.captureStackTrace(G,this.createError),G.code=J,G[fz]=Z,G}}a9.exports=r9});var R4=d((QO,_$)=>{var{Duplex:IO}=h("stream"),{randomFillSync:uz}=h("crypto"),t9=j_(),{EMPTY_BUFFER:dz,kWebSocket:cz,NOOP:lz}=V1(),{isBlob:P2,isValidStatusCode:iz}=w2(),{mask:e9,toBuffer:r1}=Q_(),m0=Symbol("kByteLength"),nz=Buffer.alloc(4),a1,x2=8192,n0=0,oz=1,sz=2;class C1{constructor(_,$,X){if(this._extensions=$||{},X)this._generateMask=X,this._maskBuffer=Buffer.alloc(4);this._socket=_,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=n0,this.onerror=lz,this[cz]=void 0}static frame(_,$){let X,Z=!1,J=2,G=!1;if($.mask){if(X=$.maskBuffer||nz,$.generateMask)$.generateMask(X);else{if(x2===8192){if(a1===void 0)a1=Buffer.alloc(8192);uz(a1,0,8192),x2=0}X[0]=a1[x2++],X[1]=a1[x2++],X[2]=a1[x2++],X[3]=a1[x2++]}G=(X[0]|X[1]|X[2]|X[3])===0,J=6}let Y;if(typeof _==="string")if((!$.mask||G)&&$[m0]!==void 0)Y=$[m0];else _=Buffer.from(_),Y=_.length;else Y=_.length,Z=$.mask&&$.readOnly&&!G;let z=Y;if(Y>=65536)J+=8,z=127;else if(Y>125)J+=2,z=126;let H=Buffer.allocUnsafe(Z?Y+J:J);if(H[0]=$.fin?$.opcode|128:$.opcode,$.rsv1)H[0]|=64;if(H[1]=z,z===126)H.writeUInt16BE(Y,2);else if(z===127)H[2]=H[3]=0,H.writeUIntBE(Y,4,6);if(!$.mask)return[H,_];if(H[1]|=128,H[J-4]=X[0],H[J-3]=X[1],H[J-2]=X[2],H[J-1]=X[3],G)return[H,_];if(Z)return e9(_,X,H,J,Y),[H];return e9(_,X,_,0,Y),[H,_]}close(_,$,X,Z){let J;if(_===void 0)J=dz;else if(typeof _!=="number"||!iz(_))throw TypeError("First argument must be a valid error code number");else if($===void 0||!$.length)J=Buffer.allocUnsafe(2),J.writeUInt16BE(_,0);else{let Y=Buffer.byteLength($);if(Y>123)throw RangeError("The message must not be greater than 123 bytes");if(J=Buffer.allocUnsafe(2+Y),J.writeUInt16BE(_,0),typeof $==="string")J.write($,2);else J.set($,2)}let G={[m0]:J.length,fin:!0,generateMask:this._generateMask,mask:X,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==n0)this.enqueue([this.dispatch,J,!1,G,Z]);else this.sendFrame(C1.frame(J,G),Z)}ping(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(P2(_))Z=_.size,J=!1;else _=r1(_),Z=_.length,J=r1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[m0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:9,readOnly:J,rsv1:!1};if(P2(_))if(this._state!==n0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==n0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(C1.frame(_,G),X)}pong(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(P2(_))Z=_.size,J=!1;else _=r1(_),Z=_.length,J=r1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[m0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:10,readOnly:J,rsv1:!1};if(P2(_))if(this._state!==n0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==n0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(C1.frame(_,G),X)}send(_,$,X){let Z=this._extensions[t9.extensionName],J=$.binary?2:1,G=$.compress,Y,z;if(typeof _==="string")Y=Buffer.byteLength(_),z=!1;else if(P2(_))Y=_.size,z=!1;else _=r1(_),Y=_.length,z=r1.readOnly;if(this._firstFragment){if(this._firstFragment=!1,G&&Z&&Z.params[Z._isServer?"server_no_context_takeover":"client_no_context_takeover"])G=Y>=Z._threshold;this._compress=G}else G=!1,J=0;if($.fin)this._firstFragment=!0;let H={[m0]:Y,fin:$.fin,generateMask:this._generateMask,mask:$.mask,maskBuffer:this._maskBuffer,opcode:J,readOnly:z,rsv1:G};if(P2(_))if(this._state!==n0)this.enqueue([this.getBlobData,_,this._compress,H,X]);else this.getBlobData(_,this._compress,H,X);else if(this._state!==n0)this.enqueue([this.dispatch,_,this._compress,H,X]);else this.dispatch(_,this._compress,H,X)}getBlobData(_,$,X,Z){this._bufferedBytes+=X[m0],this._state=sz,_.arrayBuffer().then((J)=>{if(this._socket.destroyed){let Y=Error("The socket was closed while the blob was being read");process.nextTick(O4,this,Y,Z);return}this._bufferedBytes-=X[m0];let G=r1(J);if(!$)this._state=n0,this.sendFrame(C1.frame(G,X),Z),this.dequeue();else this.dispatch(G,$,X,Z)}).catch((J)=>{process.nextTick(rz,this,J,Z)})}dispatch(_,$,X,Z){if(!$){this.sendFrame(C1.frame(_,X),Z);return}let J=this._extensions[t9.extensionName];this._bufferedBytes+=X[m0],this._state=oz,J.compress(_,X.fin,(G,Y)=>{if(this._socket.destroyed){let z=Error("The socket was closed while data was being compressed");O4(this,z,Z);return}this._bufferedBytes-=X[m0],this._state=n0,X.readOnly=!1,this.sendFrame(C1.frame(Y,X),Z),this.dequeue()})}dequeue(){while(this._state===n0&&this._queue.length){let _=this._queue.shift();this._bufferedBytes-=_[3][m0],Reflect.apply(_[0],this,_.slice(1))}}enqueue(_){this._bufferedBytes+=_[3][m0],this._queue.push(_)}sendFrame(_,$){if(_.length===2)this._socket.cork(),this._socket.write(_[0]),this._socket.write(_[1],$),this._socket.uncork();else this._socket.write(_[0],$)}}_$.exports=C1;function O4(_,$,X){if(typeof X==="function")X($);for(let Z=0;Z<_._queue.length;Z++){let J=_._queue[Z],G=J[J.length-1];if(typeof G==="function")G($)}}function rz(_,$,X){O4(_,$,X),_.onerror($)}});var F$=d((EO,H$)=>{var{kForOnEventAttribute:T_,kListener:V4}=V1(),$$=Symbol("kCode"),X$=Symbol("kData"),Z$=Symbol("kError"),J$=Symbol("kMessage"),G$=Symbol("kReason"),q2=Symbol("kTarget"),Y$=Symbol("kType"),z$=Symbol("kWasClean");class S1{constructor(_){this[q2]=null,this[Y$]=_}get target(){return this[q2]}get type(){return this[Y$]}}Object.defineProperty(S1.prototype,"target",{enumerable:!0});Object.defineProperty(S1.prototype,"type",{enumerable:!0});class C2 extends S1{constructor(_,$={}){super(_);this[$$]=$.code===void 0?0:$.code,this[G$]=$.reason===void 0?"":$.reason,this[z$]=$.wasClean===void 0?!1:$.wasClean}get code(){return this[$$]}get reason(){return this[G$]}get wasClean(){return this[z$]}}Object.defineProperty(C2.prototype,"code",{enumerable:!0});Object.defineProperty(C2.prototype,"reason",{enumerable:!0});Object.defineProperty(C2.prototype,"wasClean",{enumerable:!0});class L_ extends S1{constructor(_,$={}){super(_);this[Z$]=$.error===void 0?null:$.error,this[J$]=$.message===void 0?"":$.message}get error(){return this[Z$]}get message(){return this[J$]}}Object.defineProperty(L_.prototype,"error",{enumerable:!0});Object.defineProperty(L_.prototype,"message",{enumerable:!0});class C6 extends S1{constructor(_,$={}){super(_);this[X$]=$.data===void 0?null:$.data}get data(){return this[X$]}}Object.defineProperty(C6.prototype,"data",{enumerable:!0});var az={addEventListener(_,$,X={}){for(let J of this.listeners(_))if(!X[T_]&&J[V4]===$&&!J[T_])return;let Z;if(_==="message")Z=function(G,Y){let z=new C6("message",{data:Y?G:G.toString()});z[q2]=this,q6($,this,z)};else if(_==="close")Z=function(G,Y){let z=new C2("close",{code:G,reason:Y.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});z[q2]=this,q6($,this,z)};else if(_==="error")Z=function(G){let Y=new L_("error",{error:G,message:G.message});Y[q2]=this,q6($,this,Y)};else if(_==="open")Z=function(){let G=new S1("open");G[q2]=this,q6($,this,G)};else return;if(Z[T_]=!!X[T_],Z[V4]=$,X.once)this.once(_,Z);else this.on(_,Z)},removeEventListener(_,$){for(let X of this.listeners(_))if(X[V4]===$&&!X[T_]){this.removeListener(_,X);break}}};H$.exports={CloseEvent:C2,ErrorEvent:L_,Event:S1,EventTarget:az,MessageEvent:C6};function q6(_,$,X){if(typeof _==="object"&&_.handleEvent)_.handleEvent.call(_,X);else _.call($,X)}});var N4=d((jO,W$)=>{var{tokenChars:w_}=w2();function z1(_,$,X){if(_[$]===void 0)_[$]=[X];else _[$].push(X)}function tz(_){let $=Object.create(null),X=Object.create(null),Z=!1,J=!1,G=!1,Y,z,H=-1,F=-1,W=-1,A=0;for(;A<_.length;A++)if(F=_.charCodeAt(A),Y===void 0)if(W===-1&&w_[F]===1){if(H===-1)H=A}else if(A!==0&&(F===32||F===9)){if(W===-1&&H!==-1)W=A}else if(F===59||F===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;let R=_.slice(H,W);if(F===44)z1($,R,X),X=Object.create(null);else Y=R;H=W=-1}else throw SyntaxError(`Unexpected character at index ${A}`);else if(z===void 0)if(W===-1&&w_[F]===1){if(H===-1)H=A}else if(F===32||F===9){if(W===-1&&H!==-1)W=A}else if(F===59||F===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;if(z1(X,_.slice(H,W),!0),F===44)z1($,Y,X),X=Object.create(null),Y=void 0;H=W=-1}else if(F===61&&H!==-1&&W===-1)z=_.slice(H,A),H=W=-1;else throw SyntaxError(`Unexpected character at index ${A}`);else if(J){if(w_[F]!==1)throw SyntaxError(`Unexpected character at index ${A}`);if(H===-1)H=A;else if(!Z)Z=!0;J=!1}else if(G)if(w_[F]===1){if(H===-1)H=A}else if(F===34&&H!==-1)G=!1,W=A;else if(F===92)J=!0;else throw SyntaxError(`Unexpected character at index ${A}`);else if(F===34&&_.charCodeAt(A-1)===61)G=!0;else if(W===-1&&w_[F]===1){if(H===-1)H=A}else if(H!==-1&&(F===32||F===9)){if(W===-1)W=A}else if(F===59||F===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;let R=_.slice(H,W);if(Z)R=R.replace(/\\/g,""),Z=!1;if(z1(X,z,R),F===44)z1($,Y,X),X=Object.create(null),Y=void 0;z=void 0,H=W=-1}else throw SyntaxError(`Unexpected character at index ${A}`);if(H===-1||G||F===32||F===9)throw SyntaxError("Unexpected end of input");if(W===-1)W=A;let D=_.slice(H,W);if(Y===void 0)z1($,D,X);else{if(z===void 0)z1(X,D,!0);else if(Z)z1(X,z,D.replace(/\\/g,""));else z1(X,z,D);z1($,Y,X)}return $}function ez(_){return Object.keys(_).map(($)=>{let X=_[$];if(!Array.isArray(X))X=[X];return X.map((Z)=>{return[$].concat(Object.keys(Z).map((J)=>{let G=Z[J];if(!Array.isArray(G))G=[G];return G.map((Y)=>Y===!0?J:`${J}=${Y}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}W$.exports={format:ez,parse:tz}});var h6=d((wO,Q$)=>{var _H=h("events"),$H=h("https"),XH=h("http"),K$=h("net"),ZH=h("tls"),{randomBytes:JH,createHash:GH}=h("crypto"),{Duplex:TO,Readable:LO}=h("stream"),{URL:M4}=h("url"),k1=j_(),YH=D4(),zH=R4(),{isBlob:HH}=w2(),{BINARY_TYPES:U$,EMPTY_BUFFER:S6,GUID:FH,kForOnEventAttribute:B4,kListener:WH,kStatusCode:UH,kWebSocket:W0,NOOP:D$}=V1(),{EventTarget:{addEventListener:AH,removeEventListener:KH}}=F$(),{format:DH,parse:OH}=N4(),{toBuffer:RH}=Q_(),O$=Symbol("kAborted"),I4=[8,13],M1=["CONNECTING","OPEN","CLOSING","CLOSED"],VH=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class x extends _H{constructor(_,$,X){super();if(this._binaryType=U$[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=S6,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=x.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,_!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,$===void 0)$=[];else if(!Array.isArray($))if(typeof $==="object"&&$!==null)X=$,$=[];else $=[$];R$(this,_,$,X)}else this._autoPong=X.autoPong,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(_){if(!U$.includes(_))return;if(this._binaryType=_,this._receiver)this._receiver._binaryType=_}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(_,$,X){let Z=new YH({allowSynchronousEvents:X.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:X.maxPayload,skipUTF8Validation:X.skipUTF8Validation}),J=new zH(_,this._extensions,X.generateMask);if(this._receiver=Z,this._sender=J,this._socket=_,Z[W0]=this,J[W0]=this,_[W0]=this,Z.on("conclude",BH),Z.on("drain",IH),Z.on("error",QH),Z.on("message",EH),Z.on("ping",jH),Z.on("pong",TH),J.onerror=LH,_.setTimeout)_.setTimeout(0);if(_.setNoDelay)_.setNoDelay();if($.length>0)_.unshift($);_.on("close",M$),_.on("data",v6),_.on("end",B$),_.on("error",I$),this._readyState=x.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=x.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[k1.extensionName])this._extensions[k1.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=x.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(_,$){if(this.readyState===x.CLOSED)return;if(this.readyState===x.CONNECTING){x0(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===x.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=x.CLOSING,this._sender.close(_,$,!this._isServer,(X)=>{if(X)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),N$(this)}pause(){if(this.readyState===x.CONNECTING||this.readyState===x.CLOSED)return;this._paused=!0,this._socket.pause()}ping(_,$,X){if(this.readyState===x.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==x.OPEN){Q4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.ping(_||S6,$,X)}pong(_,$,X){if(this.readyState===x.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==x.OPEN){Q4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.pong(_||S6,$,X)}resume(){if(this.readyState===x.CONNECTING||this.readyState===x.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(_,$,X){if(this.readyState===x.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")X=$,$={};if(typeof _==="number")_=_.toString();if(this.readyState!==x.OPEN){Q4(this,_,X);return}let Z={binary:typeof _!=="string",mask:!this._isServer,compress:!0,fin:!0,...$};if(!this._extensions[k1.extensionName])Z.compress=!1;this._sender.send(_||S6,Z,X)}terminate(){if(this.readyState===x.CLOSED)return;if(this.readyState===x.CONNECTING){x0(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=x.CLOSING,this._socket.destroy()}}Object.defineProperty(x,"CONNECTING",{enumerable:!0,value:M1.indexOf("CONNECTING")});Object.defineProperty(x.prototype,"CONNECTING",{enumerable:!0,value:M1.indexOf("CONNECTING")});Object.defineProperty(x,"OPEN",{enumerable:!0,value:M1.indexOf("OPEN")});Object.defineProperty(x.prototype,"OPEN",{enumerable:!0,value:M1.indexOf("OPEN")});Object.defineProperty(x,"CLOSING",{enumerable:!0,value:M1.indexOf("CLOSING")});Object.defineProperty(x.prototype,"CLOSING",{enumerable:!0,value:M1.indexOf("CLOSING")});Object.defineProperty(x,"CLOSED",{enumerable:!0,value:M1.indexOf("CLOSED")});Object.defineProperty(x.prototype,"CLOSED",{enumerable:!0,value:M1.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((_)=>{Object.defineProperty(x.prototype,_,{enumerable:!0})});["open","error","close","message"].forEach((_)=>{Object.defineProperty(x.prototype,`on${_}`,{enumerable:!0,get(){for(let $ of this.listeners(_))if($[B4])return $[WH];return null},set($){for(let X of this.listeners(_))if(X[B4]){this.removeListener(_,X);break}if(typeof $!=="function")return;this.addEventListener(_,$,{[B4]:!0})}})});x.prototype.addEventListener=AH;x.prototype.removeEventListener=KH;Q$.exports=x;function R$(_,$,X,Z){let J={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:I4[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...Z,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(_._autoPong=J.autoPong,!I4.includes(J.protocolVersion))throw RangeError(`Unsupported protocol version: ${J.protocolVersion} (supported versions: ${I4.join(", ")})`);let G;if($ instanceof M4)G=$;else try{G=new M4($)}catch(N){throw SyntaxError(`Invalid URL: ${$}`)}if(G.protocol==="http:")G.protocol="ws:";else if(G.protocol==="https:")G.protocol="wss:";_._url=G.href;let Y=G.protocol==="wss:",z=G.protocol==="ws+unix:",H;if(G.protocol!=="ws:"&&!Y&&!z)H=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(z&&!G.pathname)H="The URL's pathname is empty";else if(G.hash)H="The URL contains a fragment identifier";if(H){let N=SyntaxError(H);if(_._redirects===0)throw N;else{k6(_,N);return}}let F=Y?443:80,W=JH(16).toString("base64"),A=Y?$H.request:XH.request,D=new Set,R;if(J.createConnection=J.createConnection||(Y?MH:NH),J.defaultPort=J.defaultPort||F,J.port=G.port||F,J.host=G.hostname.startsWith("[")?G.hostname.slice(1,-1):G.hostname,J.headers={...J.headers,"Sec-WebSocket-Version":J.protocolVersion,"Sec-WebSocket-Key":W,Connection:"Upgrade",Upgrade:"websocket"},J.path=G.pathname+G.search,J.timeout=J.handshakeTimeout,J.perMessageDeflate)R=new k1(J.perMessageDeflate!==!0?J.perMessageDeflate:{},!1,J.maxPayload),J.headers["Sec-WebSocket-Extensions"]=DH({[k1.extensionName]:R.offer()});if(X.length){for(let N of X){if(typeof N!=="string"||!VH.test(N)||D.has(N))throw SyntaxError("An invalid or duplicated subprotocol was specified");D.add(N)}J.headers["Sec-WebSocket-Protocol"]=X.join(",")}if(J.origin)if(J.protocolVersion<13)J.headers["Sec-WebSocket-Origin"]=J.origin;else J.headers.Origin=J.origin;if(G.username||G.password)J.auth=`${G.username}:${G.password}`;if(z){let N=J.path.split(":");J.socketPath=N[0],J.path=N[1]}let O;if(J.followRedirects){if(_._redirects===0){_._originalIpc=z,_._originalSecure=Y,_._originalHostOrSocketPath=z?J.socketPath:G.host;let N=Z&&Z.headers;if(Z={...Z,headers:{}},N)for(let[I,j]of Object.entries(N))Z.headers[I.toLowerCase()]=j}else if(_.listenerCount("redirect")===0){let N=z?_._originalIpc?J.socketPath===_._originalHostOrSocketPath:!1:_._originalIpc?!1:G.host===_._originalHostOrSocketPath;if(!N||_._originalSecure&&!Y){if(delete J.headers.authorization,delete J.headers.cookie,!N)delete J.headers.host;J.auth=void 0}}if(J.auth&&!Z.headers.authorization)Z.headers.authorization="Basic "+Buffer.from(J.auth).toString("base64");if(O=_._req=A(J),_._redirects)_.emit("redirect",_.url,O)}else O=_._req=A(J);if(J.timeout)O.on("timeout",()=>{x0(_,O,"Opening handshake has timed out")});if(O.on("error",(N)=>{if(O===null||O[O$])return;O=_._req=null,k6(_,N)}),O.on("response",(N)=>{let I=N.headers.location,j=N.statusCode;if(I&&J.followRedirects&&j>=300&&j<400){if(++_._redirects>J.maxRedirects){x0(_,O,"Maximum redirects exceeded");return}O.abort();let w;try{w=new M4(I,$)}catch(q){let t=SyntaxError(`Invalid URL: ${I}`);k6(_,t);return}R$(_,w,X,Z)}else if(!_.emit("unexpected-response",O,N))x0(_,O,`Unexpected server response: ${N.statusCode}`)}),O.on("upgrade",(N,I,j)=>{if(_.emit("upgrade",N),_.readyState!==x.CONNECTING)return;O=_._req=null;let w=N.headers.upgrade;if(w===void 0||w.toLowerCase()!=="websocket"){x0(_,I,"Invalid Upgrade header");return}let q=GH("sha1").update(W+FH).digest("base64");if(N.headers["sec-websocket-accept"]!==q){x0(_,I,"Invalid Sec-WebSocket-Accept header");return}let t=N.headers["sec-websocket-protocol"],u;if(t!==void 0){if(!D.size)u="Server sent a subprotocol but none was requested";else if(!D.has(t))u="Server sent an invalid subprotocol"}else if(D.size)u="Server sent no subprotocol";if(u){x0(_,I,u);return}if(t)_._protocol=t;let E=N.headers["sec-websocket-extensions"];if(E!==void 0){if(!R){x0(_,I,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let g;try{g=OH(E)}catch(j1){x0(_,I,"Invalid Sec-WebSocket-Extensions header");return}let v0=Object.keys(g);if(v0.length!==1||v0[0]!==k1.extensionName){x0(_,I,"Server indicated an extension that was not requested");return}try{R.accept(g[k1.extensionName])}catch(j1){x0(_,I,"Invalid Sec-WebSocket-Extensions header");return}_._extensions[k1.extensionName]=R}_.setSocket(I,j,{allowSynchronousEvents:J.allowSynchronousEvents,generateMask:J.generateMask,maxPayload:J.maxPayload,skipUTF8Validation:J.skipUTF8Validation})}),J.finishRequest)J.finishRequest(O,_);else O.end()}function k6(_,$){_._readyState=x.CLOSING,_._errorEmitted=!0,_.emit("error",$),_.emitClose()}function NH(_){return _.path=_.socketPath,K$.connect(_)}function MH(_){if(_.path=void 0,!_.servername&&_.servername!=="")_.servername=K$.isIP(_.host)?"":_.host;return ZH.connect(_)}function x0(_,$,X){_._readyState=x.CLOSING;let Z=Error(X);if(Error.captureStackTrace(Z,x0),$.setHeader){if($[O$]=!0,$.abort(),$.socket&&!$.socket.destroyed)$.socket.destroy();process.nextTick(k6,_,Z)}else $.destroy(Z),$.once("error",_.emit.bind(_,"error")),$.once("close",_.emitClose.bind(_))}function Q4(_,$,X){if($){let Z=HH($)?$.size:RH($).length;if(_._socket)_._sender._bufferedBytes+=Z;else _._bufferedAmount+=Z}if(X){let Z=Error(`WebSocket is not open: readyState ${_.readyState} (${M1[_.readyState]})`);process.nextTick(X,Z)}}function BH(_,$){let X=this[W0];if(X._closeFrameReceived=!0,X._closeMessage=$,X._closeCode=_,X._socket[W0]===void 0)return;if(X._socket.removeListener("data",v6),process.nextTick(V$,X._socket),_===1005)X.close();else X.close(_,$)}function IH(){let _=this[W0];if(!_.isPaused)_._socket.resume()}function QH(_){let $=this[W0];if($._socket[W0]!==void 0)$._socket.removeListener("data",v6),process.nextTick(V$,$._socket),$.close(_[UH]);if(!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function A$(){this[W0].emitClose()}function EH(_,$){this[W0].emit("message",_,$)}function jH(_){let $=this[W0];if($._autoPong)$.pong(_,!this._isServer,D$);$.emit("ping",_)}function TH(_){this[W0].emit("pong",_)}function V$(_){_.resume()}function LH(_){let $=this[W0];if($.readyState===x.CLOSED)return;if($.readyState===x.OPEN)$._readyState=x.CLOSING,N$($);if(this._socket.end(),!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function N$(_){_._closeTimer=setTimeout(_._socket.destroy.bind(_._socket),30000)}function M$(){let _=this[W0];this.removeListener("close",M$),this.removeListener("data",v6),this.removeListener("end",B$),_._readyState=x.CLOSING;let $;if(!this._readableState.endEmitted&&!_._closeFrameReceived&&!_._receiver._writableState.errorEmitted&&($=_._socket.read())!==null)_._receiver.write($);if(_._receiver.end(),this[W0]=void 0,clearTimeout(_._closeTimer),_._receiver._writableState.finished||_._receiver._writableState.errorEmitted)_.emitClose();else _._receiver.on("error",A$),_._receiver.on("finish",A$)}function v6(_){if(!this[W0]._receiver.write(_))this.pause()}function B$(){let _=this[W0];_._readyState=x.CLOSING,_._receiver.end(),this.end()}function I$(){let _=this[W0];if(this.removeListener("error",I$),this.on("error",D$),_)_._readyState=x.CLOSING,this.destroy()}});var L$=d((xO,T$)=>{var PO=h6(),{Duplex:wH}=h("stream");function E$(_){_.emit("close")}function PH(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function j$(_){if(this.removeListener("error",j$),this.destroy(),this.listenerCount("error")===0)this.emit("error",_)}function xH(_,$){let X=!0,Z=new wH({...$,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return _.on("message",function(G,Y){let z=!Y&&Z._readableState.objectMode?G.toString():G;if(!Z.push(z))_.pause()}),_.once("error",function(G){if(Z.destroyed)return;X=!1,Z.destroy(G)}),_.once("close",function(){if(Z.destroyed)return;Z.push(null)}),Z._destroy=function(J,G){if(_.readyState===_.CLOSED){G(J),process.nextTick(E$,Z);return}let Y=!1;if(_.once("error",function(H){Y=!0,G(H)}),_.once("close",function(){if(!Y)G(J);process.nextTick(E$,Z)}),X)_.terminate()},Z._final=function(J){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._final(J)});return}if(_._socket===null)return;if(_._socket._writableState.finished){if(J(),Z._readableState.endEmitted)Z.destroy()}else _._socket.once("finish",function(){J()}),_.close()},Z._read=function(){if(_.isPaused)_.resume()},Z._write=function(J,G,Y){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._write(J,G,Y)});return}_.send(J,Y)},Z.on("end",PH),Z.on("error",j$),Z}T$.exports=xH});var P$=d((qO,w$)=>{var{tokenChars:qH}=w2();function CH(_){let $=new Set,X=-1,Z=-1,J=0;for(J;J<_.length;J++){let Y=_.charCodeAt(J);if(Z===-1&&qH[Y]===1){if(X===-1)X=J}else if(J!==0&&(Y===32||Y===9)){if(Z===-1&&X!==-1)Z=J}else if(Y===44){if(X===-1)throw SyntaxError(`Unexpected character at index ${J}`);if(Z===-1)Z=J;let z=_.slice(X,Z);if($.has(z))throw SyntaxError(`The "${z}" subprotocol is duplicated`);$.add(z),X=Z=-1}else throw SyntaxError(`Unexpected character at index ${J}`)}if(X===-1||Z!==-1)throw SyntaxError("Unexpected end of input");let G=_.slice(X,J);if($.has(G))throw SyntaxError(`The "${G}" subprotocol is duplicated`);return $.add(G),$}w$.exports={parse:CH}});var k$=d((SO,S$)=>{var SH=h("events"),y6=h("http"),{Duplex:CO}=h("stream"),{createHash:kH}=h("crypto"),x$=N4(),t1=j_(),vH=P$(),hH=h6(),{GUID:yH,kWebSocket:fH}=V1(),bH=/^[+/0-9A-Za-z]{22}==$/;class C$ extends SH{constructor(_,$){super();if(_={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:hH,..._},_.port==null&&!_.server&&!_.noServer||_.port!=null&&(_.server||_.noServer)||_.server&&_.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(_.port!=null)this._server=y6.createServer((X,Z)=>{let J=y6.STATUS_CODES[426];Z.writeHead(426,{"Content-Length":J.length,"Content-Type":"text/plain"}),Z.end(J)}),this._server.listen(_.port,_.host,_.backlog,$);else if(_.server)this._server=_.server;if(this._server){let X=this.emit.bind(this,"connection");this._removeListeners=gH(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(Z,J,G)=>{this.handleUpgrade(Z,J,G,X)}})}if(_.perMessageDeflate===!0)_.perMessageDeflate={};if(_.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=_,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(_){if(this._state===2){if(_)this.once("close",()=>{_(Error("The server is not running"))});process.nextTick(P_,this);return}if(_)this.once("close",_);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(P_,this);else this._shouldEmitClose=!0;else process.nextTick(P_,this)}else{let $=this._server;this._removeListeners(),this._removeListeners=this._server=null,$.close(()=>{P_(this)})}}shouldHandle(_){if(this.options.path){let $=_.url.indexOf("?");if(($!==-1?_.url.slice(0,$):_.url)!==this.options.path)return!1}return!0}handleUpgrade(_,$,X,Z){$.on("error",q$);let J=_.headers["sec-websocket-key"],G=_.headers.upgrade,Y=+_.headers["sec-websocket-version"];if(_.method!=="GET"){e1(this,_,$,405,"Invalid HTTP method");return}if(G===void 0||G.toLowerCase()!=="websocket"){e1(this,_,$,400,"Invalid Upgrade header");return}if(J===void 0||!bH.test(J)){e1(this,_,$,400,"Missing or invalid Sec-WebSocket-Key header");return}if(Y!==13&&Y!==8){e1(this,_,$,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(_)){x_($,400);return}let z=_.headers["sec-websocket-protocol"],H=new Set;if(z!==void 0)try{H=vH.parse(z)}catch(A){e1(this,_,$,400,"Invalid Sec-WebSocket-Protocol header");return}let F=_.headers["sec-websocket-extensions"],W={};if(this.options.perMessageDeflate&&F!==void 0){let A=new t1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let D=x$.parse(F);if(D[t1.extensionName])A.accept(D[t1.extensionName]),W[t1.extensionName]=A}catch(D){e1(this,_,$,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let A={origin:_.headers[`${Y===8?"sec-websocket-origin":"origin"}`],secure:!!(_.socket.authorized||_.socket.encrypted),req:_};if(this.options.verifyClient.length===2){this.options.verifyClient(A,(D,R,O,N)=>{if(!D)return x_($,R||401,O,N);this.completeUpgrade(W,J,H,_,$,X,Z)});return}if(!this.options.verifyClient(A))return x_($,401)}this.completeUpgrade(W,J,H,_,$,X,Z)}completeUpgrade(_,$,X,Z,J,G,Y){if(!J.readable||!J.writable)return J.destroy();if(J[fH])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return x_(J,503);let H=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${kH("sha1").update($+yH).digest("base64")}`],F=new this.options.WebSocket(null,void 0,this.options);if(X.size){let W=this.options.handleProtocols?this.options.handleProtocols(X,Z):X.values().next().value;if(W)H.push(`Sec-WebSocket-Protocol: ${W}`),F._protocol=W}if(_[t1.extensionName]){let W=_[t1.extensionName].params,A=x$.format({[t1.extensionName]:[W]});H.push(`Sec-WebSocket-Extensions: ${A}`),F._extensions=_}if(this.emit("headers",H,Z),J.write(H.concat(`\r
`).join(`\r
`)),J.removeListener("error",q$),F.setSocket(J,G,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(F),F.on("close",()=>{if(this.clients.delete(F),this._shouldEmitClose&&!this.clients.size)process.nextTick(P_,this)});Y(F,Z)}}S$.exports=C$;function gH(_,$){for(let X of Object.keys($))_.on(X,$[X]);return function(){for(let Z of Object.keys($))_.removeListener(Z,$[Z])}}function P_(_){_._state=2,_.emit("close")}function q$(){this.destroy()}function x_(_,$,X,Z){X=X||y6.STATUS_CODES[$],Z={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(X),...Z},_.once("finish",_.destroy),_.end(`HTTP/1.1 ${$} ${y6.STATUS_CODES[$]}\r
`+Object.keys(Z).map((J)=>`${J}: ${Z[J]}`).join(`\r
`)+`\r
\r
`+X)}function e1(_,$,X,Z,J,G){if(_.listenerCount("wsClientError")){let Y=Error(J);Error.captureStackTrace(Y,e1),_.emit("wsClientError",Y,X,$)}else x_(X,Z,J,G)}});var b4=d((CN,AX)=>{function JW(_){var $=0,X=[];function Z(){if($--,$<_)J()}function J(){var H=X.shift();if(z.queue=X.length,H)Y(H.fn).then(H.resolve).catch(H.reject)}function G(H){return new Promise(function(F,W){X.push({fn:H,resolve:F,reject:W}),z.queue=X.length})}function Y(H){$++;try{return Promise.resolve(H()).then(function(F){return Z(),F},function(F){throw Z(),F})}catch(F){return Z(),Promise.reject(F)}}var z=function(H){if($>=_)return G(H);else return Y(H)};return z}function GW(_,$){var X=!1,Z=this;return Promise.all(_.map(function(){var J=arguments;return Z(function(){if(!X)return $.apply(void 0,J).catch(function(G){throw X=!0,G})})}))}function UX(_){return _.queue=0,_.map=GW,_}AX.exports=function(_){if(_)return UX(JW(_));else return UX(function($){return $()})}});var l5=j0(c5(),1),{program:RU,createCommand:VU,createArgument:NU,createOption:MU,CommanderError:BU,InvalidArgumentError:IU,InvalidOptionArgumentError:QU,Command:B0,Argument:EU,Option:jU,Help:TU}=l5.default;var i5=(_=0)=>($)=>`\x1B[${$+_}m`,n5=(_=0)=>($)=>`\x1B[${38+_};5;${$}m`,o5=(_=0)=>($,X,Z)=>`\x1B[${38+_};2;${$};${X};${Z}m`,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},wU=Object.keys(o.modifier),cJ=Object.keys(o.color),lJ=Object.keys(o.bgColor),PU=[...cJ,...lJ];function iJ(){let _=new Map;for(let[$,X]of Object.entries(o)){for(let[Z,J]of Object.entries(X))o[Z]={open:`\x1B[${J[0]}m`,close:`\x1B[${J[1]}m`},X[Z]=o[Z],_.set(J[0],J[1]);Object.defineProperty(o,$,{value:X,enumerable:!1})}return Object.defineProperty(o,"codes",{value:_,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi=i5(),o.color.ansi256=n5(),o.color.ansi16m=o5(),o.bgColor.ansi=i5(10),o.bgColor.ansi256=n5(10),o.bgColor.ansi16m=o5(10),Object.defineProperties(o,{rgbToAnsi256:{value($,X,Z){if($===X&&X===Z){if($<8)return 16;if($>248)return 231;return Math.round(($-8)/247*24)+232}return 16+36*Math.round($/255*5)+6*Math.round(X/255*5)+Math.round(Z/255*5)},enumerable:!1},hexToRgb:{value($){let X=/[a-f\d]{6}|[a-f\d]{3}/i.exec($.toString(16));if(!X)return[0,0,0];let[Z]=X;if(Z.length===3)Z=[...Z].map((G)=>G+G).join("");let J=Number.parseInt(Z,16);return[J>>16&255,J>>8&255,J&255]},enumerable:!1},hexToAnsi256:{value:($)=>o.rgbToAnsi256(...o.hexToRgb($)),enumerable:!1},ansi256ToAnsi:{value($){if($<8)return 30+$;if($<16)return 90+($-8);let X,Z,J;if($>=232)X=(($-232)*10+8)/255,Z=X,J=X;else{$-=16;let z=$%36;X=Math.floor($/36)/5,Z=Math.floor(z/6)/5,J=z%6/5}let G=Math.max(X,Z,J)*2;if(G===0)return 30;let Y=30+(Math.round(J)<<2|Math.round(Z)<<1|Math.round(X));if(G===2)Y+=60;return Y},enumerable:!1},rgbToAnsi:{value:($,X,Z)=>o.ansi256ToAnsi(o.rgbToAnsi256($,X,Z)),enumerable:!1},hexToAnsi:{value:($)=>o.ansi256ToAnsi(o.hexToAnsi256($)),enumerable:!1}}),o}var nJ=iJ(),l0=nJ;import E8 from"node:process";import oJ from"node:os";import s5 from"node:tty";function h0(_,$=globalThis.Deno?globalThis.Deno.args:E8.argv){let X=_.startsWith("-")?"":_.length===1?"-":"--",Z=$.indexOf(X+_),J=$.indexOf("--");return Z!==-1&&(J===-1||Z<J)}var{env:s}=E8,X6;if(h0("no-color")||h0("no-colors")||h0("color=false")||h0("color=never"))X6=0;else if(h0("color")||h0("colors")||h0("color=true")||h0("color=always"))X6=1;function sJ(){if("FORCE_COLOR"in s){if(s.FORCE_COLOR==="true")return 1;if(s.FORCE_COLOR==="false")return 0;return s.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(s.FORCE_COLOR,10),3)}}function rJ(_){if(_===0)return!1;return{level:_,hasBasic:!0,has256:_>=2,has16m:_>=3}}function aJ(_,{streamIsTTY:$,sniffFlags:X=!0}={}){let Z=sJ();if(Z!==void 0)X6=Z;let J=X?X6:Z;if(J===0)return 0;if(X){if(h0("color=16m")||h0("color=full")||h0("color=truecolor"))return 3;if(h0("color=256"))return 2}if("TF_BUILD"in s&&"AGENT_NAME"in s)return 1;if(_&&!$&&J===void 0)return 0;let G=J||0;if(s.TERM==="dumb")return G;if(E8.platform==="win32"){let Y=oJ.release().split(".");if(Number(Y[0])>=10&&Number(Y[2])>=10586)return Number(Y[2])>=14931?3:2;return 1}if("CI"in s){if(["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some((Y)=>(Y in s)))return 3;if(["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some((Y)=>(Y in s))||s.CI_NAME==="codeship")return 1;return G}if("TEAMCITY_VERSION"in s)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(s.TEAMCITY_VERSION)?1:0;if(s.COLORTERM==="truecolor")return 3;if(s.TERM==="xterm-kitty")return 3;if(s.TERM==="xterm-ghostty")return 3;if(s.TERM==="wezterm")return 3;if("TERM_PROGRAM"in s){let Y=Number.parseInt((s.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(s.TERM_PROGRAM){case"iTerm.app":return Y>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(s.TERM))return 2;if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(s.TERM))return 1;if("COLORTERM"in s)return 1;return G}function r5(_,$={}){let X=aJ(_,{streamIsTTY:_&&_.isTTY,...$});return rJ(X)}var tJ={stdout:r5({isTTY:s5.isatty(1)}),stderr:r5({isTTY:s5.isatty(2)})},a5=tJ;function t5(_,$,X){let Z=_.indexOf($);if(Z===-1)return _;let J=$.length,G=0,Y="";do Y+=_.slice(G,Z)+$+X,G=Z+J,Z=_.indexOf($,G);while(Z!==-1);return Y+=_.slice(G),Y}function e5(_,$,X,Z){let J=0,G="";do{let Y=_[Z-1]==="\r";G+=_.slice(J,Y?Z-1:Z)+$+(Y?`\r
`:`
`)+X,J=Z+1,Z=_.indexOf(`
`,J)}while(Z!==-1);return G+=_.slice(J),G}var{stdout:_3,stderr:$3}=a5,j8=Symbol("GENERATOR"),A2=Symbol("STYLER"),$_=Symbol("IS_EMPTY"),X3=["ansi","ansi","ansi256","ansi16m"],K2=Object.create(null),eJ=(_,$={})=>{if($.level&&!(Number.isInteger($.level)&&$.level>=0&&$.level<=3))throw Error("The `level` option should be an integer from 0 to 3");let X=_3?_3.level:0;_.level=$.level===void 0?X:$.level};var _G=(_)=>{let $=(...X)=>X.join(" ");return eJ($,_),Object.setPrototypeOf($,X_.prototype),$};function X_(_){return _G(_)}Object.setPrototypeOf(X_.prototype,Function.prototype);for(let[_,$]of Object.entries(l0))K2[_]={get(){let X=Z6(this,L8($.open,$.close,this[A2]),this[$_]);return Object.defineProperty(this,_,{value:X}),X}};K2.visible={get(){let _=Z6(this,this[A2],!0);return Object.defineProperty(this,"visible",{value:_}),_}};var T8=(_,$,X,...Z)=>{if(_==="rgb"){if($==="ansi16m")return l0[X].ansi16m(...Z);if($==="ansi256")return l0[X].ansi256(l0.rgbToAnsi256(...Z));return l0[X].ansi(l0.rgbToAnsi(...Z))}if(_==="hex")return T8("rgb",$,X,...l0.hexToRgb(...Z));return l0[X][_](...Z)},$G=["rgb","hex","ansi256"];for(let _ of $G){K2[_]={get(){let{level:X}=this;return function(...Z){let J=L8(T8(_,X3[X],"color",...Z),l0.color.close,this[A2]);return Z6(this,J,this[$_])}}};let $="bg"+_[0].toUpperCase()+_.slice(1);K2[$]={get(){let{level:X}=this;return function(...Z){let J=L8(T8(_,X3[X],"bgColor",...Z),l0.bgColor.close,this[A2]);return Z6(this,J,this[$_])}}}}var XG=Object.defineProperties(()=>{},{...K2,level:{enumerable:!0,get(){return this[j8].level},set(_){this[j8].level=_}}}),L8=(_,$,X)=>{let Z,J;if(X===void 0)Z=_,J=$;else Z=X.openAll+_,J=$+X.closeAll;return{open:_,close:$,openAll:Z,closeAll:J,parent:X}},Z6=(_,$,X)=>{let Z=(...J)=>ZG(Z,J.length===1?""+J[0]:J.join(" "));return Object.setPrototypeOf(Z,XG),Z[j8]=_,Z[A2]=$,Z[$_]=X,Z},ZG=(_,$)=>{if(_.level<=0||!$)return _[$_]?"":$;let X=_[A2];if(X===void 0)return $;let{openAll:Z,closeAll:J}=X;if($.includes("\x1B"))while(X!==void 0)$=t5($,X.close,X.open),X=X.parent;let G=$.indexOf(`
`);if(G!==-1)$=e5($,J,Z,G);return Z+$+J};Object.defineProperties(X_.prototype,K2);var JG=X_(),bU=X_({level:$3?$3.level:0});var M=JG;import W6 from"node:process";import U3 from"node:process";import Y6 from"node:process";var GG=(_,$,X,Z)=>{if(X==="length"||X==="prototype")return;if(X==="arguments"||X==="caller")return;let J=Object.getOwnPropertyDescriptor(_,X),G=Object.getOwnPropertyDescriptor($,X);if(!YG(J,G)&&Z)return;Object.defineProperty(_,X,G)},YG=function(_,$){return _===void 0||_.configurable||_.writable===$.writable&&_.enumerable===$.enumerable&&_.configurable===$.configurable&&(_.writable||_.value===$.value)},zG=(_,$)=>{let X=Object.getPrototypeOf($);if(X===Object.getPrototypeOf(_))return;Object.setPrototypeOf(_,X)},HG=(_,$)=>`/* Wrapped ${_}*/
${$}`,FG=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),WG=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),UG=(_,$,X)=>{let Z=X===""?"":`with ${X.trim()}() `,J=HG.bind(null,Z,$.toString());Object.defineProperty(J,"name",WG);let{writable:G,enumerable:Y,configurable:z}=FG;Object.defineProperty(_,"toString",{value:J,writable:G,enumerable:Y,configurable:z})};function w8(_,$,{ignoreNonConfigurable:X=!1}={}){let{name:Z}=_;for(let J of Reflect.ownKeys($))GG(_,$,J,X);return zG(_,$),UG(_,$,Z),_}var J6=new WeakMap,Z3=(_,$={})=>{if(typeof _!=="function")throw TypeError("Expected a function");let X,Z=0,J=_.displayName||_.name||"<anonymous>",G=function(...Y){if(J6.set(G,++Z),Z===1)X=_.apply(this,Y),_=void 0;else if($.throw===!0)throw Error(`Function \`${J}\` can only be called once`);return X};return w8(G,_),J6.set(G,Z),G};Z3.callCount=(_)=>{if(!J6.has(_))throw Error(`The given function \`${_.name}\` is not wrapped by the \`onetime\` package`);return J6.get(_)};var J3=Z3;var c1=[];c1.push("SIGHUP","SIGINT","SIGTERM");if(process.platform!=="win32")c1.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");if(process.platform==="linux")c1.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var G6=(_)=>!!_&&typeof _==="object"&&typeof _.removeListener==="function"&&typeof _.emit==="function"&&typeof _.reallyExit==="function"&&typeof _.listeners==="function"&&typeof _.kill==="function"&&typeof _.pid==="number"&&typeof _.on==="function",P8=Symbol.for("signal-exit emitter"),x8=globalThis,AG=Object.defineProperty.bind(Object);class G3{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(x8[P8])return x8[P8];AG(x8,P8,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(_,$){this.listeners[_].push($)}removeListener(_,$){let X=this.listeners[_],Z=X.indexOf($);if(Z===-1)return;if(Z===0&&X.length===1)X.length=0;else X.splice(Z,1)}emit(_,$,X){if(this.emitted[_])return!1;this.emitted[_]=!0;let Z=!1;for(let J of this.listeners[_])Z=J($,X)===!0||Z;if(_==="exit")Z=this.emit("afterExit",$,X)||Z;return Z}}class C8{}var KG=(_)=>{return{onExit($,X){return _.onExit($,X)},load(){return _.load()},unload(){return _.unload()}}};class Y3 extends C8{onExit(){return()=>{}}load(){}unload(){}}class z3 extends C8{#_=q8.platform==="win32"?"SIGINT":"SIGHUP";#$=new G3;#X;#Z;#J;#G={};#Y=!1;constructor(_){super();this.#X=_,this.#G={};for(let $ of c1)this.#G[$]=()=>{let X=this.#X.listeners($),{count:Z}=this.#$,J=_;if(typeof J.__signal_exit_emitter__==="object"&&typeof J.__signal_exit_emitter__.count==="number")Z+=J.__signal_exit_emitter__.count;if(X.length===Z){this.unload();let G=this.#$.emit("exit",null,$),Y=$==="SIGHUP"?this.#_:$;if(!G)_.kill(_.pid,Y)}};this.#J=_.reallyExit,this.#Z=_.emit}onExit(_,$){if(!G6(this.#X))return()=>{};if(this.#Y===!1)this.load();let X=$?.alwaysLast?"afterExit":"exit";return this.#$.on(X,_),()=>{if(this.#$.removeListener(X,_),this.#$.listeners.exit.length===0&&this.#$.listeners.afterExit.length===0)this.unload()}}load(){if(this.#Y)return;this.#Y=!0,this.#$.count+=1;for(let _ of c1)try{let $=this.#G[_];if($)this.#X.on(_,$)}catch($){}this.#X.emit=(_,...$)=>{return this.#H(_,...$)},this.#X.reallyExit=(_)=>{return this.#z(_)}}unload(){if(!this.#Y)return;this.#Y=!1,c1.forEach((_)=>{let $=this.#G[_];if(!$)throw Error("Listener not defined for signal: "+_);try{this.#X.removeListener(_,$)}catch(X){}}),this.#X.emit=this.#Z,this.#X.reallyExit=this.#J,this.#$.count-=1}#z(_){if(!G6(this.#X))return 0;return this.#X.exitCode=_||0,this.#$.emit("exit",this.#X.exitCode,null),this.#J.call(this.#X,this.#X.exitCode)}#H(_,...$){let X=this.#Z;if(_==="exit"&&G6(this.#X)){if(typeof $[0]==="number")this.#X.exitCode=$[0];let Z=X.call(this.#X,_,...$);return this.#$.emit("exit",this.#X.exitCode,null),Z}else return X.call(this.#X,_,...$)}}var q8=globalThis.process,{onExit:H3,load:lU,unload:iU}=KG(G6(q8)?new z3(q8):new Y3);var F3=Y6.stderr.isTTY?Y6.stderr:Y6.stdout.isTTY?Y6.stdout:void 0,DG=F3?J3(()=>{H3(()=>{F3.write("\x1B[?25h")},{alwaysLast:!0})}):()=>{},W3=DG;var z6=!1,D2={};D2.show=(_=U3.stderr)=>{if(!_.isTTY)return;z6=!1,_.write("\x1B[?25h")};D2.hide=(_=U3.stderr)=>{if(!_.isTTY)return;W3(),z6=!0,_.write("\x1B[?25l")};D2.toggle=(_,$)=>{if(_!==void 0)z6=_;if(z6)D2.show($);else D2.hide($)};var S8=D2;var k8={dots:{interval:80,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"]},dots2:{interval:80,frames:["⣾","⣽","⣻","⢿","⡿","⣟","⣯","⣷"]},dots3:{interval:80,frames:["⠋","⠙","⠚","⠞","⠖","⠦","⠴","⠲","⠳","⠓"]},dots4:{interval:80,frames:["⠄","⠆","⠇","⠋","⠙","⠸","⠰","⠠","⠰","⠸","⠙","⠋","⠇","⠆"]},dots5:{interval:80,frames:["⠋","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋"]},dots6:{interval:80,frames:["⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠴","⠲","⠒","⠂","⠂","⠒","⠚","⠙","⠉","⠁"]},dots7:{interval:80,frames:["⠈","⠉","⠋","⠓","⠒","⠐","⠐","⠒","⠖","⠦","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈"]},dots8:{interval:80,frames:["⠁","⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈","⠈"]},dots9:{interval:80,frames:["⢹","⢺","⢼","⣸","⣇","⡧","⡗","⡏"]},dots10:{interval:80,frames:["⢄","⢂","⢁","⡁","⡈","⡐","⡠"]},dots11:{interval:100,frames:["⠁","⠂","⠄","⡀","⢀","⠠","⠐","⠈"]},dots12:{interval:80,frames:["⢀⠀","⡀⠀","⠄⠀","⢂⠀","⡂⠀","⠅⠀","⢃⠀","⡃⠀","⠍⠀","⢋⠀","⡋⠀","⠍⠁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⢈⠩","⡀⢙","⠄⡙","⢂⠩","⡂⢘","⠅⡘","⢃⠨","⡃⢐","⠍⡐","⢋⠠","⡋⢀","⠍⡁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⠈⠩","⠀⢙","⠀⡙","⠀⠩","⠀⢘","⠀⡘","⠀⠨","⠀⢐","⠀⡐","⠀⠠","⠀⢀","⠀⡀"]},dots13:{interval:80,frames:["⣼","⣹","⢻","⠿","⡟","⣏","⣧","⣶"]},dots14:{interval:80,frames:["⠉⠉","⠈⠙","⠀⠹","⠀⢸","⠀⣰","⢀⣠","⣀⣀","⣄⡀","⣆⠀","⡇⠀","⠏⠀","⠋⠁"]},dots8Bit:{interval:80,frames:["⠀","⠁","⠂","⠃","⠄","⠅","⠆","⠇","⡀","⡁","⡂","⡃","⡄","⡅","⡆","⡇","⠈","⠉","⠊","⠋","⠌","⠍","⠎","⠏","⡈","⡉","⡊","⡋","⡌","⡍","⡎","⡏","⠐","⠑","⠒","⠓","⠔","⠕","⠖","⠗","⡐","⡑","⡒","⡓","⡔","⡕","⡖","⡗","⠘","⠙","⠚","⠛","⠜","⠝","⠞","⠟","⡘","⡙","⡚","⡛","⡜","⡝","⡞","⡟","⠠","⠡","⠢","⠣","⠤","⠥","⠦","⠧","⡠","⡡","⡢","⡣","⡤","⡥","⡦","⡧","⠨","⠩","⠪","⠫","⠬","⠭","⠮","⠯","⡨","⡩","⡪","⡫","⡬","⡭","⡮","⡯","⠰","⠱","⠲","⠳","⠴","⠵","⠶","⠷","⡰","⡱","⡲","⡳","⡴","⡵","⡶","⡷","⠸","⠹","⠺","⠻","⠼","⠽","⠾","⠿","⡸","⡹","⡺","⡻","⡼","⡽","⡾","⡿","⢀","⢁","⢂","⢃","⢄","⢅","⢆","⢇","⣀","⣁","⣂","⣃","⣄","⣅","⣆","⣇","⢈","⢉","⢊","⢋","⢌","⢍","⢎","⢏","⣈","⣉","⣊","⣋","⣌","⣍","⣎","⣏","⢐","⢑","⢒","⢓","⢔","⢕","⢖","⢗","⣐","⣑","⣒","⣓","⣔","⣕","⣖","⣗","⢘","⢙","⢚","⢛","⢜","⢝","⢞","⢟","⣘","⣙","⣚","⣛","⣜","⣝","⣞","⣟","⢠","⢡","⢢","⢣","⢤","⢥","⢦","⢧","⣠","⣡","⣢","⣣","⣤","⣥","⣦","⣧","⢨","⢩","⢪","⢫","⢬","⢭","⢮","⢯","⣨","⣩","⣪","⣫","⣬","⣭","⣮","⣯","⢰","⢱","⢲","⢳","⢴","⢵","⢶","⢷","⣰","⣱","⣲","⣳","⣴","⣵","⣶","⣷","⢸","⢹","⢺","⢻","⢼","⢽","⢾","⢿","⣸","⣹","⣺","⣻","⣼","⣽","⣾","⣿"]},dotsCircle:{interval:80,frames:["⢎ ","⠎⠁","⠊⠑","⠈⠱"," ⡱","⢀⡰","⢄⡠","⢆⡀"]},sand:{interval:80,frames:["⠁","⠂","⠄","⡀","⡈","⡐","⡠","⣀","⣁","⣂","⣄","⣌","⣔","⣤","⣥","⣦","⣮","⣶","⣷","⣿","⡿","⠿","⢟","⠟","⡛","⠛","⠫","⢋","⠋","⠍","⡉","⠉","⠑","⠡","⢁"]},line:{interval:130,frames:["-","\\","|","/"]},line2:{interval:100,frames:["⠂","-","–","—","–","-"]},rollingLine:{interval:80,frames:["/  "," - "," \\ ","  |","  |"," \\ "," - ","/  "]},pipe:{interval:100,frames:["┤","┘","┴","└","├","┌","┬","┐"]},simpleDots:{interval:400,frames:[".  ",".. ","...","   "]},simpleDotsScrolling:{interval:200,frames:[".  ",".. ","..."," ..","  .","   "]},star:{interval:70,frames:["✶","✸","✹","✺","✹","✷"]},star2:{interval:80,frames:["+","x","*"]},flip:{interval:70,frames:["_","_","_","-","`","`","'","´","-","_","_","_"]},hamburger:{interval:100,frames:["☱","☲","☴"]},growVertical:{interval:120,frames:["▁","▃","▄","▅","▆","▇","▆","▅","▄","▃"]},growHorizontal:{interval:120,frames:["▏","▎","▍","▌","▋","▊","▉","▊","▋","▌","▍","▎"]},balloon:{interval:140,frames:[" ",".","o","O","@","*"," "]},balloon2:{interval:120,frames:[".","o","O","°","O","o","."]},noise:{interval:100,frames:["▓","▒","░"]},bounce:{interval:120,frames:["⠁","⠂","⠄","⠂"]},boxBounce:{interval:120,frames:["▖","▘","▝","▗"]},boxBounce2:{interval:100,frames:["▌","▀","▐","▄"]},triangle:{interval:50,frames:["◢","◣","◤","◥"]},binary:{interval:80,frames:["010010","001100","100101","111010","111101","010111","101011","111000","110011","110101"]},arc:{interval:100,frames:["◜","◠","◝","◞","◡","◟"]},circle:{interval:120,frames:["◡","⊙","◠"]},squareCorners:{interval:180,frames:["◰","◳","◲","◱"]},circleQuarters:{interval:120,frames:["◴","◷","◶","◵"]},circleHalves:{interval:50,frames:["◐","◓","◑","◒"]},squish:{interval:100,frames:["╫","╪"]},toggle:{interval:250,frames:["⊶","⊷"]},toggle2:{interval:80,frames:["▫","▪"]},toggle3:{interval:120,frames:["□","■"]},toggle4:{interval:100,frames:["■","□","▪","▫"]},toggle5:{interval:100,frames:["▮","▯"]},toggle6:{interval:300,frames:["ဝ","၀"]},toggle7:{interval:80,frames:["⦾","⦿"]},toggle8:{interval:100,frames:["◍","◌"]},toggle9:{interval:100,frames:["◉","◎"]},toggle10:{interval:100,frames:["㊂","㊀","㊁"]},toggle11:{interval:50,frames:["⧇","⧆"]},toggle12:{interval:120,frames:["☗","☖"]},toggle13:{interval:80,frames:["=","*","-"]},arrow:{interval:100,frames:["←","↖","↑","↗","→","↘","↓","↙"]},arrow2:{interval:80,frames:["⬆️ ","↗️ ","➡️ ","↘️ ","⬇️ ","↙️ ","⬅️ ","↖️ "]},arrow3:{interval:120,frames:["▹▹▹▹▹","▸▹▹▹▹","▹▸▹▹▹","▹▹▸▹▹","▹▹▹▸▹","▹▹▹▹▸"]},bouncingBar:{interval:80,frames:["[    ]","[=   ]","[==  ]","[=== ]","[====]","[ ===]","[  ==]","[   =]","[    ]","[   =]","[  ==]","[ ===]","[====]","[=== ]","[==  ]","[=   ]"]},bouncingBall:{interval:80,frames:["( ●    )","(  ●   )","(   ●  )","(    ● )","(     ●)","(    ● )","(   ●  )","(  ●   )","( ●    )","(●     )"]},smiley:{interval:200,frames:["😄 ","😝 "]},monkey:{interval:300,frames:["🙈 ","🙈 ","🙉 ","🙊 "]},hearts:{interval:100,frames:["💛 ","💙 ","💜 ","💚 ","💗 "]},clock:{interval:100,frames:["🕛 ","🕐 ","🕑 ","🕒 ","🕓 ","🕔 ","🕕 ","🕖 ","🕗 ","🕘 ","🕙 ","🕚 "]},earth:{interval:180,frames:["🌍 ","🌎 ","🌏 "]},material:{interval:17,frames:["█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███████▁▁▁▁▁▁▁▁▁▁▁▁▁","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","██████████▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","█████████████▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁██████████████▁▁▁▁","▁▁▁██████████████▁▁▁","▁▁▁▁█████████████▁▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁▁▁████████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","██████▁▁▁▁▁▁▁▁▁▁▁▁▁█","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁▁█████████████▁▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁▁███████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁▁█████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁"]},moon:{interval:80,frames:["🌑 ","🌒 ","🌓 ","🌔 ","🌕 ","🌖 ","🌗 ","🌘 "]},runner:{interval:140,frames:["🚶 ","🏃 "]},pong:{interval:80,frames:["▐⠂       ▌","▐⠈       ▌","▐ ⠂      ▌","▐ ⠠      ▌","▐  ⡀     ▌","▐  ⠠     ▌","▐   ⠂    ▌","▐   ⠈    ▌","▐    ⠂   ▌","▐    ⠠   ▌","▐     ⡀  ▌","▐     ⠠  ▌","▐      ⠂ ▌","▐      ⠈ ▌","▐       ⠂▌","▐       ⠠▌","▐       ⡀▌","▐      ⠠ ▌","▐      ⠂ ▌","▐     ⠈  ▌","▐     ⠂  ▌","▐    ⠠   ▌","▐    ⡀   ▌","▐   ⠠    ▌","▐   ⠂    ▌","▐  ⠈     ▌","▐  ⠂     ▌","▐ ⠠      ▌","▐ ⡀      ▌","▐⠠       ▌"]},shark:{interval:120,frames:["▐|\\____________▌","▐_|\\___________▌","▐__|\\__________▌","▐___|\\_________▌","▐____|\\________▌","▐_____|\\_______▌","▐______|\\______▌","▐_______|\\_____▌","▐________|\\____▌","▐_________|\\___▌","▐__________|\\__▌","▐___________|\\_▌","▐____________|\\▌","▐____________/|▌","▐___________/|_▌","▐__________/|__▌","▐_________/|___▌","▐________/|____▌","▐_______/|_____▌","▐______/|______▌","▐_____/|_______▌","▐____/|________▌","▐___/|_________▌","▐__/|__________▌","▐_/|___________▌","▐/|____________▌"]},dqpb:{interval:100,frames:["d","q","p","b"]},weather:{interval:100,frames:["☀️ ","☀️ ","☀️ ","🌤 ","⛅️ ","🌥 ","☁️ ","🌧 ","🌨 ","🌧 ","🌨 ","🌧 ","🌨 ","⛈ ","🌨 ","🌧 ","🌨 ","☁️ ","🌥 ","⛅️ ","🌤 ","☀️ ","☀️ "]},christmas:{interval:400,frames:["🌲","🎄"]},grenade:{interval:80,frames:["،  ","′  "," ´ "," ‾ ","  ⸌","  ⸊","  |","  ⁎","  ⁕"," ෴ ","  ⁓","   ","   ","   "]},point:{interval:125,frames:["∙∙∙","●∙∙","∙●∙","∙∙●","∙∙∙"]},layer:{interval:150,frames:["-","=","≡"]},betaWave:{interval:80,frames:["ρββββββ","βρβββββ","ββρββββ","βββρβββ","ββββρββ","βββββρβ","ββββββρ"]},fingerDance:{interval:160,frames:["🤘 ","🤟 ","🖖 ","✋ ","🤚 ","👆 "]},fistBump:{interval:80,frames:["🤜　　　　🤛 ","🤜　　　　🤛 ","🤜　　　　🤛 ","　🤜　　🤛　 ","　　🤜🤛　　 ","　🤜✨🤛　　 ","🤜　✨　🤛　 "]},soccerHeader:{interval:80,frames:[" 🧑⚽️       🧑 ","🧑  ⚽️      🧑 ","🧑   ⚽️     🧑 ","🧑    ⚽️    🧑 ","🧑     ⚽️   🧑 ","🧑      ⚽️  🧑 ","🧑       ⚽️🧑  ","🧑      ⚽️  🧑 ","🧑     ⚽️   🧑 ","🧑    ⚽️    🧑 ","🧑   ⚽️     🧑 ","🧑  ⚽️      🧑 "]},mindblown:{interval:160,frames:["😐 ","😐 ","😮 ","😮 ","😦 ","😦 ","😧 ","😧 ","🤯 ","💥 ","✨ ","　 ","　 ","　 "]},speaker:{interval:160,frames:["🔈 ","🔉 ","🔊 ","🔉 "]},orangePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 "]},bluePulse:{interval:100,frames:["🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},orangeBluePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 ","🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},timeTravel:{interval:100,frames:["🕛 ","🕚 ","🕙 ","🕘 ","🕗 ","🕖 ","🕕 ","🕔 ","🕓 ","🕒 ","🕑 ","🕐 "]},aesthetic:{interval:80,frames:["▰▱▱▱▱▱▱","▰▰▱▱▱▱▱","▰▰▰▱▱▱▱","▰▰▰▰▱▱▱","▰▰▰▰▰▱▱","▰▰▰▰▰▰▱","▰▰▰▰▰▰▰","▰▱▱▱▱▱▱"]},dwarfFortress:{interval:80,frames:[" ██████£££  ","☺██████£££  ","☺██████£££  ","☺▓█████£££  ","☺▓█████£££  ","☺▒█████£££  ","☺▒█████£££  ","☺░█████£££  ","☺░█████£££  ","☺ █████£££  "," ☺█████£££  "," ☺█████£££  "," ☺▓████£££  "," ☺▓████£££  "," ☺▒████£££  "," ☺▒████£££  "," ☺░████£££  "," ☺░████£££  "," ☺ ████£££  ","  ☺████£££  ","  ☺████£££  ","  ☺▓███£££  ","  ☺▓███£££  ","  ☺▒███£££  ","  ☺▒███£££  ","  ☺░███£££  ","  ☺░███£££  ","  ☺ ███£££  ","   ☺███£££  ","   ☺███£££  ","   ☺▓██£££  ","   ☺▓██£££  ","   ☺▒██£££  ","   ☺▒██£££  ","   ☺░██£££  ","   ☺░██£££  ","   ☺ ██£££  ","    ☺██£££  ","    ☺██£££  ","    ☺▓█£££  ","    ☺▓█£££  ","    ☺▒█£££  ","    ☺▒█£££  ","    ☺░█£££  ","    ☺░█£££  ","    ☺ █£££  ","     ☺█£££  ","     ☺█£££  ","     ☺▓£££  ","     ☺▓£££  ","     ☺▒£££  ","     ☺▒£££  ","     ☺░£££  ","     ☺░£££  ","     ☺ £££  ","      ☺£££  ","      ☺£££  ","      ☺▓££  ","      ☺▓££  ","      ☺▒££  ","      ☺▒££  ","      ☺░££  ","      ☺░££  ","      ☺ ££  ","       ☺££  ","       ☺££  ","       ☺▓£  ","       ☺▓£  ","       ☺▒£  ","       ☺▒£  ","       ☺░£  ","       ☺░£  ","       ☺ £  ","        ☺£  ","        ☺£  ","        ☺▓  ","        ☺▓  ","        ☺▒  ","        ☺▒  ","        ☺░  ","        ☺░  ","        ☺   ","        ☺  &","        ☺ ☼&","       ☺ ☼ &","       ☺☼  &","      ☺☼  & ","      ‼   & ","     ☺   &  ","    ‼    &  ","   ☺    &   ","  ‼     &   "," ☺     &    ","‼      &    ","      &     ","      &     ","     &   ░  ","     &   ▒  ","    &    ▓  ","    &    £  ","   &    ░£  ","   &    ▒£  ","  &     ▓£  ","  &     ££  "," &     ░££  "," &     ▒££  ","&      ▓££  ","&      £££  ","      ░£££  ","      ▒£££  ","      ▓£££  ","      █£££  ","     ░█£££  ","     ▒█£££  ","     ▓█£££  ","     ██£££  ","    ░██£££  ","    ▒██£££  ","    ▓██£££  ","    ███£££  ","   ░███£££  ","   ▒███£££  ","   ▓███£££  ","   ████£££  ","  ░████£££  ","  ▒████£££  ","  ▓████£££  ","  █████£££  "," ░█████£££  "," ▒█████£££  "," ▓█████£££  "," ██████£££  "," ██████£££  "]}};var Z_=k8,ZA=Object.keys(k8);var l1={};H6(l1,{warning:()=>BG,success:()=>MG,info:()=>NG,error:()=>IG});import RG from"node:tty";var VG=RG?.WriteStream?.prototype?.hasColors?.()??!1,C=(_,$)=>{if(!VG)return(J)=>J;let X=`\x1B[${_}m`,Z=`\x1B[${$}m`;return(J)=>{let G=J+"",Y=G.indexOf(Z);if(Y===-1)return X+G+Z;let z=X,H=0,W=($===22?Z:"")+X;while(Y!==-1)z+=G.slice(H,Y)+W,H=Y+Z.length,Y=G.indexOf(Z,H);return z+=G.slice(H)+Z,z}},YA=C(0,0),zA=C(1,22),HA=C(2,22),FA=C(3,23),WA=C(4,24),UA=C(53,55),AA=C(7,27),KA=C(8,28),DA=C(9,29),OA=C(30,39),A3=C(31,39),K3=C(32,39),D3=C(33,39),O3=C(34,39),RA=C(35,39),VA=C(36,39),NA=C(37,39),MA=C(90,39),BA=C(40,49),IA=C(41,49),QA=C(42,49),EA=C(43,49),jA=C(44,49),TA=C(45,49),LA=C(46,49),wA=C(47,49),PA=C(100,49),xA=C(91,39),qA=C(92,39),CA=C(93,39),SA=C(94,39),kA=C(95,39),vA=C(96,39),hA=C(97,39),yA=C(101,49),fA=C(102,49),bA=C(103,49),gA=C(104,49),pA=C(105,49),mA=C(106,49),uA=C(107,49);import R3 from"node:process";function J_(){let{env:_}=R3,{TERM:$,TERM_PROGRAM:X}=_;if(R3.platform!=="win32")return $!=="linux";return Boolean(_.WT_SESSION)||Boolean(_.TERMINUS_SUBLIME)||_.ConEmuTask==="{cmd::Cmder}"||X==="Terminus-Sublime"||X==="vscode"||$==="xterm-256color"||$==="alacritty"||$==="rxvt-unicode"||$==="rxvt-unicode-256color"||_.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var F6=J_(),NG=O3(F6?"ℹ":"i"),MG=K3(F6?"✔":"√"),BG=D3(F6?"⚠":"‼"),IG=A3(F6?"✖":"×");function v8({onlyFirst:_=!1}={}){return new RegExp("(?:\\u001B\\][\\s\\S]*?(?:\\u0007|\\u001B\\u005C|\\u009C))|[\\u001B\\u009B][[\\]()#;?]*(?:\\d{1,4}(?:[;:]\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]",_?void 0:"g")}var QG=v8();function G_(_){if(typeof _!=="string")throw TypeError(`Expected a \`string\`, got \`${typeof _}\``);return _.replace(QG,"")}function V3(_){return _===161||_===164||_===167||_===168||_===170||_===173||_===174||_>=176&&_<=180||_>=182&&_<=186||_>=188&&_<=191||_===198||_===208||_===215||_===216||_>=222&&_<=225||_===230||_>=232&&_<=234||_===236||_===237||_===240||_===242||_===243||_>=247&&_<=250||_===252||_===254||_===257||_===273||_===275||_===283||_===294||_===295||_===299||_>=305&&_<=307||_===312||_>=319&&_<=322||_===324||_>=328&&_<=331||_===333||_===338||_===339||_===358||_===359||_===363||_===462||_===464||_===466||_===468||_===470||_===472||_===474||_===476||_===593||_===609||_===708||_===711||_>=713&&_<=715||_===717||_===720||_>=728&&_<=731||_===733||_===735||_>=768&&_<=879||_>=913&&_<=929||_>=931&&_<=937||_>=945&&_<=961||_>=963&&_<=969||_===1025||_>=1040&&_<=1103||_===1105||_===8208||_>=8211&&_<=8214||_===8216||_===8217||_===8220||_===8221||_>=8224&&_<=8226||_>=8228&&_<=8231||_===8240||_===8242||_===8243||_===8245||_===8251||_===8254||_===8308||_===8319||_>=8321&&_<=8324||_===8364||_===8451||_===8453||_===8457||_===8467||_===8470||_===8481||_===8482||_===8486||_===8491||_===8531||_===8532||_>=8539&&_<=8542||_>=8544&&_<=8555||_>=8560&&_<=8569||_===8585||_>=8592&&_<=8601||_===8632||_===8633||_===8658||_===8660||_===8679||_===8704||_===8706||_===8707||_===8711||_===8712||_===8715||_===8719||_===8721||_===8725||_===8730||_>=8733&&_<=8736||_===8739||_===8741||_>=8743&&_<=8748||_===8750||_>=8756&&_<=8759||_===8764||_===8765||_===8776||_===8780||_===8786||_===8800||_===8801||_>=8804&&_<=8807||_===8810||_===8811||_===8814||_===8815||_===8834||_===8835||_===8838||_===8839||_===8853||_===8857||_===8869||_===8895||_===8978||_>=9312&&_<=9449||_>=9451&&_<=9547||_>=9552&&_<=9587||_>=9600&&_<=9615||_>=9618&&_<=9621||_===9632||_===9633||_>=9635&&_<=9641||_===9650||_===9651||_===9654||_===9655||_===9660||_===9661||_===9664||_===9665||_>=9670&&_<=9672||_===9675||_>=9678&&_<=9681||_>=9698&&_<=9701||_===9711||_===9733||_===9734||_===9737||_===9742||_===9743||_===9756||_===9758||_===9792||_===9794||_===9824||_===9825||_>=9827&&_<=9829||_>=9831&&_<=9834||_===9836||_===9837||_===9839||_===9886||_===9887||_===9919||_>=9926&&_<=9933||_>=9935&&_<=9939||_>=9941&&_<=9953||_===9955||_===9960||_===9961||_>=9963&&_<=9969||_===9972||_>=9974&&_<=9977||_===9979||_===9980||_===9982||_===9983||_===10045||_>=10102&&_<=10111||_>=11094&&_<=11097||_>=12872&&_<=12879||_>=57344&&_<=63743||_>=65024&&_<=65039||_===65533||_>=127232&&_<=127242||_>=127248&&_<=127277||_>=127280&&_<=127337||_>=127344&&_<=127373||_===127375||_===127376||_>=127387&&_<=127404||_>=917760&&_<=917999||_>=983040&&_<=1048573||_>=1048576&&_<=1114109}function N3(_){return _===12288||_>=65281&&_<=65376||_>=65504&&_<=65510}function M3(_){return _>=4352&&_<=4447||_===8986||_===8987||_===9001||_===9002||_>=9193&&_<=9196||_===9200||_===9203||_===9725||_===9726||_===9748||_===9749||_>=9776&&_<=9783||_>=9800&&_<=9811||_===9855||_>=9866&&_<=9871||_===9875||_===9889||_===9898||_===9899||_===9917||_===9918||_===9924||_===9925||_===9934||_===9940||_===9962||_===9970||_===9971||_===9973||_===9978||_===9981||_===9989||_===9994||_===9995||_===10024||_===10060||_===10062||_>=10067&&_<=10069||_===10071||_>=10133&&_<=10135||_===10160||_===10175||_===11035||_===11036||_===11088||_===11093||_>=11904&&_<=11929||_>=11931&&_<=12019||_>=12032&&_<=12245||_>=12272&&_<=12287||_>=12289&&_<=12350||_>=12353&&_<=12438||_>=12441&&_<=12543||_>=12549&&_<=12591||_>=12593&&_<=12686||_>=12688&&_<=12773||_>=12783&&_<=12830||_>=12832&&_<=12871||_>=12880&&_<=42124||_>=42128&&_<=42182||_>=43360&&_<=43388||_>=44032&&_<=55203||_>=63744&&_<=64255||_>=65040&&_<=65049||_>=65072&&_<=65106||_>=65108&&_<=65126||_>=65128&&_<=65131||_>=94176&&_<=94180||_>=94192&&_<=94198||_>=94208&&_<=101589||_>=101631&&_<=101662||_>=101760&&_<=101874||_>=110576&&_<=110579||_>=110581&&_<=110587||_===110589||_===110590||_>=110592&&_<=110882||_===110898||_>=110928&&_<=110930||_===110933||_>=110948&&_<=110951||_>=110960&&_<=111355||_>=119552&&_<=119638||_>=119648&&_<=119670||_===126980||_===127183||_===127374||_>=127377&&_<=127386||_>=127488&&_<=127490||_>=127504&&_<=127547||_>=127552&&_<=127560||_===127568||_===127569||_>=127584&&_<=127589||_>=127744&&_<=127776||_>=127789&&_<=127797||_>=127799&&_<=127868||_>=127870&&_<=127891||_>=127904&&_<=127946||_>=127951&&_<=127955||_>=127968&&_<=127984||_===127988||_>=127992&&_<=128062||_===128064||_>=128066&&_<=128252||_>=128255&&_<=128317||_>=128331&&_<=128334||_>=128336&&_<=128359||_===128378||_===128405||_===128406||_===128420||_>=128507&&_<=128591||_>=128640&&_<=128709||_===128716||_>=128720&&_<=128722||_>=128725&&_<=128728||_>=128732&&_<=128735||_===128747||_===128748||_>=128756&&_<=128764||_>=128992&&_<=129003||_===129008||_>=129292&&_<=129338||_>=129340&&_<=129349||_>=129351&&_<=129535||_>=129648&&_<=129660||_>=129664&&_<=129674||_>=129678&&_<=129734||_===129736||_>=129741&&_<=129756||_>=129759&&_<=129770||_>=129775&&_<=129784||_>=131072&&_<=196605||_>=196608&&_<=262141}function EG(_){if(!Number.isSafeInteger(_))throw TypeError(`Expected a code point, got \`${typeof _}\`.`)}function h8(_,{ambiguousAsWide:$=!1}={}){if(EG(_),N3(_)||M3(_)||$&&V3(_))return 2;return 1}var jG=new Intl.Segmenter,TG=/^(?:\p{Default_Ignorable_Code_Point}|\p{Control}|\p{Mark}|\p{Surrogate})+$/v,LG=/^[\p{Default_Ignorable_Code_Point}\p{Control}\p{Format}\p{Mark}\p{Surrogate}]+/v,wG=/^\p{RGI_Emoji}$/v;function PG(_){return _.replace(LG,"")}function xG(_){return TG.test(_)}function qG(_,$){let X=0;if(_.length>1){for(let Z of _.slice(1))if(Z>="＀"&&Z<="￯")X+=h8(Z.codePointAt(0),$)}return X}function y8(_,$={}){if(typeof _!=="string"||_.length===0)return 0;let{ambiguousIsNarrow:X=!0,countAnsiEscapeCodes:Z=!1}=$,J=_;if(!Z)J=G_(J);if(J.length===0)return 0;let G=0,Y={ambiguousAsWide:!X};for(let{segment:z}of jG.segment(J)){if(xG(z))continue;if(wG.test(z)){G+=2;continue}let H=PG(z).codePointAt(0);G+=h8(H,Y),G+=qG(z,Y)}return G}function f8({stream:_=process.stdout}={}){return Boolean(_&&_.isTTY&&process.env.TERM!=="dumb"&&!("CI"in process.env))}import _1 from"node:process";var CG=3;class B3{#_=0;start(){if(this.#_++,this.#_===1)this.#$()}stop(){if(this.#_<=0)throw Error("`stop` called more times than `start`");if(this.#_--,this.#_===0)this.#X()}#$(){if(_1.platform==="win32"||!_1.stdin.isTTY)return;_1.stdin.setRawMode(!0),_1.stdin.on("data",this.#Z),_1.stdin.resume()}#X(){if(!_1.stdin.isTTY)return;_1.stdin.off("data",this.#Z),_1.stdin.pause(),_1.stdin.setRawMode(!1)}#Z(_){if(_[0]===CG)_1.emit("SIGINT")}}var SG=new B3,b8=SG;class I3{#_=0;#$=!1;#X=0;#Z=-1;#J=0;#G=0;#Y;#z;#H;#W;#A;#K;#U;#D;#O;#F;#R;color;constructor(_){if(typeof _==="string")_={text:_};if(this.#Y={color:"cyan",stream:W6.stderr,discardStdin:!0,hideCursor:!0,..._},this.color=this.#Y.color,this.spinner=this.#Y.spinner,this.#A=this.#Y.interval,this.#H=this.#Y.stream,this.#K=typeof this.#Y.isEnabled==="boolean"?this.#Y.isEnabled:f8({stream:this.#H}),this.#U=typeof this.#Y.isSilent==="boolean"?this.#Y.isSilent:!1,this.text=this.#Y.text,this.prefixText=this.#Y.prefixText,this.suffixText=this.#Y.suffixText,this.indent=this.#Y.indent,W6.env.NODE_ENV==="test")this._stream=this.#H,this._isEnabled=this.#K,Object.defineProperty(this,"_linesToClear",{get(){return this.#_},set($){this.#_=$}}),Object.defineProperty(this,"_frameIndex",{get(){return this.#Z}}),Object.defineProperty(this,"_lineCount",{get(){return this.#X}})}get indent(){return this.#D}set indent(_=0){if(!(_>=0&&Number.isInteger(_)))throw Error("The `indent` option must be an integer from 0 and up");this.#D=_,this.#I()}get interval(){return this.#A??this.#z.interval??100}get spinner(){return this.#z}set spinner(_){if(this.#Z=-1,this.#A=void 0,typeof _==="object"){if(!Array.isArray(_.frames)||_.frames.length===0||_.frames.some(($)=>typeof $!=="string"))throw Error("The given spinner must have a non-empty `frames` array of strings");if(_.interval!==void 0&&!(Number.isInteger(_.interval)&&_.interval>0))throw Error("`spinner.interval` must be a positive integer if provided");this.#z=_}else if(!J_())this.#z=Z_.line;else if(_===void 0)this.#z=Z_.dots;else if(_!=="default"&&Z_[_])this.#z=Z_[_];else throw Error(`There is no built-in spinner named '${_}'. See https://github.com/sindresorhus/cli-spinners/blob/main/spinners.json for a full list.`)}get text(){return this.#O}set text(_=""){this.#O=_,this.#I()}get prefixText(){return this.#F}set prefixText(_=""){this.#F=_,this.#I()}get suffixText(){return this.#R}set suffixText(_=""){this.#R=_,this.#I()}get isSpinning(){return this.#W!==void 0}#V(_,$,X=!1){let Z=typeof _==="function"?_():_;if(typeof Z==="string"&&Z!=="")return X?$+Z:Z+$;return""}#M(_=this.#F,$=" "){return this.#V(_,$,!1)}#B(_=this.#R,$=" "){return this.#V(_,$,!0)}#N(_,$){let X=0;for(let Z of G_(_).split(`
`))X+=Math.max(1,Math.ceil(y8(Z)/$));return X}#I(){let _=this.#H.columns??80,$=typeof this.#F==="function"?"":this.#F,X=typeof this.#R==="function"?"":this.#R,Z=typeof $==="string"&&$!==""?$+" ":"",J=typeof X==="string"&&X!==""?" "+X:"",G="-",Y=" ".repeat(this.#D)+Z+"-"+(typeof this.#O==="string"?" "+this.#O:"")+J;this.#X=this.#N(Y,_)}get isEnabled(){return this.#K&&!this.#U}set isEnabled(_){if(typeof _!=="boolean")throw TypeError("The `isEnabled` option must be a boolean");this.#K=_}get isSilent(){return this.#U}set isSilent(_){if(typeof _!=="boolean")throw TypeError("The `isSilent` option must be a boolean");this.#U=_}frame(){let _=Date.now();if(this.#Z===-1||_-this.#J>=this.interval)this.#Z=++this.#Z%this.#z.frames.length,this.#J=_;let{frames:$}=this.#z,X=$[this.#Z];if(this.color)X=M[this.color](X);let Z=this.#M(this.#F," "),J=typeof this.text==="string"?" "+this.text:"",G=this.#B(this.#R," ");return Z+X+J+G}clear(){if(!this.#K||!this.#H.isTTY)return this;this.#H.cursorTo(0);for(let _=0;_<this.#_;_++){if(_>0)this.#H.moveCursor(0,-1);this.#H.clearLine(1)}if(this.#D||this.#G!==this.#D)this.#H.cursorTo(this.#D);return this.#G=this.#D,this.#_=0,this}render(){if(!this.#K||this.#U)return this;this.clear();let _=this.frame(),$=this.#H.columns??80,X=this.#N(_,$),Z=this.#H.rows;if(Z&&Z>1&&X>Z){let J=_.split(`
`),G=Z-1;_=[...J.slice(0,G),"... (content truncated to fit terminal)"].join(`
`)}return this.#H.write(_),this.#_=this.#N(_,$),this}start(_){if(_)this.text=_;if(this.#U)return this;if(!this.#K){let $=" ".repeat(this.#D)+this.#M(this.#F," ")+(this.text?`- ${this.text}`:"")+this.#B(this.#R," ");if($.trim()!=="")this.#H.write($+`
`);return this}if(this.isSpinning)return this;if(this.#Y.hideCursor)S8.hide(this.#H);if(this.#Y.discardStdin&&W6.stdin.isTTY)this.#$=!0,b8.start();return this.render(),this.#W=setInterval(this.render.bind(this),this.interval),this}stop(){if(clearInterval(this.#W),this.#W=void 0,this.#Z=0,this.#K){if(this.clear(),this.#Y.hideCursor)S8.show(this.#H)}if(this.#Y.discardStdin&&W6.stdin.isTTY&&this.#$)b8.stop(),this.#$=!1;return this}succeed(_){return this.stopAndPersist({symbol:l1.success,text:_})}fail(_){return this.stopAndPersist({symbol:l1.error,text:_})}warn(_){return this.stopAndPersist({symbol:l1.warning,text:_})}info(_){return this.stopAndPersist({symbol:l1.info,text:_})}stopAndPersist(_={}){if(this.#U)return this;let $=_.prefixText??this.#F,X=this.#M($," "),Z=_.symbol??" ",J=_.text??this.text,Y=typeof J==="string"?(Z?" ":"")+J:"",z=_.suffixText??this.#R,H=this.#B(z," "),F=X+Z+Y+H+`
`;return this.stop(),this.#H.write(F),this}}function y0(_){return new I3(_)}var VZ=j0(k3(),1);import E1 from"node:fs";import A1 from"node:path";var K=Symbol.for("drizzle:entityKind");function V(_,$){if(!_||typeof _!=="object")return!1;if(_ instanceof $)return!0;if(!Object.prototype.hasOwnProperty.call($,K))throw Error(`Class "${$.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let X=Object.getPrototypeOf(_).constructor;if(X)while(X){if(K in X&&X[K]===$[K])return!0;X=Object.getPrototypeOf(X)}return!1}class p{constructor(_,$){this.table=_,this.config=$,this.name=$.name,this.keyAsName=$.keyAsName,this.notNull=$.notNull,this.default=$.default,this.defaultFn=$.defaultFn,this.onUpdateFn=$.onUpdateFn,this.hasDefault=$.hasDefault,this.primary=$.primaryKey,this.isUnique=$.isUnique,this.uniqueName=$.uniqueName,this.uniqueType=$.uniqueType,this.dataType=$.dataType,this.columnType=$.columnType,this.generated=$.generated,this.generatedIdentity=$.generatedIdentity}static[K]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(_){return _}mapToDriverValue(_){return _}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class u8{static[K]="ColumnBuilder";config;constructor(_,$,X){this.config={name:_,keyAsName:_==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:$,columnType:X,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(_){return this.config.default=_,this.config.hasDefault=!0,this}$defaultFn(_){return this.config.defaultFn=_,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(_){return this.config.onUpdateFn=_,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(_){if(this.config.name!=="")return;this.config.name=_}}var w0=Symbol.for("drizzle:Name");function v3(_,...$){return _(...$)}function h3(_,$){return`${_[w0]}_${$.join("_")}_unique`}class z_ extends p{constructor(_,$){if(!$.uniqueName)$.uniqueName=h3(_,[$.name]);super(_,$);this.table=_}static[K]="PgColumn"}class eG extends z_{static[K]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(_){return this.indexConfig.opClass=_,this}}class _Y extends z_{static[K]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}var y3=Symbol.for("drizzle:isPgEnum");function f3(_){return!!_&&typeof _==="function"&&y3 in _&&_[y3]===!0}class $Y extends z_{static[K]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}class Z0{static[K]="Subquery";constructor(_,$,X,Z=!1,J=[]){this._={brand:"Subquery",sql:_,selectedFields:$,alias:X,isWith:Z,usedTables:J}}}class H_ extends Z0{static[K]="WithSubquery"}var b3="0.44.7";var d8,c8,g3={startActiveSpan(_,$){if(!d8)return $();if(!c8)c8=d8.trace.getTracer("drizzle-orm",b3);return v3((X,Z)=>Z.startActiveSpan(_,(J)=>{try{return $(J)}catch(G){throw J.setStatus({code:X.SpanStatusCode.ERROR,message:G instanceof Error?G.message:"Unknown error"}),G}finally{J.end()}}),d8,c8)}};var r=Symbol.for("drizzle:ViewBaseConfig");var D6=Symbol.for("drizzle:Schema"),O6=Symbol.for("drizzle:Columns"),p3=Symbol.for("drizzle:ExtraConfigColumns"),l8=Symbol.for("drizzle:OriginalName"),i8=Symbol.for("drizzle:BaseName"),F_=Symbol.for("drizzle:IsAlias"),m3=Symbol.for("drizzle:ExtraConfigBuilder"),XY=Symbol.for("drizzle:IsDrizzleTable");class B{static[K]="Table";static Symbol={Name:w0,Schema:D6,OriginalName:l8,Columns:O6,ExtraConfigColumns:p3,BaseName:i8,IsAlias:F_,ExtraConfigBuilder:m3};[w0];[l8];[D6];[O6];[p3];[i8];[F_]=!1;[XY]=!0;[m3]=void 0;constructor(_,$,X){this[w0]=this[l8]=_,this[D6]=$,this[i8]=X}}function T1(_){return _[w0]}function i1(_){return`${_[D6]??"public"}.${_[w0]}`}function n8(_){return _!==null&&_!==void 0&&typeof _.getSQL==="function"}function ZY(_){let $={sql:"",params:[]};for(let X of _)if($.sql+=X.sql,$.params.push(...X.params),X.typings?.length){if(!$.typings)$.typings=[];$.typings.push(...X.typings)}return $}class H0{static[K]="StringChunk";value;constructor(_){this.value=Array.isArray(_)?_:[_]}getSQL(){return new Q([this])}}class Q{constructor(_){this.queryChunks=_;for(let $ of _)if(V($,B)){let X=$[B.Symbol.Schema];this.usedTables.push(X===void 0?$[B.Symbol.Name]:X+"."+$[B.Symbol.Name])}}static[K]="SQL";decoder=d3;shouldInlineParams=!1;usedTables=[];append(_){return this.queryChunks.push(..._.queryChunks),this}toQuery(_){return g3.startActiveSpan("drizzle.buildSQL",($)=>{let X=this.buildQueryFromSourceParams(this.queryChunks,_);return $?.setAttributes({"drizzle.query.text":X.sql,"drizzle.query.params":JSON.stringify(X.params)}),X})}buildQueryFromSourceParams(_,$){let X=Object.assign({},$,{inlineParams:$.inlineParams||this.shouldInlineParams,paramStartIndex:$.paramStartIndex||{value:0}}),{casing:Z,escapeName:J,escapeParam:G,prepareTyping:Y,inlineParams:z,paramStartIndex:H}=X;return ZY(_.map((F)=>{if(V(F,H0))return{sql:F.value.join(""),params:[]};if(V(F,R6))return{sql:J(F.value),params:[]};if(F===void 0)return{sql:"",params:[]};if(Array.isArray(F)){let W=[new H0("(")];for(let[A,D]of F.entries())if(W.push(D),A<F.length-1)W.push(new H0(", "));return W.push(new H0(")")),this.buildQueryFromSourceParams(W,X)}if(V(F,Q))return this.buildQueryFromSourceParams(F.queryChunks,{...X,inlineParams:z||F.shouldInlineParams});if(V(F,B)){let W=F[B.Symbol.Schema],A=F[B.Symbol.Name];return{sql:W===void 0||F[F_]?J(A):J(W)+"."+J(A),params:[]}}if(V(F,p)){let W=Z.getColumnCasing(F);if($.invokeSource==="indexes")return{sql:J(W),params:[]};let A=F.table[B.Symbol.Schema];return{sql:F.table[F_]||A===void 0?J(F.table[B.Symbol.Name])+"."+J(W):J(A)+"."+J(F.table[B.Symbol.Name])+"."+J(W),params:[]}}if(V(F,f0)){let W=F[r].schema,A=F[r].name;return{sql:W===void 0||F[r].isAlias?J(A):J(W)+"."+J(A),params:[]}}if(V(F,P0)){if(V(F.value,L1))return{sql:G(H.value++,F),params:[F],typings:["none"]};let W=F.value===null?null:F.encoder.mapToDriverValue(F.value);if(V(W,Q))return this.buildQueryFromSourceParams([W],X);if(z)return{sql:this.mapInlineParam(W,X),params:[]};let A=["none"];if(Y)A=[Y(F.encoder)];return{sql:G(H.value++,W),params:[W],typings:A}}if(V(F,L1))return{sql:G(H.value++,F),params:[F],typings:["none"]};if(V(F,Q.Aliased)&&F.fieldAlias!==void 0)return{sql:J(F.fieldAlias),params:[]};if(V(F,Z0)){if(F._.isWith)return{sql:J(F._.alias),params:[]};return this.buildQueryFromSourceParams([new H0("("),F._.sql,new H0(") "),new R6(F._.alias)],X)}if(f3(F)){if(F.schema)return{sql:J(F.schema)+"."+J(F.enumName),params:[]};return{sql:J(F.enumName),params:[]}}if(n8(F)){if(F.shouldOmitSQLParens?.())return this.buildQueryFromSourceParams([F.getSQL()],X);return this.buildQueryFromSourceParams([new H0("("),F.getSQL(),new H0(")")],X)}if(z)return{sql:this.mapInlineParam(F,X),params:[]};return{sql:G(H.value++,F),params:[F],typings:["none"]}}))}mapInlineParam(_,{escapeString:$}){if(_===null)return"null";if(typeof _==="number"||typeof _==="boolean")return _.toString();if(typeof _==="string")return $(_);if(typeof _==="object"){let X=_.toString();if(X==="[object Object]")return $(JSON.stringify(_));return $(X)}throw Error("Unexpected param value: "+_)}getSQL(){return this}as(_){if(_===void 0)return this;return new Q.Aliased(this,_)}mapWith(_){return this.decoder=typeof _==="function"?{mapFromDriverValue:_}:_,this}inlineParams(){return this.shouldInlineParams=!0,this}if(_){return _?this:void 0}}class R6{constructor(_){this.value=_}static[K]="Name";brand;getSQL(){return new Q([this])}}function u3(_){return typeof _==="object"&&_!==null&&"mapToDriverValue"in _&&typeof _.mapToDriverValue==="function"}var d3={mapFromDriverValue:(_)=>_},c3={mapToDriverValue:(_)=>_},_D={...d3,...c3};class P0{constructor(_,$=c3){this.value=_,this.encoder=$}static[K]="Param";brand;getSQL(){return new Q([this])}}function U(_,...$){let X=[];if($.length>0||_.length>0&&_[0]!=="")X.push(new H0(_[0]));for(let[Z,J]of $.entries())X.push(J,new H0(_[Z+1]));return new Q(X)}((_)=>{function $(){return new Q([])}_.empty=$;function X(H){return new Q(H)}_.fromList=X;function Z(H){return new Q([new H0(H)])}_.raw=Z;function J(H,F){let W=[];for(let[A,D]of H.entries()){if(A>0&&F!==void 0)W.push(F);W.push(D)}return new Q(W)}_.join=J;function G(H){return new R6(H)}_.identifier=G;function Y(H){return new L1(H)}_.placeholder=Y;function z(H,F){return new P0(H,F)}_.param=z})(U||(U={}));((_)=>{class ${constructor(X,Z){this.sql=X,this.fieldAlias=Z}static[K]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new $(this.sql,this.fieldAlias)}}_.Aliased=$})(Q||(Q={}));class L1{constructor(_){this.name=_}static[K]="Placeholder";getSQL(){return new Q([this])}}function W_(_,$){return _.map((X)=>{if(V(X,L1)){if(!(X.name in $))throw Error(`No value for placeholder "${X.name}" was provided`);return $[X.name]}if(V(X,P0)&&V(X.value,L1)){if(!(X.value.name in $))throw Error(`No value for placeholder "${X.value.name}" was provided`);return X.encoder.mapToDriverValue($[X.value.name])}return X})}var JY=Symbol.for("drizzle:IsDrizzleView");class f0{static[K]="View";[r];[JY]=!0;constructor({name:_,schema:$,selectedFields:X,query:Z}){this[r]={name:_,originalName:_,schema:$,selectedFields:X,query:Z,isExisting:!Z,isAlias:!1}}getSQL(){return new Q([this])}}p.prototype.getSQL=function(){return new Q([this])};B.prototype.getSQL=function(){return new Q([this])};Z0.prototype.getSQL=function(){return new Q([this])};class V2{constructor(_){this.table=_}static[K]="ColumnAliasProxyHandler";get(_,$){if($==="table")return this.table;return _[$]}}class U_{constructor(_,$){this.alias=_,this.replaceOriginalName=$}static[K]="TableAliasProxyHandler";get(_,$){if($===B.Symbol.IsAlias)return!0;if($===B.Symbol.Name)return this.alias;if(this.replaceOriginalName&&$===B.Symbol.OriginalName)return this.alias;if($===r)return{..._[r],name:this.alias,isAlias:!0};if($===B.Symbol.Columns){let Z=_[B.Symbol.Columns];if(!Z)return Z;let J={};return Object.keys(Z).map((G)=>{J[G]=new Proxy(Z[G],new V2(new Proxy(_,this)))}),J}let X=_[$];if(V(X,p))return new Proxy(X,new V2(new Proxy(_,this)));return X}}function V6(_,$){return new Proxy(_,new U_($,!1))}function $1(_,$){return new Proxy(_,new V2(new Proxy(_.table,new U_($,!1))))}function o8(_,$){return new Q.Aliased(A_(_.sql,$),_.fieldAlias)}function A_(_,$){return U.join(_.queryChunks.map((X)=>{if(V(X,p))return $1(X,$);if(V(X,Q))return A_(X,$);if(V(X,Q.Aliased))return o8(X,$);return X}))}class N2 extends Error{static[K]="DrizzleError";constructor({message:_,cause:$}){super(_);this.name="DrizzleError",this.cause=$}}class O1 extends Error{constructor(_,$,X){super(`Failed query: ${_}
params: ${$}`);if(this.query=_,this.params=$,this.cause=X,Error.captureStackTrace(this,O1),X)this.cause=X}}class s8 extends N2{static[K]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class l3{static[K]="ConsoleLogWriter";write(_){console.log(_)}}class r8{static[K]="DefaultLogger";writer;constructor(_){this.writer=_?.writer??new l3}logQuery(_,$){let X=$.map((J)=>{try{return JSON.stringify(J)}catch{return String(J)}}),Z=X.length?` -- params: [${X.join(", ")}]`:"";this.writer.write(`Query: ${_}${Z}`)}}class a8{static[K]="NoopLogger";logQuery(){}}class I0{static[K]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}then(_,$){return this.execute().then(_,$)}}function t8(_,$,X){let Z={},J=_.reduce((G,{path:Y,field:z},H)=>{let F;if(V(z,p))F=z;else if(V(z,Q))F=z.decoder;else F=z.sql.decoder;let W=G;for(let[A,D]of Y.entries())if(A<Y.length-1){if(!(D in W))W[D]={};W=W[D]}else{let R=$[H],O=W[D]=R===null?null:F.mapFromDriverValue(R);if(X&&V(z,p)&&Y.length===2){let N=Y[0];if(!(N in Z))Z[N]=O===null?T1(z.table):!1;else if(typeof Z[N]==="string"&&Z[N]!==T1(z.table))Z[N]=!1}}return G},{});if(X&&Object.keys(Z).length>0){for(let[G,Y]of Object.entries(Z))if(typeof Y==="string"&&!X[Y])J[G]=null}return J}function b0(_,$){return Object.entries(_).reduce((X,[Z,J])=>{if(typeof Z!=="string")return X;let G=$?[...$,Z]:[Z];if(V(J,p)||V(J,Q)||V(J,Q.Aliased))X.push({path:G,field:J});else if(V(J,B))X.push(...b0(J[B.Symbol.Columns],G));else X.push(...b0(J,G));return X},[])}function K_(_,$){let X=Object.keys(_),Z=Object.keys($);if(X.length!==Z.length)return!1;for(let[J,G]of X.entries())if(G!==Z[J])return!1;return!0}function N6(_,$){let X=Object.entries($).filter(([,Z])=>Z!==void 0).map(([Z,J])=>{if(V(J,Q)||V(J,p))return[Z,J];else return[Z,new P0(J,_[B.Symbol.Columns][Z])]});if(X.length===0)throw Error("No values to set");return Object.fromEntries(X)}function i3(_,$){for(let X of $)for(let Z of Object.getOwnPropertyNames(X.prototype)){if(Z==="constructor")continue;Object.defineProperty(_.prototype,Z,Object.getOwnPropertyDescriptor(X.prototype,Z)||Object.create(null))}}function n3(_){return _[B.Symbol.Columns]}function D_(_){return V(_,Z0)?_._.alias:V(_,f0)?_[r].name:V(_,Q)?void 0:_[B.Symbol.IsAlias]?_[B.Symbol.Name]:_[B.Symbol.BaseName]}function X1(_,$){return{name:typeof _==="string"&&_.length>0?_:"",config:typeof _==="object"?_:$}}function o3(_){if(typeof _!=="object"||_===null)return!1;if(_.constructor.name!=="Object")return!1;if("logger"in _){let $=typeof _.logger;if($!=="boolean"&&($!=="object"||typeof _.logger.logQuery!=="function")&&$!=="undefined")return!1;return!0}if("schema"in _){let $=typeof _.schema;if($!=="object"&&$!=="undefined")return!1;return!0}if("casing"in _){let $=typeof _.casing;if($!=="string"&&$!=="undefined")return!1;return!0}if("mode"in _){if(_.mode!=="default"||_.mode!=="planetscale"||_.mode!==void 0)return!1;return!0}if("connection"in _){let $=typeof _.connection;if($!=="string"&&$!=="object"&&$!=="undefined")return!1;return!0}if("client"in _){let $=typeof _.client;if($!=="object"&&$!=="function"&&$!=="undefined")return!1;return!0}if(Object.keys(_).length===0)return!0;return!1}var e8=typeof TextDecoder>"u"?null:new TextDecoder;var s3=Symbol.for("drizzle:PgInlineForeignKeys"),r3=Symbol.for("drizzle:EnableRLS");class _4 extends B{static[K]="PgTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:s3,EnableRLS:r3});[s3]=[];[r3]=!1;[B.Symbol.ExtraConfigBuilder]=void 0;[B.Symbol.ExtraConfigColumns]={}}class $4{static[K]="PgPrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new a3(_,this.columns,this.name)}}class a3{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[K]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[_4.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function T0(_,$){if(u3($)&&!n8(_)&&!V(_,P0)&&!V(_,L1)&&!V(_,p)&&!V(_,B)&&!V(_,f0))return new P0(_,$);return _}var L=(_,$)=>{return U`${_} = ${T0($,_)}`},t3=(_,$)=>{return U`${_} <> ${T0($,_)}`};function K0(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new Q($);return new Q([new H0("("),U.join($,new H0(" and ")),new H0(")")])}function O_(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new Q($);return new Q([new H0("("),U.join($,new H0(" or ")),new H0(")")])}function e3(_){return U`not ${_}`}var _7=(_,$)=>{return U`${_} > ${T0($,_)}`},$7=(_,$)=>{return U`${_} >= ${T0($,_)}`},X7=(_,$)=>{return U`${_} < ${T0($,_)}`},Z7=(_,$)=>{return U`${_} <= ${T0($,_)}`};function J7(_,$){if(Array.isArray($)){if($.length===0)return U`false`;return U`${_} in ${$.map((X)=>T0(X,_))}`}return U`${_} in ${T0($,_)}`}function G7(_,$){if(Array.isArray($)){if($.length===0)return U`true`;return U`${_} not in ${$.map((X)=>T0(X,_))}`}return U`${_} not in ${T0($,_)}`}function Y7(_){return U`${_} is null`}function z7(_){return U`${_} is not null`}function H7(_){return U`exists ${_}`}function F7(_){return U`not exists ${_}`}function W7(_,$,X){return U`${_} between ${T0($,_)} and ${T0(X,_)}`}function U7(_,$,X){return U`${_} not between ${T0($,_)} and ${T0(X,_)}`}function Z1(_,$){return U`${_} like ${$}`}function A7(_,$){return U`${_} not like ${$}`}function K7(_,$){return U`${_} ilike ${$}`}function D7(_,$){return U`${_} not ilike ${$}`}function O7(_){return U`${_} asc`}function g0(_){return U`${_} desc`}class X4{constructor(_,$,X){this.sourceTable=_,this.referencedTable=$,this.relationName=X,this.referencedTableName=$[B.Symbol.Name]}static[K]="Relation";referencedTableName;fieldName}class R7{constructor(_,$){this.table=_,this.config=$}static[K]="Relations"}class w1 extends X4{constructor(_,$,X,Z){super(_,$,X?.relationName);this.config=X,this.isNullable=Z}static[K]="One";withFieldName(_){let $=new w1(this.sourceTable,this.referencedTable,this.config,this.isNullable);return $.fieldName=_,$}}class R_ extends X4{constructor(_,$,X){super(_,$,X?.relationName);this.config=X}static[K]="Many";withFieldName(_){let $=new R_(this.sourceTable,this.referencedTable,this.config);return $.fieldName=_,$}}function V7(){return{and:K0,between:W7,eq:L,exists:H7,gt:_7,gte:$7,ilike:K7,inArray:J7,isNull:Y7,isNotNull:z7,like:Z1,lt:X7,lte:Z7,ne:t3,not:e3,notBetween:U7,notExists:F7,notLike:A7,notIlike:D7,notInArray:G7,or:O_,sql:U}}function N7(){return{sql:U,asc:O7,desc:g0}}function M7(_,$){if(Object.keys(_).length===1&&"default"in _&&!V(_.default,B))_=_.default;let X={},Z={},J={};for(let[G,Y]of Object.entries(_))if(V(Y,B)){let z=i1(Y),H=Z[z];X[z]=G,J[G]={tsName:G,dbName:Y[B.Symbol.Name],schema:Y[B.Symbol.Schema],columns:Y[B.Symbol.Columns],relations:H?.relations??{},primaryKey:H?.primaryKey??[]};for(let W of Object.values(Y[B.Symbol.Columns]))if(W.primary)J[G].primaryKey.push(W);let F=Y[B.Symbol.ExtraConfigBuilder]?.(Y[B.Symbol.ExtraConfigColumns]);if(F){for(let W of Object.values(F))if(V(W,$4))J[G].primaryKey.push(...W.columns)}}else if(V(Y,R7)){let z=i1(Y.table),H=X[z],F=Y.config($(Y.table)),W;for(let[A,D]of Object.entries(F))if(H){let R=J[H];if(R.relations[A]=D,W)R.primaryKey.push(...W)}else{if(!(z in Z))Z[z]={relations:{},primaryKey:W};Z[z].relations[A]=D}}return{tables:J,tableNamesMap:X}}function GY(_){return function(X,Z){return new w1(_,X,Z,Z?.fields.reduce((J,G)=>J&&G.notNull,!0)??!1)}}function YY(_){return function(X,Z){return new R_(_,X,Z)}}function B7(_,$,X){if(V(X,w1)&&X.config)return{fields:X.config.fields,references:X.config.references};let Z=$[i1(X.referencedTable)];if(!Z)throw Error(`Table "${X.referencedTable[B.Symbol.Name]}" not found in schema`);let J=_[Z];if(!J)throw Error(`Table "${Z}" not found in schema`);let G=X.sourceTable,Y=$[i1(G)];if(!Y)throw Error(`Table "${G[B.Symbol.Name]}" not found in schema`);let z=[];for(let H of Object.values(J.relations))if(X.relationName&&X!==H&&H.relationName===X.relationName||!X.relationName&&H.referencedTable===X.sourceTable)z.push(H);if(z.length>1)throw X.relationName?Error(`There are multiple relations with name "${X.relationName}" in table "${Z}"`):Error(`There are multiple relations between "${Z}" and "${X.sourceTable[B.Symbol.Name]}". Please specify relation name`);if(z[0]&&V(z[0],w1)&&z[0].config)return{fields:z[0].config.references,references:z[0].config.fields};throw Error(`There is not enough information to infer relation "${Y}.${X.fieldName}"`)}function I7(_){return{one:GY(_),many:YY(_)}}function M6(_,$,X,Z,J=(G)=>G){let G={};for(let[Y,z]of Z.entries())if(z.isJson){let H=$.relations[z.tsKey],F=X[Y],W=typeof F==="string"?JSON.parse(F):F;G[z.tsKey]=V(H,w1)?W&&M6(_,_[z.relationTableTsKey],W,z.selection,J):W.map((A)=>M6(_,_[z.relationTableTsKey],A,z.selection,J))}else{let H=J(X[Y]),F=z.field,W;if(V(F,p))W=F;else if(V(F,Q))W=F.decoder;else W=F.sql.decoder;G[z.tsKey]=H===null?null:W.mapFromDriverValue(H)}return G}function i0(_){return U`count(${_||U.raw("*")})`.mapWith(Number)}import*as X5 from"node:path";class J0 extends Error{operation;cause;context;constructor(_,$,X,Z){super(_);this.operation=$;this.cause=X;this.context=Z;if(this.name="DatabaseError",Error.captureStackTrace)Error.captureStackTrace(this,J0)}toJSON(){return{name:this.name,message:this.message,operation:this.operation,context:this.context,cause:this.cause?.message,stack:this.stack}}}class B6 extends J0{field;value;constructor(_,$,X,Z){super(_,"validation",Z,{field:$,value:X});this.field=$;this.value=X;this.name="ValidationError"}}class V_ extends J0{connectionDetails;constructor(_,$,X){super(_,"connection",X,$);this.connectionDetails=$;this.name="ConnectionError"}}async function l(_,$,X){try{return await $()}catch(Z){if(Z instanceof J0)throw Z;throw new J0(`Database operation failed: ${_}`,_,Z,X)}}import*as G8 from"node:fs";import*as r_ from"node:path";class P extends Error{code;rawCode;constructor(_,$,X,Z){if($!==void 0)_=`${$}: ${_}`;super(_,{cause:Z});this.code=$,this.rawCode=X,this.name="LibsqlError"}}function Q7(_){let $=zY.exec(_);if($===null)throw new P(`The URL '${_}' is not in a valid format`,"URL_INVALID");let X=$.groups,Z=X.scheme,J=X.authority!==void 0?HY(X.authority):void 0,G=n1(X.path),Y=X.query!==void 0?WY(X.query):void 0,z=X.fragment!==void 0?n1(X.fragment):void 0;return{scheme:Z,authority:J,path:G,query:Y,fragment:z}}var zY=(()=>{return new RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su")})();function HY(_){let $=FY.exec(_);if($===null)throw new P("The authority part of the URL is not in a valid format","URL_INVALID");let X=$.groups,Z=n1(X.host_br??X.host),J=X.port?parseInt(X.port,10):void 0,G=X.username!==void 0?{username:n1(X.username),password:X.password!==void 0?n1(X.password):void 0}:void 0;return{host:Z,port:J,userinfo:G}}var FY=(()=>{return new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su")})();function WY(_){let $=_.split("&"),X=[];for(let Z of $){if(Z==="")continue;let J,G,Y=Z.indexOf("=");if(Y<0)J=Z,G="";else J=Z.substring(0,Y),G=Z.substring(Y+1);X.push({key:n1(J.replaceAll("+"," ")),value:n1(G.replaceAll("+"," "))})}return{pairs:X}}function n1(_){try{return decodeURIComponent(_)}catch($){if($ instanceof URIError)throw new P(`URL component has invalid percent encoding: ${$}`,"URL_INVALID",void 0,$);throw $}}function N_(_,$,X){if($===void 0)throw new P(`URL with scheme ${JSON.stringify(_+":")} requires authority (the "//" part)`,"URL_INVALID");let Z=`${_}:`,J=UY($.host),G=AY($.port),z=`//${KY($.userinfo)}${J}${G}`,H=X.split("/").map(encodeURIComponent).join("/");if(H!==""&&!H.startsWith("/"))H="/"+H;return new URL(`${Z}${z}${H}`)}function UY(_){return _.includes(":")?`[${encodeURI(_)}]`:encodeURI(_)}function AY(_){return _!==void 0?`:${_}`:""}function KY(_){if(_===void 0)return"";let $=encodeURIComponent(_.username),X=_.password!==void 0?`:${encodeURIComponent(_.password)}`:"";return`${$}${X}@`}var B2=typeof Buffer==="function",E7=typeof TextDecoder==="function"?new TextDecoder:void 0,j7=typeof TextEncoder==="function"?new TextEncoder:void 0;var M_=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),I6=((_)=>{let $={};return _.forEach((X,Z)=>$[X]=Z),$})(M_),DY=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,D0=String.fromCharCode.bind(String),T7=typeof Uint8Array.from==="function"?Uint8Array.from.bind(Uint8Array):(_)=>new Uint8Array(Array.prototype.slice.call(_,0)),P7=(_)=>_.replace(/=/g,"").replace(/[+\/]/g,($)=>$=="+"?"-":"_"),x7=(_)=>_.replace(/[^A-Za-z0-9\+\/]/g,""),q7=(_)=>{let $,X,Z,J,G="",Y=_.length%3;for(let z=0;z<_.length;){if((X=_.charCodeAt(z++))>255||(Z=_.charCodeAt(z++))>255||(J=_.charCodeAt(z++))>255)throw TypeError("invalid character found");$=X<<16|Z<<8|J,G+=M_[$>>18&63]+M_[$>>12&63]+M_[$>>6&63]+M_[$&63]}return Y?G.slice(0,Y-3)+"===".substring(Y):G},G4=typeof btoa==="function"?(_)=>btoa(_):B2?(_)=>Buffer.from(_,"binary").toString("base64"):q7,Z4=B2?(_)=>Buffer.from(_).toString("base64"):(_)=>{let X=[];for(let Z=0,J=_.length;Z<J;Z+=4096)X.push(D0.apply(null,_.subarray(Z,Z+4096)));return G4(X.join(""))},Q6=(_,$=!1)=>$?P7(Z4(_)):Z4(_),OY=(_)=>{if(_.length<2){var $=_.charCodeAt(0);return $<128?_:$<2048?D0(192|$>>>6)+D0(128|$&63):D0(224|$>>>12&15)+D0(128|$>>>6&63)+D0(128|$&63)}else{var $=65536+(_.charCodeAt(0)-55296)*1024+(_.charCodeAt(1)-56320);return D0(240|$>>>18&7)+D0(128|$>>>12&63)+D0(128|$>>>6&63)+D0(128|$&63)}},RY=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,C7=(_)=>_.replace(RY,OY),L7=B2?(_)=>Buffer.from(_,"utf8").toString("base64"):j7?(_)=>Z4(j7.encode(_)):(_)=>G4(C7(_)),M2=(_,$=!1)=>$?P7(L7(_)):L7(_),w7=(_)=>M2(_,!0),VY=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,NY=(_)=>{switch(_.length){case 4:var $=(7&_.charCodeAt(0))<<18|(63&_.charCodeAt(1))<<12|(63&_.charCodeAt(2))<<6|63&_.charCodeAt(3),X=$-65536;return D0((X>>>10)+55296)+D0((X&1023)+56320);case 3:return D0((15&_.charCodeAt(0))<<12|(63&_.charCodeAt(1))<<6|63&_.charCodeAt(2));default:return D0((31&_.charCodeAt(0))<<6|63&_.charCodeAt(1))}},S7=(_)=>_.replace(VY,NY),k7=(_)=>{if(_=_.replace(/\s+/g,""),!DY.test(_))throw TypeError("malformed base64.");_+="==".slice(2-(_.length&3));let $,X,Z,J=[];for(let G=0;G<_.length;)if($=I6[_.charAt(G++)]<<18|I6[_.charAt(G++)]<<12|(X=I6[_.charAt(G++)])<<6|(Z=I6[_.charAt(G++)]),X===64)J.push(D0($>>16&255));else if(Z===64)J.push(D0($>>16&255,$>>8&255));else J.push(D0($>>16&255,$>>8&255,$&255));return J.join("")},Y4=typeof atob==="function"?(_)=>atob(x7(_)):B2?(_)=>Buffer.from(_,"base64").toString("binary"):k7,v7=B2?(_)=>T7(Buffer.from(_,"base64")):(_)=>T7(Y4(_).split("").map(($)=>$.charCodeAt(0))),h7=(_)=>v7(y7(_)),MY=B2?(_)=>Buffer.from(_,"base64").toString("utf8"):E7?(_)=>E7.decode(v7(_)):(_)=>S7(Y4(_)),y7=(_)=>x7(_.replace(/[-_]/g,($)=>$=="-"?"+":"/")),J4=(_)=>MY(y7(_)),BY=(_)=>{if(typeof _!=="string")return!1;let $=_.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test($)||!/[^\s0-9a-zA-Z\-_]/.test($)},f7=(_)=>{return{value:_,enumerable:!1,writable:!0,configurable:!0}},b7=function(){let _=($,X)=>Object.defineProperty(String.prototype,$,f7(X));_("fromBase64",function(){return J4(this)}),_("toBase64",function($){return M2(this,$)}),_("toBase64URI",function(){return M2(this,!0)}),_("toBase64URL",function(){return M2(this,!0)}),_("toUint8Array",function(){return h7(this)})},g7=function(){let _=($,X)=>Object.defineProperty(Uint8Array.prototype,$,f7(X));_("toBase64",function($){return Q6(this,$)}),_("toBase64URI",function(){return Q6(this,!0)}),_("toBase64URL",function(){return Q6(this,!0)})},IY=()=>{b7(),g7()},I2={version:"3.7.8",VERSION:"3.7.8",atob:Y4,atobPolyfill:k7,btoa:G4,btoaPolyfill:q7,fromBase64:J4,toBase64:M2,encode:M2,encodeURI:w7,encodeURL:w7,utob:C7,btou:S7,decode:J4,isValid:BY,fromUint8Array:Q6,toUint8Array:h7,extendString:b7,extendUint8Array:g7,extendBuiltins:IY};var J1="https://github.com/libsql/libsql-client-ts#supported-urls";function P1(_){if(_==="write")return"BEGIN IMMEDIATE";else if(_==="read")return"BEGIN TRANSACTION READONLY";else if(_==="deferred")return"BEGIN DEFERRED";else throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class Q2{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(_,$,X,Z,J){this.columns=_,this.columnTypes=$,this.rows=X,this.rowsAffected=Z,this.lastInsertRowid=J}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(QY),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}}function QY(_){return Array.prototype.map.call(_,EY)}function EY(_){if(typeof _==="bigint")return""+_;else if(_ instanceof ArrayBuffer)return I2.fromUint8Array(new Uint8Array(_));else return _}var p7=":memory:";function m7(_){return _.scheme==="file"&&(_.path===":memory:"||_.path.startsWith(":memory:?"))}function B_(_,$){if(typeof _!=="object")throw TypeError(`Expected client configuration as object, got ${typeof _}`);let{url:X,authToken:Z,tls:J,intMode:G,concurrency:Y}=_;Y=Math.max(0,Y||20),G??="number";let z=[];if(X===p7)X="file::memory:";let H=Q7(X),F=H.scheme.toLowerCase(),W=F==="file"&&H.path===p7&&H.authority===void 0,A;if(W)A={cache:{values:["shared","private"],update:(N,I)=>z.push(`${N}=${I}`)}};else A={tls:{values:["0","1"],update:(N,I)=>J=I==="1"},authToken:{update:(N,I)=>Z=I}};for(let{key:N,value:I}of H.query?.pairs??[]){if(!Object.hasOwn(A,N))throw new P(`Unsupported URL query parameter ${JSON.stringify(N)}`,"URL_PARAM_NOT_SUPPORTED");let j=A[N];if(j.values!==void 0&&!j.values.includes(I))throw new P(`Unknown value for the "${N}" query argument: ${JSON.stringify(I)}. Supported values are: [${j.values.map((w)=>'"'+w+'"').join(", ")}]`,"URL_INVALID");if(j.update!==void 0)j?.update(N,I)}let D=z.length===0?"":`?${z.join("&")}`,R=H.path+D,O;if(F==="libsql")if(J===!1){if(H.authority?.port===void 0)throw new P('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");O=$?"http":"ws"}else O=$?"https":"wss";else O=F;if(O==="http"||O==="ws")J??=!1;else J??=!0;if(O!=="http"&&O!=="ws"&&O!=="https"&&O!=="wss"&&O!=="file")throw new P(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(H.scheme+":")}. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");if(G!=="number"&&G!=="bigint"&&G!=="string")throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(G)}`);if(H.fragment!==void 0)throw new P(`URL fragments are not supported: ${JSON.stringify("#"+H.fragment)}`,"URL_INVALID");if(W)return{scheme:"file",tls:!1,path:R,intMode:G,concurrency:Y,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0};return{scheme:O,tls:J,authority:H.authority,path:R,authToken:Z,intMode:G,concurrency:Y,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch}}var I_=j0(j9(),1);import{Buffer as L9}from"node:buffer";function w9(_){if(_.scheme!=="file")throw new P(`URL scheme ${JSON.stringify(_.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");let $=_.authority;if($!==void 0){let Y=$.host.toLowerCase();if(Y!==""&&Y!=="localhost")throw new P(`Invalid host in file URL: ${JSON.stringify($.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${J1}`,"URL_INVALID");if($.port!==void 0)throw new P("File URL cannot have a port","URL_INVALID");if($.userinfo!==void 0)throw new P("File URL cannot have username and password","URL_INVALID")}let X=m7(_);if(X&&_.syncUrl)throw new P(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${_.path}`,"URL_INVALID");let Z=_.path;if(X)Z=`${_.scheme}:${_.path}`;let J={authToken:_.authToken,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncPeriod:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline},G=new I_.default(Z,J);return F0(G,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",_.intMode),new P9(Z,J,G,_.intMode)}class P9{#_;#$;#X;#Z;closed;protocol;constructor(_,$,X,Z){this.#_=_,this.#$=$,this.#X=X,this.#Z=Z,this.closed=!1,this.protocol="file"}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#J(),F0(this.#G(),X,this.#Z)}async batch(_,$="deferred"){this.#J();let X=this.#G();try{F0(X,P1($),this.#Z);let Z=_.map((J)=>{if(!X.inTransaction)throw new P("The transaction has been rolled back","TRANSACTION_CLOSED");let G=Array.isArray(J)?{sql:J[0],args:J[1]||[]}:J;return F0(X,G,this.#Z)});return F0(X,"COMMIT",this.#Z),Z}finally{if(X.inTransaction)F0(X,"ROLLBACK",this.#Z)}}async migrate(_){this.#J();let $=this.#G();try{F0($,"PRAGMA foreign_keys=off",this.#Z),F0($,P1("deferred"),this.#Z);let X=_.map((Z)=>{if(!$.inTransaction)throw new P("The transaction has been rolled back","TRANSACTION_CLOSED");return F0($,Z,this.#Z)});return F0($,"COMMIT",this.#Z),X}finally{if($.inTransaction)F0($,"ROLLBACK",this.#Z);F0($,"PRAGMA foreign_keys=on",this.#Z)}}async transaction(_="write"){let $=this.#G();return F0($,P1(_),this.#Z),this.#X=null,new x9($,this.#Z)}async executeMultiple(_){this.#J();let $=this.#G();try{return q9($,_)}finally{if($.inTransaction)F0($,"ROLLBACK",this.#Z)}}async sync(){this.#J();let _=await this.#G().sync();return{frames_synced:_.frames_synced,frame_no:_.frame_no}}async reconnect(){try{if(!this.closed&&this.#X!==null)this.#X.close()}finally{this.#X=new I_.default(this.#_,this.#$),this.closed=!1}}close(){if(this.closed=!0,this.#X!==null)this.#X.close(),this.#X=null}#J(){if(this.closed)throw new P("The client is closed","CLIENT_CLOSED")}#G(){if(this.#X===null)this.#X=new I_.default(this.#_,this.#$);return this.#X}}class x9{#_;#$;constructor(_,$){this.#_=_,this.#$=$}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#X(),F0(this.#_,X,this.#$)}async batch(_){return _.map(($)=>{this.#X();let X=Array.isArray($)?{sql:$[0],args:$[1]||[]}:$;return F0(this.#_,X,this.#$)})}async executeMultiple(_){return this.#X(),q9(this.#_,_)}async rollback(){if(!this.#_.open)return;this.#X(),F0(this.#_,"ROLLBACK",this.#$)}async commit(){this.#X(),F0(this.#_,"COMMIT",this.#$)}close(){if(this.#_.inTransaction)F0(this.#_,"ROLLBACK",this.#$)}get closed(){return!this.#_.inTransaction}#X(){if(this.closed)throw new P("The transaction is closed","TRANSACTION_CLOSED")}}function F0(_,$,X){let Z,J;if(typeof $==="string")Z=$,J=[];else if(Z=$.sql,Array.isArray($.args))J=$.args.map((G)=>T9(G,X));else{J={};for(let G in $.args){let Y=G[0]==="@"||G[0]==="$"||G[0]===":"?G.substring(1):G;J[Y]=T9($.args[G],X)}}try{let G=_.prepare(Z);G.safeIntegers(!0);let Y=!0;try{G.raw(!0)}catch{Y=!1}if(Y){let z=Array.from(G.columns().map((D)=>D.name)),H=Array.from(G.columns().map((D)=>D.type??"")),F=G.all(J).map((D)=>{return Vz(D,z,X)}),W=0,A=void 0;return new Q2(z,H,F,0,void 0)}else{let z=G.run(J),H=z.changes,F=BigInt(z.lastInsertRowid);return new Q2([],[],[],H,F)}}catch(G){throw C9(G)}}function Vz(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:_.length});for(let J=0;J<_.length;++J){let G=Nz(_[J],X);Object.defineProperty(Z,J,{value:G});let Y=$[J];if(!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function Nz(_,$){if(typeof _==="bigint")if($==="number"){if(_<Mz||_>Bz)throw RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(_)}else if($==="bigint")return _;else if($==="string")return""+_;else throw Error("Invalid value for IntMode");else if(_ instanceof L9)return _.buffer;return _}var Mz=-9007199254740991n,Bz=9007199254740991n;function T9(_,$){if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<Iz||_>Qz)throw RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")switch($){case"bigint":return _?1n:0n;case"string":return _?"1":"0";default:return _?1:0}else if(_ instanceof ArrayBuffer)return L9.from(_);else if(_ instanceof Date)return _.valueOf();else if(_===void 0)throw TypeError("undefined cannot be passed as argument to the database");else return _}var Iz=-9223372036854775808n,Qz=9223372036854775807n;function q9(_,$){try{_.exec($)}catch(X){throw C9(X)}}function C9(_){if(_ instanceof I_.default.SqliteError)return new P(_.message,_.code,_.rawCode,_);return _}var pH=j0(L$(),1),mH=j0(D4(),1),uH=j0(R4(),1),S2=j0(h6(),1),dH=j0(k$(),1);class k2{constructor(){this.intMode="number"}intMode}class m extends Error{constructor(_){super(_);this.name="ClientError"}}class T extends m{constructor(_){super(_);this.name="ProtoError"}}class q_ extends m{code;proto;constructor(_,$){super(_);this.name="ResponseError",this.code=$.code,this.proto=$,this.stack=void 0}}class X0 extends m{constructor(_,$){if($!==void 0){super(`${_}: ${$}`);this.cause=$}else super(_);this.name="ClosedError"}}class C_ extends m{constructor(_){super(_);this.name="WebSocketUnsupportedError"}}class v2 extends m{constructor(_){super(_);this.name="WebSocketError"}}class _2 extends m{status;constructor(_,$){super(_);this.status=$,this.name="HttpServerError"}}class o0 extends m{constructor(_){super(_);this.name="ProtocolVersionError"}}class V0 extends m{constructor(_){super(_);this.name="InternalError"}}class H1 extends m{constructor(_){super(_);this.name="MisuseError"}}function L0(_){if(typeof _==="string")return _;throw h2(_,"string")}function q0(_){if(_===null||_===void 0)return;else if(typeof _==="string")return _;throw h2(_,"string or null")}function B1(_){if(typeof _==="number")return _;throw h2(_,"number")}function v1(_){if(typeof _==="boolean")return _;throw h2(_,"boolean")}function S_(_){if(Array.isArray(_))return _;throw h2(_,"array")}function G0(_){if(_!==null&&typeof _==="object"&&!Array.isArray(_))return _;throw h2(_,"object")}function s0(_,$){return S_(_).map((X)=>$(G0(X)))}function h2(_,$){if(_===void 0)return new T(`Expected ${$}, but the property was missing`);let X=typeof _;if(_===null)X="null";else if(Array.isArray(_))X="array";return new T(`Expected ${$}, received ${X}`)}function $2(_,$){return $(G0(_))}class v${#_;#$;constructor(_){this.#_=_,this.#$=!1}begin(){this.#_.push("{"),this.#$=!0}end(){this.#_.push("}"),this.#$=!1}#X(_){if(this.#$)this.#_.push('"'),this.#$=!1;else this.#_.push(',"');this.#_.push(_),this.#_.push('":')}string(_,$){this.#X(_),this.#_.push(JSON.stringify($))}stringRaw(_,$){this.#X(_),this.#_.push('"'),this.#_.push($),this.#_.push('"')}number(_,$){this.#X(_),this.#_.push(""+$)}boolean(_,$){this.#X(_),this.#_.push($?"true":"false")}object(_,$,X){this.#X(_),this.begin(),X(this,$),this.end()}arrayObjects(_,$,X){this.#X(_),this.#_.push("[");for(let Z=0;Z<$.length;++Z){if(Z!==0)this.#_.push(",");this.begin(),X(this,$[Z]),this.end()}this.#_.push("]")}}function k_(_,$){let X=[],Z=new v$(X);return Z.begin(),$(Z,_),Z.end(),X.join("")}var X2=0,v_=1,h_=2;var h$=5;class y${#_;#$;#X;constructor(_){this.#_=_,this.#$=new DataView(_.buffer,_.byteOffset,_.byteLength),this.#X=0}varint(){let _=0;for(let $=0;;$+=7){let X=this.#_[this.#X++];if(_|=(X&127)<<$,!(X&128))break}return _}varintBig(){let _=0n;for(let $=0n;;$+=7n){let X=this.#_[this.#X++];if(_|=BigInt(X&127)<<$,!(X&128))break}return _}bytes(_){let $=new Uint8Array(this.#_.buffer,this.#_.byteOffset+this.#X,_);return this.#X+=_,$}double(){let _=this.#$.getFloat64(this.#X,!0);return this.#X+=8,_}skipVarint(){for(;;)if(!(this.#_[this.#X++]&128))break}skip(_){this.#X+=_}eof(){return this.#X>=this.#_.byteLength}}class f${#_;#$;constructor(_){this.#_=_,this.#$=-1}setup(_){this.#$=_}#X(_){if(this.#$!==_)throw new T(`Expected wire type ${_}, got ${this.#$}`);this.#$=-1}bytes(){this.#X(h_);let _=this.#_.varint();return this.#_.bytes(_)}string(){return new TextDecoder().decode(this.bytes())}message(_){return h1(this.bytes(),_)}int32(){return this.#X(X2),this.#_.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#X(X2),this.#_.varintBig()}sint64(){let _=this.uint64();return _>>1n^-(_&1n)}double(){return this.#X(v_),this.#_.double()}maybeSkip(){if(this.#$<0)return;else if(this.#$===X2)this.#_.skipVarint();else if(this.#$===v_)this.#_.skip(8);else if(this.#$===h_){let _=this.#_.varint();this.#_.skip(_)}else if(this.#$===h$)this.#_.skip(4);else throw new T(`Unexpected wire type ${this.#$}`);this.#$=-1}}function h1(_,$){let X=new y$(_),Z=new f$(X),J=$.default();while(!X.eof()){let G=X.varint(),Y=G>>3,z=G&7;Z.setup(z);let H=$[Y];if(H!==void 0){let F=H(Z,J);if(F!==void 0)J=F}Z.maybeSkip()}return J}class E4{#_;#$;#X;#Z;constructor(){this.#_=new ArrayBuffer(256),this.#$=new Uint8Array(this.#_),this.#X=new DataView(this.#_),this.#Z=0}#J(_){if(this.#Z+_<=this.#_.byteLength)return;let $=this.#_.byteLength;while($<this.#Z+_)$*=2;let X=new ArrayBuffer($),Z=new Uint8Array(X),J=new DataView(X);Z.set(new Uint8Array(this.#_,0,this.#Z)),this.#_=X,this.#$=Z,this.#X=J}#G(_){this.#J(5),_=0|_;do{let $=_&127;_>>>=7,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#Y(_){this.#J(10),_=_&0xffffffffffffffffn;do{let $=Number(_&0x7fn);_>>=7n,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#z(_,$){this.#G(_<<3|$)}bytes(_,$){this.#z(_,h_),this.#G($.byteLength),this.#J($.byteLength),this.#$.set($,this.#Z),this.#Z+=$.byteLength}string(_,$){this.bytes(_,new TextEncoder().encode($))}message(_,$,X){let Z=new E4;X(Z,$),this.bytes(_,Z.data())}int32(_,$){this.#z(_,X2),this.#G($)}uint32(_,$){this.int32(_,$)}bool(_,$){this.int32(_,$?1:0)}sint64(_,$){this.#z(_,X2),this.#Y($<<1n^$>>63n)}double(_,$){this.#z(_,v_),this.#J(8),this.#X.setFloat64(this.#Z,$,!0),this.#Z+=8}data(){return new Uint8Array(this.#_,0,this.#Z)}}function y_(_,$){let X=new E4;return $(X,_),X.data()}class y1{#_;#$;constructor(){this.#_=new Set,this.#$=new Set}alloc(){for(let $ of this.#$){if(this.#$.delete($),this.#_.add($),!this.#_.has(this.#_.size-1))this.#$.add(this.#_.size-1);return $}let _=this.#_.size;return this.#_.add(_),_}free(_){if(!this.#_.delete(_))throw new V0("Freeing an id that is not allocated");if(this.#$.delete(this.#_.size),_<this.#_.size)this.#$.add(_)}}function b(_,$){throw new V0($)}function y2(_){if(_===null)return null;else if(typeof _==="string")return _;else if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<lH||_>iH)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")return _?1n:0n;else if(_ instanceof ArrayBuffer)return new Uint8Array(_);else if(_ instanceof Uint8Array)return _;else if(_ instanceof Date)return+_.valueOf();else if(typeof _==="object")return""+_.toString();else throw TypeError("Unsupported type of value")}var lH=-9223372036854775808n,iH=9223372036854775807n;function j4(_,$){if(_===null)return null;else if(typeof _==="number")return _;else if(typeof _==="string")return _;else if(typeof _==="bigint")if($==="number"){let X=Number(_);if(!Number.isSafeInteger(X))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return X}else if($==="bigint")return _;else if($==="string")return""+_;else throw new H1("Invalid value for IntMode");else if(_ instanceof Uint8Array)return _.slice().buffer;else if(_===void 0)throw new T("Received unrecognized type of Value");else throw b(_,"Impossible type of Value")}function Z2(_){return{affectedRowCount:_.affectedRowCount,lastInsertRowid:_.lastInsertRowid,columnNames:_.cols.map(($)=>$.name),columnDecltypes:_.cols.map(($)=>$.decltype)}}function b6(_,$){let X=Z2(_),Z=_.rows.map((J)=>b$(X.columnNames,J,$));return{...X,rows:Z}}function g6(_,$){let X=Z2(_),Z;if(_.rows.length>0)Z=b$(X.columnNames,_.rows[0],$);return{...X,row:Z}}function p6(_,$){let X=Z2(_),Z;if(_.rows.length>0&&X.columnNames.length>0)Z=j4(_.rows[0][0],$);return{...X,value:Z}}function b$(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:$.length});for(let J=0;J<$.length;++J){let G=j4($[J],X);Object.defineProperty(Z,J,{value:G});let Y=_[J];if(Y!==void 0&&!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function I1(_){return new q_(_.message,_)}class J2{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}_getSqlId(_){if(this.#_!==_)throw new H1("Attempted to use SQL text opened with other object");else if(this.#X!==void 0)throw new X0("SQL text is closed",this.#X);return this.#$}close(){this._setClosed(new m("SQL text was manually closed"))}_setClosed(_){if(this.#X===void 0)this.#X=_,this.#_._closeSql(this.#$)}get closed(){return this.#X!==void 0}}function f_(_,$){if($ instanceof J2)return{sqlId:$._getSqlId(_)};else return{sql:""+$}}class f1{#_;#$;constructor(){this.#_=[],this.#$=[]}get length(){return this.#_.length+this.#$.length}push(_){this.#_.push(_)}shift(){if(this.#$.length===0&&this.#_.length>0)this.#$=this.#_.reverse(),this.#_=[];return this.#$.pop()}first(){return this.#$.length!==0?this.#$[this.#$.length-1]:this.#_[0]}}class b_{sql;_args;_namedArgs;constructor(_){this.sql=_,this._args=[],this._namedArgs=new Map}bindIndexes(_){this._args.length=0;for(let $ of _)this._args.push(y2($));return this}bindIndex(_,$){if(_!==(_|0)||_<=0)throw RangeError("Index of a positional argument must be positive integer");while(this._args.length<_)this._args.push(null);return this._args[_-1]=y2($),this}bindName(_,$){return this._namedArgs.set(_,y2($)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function m6(_,$,X){let Z,J=[],G=[];if($ instanceof b_){Z=$.sql,J=$._args;for(let[H,F]of $._namedArgs.entries())G.push({name:H,value:F})}else if(Array.isArray($))if(Z=$[0],Array.isArray($[1]))J=$[1].map((H)=>y2(H));else G=Object.entries($[1]).map(([H,F])=>{return{name:H,value:y2(F)}});else Z=$;let{sql:Y,sqlId:z}=f_(_,Z);return{sql:Y,sqlId:z,args:J,namedArgs:G,wantRows:X}}class u6{_stream;#_;_steps;#$;constructor(_,$){this._stream=_,this.#_=$,this._steps=[],this.#$=!1}step(){return new T4(this)}execute(){if(this.#$)throw new H1("This batch has already been executed");this.#$=!0;let _={steps:this._steps.map(($)=>$.proto)};if(this.#_)return oH(this._stream,this._steps,_);else return nH(this._stream,this._steps,_)}}function nH(_,$,X){return _._batch(X).then((Z)=>{for(let J=0;J<$.length;++J){let G=Z.stepResults.get(J),Y=Z.stepErrors.get(J);$[J].callback(G,Y)}})}async function oH(_,$,X){let Z=await _._openCursor(X);try{let J=0,G=void 0,Y=[];for(;;){let z=await Z.next();if(z===void 0)break;if(z.type==="step_begin"){if(z.step<J||z.step>=$.length)throw new T("Server produced StepBeginEntry for unexpected step");else if(G!==void 0)throw new T("Server produced StepBeginEntry before terminating previous step");for(let H=J;H<z.step;++H)$[H].callback(void 0,void 0);J=z.step+1,G=z,Y=[]}else if(z.type==="step_end"){if(G===void 0)throw new T("Server produced StepEndEntry but no step is active");let H={cols:G.cols,rows:Y,affectedRowCount:z.affectedRowCount,lastInsertRowid:z.lastInsertRowid};$[G.step].callback(H,void 0),G=void 0,Y=[]}else if(z.type==="step_error"){if(G===void 0){if(z.step>=$.length)throw new T("Server produced StepErrorEntry for unexpected step");for(let H=J;H<z.step;++H)$[H].callback(void 0,void 0)}else{if(z.step!==G.step)throw new T("Server produced StepErrorEntry for unexpected step");G=void 0,Y=[]}$[z.step].callback(void 0,z.error),J=z.step+1}else if(z.type==="row"){if(G===void 0)throw new T("Server produced RowEntry but no step is active");Y.push(z.row)}else if(z.type==="error")throw I1(z.error);else if(z.type==="none")throw new T("Server produced unrecognized CursorEntry");else throw b(z,"Impossible CursorEntry")}if(G!==void 0)throw new T("Server closed Cursor before terminating active step");for(let z=J;z<$.length;++z)$[z].callback(void 0,void 0)}finally{Z.close()}}class T4{_batch;#_;_index;constructor(_){this._batch=_,this.#_=[],this._index=void 0}condition(_){return this.#_.push(_._proto),this}query(_){return this.#$(_,!0,b6)}queryRow(_){return this.#$(_,!0,g6)}queryValue(_){return this.#$(_,!0,p6)}run(_){return this.#$(_,!1,Z2)}#$(_,$,X){if(this._index!==void 0)throw new H1("This BatchStep has already been added to the batch");let Z=m6(this._batch._stream._sqlOwner(),_,$),J;if(this.#_.length===0)J=void 0;else if(this.#_.length===1)J=this.#_[0];else J={type:"and",conds:this.#_.slice()};let G={stmt:Z,condition:J};return new Promise((Y,z)=>{let H=(F,W)=>{if(F!==void 0&&W!==void 0)z(new T("Server returned both result and error"));else if(W!==void 0)z(I1(W));else if(F!==void 0)Y(X(F,this._batch._stream.intMode));else Y(void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:G,callback:H})})}}class a{_batch;_proto;constructor(_,$){this._batch=_,this._proto=$}static ok(_){return new a(_._batch,{type:"ok",step:g$(_)})}static error(_){return new a(_._batch,{type:"error",step:g$(_)})}static not(_){return new a(_._batch,{type:"not",cond:_._proto})}static and(_,$){for(let X of $)p$(_,X);return new a(_,{type:"and",conds:$.map((X)=>X._proto)})}static or(_,$){for(let X of $)p$(_,X);return new a(_,{type:"or",conds:$.map((X)=>X._proto)})}static isAutocommit(_){return _._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new a(_,{type:"is_autocommit"})}}function g$(_){if(_._index===void 0)throw new H1("Cannot add a condition referencing a step that has not been added to the batch");return _._index}function p$(_,$){if($._batch!==_)throw new H1("Cannot mix BatchCond objects for different Batch objects")}function m$(_){return{paramNames:_.params.map(($)=>$.name),columns:_.cols,isExplain:_.isExplain,isReadonly:_.isReadonly}}class f2{constructor(_){this.intMode=_}query(_){return this.#_(_,!0,b6)}queryRow(_){return this.#_(_,!0,g6)}queryValue(_){return this.#_(_,!0,p6)}run(_){return this.#_(_,!1,Z2)}#_(_,$,X){let Z=m6(this._sqlOwner(),_,$);return this._execute(Z).then((J)=>X(J,this.intMode))}batch(_=!1){return new u6(this,_)}describe(_){let $=f_(this._sqlOwner(),_);return this._describe($).then(m$)}sequence(_){let $=f_(this._sqlOwner(),_);return this._sequence($)}intMode}class g_{}var sH=1000,rH=10;class L4 extends g_{#_;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X){super();this.#_=_,this.#$=$,this.#X=X,this.#Z=new f1,this.#J=new f1,this.#G=void 0,this.#Y=!1}async next(){for(;;){if(this.#G!==void 0)throw new X0("Cursor is closed",this.#G);while(!this.#Y&&this.#J.length<rH)this.#J.push(this.#z());let _=this.#Z.shift();if(this.#Y||_!==void 0)return _;await this.#J.shift().then(($)=>{if($===void 0)return;for(let X of $.entries)this.#Z.push(X);this.#Y||=$.done})}}#z(){return this.#$._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#X,maxCount:sH}).then((_)=>_,(_)=>{this._setClosed(_);return})}_setClosed(_){if(this.#G!==void 0)return;this.#G=_,this.#$._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#X}).catch(()=>{return}),this.#$._cursorClosed(this)}close(){this._setClosed(new m("Cursor was manually closed"))}get closed(){return this.#G!==void 0}}class p_ extends f2{#_;#$;#X;#Z;#J;#G;static open(_){let $=_._streamIdAlloc.alloc(),X=new p_(_,$),Z=()=>{return},J=(Y)=>X.#W(Y),G={type:"open_stream",streamId:$};return _._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}constructor(_,$){super(_.intMode);this.#_=_,this.#$=$,this.#X=new f1,this.#Z=void 0,this.#J=!1,this.#G=void 0}client(){return this.#_}_sqlOwner(){return this.#_}_execute(_){return this.#Y({type:"execute",streamId:this.#$,stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#Y({type:"batch",streamId:this.#$,batch:_}).then(($)=>{return $.result})}_describe(_){return this.#_._ensureVersion(2,"describe()"),this.#Y({type:"describe",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#_._ensureVersion(2,"sequence()"),this.#Y({type:"sequence",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#Y({type:"get_autocommit",streamId:this.#$}).then((_)=>{return _.isAutocommit})}#Y(_){return new Promise(($,X)=>{this.#z({type:"request",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return this.#_._ensureVersion(3,"cursor"),new Promise(($,X)=>{this.#z({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_sendCursorRequest(_,$){if(_!==this.#Z)throw new V0("Cursor not associated with the stream attempted to execute a request");return new Promise((X,Z)=>{if(this.#G!==void 0)Z(new X0("Stream is closed",this.#G));else this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})})}_cursorClosed(_){if(_!==this.#Z)throw new V0("Cursor was closed, but it was not associated with the stream");this.#Z=void 0,this.#H()}#z(_){if(this.#G!==void 0)_.errorCallback(new X0("Stream is closed",this.#G));else if(this.#J)_.errorCallback(new X0("Stream is closing",void 0));else this.#X.push(_),this.#H()}#H(){for(;;){let _=this.#X.first();if(_===void 0&&this.#Z===void 0&&this.#J){this.#W(new m("Stream was gracefully closed"));break}else if(_?.type==="request"&&this.#Z===void 0){let{request:$,responseCallback:X,errorCallback:Z}=_;this.#X.shift(),this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}else if(_?.type==="cursor"&&this.#Z===void 0){let{batch:$,cursorCallback:X}=_;this.#X.shift();let Z=this.#_._cursorIdAlloc.alloc(),J=new L4(this.#_,this,Z),G={type:"open_cursor",streamId:this.#$,cursorId:Z,batch:$},Y=()=>{return},z=(H)=>J._setClosed(H);this.#_._sendRequest(G,{responseCallback:Y,errorCallback:z}),this.#Z=J,X(J)}else break}}#W(_){if(this.#G!==void 0)return;if(this.#G=_,this.#Z!==void 0)this.#Z._setClosed(_);for(;;){let J=this.#X.shift();if(J!==void 0)J.errorCallback(_);else break}let $={type:"close_stream",streamId:this.#$},X=()=>this.#_._streamIdAlloc.free(this.#$),Z=()=>{return};this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}close(){this.#W(new m("Stream was manually closed"))}closeGracefully(){this.#J=!0,this.#H()}get closed(){return this.#G!==void 0||this.#J}}function m_(_,$){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId);_.arrayObjects("args",$.args,u$),_.arrayObjects("named_args",$.namedArgs,aH),_.boolean("want_rows",$.wantRows)}function aH(_,$){_.string("name",$.name),_.object("value",$.value,u$)}function b2(_,$){_.arrayObjects("steps",$.steps,tH)}function tH(_,$){if($.condition!==void 0)_.object("condition",$.condition,w4);_.object("stmt",$.stmt,m_)}function w4(_,$){if(_.stringRaw("type",$.type),$.type==="ok"||$.type==="error")_.number("step",$.step);else if($.type==="not")_.object("cond",$.cond,w4);else if($.type==="and"||$.type==="or")_.arrayObjects("conds",$.conds,w4);else if($.type==="is_autocommit");else throw b($,"Impossible type of BatchCond")}function u$(_,$){if($===null)_.stringRaw("type","null");else if(typeof $==="bigint")_.stringRaw("type","integer"),_.stringRaw("value",""+$);else if(typeof $==="number")_.stringRaw("type","float"),_.number("value",$);else if(typeof $==="string")_.stringRaw("type","text"),_.string("value",$);else if($ instanceof Uint8Array)_.stringRaw("type","blob"),_.stringRaw("base64",I2.fromUint8Array($));else if($===void 0);else throw b($,"Impossible type of Value")}function d$(_,$){if(_.stringRaw("type",$.type),$.type==="hello"){if($.jwt!==void 0)_.string("jwt",$.jwt)}else if($.type==="request")_.number("request_id",$.requestId),_.object("request",$.request,eH);else throw b($,"Impossible type of ClientMsg")}function eH(_,$){if(_.stringRaw("type",$.type),$.type==="open_stream")_.number("stream_id",$.streamId);else if($.type==="close_stream")_.number("stream_id",$.streamId);else if($.type==="execute")_.number("stream_id",$.streamId),_.object("stmt",$.stmt,m_);else if($.type==="batch")_.number("stream_id",$.streamId),_.object("batch",$.batch,b2);else if($.type==="open_cursor")_.number("stream_id",$.streamId),_.number("cursor_id",$.cursorId),_.object("batch",$.batch,b2);else if($.type==="close_cursor")_.number("cursor_id",$.cursorId);else if($.type==="fetch_cursor")_.number("cursor_id",$.cursorId),_.number("max_count",$.maxCount);else if($.type==="sequence"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit")_.number("stream_id",$.streamId);else throw b($,"Impossible type of Request")}function u_(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId);for(let X of $.args)_.message(3,X,l$);for(let X of $.namedArgs)_.message(4,X,_F);_.bool(5,$.wantRows)}function _F(_,$){_.string(1,$.name),_.message(2,$.value,l$)}function g2(_,$){for(let X of $.steps)_.message(1,X,$F)}function $F(_,$){if($.condition!==void 0)_.message(1,$.condition,P4);_.message(2,$.stmt,u_)}function P4(_,$){if($.type==="ok")_.uint32(1,$.step);else if($.type==="error")_.uint32(2,$.step);else if($.type==="not")_.message(3,$.cond,P4);else if($.type==="and")_.message(4,$.conds,c$);else if($.type==="or")_.message(5,$.conds,c$);else if($.type==="is_autocommit")_.message(6,void 0,i$);else throw b($,"Impossible type of BatchCond")}function c$(_,$){for(let X of $)_.message(1,X,P4)}function l$(_,$){if($===null)_.message(1,void 0,i$);else if(typeof $==="bigint")_.sint64(2,$);else if(typeof $==="number")_.double(3,$);else if(typeof $==="string")_.string(4,$);else if($ instanceof Uint8Array)_.bytes(5,$);else if($===void 0);else throw b($,"Impossible type of Value")}function i$(_,$){}function n$(_,$){if($.type==="hello")_.message(1,$,XF);else if($.type==="request")_.message(2,$,ZF);else throw b($,"Impossible type of ClientMsg")}function XF(_,$){if($.jwt!==void 0)_.string(1,$.jwt)}function ZF(_,$){_.int32(1,$.requestId);let X=$.request;if(X.type==="open_stream")_.message(2,X,JF);else if(X.type==="close_stream")_.message(3,X,GF);else if(X.type==="execute")_.message(4,X,YF);else if(X.type==="batch")_.message(5,X,zF);else if(X.type==="open_cursor")_.message(6,X,HF);else if(X.type==="close_cursor")_.message(7,X,FF);else if(X.type==="fetch_cursor")_.message(8,X,WF);else if(X.type==="sequence")_.message(9,X,UF);else if(X.type==="describe")_.message(10,X,AF);else if(X.type==="store_sql")_.message(11,X,KF);else if(X.type==="close_sql")_.message(12,X,DF);else if(X.type==="get_autocommit")_.message(13,X,OF);else throw b(X,"Impossible type of Request")}function JF(_,$){_.int32(1,$.streamId)}function GF(_,$){_.int32(1,$.streamId)}function YF(_,$){_.int32(1,$.streamId),_.message(2,$.stmt,u_)}function zF(_,$){_.int32(1,$.streamId),_.message(2,$.batch,g2)}function HF(_,$){_.int32(1,$.streamId),_.int32(2,$.cursorId),_.message(3,$.batch,g2)}function FF(_,$){_.int32(1,$.cursorId)}function WF(_,$){_.int32(1,$.cursorId),_.uint32(2,$.maxCount)}function UF(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function AF(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function KF(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function DF(_,$){_.int32(1,$.sqlId)}function OF(_,$){_.int32(1,$.streamId)}function b1(_){let $=L0(_.message),X=q0(_.code);return{message:$,code:X}}function d_(_){let $=s0(_.cols,o$),X=S_(_.rows).map((Y)=>s0(Y,s$)),Z=B1(_.affected_row_count),J=q0(_.last_insert_rowid),G=J!==void 0?BigInt(J):void 0;return{cols:$,rows:X,affectedRowCount:Z,lastInsertRowid:G}}function o$(_){let $=q0(_.name),X=q0(_.decltype);return{name:$,decltype:X}}function d6(_){let $=new Map;S_(_.step_results).forEach((Z,J)=>{if(Z!==null)$.set(J,d_(G0(Z)))});let X=new Map;return S_(_.step_errors).forEach((Z,J)=>{if(Z!==null)X.set(J,b1(G0(Z)))}),{stepResults:$,stepErrors:X}}function c6(_){let $=L0(_.type);if($==="step_begin"){let X=B1(_.step),Z=s0(_.cols,o$);return{type:"step_begin",step:X,cols:Z}}else if($==="step_end"){let X=B1(_.affected_row_count),Z=q0(_.last_insert_rowid),J=Z!==void 0?BigInt(Z):void 0;return{type:"step_end",affectedRowCount:X,lastInsertRowid:J}}else if($==="step_error"){let X=B1(_.step),Z=b1(G0(_.error));return{type:"step_error",step:X,error:Z}}else if($==="row")return{type:"row",row:s0(_.row,s$)};else if($==="error")return{type:"error",error:b1(G0(_.error))};else throw new T("Unexpected type of CursorEntry")}function l6(_){let $=s0(_.params,RF),X=s0(_.cols,VF),Z=v1(_.is_explain),J=v1(_.is_readonly);return{params:$,cols:X,isExplain:Z,isReadonly:J}}function RF(_){return{name:q0(_.name)}}function VF(_){let $=L0(_.name),X=q0(_.decltype);return{name:$,decltype:X}}function s$(_){let $=L0(_.type);if($==="null")return null;else if($==="integer"){let X=L0(_.value);return BigInt(X)}else if($==="float")return B1(_.value);else if($==="text")return L0(_.value);else if($==="blob")return I2.toUint8Array(L0(_.base64));else throw new T("Unexpected type of Value")}function r$(_){let $=L0(_.type);if($==="hello_ok")return{type:"hello_ok"};else if($==="hello_error")return{type:"hello_error",error:b1(G0(_.error))};else if($==="response_ok"){let X=B1(_.request_id),Z=NF(G0(_.response));return{type:"response_ok",requestId:X,response:Z}}else if($==="response_error"){let X=B1(_.request_id),Z=b1(G0(_.error));return{type:"response_error",requestId:X,error:Z}}else throw new T("Unexpected type of ServerMsg")}function NF(_){let $=L0(_.type);if($==="open_stream")return{type:"open_stream"};else if($==="close_stream")return{type:"close_stream"};else if($==="execute")return{type:"execute",result:d_(G0(_.result))};else if($==="batch")return{type:"batch",result:d6(G0(_.result))};else if($==="open_cursor")return{type:"open_cursor"};else if($==="close_cursor")return{type:"close_cursor"};else if($==="fetch_cursor"){let X=s0(_.entries,c6),Z=v1(_.done);return{type:"fetch_cursor",entries:X,done:Z}}else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:l6(G0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:v1(_.is_autocommit)};else throw new T("Unexpected type of Response")}var u0={default(){return{message:"",code:void 0}},1(_,$){$.message=_.string()},2(_,$){$.code=_.string()}},g1={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.cols.push(_.message(a$))},2(_,$){$.rows.push(_.message(t$))},3(_,$){$.affectedRowCount=Number(_.uint64())},4(_,$){$.lastInsertRowid=_.sint64()}},a$={default(){return{name:void 0,decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},t$={default(){return[]},1(_,$){$.push(_.message(LF))}},p2={default(){return{stepResults:new Map,stepErrors:new Map}},1(_,$){let[X,Z]=_.message(MF);$.stepResults.set(X,Z)},2(_,$){let[X,Z]=_.message(BF);$.stepErrors.set(X,Z)}},MF={default(){return[0,g1.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(g1)}},BF={default(){return[0,u0.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(u0)}},i6={default(){return{type:"none"}},1(_){return _.message(IF)},2(_){return _.message(QF)},3(_){return _.message(EF)},4(_){return{type:"row",row:_.message(t$)}},5(_){return{type:"error",error:_.message(u0)}}},IF={default(){return{type:"step_begin",step:0,cols:[]}},1(_,$){$.step=_.uint32()},2(_,$){$.cols.push(_.message(a$))}},QF={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.affectedRowCount=_.uint32()},2(_,$){$.lastInsertRowid=_.uint64()}},EF={default(){return{type:"step_error",step:0,error:u0.default()}},1(_,$){$.step=_.uint32()},2(_,$){$.error=_.message(u0)}},m2={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(_,$){$.params.push(_.message(jF))},2(_,$){$.cols.push(_.message(TF))},3(_,$){$.isExplain=_.bool()},4(_,$){$.isReadonly=_.bool()}},jF={default(){return{name:void 0}},1(_,$){$.name=_.string()}},TF={default(){return{name:"",decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},LF={default(){return},1(_){return null},2(_){return _.sint64()},3(_){return _.double()},4(_){return _.string()},5(_){return _.bytes()}};var e$={default(){return{type:"none"}},1(_){return{type:"hello_ok"}},2(_){return _.message(wF)},3(_){return _.message(xF)},4(_){return _.message(PF)}},wF={default(){return{type:"hello_error",error:u0.default()}},1(_,$){$.error=_.message(u0)}},PF={default(){return{type:"response_error",requestId:0,error:u0.default()}},1(_,$){$.requestId=_.int32()},2(_,$){$.error=_.message(u0)}},xF={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(_,$){$.requestId=_.int32()},2(_,$){$.response={type:"open_stream"}},3(_,$){$.response={type:"close_stream"}},4(_,$){$.response=_.message(qF)},5(_,$){$.response=_.message(CF)},6(_,$){$.response={type:"open_cursor"}},7(_,$){$.response={type:"close_cursor"}},8(_,$){$.response=_.message(SF)},9(_,$){$.response={type:"sequence"}},10(_,$){$.response=_.message(kF)},11(_,$){$.response={type:"store_sql"}},12(_,$){$.response={type:"close_sql"}},13(_,$){$.response=_.message(vF)}},qF={default(){return{type:"execute",result:g1.default()}},1(_,$){$.result=_.message(g1)}},CF={default(){return{type:"batch",result:p2.default()}},1(_,$){$.result=_.message(p2)}},SF={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(_,$){$.entries.push(_.message(i6))},2(_,$){$.done=_.bool()}},kF={default(){return{type:"describe",result:m2.default()}},1(_,$){$.result=_.message(m2)}},vF={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}};var _X=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),x4=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class n6 extends k2{#_;#$;#X;#Z;#J;#G;#Y;#z;#H;_streamIdAlloc;_cursorIdAlloc;#W;constructor(_,$){super();this.#_=_,this.#$=[],this.#X=!1,this.#Z=void 0,this.#J=!1,this.#G=void 0,this.#Y=!1,this.#z=new Map,this.#H=new y1,this._streamIdAlloc=new y1,this._cursorIdAlloc=new y1,this.#W=new y1,this.#_.binaryType="arraybuffer",this.#_.addEventListener("open",()=>this.#K()),this.#_.addEventListener("close",(X)=>this.#O(X)),this.#_.addEventListener("error",(X)=>this.#D(X)),this.#_.addEventListener("message",(X)=>this.#R(X)),this.#A({type:"hello",jwt:$})}#A(_){if(this.#Z!==void 0)throw new V0("Trying to send a message on a closed client");if(this.#X)this.#U(_);else{let $=()=>this.#U(_),X=()=>{return};this.#$.push({openCallback:$,errorCallback:X})}}#K(){let _=this.#_.protocol;if(_===void 0){this.#F(new m("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(_==="")this.#G={version:1,encoding:"json"};else if(this.#G=x4.get(_),this.#G===void 0){this.#F(new T(`Unrecognized WebSocket subprotocol: ${JSON.stringify(_)}`));return}for(let $ of this.#$)$.openCallback();this.#$.length=0,this.#X=!0}#U(_){let $=this.#G.encoding;if($==="json"){let X=k_(_,d$);this.#_.send(X)}else if($==="protobuf"){let X=y_(_,n$);this.#_.send(X)}else throw b($,"Impossible encoding")}getVersion(){return new Promise((_,$)=>{if(this.#Y=!0,this.#Z!==void 0)$(this.#Z);else if(!this.#X){let X=()=>_(this.#G.version);this.#$.push({openCallback:X,errorCallback:$})}else _(this.#G.version)})}_ensureVersion(_,$){if(this.#G===void 0||!this.#Y)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this.#G.version<_)throw new o0(`${$} is supported on protocol version ${_} and higher, but the WebSocket server only supports version ${this.#G.version}`)}_sendRequest(_,$){if(this.#Z!==void 0){$.errorCallback(new X0("Client is closed",this.#Z));return}let X=this.#H.alloc();this.#z.set(X,{...$,type:_.type}),this.#A({type:"request",requestId:X,request:_})}#D(_){let X=_.message??"WebSocket was closed due to an error";this.#F(new v2(X))}#O(_){let $=`WebSocket was closed with code ${_.code}`;if(_.reason)$+=`: ${_.reason}`;this.#F(new v2($))}#F(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of this.#$)$.errorCallback(_);this.#$.length=0;for(let[$,X]of this.#z.entries())X.errorCallback(_),this.#H.free($);this.#z.clear(),this.#_.close()}#R(_){if(this.#Z!==void 0)return;try{let $,X=this.#G.encoding;if(X==="json"){if(typeof _.data!=="string"){this.#_.close(3003,"Only text messages are accepted with JSON encoding"),this.#F(new T("Received non-text message from server with JSON encoding"));return}$=$2(JSON.parse(_.data),r$)}else if(X==="protobuf"){if(!(_.data instanceof ArrayBuffer)){this.#_.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#F(new T("Received non-binary message from server with Protobuf encoding"));return}$=h1(new Uint8Array(_.data),e$)}else throw b(X,"Impossible encoding");this.#V($)}catch($){this.#_.close(3007,"Could not handle message"),this.#F($)}}#V(_){if(_.type==="none")throw new T("Received an unrecognized ServerMsg");else if(_.type==="hello_ok"||_.type==="hello_error"){if(this.#J)throw new T("Received a duplicated hello response");if(this.#J=!0,_.type==="hello_error")throw I1(_.error);return}else if(!this.#J)throw new T("Received a non-hello message before a hello response");if(_.type==="response_ok"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new T("Received unexpected OK response");this.#H.free($);try{if(X.type!==_.response.type)throw console.dir({responseState:X,msg:_}),new T("Received unexpected type of response");X.responseCallback(_.response)}catch(Z){throw X.errorCallback(Z),Z}}else if(_.type==="response_error"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new T("Received unexpected error response");this.#H.free($),X.errorCallback(I1(_.error))}else throw b(_,"Impossible ServerMsg type")}openStream(){return p_.open(this)}storeSql(_){this._ensureVersion(2,"storeSql()");let $=this.#W.alloc(),X=new J2(this,$),Z=()=>{return},J=(Y)=>X._setClosed(Y),G={type:"store_sql",sqlId:$,sql:_};return this._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}_closeSql(_){if(this.#Z!==void 0)return;let $=()=>this.#W.free(_),X=(J)=>this.#F(J),Z={type:"close_sql",sqlId:_};this._sendRequest(Z,{responseCallback:$,errorCallback:X})}close(){this.#F(new m("Client was manually closed"))}get closed(){return this.#Z!==void 0}}var c_=Request,q4=Headers,C4=fetch;var G2;if(typeof queueMicrotask<"u")G2=queueMicrotask;else{let _=Promise.resolve();G2=($)=>{_.then($)}}class S4{#_;#$;#X;constructor(_){this.#_=new Uint8Array(new ArrayBuffer(_)),this.#$=0,this.#X=0}get length(){return this.#X-this.#$}data(){return this.#_.slice(this.#$,this.#X)}push(_){this.#Z(_.byteLength),this.#_.set(_,this.#X),this.#X+=_.byteLength}#Z(_){if(this.#X+_<=this.#_.byteLength)return;let $=this.#X-this.#$;if($+_<=this.#_.byteLength&&2*this.#X>=this.#_.byteLength)this.#_.copyWithin(0,this.#$,this.#X);else{let X=this.#_.byteLength;do X*=2;while($+_>X);let Z=new Uint8Array(new ArrayBuffer(X));Z.set(this.#_.slice(this.#$,this.#X),0),this.#_=Z}this.#X=$,this.#$=0}shift(_){this.#$+=_}}function $X(_){let $=q0(_.baton),X=q0(_.base_url),Z=s0(_.results,hF);return{baton:$,baseUrl:X,results:Z}}function hF(_){let $=L0(_.type);if($==="ok")return{type:"ok",response:yF(G0(_.response))};else if($==="error")return{type:"error",error:b1(G0(_.error))};else throw new T("Unexpected type of StreamResult")}function yF(_){let $=L0(_.type);if($==="close")return{type:"close"};else if($==="execute")return{type:"execute",result:d_(G0(_.result))};else if($==="batch")return{type:"batch",result:d6(G0(_.result))};else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:l6(G0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:v1(_.is_autocommit)};else throw new T("Unexpected type of StreamResponse")}function XX(_){let $=q0(_.baton),X=q0(_.base_url);return{baton:$,baseUrl:X}}var ZX={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()},3(_,$){$.results.push(_.message(fF))}},fF={default(){return{type:"none"}},1(_){return{type:"ok",response:_.message(bF)}},2(_){return{type:"error",error:_.message(u0)}}},bF={default(){return{type:"none"}},1(_){return{type:"close"}},2(_){return _.message(gF)},3(_){return _.message(pF)},4(_){return{type:"sequence"}},5(_){return _.message(mF)},6(_){return{type:"store_sql"}},7(_){return{type:"close_sql"}},8(_){return _.message(uF)}},gF={default(){return{type:"execute",result:g1.default()}},1(_,$){$.result=_.message(g1)}},pF={default(){return{type:"batch",result:p2.default()}},1(_,$){$.result=_.message(p2)}},mF={default(){return{type:"describe",result:m2.default()}},1(_,$){$.result=_.message(m2)}},uF={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}},JX={default(){return{baton:void 0,baseUrl:void 0}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()}};class k4 extends g_{#_;#$;#X;#Z;#J;#G;constructor(_,$){super();this.#_=_,this.#$=$,this.#X=void 0,this.#Z=new S4(16384),this.#J=void 0,this.#G=!1}async open(_){if(_.body===null)throw new T("No response body for cursor request");this.#X=_.body.getReader();let $=await this.#Y(XX,JX);if($===void 0)throw new T("Empty response to cursor request");return $}next(){return this.#Y(c6,i6)}close(){this._setClosed(new m("Cursor was manually closed"))}_setClosed(_){if(this.#J!==void 0)return;if(this.#J=_,this.#_._cursorClosed(this),this.#X!==void 0)this.#X.cancel()}get closed(){return this.#J!==void 0}async#Y(_,$){for(;;){if(this.#G)return;else if(this.#J!==void 0)throw new X0("Cursor is closed",this.#J);if(this.#$==="json"){let J=this.#z();if(J!==void 0){let G=new TextDecoder().decode(J),Y=JSON.parse(G);return $2(Y,_)}}else if(this.#$==="protobuf"){let J=this.#H();if(J!==void 0)return h1(J,$)}else throw b(this.#$,"Impossible encoding");if(this.#X===void 0)throw new V0("Attempted to read from HTTP cursor before it was opened");let{value:X,done:Z}=await this.#X.read();if(Z&&this.#Z.length===0)this.#G=!0;else if(Z)throw new T("Unexpected end of cursor stream");else this.#Z.push(X)}}#z(){let _=this.#Z.data(),$=10,X=_.indexOf(10);if(X<0)return;let Z=_.slice(0,X);return this.#Z.shift(X+1),Z}#H(){let _=this.#Z.data(),$=0,X=0;for(;;){if(X>=_.byteLength)return;let J=_[X];if($|=(J&127)<<7*X,X+=1,!(J&128))break}if(_.byteLength<X+$)return;let Z=_.slice(X,X+$);return this.#Z.shift(X+$),Z}}function GX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.arrayObjects("requests",$.requests,dF)}function dF(_,$){if(_.stringRaw("type",$.type),$.type==="close");else if($.type==="execute")_.object("stmt",$.stmt,m_);else if($.type==="batch")_.object("batch",$.batch,b2);else if($.type==="sequence"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit");else throw b($,"Impossible type of StreamRequest")}function YX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.object("batch",$.batch,b2)}function zX(_,$){if($.baton!==void 0)_.string(1,$.baton);for(let X of $.requests)_.message(2,X,cF)}function cF(_,$){if($.type==="close")_.message(1,$,lF);else if($.type==="execute")_.message(2,$,iF);else if($.type==="batch")_.message(3,$,nF);else if($.type==="sequence")_.message(4,$,oF);else if($.type==="describe")_.message(5,$,sF);else if($.type==="store_sql")_.message(6,$,rF);else if($.type==="close_sql")_.message(7,$,aF);else if($.type==="get_autocommit")_.message(8,$,tF);else throw b($,"Impossible type of StreamRequest")}function lF(_,$){}function iF(_,$){_.message(1,$.stmt,u_)}function nF(_,$){_.message(1,$.batch,g2)}function oF(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function sF(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function rF(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function aF(_,$){_.int32(1,$.sqlId)}function tF(_,$){}function HX(_,$){if($.baton!==void 0)_.string(1,$.baton);_.message(2,$.batch,g2)}class o6 extends f2{#_;#$;#X;#Z;#J;#G;#Y;#z;#H;#W;#A;#K;constructor(_,$,X,Z){super(_.intMode);this.#_=_,this.#$=$.toString(),this.#X=X,this.#Z=Z,this.#J=void 0,this.#G=new f1,this.#Y=!1,this.#H=!1,this.#W=!1,this.#A=void 0,this.#K=new y1}client(){return this.#_}_sqlOwner(){return this}storeSql(_){let $=this.#K.alloc();return this.#U({type:"store_sql",sqlId:$,sql:_}).then(()=>{return},(X)=>this._setClosed(X)),new J2(this,$)}_closeSql(_){if(this.#A!==void 0)return;this.#U({type:"close_sql",sqlId:_}).then(()=>this.#K.free(_),($)=>this._setClosed($))}_execute(_){return this.#U({type:"execute",stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#U({type:"batch",batch:_}).then(($)=>{return $.result})}_describe(_){return this.#U({type:"describe",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#U({type:"sequence",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#U({type:"get_autocommit"}).then((_)=>{return _.isAutocommit})}#U(_){return new Promise(($,X)=>{this.#D({type:"pipeline",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return new Promise(($,X)=>{this.#D({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_cursorClosed(_){if(_!==this.#z)throw new V0("Cursor was closed, but it was not associated with the stream");this.#z=void 0,G2(()=>this.#O())}close(){this._setClosed(new m("Stream was manually closed"))}closeGracefully(){this.#H=!0,G2(()=>this.#O())}get closed(){return this.#A!==void 0||this.#H}_setClosed(_){if(this.#A!==void 0)return;if(this.#A=_,this.#z!==void 0)this.#z._setClosed(_);this.#_._streamClosed(this);for(;;){let $=this.#G.shift();if($!==void 0)$.errorCallback(_);else break}if((this.#J!==void 0||this.#Y)&&!this.#W)this.#G.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#W=!0,G2(()=>this.#O())}#D(_){if(this.#A!==void 0)throw new X0("Stream is closed",this.#A);else if(this.#H)throw new X0("Stream is closing",void 0);else this.#G.push(_),G2(()=>this.#O())}#O(){if(this.#Y||this.#z!==void 0)return;if(this.#H&&this.#G.length===0){this._setClosed(new m("Stream was gracefully closed"));return}let _=this.#_._endpoint;if(_===void 0){this.#_._endpointPromise.then(()=>this.#O(),(X)=>this._setClosed(X));return}let $=this.#G.shift();if($===void 0)return;else if($.type==="pipeline"){let X=[$];for(;;){let Z=this.#G.first();if(Z!==void 0&&Z.type==="pipeline")X.push(Z),this.#G.shift();else if(Z===void 0&&this.#H&&!this.#W){X.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#W=!0;break}else break}this.#F(_,X)}else if($.type==="cursor")this.#R(_,$);else throw b($,"Impossible type of QueueEntry")}#F(_,$){this.#V(()=>this.#M($,_),(X)=>_W(X,_.encoding),(X)=>X.baton,(X)=>X.baseUrl,(X)=>eF($,X),(X)=>$.forEach((Z)=>Z.errorCallback(X)))}#R(_,$){let X=new k4(this,_.encoding);this.#z=X,this.#V(()=>this.#B($,_),(Z)=>X.open(Z),(Z)=>Z.baton,(Z)=>Z.baseUrl,(Z)=>$.cursorCallback(X),(Z)=>$.errorCallback(Z))}#V(_,$,X,Z,J,G){let Y;try{let z=_(),H=this.#Z;Y=H(z)}catch(z){Y=Promise.reject(z)}this.#Y=!0,Y.then((z)=>{if(!z.ok)return $W(z).then((H)=>{throw H});return $(z)}).then((z)=>{this.#J=X(z),this.#$=Z(z)??this.#$,J(z)}).catch((z)=>{this._setClosed(z),G(z)}).finally(()=>{this.#Y=!1,this.#O()})}#M(_,$){return this.#N(new URL($.pipelinePath,this.#$),{baton:this.#J,requests:_.map((X)=>X.request)},$.encoding,GX,zX)}#B(_,$){if($.cursorPath===void 0)throw new o0(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${$.version}.`);return this.#N(new URL($.cursorPath,this.#$),{baton:this.#J,batch:_.batch},$.encoding,YX,HX)}#N(_,$,X,Z,J){let G,Y;if(X==="json")G=k_($,Z),Y="application/json";else if(X==="protobuf")G=y_($,J),Y="application/x-protobuf";else throw b(X,"Impossible encoding");let z=new q4;if(z.set("content-type",Y),this.#X!==void 0)z.set("authorization",`Bearer ${this.#X}`);return new c_(_.toString(),{method:"POST",headers:z,body:G})}}function eF(_,$){if($.results.length!==_.length)throw new T("Server returned unexpected number of pipeline results");for(let X=0;X<_.length;++X){let Z=$.results[X],J=_[X];if(Z.type==="ok"){if(Z.response.type!==J.request.type)throw new T("Received unexpected type of response");J.responseCallback(Z.response)}else if(Z.type==="error")J.errorCallback(I1(Z.error));else if(Z.type==="none")throw new T("Received unrecognized type of StreamResult");else throw b(Z,"Received impossible type of StreamResult")}}async function _W(_,$){if($==="json"){let X=await _.json();return $2(X,$X)}if($==="protobuf"){let X=await _.arrayBuffer();return h1(new Uint8Array(X),ZX)}throw await _.body?.cancel(),b($,"Impossible encoding")}async function $W(_){let $=_.headers.get("content-type")??"text/plain",X=`Server returned HTTP status ${_.status}`;if($==="application/json"){let Z=await _.json();if("message"in Z)return I1(Z);return new _2(X,_.status)}if($==="text/plain"){let Z=(await _.text()).trim();if(Z!=="")X+=`: ${Z}`;return new _2(X,_.status)}return await _.body?.cancel(),new _2(X,_.status)}var XW=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],v4={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class s6 extends k2{#_;#$;#X;#Z;#J;_endpointPromise;_endpoint;constructor(_,$,X,Z=2){super();if(this.#_=_,this.#$=$,this.#X=X??C4,this.#Z=void 0,this.#J=new Set,Z==3)this._endpointPromise=ZW(this.#X,this.#_),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J));else this._endpointPromise=Promise.resolve(v4),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J))}async getVersion(){if(this._endpoint!==void 0)return this._endpoint.version;return(await this._endpointPromise).version}_ensureVersion(_,$){if(_<=v4.version)return;else if(this._endpoint===void 0)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this._endpoint.version<_)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}openStream(){if(this.#Z!==void 0)throw new X0("Client is closed",this.#Z);let _=new o6(this,this.#_,this.#$,this.#X);return this.#J.add(_),_}_streamClosed(_){this.#J.delete(_)}close(){this.#G(new m("Client was manually closed"))}get closed(){return this.#Z!==void 0}#G(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of Array.from(this.#J))$._setClosed(new X0("Client was closed",_))}}async function ZW(_,$){let X=_;for(let Z of XW){let J=new URL(Z.versionPath,$),G=new c_(J.toString(),{method:"GET"}),Y=await X(G);if(await Y.arrayBuffer(),Y.ok)return Z}return v4}function h4(_,$,X=2){if(typeof S2.default>"u")throw new C_("WebSockets are not supported in this environment");var Z=void 0;if(X==3)Z=Array.from(x4.keys());else Z=Array.from(_X.keys());let J=new S2.default(_,Z);return new n6(J,$)}function y4(_,$,X,Z=2){return new s6(_ instanceof URL?_:new URL(_),$,X,Z)}class l_{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}execute(_){return this.batch([_]).then(($)=>$[0])}async batch(_){let $=this._getStream();if($.closed)throw new P("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let X=_.map(Q1),Z;if(this.#X===void 0){this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=G.step(),z=Y.run(P1(this.#_)),H=Y;Z=X.map((F)=>{let W=G.step().condition(a.ok(H));if(this.#$>=3)W.condition(a.not(a.isAutocommit(G)));let A=W.query(F);return A.catch(()=>{return}),H=W,A}),this.#X=G.execute().then(()=>z).then(()=>{return});try{await this.#X}catch(F){throw this.close(),F}}else{if(this.#$<3)await this.#X;this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=void 0;Z=X.map((z)=>{let H=G.step();if(Y!==void 0)H.condition(a.ok(Y));if(this.#$>=3)H.condition(a.not(a.isAutocommit(G)));let F=H.query(z);return F.catch(()=>{return}),Y=H,F}),await G.execute()}let J=[];for(let G of Z){let Y=await G;if(Y===void 0)throw new P("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");J.push(d2(Y))}return J}catch(X){throw _0(X)}}async executeMultiple(_){let $=this._getStream();if($.closed)throw new P("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#X===void 0){this.#X=$.run(P1(this.#_)).then(()=>{return});try{await this.#X}catch(X){throw this.close(),X}}else await this.#X;await $.sequence(_)}catch(X){throw _0(X)}}async rollback(){try{let _=this._getStream();if(_.closed)return;if(this.#X!==void 0);else return;let $=_.run("ROLLBACK").catch((X)=>{throw _0(X)});_.closeGracefully(),await $}catch(_){throw _0(_)}finally{this.close()}}async commit(){try{let _=this._getStream();if(_.closed)throw new P("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#X!==void 0)await this.#X;else return;let $=_.run("COMMIT").catch((X)=>{throw _0(X)});_.closeGracefully(),await $}catch(_){throw _0(_)}finally{this.close()}}}async function u2(_,$,X,Z,J=!1){if(J)X.step().run("PRAGMA foreign_keys=off");let G=X.step(),Y=G.run(P1(_)),z=G,H=Z.map((R)=>{let O=X.step().condition(a.ok(z));if($>=3)O.condition(a.not(a.isAutocommit(X)));let N=O.query(R);return z=O,N}),F=X.step().condition(a.ok(z));if($>=3)F.condition(a.not(a.isAutocommit(X)));let W=F.run("COMMIT");if(X.step().condition(a.not(a.ok(F))).run("ROLLBACK").catch((R)=>{return}),J)X.step().run("PRAGMA foreign_keys=on");await X.execute();let D=[];await Y;for(let R of H){let O=await R;if(O===void 0)throw new P("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");D.push(d2(O))}return await W,D}function Q1(_){let $,X;if(Array.isArray(_))[$,X]=_;else if(typeof _==="string")$=_;else $=_.sql,X=_.args;let Z=new b_($);if(X)if(Array.isArray(X))Z.bindIndexes(X);else for(let[J,G]of Object.entries(X))Z.bindName(J,G);return Z}function d2(_){let $=_.columnNames.map((Y)=>Y??""),X=_.columnDecltypes.map((Y)=>Y??""),Z=_.rows,J=_.affectedRowCount,G=_.lastInsertRowid!==void 0?_.lastInsertRowid:void 0;return new Q2($,X,Z,J,G)}function _0(_){if(_ instanceof m){let $=FX(_);return new P(_.message,$,void 0,_)}return _}function FX(_){if(_ instanceof q_&&_.code!==void 0)return _.code;else if(_ instanceof T)return"HRANA_PROTO_ERROR";else if(_ instanceof X0)return _.cause instanceof m?FX(_.cause):"HRANA_CLOSED_ERROR";else if(_ instanceof v2)return"HRANA_WEBSOCKET_ERROR";else if(_ instanceof _2)return"SERVER_ERROR";else if(_ instanceof o0)return"PROTOCOL_VERSION_ERROR";else if(_ instanceof V0)return"INTERNAL_ERROR";else return"UNKNOWN"}class c2{#_;#$;capacity;constructor(_,$){this.#_=_,this.#$=new WX,this.capacity=$}apply(_){if(this.capacity<=0)return;let $=new Set;for(let X of _){if(typeof X.sql!=="string")continue;let Z=X.sql;if(Z.length>=5000)continue;let J=this.#$.get(Z);if(J===void 0){while(this.#$.size+1>this.capacity){let[G,Y]=this.#$.peekLru();if($.has(Y))break;Y.close(),this.#$.delete(G)}if(this.#$.size+1<=this.capacity)J=this.#_.storeSql(Z),this.#$.set(Z,J)}if(J!==void 0)X.sql=J,$.add(J)}}}class WX{#_;constructor(){this.#_=new Map}get(_){let $=this.#_.get(_);if($!==void 0)this.#_.delete(_),this.#_.set(_,$);return $}set(_,$){this.#_.set(_,$)}peekLru(){for(let _ of this.#_.entries())return _;return}delete(_){this.#_.delete(_)}get size(){return this.#_.size}}var DX=j0(b4(),1);function OX(_){if(_.scheme!=="wss"&&_.scheme!=="ws")throw new P(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new P("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="ws"&&_.tls)throw new P('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="wss"&&!_.tls)throw new P('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=N_(_.scheme,_.authority,_.path),X;try{X=h4($,_.authToken)}catch(Z){if(Z instanceof C_){let J=_.scheme==="wss"?"https":"http",G=N_(J,_.authority,_.path);throw new P(`This environment does not support WebSockets, please switch to the HTTP client by using a "${J}:" URL (${JSON.stringify(G)}). For more information, please read ${J1}`,"WEBSOCKETS_NOT_SUPPORTED")}throw _0(Z)}return new RX(X,$,_.authToken,_.intMode,_.concurrency)}var YW=60000,KX=100;class RX{#_;#$;#X;#Z;#J;closed;protocol;#G;#Y;constructor(_,$,X,Z,J){this.#_=$,this.#$=X,this.#X=Z,this.#Z=this.#H(_),this.#J=void 0,this.closed=!1,this.protocol="ws",this.#Y=DX.default(J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{let Z=await this.#z();try{let J=Q1(X);Z.conn.sqlCache.apply([J]);let G=Z.stream.query(J);Z.stream.closeGracefully();let Y=await G;return d2(Y)}catch(J){throw _0(J)}finally{this._closeStream(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{let X=await this.#z();try{let J=_.map((F)=>{if(Array.isArray(F))return{sql:F[0],args:F[1]||[]};return F}).map(Q1),G=await X.conn.client.getVersion();X.conn.sqlCache.apply(J);let Y=X.stream.batch(G>=3);return await u2($,G,Y,J)}catch(Z){throw _0(Z)}finally{this._closeStream(X)}})}async migrate(_){return this.limit(async()=>{let $=await this.#z();try{let X=_.map(Q1),Z=await $.conn.client.getVersion(),J=$.stream.batch(Z>=3);return await u2("deferred",Z,J,X,!0)}catch(X){throw _0(X)}finally{this._closeStream($)}})}async transaction(_="write"){return this.limit(async()=>{let $=await this.#z();try{let X=await $.conn.client.getVersion();return new VX(this,$,_,X)}catch(X){throw this._closeStream($),_0(X)}})}async executeMultiple(_){return this.limit(async()=>{let $=await this.#z();try{let X=$.stream.sequence(_);$.stream.closeGracefully(),await X}catch(X){throw _0(X)}finally{this._closeStream($)}})}sync(){throw new P("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async#z(){if(this.closed)throw new P("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#Z.openTime.valueOf()>YW&&this.#J===void 0){let Z=this.#H();this.#J=Z,Z.client.getVersion().then((J)=>{if(this.#Z!==Z){if(this.#Z.streamStates.size===0)this.#Z.client.close()}this.#Z=Z,this.#J=void 0},(J)=>{this.#J=void 0})}if(this.#Z.client.closed)try{if(this.#J!==void 0)this.#Z=this.#J;else this.#Z=this.#H()}catch(Z){throw _0(Z)}let X=this.#Z;try{if(X.useSqlCache===void 0){if(X.useSqlCache=await X.client.getVersion()>=2,X.useSqlCache)X.sqlCache.capacity=KX}let Z=X.client.openStream();Z.intMode=this.#X;let J={conn:X,stream:Z};return X.streamStates.add(J),J}catch(Z){throw _0(Z)}}#H(_){try{return _??=h4(this.#_,this.#$),{client:_,useSqlCache:void 0,sqlCache:new c2(_,0),openTime:new Date,streamStates:new Set}}catch($){throw _0($)}}async reconnect(){try{for(let X of Array.from(this.#Z.streamStates))try{X.stream.close()}catch{}this.#Z.client.close()}catch{}if(this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}let _=this.#H(),$=await _.client.getVersion();if(_.useSqlCache=$>=2,_.useSqlCache)_.sqlCache.capacity=KX;this.#Z=_,this.closed=!1}_closeStream(_){_.stream.close();let $=_.conn;if($.streamStates.delete(_),$.streamStates.size===0&&$!==this.#Z)$.client.close()}close(){if(this.#Z.client.close(),this.closed=!0,this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}this.closed=!0}}class VX extends l_{#_;#$;constructor(_,$,X,Z){super(X,Z);this.#_=_,this.#$=$}_getStream(){return this.#$.stream}_getSqlCache(){return this.#$.conn.sqlCache}close(){this.#_._closeStream(this.#$)}get closed(){return this.#$.stream.closed}}var NX=j0(b4(),1);function MX(_){if(_.scheme!=="https"&&_.scheme!=="http")throw new P(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new P("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="http"&&_.tls)throw new P('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="https"&&!_.tls)throw new P('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=N_(_.scheme,_.authority,_.path);return new IX($,_.authToken,_.intMode,_.fetch,_.concurrency)}var BX=30;class IX{#_;protocol;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X,Z,J){this.#$=_,this.#G=$,this.#X=X,this.#Z=Z,this.#J=J,this.#_=y4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X,this.protocol="http",this.#Y=NX.default(this.#J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{try{let Z=Q1(X),J,G=this.#_.openStream();try{J=G.query(Z)}finally{G.closeGracefully()}let Y=await J;return d2(Y)}catch(Z){throw _0(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{try{let Z=_.map((H)=>{if(Array.isArray(H))return{sql:H[0],args:H[1]||[]};return H}).map(Q1),J=await this.#_.getVersion(),G,Y=this.#_.openStream();try{new c2(Y,BX).apply(Z);let F=Y.batch(!1);G=u2($,J,F,Z)}finally{Y.closeGracefully()}return await G}catch(X){throw _0(X)}})}async migrate(_){return this.limit(async()=>{try{let $=_.map(Q1),X=await this.#_.getVersion(),Z,J=this.#_.openStream();try{let Y=J.batch(!1);Z=u2("deferred",X,Y,$,!0)}finally{J.closeGracefully()}return await Z}catch($){throw _0($)}})}async transaction(_="write"){return this.limit(async()=>{try{let $=await this.#_.getVersion();return new QX(this.#_.openStream(),_,$)}catch($){throw _0($)}})}async executeMultiple(_){return this.limit(async()=>{try{let $,X=this.#_.openStream();try{$=X.sequence(_)}finally{X.closeGracefully()}await $}catch($){throw _0($)}})}sync(){throw new P("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#_.close()}async reconnect(){try{if(!this.closed)this.#_.close()}finally{this.#_=y4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X}}get closed(){return this.#_.closed}}class QX extends l_{#_;#$;constructor(_,$,X){super($,X);this.#_=_,this.#$=new c2(_,BX)}_getStream(){return this.#_}_getSqlCache(){return this.#$}close(){this.#_.close()}get closed(){return this.#_.closed}}function p1(_){return zW(B_(_,!0))}function zW(_){if(_.scheme==="wss"||_.scheme==="ws")return OX(_);else if(_.scheme==="https"||_.scheme==="http")return MX(_);else return w9(_)}class Y0{static[K]="SelectionProxyHandler";config;constructor(_){this.config={..._}}get(_,$){if($==="_")return{..._._,selectedFields:new Proxy(_._.selectedFields,this)};if($===r)return{..._[r],selectedFields:new Proxy(_[r].selectedFields,this)};if(typeof $==="symbol")return _[$];let Z=(V(_,Z0)?_._.selectedFields:V(_,f0)?_[r].selectedFields:_)[$];if(V(Z,Q.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!Z.isSelectionField)return Z.sql;let J=Z.clone();return J.isSelectionField=!0,J}if(V(Z,Q)){if(this.config.sqlBehavior==="sql")return Z;throw Error(`You tried to reference "${$}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}if(V(Z,p)){if(this.config.alias)return new Proxy(Z,new V2(new Proxy(Z.table,new U_(this.config.alias,this.config.replaceOriginalName??!1))));return Z}if(typeof Z!=="object"||Z===null)return Z;return new Proxy(Z,new Y0(this.config))}}class g4{static[K]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(_,$){if(this.reference=()=>{let{name:X,columns:Z,foreignColumns:J}=_();return{name:X,columns:Z,foreignTable:J[0].table,foreignColumns:J}},$)this._onUpdate=$.onUpdate,this._onDelete=$.onDelete}onUpdate(_){return this._onUpdate=_,this}onDelete(_){return this._onDelete=_,this}build(_){return new EX(_,this)}}class EX{constructor(_,$){this.table=_,this.reference=$.reference,this.onUpdate=$._onUpdate,this.onDelete=$._onDelete}static[K]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:_,columns:$,foreignColumns:X}=this.reference(),Z=$.map((Y)=>Y.name),J=X.map((Y)=>Y.name),G=[this.table[w0],...Z,X[0].table[w0],...J];return _??`${G.join("_")}_fk`}}function jX(_,$){return`${_[w0]}_${$.join("_")}_unique`}class U0 extends u8{static[K]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(_,$={}){return this.foreignKeyConfigs.push({ref:_,actions:$}),this}unique(_){return this.config.isUnique=!0,this.config.uniqueName=_,this}generatedAlwaysAs(_,$){return this.config.generated={as:_,type:"always",mode:$?.mode??"virtual"},this}buildForeignKeys(_,$){return this.foreignKeyConfigs.map(({ref:X,actions:Z})=>{return((J,G)=>{let Y=new g4(()=>{let z=J();return{columns:[_],foreignColumns:[z]}});if(G.onUpdate)Y.onUpdate(G.onUpdate);if(G.onDelete)Y.onDelete(G.onDelete);return Y.build($)})(X,Z)})}}class $0 extends p{constructor(_,$){if(!$.uniqueName)$.uniqueName=jX(_,[$.name]);super(_,$);this.table=_}static[K]="SQLiteColumn"}class TX extends U0{static[K]="SQLiteBigIntBuilder";constructor(_){super(_,"bigint","SQLiteBigInt")}build(_){return new LX(_,this.config)}}class LX extends $0{static[K]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return BigInt($.toString("utf8"))}return BigInt(e8.decode(_))}mapToDriverValue(_){return Buffer.from(_.toString())}}class wX extends U0{static[K]="SQLiteBlobJsonBuilder";constructor(_){super(_,"json","SQLiteBlobJson")}build(_){return new PX(_,this.config)}}class PX extends $0{static[K]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return JSON.parse($.toString("utf8"))}return JSON.parse(e8.decode(_))}mapToDriverValue(_){return Buffer.from(JSON.stringify(_))}}class xX extends U0{static[K]="SQLiteBlobBufferBuilder";constructor(_){super(_,"buffer","SQLiteBlobBuffer")}build(_){return new qX(_,this.config)}}class qX extends $0{static[K]="SQLiteBlobBuffer";mapFromDriverValue(_){if(Buffer.isBuffer(_))return _;return Buffer.from(_)}getSQLType(){return"blob"}}function CX(_,$){let{name:X,config:Z}=X1(_,$);if(Z?.mode==="json")return new wX(X);if(Z?.mode==="bigint")return new TX(X);return new xX(X)}class SX extends U0{static[K]="SQLiteCustomColumnBuilder";constructor(_,$,X){super(_,"custom","SQLiteCustomColumn");this.config.fieldConfig=$,this.config.customTypeParams=X}build(_){return new kX(_,this.config)}}class kX extends $0{static[K]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(_,$){super(_,$);this.sqlName=$.customTypeParams.dataType($.fieldConfig),this.mapTo=$.customTypeParams.toDriver,this.mapFrom=$.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(_){return typeof this.mapFrom==="function"?this.mapFrom(_):_}mapToDriverValue(_){return typeof this.mapTo==="function"?this.mapTo(_):_}}function vX(_){return($,X)=>{let{name:Z,config:J}=X1($,X);return new SX(Z,J,_)}}class r6 extends U0{static[K]="SQLiteBaseIntegerBuilder";constructor(_,$,X){super(_,$,X);this.config.autoIncrement=!1}primaryKey(_){if(_?.autoIncrement)this.config.autoIncrement=!0;return this.config.hasDefault=!0,super.primaryKey()}}class a6 extends $0{static[K]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class hX extends r6{static[K]="SQLiteIntegerBuilder";constructor(_){super(_,"number","SQLiteInteger")}build(_){return new yX(_,this.config)}}class yX extends a6{static[K]="SQLiteInteger"}class fX extends r6{static[K]="SQLiteTimestampBuilder";constructor(_,$){super(_,"date","SQLiteTimestamp");this.config.mode=$}defaultNow(){return this.default(U`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(_){return new bX(_,this.config)}}class bX extends a6{static[K]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(_){if(this.config.mode==="timestamp")return new Date(_*1000);return new Date(_)}mapToDriverValue(_){let $=_.getTime();if(this.config.mode==="timestamp")return Math.floor($/1000);return $}}class gX extends r6{static[K]="SQLiteBooleanBuilder";constructor(_,$){super(_,"boolean","SQLiteBoolean");this.config.mode=$}build(_){return new pX(_,this.config)}}class pX extends a6{static[K]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(_){return Number(_)===1}mapToDriverValue(_){return _?1:0}}function C0(_,$){let{name:X,config:Z}=X1(_,$);if(Z?.mode==="timestamp"||Z?.mode==="timestamp_ms")return new fX(X,Z.mode);if(Z?.mode==="boolean")return new gX(X,Z.mode);return new hX(X)}class mX extends U0{static[K]="SQLiteNumericBuilder";constructor(_){super(_,"string","SQLiteNumeric")}build(_){return new uX(_,this.config)}}class uX extends $0{static[K]="SQLiteNumeric";mapFromDriverValue(_){if(typeof _==="string")return _;return String(_)}getSQLType(){return"numeric"}}class dX extends U0{static[K]="SQLiteNumericNumberBuilder";constructor(_){super(_,"number","SQLiteNumericNumber")}build(_){return new cX(_,this.config)}}class cX extends $0{static[K]="SQLiteNumericNumber";mapFromDriverValue(_){if(typeof _==="number")return _;return Number(_)}mapToDriverValue=String;getSQLType(){return"numeric"}}class lX extends U0{static[K]="SQLiteNumericBigIntBuilder";constructor(_){super(_,"bigint","SQLiteNumericBigInt")}build(_){return new iX(_,this.config)}}class iX extends $0{static[K]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function nX(_,$){let{name:X,config:Z}=X1(_,$),J=Z?.mode;return J==="number"?new dX(X):J==="bigint"?new lX(X):new mX(X)}class oX extends U0{static[K]="SQLiteRealBuilder";constructor(_){super(_,"number","SQLiteReal")}build(_){return new sX(_,this.config)}}class sX extends $0{static[K]="SQLiteReal";getSQLType(){return"real"}}function F1(_){return new oX(_??"")}class rX extends U0{static[K]="SQLiteTextBuilder";constructor(_,$){super(_,"string","SQLiteText");this.config.enumValues=$.enum,this.config.length=$.length}build(_){return new aX(_,this.config)}}class aX extends $0{static[K]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(_,$){super(_,$)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class tX extends U0{static[K]="SQLiteTextJsonBuilder";constructor(_){super(_,"json","SQLiteTextJson")}build(_){return new eX(_,this.config)}}class eX extends $0{static[K]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(_){return JSON.parse(_)}mapToDriverValue(_){return JSON.stringify(_)}}function k(_,$={}){let{name:X,config:Z}=X1(_,$);if(Z.mode==="json")return new tX(X);return new rX(X,Z)}function _Z(){return{blob:CX,customType:vX,integer:C0,numeric:nX,real:F1,text:k}}var p4=Symbol.for("drizzle:SQLiteInlineForeignKeys");class z0 extends B{static[K]="SQLiteTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:p4});[B.Symbol.Columns];[p4]=[];[B.Symbol.ExtraConfigBuilder]=void 0}function HW(_,$,X,Z,J=_){let G=new z0(_,Z,J),Y=typeof $==="function"?$(_Z()):$,z=Object.fromEntries(Object.entries(Y).map(([F,W])=>{let A=W;A.setName(F);let D=A.build(G);return G[p4].push(...A.buildForeignKeys(D,G)),[F,D]})),H=Object.assign(G,z);if(H[B.Symbol.Columns]=z,H[B.Symbol.ExtraConfigColumns]=z,X)H[z0.Symbol.ExtraConfigBuilder]=X;return H}var Q0=(_,$,X)=>{return HW(_,$,X)};class $Z{constructor(_,$){this.name=_,this.unique=$}static[K]="SQLiteIndexBuilderOn";on(..._){return new XZ(this.name,_,this.unique)}}class XZ{static[K]="SQLiteIndexBuilder";config;constructor(_,$,X){this.config={name:_,columns:$,unique:X,where:void 0}}where(_){return this.config.where=_,this}build(_){return new ZZ(this.config,_)}}class ZZ{static[K]="SQLiteIndex";config;constructor(_,$){this.config={..._,table:$}}}function O0(_){return new $Z(_,!1)}function l2(..._){if(_[0].columns)return new m4(_[0].columns,_[0].name);return new m4(_)}class m4{static[K]="SQLitePrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new JZ(_,this.columns,this.name)}}class JZ{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[K]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[z0.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function r0(_){if(V(_,z0))return[`${_[B.Symbol.BaseName]}`];if(V(_,Z0))return _._.usedTables??[];if(V(_,Q))return _.usedTables??[];return[]}class t6 extends I0{constructor(_,$,X,Z){super();this.table=_,this.session=$,this.dialect=X,this.config={table:_,withList:Z}}static[K]="SQLiteDelete";config;where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.table[z0.Symbol.Columns]){return this.config.returning=b0(_),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:r0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(_){return this._prepare().execute(_)}$dynamic(){return this}}function FW(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map((X)=>X.toLowerCase()).join("_")}function WW(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((X,Z,J)=>{let G=J===0?Z.toLowerCase():`${Z[0].toUpperCase()}${Z.slice(1)}`;return X+G},"")}function UW(_){return _}class u4{static[K]="CasingCache";cache={};cachedTables={};convert;constructor(_){this.convert=_==="snake_case"?FW:_==="camelCase"?WW:UW}getColumnCasing(_){if(!_.keyAsName)return _.name;let $=_.table[B.Symbol.Schema]??"public",X=_.table[B.Symbol.OriginalName],Z=`${$}.${X}.${_.name}`;if(!this.cache[Z])this.cacheTable(_.table);return this.cache[Z]}cacheTable(_){let $=_[B.Symbol.Schema]??"public",X=_[B.Symbol.OriginalName],Z=`${$}.${X}`;if(!this.cachedTables[Z]){for(let J of Object.values(_[B.Symbol.Columns])){let G=`${Z}.${J.name}`;this.cache[G]=this.convert(J.name)}this.cachedTables[Z]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class Y2 extends f0{static[K]="SQLiteViewBase"}class i2{static[K]="SQLiteDialect";casing;constructor(_){this.casing=new u4(_?.casing)}escapeName(_){return`"${_}"`}escapeParam(_){return"?"}escapeString(_){return`'${_.replace(/'/g,"''")}'`}buildWithCTE(_){if(!_?.length)return;let $=[U`with `];for(let[X,Z]of _.entries())if($.push(U`${U.identifier(Z._.alias)} as (${Z._.sql})`),X<_.length-1)$.push(U`, `);return $.push(U` `),U.join($)}buildDeleteQuery({table:_,where:$,returning:X,withList:Z,limit:J,orderBy:G}){let Y=this.buildWithCTE(Z),z=X?U` returning ${this.buildSelection(X,{isSingleTable:!0})}`:void 0,H=$?U` where ${$}`:void 0,F=this.buildOrderBy(G),W=this.buildLimit(J);return U`${Y}delete from ${_}${H}${z}${F}${W}`}buildUpdateSet(_,$){let X=_[B.Symbol.Columns],Z=Object.keys(X).filter((G)=>$[G]!==void 0||X[G]?.onUpdateFn!==void 0),J=Z.length;return U.join(Z.flatMap((G,Y)=>{let z=X[G],H=$[G]??U.param(z.onUpdateFn(),z),F=U`${U.identifier(this.casing.getColumnCasing(z))} = ${H}`;if(Y<J-1)return[F,U.raw(", ")];return[F]}))}buildUpdateQuery({table:_,set:$,where:X,returning:Z,withList:J,joins:G,from:Y,limit:z,orderBy:H}){let F=this.buildWithCTE(J),W=this.buildUpdateSet(_,$),A=Y&&U.join([U.raw(" from "),this.buildFromTable(Y)]),D=this.buildJoins(G),R=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,O=X?U` where ${X}`:void 0,N=this.buildOrderBy(H),I=this.buildLimit(z);return U`${F}update ${_} set ${W}${A}${D}${O}${R}${N}${I}`}buildSelection(_,{isSingleTable:$=!1}={}){let X=_.length,Z=_.flatMap(({field:J},G)=>{let Y=[];if(V(J,Q.Aliased)&&J.isSelectionField)Y.push(U.identifier(J.fieldAlias));else if(V(J,Q.Aliased)||V(J,Q)){let z=V(J,Q.Aliased)?J.sql:J;if($)Y.push(new Q(z.queryChunks.map((H)=>{if(V(H,p))return U.identifier(this.casing.getColumnCasing(H));return H})));else Y.push(z);if(V(J,Q.Aliased))Y.push(U` as ${U.identifier(J.fieldAlias)}`)}else if(V(J,p)){let z=J.table[B.Symbol.Name];if(J.columnType==="SQLiteNumericBigInt")if($)Y.push(U`cast(${U.identifier(this.casing.getColumnCasing(J))} as text)`);else Y.push(U`cast(${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))} as text)`);else if($)Y.push(U.identifier(this.casing.getColumnCasing(J)));else Y.push(U`${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))}`)}if(G<X-1)Y.push(U`, `);return Y});return U.join(Z)}buildJoins(_){if(!_||_.length===0)return;let $=[];if(_)for(let[X,Z]of _.entries()){if(X===0)$.push(U` `);let J=Z.table,G=Z.on?U` on ${Z.on}`:void 0;if(V(J,z0)){let Y=J[z0.Symbol.Name],z=J[z0.Symbol.Schema],H=J[z0.Symbol.OriginalName],F=Y===H?void 0:Z.alias;$.push(U`${U.raw(Z.joinType)} join ${z?U`${U.identifier(z)}.`:void 0}${U.identifier(H)}${F&&U` ${U.identifier(F)}`}${G}`)}else $.push(U`${U.raw(Z.joinType)} join ${J}${G}`);if(X<_.length-1)$.push(U` `)}return U.join($)}buildLimit(_){return typeof _==="object"||typeof _==="number"&&_>=0?U` limit ${_}`:void 0}buildOrderBy(_){let $=[];if(_){for(let[X,Z]of _.entries())if($.push(Z),X<_.length-1)$.push(U`, `)}return $.length>0?U` order by ${U.join($)}`:void 0}buildFromTable(_){if(V(_,B)&&_[B.Symbol.IsAlias])return U`${U`${U.identifier(_[B.Symbol.Schema]??"")}.`.if(_[B.Symbol.Schema])}${U.identifier(_[B.Symbol.OriginalName])} ${U.identifier(_[B.Symbol.Name])}`;return _}buildSelectQuery({withList:_,fields:$,fieldsFlat:X,where:Z,having:J,table:G,joins:Y,orderBy:z,groupBy:H,limit:F,offset:W,distinct:A,setOperators:D}){let R=X??b0($);for(let c0 of R)if(V(c0.field,p)&&T1(c0.field.table)!==(V(G,Z0)?G._.alias:V(G,Y2)?G[r].name:V(G,Q)?void 0:T1(G))&&!((e0)=>Y?.some(({alias:_6})=>_6===(e0[B.Symbol.IsAlias]?T1(e0):e0[B.Symbol.BaseName])))(c0.field.table)){let e0=T1(c0.field.table);throw Error(`Your "${c0.path.join("->")}" field references a column "${e0}"."${c0.field.name}", but the table "${e0}" is not part of the query! Did you forget to join it?`)}let O=!Y||Y.length===0,N=this.buildWithCTE(_),I=A?U` distinct`:void 0,j=this.buildSelection(R,{isSingleTable:O}),w=this.buildFromTable(G),q=this.buildJoins(Y),t=Z?U` where ${Z}`:void 0,u=J?U` having ${J}`:void 0,E=[];if(H){for(let[c0,e0]of H.entries())if(E.push(e0),c0<H.length-1)E.push(U`, `)}let g=E.length>0?U` group by ${U.join(E)}`:void 0,v0=this.buildOrderBy(z),j1=this.buildLimit(F),e2=W?U` offset ${W}`:void 0,U2=U`${N}select${I} ${j} from ${w}${q}${t}${g}${u}${v0}${j1}${e2}`;if(D.length>0)return this.buildSetOperations(U2,D);return U2}buildSetOperations(_,$){let[X,...Z]=$;if(!X)throw Error("Cannot pass undefined values to any set operator");if(Z.length===0)return this.buildSetOperationQuery({leftSelect:_,setOperator:X});return this.buildSetOperations(this.buildSetOperationQuery({leftSelect:_,setOperator:X}),Z)}buildSetOperationQuery({leftSelect:_,setOperator:{type:$,isAll:X,rightSelect:Z,limit:J,orderBy:G,offset:Y}}){let z=U`${_.getSQL()} `,H=U`${Z.getSQL()}`,F;if(G&&G.length>0){let R=[];for(let O of G)if(V(O,$0))R.push(U.identifier(O.name));else if(V(O,Q)){for(let N=0;N<O.queryChunks.length;N++){let I=O.queryChunks[N];if(V(I,$0))O.queryChunks[N]=U.identifier(this.casing.getColumnCasing(I))}R.push(U`${O}`)}else R.push(U`${O}`);F=U` order by ${U.join(R,U`, `)}`}let W=typeof J==="object"||typeof J==="number"&&J>=0?U` limit ${J}`:void 0,A=U.raw(`${$} ${X?"all ":""}`),D=Y?U` offset ${Y}`:void 0;return U`${z}${A}${H}${F}${W}${D}`}buildInsertQuery({table:_,values:$,onConflict:X,returning:Z,withList:J,select:G}){let Y=[],z=_[B.Symbol.Columns],H=Object.entries(z).filter(([O,N])=>!N.shouldDisableInsert()),F=H.map(([,O])=>U.identifier(this.casing.getColumnCasing(O)));if(G){let O=$;if(V(O,Q))Y.push(O);else Y.push(O.getSQL())}else{let O=$;Y.push(U.raw("values "));for(let[N,I]of O.entries()){let j=[];for(let[w,q]of H){let t=I[w];if(t===void 0||V(t,P0)&&t.value===void 0){let u;if(q.default!==null&&q.default!==void 0)u=V(q.default,Q)?q.default:U.param(q.default,q);else if(q.defaultFn!==void 0){let E=q.defaultFn();u=V(E,Q)?E:U.param(E,q)}else if(!q.default&&q.onUpdateFn!==void 0){let E=q.onUpdateFn();u=V(E,Q)?E:U.param(E,q)}else u=U`null`;j.push(u)}else j.push(t)}if(Y.push(j),N<O.length-1)Y.push(U`, `)}}let W=this.buildWithCTE(J),A=U.join(Y),D=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,R=X?.length?U.join(X):void 0;return U`${W}insert into ${_} ${F} ${A}${R}${D}`}sqlToQuery(_,$){return _.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:$})}buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:Z,tableConfig:J,queryConfig:G,tableAlias:Y,nestedQueryRelation:z,joinOn:H}){let F=[],W,A,D=[],R,O=[];if(G===!0)F=Object.entries(J.columns).map(([j,w])=>({dbKey:w.name,tsKey:j,field:$1(w,Y),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let I=Object.fromEntries(Object.entries(J.columns).map(([E,g])=>[E,$1(g,Y)]));if(G.where){let E=typeof G.where==="function"?G.where(I,V7()):G.where;R=E&&A_(E,Y)}let j=[],w=[];if(G.columns){let E=!1;for(let[g,v0]of Object.entries(G.columns)){if(v0===void 0)continue;if(g in J.columns){if(!E&&v0===!0)E=!0;w.push(g)}}if(w.length>0)w=E?w.filter((g)=>G.columns?.[g]===!0):Object.keys(J.columns).filter((g)=>!w.includes(g))}else w=Object.keys(J.columns);for(let E of w){let g=J.columns[E];j.push({tsKey:E,value:g})}let q=[];if(G.with)q=Object.entries(G.with).filter((E)=>!!E[1]).map(([E,g])=>({tsKey:E,queryConfig:g,relation:J.relations[E]}));let t;if(G.extras){t=typeof G.extras==="function"?G.extras(I,{sql:U}):G.extras;for(let[E,g]of Object.entries(t))j.push({tsKey:E,value:o8(g,Y)})}for(let{tsKey:E,value:g}of j)F.push({dbKey:V(g,Q.Aliased)?g.fieldAlias:J.columns[E].name,tsKey:E,field:V(g,p)?$1(g,Y):g,relationTableTsKey:void 0,isJson:!1,selection:[]});let u=typeof G.orderBy==="function"?G.orderBy(I,N7()):G.orderBy??[];if(!Array.isArray(u))u=[u];D=u.map((E)=>{if(V(E,p))return $1(E,Y);return A_(E,Y)}),W=G.limit,A=G.offset;for(let{tsKey:E,queryConfig:g,relation:v0}of q){let j1=B7($,X,v0),e2=i1(v0.referencedTable),U2=X[e2],c0=`${Y}_${E}`,e0=K0(...j1.fields.map((_J,$J)=>L($1(j1.references[$J],c0),$1(_J,Y)))),_6=this.buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:_[U2],tableConfig:$[U2],queryConfig:V(v0,w1)?g===!0?{limit:1}:{...g,limit:1}:g,tableAlias:c0,joinOn:e0,nestedQueryRelation:v0}),eZ=U`(${_6.sql})`.as(E);F.push({dbKey:E,tsKey:E,field:eZ,relationTableTsKey:U2,isJson:!0,selection:_6.selection})}}if(F.length===0)throw new N2({message:`No fields selected for table "${J.tsName}" ("${Y}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let N;if(R=K0(H,R),z){let I=U`json_array(${U.join(F.map(({field:q})=>V(q,$0)?U.identifier(this.casing.getColumnCasing(q)):V(q,Q.Aliased)?q.sql:q),U`, `)})`;if(V(z,R_))I=U`coalesce(json_group_array(${I}), json_array())`;let j=[{dbKey:"data",tsKey:"data",field:I.as("data"),isJson:!0,relationTableTsKey:J.tsName,selection:F}];if(W!==void 0||A!==void 0||D.length>0)N=this.buildSelectQuery({table:V6(Z,Y),fields:{},fieldsFlat:[{path:[],field:U.raw("*")}],where:R,limit:W,offset:A,orderBy:D,setOperators:[]}),R=void 0,W=void 0,A=void 0,D=void 0;else N=V6(Z,Y);N=this.buildSelectQuery({table:V(N,z0)?N:new Z0(N,{},Y),fields:{},fieldsFlat:j.map(({field:q})=>({path:[],field:V(q,p)?$1(q,Y):q})),joins:O,where:R,limit:W,offset:A,orderBy:D,setOperators:[]})}else N=this.buildSelectQuery({table:V6(Z,Y),fields:{},fieldsFlat:F.map(({field:I})=>({path:[],field:V(I,p)?$1(I,Y):I})),joins:O,where:R,limit:W,offset:A,orderBy:D,setOperators:[]});return{tableTsKey:J.tsName,sql:N,selection:F}}}class d4 extends i2{static[K]="SQLiteSyncDialect";migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;$.run(J);let Y=$.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;$.run(U`BEGIN`);try{for(let z of _)if(!Y||Number(Y[2])<z.folderMillis){for(let H of z.sql)$.run(U.raw(H));$.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${z.hash}, ${z.folderMillis})`)}$.run(U`COMMIT`)}catch(z){throw $.run(U`ROLLBACK`),z}}}class c4 extends i2{static[K]="SQLiteAsyncDialect";async migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await $.run(J);let Y=(await $.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await $.transaction(async(z)=>{for(let H of _)if(!Y||Number(Y[2])<H.folderMillis){for(let F of H.sql)await z.run(U.raw(F));await z.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${H.hash}, ${H.folderMillis})`)}})}}class l4{static[K]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class a0{static[K]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(_){this.fields=_.fields,this.session=_.session,this.dialect=_.dialect,this.withList=_.withList,this.distinct=_.distinct}from(_){let $=!!this.fields,X;if(this.fields)X=this.fields;else if(V(_,Z0))X=Object.fromEntries(Object.keys(_._.selectedFields).map((Z)=>[Z,_[Z]]));else if(V(_,Y2))X=_[r].selectedFields;else if(V(_,Q))X={};else X=n3(_);return new i4({table:_,fields:X,isPartialSelect:$,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class GZ extends l4{static[K]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:_,fields:$,isPartialSelect:X,session:Z,dialect:J,withList:G,distinct:Y}){super();this.config={withList:G,table:_,fields:{...$},distinct:Y,setOperators:[]},this.isPartialSelect=X,this.session=Z,this.dialect=J,this._={selectedFields:$,config:this.config},this.tableName=D_(_),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{};for(let z of r0(_))this.usedTables.add(z)}getUsedTables(){return[...this.usedTables]}createJoin(_){return($,X)=>{let Z=this.tableName,J=D_($);for(let G of r0($))this.usedTables.add(G);if(typeof J==="string"&&this.config.joins?.some((G)=>G.alias===J))throw Error(`Alias "${J}" is already used in this query`);if(!this.isPartialSelect){if(Object.keys(this.joinsNotNullableMap).length===1&&typeof Z==="string")this.config.fields={[Z]:this.config.fields};if(typeof J==="string"&&!V($,Q)){let G=V($,Z0)?$._.selectedFields:V($,f0)?$[r].selectedFields:$[B.Symbol.Columns];this.config.fields[J]=G}}if(typeof X==="function")X=X(new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));if(!this.config.joins)this.config.joins=[];if(this.config.joins.push({on:X,table:$,joinType:_,alias:J}),typeof J==="string")switch(_){case"left":{this.joinsNotNullableMap[J]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[J]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(_,$){return(X)=>{let Z=typeof X==="function"?X(AW()):X;if(!K_(this.getSelectedFields(),Z.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:_,isAll:$,rightSelect:Z}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(_){return this.config.setOperators.push(..._),this}where(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.where=_,this}having(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.having=_,this}groupBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray($)?$:[$]}else this.config.groupBy=_;return this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=X;else this.config.orderBy=X}else{let $=_;if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=$;else this.config.orderBy=$}return this}limit(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).limit=_;else this.config.limit=_;return this}offset(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).offset=_;else this.config.offset=_;return this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}as(_){let $=[];if($.push(...r0(this.config.table)),this.config.joins)for(let X of this.config.joins)$.push(...r0(X.table));return new Proxy(new Z0(this.getSQL(),this.config.fields,_,!1,[...new Set($)]),new Y0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Y0({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class i4 extends GZ{static[K]="SQLiteSelect";_prepare(_=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let $=b0(this.config.fields),X=this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),$,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return X.joinsNotNullableMap=this.joinsNotNullableMap,X}$withCache(_){return this.cacheConfig=_===void 0?{config:{},enable:!0,autoInvalidate:!0}:_===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,..._},this}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.all()}}i3(i4,[I0]);function e6(_,$){return(X,Z,...J)=>{let G=[Z,...J].map((Y)=>({type:_,isAll:$,rightSelect:Y}));for(let Y of G)if(!K_(X.getSelectedFields(),Y.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return X.addSetOperators(G)}}var AW=()=>({union:KW,unionAll:DW,intersect:OW,except:RW}),KW=e6("union",!1),DW=e6("union",!0),OW=e6("intersect",!1),RW=e6("except",!1);class i_{static[K]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(_){this.dialect=V(_,i2)?_:void 0,this.dialectConfig=V(_,i2)?void 0:_}$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(X);return new Proxy(new H_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new Y0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};with(..._){let $=this;function X(J){return new a0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_})}function Z(J){return new a0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_,distinct:!0})}return{select:X,selectDistinct:Z}}select(_){return new a0({fields:_??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(_){return new a0({fields:_??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){if(!this.dialect)this.dialect=new d4(this.dialectConfig);return this.dialect}}class _8{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[K]="SQLiteInsertBuilder";values(_){if(_=Array.isArray(_)?_:[_],_.length===0)throw Error("values() must be called with at least one value");let $=_.map((X)=>{let Z={},J=this.table[B.Symbol.Columns];for(let G of Object.keys(X)){let Y=X[G];Z[G]=V(Y,Q)?Y:new P0(Y,J[G])}return Z});return new n4(this.table,$,this.session,this.dialect,this.withList)}select(_){let $=typeof _==="function"?_(new i_):_;if(!V($,Q)&&!K_(this.table[O6],$._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new n4(this.table,$,this.session,this.dialect,this.withList,!0)}}class n4 extends I0{constructor(_,$,X,Z,J,G){super();this.session=X,this.dialect=Z,this.config={table:_,values:$,withList:J,select:G}}static[K]="SQLiteInsert";config;returning(_=this.config.table[z0.Symbol.Columns]){return this.config.returning=b0(_),this}onConflictDoNothing(_={}){if(!this.config.onConflict)this.config.onConflict=[];if(_.target===void 0)this.config.onConflict.push(U` on conflict do nothing`);else{let $=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,X=_.where?U` where ${_.where}`:U``;this.config.onConflict.push(U` on conflict ${$} do nothing${X}`)}return this}onConflictDoUpdate(_){if(_.where&&(_.targetWhere||_.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');if(!this.config.onConflict)this.config.onConflict=[];let $=_.where?U` where ${_.where}`:void 0,X=_.targetWhere?U` where ${_.targetWhere}`:void 0,Z=_.setWhere?U` where ${_.setWhere}`:void 0,J=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,G=this.dialect.buildUpdateSet(this.config.table,N6(this.config.table,_.set));return this.config.onConflict.push(U` on conflict ${J}${X} do update set ${G}${$}${Z}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:r0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class $8{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[K]="SQLiteUpdateBuilder";set(_){return new YZ(this.table,N6(this.table,_),this.session,this.dialect,this.withList)}}class YZ extends I0{constructor(_,$,X,Z,J){super();this.session=X,this.dialect=Z,this.config={set:$,table:_,withList:J,joins:[]}}static[K]="SQLiteUpdate";config;from(_){return this.config.from=_,this}createJoin(_){return($,X)=>{let Z=D_($);if(typeof Z==="string"&&this.config.joins.some((J)=>J.alias===Z))throw Error(`Alias "${Z}" is already used in this query`);if(typeof X==="function"){let J=this.config.from?V($,z0)?$[B.Symbol.Columns]:V($,Z0)?$._.selectedFields:V($,Y2)?$[r].selectedFields:void 0:void 0;X=X(new Proxy(this.config.table[B.Symbol.Columns],new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),J&&new Proxy(J,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:X,table:$,joinType:_,alias:Z}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.config.table[z0.Symbol.Columns]){return this.config.returning=b0(_),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:r0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class n_ extends Q{constructor(_){super(n_.buildEmbeddedCount(_.source,_.filters).queryChunks);this.params=_,this.session=_.session,this.sql=n_.buildCount(_.source,_.filters)}sql;static[K]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(_,$){return U`(select count(*) from ${_}${U.raw(" where ").if($)}${$})`}static buildCount(_,$){return U`select count(*) from ${_}${U.raw(" where ").if($)}${$}`}then(_,$){return Promise.resolve(this.session.count(this.sql)).then(_,$)}catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}}class s4{constructor(_,$,X,Z,J,G,Y,z){this.mode=_,this.fullSchema=$,this.schema=X,this.tableNamesMap=Z,this.table=J,this.tableConfig=G,this.dialect=Y,this.session=z}static[K]="SQLiteAsyncRelationalQueryBuilder";findMany(_){return this.mode==="sync"?new o4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many"):new X8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many")}findFirst(_){return this.mode==="sync"?new o4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first"):new X8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first")}}class X8 extends I0{constructor(_,$,X,Z,J,G,Y,z,H){super();this.fullSchema=_,this.schema=$,this.tableNamesMap=X,this.table=Z,this.tableConfig=J,this.dialect=G,this.session=Y,this.config=z,this.mode=H}static[K]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(_=!1){let{query:$,builtQuery:X}=this._toSQL();return this.session[_?"prepareOneTimeQuery":"prepareQuery"](X,void 0,this.mode==="first"?"get":"all",!0,(Z,J)=>{let G=Z.map((Y)=>M6(this.schema,this.tableConfig,Y,$.selection,J));if(this.mode==="first")return G[0];return G})}prepare(){return this._prepare(!1)}_toSQL(){let _=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),$=this.dialect.sqlToQuery(_.sql);return{query:_,builtQuery:$}}toSQL(){return this._toSQL().builtQuery}executeRaw(){if(this.mode==="first")return this._prepare(!1).get();return this._prepare(!1).all()}async execute(){return this.executeRaw()}}class o4 extends X8{static[K]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class n2 extends I0{constructor(_,$,X,Z,J){super();this.execute=_,this.getSQL=$,this.dialect=Z,this.mapBatchResult=J,this.config={action:X}}static[K]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(_,$){return $?this.mapBatchResult(_):_}_prepare(){return this}isResponseInArrayMode(){return!1}}class o_{constructor(_,$,X,Z){this.resultKind=_,this.dialect=$,this.session=X,this._=Z?{schema:Z.schema,fullSchema:Z.fullSchema,tableNamesMap:Z.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let J=this.query;if(this._.schema)for(let[G,Y]of Object.entries(this._.schema))J[G]=new s4(_,Z.fullSchema,this._.schema,this._.tableNamesMap,Z.fullSchema[G],Y,$,X);this.$cache={invalidate:async(G)=>{}}}static[K]="BaseSQLiteDatabase";query;$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(new i_(X.dialect));return new Proxy(new H_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new Y0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};$count(_,$){return new n_({source:_,filters:$,session:this.session})}with(..._){let $=this;function X(z){return new a0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_})}function Z(z){return new a0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_,distinct:!0})}function J(z){return new $8(z,$.session,$.dialect,_)}function G(z){return new _8(z,$.session,$.dialect,_)}function Y(z){return new t6(z,$.session,$.dialect,_)}return{select:X,selectDistinct:Z,update:J,insert:G,delete:Y}}select(_){return new a0({fields:_??void 0,session:this.session,dialect:this.dialect})}selectDistinct(_){return new a0({fields:_??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(_){return new $8(_,this.session,this.dialect)}$cache;insert(_){return new _8(_,this.session,this.dialect)}delete(_){return new t6(_,this.session,this.dialect)}run(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new n2(async()=>this.session.run($),()=>$,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session));return this.session.run($)}all(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new n2(async()=>this.session.all($),()=>$,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session));return this.session.all($)}get(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new n2(async()=>this.session.get($),()=>$,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session));return this.session.get($)}values(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new n2(async()=>this.session.values($),()=>$,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session));return this.session.values($)}transaction(_,$){return this.session.transaction(_,$)}}class zZ{static[K]="Cache"}class s_ extends zZ{strategy(){return"all"}static[K]="NoopCache";async get(_){return}async put(_,$,X,Z){}async onMutate(_){}}async function r4(_,$){let X=`${_}-${JSON.stringify($)}`,J=new TextEncoder().encode(X),G=await crypto.subtle.digest("SHA-256",J);return[...new Uint8Array(G)].map((H)=>H.toString(16).padStart(2,"0")).join("")}class HZ extends I0{constructor(_){super();this.resultCb=_}static[K]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class a4{constructor(_,$,X,Z,J,G){if(this.mode=_,this.executeMethod=$,this.query=X,this.cache=Z,this.queryMetadata=J,this.cacheConfig=G,Z&&Z.strategy()==="all"&&G===void 0)this.cacheConfig={enable:!0,autoInvalidate:!0};if(!this.cacheConfig?.enable)this.cacheConfig=void 0}static[K]="PreparedQuery";joinsNotNullableMap;async queryWithCache(_,$,X){if(this.cache===void 0||V(this.cache,s_)||this.queryMetadata===void 0)try{return await X()}catch(Z){throw new O1(_,$,Z)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await X()}catch(Z){throw new O1(_,$,Z)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[Z]=await Promise.all([X(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return Z}catch(Z){throw new O1(_,$,Z)}if(!this.cacheConfig)try{return await X()}catch(Z){throw new O1(_,$,Z)}if(this.queryMetadata.type==="select"){let Z=await this.cache.get(this.cacheConfig.tag??await r4(_,$),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(Z===void 0){let J;try{J=await X()}catch(G){throw new O1(_,$,G)}return await this.cache.put(this.cacheConfig.tag??await r4(_,$),J,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),J}return Z}try{return await X()}catch(Z){throw new O1(_,$,Z)}}getQuery(){return this.query}mapRunResult(_,$){return _}mapAllResult(_,$){throw Error("Not implemented")}mapGetResult(_,$){throw Error("Not implemented")}execute(_){if(this.mode==="async")return this[this.executeMethod](_);return new HZ(()=>this[this.executeMethod](_))}mapResult(_,$){switch(this.executeMethod){case"run":return this.mapRunResult(_,$);case"all":return this.mapAllResult(_,$);case"get":return this.mapGetResult(_,$)}}}class t4{constructor(_){this.dialect=_}static[K]="SQLiteSession";prepareOneTimeQuery(_,$,X,Z,J,G,Y){return this.prepareQuery(_,$,X,Z,J,G,Y)}run(_){let $=this.dialect.sqlToQuery(_);try{return this.prepareOneTimeQuery($,void 0,"run",!1).run()}catch(X){throw new N2({cause:X,message:`Failed to run the query '${$.sql}'`})}}extractRawRunValueFromBatchResult(_){return _}all(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(_){throw Error("Not implemented")}get(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(_){throw Error("Not implemented")}values(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).values()}async count(_){return(await this.values(_))[0][0]}extractRawValuesValueFromBatchResult(_){throw Error("Not implemented")}}class e4 extends o_{constructor(_,$,X,Z,J=0){super(_,$,X,Z);this.schema=Z,this.nestedIndex=J}static[K]="SQLiteTransaction";rollback(){throw new s8}}class J8 extends t4{constructor(_,$,X,Z,J){super($);this.client=_,this.schema=X,this.options=Z,this.tx=J,this.logger=Z.logger??new a8,this.cache=Z.cache??new s_}static[K]="LibSQLSession";logger;cache;prepareQuery(_,$,X,Z,J,G,Y){return new WZ(this.client,_,this.logger,this.cache,G,Y,$,this.tx,X,Z,J)}async batch(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.batch(X)).map((J,G)=>$[G].mapResult(J,!0))}async migrate(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.migrate(X)).map((J,G)=>$[G].mapResult(J,!0))}async transaction(_,$){let X=await this.client.transaction(),Z=new J8(this.client,this.dialect,this.schema,this.options,X),J=new _5("async",this.dialect,Z,this.schema);try{let G=await _(J);return await X.commit(),G}catch(G){throw await X.rollback(),G}}extractRawAllValueFromBatchResult(_){return _.rows}extractRawGetValueFromBatchResult(_){return _.rows[0]}extractRawValuesValueFromBatchResult(_){return _.rows}}class _5 extends e4{static[K]="LibSQLTransaction";async transaction(_){let $=`sp${this.nestedIndex}`,X=new _5("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(U.raw(`savepoint ${$}`));try{let Z=await _(X);return await this.session.run(U.raw(`release savepoint ${$}`)),Z}catch(Z){throw await this.session.run(U.raw(`rollback to savepoint ${$}`)),Z}}}class WZ extends a4{constructor(_,$,X,Z,J,G,Y,z,H,F,W){super("async",H,$,Z,J,G);this.client=_,this.logger=X,this.fields=Y,this.tx=z,this._isResponseInArrayMode=F,this.customResultMapper=W,this.customResultMapper=W,this.fields=Y}static[K]="LibSQLPreparedQuery";async run(_){let $=W_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return this.tx?this.tx.execute(X):this.client.execute(X)})}async all(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let H=W_(Z.params,_??{});return X.logQuery(Z.sql,H),await this.queryWithCache(Z.sql,H,async()=>{let F={sql:Z.sql,args:H};return(J?J.execute(F):G.execute(F)).then(({rows:W})=>this.mapAllResult(W))})}let z=await this.values(_);return this.mapAllResult(z)}mapAllResult(_,$){if($)_=_.rows;if(!this.fields&&!this.customResultMapper)return _.map((X)=>FZ(X));if(this.customResultMapper)return this.customResultMapper(_,Z8);return _.map((X)=>{return t8(this.fields,Array.prototype.slice.call(X).map((Z)=>Z8(Z)),this.joinsNotNullableMap)})}async get(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let H=W_(Z.params,_??{});return X.logQuery(Z.sql,H),await this.queryWithCache(Z.sql,H,async()=>{let F={sql:Z.sql,args:H};return(J?J.execute(F):G.execute(F)).then(({rows:W})=>this.mapGetResult(W))})}let z=await this.values(_);return this.mapGetResult(z)}mapGetResult(_,$){if($)_=_.rows;let X=_[0];if(!this.fields&&!this.customResultMapper)return FZ(X);if(!X)return;if(this.customResultMapper)return this.customResultMapper(_,Z8);return t8(this.fields,Array.prototype.slice.call(X).map((Z)=>Z8(Z)),this.joinsNotNullableMap)}async values(_){let $=W_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return(this.tx?this.tx.execute(X):this.client.execute(X)).then(({rows:Z})=>Z)})}isResponseInArrayMode(){return this._isResponseInArrayMode}}function FZ(_){return Object.keys(_).reduce(($,X)=>{if(Object.prototype.propertyIsEnumerable.call(_,X))$[X]=_[X];return $},{})}function Z8(_){if(typeof ArrayBuffer<"u"&&_ instanceof ArrayBuffer){if(typeof Buffer<"u"){if(!(_ instanceof Buffer))return Buffer.from(_);return _}if(typeof TextDecoder<"u")return new TextDecoder().decode(_);throw Error("TextDecoder is not available. Please provide either Buffer or TextDecoder polyfill.")}return _}class UZ extends o_{static[K]="LibSQLDatabase";async batch(_){return this.session.batch(_)}}function o2(_,$={}){let X=new c4({casing:$.casing}),Z;if($.logger===!0)Z=new r8;else if($.logger!==!1)Z=$.logger;let J;if($.schema){let z=M7($.schema,I7);J={fullSchema:$.schema,schema:z.tables,tableNamesMap:z.tableNamesMap}}let G=new J8(_,X,J,{logger:Z,cache:$.cache},void 0),Y=new UZ("async",X,G,J);if(Y.$client=_,Y.$cache=$.cache,Y.$cache)Y.$cache.invalidate=$.cache?.onMutate;return Y}function s2(..._){if(typeof _[0]==="string"){let $=p1({url:_[0]});return o2($,_[1])}if(o3(_[0])){let{connection:$,client:X,...Z}=_[0];if(X)return o2(X,Z);let J=typeof $==="string"?p1({url:$}):p1($);return o2(J,Z)}return o2(_[0],_[1])}((_)=>{function $(X){return o2({},X)}_.mock=$})(s2||(s2={}));class a_{client;db;dbName;constructor(_,$){this.dbName=_;try{let X=r_.join(process.cwd(),".sylphx-flow");if(!G8.existsSync(X))G8.mkdirSync(X,{recursive:!0});let Z=r_.join(X,`${_}.db`);this.client=p1({url:`file:${Z}`}),this.db=s2(this.client,{schema:$})}catch(X){throw new V_(`Failed to initialize ${_} database connection`,{url:`file:${r_.join(process.cwd(),".sylphx-flow",`${_}.db`)}`},X)}}async close(){}getDatabasePath(){return r_.join(process.cwd(),".sylphx-flow",`${this.dbName}.db`)}async createTable(_){try{await this.client.execute(_)}catch($){throw new J0(`Failed to create table for ${this.dbName}`,`${this.dbName}.createTable`,$)}}async createIndex(_){try{await this.client.execute(_)}catch($){throw new J0(`Failed to create index for ${this.dbName}`,`${this.dbName}.createIndex`,$)}}async tableExists(_){try{return(await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name='${_}'
      `)).rows.length>0}catch($){throw new J0(`Failed to check if table ${_} exists`,`${this.dbName}.tableExists`,$)}}}var $5={};H6($5,{tfidfTerms:()=>d0,tfidfIdf:()=>U1,tfidfDocuments:()=>W1,codebaseMetadata:()=>S0,codebaseFiles:()=>R0});var R0=Q0("codebase_files_table",{path:k("path").primaryKey(),mtime:C0("mtime").notNull(),hash:k("hash").notNull(),content:k("content"),language:k("language"),size:C0("size"),indexedAt:k("indexed_at").notNull()},(_)=>[O0("idx_codebase_files_mtime").on(_.mtime),O0("idx_codebase_files_hash").on(_.hash)]),S0=Q0("codebase_metadata_table",{key:k("key").primaryKey(),value:k("value").notNull()}),d0=Q0("tfidf_terms_table",{filePath:k("file_path").notNull().references(()=>R0.path,{onDelete:"cascade"}),term:k("term").notNull(),frequency:F1("frequency").notNull()},(_)=>[l2({columns:[_.filePath,_.term]}),O0("idx_tfidf_terms_term").on(_.term),O0("idx_tfidf_terms_file").on(_.filePath)]),W1=Q0("tfidf_documents_table",{filePath:k("file_path").primaryKey().references(()=>R0.path,{onDelete:"cascade"}),magnitude:F1("magnitude").notNull(),termCount:C0("term_count").notNull(),rawTerms:k("raw_terms").notNull()}),U1=Q0("tfidf_idf_table",{term:k("term").primaryKey(),idfValue:F1("idf_value").notNull()});class Z5 extends a_{constructor(){super("cache",$5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Cache database tables already exist");return}await this.createTables(),console.error("[INFO] Cache database tables created")}catch(_){throw new J0("Failed to initialize cache database","cache.initialize",_)}}async createTables(){await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_files_table (
        path TEXT PRIMARY KEY,
        mtime INTEGER NOT NULL,
        hash TEXT NOT NULL,
        content TEXT,
        language TEXT,
        size INTEGER,
        indexed_at TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_metadata_table (
        key TEXT PRIMARY KEY,
        value TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_documents_table (
        file_path TEXT PRIMARY KEY,
        magnitude REAL NOT NULL,
        term_count INTEGER NOT NULL,
        raw_terms TEXT NOT NULL,
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_idf_table (
        term TEXT PRIMARY KEY,
        idf_value REAL NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_terms_table (
        file_path TEXT NOT NULL,
        term TEXT NOT NULL,
        frequency REAL NOT NULL,
        PRIMARY KEY (file_path, term),
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_mtime ON codebase_files_table (mtime)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_hash ON codebase_files_table (hash)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_term ON tfidf_terms_table (term)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_file ON tfidf_terms_table (file_path)
    `)}async getMigrationStatus(){try{let _=["codebase_files_table","tfidf_terms_table","tfidf_documents_table"],$=0;for(let X of _)if(await this.tableExists(X))$++;return{isMigrated:$>=2,migrationCount:$}}catch(_){throw new J0("Failed to check cache database migration status","cache.getMigrationStatus",_)}}async clearCache(){try{await this.client.execute("DELETE FROM tfidf_terms_table"),await this.client.execute("DELETE FROM tfidf_documents_table"),await this.client.execute("DELETE FROM tfidf_idf_table"),await this.client.execute("DELETE FROM codebase_files_table"),await this.client.execute("DELETE FROM codebase_metadata_table"),console.error("[INFO] Cache database cleared")}catch(_){throw new J0("Failed to clear cache database","cache.clearCache",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM codebase_files_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,cachedFiles:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=X5.join(process.cwd(),".sylphx-flow");return X5.join(_,"cache.db")}}class J5{cacheDb;cache;constructor(){this.cacheDb=new Z5,this.cache=this.cacheDb.db}async initialize(){await this.cacheDb.initialize()}async setCodebaseFile(_){return l(`set codebase file: ${_.path}`,async()=>{await this.cache.insert(R0).values(_).onConflictDoUpdate({target:R0.path,set:{mtime:_.mtime,hash:_.hash,content:_.content,language:_.language,size:_.size,indexedAt:_.indexedAt}})})}async getCodebaseFile(_){return l(`get codebase file: ${_}`,async()=>{let $=await this.cache.select().from(R0).where(L(R0.path,_)).limit(1);if($.length===0)return null;let X=$[0];return{path:X.path,mtime:X.mtime,hash:X.hash,content:X.content||void 0,language:X.language||void 0,size:X.size||void 0,indexedAt:X.indexedAt}})}async getAllCodebaseFiles(){return l("get all codebase files",async()=>{return(await this.cache.select().from(R0).orderBy(g0(R0.mtime))).map(($)=>({path:$.path,mtime:$.mtime,hash:$.hash,content:$.content||void 0,language:$.language||void 0,size:$.size||void 0,indexedAt:$.indexedAt}))})}async deleteCodebaseFile(_){return l(`delete codebase file: ${_}`,async()=>{let $=await this.cache.delete(R0).where(L(R0.path,_));return(await this.cache.select().from(R0).where(L(R0.path,_)).limit(1)).length===0})}async clearCodebaseFiles(){return l("clear codebase files",async()=>{await this.cache.delete(R0)})}async setMetadata(_,$){return l(`set metadata: ${_}`,async()=>{await this.cache.insert(S0).values({key:_,value:$}).onConflictDoUpdate({target:S0.key,set:{value:$}})})}async getMetadata(_){return l(`get metadata: ${_}`,async()=>{let $=await this.cache.select().from(S0).where(L(S0.key,_)).limit(1);return $.length>0?$[0].value:null})}async getAllMetadata(){return l("get all metadata",async()=>{let _=await this.cache.select().from(S0),$={};for(let X of _)$[X.key]=X.value;return $})}async deleteMetadata(_){return l(`delete metadata: ${_}`,async()=>{let $=await this.cache.delete(S0).where(L(S0.key,_));return(await this.cache.select().from(S0).where(L(S0.key,_)).limit(1)).length===0})}async setTfidfTerms(_){return l("set TF-IDF terms",async()=>{let $=[...new Set(_.map((X)=>X.filePath))];for(let X of $)await this.cache.delete(d0).where(L(d0.filePath,X));if(_.length>0)await this.cache.insert(d0).values(_)})}async getTfidfTerms(_){return l(`get TF-IDF terms for file: ${_}`,async()=>{return(await this.cache.select().from(d0).where(L(d0.filePath,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async getTfidfTermsByTerm(_){return l(`get TF-IDF terms by term: ${_}`,async()=>{return(await this.cache.select().from(d0).where(L(d0.term,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async clearTfidfTerms(){return l("clear TF-IDF terms",async()=>{await this.cache.delete(d0)})}async setTfidfDocument(_){return l(`set TF-IDF document: ${_.filePath}`,async()=>{await this.cache.insert(W1).values(_).onConflictDoUpdate({target:W1.filePath,set:{magnitude:_.magnitude,termCount:_.termCount,rawTerms:_.rawTerms}})})}async getTfidfDocument(_){return l(`get TF-IDF document: ${_}`,async()=>{let $=await this.cache.select().from(W1).where(L(W1.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{filePath:X.filePath,magnitude:X.magnitude,termCount:X.termCount,rawTerms:X.rawTerms}})}async getAllTfidfDocuments(){return l("get all TF-IDF documents",async()=>{return(await this.cache.select().from(W1)).map(($)=>({filePath:$.filePath,magnitude:$.magnitude,termCount:$.termCount,rawTerms:$.rawTerms}))})}async clearTfidfDocuments(){return l("clear TF-IDF documents",async()=>{await this.cache.delete(W1)})}async setTfidfIdf(_){return l(`set TF-IDF IDF: ${_.term}`,async()=>{await this.cache.insert(U1).values(_).onConflictDoUpdate({target:U1.term,set:{idfValue:_.idfValue}})})}async getTfidfIdf(_){return l(`get TF-IDF IDF: ${_}`,async()=>{let $=await this.cache.select().from(U1).where(L(U1.term,_)).limit(1);if($.length===0)return null;let X=$[0];return{term:X.term,idfValue:X.idfValue}})}async getAllTfidfIdf(){return l("get all TF-IDF IDF values",async()=>{return(await this.cache.select().from(U1)).map(($)=>({term:$.term,idfValue:$.idfValue}))})}async clearTfidfIdf(){return l("clear TF-IDF IDF values",async()=>{await this.cache.delete(U1)})}async getStats(){return l("get cache statistics",async()=>{let[_,$,X,Z,J]=await Promise.all([this.cache.select({count:i0()}).from(R0),this.cache.select({count:i0()}).from(S0),this.cache.select({count:i0()}).from(d0),this.cache.select({count:i0()}).from(W1),this.cache.select({count:i0()}).from(U1)]);return{codebaseFiles:_[0]?.count||0,metadataEntries:$[0]?.count||0,tfidfTerms:X[0]?.count||0,tfidfDocuments:Z[0]?.count||0,tfidfIdfValues:J[0]?.count||0}})}async clearAll(){return l("clear all cache data",async()=>{await Promise.all([this.cache.delete(R0),this.cache.delete(S0),this.cache.delete(d0),this.cache.delete(W1),this.cache.delete(U1)])})}}import*as Y8 from"node:path";var G5={};H6(G5,{memory:()=>y});var y=Q0("memory_table",{key:k("key").notNull(),namespace:k("namespace").notNull().default("default"),value:k("value").notNull(),timestamp:C0("timestamp").notNull(),created_at:k("created_at").notNull(),updated_at:k("updated_at").notNull()},(_)=>[l2({columns:[_.key,_.namespace]}),O0("idx_memory_namespace").on(_.namespace),O0("idx_memory_timestamp").on(_.timestamp),O0("idx_memory_key").on(_.key)]);class Y5 extends a_{constructor(){super("memory",G5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Memory database tables already exist");return}let $=Y8.join(process.cwd(),"drizzle","memory");await this.createTables(),console.error("[INFO] Memory database tables created")}catch(_){throw new J0("Failed to initialize memory database","memory.initialize",_)}}async createTables(){await this.createTable(`
        CREATE TABLE IF NOT EXISTS memory_table (
          key TEXT NOT NULL,
          namespace TEXT NOT NULL DEFAULT 'default',
          value TEXT NOT NULL,
          timestamp INTEGER NOT NULL,
          created_at TEXT NOT NULL,
          updated_at TEXT NOT NULL,
          PRIMARY KEY (key, namespace)
        )
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_namespace ON memory_table (namespace)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_timestamp ON memory_table (timestamp)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_key ON memory_table (key)
      `)}async getMigrationStatus(){try{let _=await this.tableExists("memory_table");return{isMigrated:_,migrationCount:_?1:0}}catch(_){throw new J0("Failed to check memory database migration status","memory.getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=Y8.join(process.cwd(),".sylphx-flow");return Y8.join(_,"memory.db")}}class z5{memoryDb;memory;constructor(){this.memoryDb=new Y5,this.memory=this.memoryDb.db}async initialize(){await this.memoryDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch($){throw Error(`Failed to deserialize value: ${$.message}`)}}async set(_,$,X="default"){let Z=`Failed to set memory entry: ${X}:${_}`;try{let J=new Date().toISOString(),G=Date.now(),Y=this.safeSerialize($);if((await this.memory.select().from(y).where(K0(L(y.key,_),L(y.namespace,X))).limit(1)).length>0)await this.memory.update(y).set({value:Y,timestamp:G,updated_at:J}).where(K0(L(y.key,_),L(y.namespace,X)));else await this.memory.insert(y).values({key:_,namespace:X,value:Y,timestamp:G,created_at:J,updated_at:J})}catch(J){throw Error(`${Z}: ${J.message}`)}}async get(_,$="default"){let X=`Failed to get memory entry: ${$}:${_}`;try{let Z=await this.memory.select().from(y).where(K0(L(y.key,_),L(y.namespace,$))).limit(1);if(Z.length===0)return null;let J=Z[0];return{key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}}catch(Z){throw Error(`${X}: ${Z.message}`)}}async getAll(_){try{let X=this.memory.select().from(y);if(_&&_!=="all")X=X.where(L(y.namespace,_));return(await X.orderBy(g0(y.timestamp))).map((J)=>({key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}))}catch(X){throw Error(`Failed to get all memory entries: ${X.message}`)}}async search(_,$){let X=`Failed to search memory entries: ${_}`;try{let Z=this.memory.select().from(y).where(O_(Z1(y.key,`%${_}%`),Z1(y.value,`%${_}%`)));if($&&$!=="all")Z=Z.where(K0(L(y.namespace,$),O_(Z1(y.key,`%${_}%`),Z1(y.value,`%${_}%`))));return(await Z.orderBy(g0(y.timestamp))).map((G)=>({key:G.key,namespace:G.namespace,value:this.safeDeserialize(G.value),timestamp:G.timestamp,created_at:G.created_at,updated_at:G.updated_at}))}catch(Z){throw Error(`${X}: ${Z.message}`)}}async delete(_,$="default"){let X=`Failed to delete memory entry: ${$}:${_}`;try{let Z=await this.memory.delete(y).where(K0(L(y.key,_),L(y.namespace,$)));return(await this.memory.select().from(y).where(K0(L(y.key,_),L(y.namespace,$))).limit(1)).length===0}catch(Z){throw Error(`${X}: ${Z.message}`)}}async clear(_="default"){let $=`Failed to clear memory namespace: ${_}`;try{await this.memory.delete(y).where(L(y.namespace,_))}catch(X){throw Error(`${$}: ${X.message}`)}}async getStats(_){try{let X=this.memory.select({count:i0()}).from(y);if(_&&_!=="all")X=X.where(L(y.namespace,_));let J=(await X)[0]?.count||0,Y=(await this.memory.selectDistinct({namespace:y.namespace}).from(y)).map((z)=>z.namespace);return{totalEntries:J,namespaces:Y}}catch(X){throw Error(`Failed to get memory statistics: ${X.message}`)}}}class k0{memoryStorage;cacheStorage;constructor(){this.memoryStorage=new z5,this.cacheStorage=new J5}async initialize(){await Promise.all([this.memoryStorage.initialize(),this.cacheStorage.initialize()])}async set(_,$,X="default"){return this.memoryStorage.set(_,$,X)}async get(_,$="default"){return this.memoryStorage.get(_,$)}async getAll(_){return this.memoryStorage.getAll(_)}async search(_,$){return this.memoryStorage.search(_,$)}async delete(_,$="default"){return this.memoryStorage.delete(_,$)}async clear(_="default"){return this.memoryStorage.clear(_)}async getStats(_){return this.memoryStorage.getStats(_)}async setCodebaseFile(_,$,X,Z,J,G){let Y=new Date().toISOString();return this.cacheStorage.setCodebaseFile({path:_,mtime:$,hash:X,content:Z,language:J,size:G,indexedAt:Y})}async getCodebaseFile(_){return this.cacheStorage.getCodebaseFile(_)}async getAllCodebaseFiles(){return this.cacheStorage.getAllCodebaseFiles()}async deleteCodebaseFile(_){return this.cacheStorage.deleteCodebaseFile(_)}async clearCodebaseFiles(){return this.cacheStorage.clearCodebaseFiles()}async setMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async getMetadata(_){return this.cacheStorage.getMetadata(_)}async getAllMetadata(){return this.cacheStorage.getAllMetadata()}async deleteMetadata(_){return this.cacheStorage.deleteMetadata(_)}async setTfidfTerms(_){return this.cacheStorage.setTfidfTerms(_)}async getTfidfTerms(_){return this.cacheStorage.getTfidfTerms(_)}async getTfidfTermsByTerm(_){return this.cacheStorage.getTfidfTermsByTerm(_)}async clearTfidfTerms(){return this.cacheStorage.clearTfidfTerms()}async setTfidfDocument(_,$,X,Z){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$,termCount:X,rawTerms:Z})}async getTFIDFDocument(_){return this.cacheStorage.getTfidfDocument(_)}async getAllTfidfDocuments(){return this.cacheStorage.getAllTfidfDocuments()}async clearTfidfDocuments(){return this.cacheStorage.clearTfidfDocuments()}async setTfidfIdf(_,$){return this.cacheStorage.setTfidfIdf({term:_,idfValue:$})}async getTfidfIdf(_){return this.cacheStorage.getTfidfIdf(_)}async getAllTfidfIdf(){return this.cacheStorage.getAllTfidfIdf()}async clearTfidfIdf(){return this.cacheStorage.clearTfidfIdf()}async getCacheStats(){return this.cacheStorage.getStats()}async clearAllCache(){return this.cacheStorage.clearAll()}async getAllStats(){let[_,$]=await Promise.all([this.memoryStorage.getStats(),this.cacheStorage.getStats()]);return{memory:_,cache:$}}async clearAll(){await Promise.all([this.memoryStorage.clear("default"),this.cacheStorage.clearAll()])}async getCodebaseIndexStats(){let _=await this.cacheStorage.getAllMetadata();return{indexedAt:_.indexedAt,totalFiles:Number.parseInt(_.totalFiles||"0"),totalTerms:Number.parseInt(_.totalTerms||"0")}}async getIDFValues(){return this.cacheStorage.getAllTfidfIdf()}async upsertTFIDFDocument(_,$){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:JSON.stringify($.rawTerms)})}async upsertCodebaseFile(_){return this.cacheStorage.setCodebaseFile({..._,indexedAt:_.indexedAt||new Date().toISOString()})}async setIDFValues(_){let $=Object.entries(_).map(([X,Z])=>this.cacheStorage.setTfidfIdf({term:X,idfValue:Z}));await Promise.all($)}async clearCodebaseIndex(){await Promise.all([this.cacheStorage.clearCodebaseFiles(),this.cacheStorage.clearTfidfTerms(),this.cacheStorage.clearTfidfDocuments(),this.cacheStorage.clearTfidfIdf()])}async getCodebaseMetadata(_){return this.cacheStorage.getMetadata(_)}async setCodebaseMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async setTFIDFTerms(_,$){let X=Object.entries($).map(([Z,J])=>({filePath:_,term:Z,frequency:J}));return this.cacheStorage.setTfidfTerms(X)}}class AZ{static step1aRules=[{pattern:/sses$/i,replacement:"ss"},{pattern:/ies$/i,replacement:"i"},{pattern:/ss$/i,replacement:"ss"},{pattern:/s$/i,replacement:""}];static step1bRules=[{pattern:/eed$/i,replacement:"ee"},{pattern:/ed$/i,replacement:""},{pattern:/ing$/i,replacement:""}];static step1cRules=[{pattern:/y$/i,replacement:"i"}];static step2Rules=[{pattern:/ational$/i,replacement:"ate"},{pattern:/tional$/i,replacement:"tion"},{pattern:/enci$/i,replacement:"ence"},{pattern:/anci$/i,replacement:"ance"},{pattern:/izer$/i,replacement:"ize"},{pattern:/abli$/i,replacement:"able"},{pattern:/alli$/i,replacement:"al"},{pattern:/entli$/i,replacement:"ent"},{pattern:/eli$/i,replacement:"e"},{pattern:/ousli$/i,replacement:"ous"},{pattern:/ization$/i,replacement:"ize"},{pattern:/ation$/i,replacement:"ate"},{pattern:/ator$/i,replacement:"ate"},{pattern:/alism$/i,replacement:"al"},{pattern:/iveness$/i,replacement:"ive"},{pattern:/fulness$/i,replacement:"ful"},{pattern:/ousness$/i,replacement:"ous"},{pattern:/aliti$/i,replacement:"al"},{pattern:/iviti$/i,replacement:"ive"},{pattern:/biliti$/i,replacement:"ble"}];static step3Rules=[{pattern:/icate$/i,replacement:"ic"},{pattern:/ative$/i,replacement:""},{pattern:/alize$/i,replacement:"al"},{pattern:/iciti$/i,replacement:"ic"},{pattern:/ical$/i,replacement:"ic"},{pattern:/ful$/i,replacement:""},{pattern:/ness$/i,replacement:""}];static step4Rules=[{pattern:/al$/i,replacement:""},{pattern:/ance$/i,replacement:""},{pattern:/ence$/i,replacement:""},{pattern:/er$/i,replacement:""},{pattern:/ic$/i,replacement:""},{pattern:/able$/i,replacement:""},{pattern:/ible$/i,replacement:""},{pattern:/ant$/i,replacement:""},{pattern:/ement$/i,replacement:""},{pattern:/ment$/i,replacement:""},{pattern:/ent$/i,replacement:""},{pattern:/ion$/i,replacement:""},{pattern:/ou$/i,replacement:""},{pattern:/ism$/i,replacement:""},{pattern:/ate$/i,replacement:""},{pattern:/iti$/i,replacement:""},{pattern:/ous$/i,replacement:""},{pattern:/ive$/i,replacement:""},{pattern:/ize$/i,replacement:""}];static step5Rules=[{pattern:/e$/i,replacement:""},{pattern:/ll$/i,replacement:"l"}];static stem(_){if(_.length<3)return _.toLowerCase();let $=_.toLowerCase();for(let X of this.step1aRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1bRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1cRules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step2Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step3Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step4Rules)if(X.pattern.test($)&&$.length>3){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step5Rules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}return $}}function H5(_){return _.replace(/```[\s\S]*?```/g," ").replace(/`[^`]+`/g," ").replace(/#{1,6}\s/g,"").replace(/[*_~]/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").toLowerCase().split(/[^a-z0-9_-]+/).filter((Z)=>Z.length>1)}function F5(_){let $=H5(_),X=new Map;for(let Z of $){let J=AZ.stem(Z);X.set(J,(X.get(J)||0)+1)}return X}var VW=new Set(["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","will","with","this","but","they","have","had","what","when","where","who","which","why","how"]);function KZ(_){return _.filter(($)=>!VW.has($.toLowerCase()))}function DZ(_){let $=Array.from(_.values()).reduce((Z,J)=>Z+J,0),X=new Map;for(let[Z,J]of _.entries())X.set(Z,J/$);return X}function NW(_,$){let X=new Map;for(let J of _){let G=new Set(J.keys());for(let Y of G)X.set(Y,(X.get(Y)||0)+1)}let Z=new Map;for(let[J,G]of X.entries())Z.set(J,Math.log($/G));return Z}function OZ(_,$){let X=new Map;for(let[Z,J]of _.entries()){let G=$.get(Z)||0;X.set(Z,J*G)}return X}function RZ(_){let $=0;for(let X of _.values())$+=X*X;return Math.sqrt($)}function z8(_){let $=_.map((J)=>({uri:J.uri,terms:F5(J.content)})),X=NW($.map((J)=>J.terms),_.length);return{documents:$.map((J)=>{let G=DZ(J.terms),Y=OZ(G,X),z=RZ(Y);return{uri:J.uri,terms:Y,rawTerms:J.terms,magnitude:z}}),idf:X,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}function MW(_,$){let X=0;for(let[J,G]of _.entries()){let Y=$.terms.get(J)||0;X+=G*Y}let Z=RZ(_);if(Z===0||$.magnitude===0)return 0;return X/(Z*$.magnitude)}function BW(_,$){let X=F5(_),Z=DZ(X);return OZ(Z,$)}function W5(_,$,X={}){let{limit:Z=10,minScore:J=0,boostFactors:G={}}=X,{exactMatch:Y=1.5,phraseMatch:z=2}=G,H=BW(_,$.idf),F=KZ(H5(_));return $.documents.map((A)=>{let D=MW(H,A),R=[];for(let O of F)if(A.rawTerms.has(O))D*=Y,R.push(O);if(R.length===F.length&&F.length>1)D*=z;return{uri:A.uri,score:D,matchedTerms:R}}).filter((A)=>A.score>=J).sort((A,D)=>D.score-A.score).slice(0,Z)}function IW(_){let $=A1.extname(_).toLowerCase();return{".ts":"TypeScript",".tsx":"TSX",".js":"JavaScript",".jsx":"JSX",".py":"Python",".java":"Java",".go":"Go",".rs":"Rust",".c":"C",".cpp":"C++",".cs":"C#",".rb":"Ruby",".php":"PHP",".swift":"Swift",".kt":"Kotlin",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".sql":"SQL",".sh":"Shell",".bash":"Bash"}[$]}function QW(_){let $=new Set([".ts",".tsx",".js",".jsx",".py",".java",".go",".rs",".c",".cpp",".h",".hpp",".cs",".rb",".php",".swift",".kt",".md",".txt",".json",".yaml",".yml",".toml",".xml",".html",".css",".scss",".sass",".less",".sql",".sh",".bash",".env",".gitignore",".dockerignore"]),X=A1.extname(_).toLowerCase();return $.has(X)||!X}function EW(_){let $=VZ.default();$.add(["node_modules/",".git/","dist/","build/",".next/",".cache/","coverage/","*.log",".DS_Store","Thumbs.db"]);let X=A1.join(_,".gitignore");if(E1.existsSync(X)){let Z=E1.readFileSync(X,"utf8");$.add(Z)}return $}function jW(_,$,X,Z={}){let{maxFileSize:J=1048576,maxFiles:G=50000}=Z,Y=[];function z(H){if(Y.length>=G)return;let F=E1.readdirSync(H,{withFileTypes:!0});for(let W of F){if(Y.length>=G)break;let A=A1.join(H,W.name),D=A1.relative($,A);if(X.ignores(D))continue;if(W.isDirectory())z(A);else if(W.isFile()&&QW(W.name))try{let R=E1.statSync(A);if(R.size>J){console.warn(`[WARN] Skipping large file: ${D} (${R.size} bytes)`);continue}let O=E1.readFileSync(A,"utf8"),N=IW(W.name);Y.push({path:D,absolutePath:A,content:O,language:N,size:R.size,mtime:R.mtimeMs})}catch(R){console.warn(`[WARN] Failed to read file: ${D}`,R)}}}return z(_),Y}function TW(_){let $=0;for(let X=0;X<_.length;X++){let Z=_.charCodeAt(X);$=($<<5)-$+Z,$=$&$}return $.toString(36)}class U5{codebaseRoot;cacheDir;cache=null;ig;db;options;constructor(_={}){this.options={batchSize:100,..._},this.codebaseRoot=_.codebaseRoot||process.cwd(),this.cacheDir=_.cacheDir||A1.join(this.codebaseRoot,".sylphx-flow","cache"),this.ig=EW(this.codebaseRoot),this.db=new k0}async buildTFIDFIndexFromDB(){try{let _=[],$=await this.db.getAllCodebaseFiles();for(let J of $){let G=await this.db.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,H=new Map;for(let[F,W]of Object.entries(Y))z.set(F,W),H.set(F,W);_.push({uri:`file://${J.path}`,terms:z,rawTerms:H,magnitude:G.magnitude})}}let X=await this.db.getIDFValues(),Z=new Map;for(let[J,G]of Object.entries(X))Z.set(J,G);if(_.length===0)return;return{documents:_,idf:Z,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch(_){console.error("[ERROR] Failed to build TF-IDF index from database:",_);return}}async loadCache(){try{await this.db.initialize();let _=await this.db.getCodebaseMetadata("version"),$=await this.db.getCodebaseMetadata("codebaseRoot"),X=await this.db.getCodebaseMetadata("indexedAt"),Z=await this.db.getCodebaseMetadata("fileCount");if(!_||!$||!X||!Z)return null;let J=await this.db.getAllCodebaseFiles(),G=new Map;for(let H of J)G.set(H.path,{mtime:H.mtime,hash:H.hash});let Y=await this.buildTFIDFIndexFromDB(),z=await this.db.getCodebaseMetadata("vectorIndexPath");return{version:_,codebaseRoot:$,indexedAt:X,fileCount:Number.parseInt(Z),files:G,tfidfIndex:Y,vectorIndexPath:z}}catch(_){return console.error("[ERROR] Failed to load cache from database:",_),null}}async saveCache(_){try{if(await this.db.initialize(),await this.db.setCodebaseMetadata("version",_.version),await this.db.setCodebaseMetadata("codebaseRoot",_.codebaseRoot),await this.db.setCodebaseMetadata("indexedAt",_.indexedAt),await this.db.setCodebaseMetadata("fileCount",_.fileCount.toString()),_.vectorIndexPath)await this.db.setCodebaseMetadata("vectorIndexPath",_.vectorIndexPath);for(let[$,X]of _.files.entries())await this.db.upsertCodebaseFile({path:$,mtime:X.mtime,hash:X.hash});if(_.tfidfIndex){for(let X of _.tfidfIndex.documents){let Z=X.uri.replace("file://",""),J={};for(let[Y,z]of X.rawTerms.entries())J[Y]=z;await this.db.upsertTFIDFDocument(Z,{magnitude:X.magnitude,termCount:X.terms.size,rawTerms:J});let G={};for(let[Y,z]of X.terms.entries())G[Y]=z;await this.db.setTFIDFTerms(Z,G)}let $={};for(let[X,Z]of _.tfidfIndex.idf.entries())$[X]=Z;await this.db.setIDFValues($)}console.error("[INFO] Cache saved to database")}catch($){throw console.error("[ERROR] Failed to save cache to database:",$),$}}async indexCodebase(_={}){let{force:$=!1}=_,{embeddingProvider:X}=_;this.cache=await this.loadCache(),console.error("[INFO] Scanning codebase...");let Z=jW(this.codebaseRoot,this.codebaseRoot,this.ig);if(console.error(`[INFO] Found ${Z.length} files`),this.cache&&!$){let R=Math.abs(Z.length-this.cache.fileCount)/this.cache.fileCount*100;if(R>20)console.error(`[WARN] File count changed significantly (${R.toFixed(1)}%), forcing full reindex`),$=!0,this.cache=null}let J=[],G=[],Y=new Map;for(let D of Z){let R=TW(D.content);Y.set(D.path,{mtime:D.mtime,hash:R});let O=this.cache?.files.get(D.path);if($||!O||O.hash!==R)J.push(D)}if(this.cache?.files){for(let D of this.cache.files.keys())if(!Y.has(D))G.push(D)}let z=J.length>0||G.length>0;if(!$&&!z&&this.cache?.tfidfIndex)return console.error("[INFO] Cache hit! Using cached index"),{tfidfIndex:this.cache.tfidfIndex,stats:{totalFiles:Z.length,indexedFiles:0,skippedFiles:Z.length,cacheHit:!0}};if(J.length>0)console.error(`[INFO] Changed files: ${J.length}`);if(G.length>0)console.error(`[INFO] Deleted files: ${G.length}`);console.error(`[INFO] Indexing ${J.length} changed files...`);let F=Z.map((D)=>({uri:`file://${D.path}`,content:D.content})),W=z8(F),A;if(X){console.error("[INFO] Generating embeddings...");let D=A1.join(this.cacheDir,"codebase-vectors.hnsw");A=new H8(D,X.dimensions);let R=10;for(let O=0;O<Z.length;O+=R){let N=Z.slice(O,O+R),I=N.map((w)=>w.content),j=await X.generateEmbeddings(I);for(let w=0;w<N.length;w++){let q=N[w],t=j[w],u={id:`file://${q.path}`,embedding:t,metadata:{type:"code",language:q.language||"",content:q.content.slice(0,500),category:""}};A.addDocument(u)}console.error(`[INFO] Embedded ${Math.min(O+R,Z.length)}/${Z.length} files`)}A.save()}return this.cache={version:"1.0.0",codebaseRoot:this.codebaseRoot,indexedAt:new Date().toISOString(),fileCount:Z.length,files:Y,tfidfIndex:W,vectorIndexPath:A?A1.join(this.cacheDir,"codebase-vectors.hnsw"):void 0},await this.saveCache(this.cache),{tfidfIndex:W,vectorStorage:A,stats:{totalFiles:Z.length,indexedFiles:J.length,skippedFiles:Z.length-J.length,cacheHit:!1}}}async getCacheStats(){try{await this.db.initialize();let _=await this.db.getCodebaseIndexStats();return{exists:_.fileCount>0,fileCount:_.fileCount,indexedAt:_.indexedAt}}catch(_){return console.error("[ERROR] Failed to get cache stats:",_),{exists:!1,fileCount:0}}}async clearCache(){try{await this.db.initialize(),await this.db.clearCodebaseIndex();let _=A1.join(this.cacheDir,"codebase-index.json");if(E1.existsSync(_))E1.unlinkSync(_);let $=A1.join(this.cacheDir,"codebase-vectors.hnsw");if(E1.existsSync($))E1.unlinkSync($);console.error("[INFO] Cache cleared from database and files")}catch(_){console.error("[ERROR] Failed to clear cache:",_)}}}import K5 from"node:fs";import D5 from"node:path";class A5{config;cachedIndex=null;indexingPromise=null;status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0};constructor(_){this.config=_}getStatus(){return{...this.status}}isReady(){return this.cachedIndex!==null&&!this.status.isIndexing}startBackgroundIndexing(){if(this.status.isIndexing||this.cachedIndex)return;console.error(`[INFO] Starting background ${this.config.name} indexing...`),this.loadIndex().catch((_)=>{console.error(`[ERROR] Background ${this.config.name} indexing failed:`,_)})}async loadIndex(){if(this.cachedIndex)return this.cachedIndex;if(this.indexingPromise)return this.indexingPromise;return this.status.isIndexing=!0,this.status.progress=0,this.status.startTime=Date.now(),this.status.error=void 0,this.indexingPromise=this.buildIndex().then((_)=>{return this.cachedIndex=_,this.status.isIndexing=!1,this.status.progress=100,this.status.totalItems=_.totalDocuments,this.status.indexedItems=_.totalDocuments,console.error(`[INFO] ${this.config.name} indexing complete: ${_.totalDocuments} documents`),_}).catch((_)=>{throw this.status.isIndexing=!1,this.status.error=_ instanceof Error?_.message:String(_),console.error(`[ERROR] ${this.config.name} indexing failed:`,_),_}),this.indexingPromise}clearCache(){this.cachedIndex=null,this.indexingPromise=null,this.status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0}}async getStats(){let _=await this.loadIndex();if(!_)return null;return{totalDocuments:_.totalDocuments,uniqueTerms:_.idf.size,generatedAt:_.metadata.generatedAt,version:_.metadata.version}}}class NZ extends A5{embeddingProvider;vectorStorage;constructor(_){super({name:"knowledge",autoStart:!0});this.embeddingProvider=_}scanKnowledgeFiles(_){let $=[],X=(Z,J)=>{let G=K5.readdirSync(Z,{withFileTypes:!0});for(let Y of G){let z=D5.join(Z,Y.name);if(Y.isDirectory())X(z,J);else if(Y.isFile()&&Y.name.endsWith(".md")){let F=D5.relative(J,z).replace(/\.md$/,"").replace(/\\/g,"/"),W=K5.readFileSync(z,"utf8");$.push({uri:`knowledge://${F}`,content:W})}}};return X(_,_),$}async buildIndex(){let _=R5();if(!K5.existsSync(_))throw Error(`Knowledge directory not found: ${_}`);let $=this.scanKnowledgeFiles(_);console.error(`[INFO] Found ${$.length} knowledge files`);let X=z8($);if(this.embeddingProvider&&$.length>0){console.error("[INFO] Building vector index for knowledge...");try{let Z=D5.join(R5(),"..",".sylphx-flow","knowledge-vectors.hnsw");this.vectorStorage=new H8(Z,this.embeddingProvider.dimensions||1536),await this.vectorStorage.initialize();let J=10;for(let G=0;G<$.length;G+=J){let Y=$.slice(G,G+J),z=await this.embeddingProvider.generateEmbeddings(Y.map((H)=>H.content));for(let H=0;H<Y.length;H++){let F=Y[H],W=z[H];await this.vectorStorage.addDocument({id:F.uri,embedding:W,metadata:{type:"knowledge",content:F.content.slice(0,500),category:"knowledge",language:"markdown"}})}console.error(`[INFO] Processed ${Math.min(G+J,$.length)}/${$.length} knowledge files`)}await this.vectorStorage.save(),console.error("[INFO] Vector index built successfully")}catch(Z){console.error("[ERROR] Failed to build vector index:",Z),this.vectorStorage=void 0}}return X}}var O5=null;function V5(_){if(!O5)O5=new NZ(_);return O5}class MZ{memoryStorage;knowledgeIndexer=V5();embeddingProvider;constructor(){this.memoryStorage=new k0}async initialize(){if(await this.memoryStorage.initialize(),!this.embeddingProvider)this.embeddingProvider=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();this.knowledgeIndexer=V5(this.embeddingProvider)}async getStatus(){let _=await this.memoryStorage.getAllCodebaseFiles(),$=await this.memoryStorage.getCodebaseIndexStats(),X=this.knowledgeIndexer.getStatus(),Z=!1,J=0;try{let G=await this.knowledgeIndexer.loadIndex();Z=!0,J=G.totalDocuments}catch{}return{codebase:{indexed:_.length>0,fileCount:_.length,indexedAt:$.indexedAt},knowledge:{indexed:Z,documentCount:J,isIndexing:X.isIndexing,progress:X.progress}}}async searchCodebase(_,$={}){let{limit:X=10,include_content:Z=!0,file_extensions:J,path_filter:G,exclude_paths:Y,min_score:z=0.1}=$,H=await this.memoryStorage.getAllCodebaseFiles();if(H.length===0)throw Error('Codebase not indexed yet. Run "sylphx search reindex" first.');let F=H;if(J?.length)F=F.filter((R)=>J.some((O)=>R.path.endsWith(O)));if(G)F=F.filter((R)=>R.path.includes(G));if(Y?.length)F=F.filter((R)=>!Y.some((O)=>R.path.includes(O)));if(F.length===0)return{results:[],totalIndexed:H.length,query:_};let W=await this.buildSearchIndex(F);if(!W)throw Error("No searchable content found");let A=await W5(_,W,{limit:X,minScore:z}),D=[];for(let R of A){let O=R.uri?.replace("file://","")||"Unknown",N="";if(Z){let I=await this.memoryStorage.getCodebaseFile(O);if(I?.content){if(N=I.content.substring(0,500),I.content.length>500)N+="..."}}D.push({uri:R.uri,score:R.score||0,title:O.split("/").pop()||O,content:Z?N:void 0})}return{results:D,totalIndexed:H.length,query:_}}async searchKnowledge(_,$={}){let{limit:X=10,include_content:Z=!0}=$;try{let J=await this.knowledgeIndexer.loadIndex();return{results:(await W5(_,J,{limit:X})).map((z)=>({uri:z.uri,score:z.score||0,title:z.uri?.split("/").pop()||"Unknown",content:Z?"":void 0})),totalIndexed:J.totalDocuments,query:_}}catch{throw Error("Knowledge base not indexed yet")}}async buildSearchIndex(_){try{let $=[];for(let J of _){let G=await this.memoryStorage.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,H=new Map;for(let[F,W]of Object.entries(Y))z.set(F,W),H.set(F,W);$.push({uri:`file://${J.path}`,terms:z,rawTerms:H,magnitude:G.magnitude})}}if($.length===0)return null;let X=await this.memoryStorage.getIDFValues(),Z=new Map;for(let J of X)if(J.term&&J.idfValue!==void 0)Z.set(J.term,J.idfValue);return{documents:$,idf:Z,totalDocuments:$.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch($){return console.error("[ERROR] Failed to build search index:",$),null}}formatResultsForCLI(_,$,X){if(_.length===0)return`\uD83D\uDCED No results found for "${$}"

**Total indexed files:** ${X}`;let Z=`✓ Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let H=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${H}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA Source: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
   \`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return Z+J}formatResultsForMCP(_,$,X){let Z=`Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let H=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${H}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA URI: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
\`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return{content:[{type:"text",text:Z+J}]}}async getAvailableKnowledgeURIs(){try{return(await this.knowledgeIndexer.loadIndex()).documents.map(($)=>$.uri)}catch{return[]}}}var E0=new MZ;var LW=new B0("search").description("Search codebase files and source code").argument("<query>","Search query - use natural language, function names, or technical terms").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include file content snippets in results (default: true)","true").option("--extensions <exts...>","Filter by file extensions (e.g., .ts .tsx .js)").option("--path <pattern>","Filter by path pattern (e.g., src/components)").option("--exclude <patterns...>","Exclude paths containing these patterns").action(async(_,$)=>{try{console.log(""),console.log(M.cyan.bold("▸ Search Codebase")),console.log(M.gray(`  Query: "${_}"`));let X=y0("Searching...").start();await E0.initialize();let Z=await E0.searchCodebase(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false",file_extensions:$.extensions,path_filter:$.path,exclude_paths:$.exclude});X.stop();let J=E0.formatResultsForCLI(Z.results,_,Z.totalIndexed);console.log(J),console.log("")}catch(X){console.error(M.red(`
✗ Error: ${X.message}
`)),process.exit(1)}}),wW=new B0("reindex").description("Reindex all codebase files").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Reindex Codebase"));let _=y0("Scanning and indexing files...").start(),$=new U5,X=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();await $.indexCodebase({embeddingProvider:X}),_.succeed(M.green("Indexing complete")),console.log("")}catch(_){throw new S(`Codebase reindex failed: ${_.message}`)}}),PW=new B0("status").description("Get codebase search system status").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Codebase Status")),await E0.initialize();let _=await E0.getStatus();if(_.codebase.indexed){if(console.log(M.green(`
✓ Indexed and ready`)),console.log(M.gray(`  Files: ${_.codebase.fileCount}`)),_.codebase.indexedAt)console.log(M.gray(`  Last indexed: ${new Date(_.codebase.indexedAt).toLocaleString()}`))}else console.log(M.yellow(`
⚠ Not indexed`)),console.log(M.gray("  Run: sylphx-flow codebase reindex"));console.log(M.cyan(`
▸ Available Commands`)),console.log(M.gray("  • codebase search <query>")),console.log(M.gray("  • codebase reindex")),console.log(M.gray("  • codebase status")),console.log("")}catch(_){console.error(M.red(`
✗ Error: ${_.message}
`)),process.exit(1)}}),BZ=new B0("codebase").description("Manage codebase indexing and search").addCommand(LW).addCommand(wW).addCommand(PW);import t0 from"node:fs";import m1 from"node:path";var xW={core:"core.md"};function N5(_="core"){return IZ(xW[_])}function QZ(_){try{return N5(_),!0}catch{return!1}}function r2(_,$="white"){let X={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",reset:"\x1B[0m"},Z=X[$]||X.white;console.log(`${Z}${_}${X.reset}`)}import LZ from"node:path";import z2 from"node:fs/promises";import EZ from"node:path";async function B5(_,$={}){let{encoding:X="utf8",fallback:Z}=$;try{return await z2.readFile(_,X)}catch(J){if(J.code==="ENOENT"&&Z!==void 0)return Z;throw J}}async function jZ(_){try{return await z2.access(_),!0}catch{return!1}}async function F8(_){try{let $=await z2.stat(_);return{exists:!0,isFile:$.isFile(),isDirectory:$.isDirectory(),size:$.size,mtime:$.mtime,atime:$.atime,ctime:$.ctime}}catch{return{exists:!1,isFile:!1,isDirectory:!1}}}async function TZ(_){if(M5.validatePath(_),!await jZ(_))return;if((await F8(_)).isDirectory)await z2.rmdir(_,{recursive:!0});else await z2.unlink(_)}async function W8(_,$={}){let{recursive:X=!1,includeFiles:Z=!0,includeDirectories:J=!0}=$;if(M5.validatePath(_),!await jZ(_))throw Error(`Directory does not exist: ${_}`);if(!(await F8(_)).isDirectory)throw Error(`Path is not a directory: ${_}`);if(X){let Y=[],z=await z2.readdir(_,{withFileTypes:!0});for(let H of z){let F=EZ.join(_,H.name);if(H.isDirectory()&&J){Y.push(F);let W=await W8(F,$);Y.push(...W)}else if(H.isFile()&&Z)Y.push(F)}return Y}else return(await z2.readdir(_,{withFileTypes:!0})).filter((z)=>{if(z.isFile()&&Z)return!0;if(z.isDirectory()&&J)return!0;return!1}).map((z)=>EZ.join(_,z.name))}async function I5(_,$){try{return(await W8(_,{recursive:!0,includeFiles:!0,includeDirectories:!1})).filter((Z)=>$.some((J)=>Z.endsWith(J))).map((Z)=>LZ.relative(_,Z)).sort()}catch{return[]}}async function t_(_){let $=await F8(_);if(!$.exists||!$.isFile)return null;let X=await B5(_);if(X===null)return null;return{content:X,mtime:$.mtime}}async function Q5(_,$,X,Z){try{let J=await W8(_,{recursive:!1,includeFiles:!0,includeDirectories:!1});for(let G of J){let Y=LZ.basename(G);if(X.some((H)=>Y.endsWith(H))&&!$.has(Y))await TZ(G),Z.push({file:Y,status:"skipped",action:"Removed obsolete file"})}}catch{}}async function E5(_,$,X,Z,J=!1,G=!1){if(G)return;if(!J){let A=_.length,D=_.filter((R)=>R.status==="added"||R.status==="updated").length;if(D>0)console.log(`✓ ${D} files updated`);else console.log(`✓ All ${A} files already current`);return}console.log(`
\uD83D\uDCCA ${Z} Results for ${X}`),console.log("=====================================");let Y=_.reduce((A,D)=>{if(!A[D.status])A[D.status]=[];return A[D.status].push(D),A},{}),z=["added","updated","current","skipped"],H={added:"green",updated:"yellow",current:"blue",skipped:"magenta"};for(let A of z){let D=Y[A];if(D&&D.length>0){let R=H[A];r2(`${A.toUpperCase()} (${D.length}):`,R);for(let O of D)r2(`  ${O.file} - ${O.action}`,R);console.log("")}}let F=_.length,W=_.filter((A)=>A.status==="added"||A.status==="updated").length;if(W>0)r2(`✓ ${Z} complete: ${W}/${F} files modified`,"green");else r2(`✓ ${Z} complete: All ${F} files already current`,"blue");console.log(`\uD83D\uDCC1 Target directory: ${$}`)}async function wZ(){let{getAgentsDir:_}=await import("./paths-2re3k191.js"),$=_();if(!t0.existsSync($))throw Error(`Could not find agents directory at: ${$}`);let X=[],Z=t0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isFile()&&G.name.endsWith(".md")).map((G)=>G.name);X.push(...Z);let J=t0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isDirectory()&&G.name!=="archived").map((G)=>G.name);for(let G of J){let Y=m1.join($,G),z=await I5(Y,[".md"]);X.push(...z.map((H)=>m1.join(G,H)))}return X}async function PZ(_){let $=process.cwd(),X=[],Z=await v.resolveTarget({target:_.target}),J=v.getTarget(Z);if(!J)throw Error(`Target not found: ${Z}`);if(_.quiet!==!0)console.log(`Using target: ${J.name}`);let G=J.config,Y=m1.join($,G.agentDir),z=async(D,R)=>{return await J.transformAgentContent(D,void 0,R)};if(_.clear&&t0.existsSync(Y)){let D,R=await wZ();D=new Set(R.map((O)=>{let N=m1.parse(O),I=N.name,j=N.dir;if(G.flatten)return`${j?`${j.replace(/[\/\\]/g,"-")}-${I}`:I}${G.agentExtension}`;return O})),Q5(Y,D,[G.agentExtension],X)}t0.mkdirSync(Y,{recursive:!0});let H=await wZ();if(_.quiet!==!0)console.log(`Installing ${H.length} agents to ${Y.replace(`${process.cwd()}/`,"")}`),console.log("");if(_.dryRun){console.log("✓ Dry run completed - no files were modified");return}let{getAgentsDir:F}=await import("./paths-2re3k191.js"),W=F(),A=H.map(async(D)=>{let R=m1.join(W,D),O=m1.join(Y,D),N=m1.dirname(O);if(!t0.existsSync(N))t0.mkdirSync(N,{recursive:!0});let I=await t_(O),j=!I,w=t0.readFileSync(R,"utf8");w=await z(w,D);let q=I?await z(I.content,D):"";if(!I||q!==w)t0.writeFileSync(O,w,"utf8"),X.push({file:D,status:I?"updated":"added",action:I?"Updated":"Created"});else X.push({file:D,status:"current",action:"Already current"})});await Promise.all(A),E5(X,Y,J.name,"Install",_.verbose,_.quiet)}async function xZ(_){let $=process.cwd(),X=await v.resolveTarget({target:_.target}),Z=v.getTarget(X);if(!Z)throw Error(`Target not found: ${X}`);if(!Z.config.rulesFile)return;if(!QZ("core")){console.warn("⚠️ Core rules file not found");return}let J=N5("core"),Y=t0.readFileSync(J,"utf8"),z=m1.join($,Z.config.rulesFile),H=await t_(z),F=Y;if(_.dryRun){console.log(`Dry run: Would install rules file to ${z.replace(`${$}/`,"")}`);return}if(H&&H.content===F){if(_.quiet!==!0)console.log(`Rules file already current: ${Z.config.rulesFile}`);return}if(t0.writeFileSync(z,F,"utf8"),_.quiet!==!0)console.log(`${H?"Updated":"Created"} rules file: ${Z.config.rulesFile}`)}function qW(_){return _.type==="stdio"}function j5(_){return qW(_)}function T5(_){if(typeof _==="function"){let $=_();return Promise.resolve($)}return Promise.resolve(_)}class u1{target;constructor(_){let $=v.getTarget(_);if(!$)throw Error(`Target not found: ${_}`);this.target=$}getAllServerIds(){return Object.keys(A0)}async getAvailableServers(){let _=await this.getInstalledServerIds();return this.getAllServerIds().filter(($)=>!_.includes($))}async getInstalledServerIds(){try{let _=await this.target.readConfig(process.cwd()),$=this.target.config.mcpConfigPath,X=this.getNestedProperty(_,$)||{},Z=Object.keys(X);return Object.values(A0).filter((J)=>Z.includes(J.name)).map((J)=>J.id)}catch(_){return[]}}getRequiringConfiguration(_){return _.filter(($)=>{return!!A0[$].envVars})}validateServer(_,$){let X=A0[_];if(!X?.envVars)return{isValid:!0,missingRequired:[],invalidValues:[]};let Z=[],J=[];for(let[G,Y]of Object.entries(X.envVars)){let z=$[G]||process.env[G]||"";if(Y.required&&(!z||z===""))Z.push(G)}return{isValid:Z.length===0&&J.length===0,missingRequired:Z,invalidValues:J}}async configureServer(_,$={}){let X=A0[_],Z={};if(!X.envVars)return Z;console.log(""),console.log(M.cyan(`▸ ${X.name}`)),console.log(M.gray(`  ${X.description}`)),console.log("");for(let[J,G]of Object.entries(X.envVars)){if(G.dependsOn){if(G.dependsOn.filter((F)=>!($[F]||process.env[F])).length>0)continue}let Y=$[J]||process.env[J],z;if(Y&&Y.trim()!=="")z=Y;else if(G.fetchChoices){let H=y0("Fetching options...").start();for(let[F,W]of Object.entries($))if(W)process.env[F]=W;try{let F=await G.fetchChoices();H.stop(),z=(await c.prompt({type:"list",name:"value",message:`${J}${G.required?" *":""}`,choices:F,default:G.default||F[0]})).value}catch(F){let W=F instanceof Error?F.message:String(F);H.fail(M.red(`Failed to fetch options: ${W}`)),z=(await c.prompt({type:"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default})).value}}else if(J==="GEMINI_MODEL")z=(await c.prompt({type:"list",name:"model",message:`${J}${G.required?" *":""}`,choices:["gemini-2.5-flash","gemini-2.5-pro","gemini-1.5-flash","gemini-1.5-pro"],default:G.default||"gemini-2.5-flash"})).model;else z=(await c.prompt({type:G.secret?"password":"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default,mask:G.secret?"•":void 0})).value;if(z)Z[J]=z,$[J]=z}return console.log(M.green("✓ Configured")),console.log(""),Z}async installServers(_,$={}){if(_.length===0)return;try{let X=await this.target.readConfig(process.cwd()),Z=this.target.config.mcpConfigPath,G={...this.getNestedProperty(X,Z)||{}};for(let Y of _){let z=A0[Y],H=$[Y]||{},F={...z.config},W,A;if(j5(z.config))W=z.config.command?await T5(z.config.command):void 0,A=z.config.args?await T5(z.config.args):[];if(j5(z.config))F={...z.config,command:W,args:A};if(Object.keys(H).length>0){let O={...z.config.type==="local"?z.config.environment:z.config.type==="stdio"?z.config.env:{}};for(let[N,I]of Object.entries(H))if(I&&I.trim()!=="")O[N]=I;if(F.type==="local")F.environment=O;else if(F.type==="stdio")F.env=O}let D=this.target.transformMCPConfig(F,Y);G[z.name]=D}if(this.setNestedProperty(X,Z,G),await this.target.writeConfig(process.cwd(),X),this.target.approveMCPServers){let Y=_.map((z)=>A0[z].name);await this.target.approveMCPServers(process.cwd(),Y)}}catch(X){throw Error(`Failed to install MCP servers: ${X instanceof Error?X.message:String(X)}`)}}async readConfig(){try{return await this.target.readConfig(process.cwd())}catch(_){return{settings:{}}}}async writeConfig(_){await this.target.writeConfig(process.cwd(),_)}getNestedProperty(_,$){return $.split(".").reduce((X,Z)=>{if(typeof X==="object"&&X!==null)return X[Z];return},_)}setNestedProperty(_,$,X){let Z=$.split("."),J=Z.pop();if(!J)return;let G=Z.reduce((Y,z)=>{if(!Y[z])Y[z]={};return Y[z]},_);G[J]=X}}async function qZ(_,$){let X=v.getTarget($);if(!X)throw Error(`Target not found: ${$}`);let Z=await X.readConfig(_),J=X.config.mcpConfigPath,G=CW(Z,J);if(!G||Object.keys(G).length===0){console.log("ℹ️  No MCP servers configured");return}console.log(`\uD83D\uDCCB Currently configured MCP servers for ${X.name}:`),console.log("");for(let[Y,z]of Object.entries(G)){let H="";if(z&&typeof z==="object"&&"type"in z){if(z.type==="local")H=z.command?.join(" ")||"Unknown command";else if(z.type==="remote")H=`HTTP: ${z.url}`}console.log(`  • ${Y}: ${H}`);let F=Object.values(A0).find((W)=>W.name===Y);if(F)console.log(`    ${F.description}`);console.log("")}}function CZ(_){let $=v.getTarget(_);if(!$)throw Error(`Unknown target: ${_}. Available targets: ${v.getImplementedTargetIDs().join(", ")}`);if(!$.isImplemented)throw Error(`Target '${_}' is not implemented. Available targets: ${v.getImplementedTargetIDs().join(", ")}`);return _}function d1(_){return v.getTarget(_)?.config.installation.supportedMcpServers??!1}function CW(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}async function SW(_){let $=await v.resolveTarget({target:_.target});_.target=$;try{CZ($)}catch(X){if(X instanceof Error)throw new S(X.message,"UNSUPPORTED_TARGET");throw X}if(_.merge)throw new S("The --merge option is not supported with init command.","INVALID_OPTION")}var kZ={name:"init",description:"Initialize project with Sylphx Flow development agents and MCP tools",options:[{flags:"--target <type>",description:`Force specific target (${v.getImplementedTargetIDs().join(", ")}, default: opencode)`},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--no-mcp",description:"Skip MCP tools installation"}],handler:async(_)=>{let $=_.target;if(console.log(""),console.log(M.cyan.bold("▸ Sylphx Flow Setup")),!$)$=await v.promptForTargetSelection(),_.target=$;if(await SW(_),!$)throw Error("Target ID not set");if(_.dryRun){if(console.log(M.yellow(`
  Dry run mode - no changes will be made`)),_.mcp!==!1&&d1($)){let G=await new u1($).getAvailableServers();console.log(M.cyan(`
▸ MCP Tools`));for(let Y of G)console.log(M.gray(`  • ${A0[Y].name}`))}console.log(M.cyan(`
▸ Agents`)),console.log(M.gray("  • Development agents")),console.log(M.cyan(`
▸ Rules`)),console.log(M.gray("  • Custom rules")),console.log(M.green(`
✓ Dry run complete
`));return}if(_.mcp!==!1&&d1($)){let J=new u1($),G=J.getAllServerIds(),Y=await J.getInstalledServerIds();console.log(""),console.log(M.cyan.bold("▸ Configure MCP Tools")),console.log("");let H=(await c.prompt([{type:"checkbox",name:"selectedServers",message:"Select MCP tools to install:",choices:G.map((W)=>{let A=A0[W],D=Y.includes(W);return{name:`${A.name} - ${A.description}`,value:W,checked:A.required||D||A.defaultInInit||!1,disabled:A.required?"(required)":!1}})}])).selectedServers,F=G.filter((W)=>A0[W].required);if(H=[...new Set([...F,...H])],H.length>0){let W=H.filter((R)=>{let O=A0[R];return O.envVars&&Object.keys(O.envVars).length>0}),A={};if(W.length>0){console.log(""),console.log(M.cyan.bold("▸ Configure selected MCP tools"));let R={};for(let O of W){let N=await J.configureServer(O,R);A[O]=N}}let D=y0("Installing MCP servers...").start();try{await J.installServers(H,A),D.succeed("MCP servers installed")}catch(R){throw D.fail(M.red("Failed to install MCP servers")),R}}}if($==="opencode")await U8.ensureSecretsDir(process.cwd()),await U8.addToGitignore(process.cwd());console.log("");let X=y0("Installing agents...").start();await PZ({..._,quiet:!0}),X.succeed("Agents installed"),console.log("");let Z=y0("Installing rules...").start();await xZ({..._,quiet:!0}),Z.succeed("Rules installed"),console.log(""),console.log(M.green.bold("✓ Setup complete!")),console.log(M.gray("  Start coding with Sylphx Flow")),console.log("");try{await SZ.setDefaultTarget($),console.log(M.gray(`  Default target set to: ${v.getTarget($)?.name||$}`))}catch(J){console.warn(M.yellow(`  Warning: Could not save default target: ${J instanceof Error?J.message:String(J)}`))}console.log("")}};function kW(){return[{uri:"knowledge://stacks/react-app",title:"React App",description:"React application patterns, hooks, components, and best practices",content:"",category:"stacks"},{uri:"knowledge://stacks/nextjs-app",title:"Next.js App",description:"Next.js patterns, routing, API routes, and deployment strategies",content:"",category:"stacks"},{uri:"knowledge://stacks/node-api",title:"Node.js API",description:"Node.js API patterns, middleware, authentication, and database integration",content:"",category:"stacks"},{uri:"knowledge://data/sql",title:"SQL Patterns",description:"SQL queries, indexing, migrations, and database optimization",content:"",category:"data"},{uri:"knowledge://guides/saas-template",title:"SaaS Template",description:"SaaS application architecture, multi-tenancy, and scaling patterns",content:"",category:"guides"},{uri:"knowledge://guides/tech-stack",title:"Tech Stack Guide",description:"Technology selection, architecture decisions, and stack composition",content:"",category:"guides"},{uri:"knowledge://guides/ui-ux",title:"UI/UX Patterns",description:"User interface patterns, UX principles, and frontend architecture",content:"",category:"guides"},{uri:"knowledge://universal/security",title:"Security",description:"Security best practices, authentication, authorization, and vulnerability prevention",content:"",category:"universal"},{uri:"knowledge://universal/performance",title:"Performance",description:"Performance optimization, caching, monitoring, and scaling strategies",content:"",category:"universal"},{uri:"knowledge://universal/testing",title:"Testing",description:"Testing strategies, unit tests, integration tests, and quality assurance",content:"",category:"universal"},{uri:"knowledge://universal/deployment",title:"Deployment",description:"Deployment strategies, CI/CD, infrastructure, and monitoring",content:"",category:"universal"}]}function vZ(_){let X=kW().find((G)=>G.uri===_);if(!X)throw Error(`Knowledge resource not found: ${_}`);let Z=_.split("/")[2],J=_.split("/").pop();return`# ${X.title}

**URI:** ${_}
**Category:** ${Z}
**Description:** ${X.description}

*Note: This is a placeholder implementation. In a full implementation, this would load the actual content from knowledge files.*`}var vW=new B0("search").description("Search knowledge base, documentation, and guides").argument("<query>","Search query - use natural language, technology names, or topic keywords").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include full content in results (default: true)","true").action(async(_,$)=>{try{console.log(`\uD83D\uDCDA Searching knowledge base for: "${_}"`),await E0.initialize();let X=await E0.searchKnowledge(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false"}),Z=E0.formatResultsForCLI(X.results,_,X.totalIndexed);console.log(Z)}catch(X){throw new S(`Knowledge search failed: ${X.message}`)}}),hW=new B0("get").description("Get specific knowledge document by URI").argument("<uri>",'Knowledge URI to access (e.g., "knowledge://stacks/react-app")').action(async(_)=>{try{let $=vZ(_);console.log($)}catch($){let X=`Knowledge get failed: ${$.message}`,Z=await E0.getAvailableKnowledgeURIs();if(Z.length>0)console.log(`
**Available knowledge URIs:**`),Z.forEach((J)=>console.log(`• ${J}`));throw new S(X)}}),yW=new B0("list").description("List all available knowledge resources").option("--category <type>","Filter by category (stacks, guides, universal, data)").action(async(_)=>{try{await E0.initialize();let $=await E0.getAvailableKnowledgeURIs();if($.length===0){console.log("\uD83D\uDCED No knowledge documents available");return}let X=$;if(_.category)X=$.filter((J)=>J.includes(`/${_.category}/`));console.log(`\uD83D\uDCDA Available Knowledge Resources (${X.length} documents):
`);let Z=X.reduce((J,G)=>{let Y=G.split("/")[2]||"unknown";if(!J[Y])J[Y]=[];return J[Y].push(G),J},{});Object.entries(Z).forEach(([J,G])=>{console.log(`### ${J.charAt(0).toUpperCase()+J.slice(1)}`),G.forEach((Y)=>{let z=Y.split("/").pop()||"Unknown";console.log(`• ${z} - ${Y}`)}),console.log("")}),console.log("**Usage:**"),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch($){throw new S(`Knowledge status failed: ${$.message}`)}}),fW=new B0("status").description("Get knowledge base system status").action(async()=>{try{console.log(`
### \uD83D\uDCDA Knowledge Base Status
`),await E0.initialize();let _=await E0.getStatus();if(_.knowledge.indexed)console.log("**Status:** ✓ Ready"),console.log(`**Documents:** ${_.knowledge.documentCount} files`);else if(_.knowledge.isIndexing)console.log(`**Status:** \uD83D\uDD04 Building index (${_.knowledge.progress||0}%)`),console.log("**Note:** Please wait a moment and try again");else console.log("**Status:** ⚠️ Not initialized"),console.log("**Note:** Will auto-index on first search");console.log(`
**Available Commands:**`),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch(_){throw new S(`Knowledge list failed: ${_.message}`)}}),a2=new B0("knowledge").description("Knowledge base search and management commands");a2.addCommand(vW);a2.addCommand(hW);a2.addCommand(yW);a2.addCommand(fW);function bW(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}var gW=async(_)=>{let $={disableMemory:_.disableMemory===!0,disableTime:_.disableTime===!0,disableProjectStartup:_.disableProjectStartup===!0,disableKnowledge:_.disableKnowledge===!0,disableCodebaseSearch:_.disableCodebaseSearch===!0},X=await v.resolveTarget({target:_.target,allowSelection:!0}),Z=v.getTarget(X);if(!Z)throw new S(`Target not found: ${X}`,"TARGET_NOT_FOUND");try{let J=await Z.readConfig(process.cwd()),G=Z.config.mcpConfigPath||"mcp",Y=bW(J,G)||{},z=["--disable-memory","--disable-time","--disable-project-startup","--disable-knowledge","--disable-codebase-search"],H=[];if($.disableMemory)H.push("--disable-memory");if($.disableTime)H.push("--disable-time");if($.disableProjectStartup)H.push("--disable-project-startup");if($.disableKnowledge)H.push("--disable-knowledge");if($.disableCodebaseSearch)H.push("--disable-codebase-search");for(let[F,W]of Object.entries(Y)){if(!W||typeof W!=="object")continue;if(W.type==="stdio"){if(!W.args)W.args=[];W.args.push(...H)}else if(W.type==="local"&&Array.isArray(W.command))W.command.push(...H);else if(W.type==="http"||W.type==="remote")continue}await Z.writeConfig(process.cwd(),J),console.log(M.green("✓ Sylphx Flow MCP server configuration updated"))}catch(J){throw new S(`Failed to update MCP configuration: ${J instanceof Error?J.message:String(J)}`,"MCP_CONFIG_ERROR")}},pW=async(_)=>{let $=_.server,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!d1(X))throw new S(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");console.log(""),console.log(M.cyan.bold("▸ Configure MCP Server")),console.log(M.gray(`  Target: ${X}`));let Z=new u1(X),J;if($){if(!Z.getAllServerIds().includes($))throw new S(`Invalid MCP server: ${$}. Available: ${Z.getAllServerIds().join(", ")}`,"INVALID_MCP_SERVER");J=$}else J=(await c.prompt([{type:"list",name:"server",message:"Select server to configure:",choices:Z.getAllServerIds().map((H)=>{let F=A0[H];return{name:`${F.name} - ${F.description}`,value:H}})}])).server;let G=A0[J];if(console.log(M.cyan(`
▸ ${G.name}`)),console.log(M.gray(`  ${G.description}`)),!G.envVars){console.log(M.gray(`
  No configuration needed`));return}await Z.configureServer(J);let Y=y0("Saving configuration...").start();try{await Z.installServers([J]),Y.succeed(M.green("✓ Configuration saved"))}catch(z){throw Y.fail(M.red("Failed to save configuration")),z}},mW=async(_)=>{let $=await v.resolveTarget({target:_.target,allowSelection:!0});if(!d1($))throw new S(`Target ${$} does not support MCP servers`,"UNSUPPORTED_TARGET");await qZ(process.cwd(),$)},uW=async(_)=>{let $=_.servers,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!d1(X))throw new S(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new S("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let Z=Array.isArray($)?$:[$],J=new u1(X),G=J.getAllServerIds(),Y=Z.filter((H)=>!G.includes(H));if(Y.length>0)throw new S(`Invalid MCP servers: ${Y.join(", ")}. Available: ${G.join(", ")}`,"INVALID_MCP_SERVERS");let z=Z;await J.installServers(z)},dW=async(_)=>{let $=_.servers,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!d1(X))throw new S(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new S("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let J=new u1(X).getInstalledServerIds(),G=$.filter((Y)=>!J.includes(Y));if(G.length>0)throw new S(`MCP servers not installed: ${G.join(", ")}. Installed: ${J.join(", ")}`,"SERVERS_NOT_INSTALLED");console.log(M.yellow("Remove functionality not yet implemented"))},hZ={name:"mcp",description:"Manage MCP (Model Context Protocol) servers",options:[{flags:"--target <type>",description:`Force specific target (${v.getImplementedTargetIDs().join(", ")}, default: opencode)`}],subcommands:[{name:"start",description:"Start Sylphx Flow MCP server with specific configuration",options:[{flags:"--disable-memory",description:"Disable memory functionality"},{flags:"--disable-time",description:"Disable time functionality"},{flags:"--disable-project-startup",description:"Disable project startup functionality"},{flags:"--disable-knowledge",description:"Disable knowledge functionality"},{flags:"--disable-codebase-search",description:"Disable codebase search functionality"}],handler:gW},{name:"config",description:"Configure MCP server settings",options:[{flags:"--server <name>",description:"Configure specific server (shows selection if not provided)"}],handler:pW},{name:"list",description:"List installed MCP servers",options:[],handler:mW},{name:"add",description:"Add MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to add"}],handler:uW},{name:"remove",description:"Remove MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to remove"}],handler:dW}]};var cW=async(_)=>{let X=await new k0().getAll();if(_.namespace&&_.namespace!=="all"){let Z=X.filter((Y)=>Y.namespace===_.namespace);if(console.log(`\uD83D\uDCCB Memory entries in namespace: ${_.namespace}`),console.log(`Total: ${Z.length} entries
`),Z.length===0){console.log("No entries found in this namespace.");return}let J=_.limit||50;Z.slice(0,J).forEach((Y,z)=>{let H=Y.value||"",F=typeof H==="string"?H.substring(0,50)+(H.length>50?"...":""):`${JSON.stringify(H).substring(0,50)}...`;console.log(`${z+1}. ${Y.namespace}:${Y.key}`),console.log(`   Value: ${F}`),console.log(`   Updated: ${Y.updated_at}`),console.log("")})}else{if(console.log(`\uD83D\uDCCB All memory entries (showing first ${_.limit||50}):`),console.log(`Total: ${X.length} entries
`),X.length===0){console.log("No memory entries found.");return}let Z=_.limit||50;X.slice(0,Z).forEach((G,Y)=>{let z=G.value||"",H=typeof z==="string"?z.substring(0,50)+(z.length>50?"...":""):`${JSON.stringify(z).substring(0,50)}...`;console.log(`${Y+1}. ${G.namespace}:${G.key}`),console.log(`   Value: ${H}`),console.log(`   Updated: ${G.updated_at}`),console.log("")})}},lW=async(_)=>{if(!_.pattern)throw new S("Search pattern is required. Use --pattern <pattern>");let X=await new k0().search(_.pattern,_.namespace);if(console.log(`\uD83D\uDD0D Search results for pattern: ${_.pattern}`),_.namespace&&_.namespace!=="all")console.log(`Namespace: ${_.namespace}`);if(console.log(`Found: ${X.length} results
`),X.length===0){console.log("No matching entries found.");return}X.forEach((Z,J)=>{let G=Z.value||"",Y=typeof G==="string"?G.substring(0,50)+(G.length>50?"...":""):`${JSON.stringify(G).substring(0,50)}...`;console.log(`${J+1}. ${Z.namespace}:${Z.key}`),console.log(`   Value: ${Y}`),console.log(`   Updated: ${Z.updated_at}`),console.log("")})},iW=async(_)=>{if(!_.key)throw new S("Key is required. Use --key <key>");if(await new k0().delete(_.key,_.namespace||"default"))console.log(`✓ Deleted memory entry: ${_.namespace||"default"}:${_.key}`);else console.log(`✗ Memory entry not found: ${_.namespace||"default"}:${_.key}`)},nW=async(_)=>{if(!_.confirm)throw new S("Confirmation required. Use --confirm to clear memory entries");let $=new k0;if(_.namespace)await $.clear(_.namespace),console.log(`✓ Cleared all memory entries in namespace: ${_.namespace}`);else await $.clear(),console.log("✓ Cleared all memory entries")},oW=async()=>{let $=await new k0().getStats();if(console.log("\uD83D\uDCCA Memory Statistics"),console.log("=================="),console.log(`Total Entries: ${$.totalEntries}`),console.log(`Namespaces: ${$.namespaces.length}`),console.log(""),$.namespaces.length>0)console.log("Namespaces:"),$.namespaces.forEach((X)=>{console.log(`  • ${X}`)}),console.log("");console.log("\uD83D\uDCCD Database: .sylphx-flow/memory.db")},sW=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("get")+1;if(X>=$.length)throw new S("Usage: flow memory get <key> [--namespace <namespace>]");let Z=$[X],J=_.namespace||"default",Y=await new k0().get(Z,J);if(Y)console.log(`\uD83D\uDCC4 Memory entry: ${J}:${Z}`),console.log(`Value: ${JSON.stringify(Y.value,null,2)}`),console.log(`Created: ${Y.created_at}`),console.log(`Updated: ${Y.updated_at}`);else console.log(`✗ Memory entry not found: ${J}:${Z}`)},rW=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("set")+1,Z=X+1;if(X>=$.length||Z>=$.length)throw new S("Usage: flow memory set <key> <value> [--namespace <namespace>]");let J=$[X],G=$[Z],Y=_.namespace||"default";await new k0().set(J,G,Y),console.log(`✓ Set memory entry: ${Y}:${J} = "${G}"`)},yZ={name:"memory",description:"Manage memory storage (set, get, search, list, delete, clear)",options:[{flags:"--target <type>",description:`Target platform (${v.getImplementedTargets().join(", ")}, default: auto-detect)`}],subcommands:[{name:"list",description:"List memory entries",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"},{flags:"--limit <number>",description:"Limit number of entries (default: 50)"}],handler:cW},{name:"search",description:"Search memory entries",arguments:[{name:"pattern",required:!0,description:"Search pattern"}],options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:lW},{name:"delete",description:"Delete memory entry",arguments:[{name:"key",required:!0,description:"Memory key to delete"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:iW},{name:"clear",description:"Clear memory entries",options:[{flags:"--namespace <name>",description:"Clear specific namespace (default: all)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:nW},{name:"stats",description:"Show memory statistics",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:oW},{name:"get",description:"Get memory entry",arguments:[{name:"key",required:!0,description:"Memory key to retrieve"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:sW},{name:"set",description:"Set memory entry",arguments:[{name:"key",description:"Memory key",required:!0},{name:"value",description:"Memory value",required:!0}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:rW}]};import*as e_ from"node:fs";import*as W2 from"node:path";import aW from"node:crypto";import L5 from"node:fs";function fZ(_){let $=_.migrationsFolder,X=[],Z=`${$}/meta/_journal.json`;if(!L5.existsSync(Z))throw Error("Can't find meta/_journal.json file");let J=L5.readFileSync(`${$}/meta/_journal.json`).toString(),G=JSON.parse(J);for(let Y of G.entries){let z=`${$}/${Y.tag}.sql`;try{let H=L5.readFileSync(`${$}/${Y.tag}.sql`).toString(),F=H.split("--> statement-breakpoint").map((W)=>{return W});X.push({sql:F,bps:Y.breakpoints,folderMillis:Y.when,hash:aW.createHash("sha256").update(H).digest("hex")})}catch{throw Error(`No file ${z} found in ${$} folder`)}}return X}async function bZ(_,$){let X=fZ($),Z=$.migrationsTable??"__drizzle_migrations",J=U`
		CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
			id SERIAL PRIMARY KEY,
			hash text NOT NULL,
			created_at numeric
		)
	`;await _.session.run(J);let Y=(await _.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0,z=[];for(let H of X)if(!Y||Number(Y[2])<H.folderMillis){for(let F of H.sql)z.push(_.run(U.raw(F)));z.push(_.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${H.hash}, ${H.folderMillis})`))}await _.session.migrate(z)}var A8={};H6(A8,{tfidfTerms:()=>N0,tfidfIdf:()=>t2,tfidfDocuments:()=>H2,memory:()=>f,codebaseMetadata:()=>F2,codebaseFiles:()=>i});var f=Q0("memory",{key:k("key").notNull(),namespace:k("namespace").notNull().default("default"),value:k("value").notNull(),timestamp:C0("timestamp").notNull(),created_at:k("created_at").notNull(),updated_at:k("updated_at").notNull()},(_)=>({pk:l2({columns:[_.key,_.namespace]}),namespaceIdx:O0("idx_memory_namespace").on(_.namespace),timestampIdx:O0("idx_memory_timestamp").on(_.timestamp),keyIdx:O0("idx_memory_key").on(_.key)})),i=Q0("codebase_files",{path:k("path").primaryKey(),mtime:C0("mtime").notNull(),hash:k("hash").notNull(),content:k("content"),language:k("language"),size:C0("size"),indexedAt:k("indexed_at").notNull()},(_)=>({mtimeIdx:O0("idx_codebase_files_mtime").on(_.mtime),hashIdx:O0("idx_codebase_files_hash").on(_.hash)})),N0=Q0("tfidf_terms",{filePath:k("file_path").notNull().references(()=>i.path,{onDelete:"cascade"}),term:k("term").notNull(),frequency:F1("frequency").notNull()},(_)=>({termIdx:O0("idx_tfidf_terms_term").on(_.term),fileIdx:O0("idx_tfidf_terms_file").on(_.filePath)})),H2=Q0("tfidf_documents",{filePath:k("file_path").primaryKey().references(()=>i.path,{onDelete:"cascade"}),magnitude:F1("magnitude").notNull(),termCount:C0("term_count").notNull(),rawTerms:k("raw_terms").notNull()}),t2=Q0("tfidf_idf",{term:k("term").primaryKey(),idfValue:F1("idf_value").notNull()}),F2=Q0("codebase_metadata",{key:k("key").primaryKey(),value:k("value").notNull()});class w5{client;db;constructor(){try{let _=W2.join(process.cwd(),".sylphx-flow");if(!e_.existsSync(_))e_.mkdirSync(_,{recursive:!0});let $=W2.join(_,"memory.db");this.client=p1({url:`file:${$}`}),this.db=s2(this.client,{schema:A8})}catch(_){throw new V_("Failed to initialize database connection",{url:`file:${W2.join(process.cwd(),".sylphx-flow/memory.db")}`},_)}}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){if(console.error("[INFO] Database tables already exist, checking migration state"),(await this.client.execute(`
          SELECT name FROM sqlite_master 
          WHERE type='table' AND name='__drizzle_migrations'
        `)).rows.length===0)await this.client.execute(`
            CREATE TABLE IF NOT EXISTS __drizzle_migrations (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              hash text NOT NULL UNIQUE,
              created_at numeric NOT NULL DEFAULT (strftime('%s', 'now'))
            )
          `),await this.client.execute(`
            INSERT OR IGNORE INTO __drizzle_migrations (hash, created_at) 
            VALUES ('0000_wooden_lady_bullseye', strftime('%s', 'now'))
          `),console.error("[INFO] Migration tracking initialized for existing tables");return}let $=W2.join(process.cwd(),"drizzle");if(e_.existsSync($))await bZ(this.db,{migrationsFolder:$}),console.error("[INFO] Database migrations completed");else console.error("[WARN] No migrations folder found, using fallback table creation"),await this.createTablesFallback()}catch(_){let $=`Migration failed: ${_.message}`;console.error("[ERROR]",$);try{await this.createTablesFallback(),console.error("[WARN] Fallback table creation completed")}catch(X){throw new J0("Both migration and fallback failed","initialize",X,{originalError:_.message})}}}async createTablesFallback(){console.error("[INFO] Using fallback table creation")}async close(){}getDatabasePath(){let _=W2.join(process.cwd(),".sylphx-flow");return W2.join(_,"memory.db")}async getMigrationStatus(){try{let _=await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name IN ('memory', 'codebase_files', 'tfidf_terms')
      `);return{isMigrated:_.rows.length>=2,migrationCount:_.rows.length}}catch(_){throw new J0("Failed to check migration status","getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}}class P5{drizzleDb;db;constructor(){this.drizzleDb=new w5,this.db=this.drizzleDb.db}async initialize(){await this.drizzleDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch{return _}}async set(_,$,X="default"){if(!_||typeof _!=="string")throw new B6("Key must be a non-empty string","key",_);if(!X||typeof X!=="string")throw new B6("Namespace must be a non-empty string","namespace",X);await l("memory.set",async()=>{let Z=new Date,J=Z.getTime(),G=Z.toISOString(),Y=G,z=this.safeSerialize($);if(await this.get(_,X))await this.db.update(f).set({value:z,timestamp:J,updated_at:Y}).where(K0(L(f.key,_),L(f.namespace,X)));else{let F={key:_,namespace:X,value:z,timestamp:J,created_at:G,updated_at:Y};await this.db.insert(f).values(F)}},{key:_,namespace:X})}async get(_,$="default"){let X=await this.db.select().from(f).where(K0(L(f.key,_),L(f.namespace,$))).limit(1);if(X.length===0)return null;let Z=X[0];return{key:Z.key,namespace:Z.namespace,value:this.safeDeserialize(Z.value),timestamp:Z.timestamp,created_at:Z.created_at,updated_at:Z.updated_at}}async getAll(){return(await this.db.select().from(f).orderBy(g0(f.timestamp))).map(($)=>({key:$.key,namespace:$.namespace,value:this.safeDeserialize($.value),timestamp:$.timestamp,created_at:$.created_at,updated_at:$.updated_at}))}async search(_,$){if(!_||typeof _!=="string")throw Error("Search pattern must be a non-empty string");let X=_.replace(/[^a-zA-Z0-9\s*_\-]/g,"");if(X!==_)throw Error("Search pattern contains invalid characters");let Z=X.replace(/\*/g,"%"),J=Z1(f.key,Z);if($&&$!=="all"){if(!/^[a-zA-Z0-9_\-]+$/.test($))throw Error("Namespace contains invalid characters");J=K0(J,L(f.namespace,$))}return(await this.db.select().from(f).where(J).orderBy(g0(f.timestamp)).limit(1000)).map((Y)=>({key:Y.key,namespace:Y.namespace,value:this.safeDeserialize(Y.value),timestamp:Y.timestamp,created_at:Y.created_at,updated_at:Y.updated_at}))}async delete(_,$="default"){return(await this.db.delete(f).where(K0(L(f.key,_),L(f.namespace,$)))).rowsAffected>0}async clear(_){if(_&&_!=="all")await this.db.delete(f).where(L(f.namespace,_));else await this.db.delete(f)}async getStats(){let[_,$,X,Z]=await Promise.all([this.db.select({count:i0()}).from(f),this.db.select({namespace:f.namespace,count:i0()}).from(f).groupBy(f.namespace).orderBy(f.namespace),this.db.select({created_at:f.created_at}).from(f).orderBy(f.created_at).limit(1),this.db.select({created_at:f.created_at}).from(f).orderBy(g0(f.created_at)).limit(1)]),J=_[0]?.count||0,G=$.map((F)=>F.namespace),Y=Object.fromEntries($.map((F)=>[F.namespace,F.count])),z=X[0]?.created_at||null,H=Z[0]?.created_at||null;return{totalEntries:J,namespaces:G,namespaceCounts:Y,oldestEntry:z,newestEntry:H}}async load(){let _=await this.getAll(),$={};return _.forEach((X)=>{if(!$[X.namespace])$[X.namespace]={};$[X.namespace][X.key]=X.value}),{namespaces:$}}async close(){await this.drizzleDb.close()}getDatabasePath(){return this.drizzleDb.getDatabasePath()}async setCodebaseMetadata(_,$){let X=this.safeSerialize($);await this.db.insert(F2).values({key:_,value:X}).onConflictDoUpdate({target:F2.key,set:{value:X}})}async getCodebaseMetadata(_){let $=await this.db.select().from(F2).where(L(F2.key,_)).limit(1);if($.length===0)return null;return this.safeDeserialize($[0].value)}async upsertCodebaseFile(_){let $=new Date().toISOString();await this.db.insert(i).values({path:_.path,mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}).onConflictDoUpdate({target:i.path,set:{mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}})}async getCodebaseFile(_){let $=await this.db.select().from(i).where(L(i.path,_)).limit(1);return $.length>0?$[0]:null}async getAllCodebaseFiles(){return await this.db.select({path:i.path,mtime:i.mtime,hash:i.hash,content:i.content,language:i.language,size:i.size,indexedAt:i.indexedAt}).from(i).orderBy(i.path)}async deleteCodebaseFile(_){await this.db.delete(i).where(L(i.path,_))}async upsertTFIDFDocument(_,$){await this.db.insert(H2).values({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}).onConflictDoUpdate({target:H2.filePath,set:{magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}})}async getTFIDFDocument(_){let $=await this.db.select().from(H2).where(L(H2.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{...X,rawTerms:this.safeDeserialize(X.rawTerms)}}async setTFIDFTerms(_,$){if(await this.db.delete(N0).where(L(N0.filePath,_)),Object.keys($).length>0){let X=Object.entries($).map(([J,G])=>({filePath:_,term:J,frequency:G})),Z=100;for(let J=0;J<X.length;J+=100){let G=X.slice(J,J+100);await this.db.insert(N0).values(G)}}}async getTFIDFTerms(_){let $=await this.db.select().from(N0).where(L(N0.filePath,_)),X={};return $.forEach((Z)=>{X[Z.term]=Z.frequency}),X}async setIDFValues(_){if(await this.db.delete(t2),Object.keys(_).length>0){let $=Object.entries(_).map(([Z,J])=>({term:Z,idfValue:J})),X=100;for(let Z=0;Z<$.length;Z+=100){let J=$.slice(Z,Z+100);await this.db.insert(t2).values(J)}}}async getIDFValues(){let _=await this.db.select().from(t2),$={};return _.forEach((X)=>{$[X.term]=X.idfValue}),$}async getCodebaseIndexStats(){let $=(await this.db.select({count:i.path}).from(i)).length,Z=(await this.db.selectDistinct({term:N0.term}).from(N0)).length,[J,G]=await Promise.all([this.getCodebaseMetadata("indexedAt"),this.getCodebaseMetadata("version")]);return{fileCount:$,termCount:Z,indexedAt:J,version:G}}async clearCodebaseIndex(){await Promise.all([this.db.delete(i),this.db.delete(N0),this.db.delete(H2),this.db.delete(t2),this.db.delete(F2)])}async searchTFIDFTerms(_){if(!_||typeof _!=="string")throw Error("Term pattern must be a non-empty string");let $=_.replace(/[^a-zA-Z0-9\s_\-]/g,"");if($!==_)throw Error("Term pattern contains invalid characters");let X=`%${$}%`;return await this.db.select({path:i.path,term:N0.term,frequency:N0.frequency,language:i.language}).from(N0).innerJoin(i,L(N0.filePath,i.path)).where(Z1(N0.term,X)).orderBy(g0(N0.frequency)).limit(100)}}class gZ{memory;entries=[];running=!0;constructor(){this.memory=new P5}async start(){console.clear(),console.log(M.cyan.bold("\uD83E\uDDE0 Memory Manager")),console.log(M.gray(`Interactive memory management for Sylphx Flow
`)),await this.loadEntries();while(this.running)try{await this.showMainMenu()}catch(_){console.error(M.red(`Error: ${_}`)),await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}async loadEntries(){try{this.entries=await this.memory.getAll(),this.entries.sort((_,$)=>new Date($.updated_at).getTime()-new Date(_.updated_at).getTime())}catch(_){console.error(M.red(`Failed to load entries: ${_}`)),this.entries=[]}}async showMainMenu(){if(this.entries.length===0){console.log(M.yellow("No memory entries found."));let{action:X}=await c.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:[{name:"➕ Add new entry",value:"add"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh"},{name:"✗ Exit",value:"exit"}]}]);if(X==="add")await this.showAddEntry();else if(X==="refresh")await this.loadEntries();else this.running=!1;return}let _=[{name:"\uD83D\uDCDD View entry details",value:"view",short:"View"},{name:"✏️ Edit entry",value:"edit",short:"Edit"},{name:"➕ Add new entry",value:"add",short:"Add"},{name:"\uD83D\uDDD1️ Delete entry",value:"delete",short:"Delete"},{name:"\uD83D\uDD0D Search entries",value:"search",short:"Search"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh",short:"Refresh"},{name:"✗ Exit",value:"exit",short:"Exit"}],{action:$}=await c.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:_}]);switch($){case"view":await this.showViewEntry();break;case"edit":await this.showEditEntry();break;case"add":await this.showAddEntry();break;case"delete":await this.showDeleteEntry();break;case"search":await this.showSearchEntries();break;case"refresh":await this.loadEntries(),console.log(M.green("✓ Entries refreshed"));break;case"exit":this.running=!1;break}}async selectEntry(_,$=!1){if(this.entries.length===0){if($)return null;throw Error("No entries available")}let X=this.entries.map((J,G)=>({value:J,name:`${M.cyan(`${G+1}.`)} ${M.bold(J.namespace)}:${M.bold(J.key)}`,short:`${J.namespace}:${J.key}`}));if($)X.unshift({name:"← Back to menu",value:null,short:"Back"});let{selected:Z}=await c.prompt([{type:"list",name:"selected",message:_,choices:X,pageSize:15}]);return Z}async showViewEntry(){let _=await this.selectEntry("Select entry to view:",!0);if(!_)return;console.clear(),console.log(M.cyan.bold("\uD83D\uDCC4 Entry Details")),console.log(M.gray("─".repeat(50))),console.log(M.blue.bold("Namespace:"),_.namespace),console.log(M.blue.bold("Key:"),_.key),console.log(M.blue.bold("Updated:"),_.updated_at),console.log(M.blue.bold(`
Value:`));let $=JSON.stringify(_.value,null,2);console.log(M.gray($)),await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showEditEntry(){let _=await this.selectEntry("Select entry to edit:",!0);if(!_)return;console.clear(),console.log(M.yellow.bold("✏️ Edit Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Editing:")} ${_.namespace}:${_.key}
`);let $=await c.prompt([{type:"input",name:"namespace",message:"Namespace:",default:_.namespace,validate:(X)=>X.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",default:_.key,validate:(X)=>X.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:JSON.stringify(_.value,null,2),validate:(X)=>{try{return JSON.parse(X),!0}catch{return"Invalid JSON format"}}}]);try{let X=JSON.parse($.value);if(await this.memory.set($.key,X,$.namespace),$.namespace!==_.namespace||$.key!==_.key)await this.memory.delete(_.key,_.namespace);await this.loadEntries(),console.log(M.green(`✓ Updated ${$.namespace}:${$.key}`))}catch(X){console.error(M.red(`Failed to update entry: ${X}`))}await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showAddEntry(){console.clear(),console.log(M.green.bold("➕ Add New Entry")),console.log(M.gray("─".repeat(50)));let _=await c.prompt([{type:"input",name:"namespace",message:"Namespace:",default:"default",validate:($)=>$.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",validate:($)=>$.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:`{
  
}`,validate:($)=>{try{return JSON.parse($),!0}catch{return"Invalid JSON format"}}}]);try{let $=JSON.parse(_.value);await this.memory.set(_.key,$,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Added ${_.namespace}:${_.key}`))}catch($){console.error(M.red(`Failed to add entry: ${$}`))}await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showDeleteEntry(){let _=await this.selectEntry("Select entry to delete:",!0);if(!_)return;console.clear(),console.log(M.red.bold("\uD83D\uDDD1️ Delete Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Entry:")} ${_.namespace}:${_.key}`);let $=JSON.stringify(_.value),X=$.length>100?$.substring(0,100)+"...":$;console.log(`${M.blue("Value:")} ${M.gray(X)}`);let{confirmed:Z}=await c.prompt([{type:"confirm",name:"confirmed",message:M.yellow("Are you sure you want to delete this entry?"),default:!1}]);if(Z)try{await this.memory.delete(_.key,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Deleted ${_.namespace}:${_.key}`))}catch(J){console.error(M.red(`Failed to delete entry: ${J}`))}else console.log(M.gray("Delete cancelled"));await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showSearchEntries(){console.clear(),console.log(M.magenta.bold("\uD83D\uDD0D Search Entries")),console.log(M.gray("─".repeat(50)));let{query:_}=await c.prompt([{type:"input",name:"query",message:"Search query:",validate:(X)=>X.trim().length>0||"Search query is required"}]),$=this.entries.filter((X)=>X.namespace.toLowerCase().includes(_.toLowerCase())||X.key.toLowerCase().includes(_.toLowerCase())||JSON.stringify(X.value).toLowerCase().includes(_.toLowerCase()));if($.length===0)console.log(M.yellow("No entries found matching your search."));else console.log(M.cyan(`
Found ${$.length} matching entries:
`)),$.forEach((X,Z)=>{let J=JSON.stringify(X.value),G=J.length>80?J.substring(0,80)+"...":J;console.log(`${M.cyan(`${Z+1}.`)} ${M.bold(X.namespace)}:${M.bold(X.key)}`),console.log(`   ${M.gray(G)}
`)});await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}var pZ=async()=>{await new gZ().start()};var x5=async()=>{await pZ()},CT={name:"memory-tui",description:"Launch interactive memory management TUI",options:[{flags:"--target <type>",description:`Target platform (${v.getImplementedTargets().join(", ")}, default: auto-detect)`}],handler:x5};import mZ from"node:fs/promises";import uZ from"node:path";async function tW(_){if(_.target=await v.resolveTarget({target:_.target,allowSelection:!0}),!_.agent)_.agent="builder"}async function eW(_){try{let $=uZ.join(process.cwd(),"agents",`${_}.md`);try{return await mZ.readFile($,"utf-8")}catch(X){let Z=K8(),J=uZ.join(Z,`${_}.md`);return await mZ.readFile(J,"utf-8")}}catch($){throw new S(`Agent '${_}' not found`,"AGENT_NOT_FOUND")}}function _U(_){let $=/^---\s*\n[\s\S]*?\n---\s*\n/,X=_.match($);if(X)return _.substring(X[0].length).trim();return _.trim()}function $U(_,$,X,Z){let J=v.getTarget(_);if(!J)throw new S(`Target not found: ${_}`,"TARGET_NOT_FOUND");if(!J.isImplemented)throw new S(`Target '${_}' is not implemented. Supported targets: ${dZ().join(", ")}`,"TARGET_NOT_IMPLEMENTED");if(!J.executeCommand)throw new S(`Target '${_}' does not support command execution. Supported targets: ${dZ().join(", ")}`,"EXECUTION_NOT_SUPPORTED");return J.executeCommand($,X,Z)}function dZ(){return v.getImplementedTargetIDs().filter((_)=>{return v.getTarget(_)?.executeCommand!==void 0})}var cZ={name:"run",description:"Run a prompt with a specific agent (default: sparc-orchestrator) using the detected or specified target",options:[{flags:"--target <name>",description:`Target platform (${v.getImplementedTargetIDs().join(", ")}, default: auto-detect)`},{flags:"--agent <name>",description:"Agent to use (default: sparc-orchestrator)"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without executing the command"}],arguments:[{name:"prompt",description:"The prompt to execute with the agent (optional - if not provided, will start Claude Code interactively)",required:!1}],handler:async(_)=>{await tW(_);let{prompt:$,agent:X,verbose:Z}=_;if(Z){if(console.log("\uD83D\uDE80 Sylphx Flow Run"),console.log("===================="),console.log(`\uD83C\uDFAF Target: ${_.target}`),console.log(`\uD83E\uDD16 Agent: ${X}`),$)console.log(`\uD83D\uDCAC Prompt: ${$}`);else console.log("\uD83D\uDCAC Prompt: [Interactive mode]");console.log("")}let J=await eW(X),Y=`AGENT INSTRUCTIONS:
${_U(J)}`,z="";if($&&$.trim()!=="")z=$;if(Z)if(console.log("\uD83D\uDCDD System Prompt:"),console.log("================"),console.log(Y.substring(0,500)+(Y.length>500?"...":"")),console.log(""),z.trim()!=="")console.log("\uD83D\uDCDD User Prompt:"),console.log("=============="),console.log(z.substring(0,500)+(z.length>500?"...":"")),console.log("");else console.log("\uD83D\uDCDD User Prompt: [Interactive mode - Claude will greet the user]"),console.log("");await $U(_.target,Y,z,_)}};import n from"node:fs/promises";import M0 from"node:path";import{spawn as iZ}from"node:child_process";class nZ{outputs=new Map;maxLines=5;addOutput(_,$){if(!this.outputs.has(_))this.outputs.set(_,[]);let X=this.outputs.get(_);if(X.push(...$.split(`
`).filter((Z)=>Z.trim())),X.length>this.maxLines)X.splice(0,X.length-this.maxLines)}display(){console.clear(),console.log(`\uD83E\uDD16 Agent Monitor - Real-time Output
`);for(let[_,$]of this.outputs)if($.length>0)console.log(`\uD83D\uDCCB ${_}:`),$.forEach((X)=>console.log(`   ${X}`)),console.log("")}}var D8=["craftsman","practitioner","craftsman-reflective","practitioner-reflective"];async function XU(_){if(console.log("DEBUG: Initial options.output =",_.output),!_.task)throw new S("Task file is required. Use --task <path-to-task-file>");try{await n.access(_.task)}catch{throw new S(`Task file not found: ${_.task}`)}if(!_.output){let $=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);_.output=`/tmp/agent-benchmark-${$}`,console.log("DEBUG: Set default options.output =",_.output)}if(!_.agents)_.agents="all";if(!_.context)_.context="";if(_.evaluate===void 0)_.evaluate=!0;if(!_.concurrency)_.concurrency=1;if(!_.delay)_.delay=5}async function ZU(_){try{await n.mkdir(_,{recursive:!0}),console.log(`\uD83D\uDCC1 Created benchmark directory: ${_}`)}catch($){throw new S(`Failed to create benchmark directory: ${$}`)}}async function JU(_,$,X){let Z=await n.readFile(_,"utf-8");if(await n.writeFile(M0.join(X,"task-definition.txt"),Z),$)try{let J=await n.readFile($,"utf-8");await n.writeFile(M0.join(X,"context-info.txt"),J),console.log(`\uD83D\uDCC4 Copied context file: ${$}`)}catch(J){console.warn(`⚠️  Warning: Could not read context file: ${J}`)}console.log(`\uD83D\uDCCB Task definition copied from: ${_}`)}async function GU(_){if(_==="all")return D8;let $=_.split(",").map((X)=>X.trim());for(let X of $)if(!D8.includes(X))throw new S(`Invalid agent: ${X}. Available agents: ${D8.join(", ")}`);return $}async function lZ(_,$,X,Z,J,G=3){let Y=M0.join($,_);await n.mkdir(Y,{recursive:!0});let z=K8(),H=M0.join(z,`${_}.md`);try{let F=await n.readFile(H,"utf-8"),W=await n.readFile(X,"utf-8"),A=W;if(Z)try{A=`CONTEXT:
${await n.readFile(Z,"utf-8")}

TASK:
${W}`}catch(O){console.warn(`⚠️  Warning: Could not read context file: ${O}`)}A+=`

IMPORTANT: Please implement your solution in the current working directory: ${Y}
This is a temporary directory for testing, so you can create files freely without affecting any production codebase.`,console.log(`\uD83D\uDE80 Running agent: ${_} in ${Y}`),console.log(`\uD83D\uDCDD Claude command: claude --system-prompt [${F.length} chars] --dangerously-skip-permissions --print [${A.length} chars]`);let D=async()=>{let O=M0.join(Y,".agent-prompt.md");return await n.writeFile(O,F),new Promise((N,I)=>{let j=iZ("claude",["--system-prompt",`@${O}`,"--dangerously-skip-permissions","--print",A],{cwd:Y,stdio:["inherit","pipe","pipe"]}),w=setTimeout(()=>{console.log(`⏱️ Timeout reached for ${_}, terminating process...`),j.kill("SIGTERM"),I(Error(`Agent ${_} timed out after 60 seconds`))},60000),q="",t="";j.stdout?.on("data",(u)=>{let E=u.toString();q+=E,process.stdout.write(`[${_}] ${E}`)}),j.stderr?.on("data",(u)=>{let E=u.toString();t+=E,process.stderr.write(`[${_} ERROR] ${E}`)}),j.on("close",async(u)=>{clearTimeout(w);try{await n.unlink(O)}catch(E){}if(u===0)await n.writeFile(M0.join(Y,"execution-log.txt"),q),console.log(`✅ Agent ${_} completed successfully`),N();else await n.writeFile(M0.join(Y,"execution-error.txt"),t),I(Error(`Agent ${_} failed with code ${u}`))}),j.on("error",(u)=>{I(u)})})},R;for(let O=1;O<=G;O++)try{await D();return}catch(N){if(R=N,console.warn(`⚠️  Agent ${_} attempt ${O} failed: ${N}`),O<G){let I=Math.pow(2,O)*2000;console.log(`⏳ Waiting ${I/1000}s before retry...`),await new Promise((j)=>setTimeout(j,I))}}throw R||Error(`Agent ${_} failed after ${G} attempts`)}catch(F){throw new S(`Failed to load agent ${_}: ${F}`)}}async function YU(_,$,X){console.log("\uD83D\uDD0D Evaluating code created by agents...");let Z=`
Please evaluate the code and solutions created by these four software engineering agents. For each agent, analyze their work by examining the files they created in their respective directories.

For each agent, evaluate:

1. **Code Quality** (1-10): Readability, structure, naming conventions, code organization
2. **Architecture Design** (1-10): Modularity, scalability, separation of concerns, best practices
3. **Functionality** (1-10): Requirements satisfaction, error handling, feature completeness
4. **Testing Coverage** (1-10): Test quality, coverage, testing strategies used
5. **Documentation** (1-10): Code comments, README files, API documentation, setup instructions
6. **Business Value** (1-10): Practicality, maintainability, innovation, solution effectiveness

Agents to evaluate:
- craftsman: Idealistic craftsman with principles-based approach
- practitioner: Pragmatic practitioner with business-focused approach
- craftsman-reflective: Idealistic craftsman with reflective questioning
- practitioner-reflective: Pragmatic practitioner with contextual decision-making

For each agent, please:
1. Examine all files they created in their directory
2. Analyze the code quality and architecture
3. Check if requirements were met
4. Evaluate the overall solution quality
5. Compare approaches between agents

Please provide:
1. Detailed scoring for each agent (1-10 scale)
2. Analysis of differences between approaches
3. What each agent excels at
4. Recommendations for different use cases
5. Overall comparison and insights

Format your response as a structured evaluation report with clear sections for each agent.
`,J=D8.map((A)=>M0.join(_,A)),G={};for(let A of J){let D=M0.basename(A);try{let R=await n.readdir(A),O=`=== ${D} WORK ===

`;for(let N of R){let I=M0.join(A,N);if((await n.stat(I)).isFile()){let w=await n.readFile(I,"utf-8");O+=`
--- File: ${N} ---
${w}
`}}G[D]=O}catch(R){G[D]=`=== ${D} WORK ===

ERROR: Could not read files - ${R}`}}let Y=Object.values(G).join(`
`+"=".repeat(80)+`
`),z=Z+`

AGENT WORK TO EVALUATE:
`+Y,H=M0.join(_,".evaluation-prompt.md");await n.writeFile(H,z);let F=iZ("claude",["--system-prompt",`@${H}`,"--dangerously-skip-permissions","--print","Please evaluate the agent work as described in the system prompt."],{cwd:_,stdio:["inherit","pipe","pipe"]}),W="";return F.stdout?.on("data",(A)=>{W+=A.toString()}),new Promise((A,D)=>{F.on("close",async(R)=>{if(R===0){let O=M0.join(_,"evaluation-report.md");await n.writeFile(O,W);let N=Object.entries(G).map(([j,w])=>{let q=(w.match(/--- File: /g)||[]).length;return`${j}: ${q} files created`}).join(`
`),I=M0.join(_,"summary.txt");await n.writeFile(I,N);try{await n.unlink(H)}catch(j){}if(console.log("\uD83D\uDCCA Evaluation completed"),console.log(`\uD83D\uDCC4 Report saved to: ${O}`),$){let j=M0.join(process.cwd(),$,"evaluation-report.md"),w=M0.join(process.cwd(),$,"summary.txt");await n.mkdir(M0.dirname(j),{recursive:!0}),await n.writeFile(j,W),await n.writeFile(w,N),console.log(`\uD83D\uDCC4 Report also saved to: ${j}`)}console.log("\uD83D\uDCCB Summary of created files saved"),A()}else D(Error(`Evaluation failed with code ${R}`))}),F.on("error",(R)=>{D(R)})})}async function zU(_,$,X,Z,J,G){console.log(`\uD83D\uDD04 Running ${_.length} agents with concurrency: ${J}, delay: ${G}s`);let Y=new nZ;if(J<=1){console.log("\uD83D\uDCDD Running agents sequentially...");for(let z of _)try{if(await lZ(z,$,X,Z,Y),z!==_[_.length-1])Y.display(),console.log(`⏳ Waiting ${G}s before next agent...`),await new Promise((H)=>setTimeout(H,G*1000))}catch(H){Y.addOutput(z,`❌ ERROR: ${H}`),Y.display(),console.error(`❌ Agent ${z} failed:`,H)}}else{let z=[];for(let H=0;H<_.length;H+=J)z.push(_.slice(H,H+J));for(let H=0;H<z.length;H++){console.log(`\uD83D\uDD04 Running chunk ${H+1}/${z.length} (${z[H].length} agents)...`);let F=z[H].map((W)=>lZ(W,$,X,Z,Y));try{await Promise.all(F),Y.display(),console.log(`✅ Chunk ${H+1} completed`)}catch(W){Y.addOutput(`Chunk ${H+1}`,`❌ ERROR: ${W}`),Y.display(),console.error(`❌ Chunk ${H+1} had failures:`,W)}if(H<z.length-1)console.log(`⏳ Waiting ${G}s before next chunk...`),await new Promise((W)=>setTimeout(W,G*1000))}}Y.display(),console.log("✅ All agent executions completed")}var oZ={name:"benchmark",description:"Run benchmark tests comparing multiple agent designs",options:[{flags:"--agents <agents>",description:'Agents to test (comma-separated or "all", default: all)',defaultValue:"all"},{flags:"--task <file>",description:"Path to task definition file",required:!0},{flags:"--output <dir>",description:"Output directory for results (default: /tmp/agent-benchmark-TIMESTAMP)"},{flags:"--context <file>",description:"Path to context information file (optional)"},{flags:"--no-evaluate",description:"Skip LLM evaluation after agents complete"},{flags:"--report <dir>",description:"Directory to save evaluation reports (in addition to /tmp output)"},{flags:"--concurrency <number>",description:"Number of agents to run concurrently (default: 1)",defaultValue:"1"},{flags:"--delay <seconds>",description:"Delay in seconds between agent executions (default: 5)",defaultValue:"5"}],handler:async(_)=>{try{await XU(_),console.log("\uD83C\uDFAF Starting agent benchmark test"),console.log(`\uD83D\uDCC1 Output directory: ${_.output}`),await ZU(_.output),await JU(_.task,_.context,_.output);let $=await GU(_.agents);if(console.log(`\uD83E\uDD16 Testing agents: ${$.join(", ")}`),await zU($,_.output,_.task,_.context,_.concurrency,_.delay),_.evaluate)await YU(_.output,_.report,_);console.log("\uD83C\uDF89 Benchmark completed!"),console.log(`\uD83D\uDCC1 Results saved to: ${_.output}`)}catch($){throw new S(`Benchmark failed: ${$}`)}}};function q5(_){let $=new B0(_.name);$.description(_.description);for(let X of _.options||[])$.option(X.flags,X.description,X.defaultValue);if(_.arguments)for(let X of _.arguments){let Z=X.name==="servers"?`[${X.name}...]`:X.required?`<${X.name}>`:`[${X.name}]`;$.argument(Z,X.description)}if(_.subcommands)for(let X of _.subcommands)$.addCommand(q5(X));if(_.handler){let X=sZ(_.handler,_.name);if(_.validator)$.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,H)=>{if(H<J.length)Y[z.name]=J[H]});return _.validator?.(Y),X(Y)});else $.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,H)=>{if(H<J.length)Y[z.name]=J[H]});return X(Y)})}return $}var oT=[{flags:"--target <type>",description:"Force specific target"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--mcp [servers...]",description:`Install MCP servers (${rZ().join(", ")})`}];function aZ(){console.log("\uD83D\uDE80 Sylphx Flow CLI - Type-safe development flow"),console.log("========================================="),console.log(""),console.log("Available commands:"),console.log("  init     Initialize project with Sylphx Flow"),console.log("  mcp      Manage MCP tools"),console.log("  memory   Manage memory storage"),console.log("  tui      Interactive TUI for all operations"),console.log(""),console.log("Examples:"),console.log("  sylphx-flow init"),console.log("  sylphx-flow init --target opencode"),console.log("  sylphx-flow mcp install --all"),console.log("  sylphx-flow memory set key value"),console.log("  sylphx-flow tui"),console.log(""),console.log('Run "sylphx-flow <command> --help" for more information about a command.')}function HU(){let _=new B0;_.name("sylphx-flow").description("Sylphx Flow - Type-safe development flow CLI").version("1.0.0");let $=[kZ,hZ,yZ,cZ,oZ];_.addCommand(BZ),_.addCommand(a2);for(let X of $)_.addCommand(q5(X));return _.command("tui").description("Launch interactive Sylphx Flow TUI").option("--target <type>","Target platform (opencode, default: auto-detect)").action(x5),_.action(()=>{aZ()}),_}function tZ(){let _=HU();if(process.argv.length===2)_.help();process.on("uncaughtException",($)=>{console.error(`✗ Uncaught error: ${$.message}`),process.exit(1)}),process.on("unhandledRejection",($)=>{console.error(`✗ Unhandled rejection: ${$}`),process.exit(1)});try{_.parse()}catch($){console.error(`✗ Error: ${$.message}`),process.exit(1)}}tZ();
