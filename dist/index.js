#!/usr/bin/env node
import{a as pZ,b as A5,c as VZ}from"./paths-2re3k191.js";import{e as Y8}from"./index-wyc164dh.js";import{f as h,g as uZ}from"./error-handler-s33btwbj.js";import{h as U0,i as dZ}from"./servers-kk8achc3.js";import{j as d,k as wZ,l as q}from"./index-jxkn0z7w.js";import"./targets-eqj2n0rv.js";import{s as H8}from"./secret-utils-zft4mj2q.js";import{u as O5}from"./index-bj3p86hf.js";import{A as S,x as Q0,y as u,z as Y6}from"./index-cq9vs79a.js";var t2=u((sZ)=>{class U8 extends Error{constructor(_,$,X){super(X);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=_,this.nestedError=void 0}}class P5 extends U8{constructor(_){super(1,"commander.invalidArgument",_);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}sZ.CommanderError=U8;sZ.InvalidArgumentError=P5});var e_=u((_J)=>{var{InvalidArgumentError:tZ}=t2();class w5{constructor(_,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,_[0]){case"<":this.required=!0,this._name=_.slice(1,-1);break;case"[":this.required=!1,this._name=_.slice(1,-1);break;default:this.required=!0,this._name=_;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}argParser(_){return this.parseArg=_,this}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new tZ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function eZ(_){let $=_.name()+(_.variadic===!0?"...":"");return _.required?"<"+$+">":"["+$+"]"}_J.Argument=w5;_J.humanReadableArgName=eZ});var A8=u((JJ)=>{var{humanReadableArgName:ZJ}=e_();class x5{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(_){let $=_.commands.filter((Z)=>!Z._hidden),X=_._getHelpCommand();if(X&&!X._hidden)$.push(X);if(this.sortSubcommands)$.sort((Z,J)=>{return Z.name().localeCompare(J.name())});return $}compareOptions(_,$){let X=(Z)=>{return Z.short?Z.short.replace(/^-/,""):Z.long.replace(/^--/,"")};return X(_).localeCompare(X($))}visibleOptions(_){let $=_.options.filter((Z)=>!Z.hidden),X=_._getHelpOption();if(X&&!X.hidden){let Z=X.short&&_._findOption(X.short),J=X.long&&_._findOption(X.long);if(!Z&&!J)$.push(X);else if(X.long&&!J)$.push(_.createOption(X.long,X.description));else if(X.short&&!Z)$.push(_.createOption(X.short,X.description))}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(_){if(!this.showGlobalOptions)return[];let $=[];for(let X=_.parent;X;X=X.parent){let Z=X.options.filter((J)=>!J.hidden);$.push(...Z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(_){if(_._argsDescription)_.registeredArguments.forEach(($)=>{$.description=$.description||_._argsDescription[$.name()]||""});if(_.registeredArguments.find(($)=>$.description))return _.registeredArguments;return[]}subcommandTerm(_){let $=_.registeredArguments.map((X)=>ZJ(X)).join(" ");return _._name+(_._aliases[0]?"|"+_._aliases[0]:"")+(_.options.length?" [options]":"")+($?" "+$:"")}optionTerm(_){return _.flags}argumentTerm(_){return _.name()}longestSubcommandTermLength(_,$){return $.visibleCommands(_).reduce((X,Z)=>{return Math.max(X,$.subcommandTerm(Z).length)},0)}longestOptionTermLength(_,$){return $.visibleOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestGlobalOptionTermLength(_,$){return $.visibleGlobalOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestArgumentTermLength(_,$){return $.visibleArguments(_).reduce((X,Z)=>{return Math.max(X,$.argumentTerm(Z).length)},0)}commandUsage(_){let $=_._name;if(_._aliases[0])$=$+"|"+_._aliases[0];let X="";for(let Z=_.parent;Z;Z=Z.parent)X=Z.name()+" "+X;return X+$+" "+_.usage()}commandDescription(_){return _.description()}subcommandDescription(_){return _.summary()||_.description()}optionDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0){if(_.required||_.optional||_.isBoolean()&&typeof _.defaultValue==="boolean")$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`)}if(_.presetArg!==void 0&&_.optional)$.push(`preset: ${JSON.stringify(_.presetArg)}`);if(_.envVar!==void 0)$.push(`env: ${_.envVar}`);if($.length>0)return`${_.description} (${$.join(", ")})`;return _.description}argumentDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0)$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`);if($.length>0){let X=`(${$.join(", ")})`;if(_.description)return`${_.description} ${X}`;return X}return _.description}formatHelp(_,$){let X=$.padWidth(_,$),Z=$.helpWidth||80,J=2,G=2;function Y(O,R){if(R){let N=`${O.padEnd(X+2)}${R}`;return $.wrap(N,Z-2,X+2)}return O}function z(O){return O.join(`
`).replace(/^/gm," ".repeat(2))}let F=[`Usage: ${$.commandUsage(_)}`,""],H=$.commandDescription(_);if(H.length>0)F=F.concat([$.wrap(H,Z,0),""]);let W=$.visibleArguments(_).map((O)=>{return Y($.argumentTerm(O),$.argumentDescription(O))});if(W.length>0)F=F.concat(["Arguments:",z(W),""]);let A=$.visibleOptions(_).map((O)=>{return Y($.optionTerm(O),$.optionDescription(O))});if(A.length>0)F=F.concat(["Options:",z(A),""]);if(this.showGlobalOptions){let O=$.visibleGlobalOptions(_).map((R)=>{return Y($.optionTerm(R),$.optionDescription(R))});if(O.length>0)F=F.concat(["Global Options:",z(O),""])}let D=$.visibleCommands(_).map((O)=>{return Y($.subcommandTerm(O),$.subcommandDescription(O))});if(D.length>0)F=F.concat(["Commands:",z(D),""]);return F.join(`
`)}padWidth(_,$){return Math.max($.longestOptionTermLength(_,$),$.longestGlobalOptionTermLength(_,$),$.longestSubcommandTermLength(_,$),$.longestArgumentTermLength(_,$))}wrap(_,$,X,Z=40){let G=new RegExp(`[\\n][${" \\f\\t\\v   -   　\uFEFF"}]+`);if(_.match(G))return _;let Y=$-X;if(Y<Z)return _;let z=_.slice(0,X),F=_.slice(X).replace(`\r
`,`
`),H=" ".repeat(X),A=`\\s${"​"}`,D=new RegExp(`
|.{1,${Y-1}}([${A}]|$)|[^${A}]+?([${A}]|$)`,"g"),O=F.match(D)||[];return z+O.map((R,N)=>{if(R===`
`)return"";return(N>0?H:"")+R.trimEnd()}).join(`
`)}}JJ.Help=x5});var K8=u((HJ)=>{var{InvalidArgumentError:YJ}=t2();class q5{constructor(_,$){this.flags=_,this.description=$||"",this.required=_.includes("<"),this.optional=_.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(_),this.mandatory=!1;let X=FJ(_);if(this.short=X.shortFlag,this.long=X.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}preset(_){return this.presetArg=_,this}conflicts(_){return this.conflictsWith=this.conflictsWith.concat(_),this}implies(_){let $=_;if(typeof _==="string")$={[_]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(_){return this.envVar=_,this}argParser(_){return this.parseArg=_,this}makeOptionMandatory(_=!0){return this.mandatory=!!_,this}hideHelp(_=!0){return this.hidden=!!_,this}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new YJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return zJ(this.name().replace(/^no-/,""))}is(_){return this.short===_||this.long===_}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class C5{constructor(_){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,_.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,X)=>{if(this.positiveOptions.has(X))this.dualOptions.add(X)})}valueFromOption(_,$){let X=$.attributeName();if(!this.dualOptions.has(X))return!0;let Z=this.negativeOptions.get(X).presetArg,J=Z!==void 0?Z:!1;return $.negate===(J===_)}}function zJ(_){return _.split("-").reduce(($,X)=>{return $+X[0].toUpperCase()+X.slice(1)})}function FJ(_){let $,X,Z=_.split(/[ |,]+/);if(Z.length>1&&!/^[[<]/.test(Z[1]))$=Z.shift();if(X=Z.shift(),!$&&/^-[^-]$/.test(X))$=X,X=void 0;return{shortFlag:$,longFlag:X}}HJ.Option=q5;HJ.DualOptions=C5});var S5=u((DJ)=>{function AJ(_,$){if(Math.abs(_.length-$.length)>3)return Math.max(_.length,$.length);let X=[];for(let Z=0;Z<=_.length;Z++)X[Z]=[Z];for(let Z=0;Z<=$.length;Z++)X[0][Z]=Z;for(let Z=1;Z<=$.length;Z++)for(let J=1;J<=_.length;J++){let G=1;if(_[J-1]===$[Z-1])G=0;else G=1;if(X[J][Z]=Math.min(X[J-1][Z]+1,X[J][Z-1]+1,X[J-1][Z-1]+G),J>1&&Z>1&&_[J-1]===$[Z-2]&&_[J-2]===$[Z-1])X[J][Z]=Math.min(X[J][Z],X[J-2][Z-2]+1)}return X[_.length][$.length]}function KJ(_,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let X=_.startsWith("--");if(X)_=_.slice(2),$=$.map((Y)=>Y.slice(2));let Z=[],J=3,G=0.4;if($.forEach((Y)=>{if(Y.length<=1)return;let z=AJ(_,Y),F=Math.max(_.length,Y.length);if((F-z)/F>G){if(z<J)J=z,Z=[Y];else if(z===J)Z.push(Y)}}),Z.sort((Y,z)=>Y.localeCompare(z)),X)Z=Z.map((Y)=>`--${Y}`);if(Z.length>1)return`
(Did you mean one of ${Z.join(", ")}?)`;if(Z.length===1)return`
(Did you mean ${Z[0]}?)`;return""}DJ.suggestSimilar=KJ});var y5=u((IJ)=>{var RJ=S("node:events").EventEmitter,D8=S("node:child_process"),U1=S("node:path"),O8=S("node:fs"),r=S("node:process"),{Argument:VJ,humanReadableArgName:NJ}=e_(),{CommanderError:R8}=t2(),{Help:MJ}=A8(),{Option:k5,DualOptions:BJ}=K8(),{suggestSimilar:v5}=S5();class V8 extends RJ{constructor(_){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=_||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>r.stdout.write($),writeErr:($)=>r.stderr.write($),getOutHelpWidth:()=>r.stdout.isTTY?r.stdout.columns:void 0,getErrHelpWidth:()=>r.stderr.isTTY?r.stderr.columns:void 0,outputError:($,X)=>X($)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(_){return this._outputConfiguration=_._outputConfiguration,this._helpOption=_._helpOption,this._helpCommand=_._helpCommand,this._helpConfiguration=_._helpConfiguration,this._exitCallback=_._exitCallback,this._storeOptionsAsProperties=_._storeOptionsAsProperties,this._combineFlagAndOptionalValue=_._combineFlagAndOptionalValue,this._allowExcessArguments=_._allowExcessArguments,this._enablePositionalOptions=_._enablePositionalOptions,this._showHelpAfterError=_._showHelpAfterError,this._showSuggestionAfterError=_._showSuggestionAfterError,this}_getCommandAndAncestors(){let _=[];for(let $=this;$;$=$.parent)_.push($);return _}command(_,$,X){let Z=$,J=X;if(typeof Z==="object"&&Z!==null)J=Z,Z=null;J=J||{};let[,G,Y]=_.match(/([^ ]+) *(.*)/),z=this.createCommand(G);if(Z)z.description(Z),z._executableHandler=!0;if(J.isDefault)this._defaultCommandName=z._name;if(z._hidden=!!(J.noHelp||J.hidden),z._executableFile=J.executableFile||null,Y)z.arguments(Y);if(this._registerCommand(z),z.parent=this,z.copyInheritedSettings(this),Z)return this;return z}createCommand(_){return new V8(_)}createHelp(){return Object.assign(new MJ,this.configureHelp())}configureHelp(_){if(_===void 0)return this._helpConfiguration;return this._helpConfiguration=_,this}configureOutput(_){if(_===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,_),this}showHelpAfterError(_=!0){if(typeof _!=="string")_=!!_;return this._showHelpAfterError=_,this}showSuggestionAfterError(_=!0){return this._showSuggestionAfterError=!!_,this}addCommand(_,$){if(!_._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=_._name;if($.noHelp||$.hidden)_._hidden=!0;return this._registerCommand(_),_.parent=this,_._checkForBrokenPassThrough(),this}createArgument(_,$){return new VJ(_,$)}argument(_,$,X,Z){let J=this.createArgument(_,$);if(typeof X==="function")J.default(Z).argParser(X);else J.default(X);return this.addArgument(J),this}arguments(_){return _.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(_){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw Error(`only the last argument can be variadic '${$.name()}'`);if(_.required&&_.defaultValue!==void 0&&_.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${_.name()}'`);return this.registeredArguments.push(_),this}helpCommand(_,$){if(typeof _==="boolean")return this._addImplicitHelpCommand=_,this;_=_??"help [command]";let[,X,Z]=_.match(/([^ ]+) *(.*)/),J=$??"display help for command",G=this.createCommand(X);if(G.helpOption(!1),Z)G.arguments(Z);if(J)G.description(J);return this._addImplicitHelpCommand=!0,this._helpCommand=G,this}addHelpCommand(_,$){if(typeof _!=="object")return this.helpCommand(_,$),this;return this._addImplicitHelpCommand=!0,this._helpCommand=_,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook(_,$){let X=["preSubcommand","preAction","postAction"];if(!X.includes(_))throw Error(`Unexpected value for event passed to hook : '${_}'.
Expecting one of '${X.join("', '")}'`);if(this._lifeCycleHooks[_])this._lifeCycleHooks[_].push($);else this._lifeCycleHooks[_]=[$];return this}exitOverride(_){if(_)this._exitCallback=_;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(_,$,X){if(this._exitCallback)this._exitCallback(new R8(_,$,X));r.exit(_)}action(_){let $=(X)=>{let Z=this.registeredArguments.length,J=X.slice(0,Z);if(this._storeOptionsAsProperties)J[Z]=this;else J[Z]=this.opts();return J.push(this),_.apply(this,J)};return this._actionHandler=$,this}createOption(_,$){return new k5(_,$)}_callParseArg(_,$,X,Z){try{return _.parseArg($,X)}catch(J){if(J.code==="commander.invalidArgument"){let G=`${Z} ${J.message}`;this.error(G,{exitCode:J.exitCode,code:J.code})}throw J}}_registerOption(_){let $=_.short&&this._findOption(_.short)||_.long&&this._findOption(_.long);if($){let X=_.long&&this._findOption(_.long)?_.long:_.short;throw Error(`Cannot add option '${_.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${X}'
-  already used by option '${$.flags}'`)}this.options.push(_)}_registerCommand(_){let $=(Z)=>{return[Z.name()].concat(Z.aliases())},X=$(_).find((Z)=>this._findCommand(Z));if(X){let Z=$(this._findCommand(X)).join("|"),J=$(_).join("|");throw Error(`cannot add command '${J}' as already have command '${Z}'`)}this.commands.push(_)}addOption(_){this._registerOption(_);let $=_.name(),X=_.attributeName();if(_.negate){let J=_.long.replace(/^--no-/,"--");if(!this._findOption(J))this.setOptionValueWithSource(X,_.defaultValue===void 0?!0:_.defaultValue,"default")}else if(_.defaultValue!==void 0)this.setOptionValueWithSource(X,_.defaultValue,"default");let Z=(J,G,Y)=>{if(J==null&&_.presetArg!==void 0)J=_.presetArg;let z=this.getOptionValue(X);if(J!==null&&_.parseArg)J=this._callParseArg(_,J,z,G);else if(J!==null&&_.variadic)J=_._concatValue(J,z);if(J==null)if(_.negate)J=!1;else if(_.isBoolean()||_.optional)J=!0;else J="";this.setOptionValueWithSource(X,J,Y)};if(this.on("option:"+$,(J)=>{let G=`error: option '${_.flags}' argument '${J}' is invalid.`;Z(J,G,"cli")}),_.envVar)this.on("optionEnv:"+$,(J)=>{let G=`error: option '${_.flags}' value '${J}' from env '${_.envVar}' is invalid.`;Z(J,G,"env")});return this}_optionEx(_,$,X,Z,J){if(typeof $==="object"&&$ instanceof k5)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let G=this.createOption($,X);if(G.makeOptionMandatory(!!_.mandatory),typeof Z==="function")G.default(J).argParser(Z);else if(Z instanceof RegExp){let Y=Z;Z=(z,F)=>{let H=Y.exec(z);return H?H[0]:F},G.default(J).argParser(Z)}else G.default(Z);return this.addOption(G)}option(_,$,X,Z){return this._optionEx({},_,$,X,Z)}requiredOption(_,$,X,Z){return this._optionEx({mandatory:!0},_,$,X,Z)}combineFlagAndOptionalValue(_=!0){return this._combineFlagAndOptionalValue=!!_,this}allowUnknownOption(_=!0){return this._allowUnknownOption=!!_,this}allowExcessArguments(_=!0){return this._allowExcessArguments=!!_,this}enablePositionalOptions(_=!0){return this._enablePositionalOptions=!!_,this}passThroughOptions(_=!0){return this._passThroughOptions=!!_,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(_=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!_,this}getOptionValue(_){if(this._storeOptionsAsProperties)return this[_];return this._optionValues[_]}setOptionValue(_,$){return this.setOptionValueWithSource(_,$,void 0)}setOptionValueWithSource(_,$,X){if(this._storeOptionsAsProperties)this[_]=$;else this._optionValues[_]=$;return this._optionValueSources[_]=X,this}getOptionValueSource(_){return this._optionValueSources[_]}getOptionValueSourceWithGlobals(_){let $;return this._getCommandAndAncestors().forEach((X)=>{if(X.getOptionValueSource(_)!==void 0)$=X.getOptionValueSource(_)}),$}_prepareUserArgs(_,$){if(_!==void 0&&!Array.isArray(_))throw Error("first parameter to parse must be array or undefined");if($=$||{},_===void 0&&$.from===void 0){if(r.versions?.electron)$.from="electron";let Z=r.execArgv??[];if(Z.includes("-e")||Z.includes("--eval")||Z.includes("-p")||Z.includes("--print"))$.from="eval"}if(_===void 0)_=r.argv;this.rawArgs=_.slice();let X;switch($.from){case void 0:case"node":this._scriptPath=_[1],X=_.slice(2);break;case"electron":if(r.defaultApp)this._scriptPath=_[1],X=_.slice(2);else X=_.slice(1);break;case"user":X=_.slice(0);break;case"eval":X=_.slice(1);break;default:throw Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",X}parse(_,$){let X=this._prepareUserArgs(_,$);return this._parseCommand([],X),this}async parseAsync(_,$){let X=this._prepareUserArgs(_,$);return await this._parseCommand([],X),this}_executeSubCommand(_,$){$=$.slice();let X=!1,Z=[".js",".ts",".tsx",".mjs",".cjs"];function J(H,W){let A=U1.resolve(H,W);if(O8.existsSync(A))return A;if(Z.includes(U1.extname(W)))return;let D=Z.find((O)=>O8.existsSync(`${A}${O}`));if(D)return`${A}${D}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let G=_._executableFile||`${this._name}-${_._name}`,Y=this._executableDir||"";if(this._scriptPath){let H;try{H=O8.realpathSync(this._scriptPath)}catch(W){H=this._scriptPath}Y=U1.resolve(U1.dirname(H),Y)}if(Y){let H=J(Y,G);if(!H&&!_._executableFile&&this._scriptPath){let W=U1.basename(this._scriptPath,U1.extname(this._scriptPath));if(W!==this._name)H=J(Y,`${W}-${_._name}`)}G=H||G}X=Z.includes(U1.extname(G));let z;if(r.platform!=="win32")if(X)$.unshift(G),$=h5(r.execArgv).concat($),z=D8.spawn(r.argv[0],$,{stdio:"inherit"});else z=D8.spawn(G,$,{stdio:"inherit"});else $.unshift(G),$=h5(r.execArgv).concat($),z=D8.spawn(r.execPath,$,{stdio:"inherit"});if(!z.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((W)=>{r.on(W,()=>{if(z.killed===!1&&z.exitCode===null)z.kill(W)})});let F=this._exitCallback;z.on("close",(H)=>{if(H=H??1,!F)r.exit(H);else F(new R8(H,"commander.executeSubCommandAsync","(close)"))}),z.on("error",(H)=>{if(H.code==="ENOENT"){let W=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",A=`'${G}' does not exist
 - if '${_._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${W}`;throw Error(A)}else if(H.code==="EACCES")throw Error(`'${G}' not executable`);if(!F)r.exit(1);else{let W=new R8(1,"commander.executeSubCommandAsync","(error)");W.nestedError=H,F(W)}}),this.runningCommand=z}_dispatchSubcommand(_,$,X){let Z=this._findCommand(_);if(!Z)this.help({error:!0});let J;return J=this._chainOrCallSubCommandHook(J,Z,"preSubcommand"),J=this._chainOrCall(J,()=>{if(Z._executableHandler)this._executeSubCommand(Z,$.concat(X));else return Z._parseCommand($,X)}),J}_dispatchHelpCommand(_){if(!_)this.help();let $=this._findCommand(_);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(_,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((_,$)=>{if(_.required&&this.args[$]==null)this.missingArgument(_.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let _=(X,Z,J)=>{let G=Z;if(Z!==null&&X.parseArg){let Y=`error: command-argument value '${Z}' is invalid for argument '${X.name()}'.`;G=this._callParseArg(X,Z,J,Y)}return G};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((X,Z)=>{let J=X.defaultValue;if(X.variadic){if(Z<this.args.length){if(J=this.args.slice(Z),X.parseArg)J=J.reduce((G,Y)=>{return _(X,Y,G)},X.defaultValue)}else if(J===void 0)J=[]}else if(Z<this.args.length){if(J=this.args[Z],X.parseArg)J=_(X,J,X.defaultValue)}$[Z]=J}),this.processedArgs=$}_chainOrCall(_,$){if(_&&_.then&&typeof _.then==="function")return _.then(()=>$());return $()}_chainOrCallHooks(_,$){let X=_,Z=[];if(this._getCommandAndAncestors().reverse().filter((J)=>J._lifeCycleHooks[$]!==void 0).forEach((J)=>{J._lifeCycleHooks[$].forEach((G)=>{Z.push({hookedCommand:J,callback:G})})}),$==="postAction")Z.reverse();return Z.forEach((J)=>{X=this._chainOrCall(X,()=>{return J.callback(J.hookedCommand,this)})}),X}_chainOrCallSubCommandHook(_,$,X){let Z=_;if(this._lifeCycleHooks[X]!==void 0)this._lifeCycleHooks[X].forEach((J)=>{Z=this._chainOrCall(Z,()=>{return J(this,$)})});return Z}_parseCommand(_,$){let X=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),_=_.concat(X.operands),$=X.unknown,this.args=_.concat($),_&&this._findCommand(_[0]))return this._dispatchSubcommand(_[0],_.slice(1),$);if(this._getHelpCommand()&&_[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(_[1]);if(this._defaultCommandName)return this._outputHelpIfRequested($),this._dispatchSubcommand(this._defaultCommandName,_,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(X.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Z=()=>{if(X.unknown.length>0)this.unknownOption(X.unknown[0])},J=`command:${this.name()}`;if(this._actionHandler){Z(),this._processArguments();let G;if(G=this._chainOrCallHooks(G,"preAction"),G=this._chainOrCall(G,()=>this._actionHandler(this.processedArgs)),this.parent)G=this._chainOrCall(G,()=>{this.parent.emit(J,_,$)});return G=this._chainOrCallHooks(G,"postAction"),G}if(this.parent&&this.parent.listenerCount(J))Z(),this._processArguments(),this.parent.emit(J,_,$);else if(_.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",_,$);if(this.listenerCount("command:*"))this.emit("command:*",_,$);else if(this.commands.length)this.unknownCommand();else Z(),this._processArguments()}else if(this.commands.length)Z(),this.help({error:!0});else Z(),this._processArguments()}_findCommand(_){if(!_)return;return this.commands.find(($)=>$._name===_||$._aliases.includes(_))}_findOption(_){return this.options.find(($)=>$.is(_))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((_)=>{_.options.forEach(($)=>{if($.mandatory&&_.getOptionValue($.attributeName())===void 0)_.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let _=this.options.filter((X)=>{let Z=X.attributeName();if(this.getOptionValue(Z)===void 0)return!1;return this.getOptionValueSource(Z)!=="default"});_.filter((X)=>X.conflictsWith.length>0).forEach((X)=>{let Z=_.find((J)=>X.conflictsWith.includes(J.attributeName()));if(Z)this._conflictingOption(X,Z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((_)=>{_._checkForConflictingLocalOptions()})}parseOptions(_){let $=[],X=[],Z=$,J=_.slice();function G(z){return z.length>1&&z[0]==="-"}let Y=null;while(J.length){let z=J.shift();if(z==="--"){if(Z===X)Z.push(z);Z.push(...J);break}if(Y&&!G(z)){this.emit(`option:${Y.name()}`,z);continue}if(Y=null,G(z)){let F=this._findOption(z);if(F){if(F.required){let H=J.shift();if(H===void 0)this.optionMissingArgument(F);this.emit(`option:${F.name()}`,H)}else if(F.optional){let H=null;if(J.length>0&&!G(J[0]))H=J.shift();this.emit(`option:${F.name()}`,H)}else this.emit(`option:${F.name()}`);Y=F.variadic?F:null;continue}}if(z.length>2&&z[0]==="-"&&z[1]!=="-"){let F=this._findOption(`-${z[1]}`);if(F){if(F.required||F.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${F.name()}`,z.slice(2));else this.emit(`option:${F.name()}`),J.unshift(`-${z.slice(2)}`);continue}}if(/^--[^=]+=/.test(z)){let F=z.indexOf("="),H=this._findOption(z.slice(0,F));if(H&&(H.required||H.optional)){this.emit(`option:${H.name()}`,z.slice(F+1));continue}}if(G(z))Z=X;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&X.length===0){if(this._findCommand(z)){if($.push(z),J.length>0)X.push(...J);break}else if(this._getHelpCommand()&&z===this._getHelpCommand().name()){if($.push(z),J.length>0)$.push(...J);break}else if(this._defaultCommandName){if(X.push(z),J.length>0)X.push(...J);break}}if(this._passThroughOptions){if(Z.push(z),J.length>0)Z.push(...J);break}Z.push(z)}return{operands:$,unknown:X}}opts(){if(this._storeOptionsAsProperties){let _={},$=this.options.length;for(let X=0;X<$;X++){let Z=this.options[X].attributeName();_[Z]=Z===this._versionOptionName?this._version:this[Z]}return _}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((_,$)=>Object.assign(_,$.opts()),{})}error(_,$){if(this._outputConfiguration.outputError(`${_}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let X=$||{},Z=X.exitCode||1,J=X.code||"commander.error";this._exit(Z,J,_)}_parseOptionsEnv(){this.options.forEach((_)=>{if(_.envVar&&_.envVar in r.env){let $=_.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(_.required||_.optional)this.emit(`optionEnv:${_.name()}`,r.env[_.envVar]);else this.emit(`optionEnv:${_.name()}`)}})}_parseOptionsImplied(){let _=new BJ(this.options),$=(X)=>{return this.getOptionValue(X)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(X))};this.options.filter((X)=>X.implied!==void 0&&$(X.attributeName())&&_.valueFromOption(this.getOptionValue(X.attributeName()),X)).forEach((X)=>{Object.keys(X.implied).filter((Z)=>!$(Z)).forEach((Z)=>{this.setOptionValueWithSource(Z,X.implied[Z],"implied")})})}missingArgument(_){let $=`error: missing required argument '${_}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(_){let $=`error: option '${_.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(_){let $=`error: required option '${_.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(_,$){let X=(G)=>{let Y=G.attributeName(),z=this.getOptionValue(Y),F=this.options.find((W)=>W.negate&&Y===W.attributeName()),H=this.options.find((W)=>!W.negate&&Y===W.attributeName());if(F&&(F.presetArg===void 0&&z===!1||F.presetArg!==void 0&&z===F.presetArg))return F;return H||G},Z=(G)=>{let Y=X(G),z=Y.attributeName();if(this.getOptionValueSource(z)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},J=`error: ${Z(_)} cannot be used with ${Z($)}`;this.error(J,{code:"commander.conflictingOption"})}unknownOption(_){if(this._allowUnknownOption)return;let $="";if(_.startsWith("--")&&this._showSuggestionAfterError){let Z=[],J=this;do{let G=J.createHelp().visibleOptions(J).filter((Y)=>Y.long).map((Y)=>Y.long);Z=Z.concat(G),J=J.parent}while(J&&!J._enablePositionalOptions);$=v5(_,Z)}let X=`error: unknown option '${_}'${$}`;this.error(X,{code:"commander.unknownOption"})}_excessArguments(_){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,X=$===1?"":"s",J=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${X} but got ${_.length}.`;this.error(J,{code:"commander.excessArguments"})}unknownCommand(){let _=this.args[0],$="";if(this._showSuggestionAfterError){let Z=[];this.createHelp().visibleCommands(this).forEach((J)=>{if(Z.push(J.name()),J.alias())Z.push(J.alias())}),$=v5(_,Z)}let X=`error: unknown command '${_}'${$}`;this.error(X,{code:"commander.unknownCommand"})}version(_,$,X){if(_===void 0)return this._version;this._version=_,$=$||"-V, --version",X=X||"output the version number";let Z=this.createOption($,X);return this._versionOptionName=Z.attributeName(),this._registerOption(Z),this.on("option:"+Z.name(),()=>{this._outputConfiguration.writeOut(`${_}
`),this._exit(0,"commander.version",_)}),this}description(_,$){if(_===void 0&&$===void 0)return this._description;if(this._description=_,$)this._argsDescription=$;return this}summary(_){if(_===void 0)return this._summary;return this._summary=_,this}alias(_){if(_===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(_===$._name)throw Error("Command alias can't be the same as its name");let X=this.parent?._findCommand(_);if(X){let Z=[X.name()].concat(X.aliases()).join("|");throw Error(`cannot add alias '${_}' to command '${this.name()}' as already have command '${Z}'`)}return $._aliases.push(_),this}aliases(_){if(_===void 0)return this._aliases;return _.forEach(($)=>this.alias($)),this}usage(_){if(_===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((X)=>{return NJ(X)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=_,this}name(_){if(_===void 0)return this._name;return this._name=_,this}nameFromFilename(_){return this._name=U1.basename(_,U1.extname(_)),this}executableDir(_){if(_===void 0)return this._executableDir;return this._executableDir=_,this}helpInformation(_){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=_&&_.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(_){_=_||{};let $={error:!!_.error},X;if($.error)X=(Z)=>this._outputConfiguration.writeErr(Z);else X=(Z)=>this._outputConfiguration.writeOut(Z);return $.write=_.write||X,$.command=this,$}outputHelp(_){let $;if(typeof _==="function")$=_,_=void 0;let X=this._getHelpContext(_);this._getCommandAndAncestors().reverse().forEach((J)=>J.emit("beforeAllHelp",X)),this.emit("beforeHelp",X);let Z=this.helpInformation(X);if($){if(Z=$(Z),typeof Z!=="string"&&!Buffer.isBuffer(Z))throw Error("outputHelp callback must return a string or a Buffer")}if(X.write(Z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",X),this._getCommandAndAncestors().forEach((J)=>J.emit("afterAllHelp",X))}helpOption(_,$){if(typeof _==="boolean"){if(_)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return _=_??"-h, --help",$=$??"display help for command",this._helpOption=this.createOption(_,$),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption(_){return this._helpOption=_,this}help(_){this.outputHelp(_);let $=r.exitCode||0;if($===0&&_&&typeof _!=="function"&&_.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(_,$){let X=["beforeAll","before","after","afterAll"];if(!X.includes(_))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${X.join("', '")}'`);let Z=`${_}Help`;return this.on(Z,(J)=>{let G;if(typeof $==="function")G=$({error:J.error,command:J.command});else G=$;if(G)J.write(`${G}
`)}),this}_outputHelpIfRequested(_){let $=this._getHelpOption();if($&&_.find((Z)=>$.is(Z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function h5(_){return _.map(($)=>{if(!$.startsWith("--inspect"))return $;let X,Z="127.0.0.1",J="9229",G;if((G=$.match(/^(--inspect(-brk)?)$/))!==null)X=G[1];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(X=G[1],/^\d+$/.test(G[3]))J=G[3];else Z=G[3];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)X=G[1],Z=G[3],J=G[4];if(X&&J!=="0")return`${X}=${Z}:${parseInt(J)+1}`;return $})}IJ.Command=V8});var p5=u((TJ)=>{var{Argument:f5}=e_(),{Command:N8}=y5(),{CommanderError:EJ,InvalidArgumentError:b5}=t2(),{Help:jJ}=A8(),{Option:g5}=K8();TJ.program=new N8;TJ.createCommand=(_)=>new N8(_);TJ.createOption=(_,$)=>new g5(_,$);TJ.createArgument=(_,$)=>new f5(_,$);TJ.Command=N8;TJ.Option=g5;TJ.Argument=f5;TJ.Help=jJ;TJ.CommanderError=EJ;TJ.InvalidArgumentError=b5;TJ.InvalidOptionArgumentError=b5});var x3=u((YK,U6)=>{function B3(_){return Array.isArray(_)?_:[_]}var LG=void 0,y8="",N3=" ",h8="\\",PG=/^\s+$/,wG=/(?:[^\\]|^)\\$/,xG=/^\\!/,qG=/^\\#/,CG=/\r?\n/g,SG=/^\.{0,2}\/|^\.{1,2}$/,kG=/\/$/,K2="/",I3="node-ignore";if(typeof Symbol<"u")I3=Symbol.for("node-ignore");var Q3=I3,D2=(_,$,X)=>{return Object.defineProperty(_,$,{value:X}),X},vG=/([0-z])-([0-z])/g,E3=()=>!1,hG=(_)=>_.replace(vG,($,X,Z)=>X.charCodeAt(0)<=Z.charCodeAt(0)?$:y8),yG=(_)=>{let{length:$}=_;return _.slice(0,$-$%2)},fG=[[/^\uFEFF/,()=>y8],[/((?:\\\\)*?)(\\?\s+)$/,(_,$,X)=>$+(X.indexOf("\\")===0?N3:y8)],[/(\\+?)\s/g,(_,$)=>{let{length:X}=$;return $.slice(0,X-X%2)+N3}],[/[\\$.|*+(){^]/g,(_)=>`\\${_}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return!/\/(?!$)/.test(this)?"(?:^|\\/)":"^"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(_,$,X)=>$+6<X.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(_,$,X)=>{let Z=X.replace(/\\\*/g,"[^\\/]*");return $+Z}],[/\\\\\\(?=[$.|*+(){^])/g,()=>h8],[/\\\\/g,()=>h8],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(_,$,X,Z,J)=>$===h8?`\\[${X}${yG(Z)}${J}`:J==="]"?Z.length%2===0?`[${hG(X)}${Z}]`:"[]":"[]"],[/(?:[^*])$/,(_)=>/\/$/.test(_)?`${_}$`:`${_}(?=$|\\/$)`]],bG=/(^|\\\/)?\\\*$/,J_="regex",H6="checkRegex",M3="_",gG={[J_](_,$){return`${$?`${$}[^/]+`:"[^/]*"}(?=$|\\/$)`},[H6](_,$){return`${$?`${$}[^/]*`:"[^/]*"}(?=$|\\/$)`}},pG=(_)=>fG.reduce(($,[X,Z])=>$.replace(X,Z.bind(_)),_),W6=(_)=>typeof _==="string",mG=(_)=>_&&W6(_)&&!PG.test(_)&&!wG.test(_)&&_.indexOf("#")!==0,uG=(_)=>_.split(CG).filter(Boolean);class j3{constructor(_,$,X,Z,J,G){this.pattern=_,this.mark=$,this.negative=J,D2(this,"body",X),D2(this,"ignoreCase",Z),D2(this,"regexPrefix",G)}get regex(){let _=M3+J_;if(this[_])return this[_];return this._make(J_,_)}get checkRegex(){let _=M3+H6;if(this[_])return this[_];return this._make(H6,_)}_make(_,$){let X=this.regexPrefix.replace(bG,gG[_]),Z=this.ignoreCase?new RegExp(X,"i"):new RegExp(X);return D2(this,$,Z)}}var dG=({pattern:_,mark:$},X)=>{let Z=!1,J=_;if(J.indexOf("!")===0)Z=!0,J=J.substr(1);J=J.replace(xG,"!").replace(qG,"#");let G=pG(J);return new j3(_,$,J,X,Z,G)};class T3{constructor(_){this._ignoreCase=_,this._rules=[]}_add(_){if(_&&_[Q3]){this._rules=this._rules.concat(_._rules._rules),this._added=!0;return}if(W6(_))_={pattern:_};if(mG(_.pattern)){let $=dG(_,this._ignoreCase);this._added=!0,this._rules.push($)}}add(_){return this._added=!1,B3(W6(_)?uG(_):_).forEach(this._add,this),this._added}test(_,$,X){let Z=!1,J=!1,G;this._rules.forEach((z)=>{let{negative:F}=z;if(J===F&&Z!==J||F&&!Z&&!J&&!$)return;if(!z[X].test(_))return;Z=!F,J=F,G=F?LG:z});let Y={ignored:Z,unignored:J};if(G)Y.rule=G;return Y}}var cG=(_,$)=>{throw new $(_)},A1=(_,$,X)=>{if(!W6(_))return X(`path must be a string, but got \`${$}\``,TypeError);if(!_)return X("path must not be empty",TypeError);if(A1.isNotRelative(_))return X(`path should be a \`path.relative()\`d string, but got "${$}"`,RangeError);return!0},L3=(_)=>SG.test(_);A1.isNotRelative=L3;A1.convert=(_)=>_;class P3{constructor({ignorecase:_=!0,ignoreCase:$=_,allowRelativePaths:X=!1}={}){D2(this,Q3,!0),this._rules=new T3($),this._strictPathCheck=!X,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(_){if(this._rules.add(_))this._initCache();return this}addPattern(_){return this.add(_)}_test(_,$,X,Z){let J=_&&A1.convert(_);return A1(J,_,this._strictPathCheck?cG:E3),this._t(J,$,X,Z)}checkIgnore(_){if(!kG.test(_))return this.test(_);let $=_.split(K2).filter(Boolean);if($.pop(),$.length){let X=this._t($.join(K2)+K2,this._testCache,!0,$);if(X.ignored)return X}return this._rules.test(_,!1,H6)}_t(_,$,X,Z){if(_ in $)return $[_];if(!Z)Z=_.split(K2).filter(Boolean);if(Z.pop(),!Z.length)return $[_]=this._rules.test(_,X,J_);let J=this._t(Z.join(K2)+K2,$,X,Z);return $[_]=J.ignored?J:this._rules.test(_,X,J_)}ignores(_){return this._test(_,this._ignoreCache,!1).ignored}createFilter(){return(_)=>!this.ignores(_)}filter(_){return B3(_).filter(this.createFilter())}test(_){return this._test(_,this._testCache,!0)}}var f8=(_)=>new P3(_),lG=(_)=>A1(_&&A1.convert(_),_,E3),w3=()=>{let _=(X)=>/^\\\\\?\\/.test(X)||/["<>|\u0000-\u001F]+/u.test(X)?X:X.replace(/\\/g,"/");A1.convert=_;let $=/^[a-z]:\//i;A1.isNotRelative=(X)=>$.test(X)||L3(X)};if(typeof process<"u"&&process.platform==="win32")w3();U6.exports=f8;f8.default=f8;U6.exports.isPathValid=lG;D2(U6.exports,Symbol.for("setupWindows"),w3)});var g7=u((b0)=>{var VY=b0&&b0.__createBinding||(Object.create?function(_,$,X,Z){if(Z===void 0)Z=X;var J=Object.getOwnPropertyDescriptor($,X);if(!J||("get"in J?!$.__esModule:J.writable||J.configurable))J={enumerable:!0,get:function(){return $[X]}};Object.defineProperty(_,Z,J)}:function(_,$,X,Z){if(Z===void 0)Z=X;_[Z]=$[X]}),NY=b0&&b0.__setModuleDefault||(Object.create?function(_,$){Object.defineProperty(_,"default",{enumerable:!0,value:$})}:function(_,$){_.default=$}),b7=b0&&b0.__importStar||function(_){if(_&&_.__esModule)return _;var $={};if(_!=null){for(var X in _)if(X!=="default"&&Object.prototype.hasOwnProperty.call(_,X))VY($,_,X)}return NY($,_),$};Object.defineProperty(b0,"__esModule",{value:!0});b0.load=b0.currentTarget=void 0;var MY=b7(S("path")),BY=b7(S("fs"));function IY(){let _=null;switch(process.platform){case"android":switch(process.arch){case"arm":return"android-arm-eabi";case"arm64":return"android-arm64"}_="Android";break;case"win32":switch(process.arch){case"x64":return"win32-x64-msvc";case"arm64":return"win32-arm64-msvc";case"ia32":return"win32-ia32-msvc"}_="Windows";break;case"darwin":switch(process.arch){case"x64":return"darwin-x64";case"arm64":return"darwin-arm64"}_="macOS";break;case"linux":switch(process.arch){case"x64":case"arm64":return QY()?`linux-${process.arch}-gnu`:`linux-${process.arch}-musl`;case"arm":return"linux-arm-gnueabihf"}_="Linux";break;case"freebsd":if(process.arch==="x64")return"freebsd-x64";_="FreeBSD";break}if(_)throw Error(`Neon: unsupported ${_} architecture: ${process.arch}`);throw Error(`Neon: unsupported system: ${process.platform}`)}b0.currentTarget=IY;function QY(){let _=process.report?.getReport();if(typeof _!=="object"||!_||!("header"in _))return!1;let $=_.header;return typeof $==="object"&&!!$&&"glibcVersionRuntime"in $}function EY(_){let $=MY.join(_,"index.node");return BY.existsSync($)?S($):null}b0.load=EY});var u7=u((dD,m7)=>{var p7=()=>process.platform==="linux",Z4=null,jY=()=>{if(!Z4)Z4=p7()&&process.report?process.report.getReport():{};return Z4};m7.exports={isLinux:p7,getReport:jY}});var l7=u((cD,c7)=>{var d7=S("fs"),TY=(_)=>d7.readFileSync(_,"utf-8"),LY=(_)=>new Promise(($,X)=>{d7.readFile(_,"utf-8",(Z,J)=>{if(Z)X(Z);else $(J)})});c7.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:TY,readFile:LY}});var F9=u((lD,z9)=>{var n7=S("child_process"),{isLinux:I2,getReport:o7}=u7(),{LDD_PATH:I6,readFile:s7,readFileSync:r7}=l7(),Z1,J1,P1="",a7=()=>{if(!P1)return new Promise((_)=>{n7.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",($,X)=>{P1=$?" ":X,_(P1)})});return P1},t7=()=>{if(!P1)try{P1=n7.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(_){P1=" "}return P1},D1="glibc",e7=/GLIBC\s(\d+\.\d+)/,i1="musl",PY=D1.toUpperCase(),wY=i1.toLowerCase(),xY=(_)=>_.includes("libc.musl-")||_.includes("ld-musl-"),_9=()=>{let _=o7();if(_.header&&_.header.glibcVersionRuntime)return D1;if(Array.isArray(_.sharedObjects)){if(_.sharedObjects.some(xY))return i1}return null},$9=(_)=>{let[$,X]=_.split(/[\r\n]+/);if($&&$.includes(D1))return D1;if(X&&X.includes(i1))return i1;return null},X9=(_)=>{if(_.includes(wY))return i1;if(_.includes(PY))return D1;return null},qY=async()=>{if(Z1!==void 0)return Z1;Z1=null;try{let _=await s7(I6);Z1=X9(_)}catch(_){}return Z1},CY=()=>{if(Z1!==void 0)return Z1;Z1=null;try{let _=r7(I6);Z1=X9(_)}catch(_){}return Z1},Z9=async()=>{let _=null;if(I2()){if(_=await qY(),!_)_=_9();if(!_){let $=await a7();_=$9($)}}return _},J9=()=>{let _=null;if(I2()){if(_=CY(),!_)_=_9();if(!_){let $=t7();_=$9($)}}return _},SY=async()=>I2()&&await Z9()!==D1,kY=()=>I2()&&J9()!==D1,vY=async()=>{if(J1!==void 0)return J1;J1=null;try{let $=(await s7(I6)).match(e7);if($)J1=$[1]}catch(_){}return J1},hY=()=>{if(J1!==void 0)return J1;J1=null;try{let $=r7(I6).match(e7);if($)J1=$[1]}catch(_){}return J1},G9=()=>{let _=o7();if(_.header&&_.header.glibcVersionRuntime)return _.header.glibcVersionRuntime;return null},i7=(_)=>_.trim().split(/\s+/)[1],Y9=(_)=>{let[$,X,Z]=_.split(/[\r\n]+/);if($&&$.includes(D1))return i7($);if(X&&Z&&X.includes(i1))return i7(Z);return null},yY=async()=>{let _=null;if(I2()){if(_=await vY(),!_)_=G9();if(!_){let $=await a7();_=Y9($)}}return _},fY=()=>{let _=null;if(I2()){if(_=hY(),!_)_=G9();if(!_){let $=t7();_=Y9($)}}return _};z9.exports={GLIBC:D1,MUSL:i1,family:Z9,familySync:J9,isNonGlibcLinux:SY,isNonGlibcLinuxSync:kY,version:yY,versionSync:fY}});var W9=u((iD,H9)=>{var bY={ALLOW:0,DENY:1};H9.exports=bY});var A9=u((nD,U9)=>{var J4={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function n1(_,$,X){if(new.target!==n1)return new n1(_,$);if(typeof $!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,_),J4.value=""+_,Object.defineProperty(this,"message",J4),Error.captureStackTrace(this,n1),this.code=$,this.rawCode=X}Object.setPrototypeOf(n1,Error);Object.setPrototypeOf(n1.prototype,Error.prototype);Object.defineProperty(n1.prototype,"name",J4);U9.exports=n1});var B9=u((oD,Q6)=>{var __dirname="/Users/kyle/rules/node_modules/libsql",{load:gY,currentTarget:pY}=g7(),{familySync:K9,GLIBC:mY,MUSL:uY}=F9();function dY(){if(process.env.LIBSQL_JS_DEV)return gY(__dirname);let _=pY();if(K9()==mY)switch(_){case"linux-x64-musl":_="linux-x64-gnu";break;case"linux-arm64-musl":_="linux-arm64-gnu";break}if(_==="linux-arm-gnueabihf"&&K9()==uY)_="linux-arm-musleabihf";return S(`@libsql/${_}`)}var{databaseOpen:cY,databaseOpenWithSync:lY,databaseInTransaction:iY,databaseInterrupt:nY,databaseClose:oY,databaseSyncSync:sY,databaseSyncUntilSync:rY,databaseExecSync:aY,databasePrepareSync:tY,databaseDefaultSafeIntegers:eY,databaseAuthorizer:_z,databaseLoadExtension:$z,databaseMaxWriteReplicationIndex:Xz,statementRaw:Zz,statementIsReader:Jz,statementGet:D9,statementRun:O9,statementInterrupt:Gz,statementRowsSync:R9,statementColumns:Yz,statementSafeIntegers:zz,rowsNext:Fz}=dY(),Hz=W9(),V9=A9();function Q2(_){if(_.libsqlError)return new V9(_.message,_.code,_.rawCode);return _}class N9{constructor(_,$){let X=$?.encryptionCipher??"aes256cbc";if($&&$.syncUrl){var Z="";if($.syncAuth)console.warn("Warning: The `syncAuth` option is deprecated, please use `authToken` option instead."),Z=$.syncAuth;else if($.authToken)Z=$.authToken;let G=$?.encryptionKey??"",Y=$?.syncPeriod??0,z=$?.readYourWrites??!0,F=$?.offline??!1,H=$?.remoteEncryptionKey??"";this.db=lY(_,$.syncUrl,Z,X,G,Y,z,F,H)}else{let G=$?.authToken??"",Y=$?.encryptionKey??"",z=$?.timeout??0,F=$?.remoteEncryptionKey??"";this.db=cY(_,G,X,Y,z,F)}this.memory=_===":memory:",this.readonly=!1,this.name="",this.open=!0;let J=this.db;Object.defineProperties(this,{inTransaction:{get(){return iY(J)}}})}sync(){return sY.call(this.db)}syncUntil(_){return rY.call(this.db,_)}prepare(_){try{let $=tY.call(this.db,_);return new M9($)}catch($){throw Q2($)}}transaction(_){if(typeof _!=="function")throw TypeError("Expected first argument to be a function");let $=this,X=(J)=>{return(...G)=>{$.exec("BEGIN "+J);try{let Y=_(...G);return $.exec("COMMIT"),Y}catch(Y){throw $.exec("ROLLBACK"),Y}}},Z={default:{value:X("")},deferred:{value:X("DEFERRED")},immediate:{value:X("IMMEDIATE")},exclusive:{value:X("EXCLUSIVE")},database:{value:this,enumerable:!0}};return Object.defineProperties(Z.default.value,Z),Object.defineProperties(Z.deferred.value,Z),Object.defineProperties(Z.immediate.value,Z),Object.defineProperties(Z.exclusive.value,Z),Z.default.value}pragma(_,$){if($==null)$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");let X=$.simple,Z=this.prepare(`PRAGMA ${_}`,this,!0);return X?Z.pluck().get():Z.all()}backup(_,$){throw Error("not implemented")}serialize(_){throw Error("not implemented")}function(_,$,X){if($==null)$={};if(typeof $==="function")X=$,$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="function")throw TypeError("Expected last argument to be a function");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}aggregate(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object"||$===null)throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}table(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(!_)throw TypeError("Virtual table module name cannot be an empty string");throw Error("not implemented")}authorizer(_){_z.call(this.db,_)}loadExtension(..._){$z.call(this.db,..._)}maxWriteReplicationIndex(){return Xz.call(this.db)}exec(_){try{aY.call(this.db,_)}catch($){throw Q2($)}}interrupt(){nY.call(this.db)}close(){oY.call(this.db),this.open=!1}defaultSafeIntegers(_){return eY.call(this.db,_??!0),this}unsafeMode(..._){throw Error("not implemented")}}class M9{constructor(_){this.stmt=_,this.pluckMode=!1}raw(_){return Zz.call(this.stmt,_??!0),this}pluck(_){return this.pluckMode=_??!0,this}get reader(){return Jz.call(this.stmt)}run(..._){try{if(_.length==1&&typeof _[0]==="object")return O9.call(this.stmt,_[0]);else return O9.call(this.stmt,_.flat())}catch($){throw Q2($)}}get(..._){try{if(_.length==1&&typeof _[0]==="object")return D9.call(this.stmt,_[0]);else return D9.call(this.stmt,_.flat())}catch($){throw Q2($)}}iterate(..._){var $=void 0;if(_.length==1&&typeof _[0]==="object")$=R9.call(this.stmt,_[0]);else $=R9.call(this.stmt,_.flat());return{nextRows:Array(100),nextRowIndex:100,next(){try{if(this.nextRowIndex===100)Fz.call($,this.nextRows),this.nextRowIndex=0;let Z=this.nextRows[this.nextRowIndex];if(this.nextRows[this.nextRowIndex]=void 0,!Z)return{done:!0};return this.nextRowIndex++,{value:Z,done:!1}}catch(Z){throw Q2(Z)}},[Symbol.iterator](){return this}}}all(..._){try{let $=[];for(let X of this.iterate(..._))if(this.pluckMode)$.push(X[Object.keys(X)[0]]);else $.push(X);return $}catch($){throw Q2($)}}interrupt(){Gz.call(this.stmt)}columns(){return Yz.call(this.stmt)}safeIntegers(_){return zz.call(this.stmt,_??!0),this}}Q6.exports=N9;Q6.exports.Authorization=Hz;Q6.exports.SqliteError=V9});var O1=u((XO,q9)=>{var w9=["nodebuffer","arraybuffer","fragments"],x9=typeof Blob<"u";if(x9)w9.push("blob");q9.exports={BINARY_TYPES:w9,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:x9,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var B_=u((ZO,E6)=>{var{EMPTY_BUFFER:Rz}=O1(),G4=Buffer[Symbol.species];function Vz(_,$){if(_.length===0)return Rz;if(_.length===1)return _[0];let X=Buffer.allocUnsafe($),Z=0;for(let J=0;J<_.length;J++){let G=_[J];X.set(G,Z),Z+=G.length}if(Z<$)return new G4(X.buffer,X.byteOffset,Z);return X}function C9(_,$,X,Z,J){for(let G=0;G<J;G++)X[Z+G]=_[G]^$[G&3]}function S9(_,$){for(let X=0;X<_.length;X++)_[X]^=$[X&3]}function Nz(_){if(_.length===_.buffer.byteLength)return _.buffer;return _.buffer.slice(_.byteOffset,_.byteOffset+_.length)}function Y4(_){if(Y4.readOnly=!0,Buffer.isBuffer(_))return _;let $;if(_ instanceof ArrayBuffer)$=new G4(_);else if(ArrayBuffer.isView(_))$=new G4(_.buffer,_.byteOffset,_.byteLength);else $=Buffer.from(_),Y4.readOnly=!1;return $}E6.exports={concat:Vz,mask:C9,toArrayBuffer:Nz,toBuffer:Y4,unmask:S9};if(!process.env.WS_NO_BUFFER_UTIL)try{let _=(()=>{throw new Error("Cannot require module "+"bufferutil");})();E6.exports.mask=function($,X,Z,J,G){if(G<48)C9($,X,Z,J,G);else _.mask($,X,Z,J,G)},E6.exports.unmask=function($,X){if($.length<32)S9($,X);else _.unmask($,X)}}catch(_){}});var y9=u((JO,h9)=>{var k9=Symbol("kDone"),z4=Symbol("kRun");class v9{constructor(_){this[k9]=()=>{this.pending--,this[z4]()},this.concurrency=_||1/0,this.jobs=[],this.pending=0}add(_){this.jobs.push(_),this[z4]()}[z4](){if(this.pending===this.concurrency)return;if(this.jobs.length){let _=this.jobs.shift();this.pending++,_(this[k9])}}}h9.exports=v9});var Q_=u((GO,m9)=>{var I_=S("zlib"),f9=B_(),Mz=y9(),{kStatusCode:b9}=O1(),Bz=Buffer[Symbol.species],Iz=Buffer.from([0,0,255,255]),T6=Symbol("permessage-deflate"),R1=Symbol("total-length"),E2=Symbol("callback"),w1=Symbol("buffers"),j2=Symbol("error"),j6;class g9{constructor(_,$,X){if(this._maxPayload=X|0,this._options=_||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!$,this._deflate=null,this._inflate=null,this.params=null,!j6){let Z=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;j6=new Mz(Z)}}static get extensionName(){return"permessage-deflate"}offer(){let _={};if(this._options.serverNoContextTakeover)_.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)_.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)_.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)_.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)_.client_max_window_bits=!0;return _}accept(_){return _=this.normalizeParams(_),this.params=this._isServer?this.acceptAsServer(_):this.acceptAsClient(_),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let _=this._deflate[E2];if(this._deflate.close(),this._deflate=null,_)_(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(_){let $=this._options,X=_.find((Z)=>{if($.serverNoContextTakeover===!1&&Z.server_no_context_takeover||Z.server_max_window_bits&&($.serverMaxWindowBits===!1||typeof $.serverMaxWindowBits==="number"&&$.serverMaxWindowBits>Z.server_max_window_bits)||typeof $.clientMaxWindowBits==="number"&&!Z.client_max_window_bits)return!1;return!0});if(!X)throw Error("None of the extension offers can be accepted");if($.serverNoContextTakeover)X.server_no_context_takeover=!0;if($.clientNoContextTakeover)X.client_no_context_takeover=!0;if(typeof $.serverMaxWindowBits==="number")X.server_max_window_bits=$.serverMaxWindowBits;if(typeof $.clientMaxWindowBits==="number")X.client_max_window_bits=$.clientMaxWindowBits;else if(X.client_max_window_bits===!0||$.clientMaxWindowBits===!1)delete X.client_max_window_bits;return X}acceptAsClient(_){let $=_[0];if(this._options.clientNoContextTakeover===!1&&$.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!$.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")$.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&$.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return $}normalizeParams(_){return _.forEach(($)=>{Object.keys($).forEach((X)=>{let Z=$[X];if(Z.length>1)throw Error(`Parameter "${X}" must have only a single value`);if(Z=Z[0],X==="client_max_window_bits"){if(Z!==!0){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else if(X==="server_max_window_bits"){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(X==="client_no_context_takeover"||X==="server_no_context_takeover"){if(Z!==!0)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else throw Error(`Unknown parameter "${X}"`);$[X]=Z})}),_}decompress(_,$,X){j6.add((Z)=>{this._decompress(_,$,(J,G)=>{Z(),X(J,G)})})}compress(_,$,X){j6.add((Z)=>{this._compress(_,$,(J,G)=>{Z(),X(J,G)})})}_decompress(_,$,X){let Z=this._isServer?"client":"server";if(!this._inflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?I_.Z_DEFAULT_WINDOWBITS:this.params[J];this._inflate=I_.createInflateRaw({...this._options.zlibInflateOptions,windowBits:G}),this._inflate[T6]=this,this._inflate[R1]=0,this._inflate[w1]=[],this._inflate.on("error",Ez),this._inflate.on("data",p9)}if(this._inflate[E2]=X,this._inflate.write(_),$)this._inflate.write(Iz);this._inflate.flush(()=>{let J=this._inflate[j2];if(J){this._inflate.close(),this._inflate=null,X(J);return}let G=f9.concat(this._inflate[w1],this._inflate[R1]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[R1]=0,this._inflate[w1]=[],$&&this.params[`${Z}_no_context_takeover`])this._inflate.reset();X(null,G)})}_compress(_,$,X){let Z=this._isServer?"server":"client";if(!this._deflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?I_.Z_DEFAULT_WINDOWBITS:this.params[J];this._deflate=I_.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:G}),this._deflate[R1]=0,this._deflate[w1]=[],this._deflate.on("data",Qz)}this._deflate[E2]=X,this._deflate.write(_),this._deflate.flush(I_.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let J=f9.concat(this._deflate[w1],this._deflate[R1]);if($)J=new Bz(J.buffer,J.byteOffset,J.length-4);if(this._deflate[E2]=null,this._deflate[R1]=0,this._deflate[w1]=[],$&&this.params[`${Z}_no_context_takeover`])this._deflate.reset();X(null,J)})}}m9.exports=g9;function Qz(_){this[w1].push(_),this[R1]+=_.length}function p9(_){if(this[R1]+=_.length,this[T6]._maxPayload<1||this[R1]<=this[T6]._maxPayload){this[w1].push(_);return}this[j2]=RangeError("Max payload size exceeded"),this[j2].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[j2][b9]=1009,this.removeListener("data",p9),this.reset()}function Ez(_){if(this[T6]._inflate=null,this[j2]){this[E2](this[j2]);return}_[b9]=1007,this[E2](_)}});var T2=u((YO,L6)=>{var{isUtf8:u9}=S("buffer"),{hasBlob:jz}=O1(),Tz=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Lz(_){return _>=1000&&_<=1014&&_!==1004&&_!==1005&&_!==1006||_>=3000&&_<=4999}function F4(_){let $=_.length,X=0;while(X<$)if((_[X]&128)===0)X++;else if((_[X]&224)===192){if(X+1===$||(_[X+1]&192)!==128||(_[X]&254)===192)return!1;X+=2}else if((_[X]&240)===224){if(X+2>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||_[X]===224&&(_[X+1]&224)===128||_[X]===237&&(_[X+1]&224)===160)return!1;X+=3}else if((_[X]&248)===240){if(X+3>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||(_[X+3]&192)!==128||_[X]===240&&(_[X+1]&240)===128||_[X]===244&&_[X+1]>143||_[X]>244)return!1;X+=4}else return!1;return!0}function Pz(_){return jz&&typeof _==="object"&&typeof _.arrayBuffer==="function"&&typeof _.type==="string"&&typeof _.stream==="function"&&(_[Symbol.toStringTag]==="Blob"||_[Symbol.toStringTag]==="File")}L6.exports={isBlob:Pz,isValidStatusCode:Lz,isValidUTF8:F4,tokenChars:Tz};if(u9)L6.exports.isValidUTF8=function(_){return _.length<24?F4(_):u9(_)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let _=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();L6.exports.isValidUTF8=function($){return $.length<32?F4($):_($)}}catch(_){}});var W4=u((zO,n9)=>{var{Writable:wz}=S("stream"),d9=Q_(),{BINARY_TYPES:xz,EMPTY_BUFFER:c9,kStatusCode:qz,kWebSocket:Cz}=O1(),{concat:H4,toArrayBuffer:Sz,unmask:kz}=B_(),{isValidStatusCode:vz,isValidUTF8:l9}=T2(),P6=Buffer[Symbol.species];class i9 extends wz{constructor(_={}){super();this._allowSynchronousEvents=_.allowSynchronousEvents!==void 0?_.allowSynchronousEvents:!0,this._binaryType=_.binaryType||xz[0],this._extensions=_.extensions||{},this._isServer=!!_.isServer,this._maxPayload=_.maxPayload|0,this._skipUTF8Validation=!!_.skipUTF8Validation,this[Cz]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(_,$,X){if(this._opcode===8&&this._state==0)return X();this._bufferedBytes+=_.length,this._buffers.push(_),this.startLoop(X)}consume(_){if(this._bufferedBytes-=_,_===this._buffers[0].length)return this._buffers.shift();if(_<this._buffers[0].length){let X=this._buffers[0];return this._buffers[0]=new P6(X.buffer,X.byteOffset+_,X.length-_),new P6(X.buffer,X.byteOffset,_)}let $=Buffer.allocUnsafe(_);do{let X=this._buffers[0],Z=$.length-_;if(_>=X.length)$.set(this._buffers.shift(),Z);else $.set(new Uint8Array(X.buffer,X.byteOffset,_),Z),this._buffers[0]=new P6(X.buffer,X.byteOffset+_,X.length-_);_-=X.length}while(_>0);return $}startLoop(_){this._loop=!0;do switch(this._state){case 0:this.getInfo(_);break;case 1:this.getPayloadLength16(_);break;case 2:this.getPayloadLength64(_);break;case 3:this.getMask();break;case 4:this.getData(_);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)_()}getInfo(_){if(this._bufferedBytes<2){this._loop=!1;return}let $=this.consume(2);if(($[0]&48)!==0){let Z=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");_(Z);return}let X=($[0]&64)===64;if(X&&!this._extensions[d9.extensionName]){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._fin=($[0]&128)===128,this._opcode=$[0]&15,this._payloadLength=$[1]&127,this._opcode===0){if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(!this._fragmented){let Z=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._compressed=X}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let Z=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");_(Z);return}if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let Z=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");_(Z);return}}else{let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=($[1]&128)===128,this._isServer){if(!this._masked){let Z=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");_(Z);return}}else if(this._masked){let Z=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");_(Z);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(_)}getPayloadLength16(_){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(_)}getPayloadLength64(_){if(this._bufferedBytes<8){this._loop=!1;return}let $=this.consume(8),X=$.readUInt32BE(0);if(X>Math.pow(2,21)-1){let Z=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");_(Z);return}this._payloadLength=X*Math.pow(2,32)+$.readUInt32BE(4),this.haveLength(_)}haveLength(_){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let $=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");_($);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(_){let $=c9;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if($=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)kz($,this._mask)}if(this._opcode>7){this.controlMessage($,_);return}if(this._compressed){this._state=5,this.decompress($,_);return}if($.length)this._messageLength=this._totalPayloadLength,this._fragments.push($);this.dataMessage(_)}decompress(_,$){this._extensions[d9.extensionName].decompress(_,this._fin,(Z,J)=>{if(Z)return $(Z);if(J.length){if(this._messageLength+=J.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let G=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");$(G);return}this._fragments.push(J)}if(this.dataMessage($),this._state===0)this.startLoop($)})}dataMessage(_){if(!this._fin){this._state=0;return}let $=this._messageLength,X=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let Z;if(this._binaryType==="nodebuffer")Z=H4(X,$);else if(this._binaryType==="arraybuffer")Z=Sz(H4(X,$));else if(this._binaryType==="blob")Z=new Blob(X);else Z=X;if(this._allowSynchronousEvents)this.emit("message",Z,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!0),this._state=0,this.startLoop(_)})}else{let Z=H4(X,$);if(!this._skipUTF8Validation&&!l9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");_(J);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",Z,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!1),this._state=0,this.startLoop(_)})}}controlMessage(_,$){if(this._opcode===8){if(_.length===0)this._loop=!1,this.emit("conclude",1005,c9),this.end();else{let X=_.readUInt16BE(0);if(!vz(X)){let J=this.createError(RangeError,`invalid status code ${X}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");$(J);return}let Z=new P6(_.buffer,_.byteOffset+2,_.length-2);if(!this._skipUTF8Validation&&!l9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");$(J);return}this._loop=!1,this.emit("conclude",X,Z),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",_),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",_),this._state=0,this.startLoop($)})}createError(_,$,X,Z,J){this._loop=!1,this._errored=!0;let G=new _(X?`Invalid WebSocket frame: ${$}`:$);return Error.captureStackTrace(G,this.createError),G.code=J,G[qz]=Z,G}}n9.exports=i9});var A4=u((HO,r9)=>{var{Duplex:FO}=S("stream"),{randomFillSync:hz}=S("crypto"),o9=Q_(),{EMPTY_BUFFER:yz,kWebSocket:fz,NOOP:bz}=O1(),{isBlob:L2,isValidStatusCode:gz}=T2(),{mask:s9,toBuffer:o1}=B_(),g0=Symbol("kByteLength"),pz=Buffer.alloc(4),s1,P2=8192,l0=0,mz=1,uz=2;class x1{constructor(_,$,X){if(this._extensions=$||{},X)this._generateMask=X,this._maskBuffer=Buffer.alloc(4);this._socket=_,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=l0,this.onerror=bz,this[fz]=void 0}static frame(_,$){let X,Z=!1,J=2,G=!1;if($.mask){if(X=$.maskBuffer||pz,$.generateMask)$.generateMask(X);else{if(P2===8192){if(s1===void 0)s1=Buffer.alloc(8192);hz(s1,0,8192),P2=0}X[0]=s1[P2++],X[1]=s1[P2++],X[2]=s1[P2++],X[3]=s1[P2++]}G=(X[0]|X[1]|X[2]|X[3])===0,J=6}let Y;if(typeof _==="string")if((!$.mask||G)&&$[g0]!==void 0)Y=$[g0];else _=Buffer.from(_),Y=_.length;else Y=_.length,Z=$.mask&&$.readOnly&&!G;let z=Y;if(Y>=65536)J+=8,z=127;else if(Y>125)J+=2,z=126;let F=Buffer.allocUnsafe(Z?Y+J:J);if(F[0]=$.fin?$.opcode|128:$.opcode,$.rsv1)F[0]|=64;if(F[1]=z,z===126)F.writeUInt16BE(Y,2);else if(z===127)F[2]=F[3]=0,F.writeUIntBE(Y,4,6);if(!$.mask)return[F,_];if(F[1]|=128,F[J-4]=X[0],F[J-3]=X[1],F[J-2]=X[2],F[J-1]=X[3],G)return[F,_];if(Z)return s9(_,X,F,J,Y),[F];return s9(_,X,_,0,Y),[F,_]}close(_,$,X,Z){let J;if(_===void 0)J=yz;else if(typeof _!=="number"||!gz(_))throw TypeError("First argument must be a valid error code number");else if($===void 0||!$.length)J=Buffer.allocUnsafe(2),J.writeUInt16BE(_,0);else{let Y=Buffer.byteLength($);if(Y>123)throw RangeError("The message must not be greater than 123 bytes");if(J=Buffer.allocUnsafe(2+Y),J.writeUInt16BE(_,0),typeof $==="string")J.write($,2);else J.set($,2)}let G={[g0]:J.length,fin:!0,generateMask:this._generateMask,mask:X,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==l0)this.enqueue([this.dispatch,J,!1,G,Z]);else this.sendFrame(x1.frame(J,G),Z)}ping(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(L2(_))Z=_.size,J=!1;else _=o1(_),Z=_.length,J=o1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[g0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:9,readOnly:J,rsv1:!1};if(L2(_))if(this._state!==l0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==l0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(x1.frame(_,G),X)}pong(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(L2(_))Z=_.size,J=!1;else _=o1(_),Z=_.length,J=o1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[g0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:10,readOnly:J,rsv1:!1};if(L2(_))if(this._state!==l0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==l0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(x1.frame(_,G),X)}send(_,$,X){let Z=this._extensions[o9.extensionName],J=$.binary?2:1,G=$.compress,Y,z;if(typeof _==="string")Y=Buffer.byteLength(_),z=!1;else if(L2(_))Y=_.size,z=!1;else _=o1(_),Y=_.length,z=o1.readOnly;if(this._firstFragment){if(this._firstFragment=!1,G&&Z&&Z.params[Z._isServer?"server_no_context_takeover":"client_no_context_takeover"])G=Y>=Z._threshold;this._compress=G}else G=!1,J=0;if($.fin)this._firstFragment=!0;let F={[g0]:Y,fin:$.fin,generateMask:this._generateMask,mask:$.mask,maskBuffer:this._maskBuffer,opcode:J,readOnly:z,rsv1:G};if(L2(_))if(this._state!==l0)this.enqueue([this.getBlobData,_,this._compress,F,X]);else this.getBlobData(_,this._compress,F,X);else if(this._state!==l0)this.enqueue([this.dispatch,_,this._compress,F,X]);else this.dispatch(_,this._compress,F,X)}getBlobData(_,$,X,Z){this._bufferedBytes+=X[g0],this._state=uz,_.arrayBuffer().then((J)=>{if(this._socket.destroyed){let Y=Error("The socket was closed while the blob was being read");process.nextTick(U4,this,Y,Z);return}this._bufferedBytes-=X[g0];let G=o1(J);if(!$)this._state=l0,this.sendFrame(x1.frame(G,X),Z),this.dequeue();else this.dispatch(G,$,X,Z)}).catch((J)=>{process.nextTick(dz,this,J,Z)})}dispatch(_,$,X,Z){if(!$){this.sendFrame(x1.frame(_,X),Z);return}let J=this._extensions[o9.extensionName];this._bufferedBytes+=X[g0],this._state=mz,J.compress(_,X.fin,(G,Y)=>{if(this._socket.destroyed){let z=Error("The socket was closed while data was being compressed");U4(this,z,Z);return}this._bufferedBytes-=X[g0],this._state=l0,X.readOnly=!1,this.sendFrame(x1.frame(Y,X),Z),this.dequeue()})}dequeue(){while(this._state===l0&&this._queue.length){let _=this._queue.shift();this._bufferedBytes-=_[3][g0],Reflect.apply(_[0],this,_.slice(1))}}enqueue(_){this._bufferedBytes+=_[3][g0],this._queue.push(_)}sendFrame(_,$){if(_.length===2)this._socket.cork(),this._socket.write(_[0]),this._socket.write(_[1],$),this._socket.uncork();else this._socket.write(_[0],$)}}r9.exports=x1;function U4(_,$,X){if(typeof X==="function")X($);for(let Z=0;Z<_._queue.length;Z++){let J=_._queue[Z],G=J[J.length-1];if(typeof G==="function")G($)}}function dz(_,$,X){U4(_,$,X),_.onerror($)}});var G$=u((WO,J$)=>{var{kForOnEventAttribute:E_,kListener:K4}=O1(),a9=Symbol("kCode"),t9=Symbol("kData"),e9=Symbol("kError"),_$=Symbol("kMessage"),$$=Symbol("kReason"),w2=Symbol("kTarget"),X$=Symbol("kType"),Z$=Symbol("kWasClean");class q1{constructor(_){this[w2]=null,this[X$]=_}get target(){return this[w2]}get type(){return this[X$]}}Object.defineProperty(q1.prototype,"target",{enumerable:!0});Object.defineProperty(q1.prototype,"type",{enumerable:!0});class x2 extends q1{constructor(_,$={}){super(_);this[a9]=$.code===void 0?0:$.code,this[$$]=$.reason===void 0?"":$.reason,this[Z$]=$.wasClean===void 0?!1:$.wasClean}get code(){return this[a9]}get reason(){return this[$$]}get wasClean(){return this[Z$]}}Object.defineProperty(x2.prototype,"code",{enumerable:!0});Object.defineProperty(x2.prototype,"reason",{enumerable:!0});Object.defineProperty(x2.prototype,"wasClean",{enumerable:!0});class j_ extends q1{constructor(_,$={}){super(_);this[e9]=$.error===void 0?null:$.error,this[_$]=$.message===void 0?"":$.message}get error(){return this[e9]}get message(){return this[_$]}}Object.defineProperty(j_.prototype,"error",{enumerable:!0});Object.defineProperty(j_.prototype,"message",{enumerable:!0});class x6 extends q1{constructor(_,$={}){super(_);this[t9]=$.data===void 0?null:$.data}get data(){return this[t9]}}Object.defineProperty(x6.prototype,"data",{enumerable:!0});var cz={addEventListener(_,$,X={}){for(let J of this.listeners(_))if(!X[E_]&&J[K4]===$&&!J[E_])return;let Z;if(_==="message")Z=function(G,Y){let z=new x6("message",{data:Y?G:G.toString()});z[w2]=this,w6($,this,z)};else if(_==="close")Z=function(G,Y){let z=new x2("close",{code:G,reason:Y.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});z[w2]=this,w6($,this,z)};else if(_==="error")Z=function(G){let Y=new j_("error",{error:G,message:G.message});Y[w2]=this,w6($,this,Y)};else if(_==="open")Z=function(){let G=new q1("open");G[w2]=this,w6($,this,G)};else return;if(Z[E_]=!!X[E_],Z[K4]=$,X.once)this.once(_,Z);else this.on(_,Z)},removeEventListener(_,$){for(let X of this.listeners(_))if(X[K4]===$&&!X[E_]){this.removeListener(_,X);break}}};J$.exports={CloseEvent:x2,ErrorEvent:j_,Event:q1,EventTarget:cz,MessageEvent:x6};function w6(_,$,X){if(typeof _==="object"&&_.handleEvent)_.handleEvent.call(_,X);else _.call($,X)}});var D4=u((UO,Y$)=>{var{tokenChars:T_}=T2();function G1(_,$,X){if(_[$]===void 0)_[$]=[X];else _[$].push(X)}function lz(_){let $=Object.create(null),X=Object.create(null),Z=!1,J=!1,G=!1,Y,z,F=-1,H=-1,W=-1,A=0;for(;A<_.length;A++)if(H=_.charCodeAt(A),Y===void 0)if(W===-1&&T_[H]===1){if(F===-1)F=A}else if(A!==0&&(H===32||H===9)){if(W===-1&&F!==-1)W=A}else if(H===59||H===44){if(F===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;let O=_.slice(F,W);if(H===44)G1($,O,X),X=Object.create(null);else Y=O;F=W=-1}else throw SyntaxError(`Unexpected character at index ${A}`);else if(z===void 0)if(W===-1&&T_[H]===1){if(F===-1)F=A}else if(H===32||H===9){if(W===-1&&F!==-1)W=A}else if(H===59||H===44){if(F===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;if(G1(X,_.slice(F,W),!0),H===44)G1($,Y,X),X=Object.create(null),Y=void 0;F=W=-1}else if(H===61&&F!==-1&&W===-1)z=_.slice(F,A),F=W=-1;else throw SyntaxError(`Unexpected character at index ${A}`);else if(J){if(T_[H]!==1)throw SyntaxError(`Unexpected character at index ${A}`);if(F===-1)F=A;else if(!Z)Z=!0;J=!1}else if(G)if(T_[H]===1){if(F===-1)F=A}else if(H===34&&F!==-1)G=!1,W=A;else if(H===92)J=!0;else throw SyntaxError(`Unexpected character at index ${A}`);else if(H===34&&_.charCodeAt(A-1)===61)G=!0;else if(W===-1&&T_[H]===1){if(F===-1)F=A}else if(F!==-1&&(H===32||H===9)){if(W===-1)W=A}else if(H===59||H===44){if(F===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;let O=_.slice(F,W);if(Z)O=O.replace(/\\/g,""),Z=!1;if(G1(X,z,O),H===44)G1($,Y,X),X=Object.create(null),Y=void 0;z=void 0,F=W=-1}else throw SyntaxError(`Unexpected character at index ${A}`);if(F===-1||G||H===32||H===9)throw SyntaxError("Unexpected end of input");if(W===-1)W=A;let D=_.slice(F,W);if(Y===void 0)G1($,D,X);else{if(z===void 0)G1(X,D,!0);else if(Z)G1(X,z,D.replace(/\\/g,""));else G1(X,z,D);G1($,Y,X)}return $}function iz(_){return Object.keys(_).map(($)=>{let X=_[$];if(!Array.isArray(X))X=[X];return X.map((Z)=>{return[$].concat(Object.keys(Z).map((J)=>{let G=Z[J];if(!Array.isArray(G))G=[G];return G.map((Y)=>Y===!0?J:`${J}=${Y}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}Y$.exports={format:iz,parse:lz}});var k6=u((DO,N$)=>{var nz=S("events"),oz=S("https"),sz=S("http"),H$=S("net"),rz=S("tls"),{randomBytes:az,createHash:tz}=S("crypto"),{Duplex:AO,Readable:KO}=S("stream"),{URL:O4}=S("url"),C1=Q_(),ez=W4(),_F=A4(),{isBlob:$F}=T2(),{BINARY_TYPES:z$,EMPTY_BUFFER:q6,GUID:XF,kForOnEventAttribute:R4,kListener:ZF,kStatusCode:JF,kWebSocket:H0,NOOP:W$}=O1(),{EventTarget:{addEventListener:GF,removeEventListener:YF}}=G$(),{format:zF,parse:FF}=D4(),{toBuffer:HF}=B_(),U$=Symbol("kAborted"),V4=[8,13],V1=["CONNECTING","OPEN","CLOSING","CLOSED"],WF=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class P extends nz{constructor(_,$,X){super();if(this._binaryType=z$[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=q6,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=P.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,_!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,$===void 0)$=[];else if(!Array.isArray($))if(typeof $==="object"&&$!==null)X=$,$=[];else $=[$];A$(this,_,$,X)}else this._autoPong=X.autoPong,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(_){if(!z$.includes(_))return;if(this._binaryType=_,this._receiver)this._receiver._binaryType=_}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(_,$,X){let Z=new ez({allowSynchronousEvents:X.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:X.maxPayload,skipUTF8Validation:X.skipUTF8Validation}),J=new _F(_,this._extensions,X.generateMask);if(this._receiver=Z,this._sender=J,this._socket=_,Z[H0]=this,J[H0]=this,_[H0]=this,Z.on("conclude",KF),Z.on("drain",DF),Z.on("error",OF),Z.on("message",RF),Z.on("ping",VF),Z.on("pong",NF),J.onerror=MF,_.setTimeout)_.setTimeout(0);if(_.setNoDelay)_.setNoDelay();if($.length>0)_.unshift($);_.on("close",O$),_.on("data",S6),_.on("end",R$),_.on("error",V$),this._readyState=P.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[C1.extensionName])this._extensions[C1.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(_,$){if(this.readyState===P.CLOSED)return;if(this.readyState===P.CONNECTING){P0(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===P.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=P.CLOSING,this._sender.close(_,$,!this._isServer,(X)=>{if(X)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),D$(this)}pause(){if(this.readyState===P.CONNECTING||this.readyState===P.CLOSED)return;this._paused=!0,this._socket.pause()}ping(_,$,X){if(this.readyState===P.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==P.OPEN){N4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.ping(_||q6,$,X)}pong(_,$,X){if(this.readyState===P.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==P.OPEN){N4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.pong(_||q6,$,X)}resume(){if(this.readyState===P.CONNECTING||this.readyState===P.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(_,$,X){if(this.readyState===P.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")X=$,$={};if(typeof _==="number")_=_.toString();if(this.readyState!==P.OPEN){N4(this,_,X);return}let Z={binary:typeof _!=="string",mask:!this._isServer,compress:!0,fin:!0,...$};if(!this._extensions[C1.extensionName])Z.compress=!1;this._sender.send(_||q6,Z,X)}terminate(){if(this.readyState===P.CLOSED)return;if(this.readyState===P.CONNECTING){P0(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=P.CLOSING,this._socket.destroy()}}Object.defineProperty(P,"CONNECTING",{enumerable:!0,value:V1.indexOf("CONNECTING")});Object.defineProperty(P.prototype,"CONNECTING",{enumerable:!0,value:V1.indexOf("CONNECTING")});Object.defineProperty(P,"OPEN",{enumerable:!0,value:V1.indexOf("OPEN")});Object.defineProperty(P.prototype,"OPEN",{enumerable:!0,value:V1.indexOf("OPEN")});Object.defineProperty(P,"CLOSING",{enumerable:!0,value:V1.indexOf("CLOSING")});Object.defineProperty(P.prototype,"CLOSING",{enumerable:!0,value:V1.indexOf("CLOSING")});Object.defineProperty(P,"CLOSED",{enumerable:!0,value:V1.indexOf("CLOSED")});Object.defineProperty(P.prototype,"CLOSED",{enumerable:!0,value:V1.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((_)=>{Object.defineProperty(P.prototype,_,{enumerable:!0})});["open","error","close","message"].forEach((_)=>{Object.defineProperty(P.prototype,`on${_}`,{enumerable:!0,get(){for(let $ of this.listeners(_))if($[R4])return $[ZF];return null},set($){for(let X of this.listeners(_))if(X[R4]){this.removeListener(_,X);break}if(typeof $!=="function")return;this.addEventListener(_,$,{[R4]:!0})}})});P.prototype.addEventListener=GF;P.prototype.removeEventListener=YF;N$.exports=P;function A$(_,$,X,Z){let J={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:V4[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...Z,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(_._autoPong=J.autoPong,!V4.includes(J.protocolVersion))throw RangeError(`Unsupported protocol version: ${J.protocolVersion} (supported versions: ${V4.join(", ")})`);let G;if($ instanceof O4)G=$;else try{G=new O4($)}catch(N){throw SyntaxError(`Invalid URL: ${$}`)}if(G.protocol==="http:")G.protocol="ws:";else if(G.protocol==="https:")G.protocol="wss:";_._url=G.href;let Y=G.protocol==="wss:",z=G.protocol==="ws+unix:",F;if(G.protocol!=="ws:"&&!Y&&!z)F=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(z&&!G.pathname)F="The URL's pathname is empty";else if(G.hash)F="The URL contains a fragment identifier";if(F){let N=SyntaxError(F);if(_._redirects===0)throw N;else{C6(_,N);return}}let H=Y?443:80,W=az(16).toString("base64"),A=Y?oz.request:sz.request,D=new Set,O;if(J.createConnection=J.createConnection||(Y?AF:UF),J.defaultPort=J.defaultPort||H,J.port=G.port||H,J.host=G.hostname.startsWith("[")?G.hostname.slice(1,-1):G.hostname,J.headers={...J.headers,"Sec-WebSocket-Version":J.protocolVersion,"Sec-WebSocket-Key":W,Connection:"Upgrade",Upgrade:"websocket"},J.path=G.pathname+G.search,J.timeout=J.handshakeTimeout,J.perMessageDeflate)O=new C1(J.perMessageDeflate!==!0?J.perMessageDeflate:{},!1,J.maxPayload),J.headers["Sec-WebSocket-Extensions"]=zF({[C1.extensionName]:O.offer()});if(X.length){for(let N of X){if(typeof N!=="string"||!WF.test(N)||D.has(N))throw SyntaxError("An invalid or duplicated subprotocol was specified");D.add(N)}J.headers["Sec-WebSocket-Protocol"]=X.join(",")}if(J.origin)if(J.protocolVersion<13)J.headers["Sec-WebSocket-Origin"]=J.origin;else J.headers.Origin=J.origin;if(G.username||G.password)J.auth=`${G.username}:${G.password}`;if(z){let N=J.path.split(":");J.socketPath=N[0],J.path=N[1]}let R;if(J.followRedirects){if(_._redirects===0){_._originalIpc=z,_._originalSecure=Y,_._originalHostOrSocketPath=z?J.socketPath:G.host;let N=Z&&Z.headers;if(Z={...Z,headers:{}},N)for(let[I,y]of Object.entries(N))Z.headers[I.toLowerCase()]=y}else if(_.listenerCount("redirect")===0){let N=z?_._originalIpc?J.socketPath===_._originalHostOrSocketPath:!1:_._originalIpc?!1:G.host===_._originalHostOrSocketPath;if(!N||_._originalSecure&&!Y){if(delete J.headers.authorization,delete J.headers.cookie,!N)delete J.headers.host;J.auth=void 0}}if(J.auth&&!Z.headers.authorization)Z.headers.authorization="Basic "+Buffer.from(J.auth).toString("base64");if(R=_._req=A(J),_._redirects)_.emit("redirect",_.url,R)}else R=_._req=A(J);if(J.timeout)R.on("timeout",()=>{P0(_,R,"Opening handshake has timed out")});if(R.on("error",(N)=>{if(R===null||R[U$])return;R=_._req=null,C6(_,N)}),R.on("response",(N)=>{let I=N.headers.location,y=N.statusCode;if(I&&J.followRedirects&&y>=300&&y<400){if(++_._redirects>J.maxRedirects){P0(_,R,"Maximum redirects exceeded");return}R.abort();let k;try{k=new O4(I,$)}catch(C){let Y0=SyntaxError(`Invalid URL: ${I}`);C6(_,Y0);return}A$(_,k,X,Z)}else if(!_.emit("unexpected-response",R,N))P0(_,R,`Unexpected server response: ${N.statusCode}`)}),R.on("upgrade",(N,I,y)=>{if(_.emit("upgrade",N),_.readyState!==P.CONNECTING)return;R=_._req=null;let k=N.headers.upgrade;if(k===void 0||k.toLowerCase()!=="websocket"){P0(_,I,"Invalid Upgrade header");return}let C=tz("sha1").update(W+XF).digest("base64");if(N.headers["sec-websocket-accept"]!==C){P0(_,I,"Invalid Sec-WebSocket-Accept header");return}let Y0=N.headers["sec-websocket-protocol"],_0;if(Y0!==void 0){if(!D.size)_0="Server sent a subprotocol but none was requested";else if(!D.has(Y0))_0="Server sent an invalid subprotocol"}else if(D.size)_0="Server sent no subprotocol";if(_0){P0(_,I,_0);return}if(Y0)_._protocol=Y0;let T=N.headers["sec-websocket-extensions"];if(T!==void 0){if(!O){P0(_,I,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let g;try{g=FF(T)}catch(Q1){P0(_,I,"Invalid Sec-WebSocket-Extensions header");return}let S0=Object.keys(g);if(S0.length!==1||S0[0]!==C1.extensionName){P0(_,I,"Server indicated an extension that was not requested");return}try{O.accept(g[C1.extensionName])}catch(Q1){P0(_,I,"Invalid Sec-WebSocket-Extensions header");return}_._extensions[C1.extensionName]=O}_.setSocket(I,y,{allowSynchronousEvents:J.allowSynchronousEvents,generateMask:J.generateMask,maxPayload:J.maxPayload,skipUTF8Validation:J.skipUTF8Validation})}),J.finishRequest)J.finishRequest(R,_);else R.end()}function C6(_,$){_._readyState=P.CLOSING,_._errorEmitted=!0,_.emit("error",$),_.emitClose()}function UF(_){return _.path=_.socketPath,H$.connect(_)}function AF(_){if(_.path=void 0,!_.servername&&_.servername!=="")_.servername=H$.isIP(_.host)?"":_.host;return rz.connect(_)}function P0(_,$,X){_._readyState=P.CLOSING;let Z=Error(X);if(Error.captureStackTrace(Z,P0),$.setHeader){if($[U$]=!0,$.abort(),$.socket&&!$.socket.destroyed)$.socket.destroy();process.nextTick(C6,_,Z)}else $.destroy(Z),$.once("error",_.emit.bind(_,"error")),$.once("close",_.emitClose.bind(_))}function N4(_,$,X){if($){let Z=$F($)?$.size:HF($).length;if(_._socket)_._sender._bufferedBytes+=Z;else _._bufferedAmount+=Z}if(X){let Z=Error(`WebSocket is not open: readyState ${_.readyState} (${V1[_.readyState]})`);process.nextTick(X,Z)}}function KF(_,$){let X=this[H0];if(X._closeFrameReceived=!0,X._closeMessage=$,X._closeCode=_,X._socket[H0]===void 0)return;if(X._socket.removeListener("data",S6),process.nextTick(K$,X._socket),_===1005)X.close();else X.close(_,$)}function DF(){let _=this[H0];if(!_.isPaused)_._socket.resume()}function OF(_){let $=this[H0];if($._socket[H0]!==void 0)$._socket.removeListener("data",S6),process.nextTick(K$,$._socket),$.close(_[JF]);if(!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function F$(){this[H0].emitClose()}function RF(_,$){this[H0].emit("message",_,$)}function VF(_){let $=this[H0];if($._autoPong)$.pong(_,!this._isServer,W$);$.emit("ping",_)}function NF(_){this[H0].emit("pong",_)}function K$(_){_.resume()}function MF(_){let $=this[H0];if($.readyState===P.CLOSED)return;if($.readyState===P.OPEN)$._readyState=P.CLOSING,D$($);if(this._socket.end(),!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function D$(_){_._closeTimer=setTimeout(_._socket.destroy.bind(_._socket),30000)}function O$(){let _=this[H0];this.removeListener("close",O$),this.removeListener("data",S6),this.removeListener("end",R$),_._readyState=P.CLOSING;let $;if(!this._readableState.endEmitted&&!_._closeFrameReceived&&!_._receiver._writableState.errorEmitted&&($=_._socket.read())!==null)_._receiver.write($);if(_._receiver.end(),this[H0]=void 0,clearTimeout(_._closeTimer),_._receiver._writableState.finished||_._receiver._writableState.errorEmitted)_.emitClose();else _._receiver.on("error",F$),_._receiver.on("finish",F$)}function S6(_){if(!this[H0]._receiver.write(_))this.pause()}function R$(){let _=this[H0];_._readyState=P.CLOSING,_._receiver.end(),this.end()}function V$(){let _=this[H0];if(this.removeListener("error",V$),this.on("error",W$),_)_._readyState=P.CLOSING,this.destroy()}});var Q$=u((RO,I$)=>{var OO=k6(),{Duplex:BF}=S("stream");function M$(_){_.emit("close")}function IF(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function B$(_){if(this.removeListener("error",B$),this.destroy(),this.listenerCount("error")===0)this.emit("error",_)}function QF(_,$){let X=!0,Z=new BF({...$,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return _.on("message",function(G,Y){let z=!Y&&Z._readableState.objectMode?G.toString():G;if(!Z.push(z))_.pause()}),_.once("error",function(G){if(Z.destroyed)return;X=!1,Z.destroy(G)}),_.once("close",function(){if(Z.destroyed)return;Z.push(null)}),Z._destroy=function(J,G){if(_.readyState===_.CLOSED){G(J),process.nextTick(M$,Z);return}let Y=!1;if(_.once("error",function(F){Y=!0,G(F)}),_.once("close",function(){if(!Y)G(J);process.nextTick(M$,Z)}),X)_.terminate()},Z._final=function(J){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._final(J)});return}if(_._socket===null)return;if(_._socket._writableState.finished){if(J(),Z._readableState.endEmitted)Z.destroy()}else _._socket.once("finish",function(){J()}),_.close()},Z._read=function(){if(_.isPaused)_.resume()},Z._write=function(J,G,Y){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._write(J,G,Y)});return}_.send(J,Y)},Z.on("end",IF),Z.on("error",B$),Z}I$.exports=QF});var j$=u((VO,E$)=>{var{tokenChars:EF}=T2();function jF(_){let $=new Set,X=-1,Z=-1,J=0;for(J;J<_.length;J++){let Y=_.charCodeAt(J);if(Z===-1&&EF[Y]===1){if(X===-1)X=J}else if(J!==0&&(Y===32||Y===9)){if(Z===-1&&X!==-1)Z=J}else if(Y===44){if(X===-1)throw SyntaxError(`Unexpected character at index ${J}`);if(Z===-1)Z=J;let z=_.slice(X,Z);if($.has(z))throw SyntaxError(`The "${z}" subprotocol is duplicated`);$.add(z),X=Z=-1}else throw SyntaxError(`Unexpected character at index ${J}`)}if(X===-1||Z!==-1)throw SyntaxError("Unexpected end of input");let G=_.slice(X,J);if($.has(G))throw SyntaxError(`The "${G}" subprotocol is duplicated`);return $.add(G),$}E$.exports={parse:jF}});var x$=u((MO,w$)=>{var TF=S("events"),v6=S("http"),{Duplex:NO}=S("stream"),{createHash:LF}=S("crypto"),T$=D4(),r1=Q_(),PF=j$(),wF=k6(),{GUID:xF,kWebSocket:qF}=O1(),CF=/^[+/0-9A-Za-z]{22}==$/;class P$ extends TF{constructor(_,$){super();if(_={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:wF,..._},_.port==null&&!_.server&&!_.noServer||_.port!=null&&(_.server||_.noServer)||_.server&&_.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(_.port!=null)this._server=v6.createServer((X,Z)=>{let J=v6.STATUS_CODES[426];Z.writeHead(426,{"Content-Length":J.length,"Content-Type":"text/plain"}),Z.end(J)}),this._server.listen(_.port,_.host,_.backlog,$);else if(_.server)this._server=_.server;if(this._server){let X=this.emit.bind(this,"connection");this._removeListeners=SF(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(Z,J,G)=>{this.handleUpgrade(Z,J,G,X)}})}if(_.perMessageDeflate===!0)_.perMessageDeflate={};if(_.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=_,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(_){if(this._state===2){if(_)this.once("close",()=>{_(Error("The server is not running"))});process.nextTick(L_,this);return}if(_)this.once("close",_);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(L_,this);else this._shouldEmitClose=!0;else process.nextTick(L_,this)}else{let $=this._server;this._removeListeners(),this._removeListeners=this._server=null,$.close(()=>{L_(this)})}}shouldHandle(_){if(this.options.path){let $=_.url.indexOf("?");if(($!==-1?_.url.slice(0,$):_.url)!==this.options.path)return!1}return!0}handleUpgrade(_,$,X,Z){$.on("error",L$);let J=_.headers["sec-websocket-key"],G=_.headers.upgrade,Y=+_.headers["sec-websocket-version"];if(_.method!=="GET"){a1(this,_,$,405,"Invalid HTTP method");return}if(G===void 0||G.toLowerCase()!=="websocket"){a1(this,_,$,400,"Invalid Upgrade header");return}if(J===void 0||!CF.test(J)){a1(this,_,$,400,"Missing or invalid Sec-WebSocket-Key header");return}if(Y!==13&&Y!==8){a1(this,_,$,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(_)){P_($,400);return}let z=_.headers["sec-websocket-protocol"],F=new Set;if(z!==void 0)try{F=PF.parse(z)}catch(A){a1(this,_,$,400,"Invalid Sec-WebSocket-Protocol header");return}let H=_.headers["sec-websocket-extensions"],W={};if(this.options.perMessageDeflate&&H!==void 0){let A=new r1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let D=T$.parse(H);if(D[r1.extensionName])A.accept(D[r1.extensionName]),W[r1.extensionName]=A}catch(D){a1(this,_,$,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let A={origin:_.headers[`${Y===8?"sec-websocket-origin":"origin"}`],secure:!!(_.socket.authorized||_.socket.encrypted),req:_};if(this.options.verifyClient.length===2){this.options.verifyClient(A,(D,O,R,N)=>{if(!D)return P_($,O||401,R,N);this.completeUpgrade(W,J,F,_,$,X,Z)});return}if(!this.options.verifyClient(A))return P_($,401)}this.completeUpgrade(W,J,F,_,$,X,Z)}completeUpgrade(_,$,X,Z,J,G,Y){if(!J.readable||!J.writable)return J.destroy();if(J[qF])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return P_(J,503);let F=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${LF("sha1").update($+xF).digest("base64")}`],H=new this.options.WebSocket(null,void 0,this.options);if(X.size){let W=this.options.handleProtocols?this.options.handleProtocols(X,Z):X.values().next().value;if(W)F.push(`Sec-WebSocket-Protocol: ${W}`),H._protocol=W}if(_[r1.extensionName]){let W=_[r1.extensionName].params,A=T$.format({[r1.extensionName]:[W]});F.push(`Sec-WebSocket-Extensions: ${A}`),H._extensions=_}if(this.emit("headers",F,Z),J.write(F.concat(`\r
`).join(`\r
`)),J.removeListener("error",L$),H.setSocket(J,G,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(H),H.on("close",()=>{if(this.clients.delete(H),this._shouldEmitClose&&!this.clients.size)process.nextTick(L_,this)});Y(H,Z)}}w$.exports=P$;function SF(_,$){for(let X of Object.keys($))_.on(X,$[X]);return function(){for(let Z of Object.keys($))_.removeListener(Z,$[Z])}}function L_(_){_._state=2,_.emit("close")}function L$(){this.destroy()}function P_(_,$,X,Z){X=X||v6.STATUS_CODES[$],Z={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(X),...Z},_.once("finish",_.destroy),_.end(`HTTP/1.1 ${$} ${v6.STATUS_CODES[$]}\r
`+Object.keys(Z).map((J)=>`${J}: ${Z[J]}`).join(`\r
`)+`\r
\r
`+X)}function a1(_,$,X,Z,J,G){if(_.listenerCount("wsClientError")){let Y=Error(J);Error.captureStackTrace(Y,a1),_.emit("wsClientError",Y,X,$)}else P_(X,Z,J,G)}});var v4=u((NN,FX)=>{function aH(_){var $=0,X=[];function Z(){if($--,$<_)J()}function J(){var F=X.shift();if(z.queue=X.length,F)Y(F.fn).then(F.resolve).catch(F.reject)}function G(F){return new Promise(function(H,W){X.push({fn:F,resolve:H,reject:W}),z.queue=X.length})}function Y(F){$++;try{return Promise.resolve(F()).then(function(H){return Z(),H},function(H){throw Z(),H})}catch(H){return Z(),Promise.reject(H)}}var z=function(F){if($>=_)return G(F);else return Y(F)};return z}function tH(_,$){var X=!1,Z=this;return Promise.all(_.map(function(){var J=arguments;return Z(function(){if(!X)return $.apply(void 0,J).catch(function(G){throw X=!0,G})})}))}function zX(_){return _.queue=0,_.map=tH,_}FX.exports=function(_){if(_)return zX(aH(_));else return zX(function($){return $()})}});var m5=Q0(p5(),1),{program:ZU,createCommand:JU,createArgument:GU,createOption:YU,CommanderError:zU,InvalidArgumentError:FU,InvalidOptionArgumentError:HU,Command:N0,Argument:WU,Option:UU,Help:AU}=m5.default;var u5=(_=0)=>($)=>`\x1B[${$+_}m`,d5=(_=0)=>($)=>`\x1B[${38+_};5;${$}m`,c5=(_=0)=>($,X,Z)=>`\x1B[${38+_};2;${$};${X};${Z}m`,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},DU=Object.keys(i.modifier),fJ=Object.keys(i.color),bJ=Object.keys(i.bgColor),OU=[...fJ,...bJ];function gJ(){let _=new Map;for(let[$,X]of Object.entries(i)){for(let[Z,J]of Object.entries(X))i[Z]={open:`\x1B[${J[0]}m`,close:`\x1B[${J[1]}m`},X[Z]=i[Z],_.set(J[0],J[1]);Object.defineProperty(i,$,{value:X,enumerable:!1})}return Object.defineProperty(i,"codes",{value:_,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi=u5(),i.color.ansi256=d5(),i.color.ansi16m=c5(),i.bgColor.ansi=u5(10),i.bgColor.ansi256=d5(10),i.bgColor.ansi16m=c5(10),Object.defineProperties(i,{rgbToAnsi256:{value($,X,Z){if($===X&&X===Z){if($<8)return 16;if($>248)return 231;return Math.round(($-8)/247*24)+232}return 16+36*Math.round($/255*5)+6*Math.round(X/255*5)+Math.round(Z/255*5)},enumerable:!1},hexToRgb:{value($){let X=/[a-f\d]{6}|[a-f\d]{3}/i.exec($.toString(16));if(!X)return[0,0,0];let[Z]=X;if(Z.length===3)Z=[...Z].map((G)=>G+G).join("");let J=Number.parseInt(Z,16);return[J>>16&255,J>>8&255,J&255]},enumerable:!1},hexToAnsi256:{value:($)=>i.rgbToAnsi256(...i.hexToRgb($)),enumerable:!1},ansi256ToAnsi:{value($){if($<8)return 30+$;if($<16)return 90+($-8);let X,Z,J;if($>=232)X=(($-232)*10+8)/255,Z=X,J=X;else{$-=16;let z=$%36;X=Math.floor($/36)/5,Z=Math.floor(z/6)/5,J=z%6/5}let G=Math.max(X,Z,J)*2;if(G===0)return 30;let Y=30+(Math.round(J)<<2|Math.round(Z)<<1|Math.round(X));if(G===2)Y+=60;return Y},enumerable:!1},rgbToAnsi:{value:($,X,Z)=>i.ansi256ToAnsi(i.rgbToAnsi256($,X,Z)),enumerable:!1},hexToAnsi:{value:($)=>i.ansi256ToAnsi(i.hexToAnsi256($)),enumerable:!1}}),i}var pJ=gJ(),d0=pJ;import M8 from"node:process";import mJ from"node:os";import l5 from"node:tty";function k0(_,$=globalThis.Deno?globalThis.Deno.args:M8.argv){let X=_.startsWith("-")?"":_.length===1?"-":"--",Z=$.indexOf(X+_),J=$.indexOf("--");return Z!==-1&&(J===-1||Z<J)}var{env:n}=M8,_6;if(k0("no-color")||k0("no-colors")||k0("color=false")||k0("color=never"))_6=0;else if(k0("color")||k0("colors")||k0("color=true")||k0("color=always"))_6=1;function uJ(){if("FORCE_COLOR"in n){if(n.FORCE_COLOR==="true")return 1;if(n.FORCE_COLOR==="false")return 0;return n.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(n.FORCE_COLOR,10),3)}}function dJ(_){if(_===0)return!1;return{level:_,hasBasic:!0,has256:_>=2,has16m:_>=3}}function cJ(_,{streamIsTTY:$,sniffFlags:X=!0}={}){let Z=uJ();if(Z!==void 0)_6=Z;let J=X?_6:Z;if(J===0)return 0;if(X){if(k0("color=16m")||k0("color=full")||k0("color=truecolor"))return 3;if(k0("color=256"))return 2}if("TF_BUILD"in n&&"AGENT_NAME"in n)return 1;if(_&&!$&&J===void 0)return 0;let G=J||0;if(n.TERM==="dumb")return G;if(M8.platform==="win32"){let Y=mJ.release().split(".");if(Number(Y[0])>=10&&Number(Y[2])>=10586)return Number(Y[2])>=14931?3:2;return 1}if("CI"in n){if(["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some((Y)=>(Y in n)))return 3;if(["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some((Y)=>(Y in n))||n.CI_NAME==="codeship")return 1;return G}if("TEAMCITY_VERSION"in n)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(n.TEAMCITY_VERSION)?1:0;if(n.COLORTERM==="truecolor")return 3;if(n.TERM==="xterm-kitty")return 3;if(n.TERM==="xterm-ghostty")return 3;if(n.TERM==="wezterm")return 3;if("TERM_PROGRAM"in n){let Y=Number.parseInt((n.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(n.TERM_PROGRAM){case"iTerm.app":return Y>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(n.TERM))return 2;if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(n.TERM))return 1;if("COLORTERM"in n)return 1;return G}function i5(_,$={}){let X=cJ(_,{streamIsTTY:_&&_.isTTY,...$});return dJ(X)}var lJ={stdout:i5({isTTY:l5.isatty(1)}),stderr:i5({isTTY:l5.isatty(2)})},n5=lJ;function o5(_,$,X){let Z=_.indexOf($);if(Z===-1)return _;let J=$.length,G=0,Y="";do Y+=_.slice(G,Z)+$+X,G=Z+J,Z=_.indexOf($,G);while(Z!==-1);return Y+=_.slice(G),Y}function s5(_,$,X,Z){let J=0,G="";do{let Y=_[Z-1]==="\r";G+=_.slice(J,Y?Z-1:Z)+$+(Y?`\r
`:`
`)+X,J=Z+1,Z=_.indexOf(`
`,J)}while(Z!==-1);return G+=_.slice(J),G}var{stdout:r5,stderr:a5}=n5,B8=Symbol("GENERATOR"),W2=Symbol("STYLER"),e2=Symbol("IS_EMPTY"),t5=["ansi","ansi","ansi256","ansi16m"],U2=Object.create(null),iJ=(_,$={})=>{if($.level&&!(Number.isInteger($.level)&&$.level>=0&&$.level<=3))throw Error("The `level` option should be an integer from 0 to 3");let X=r5?r5.level:0;_.level=$.level===void 0?X:$.level};var nJ=(_)=>{let $=(...X)=>X.join(" ");return iJ($,_),Object.setPrototypeOf($,__.prototype),$};function __(_){return nJ(_)}Object.setPrototypeOf(__.prototype,Function.prototype);for(let[_,$]of Object.entries(d0))U2[_]={get(){let X=$6(this,Q8($.open,$.close,this[W2]),this[e2]);return Object.defineProperty(this,_,{value:X}),X}};U2.visible={get(){let _=$6(this,this[W2],!0);return Object.defineProperty(this,"visible",{value:_}),_}};var I8=(_,$,X,...Z)=>{if(_==="rgb"){if($==="ansi16m")return d0[X].ansi16m(...Z);if($==="ansi256")return d0[X].ansi256(d0.rgbToAnsi256(...Z));return d0[X].ansi(d0.rgbToAnsi(...Z))}if(_==="hex")return I8("rgb",$,X,...d0.hexToRgb(...Z));return d0[X][_](...Z)},oJ=["rgb","hex","ansi256"];for(let _ of oJ){U2[_]={get(){let{level:X}=this;return function(...Z){let J=Q8(I8(_,t5[X],"color",...Z),d0.color.close,this[W2]);return $6(this,J,this[e2])}}};let $="bg"+_[0].toUpperCase()+_.slice(1);U2[$]={get(){let{level:X}=this;return function(...Z){let J=Q8(I8(_,t5[X],"bgColor",...Z),d0.bgColor.close,this[W2]);return $6(this,J,this[e2])}}}}var sJ=Object.defineProperties(()=>{},{...U2,level:{enumerable:!0,get(){return this[B8].level},set(_){this[B8].level=_}}}),Q8=(_,$,X)=>{let Z,J;if(X===void 0)Z=_,J=$;else Z=X.openAll+_,J=$+X.closeAll;return{open:_,close:$,openAll:Z,closeAll:J,parent:X}},$6=(_,$,X)=>{let Z=(...J)=>rJ(Z,J.length===1?""+J[0]:J.join(" "));return Object.setPrototypeOf(Z,sJ),Z[B8]=_,Z[W2]=$,Z[e2]=X,Z},rJ=(_,$)=>{if(_.level<=0||!$)return _[e2]?"":$;let X=_[W2];if(X===void 0)return $;let{openAll:Z,closeAll:J}=X;if($.includes("\x1B"))while(X!==void 0)$=o5($,X.close,X.open),X=X.parent;let G=$.indexOf(`
`);if(G!==-1)$=s5($,J,Z,G);return Z+$+J};Object.defineProperties(__.prototype,U2);var aJ=__(),TU=__({level:a5?a5.level:0});var M=aJ;import F6 from"node:process";import z3 from"node:process";import J6 from"node:process";var tJ=(_,$,X,Z)=>{if(X==="length"||X==="prototype")return;if(X==="arguments"||X==="caller")return;let J=Object.getOwnPropertyDescriptor(_,X),G=Object.getOwnPropertyDescriptor($,X);if(!eJ(J,G)&&Z)return;Object.defineProperty(_,X,G)},eJ=function(_,$){return _===void 0||_.configurable||_.writable===$.writable&&_.enumerable===$.enumerable&&_.configurable===$.configurable&&(_.writable||_.value===$.value)},_G=(_,$)=>{let X=Object.getPrototypeOf($);if(X===Object.getPrototypeOf(_))return;Object.setPrototypeOf(_,X)},$G=(_,$)=>`/* Wrapped ${_}*/
${$}`,XG=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),ZG=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),JG=(_,$,X)=>{let Z=X===""?"":`with ${X.trim()}() `,J=$G.bind(null,Z,$.toString());Object.defineProperty(J,"name",ZG);let{writable:G,enumerable:Y,configurable:z}=XG;Object.defineProperty(_,"toString",{value:J,writable:G,enumerable:Y,configurable:z})};function E8(_,$,{ignoreNonConfigurable:X=!1}={}){let{name:Z}=_;for(let J of Reflect.ownKeys($))tJ(_,$,J,X);return _G(_,$),JG(_,$,Z),_}var X6=new WeakMap,e5=(_,$={})=>{if(typeof _!=="function")throw TypeError("Expected a function");let X,Z=0,J=_.displayName||_.name||"<anonymous>",G=function(...Y){if(X6.set(G,++Z),Z===1)X=_.apply(this,Y),_=void 0;else if($.throw===!0)throw Error(`Function \`${J}\` can only be called once`);return X};return E8(G,_),X6.set(G,Z),G};e5.callCount=(_)=>{if(!X6.has(_))throw Error(`The given function \`${_.name}\` is not wrapped by the \`onetime\` package`);return X6.get(_)};var _3=e5;var u1=[];u1.push("SIGHUP","SIGINT","SIGTERM");if(process.platform!=="win32")u1.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");if(process.platform==="linux")u1.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var Z6=(_)=>!!_&&typeof _==="object"&&typeof _.removeListener==="function"&&typeof _.emit==="function"&&typeof _.reallyExit==="function"&&typeof _.listeners==="function"&&typeof _.kill==="function"&&typeof _.pid==="number"&&typeof _.on==="function",j8=Symbol.for("signal-exit emitter"),T8=globalThis,GG=Object.defineProperty.bind(Object);class $3{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(T8[j8])return T8[j8];GG(T8,j8,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(_,$){this.listeners[_].push($)}removeListener(_,$){let X=this.listeners[_],Z=X.indexOf($);if(Z===-1)return;if(Z===0&&X.length===1)X.length=0;else X.splice(Z,1)}emit(_,$,X){if(this.emitted[_])return!1;this.emitted[_]=!0;let Z=!1;for(let J of this.listeners[_])Z=J($,X)===!0||Z;if(_==="exit")Z=this.emit("afterExit",$,X)||Z;return Z}}class P8{}var YG=(_)=>{return{onExit($,X){return _.onExit($,X)},load(){return _.load()},unload(){return _.unload()}}};class X3 extends P8{onExit(){return()=>{}}load(){}unload(){}}class Z3 extends P8{#_=L8.platform==="win32"?"SIGINT":"SIGHUP";#$=new $3;#X;#Z;#J;#G={};#Y=!1;constructor(_){super();this.#X=_,this.#G={};for(let $ of u1)this.#G[$]=()=>{let X=this.#X.listeners($),{count:Z}=this.#$,J=_;if(typeof J.__signal_exit_emitter__==="object"&&typeof J.__signal_exit_emitter__.count==="number")Z+=J.__signal_exit_emitter__.count;if(X.length===Z){this.unload();let G=this.#$.emit("exit",null,$),Y=$==="SIGHUP"?this.#_:$;if(!G)_.kill(_.pid,Y)}};this.#J=_.reallyExit,this.#Z=_.emit}onExit(_,$){if(!Z6(this.#X))return()=>{};if(this.#Y===!1)this.load();let X=$?.alwaysLast?"afterExit":"exit";return this.#$.on(X,_),()=>{if(this.#$.removeListener(X,_),this.#$.listeners.exit.length===0&&this.#$.listeners.afterExit.length===0)this.unload()}}load(){if(this.#Y)return;this.#Y=!0,this.#$.count+=1;for(let _ of u1)try{let $=this.#G[_];if($)this.#X.on(_,$)}catch($){}this.#X.emit=(_,...$)=>{return this.#F(_,...$)},this.#X.reallyExit=(_)=>{return this.#z(_)}}unload(){if(!this.#Y)return;this.#Y=!1,u1.forEach((_)=>{let $=this.#G[_];if(!$)throw Error("Listener not defined for signal: "+_);try{this.#X.removeListener(_,$)}catch(X){}}),this.#X.emit=this.#Z,this.#X.reallyExit=this.#J,this.#$.count-=1}#z(_){if(!Z6(this.#X))return 0;return this.#X.exitCode=_||0,this.#$.emit("exit",this.#X.exitCode,null),this.#J.call(this.#X,this.#X.exitCode)}#F(_,...$){let X=this.#Z;if(_==="exit"&&Z6(this.#X)){if(typeof $[0]==="number")this.#X.exitCode=$[0];let Z=X.call(this.#X,_,...$);return this.#$.emit("exit",this.#X.exitCode,null),Z}else return X.call(this.#X,_,...$)}}var L8=globalThis.process,{onExit:J3,load:SU,unload:kU}=YG(Z6(L8)?new Z3(L8):new X3);var G3=J6.stderr.isTTY?J6.stderr:J6.stdout.isTTY?J6.stdout:void 0,zG=G3?_3(()=>{J3(()=>{G3.write("\x1B[?25h")},{alwaysLast:!0})}):()=>{},Y3=zG;var G6=!1,A2={};A2.show=(_=z3.stderr)=>{if(!_.isTTY)return;G6=!1,_.write("\x1B[?25h")};A2.hide=(_=z3.stderr)=>{if(!_.isTTY)return;Y3(),G6=!0,_.write("\x1B[?25l")};A2.toggle=(_,$)=>{if(_!==void 0)G6=_;if(G6)A2.show($);else A2.hide($)};var w8=A2;var x8={dots:{interval:80,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"]},dots2:{interval:80,frames:["⣾","⣽","⣻","⢿","⡿","⣟","⣯","⣷"]},dots3:{interval:80,frames:["⠋","⠙","⠚","⠞","⠖","⠦","⠴","⠲","⠳","⠓"]},dots4:{interval:80,frames:["⠄","⠆","⠇","⠋","⠙","⠸","⠰","⠠","⠰","⠸","⠙","⠋","⠇","⠆"]},dots5:{interval:80,frames:["⠋","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋"]},dots6:{interval:80,frames:["⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠴","⠲","⠒","⠂","⠂","⠒","⠚","⠙","⠉","⠁"]},dots7:{interval:80,frames:["⠈","⠉","⠋","⠓","⠒","⠐","⠐","⠒","⠖","⠦","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈"]},dots8:{interval:80,frames:["⠁","⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈","⠈"]},dots9:{interval:80,frames:["⢹","⢺","⢼","⣸","⣇","⡧","⡗","⡏"]},dots10:{interval:80,frames:["⢄","⢂","⢁","⡁","⡈","⡐","⡠"]},dots11:{interval:100,frames:["⠁","⠂","⠄","⡀","⢀","⠠","⠐","⠈"]},dots12:{interval:80,frames:["⢀⠀","⡀⠀","⠄⠀","⢂⠀","⡂⠀","⠅⠀","⢃⠀","⡃⠀","⠍⠀","⢋⠀","⡋⠀","⠍⠁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⢈⠩","⡀⢙","⠄⡙","⢂⠩","⡂⢘","⠅⡘","⢃⠨","⡃⢐","⠍⡐","⢋⠠","⡋⢀","⠍⡁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⠈⠩","⠀⢙","⠀⡙","⠀⠩","⠀⢘","⠀⡘","⠀⠨","⠀⢐","⠀⡐","⠀⠠","⠀⢀","⠀⡀"]},dots13:{interval:80,frames:["⣼","⣹","⢻","⠿","⡟","⣏","⣧","⣶"]},dots14:{interval:80,frames:["⠉⠉","⠈⠙","⠀⠹","⠀⢸","⠀⣰","⢀⣠","⣀⣀","⣄⡀","⣆⠀","⡇⠀","⠏⠀","⠋⠁"]},dots8Bit:{interval:80,frames:["⠀","⠁","⠂","⠃","⠄","⠅","⠆","⠇","⡀","⡁","⡂","⡃","⡄","⡅","⡆","⡇","⠈","⠉","⠊","⠋","⠌","⠍","⠎","⠏","⡈","⡉","⡊","⡋","⡌","⡍","⡎","⡏","⠐","⠑","⠒","⠓","⠔","⠕","⠖","⠗","⡐","⡑","⡒","⡓","⡔","⡕","⡖","⡗","⠘","⠙","⠚","⠛","⠜","⠝","⠞","⠟","⡘","⡙","⡚","⡛","⡜","⡝","⡞","⡟","⠠","⠡","⠢","⠣","⠤","⠥","⠦","⠧","⡠","⡡","⡢","⡣","⡤","⡥","⡦","⡧","⠨","⠩","⠪","⠫","⠬","⠭","⠮","⠯","⡨","⡩","⡪","⡫","⡬","⡭","⡮","⡯","⠰","⠱","⠲","⠳","⠴","⠵","⠶","⠷","⡰","⡱","⡲","⡳","⡴","⡵","⡶","⡷","⠸","⠹","⠺","⠻","⠼","⠽","⠾","⠿","⡸","⡹","⡺","⡻","⡼","⡽","⡾","⡿","⢀","⢁","⢂","⢃","⢄","⢅","⢆","⢇","⣀","⣁","⣂","⣃","⣄","⣅","⣆","⣇","⢈","⢉","⢊","⢋","⢌","⢍","⢎","⢏","⣈","⣉","⣊","⣋","⣌","⣍","⣎","⣏","⢐","⢑","⢒","⢓","⢔","⢕","⢖","⢗","⣐","⣑","⣒","⣓","⣔","⣕","⣖","⣗","⢘","⢙","⢚","⢛","⢜","⢝","⢞","⢟","⣘","⣙","⣚","⣛","⣜","⣝","⣞","⣟","⢠","⢡","⢢","⢣","⢤","⢥","⢦","⢧","⣠","⣡","⣢","⣣","⣤","⣥","⣦","⣧","⢨","⢩","⢪","⢫","⢬","⢭","⢮","⢯","⣨","⣩","⣪","⣫","⣬","⣭","⣮","⣯","⢰","⢱","⢲","⢳","⢴","⢵","⢶","⢷","⣰","⣱","⣲","⣳","⣴","⣵","⣶","⣷","⢸","⢹","⢺","⢻","⢼","⢽","⢾","⢿","⣸","⣹","⣺","⣻","⣼","⣽","⣾","⣿"]},dotsCircle:{interval:80,frames:["⢎ ","⠎⠁","⠊⠑","⠈⠱"," ⡱","⢀⡰","⢄⡠","⢆⡀"]},sand:{interval:80,frames:["⠁","⠂","⠄","⡀","⡈","⡐","⡠","⣀","⣁","⣂","⣄","⣌","⣔","⣤","⣥","⣦","⣮","⣶","⣷","⣿","⡿","⠿","⢟","⠟","⡛","⠛","⠫","⢋","⠋","⠍","⡉","⠉","⠑","⠡","⢁"]},line:{interval:130,frames:["-","\\","|","/"]},line2:{interval:100,frames:["⠂","-","–","—","–","-"]},rollingLine:{interval:80,frames:["/  "," - "," \\ ","  |","  |"," \\ "," - ","/  "]},pipe:{interval:100,frames:["┤","┘","┴","└","├","┌","┬","┐"]},simpleDots:{interval:400,frames:[".  ",".. ","...","   "]},simpleDotsScrolling:{interval:200,frames:[".  ",".. ","..."," ..","  .","   "]},star:{interval:70,frames:["✶","✸","✹","✺","✹","✷"]},star2:{interval:80,frames:["+","x","*"]},flip:{interval:70,frames:["_","_","_","-","`","`","'","´","-","_","_","_"]},hamburger:{interval:100,frames:["☱","☲","☴"]},growVertical:{interval:120,frames:["▁","▃","▄","▅","▆","▇","▆","▅","▄","▃"]},growHorizontal:{interval:120,frames:["▏","▎","▍","▌","▋","▊","▉","▊","▋","▌","▍","▎"]},balloon:{interval:140,frames:[" ",".","o","O","@","*"," "]},balloon2:{interval:120,frames:[".","o","O","°","O","o","."]},noise:{interval:100,frames:["▓","▒","░"]},bounce:{interval:120,frames:["⠁","⠂","⠄","⠂"]},boxBounce:{interval:120,frames:["▖","▘","▝","▗"]},boxBounce2:{interval:100,frames:["▌","▀","▐","▄"]},triangle:{interval:50,frames:["◢","◣","◤","◥"]},binary:{interval:80,frames:["010010","001100","100101","111010","111101","010111","101011","111000","110011","110101"]},arc:{interval:100,frames:["◜","◠","◝","◞","◡","◟"]},circle:{interval:120,frames:["◡","⊙","◠"]},squareCorners:{interval:180,frames:["◰","◳","◲","◱"]},circleQuarters:{interval:120,frames:["◴","◷","◶","◵"]},circleHalves:{interval:50,frames:["◐","◓","◑","◒"]},squish:{interval:100,frames:["╫","╪"]},toggle:{interval:250,frames:["⊶","⊷"]},toggle2:{interval:80,frames:["▫","▪"]},toggle3:{interval:120,frames:["□","■"]},toggle4:{interval:100,frames:["■","□","▪","▫"]},toggle5:{interval:100,frames:["▮","▯"]},toggle6:{interval:300,frames:["ဝ","၀"]},toggle7:{interval:80,frames:["⦾","⦿"]},toggle8:{interval:100,frames:["◍","◌"]},toggle9:{interval:100,frames:["◉","◎"]},toggle10:{interval:100,frames:["㊂","㊀","㊁"]},toggle11:{interval:50,frames:["⧇","⧆"]},toggle12:{interval:120,frames:["☗","☖"]},toggle13:{interval:80,frames:["=","*","-"]},arrow:{interval:100,frames:["←","↖","↑","↗","→","↘","↓","↙"]},arrow2:{interval:80,frames:["⬆️ ","↗️ ","➡️ ","↘️ ","⬇️ ","↙️ ","⬅️ ","↖️ "]},arrow3:{interval:120,frames:["▹▹▹▹▹","▸▹▹▹▹","▹▸▹▹▹","▹▹▸▹▹","▹▹▹▸▹","▹▹▹▹▸"]},bouncingBar:{interval:80,frames:["[    ]","[=   ]","[==  ]","[=== ]","[====]","[ ===]","[  ==]","[   =]","[    ]","[   =]","[  ==]","[ ===]","[====]","[=== ]","[==  ]","[=   ]"]},bouncingBall:{interval:80,frames:["( ●    )","(  ●   )","(   ●  )","(    ● )","(     ●)","(    ● )","(   ●  )","(  ●   )","( ●    )","(●     )"]},smiley:{interval:200,frames:["😄 ","😝 "]},monkey:{interval:300,frames:["🙈 ","🙈 ","🙉 ","🙊 "]},hearts:{interval:100,frames:["💛 ","💙 ","💜 ","💚 ","💗 "]},clock:{interval:100,frames:["🕛 ","🕐 ","🕑 ","🕒 ","🕓 ","🕔 ","🕕 ","🕖 ","🕗 ","🕘 ","🕙 ","🕚 "]},earth:{interval:180,frames:["🌍 ","🌎 ","🌏 "]},material:{interval:17,frames:["█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███████▁▁▁▁▁▁▁▁▁▁▁▁▁","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","██████████▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","█████████████▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁██████████████▁▁▁▁","▁▁▁██████████████▁▁▁","▁▁▁▁█████████████▁▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁▁▁████████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","██████▁▁▁▁▁▁▁▁▁▁▁▁▁█","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁▁█████████████▁▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁▁███████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁▁█████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁"]},moon:{interval:80,frames:["🌑 ","🌒 ","🌓 ","🌔 ","🌕 ","🌖 ","🌗 ","🌘 "]},runner:{interval:140,frames:["🚶 ","🏃 "]},pong:{interval:80,frames:["▐⠂       ▌","▐⠈       ▌","▐ ⠂      ▌","▐ ⠠      ▌","▐  ⡀     ▌","▐  ⠠     ▌","▐   ⠂    ▌","▐   ⠈    ▌","▐    ⠂   ▌","▐    ⠠   ▌","▐     ⡀  ▌","▐     ⠠  ▌","▐      ⠂ ▌","▐      ⠈ ▌","▐       ⠂▌","▐       ⠠▌","▐       ⡀▌","▐      ⠠ ▌","▐      ⠂ ▌","▐     ⠈  ▌","▐     ⠂  ▌","▐    ⠠   ▌","▐    ⡀   ▌","▐   ⠠    ▌","▐   ⠂    ▌","▐  ⠈     ▌","▐  ⠂     ▌","▐ ⠠      ▌","▐ ⡀      ▌","▐⠠       ▌"]},shark:{interval:120,frames:["▐|\\____________▌","▐_|\\___________▌","▐__|\\__________▌","▐___|\\_________▌","▐____|\\________▌","▐_____|\\_______▌","▐______|\\______▌","▐_______|\\_____▌","▐________|\\____▌","▐_________|\\___▌","▐__________|\\__▌","▐___________|\\_▌","▐____________|\\▌","▐____________/|▌","▐___________/|_▌","▐__________/|__▌","▐_________/|___▌","▐________/|____▌","▐_______/|_____▌","▐______/|______▌","▐_____/|_______▌","▐____/|________▌","▐___/|_________▌","▐__/|__________▌","▐_/|___________▌","▐/|____________▌"]},dqpb:{interval:100,frames:["d","q","p","b"]},weather:{interval:100,frames:["☀️ ","☀️ ","☀️ ","🌤 ","⛅️ ","🌥 ","☁️ ","🌧 ","🌨 ","🌧 ","🌨 ","🌧 ","🌨 ","⛈ ","🌨 ","🌧 ","🌨 ","☁️ ","🌥 ","⛅️ ","🌤 ","☀️ ","☀️ "]},christmas:{interval:400,frames:["🌲","🎄"]},grenade:{interval:80,frames:["،  ","′  "," ´ "," ‾ ","  ⸌","  ⸊","  |","  ⁎","  ⁕"," ෴ ","  ⁓","   ","   ","   "]},point:{interval:125,frames:["∙∙∙","●∙∙","∙●∙","∙∙●","∙∙∙"]},layer:{interval:150,frames:["-","=","≡"]},betaWave:{interval:80,frames:["ρββββββ","βρβββββ","ββρββββ","βββρβββ","ββββρββ","βββββρβ","ββββββρ"]},fingerDance:{interval:160,frames:["🤘 ","🤟 ","🖖 ","✋ ","🤚 ","👆 "]},fistBump:{interval:80,frames:["🤜　　　　🤛 ","🤜　　　　🤛 ","🤜　　　　🤛 ","　🤜　　🤛　 ","　　🤜🤛　　 ","　🤜✨🤛　　 ","🤜　✨　🤛　 "]},soccerHeader:{interval:80,frames:[" 🧑⚽️       🧑 ","🧑  ⚽️      🧑 ","🧑   ⚽️     🧑 ","🧑    ⚽️    🧑 ","🧑     ⚽️   🧑 ","🧑      ⚽️  🧑 ","🧑       ⚽️🧑  ","🧑      ⚽️  🧑 ","🧑     ⚽️   🧑 ","🧑    ⚽️    🧑 ","🧑   ⚽️     🧑 ","🧑  ⚽️      🧑 "]},mindblown:{interval:160,frames:["😐 ","😐 ","😮 ","😮 ","😦 ","😦 ","😧 ","😧 ","🤯 ","💥 ","✨ ","　 ","　 ","　 "]},speaker:{interval:160,frames:["🔈 ","🔉 ","🔊 ","🔉 "]},orangePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 "]},bluePulse:{interval:100,frames:["🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},orangeBluePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 ","🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},timeTravel:{interval:100,frames:["🕛 ","🕚 ","🕙 ","🕘 ","🕗 ","🕖 ","🕕 ","🕔 ","🕓 ","🕒 ","🕑 ","🕐 "]},aesthetic:{interval:80,frames:["▰▱▱▱▱▱▱","▰▰▱▱▱▱▱","▰▰▰▱▱▱▱","▰▰▰▰▱▱▱","▰▰▰▰▰▱▱","▰▰▰▰▰▰▱","▰▰▰▰▰▰▰","▰▱▱▱▱▱▱"]},dwarfFortress:{interval:80,frames:[" ██████£££  ","☺██████£££  ","☺██████£££  ","☺▓█████£££  ","☺▓█████£££  ","☺▒█████£££  ","☺▒█████£££  ","☺░█████£££  ","☺░█████£££  ","☺ █████£££  "," ☺█████£££  "," ☺█████£££  "," ☺▓████£££  "," ☺▓████£££  "," ☺▒████£££  "," ☺▒████£££  "," ☺░████£££  "," ☺░████£££  "," ☺ ████£££  ","  ☺████£££  ","  ☺████£££  ","  ☺▓███£££  ","  ☺▓███£££  ","  ☺▒███£££  ","  ☺▒███£££  ","  ☺░███£££  ","  ☺░███£££  ","  ☺ ███£££  ","   ☺███£££  ","   ☺███£££  ","   ☺▓██£££  ","   ☺▓██£££  ","   ☺▒██£££  ","   ☺▒██£££  ","   ☺░██£££  ","   ☺░██£££  ","   ☺ ██£££  ","    ☺██£££  ","    ☺██£££  ","    ☺▓█£££  ","    ☺▓█£££  ","    ☺▒█£££  ","    ☺▒█£££  ","    ☺░█£££  ","    ☺░█£££  ","    ☺ █£££  ","     ☺█£££  ","     ☺█£££  ","     ☺▓£££  ","     ☺▓£££  ","     ☺▒£££  ","     ☺▒£££  ","     ☺░£££  ","     ☺░£££  ","     ☺ £££  ","      ☺£££  ","      ☺£££  ","      ☺▓££  ","      ☺▓££  ","      ☺▒££  ","      ☺▒££  ","      ☺░££  ","      ☺░££  ","      ☺ ££  ","       ☺££  ","       ☺££  ","       ☺▓£  ","       ☺▓£  ","       ☺▒£  ","       ☺▒£  ","       ☺░£  ","       ☺░£  ","       ☺ £  ","        ☺£  ","        ☺£  ","        ☺▓  ","        ☺▓  ","        ☺▒  ","        ☺▒  ","        ☺░  ","        ☺░  ","        ☺   ","        ☺  &","        ☺ ☼&","       ☺ ☼ &","       ☺☼  &","      ☺☼  & ","      ‼   & ","     ☺   &  ","    ‼    &  ","   ☺    &   ","  ‼     &   "," ☺     &    ","‼      &    ","      &     ","      &     ","     &   ░  ","     &   ▒  ","    &    ▓  ","    &    £  ","   &    ░£  ","   &    ▒£  ","  &     ▓£  ","  &     ££  "," &     ░££  "," &     ▒££  ","&      ▓££  ","&      £££  ","      ░£££  ","      ▒£££  ","      ▓£££  ","      █£££  ","     ░█£££  ","     ▒█£££  ","     ▓█£££  ","     ██£££  ","    ░██£££  ","    ▒██£££  ","    ▓██£££  ","    ███£££  ","   ░███£££  ","   ▒███£££  ","   ▓███£££  ","   ████£££  ","  ░████£££  ","  ▒████£££  ","  ▓████£££  ","  █████£££  "," ░█████£££  "," ▒█████£££  "," ▓█████£££  "," ██████£££  "," ██████£££  "]}};var $_=x8,cU=Object.keys(x8);var d1={};Y6(d1,{warning:()=>KG,success:()=>AG,info:()=>UG,error:()=>DG});import HG from"node:tty";var WG=HG?.WriteStream?.prototype?.hasColors?.()??!1,w=(_,$)=>{if(!WG)return(J)=>J;let X=`\x1B[${_}m`,Z=`\x1B[${$}m`;return(J)=>{let G=J+"",Y=G.indexOf(Z);if(Y===-1)return X+G+Z;let z=X,F=0,W=($===22?Z:"")+X;while(Y!==-1)z+=G.slice(F,Y)+W,F=Y+Z.length,Y=G.indexOf(Z,F);return z+=G.slice(F)+Z,z}},nU=w(0,0),oU=w(1,22),sU=w(2,22),rU=w(3,23),aU=w(4,24),tU=w(53,55),eU=w(7,27),_A=w(8,28),$A=w(9,29),XA=w(30,39),F3=w(31,39),H3=w(32,39),W3=w(33,39),U3=w(34,39),ZA=w(35,39),JA=w(36,39),GA=w(37,39),YA=w(90,39),zA=w(40,49),FA=w(41,49),HA=w(42,49),WA=w(43,49),UA=w(44,49),AA=w(45,49),KA=w(46,49),DA=w(47,49),OA=w(100,49),RA=w(91,39),VA=w(92,39),NA=w(93,39),MA=w(94,39),BA=w(95,39),IA=w(96,39),QA=w(97,39),EA=w(101,49),jA=w(102,49),TA=w(103,49),LA=w(104,49),PA=w(105,49),wA=w(106,49),xA=w(107,49);import A3 from"node:process";function X_(){let{env:_}=A3,{TERM:$,TERM_PROGRAM:X}=_;if(A3.platform!=="win32")return $!=="linux";return Boolean(_.WT_SESSION)||Boolean(_.TERMINUS_SUBLIME)||_.ConEmuTask==="{cmd::Cmder}"||X==="Terminus-Sublime"||X==="vscode"||$==="xterm-256color"||$==="alacritty"||$==="rxvt-unicode"||$==="rxvt-unicode-256color"||_.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var z6=X_(),UG=U3(z6?"ℹ":"i"),AG=H3(z6?"✔":"√"),KG=W3(z6?"⚠":"‼"),DG=F3(z6?"✖":"×");function q8({onlyFirst:_=!1}={}){return new RegExp("(?:\\u001B\\][\\s\\S]*?(?:\\u0007|\\u001B\\u005C|\\u009C))|[\\u001B\\u009B][[\\]()#;?]*(?:\\d{1,4}(?:[;:]\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]",_?void 0:"g")}var OG=q8();function Z_(_){if(typeof _!=="string")throw TypeError(`Expected a \`string\`, got \`${typeof _}\``);return _.replace(OG,"")}function K3(_){return _===161||_===164||_===167||_===168||_===170||_===173||_===174||_>=176&&_<=180||_>=182&&_<=186||_>=188&&_<=191||_===198||_===208||_===215||_===216||_>=222&&_<=225||_===230||_>=232&&_<=234||_===236||_===237||_===240||_===242||_===243||_>=247&&_<=250||_===252||_===254||_===257||_===273||_===275||_===283||_===294||_===295||_===299||_>=305&&_<=307||_===312||_>=319&&_<=322||_===324||_>=328&&_<=331||_===333||_===338||_===339||_===358||_===359||_===363||_===462||_===464||_===466||_===468||_===470||_===472||_===474||_===476||_===593||_===609||_===708||_===711||_>=713&&_<=715||_===717||_===720||_>=728&&_<=731||_===733||_===735||_>=768&&_<=879||_>=913&&_<=929||_>=931&&_<=937||_>=945&&_<=961||_>=963&&_<=969||_===1025||_>=1040&&_<=1103||_===1105||_===8208||_>=8211&&_<=8214||_===8216||_===8217||_===8220||_===8221||_>=8224&&_<=8226||_>=8228&&_<=8231||_===8240||_===8242||_===8243||_===8245||_===8251||_===8254||_===8308||_===8319||_>=8321&&_<=8324||_===8364||_===8451||_===8453||_===8457||_===8467||_===8470||_===8481||_===8482||_===8486||_===8491||_===8531||_===8532||_>=8539&&_<=8542||_>=8544&&_<=8555||_>=8560&&_<=8569||_===8585||_>=8592&&_<=8601||_===8632||_===8633||_===8658||_===8660||_===8679||_===8704||_===8706||_===8707||_===8711||_===8712||_===8715||_===8719||_===8721||_===8725||_===8730||_>=8733&&_<=8736||_===8739||_===8741||_>=8743&&_<=8748||_===8750||_>=8756&&_<=8759||_===8764||_===8765||_===8776||_===8780||_===8786||_===8800||_===8801||_>=8804&&_<=8807||_===8810||_===8811||_===8814||_===8815||_===8834||_===8835||_===8838||_===8839||_===8853||_===8857||_===8869||_===8895||_===8978||_>=9312&&_<=9449||_>=9451&&_<=9547||_>=9552&&_<=9587||_>=9600&&_<=9615||_>=9618&&_<=9621||_===9632||_===9633||_>=9635&&_<=9641||_===9650||_===9651||_===9654||_===9655||_===9660||_===9661||_===9664||_===9665||_>=9670&&_<=9672||_===9675||_>=9678&&_<=9681||_>=9698&&_<=9701||_===9711||_===9733||_===9734||_===9737||_===9742||_===9743||_===9756||_===9758||_===9792||_===9794||_===9824||_===9825||_>=9827&&_<=9829||_>=9831&&_<=9834||_===9836||_===9837||_===9839||_===9886||_===9887||_===9919||_>=9926&&_<=9933||_>=9935&&_<=9939||_>=9941&&_<=9953||_===9955||_===9960||_===9961||_>=9963&&_<=9969||_===9972||_>=9974&&_<=9977||_===9979||_===9980||_===9982||_===9983||_===10045||_>=10102&&_<=10111||_>=11094&&_<=11097||_>=12872&&_<=12879||_>=57344&&_<=63743||_>=65024&&_<=65039||_===65533||_>=127232&&_<=127242||_>=127248&&_<=127277||_>=127280&&_<=127337||_>=127344&&_<=127373||_===127375||_===127376||_>=127387&&_<=127404||_>=917760&&_<=917999||_>=983040&&_<=1048573||_>=1048576&&_<=1114109}function D3(_){return _===12288||_>=65281&&_<=65376||_>=65504&&_<=65510}function O3(_){return _>=4352&&_<=4447||_===8986||_===8987||_===9001||_===9002||_>=9193&&_<=9196||_===9200||_===9203||_===9725||_===9726||_===9748||_===9749||_>=9776&&_<=9783||_>=9800&&_<=9811||_===9855||_>=9866&&_<=9871||_===9875||_===9889||_===9898||_===9899||_===9917||_===9918||_===9924||_===9925||_===9934||_===9940||_===9962||_===9970||_===9971||_===9973||_===9978||_===9981||_===9989||_===9994||_===9995||_===10024||_===10060||_===10062||_>=10067&&_<=10069||_===10071||_>=10133&&_<=10135||_===10160||_===10175||_===11035||_===11036||_===11088||_===11093||_>=11904&&_<=11929||_>=11931&&_<=12019||_>=12032&&_<=12245||_>=12272&&_<=12287||_>=12289&&_<=12350||_>=12353&&_<=12438||_>=12441&&_<=12543||_>=12549&&_<=12591||_>=12593&&_<=12686||_>=12688&&_<=12773||_>=12783&&_<=12830||_>=12832&&_<=12871||_>=12880&&_<=42124||_>=42128&&_<=42182||_>=43360&&_<=43388||_>=44032&&_<=55203||_>=63744&&_<=64255||_>=65040&&_<=65049||_>=65072&&_<=65106||_>=65108&&_<=65126||_>=65128&&_<=65131||_>=94176&&_<=94180||_>=94192&&_<=94198||_>=94208&&_<=101589||_>=101631&&_<=101662||_>=101760&&_<=101874||_>=110576&&_<=110579||_>=110581&&_<=110587||_===110589||_===110590||_>=110592&&_<=110882||_===110898||_>=110928&&_<=110930||_===110933||_>=110948&&_<=110951||_>=110960&&_<=111355||_>=119552&&_<=119638||_>=119648&&_<=119670||_===126980||_===127183||_===127374||_>=127377&&_<=127386||_>=127488&&_<=127490||_>=127504&&_<=127547||_>=127552&&_<=127560||_===127568||_===127569||_>=127584&&_<=127589||_>=127744&&_<=127776||_>=127789&&_<=127797||_>=127799&&_<=127868||_>=127870&&_<=127891||_>=127904&&_<=127946||_>=127951&&_<=127955||_>=127968&&_<=127984||_===127988||_>=127992&&_<=128062||_===128064||_>=128066&&_<=128252||_>=128255&&_<=128317||_>=128331&&_<=128334||_>=128336&&_<=128359||_===128378||_===128405||_===128406||_===128420||_>=128507&&_<=128591||_>=128640&&_<=128709||_===128716||_>=128720&&_<=128722||_>=128725&&_<=128728||_>=128732&&_<=128735||_===128747||_===128748||_>=128756&&_<=128764||_>=128992&&_<=129003||_===129008||_>=129292&&_<=129338||_>=129340&&_<=129349||_>=129351&&_<=129535||_>=129648&&_<=129660||_>=129664&&_<=129674||_>=129678&&_<=129734||_===129736||_>=129741&&_<=129756||_>=129759&&_<=129770||_>=129775&&_<=129784||_>=131072&&_<=196605||_>=196608&&_<=262141}function RG(_){if(!Number.isSafeInteger(_))throw TypeError(`Expected a code point, got \`${typeof _}\`.`)}function C8(_,{ambiguousAsWide:$=!1}={}){if(RG(_),D3(_)||O3(_)||$&&K3(_))return 2;return 1}var VG=new Intl.Segmenter,NG=/^(?:\p{Default_Ignorable_Code_Point}|\p{Control}|\p{Mark}|\p{Surrogate})+$/v,MG=/^[\p{Default_Ignorable_Code_Point}\p{Control}\p{Format}\p{Mark}\p{Surrogate}]+/v,BG=/^\p{RGI_Emoji}$/v;function IG(_){return _.replace(MG,"")}function QG(_){return NG.test(_)}function EG(_,$){let X=0;if(_.length>1){for(let Z of _.slice(1))if(Z>="＀"&&Z<="￯")X+=C8(Z.codePointAt(0),$)}return X}function S8(_,$={}){if(typeof _!=="string"||_.length===0)return 0;let{ambiguousIsNarrow:X=!0,countAnsiEscapeCodes:Z=!1}=$,J=_;if(!Z)J=Z_(J);if(J.length===0)return 0;let G=0,Y={ambiguousAsWide:!X};for(let{segment:z}of VG.segment(J)){if(QG(z))continue;if(BG.test(z)){G+=2;continue}let F=IG(z).codePointAt(0);G+=C8(F,Y),G+=EG(z,Y)}return G}function k8({stream:_=process.stdout}={}){return Boolean(_&&_.isTTY&&process.env.TERM!=="dumb"&&!("CI"in process.env))}import t0 from"node:process";var jG=3;class R3{#_=0;start(){if(this.#_++,this.#_===1)this.#$()}stop(){if(this.#_<=0)throw Error("`stop` called more times than `start`");if(this.#_--,this.#_===0)this.#X()}#$(){if(t0.platform==="win32"||!t0.stdin.isTTY)return;t0.stdin.setRawMode(!0),t0.stdin.on("data",this.#Z),t0.stdin.resume()}#X(){if(!t0.stdin.isTTY)return;t0.stdin.off("data",this.#Z),t0.stdin.pause(),t0.stdin.setRawMode(!1)}#Z(_){if(_[0]===jG)t0.emit("SIGINT")}}var TG=new R3,v8=TG;class V3{#_=0;#$=!1;#X=0;#Z=-1;#J=0;#G=0;#Y;#z;#F;#W;#A;#K;#U;#D;#O;#H;#R;color;constructor(_){if(typeof _==="string")_={text:_};if(this.#Y={color:"cyan",stream:F6.stderr,discardStdin:!0,hideCursor:!0,..._},this.color=this.#Y.color,this.spinner=this.#Y.spinner,this.#A=this.#Y.interval,this.#F=this.#Y.stream,this.#K=typeof this.#Y.isEnabled==="boolean"?this.#Y.isEnabled:k8({stream:this.#F}),this.#U=typeof this.#Y.isSilent==="boolean"?this.#Y.isSilent:!1,this.text=this.#Y.text,this.prefixText=this.#Y.prefixText,this.suffixText=this.#Y.suffixText,this.indent=this.#Y.indent,F6.env.NODE_ENV==="test")this._stream=this.#F,this._isEnabled=this.#K,Object.defineProperty(this,"_linesToClear",{get(){return this.#_},set($){this.#_=$}}),Object.defineProperty(this,"_frameIndex",{get(){return this.#Z}}),Object.defineProperty(this,"_lineCount",{get(){return this.#X}})}get indent(){return this.#D}set indent(_=0){if(!(_>=0&&Number.isInteger(_)))throw Error("The `indent` option must be an integer from 0 and up");this.#D=_,this.#I()}get interval(){return this.#A??this.#z.interval??100}get spinner(){return this.#z}set spinner(_){if(this.#Z=-1,this.#A=void 0,typeof _==="object"){if(!Array.isArray(_.frames)||_.frames.length===0||_.frames.some(($)=>typeof $!=="string"))throw Error("The given spinner must have a non-empty `frames` array of strings");if(_.interval!==void 0&&!(Number.isInteger(_.interval)&&_.interval>0))throw Error("`spinner.interval` must be a positive integer if provided");this.#z=_}else if(!X_())this.#z=$_.line;else if(_===void 0)this.#z=$_.dots;else if(_!=="default"&&$_[_])this.#z=$_[_];else throw Error(`There is no built-in spinner named '${_}'. See https://github.com/sindresorhus/cli-spinners/blob/main/spinners.json for a full list.`)}get text(){return this.#O}set text(_=""){this.#O=_,this.#I()}get prefixText(){return this.#H}set prefixText(_=""){this.#H=_,this.#I()}get suffixText(){return this.#R}set suffixText(_=""){this.#R=_,this.#I()}get isSpinning(){return this.#W!==void 0}#V(_,$,X=!1){let Z=typeof _==="function"?_():_;if(typeof Z==="string"&&Z!=="")return X?$+Z:Z+$;return""}#M(_=this.#H,$=" "){return this.#V(_,$,!1)}#B(_=this.#R,$=" "){return this.#V(_,$,!0)}#N(_,$){let X=0;for(let Z of Z_(_).split(`
`))X+=Math.max(1,Math.ceil(S8(Z)/$));return X}#I(){let _=this.#F.columns??80,$=typeof this.#H==="function"?"":this.#H,X=typeof this.#R==="function"?"":this.#R,Z=typeof $==="string"&&$!==""?$+" ":"",J=typeof X==="string"&&X!==""?" "+X:"",G="-",Y=" ".repeat(this.#D)+Z+"-"+(typeof this.#O==="string"?" "+this.#O:"")+J;this.#X=this.#N(Y,_)}get isEnabled(){return this.#K&&!this.#U}set isEnabled(_){if(typeof _!=="boolean")throw TypeError("The `isEnabled` option must be a boolean");this.#K=_}get isSilent(){return this.#U}set isSilent(_){if(typeof _!=="boolean")throw TypeError("The `isSilent` option must be a boolean");this.#U=_}frame(){let _=Date.now();if(this.#Z===-1||_-this.#J>=this.interval)this.#Z=++this.#Z%this.#z.frames.length,this.#J=_;let{frames:$}=this.#z,X=$[this.#Z];if(this.color)X=M[this.color](X);let Z=this.#M(this.#H," "),J=typeof this.text==="string"?" "+this.text:"",G=this.#B(this.#R," ");return Z+X+J+G}clear(){if(!this.#K||!this.#F.isTTY)return this;this.#F.cursorTo(0);for(let _=0;_<this.#_;_++){if(_>0)this.#F.moveCursor(0,-1);this.#F.clearLine(1)}if(this.#D||this.#G!==this.#D)this.#F.cursorTo(this.#D);return this.#G=this.#D,this.#_=0,this}render(){if(!this.#K||this.#U)return this;this.clear();let _=this.frame(),$=this.#F.columns??80,X=this.#N(_,$),Z=this.#F.rows;if(Z&&Z>1&&X>Z){let J=_.split(`
`),G=Z-1;_=[...J.slice(0,G),"... (content truncated to fit terminal)"].join(`
`)}return this.#F.write(_),this.#_=this.#N(_,$),this}start(_){if(_)this.text=_;if(this.#U)return this;if(!this.#K){let $=" ".repeat(this.#D)+this.#M(this.#H," ")+(this.text?`- ${this.text}`:"")+this.#B(this.#R," ");if($.trim()!=="")this.#F.write($+`
`);return this}if(this.isSpinning)return this;if(this.#Y.hideCursor)w8.hide(this.#F);if(this.#Y.discardStdin&&F6.stdin.isTTY)this.#$=!0,v8.start();return this.render(),this.#W=setInterval(this.render.bind(this),this.interval),this}stop(){if(clearInterval(this.#W),this.#W=void 0,this.#Z=0,this.#K){if(this.clear(),this.#Y.hideCursor)w8.show(this.#F)}if(this.#Y.discardStdin&&F6.stdin.isTTY&&this.#$)v8.stop(),this.#$=!1;return this}succeed(_){return this.stopAndPersist({symbol:d1.success,text:_})}fail(_){return this.stopAndPersist({symbol:d1.error,text:_})}warn(_){return this.stopAndPersist({symbol:d1.warning,text:_})}info(_){return this.stopAndPersist({symbol:d1.info,text:_})}stopAndPersist(_={}){if(this.#U)return this;let $=_.prefixText??this.#H,X=this.#M($," "),Z=_.symbol??" ",J=_.text??this.text,Y=typeof J==="string"?(Z?" ":"")+J:"",z=_.suffixText??this.#R,F=this.#B(z," "),H=X+Z+Y+F+`
`;return this.stop(),this.#F.write(H),this}}function v0(_){return new V3(_)}var KZ=Q0(x3(),1);import I1 from"node:fs";import W1 from"node:path";var K=Symbol.for("drizzle:entityKind");function V(_,$){if(!_||typeof _!=="object")return!1;if(_ instanceof $)return!0;if(!Object.prototype.hasOwnProperty.call($,K))throw Error(`Class "${$.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let X=Object.getPrototypeOf(_).constructor;if(X)while(X){if(K in X&&X[K]===$[K])return!0;X=Object.getPrototypeOf(X)}return!1}class p{constructor(_,$){this.table=_,this.config=$,this.name=$.name,this.keyAsName=$.keyAsName,this.notNull=$.notNull,this.default=$.default,this.defaultFn=$.defaultFn,this.onUpdateFn=$.onUpdateFn,this.hasDefault=$.hasDefault,this.primary=$.primaryKey,this.isUnique=$.isUnique,this.uniqueName=$.uniqueName,this.uniqueType=$.uniqueType,this.dataType=$.dataType,this.columnType=$.columnType,this.generated=$.generated,this.generatedIdentity=$.generatedIdentity}static[K]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(_){return _}mapToDriverValue(_){return _}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class b8{static[K]="ColumnBuilder";config;constructor(_,$,X){this.config={name:_,keyAsName:_==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:$,columnType:X,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(_){return this.config.default=_,this.config.hasDefault=!0,this}$defaultFn(_){return this.config.defaultFn=_,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(_){return this.config.onUpdateFn=_,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(_){if(this.config.name!=="")return;this.config.name=_}}var T0=Symbol.for("drizzle:Name");function q3(_,...$){return _(...$)}function C3(_,$){return`${_[T0]}_${$.join("_")}_unique`}class G_ extends p{constructor(_,$){if(!$.uniqueName)$.uniqueName=C3(_,[$.name]);super(_,$);this.table=_}static[K]="PgColumn"}class iG extends G_{static[K]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(_){return this.indexConfig.opClass=_,this}}class nG extends G_{static[K]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}var S3=Symbol.for("drizzle:isPgEnum");function k3(_){return!!_&&typeof _==="function"&&S3 in _&&_[S3]===!0}class oG extends G_{static[K]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}class $0{static[K]="Subquery";constructor(_,$,X,Z=!1,J=[]){this._={brand:"Subquery",sql:_,selectedFields:$,alias:X,isWith:Z,usedTables:J}}}class Y_ extends $0{static[K]="WithSubquery"}var v3="0.44.7";var g8,p8,h3={startActiveSpan(_,$){if(!g8)return $();if(!p8)p8=g8.trace.getTracer("drizzle-orm",v3);return q3((X,Z)=>Z.startActiveSpan(_,(J)=>{try{return $(J)}catch(G){throw J.setStatus({code:X.SpanStatusCode.ERROR,message:G instanceof Error?G.message:"Unknown error"}),G}finally{J.end()}}),g8,p8)}};var o=Symbol.for("drizzle:ViewBaseConfig");var A6=Symbol.for("drizzle:Schema"),K6=Symbol.for("drizzle:Columns"),y3=Symbol.for("drizzle:ExtraConfigColumns"),m8=Symbol.for("drizzle:OriginalName"),u8=Symbol.for("drizzle:BaseName"),z_=Symbol.for("drizzle:IsAlias"),f3=Symbol.for("drizzle:ExtraConfigBuilder"),sG=Symbol.for("drizzle:IsDrizzleTable");class B{static[K]="Table";static Symbol={Name:T0,Schema:A6,OriginalName:m8,Columns:K6,ExtraConfigColumns:y3,BaseName:u8,IsAlias:z_,ExtraConfigBuilder:f3};[T0];[m8];[A6];[K6];[y3];[u8];[z_]=!1;[sG]=!0;[f3]=void 0;constructor(_,$,X){this[T0]=this[m8]=_,this[A6]=$,this[u8]=X}}function E1(_){return _[T0]}function c1(_){return`${_[A6]??"public"}.${_[T0]}`}function d8(_){return _!==null&&_!==void 0&&typeof _.getSQL==="function"}function rG(_){let $={sql:"",params:[]};for(let X of _)if($.sql+=X.sql,$.params.push(...X.params),X.typings?.length){if(!$.typings)$.typings=[];$.typings.push(...X.typings)}return $}class z0{static[K]="StringChunk";value;constructor(_){this.value=Array.isArray(_)?_:[_]}getSQL(){return new Q([this])}}class Q{constructor(_){this.queryChunks=_;for(let $ of _)if(V($,B)){let X=$[B.Symbol.Schema];this.usedTables.push(X===void 0?$[B.Symbol.Name]:X+"."+$[B.Symbol.Name])}}static[K]="SQL";decoder=g3;shouldInlineParams=!1;usedTables=[];append(_){return this.queryChunks.push(..._.queryChunks),this}toQuery(_){return h3.startActiveSpan("drizzle.buildSQL",($)=>{let X=this.buildQueryFromSourceParams(this.queryChunks,_);return $?.setAttributes({"drizzle.query.text":X.sql,"drizzle.query.params":JSON.stringify(X.params)}),X})}buildQueryFromSourceParams(_,$){let X=Object.assign({},$,{inlineParams:$.inlineParams||this.shouldInlineParams,paramStartIndex:$.paramStartIndex||{value:0}}),{casing:Z,escapeName:J,escapeParam:G,prepareTyping:Y,inlineParams:z,paramStartIndex:F}=X;return rG(_.map((H)=>{if(V(H,z0))return{sql:H.value.join(""),params:[]};if(V(H,D6))return{sql:J(H.value),params:[]};if(H===void 0)return{sql:"",params:[]};if(Array.isArray(H)){let W=[new z0("(")];for(let[A,D]of H.entries())if(W.push(D),A<H.length-1)W.push(new z0(", "));return W.push(new z0(")")),this.buildQueryFromSourceParams(W,X)}if(V(H,Q))return this.buildQueryFromSourceParams(H.queryChunks,{...X,inlineParams:z||H.shouldInlineParams});if(V(H,B)){let W=H[B.Symbol.Schema],A=H[B.Symbol.Name];return{sql:W===void 0||H[z_]?J(A):J(W)+"."+J(A),params:[]}}if(V(H,p)){let W=Z.getColumnCasing(H);if($.invokeSource==="indexes")return{sql:J(W),params:[]};let A=H.table[B.Symbol.Schema];return{sql:H.table[z_]||A===void 0?J(H.table[B.Symbol.Name])+"."+J(W):J(A)+"."+J(H.table[B.Symbol.Name])+"."+J(W),params:[]}}if(V(H,h0)){let W=H[o].schema,A=H[o].name;return{sql:W===void 0||H[o].isAlias?J(A):J(W)+"."+J(A),params:[]}}if(V(H,L0)){if(V(H.value,j1))return{sql:G(F.value++,H),params:[H],typings:["none"]};let W=H.value===null?null:H.encoder.mapToDriverValue(H.value);if(V(W,Q))return this.buildQueryFromSourceParams([W],X);if(z)return{sql:this.mapInlineParam(W,X),params:[]};let A=["none"];if(Y)A=[Y(H.encoder)];return{sql:G(F.value++,W),params:[W],typings:A}}if(V(H,j1))return{sql:G(F.value++,H),params:[H],typings:["none"]};if(V(H,Q.Aliased)&&H.fieldAlias!==void 0)return{sql:J(H.fieldAlias),params:[]};if(V(H,$0)){if(H._.isWith)return{sql:J(H._.alias),params:[]};return this.buildQueryFromSourceParams([new z0("("),H._.sql,new z0(") "),new D6(H._.alias)],X)}if(k3(H)){if(H.schema)return{sql:J(H.schema)+"."+J(H.enumName),params:[]};return{sql:J(H.enumName),params:[]}}if(d8(H)){if(H.shouldOmitSQLParens?.())return this.buildQueryFromSourceParams([H.getSQL()],X);return this.buildQueryFromSourceParams([new z0("("),H.getSQL(),new z0(")")],X)}if(z)return{sql:this.mapInlineParam(H,X),params:[]};return{sql:G(F.value++,H),params:[H],typings:["none"]}}))}mapInlineParam(_,{escapeString:$}){if(_===null)return"null";if(typeof _==="number"||typeof _==="boolean")return _.toString();if(typeof _==="string")return $(_);if(typeof _==="object"){let X=_.toString();if(X==="[object Object]")return $(JSON.stringify(_));return $(X)}throw Error("Unexpected param value: "+_)}getSQL(){return this}as(_){if(_===void 0)return this;return new Q.Aliased(this,_)}mapWith(_){return this.decoder=typeof _==="function"?{mapFromDriverValue:_}:_,this}inlineParams(){return this.shouldInlineParams=!0,this}if(_){return _?this:void 0}}class D6{constructor(_){this.value=_}static[K]="Name";brand;getSQL(){return new Q([this])}}function b3(_){return typeof _==="object"&&_!==null&&"mapToDriverValue"in _&&typeof _.mapToDriverValue==="function"}var g3={mapFromDriverValue:(_)=>_},p3={mapToDriverValue:(_)=>_},mK={...g3,...p3};class L0{constructor(_,$=p3){this.value=_,this.encoder=$}static[K]="Param";brand;getSQL(){return new Q([this])}}function U(_,...$){let X=[];if($.length>0||_.length>0&&_[0]!=="")X.push(new z0(_[0]));for(let[Z,J]of $.entries())X.push(J,new z0(_[Z+1]));return new Q(X)}((_)=>{function $(){return new Q([])}_.empty=$;function X(F){return new Q(F)}_.fromList=X;function Z(F){return new Q([new z0(F)])}_.raw=Z;function J(F,H){let W=[];for(let[A,D]of F.entries()){if(A>0&&H!==void 0)W.push(H);W.push(D)}return new Q(W)}_.join=J;function G(F){return new D6(F)}_.identifier=G;function Y(F){return new j1(F)}_.placeholder=Y;function z(F,H){return new L0(F,H)}_.param=z})(U||(U={}));((_)=>{class ${constructor(X,Z){this.sql=X,this.fieldAlias=Z}static[K]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new $(this.sql,this.fieldAlias)}}_.Aliased=$})(Q||(Q={}));class j1{constructor(_){this.name=_}static[K]="Placeholder";getSQL(){return new Q([this])}}function F_(_,$){return _.map((X)=>{if(V(X,j1)){if(!(X.name in $))throw Error(`No value for placeholder "${X.name}" was provided`);return $[X.name]}if(V(X,L0)&&V(X.value,j1)){if(!(X.value.name in $))throw Error(`No value for placeholder "${X.value.name}" was provided`);return X.encoder.mapToDriverValue($[X.value.name])}return X})}var aG=Symbol.for("drizzle:IsDrizzleView");class h0{static[K]="View";[o];[aG]=!0;constructor({name:_,schema:$,selectedFields:X,query:Z}){this[o]={name:_,originalName:_,schema:$,selectedFields:X,query:Z,isExisting:!Z,isAlias:!1}}getSQL(){return new Q([this])}}p.prototype.getSQL=function(){return new Q([this])};B.prototype.getSQL=function(){return new Q([this])};$0.prototype.getSQL=function(){return new Q([this])};class O2{constructor(_){this.table=_}static[K]="ColumnAliasProxyHandler";get(_,$){if($==="table")return this.table;return _[$]}}class H_{constructor(_,$){this.alias=_,this.replaceOriginalName=$}static[K]="TableAliasProxyHandler";get(_,$){if($===B.Symbol.IsAlias)return!0;if($===B.Symbol.Name)return this.alias;if(this.replaceOriginalName&&$===B.Symbol.OriginalName)return this.alias;if($===o)return{..._[o],name:this.alias,isAlias:!0};if($===B.Symbol.Columns){let Z=_[B.Symbol.Columns];if(!Z)return Z;let J={};return Object.keys(Z).map((G)=>{J[G]=new Proxy(Z[G],new O2(new Proxy(_,this)))}),J}let X=_[$];if(V(X,p))return new Proxy(X,new O2(new Proxy(_,this)));return X}}function O6(_,$){return new Proxy(_,new H_($,!1))}function e0(_,$){return new Proxy(_,new O2(new Proxy(_.table,new H_($,!1))))}function c8(_,$){return new Q.Aliased(W_(_.sql,$),_.fieldAlias)}function W_(_,$){return U.join(_.queryChunks.map((X)=>{if(V(X,p))return e0(X,$);if(V(X,Q))return W_(X,$);if(V(X,Q.Aliased))return c8(X,$);return X}))}class R2 extends Error{static[K]="DrizzleError";constructor({message:_,cause:$}){super(_);this.name="DrizzleError",this.cause=$}}class K1 extends Error{constructor(_,$,X){super(`Failed query: ${_}
params: ${$}`);if(this.query=_,this.params=$,this.cause=X,Error.captureStackTrace(this,K1),X)this.cause=X}}class l8 extends R2{static[K]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class m3{static[K]="ConsoleLogWriter";write(_){console.log(_)}}class i8{static[K]="DefaultLogger";writer;constructor(_){this.writer=_?.writer??new m3}logQuery(_,$){let X=$.map((J)=>{try{return JSON.stringify(J)}catch{return String(J)}}),Z=X.length?` -- params: [${X.join(", ")}]`:"";this.writer.write(`Query: ${_}${Z}`)}}class n8{static[K]="NoopLogger";logQuery(){}}class M0{static[K]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}then(_,$){return this.execute().then(_,$)}}function o8(_,$,X){let Z={},J=_.reduce((G,{path:Y,field:z},F)=>{let H;if(V(z,p))H=z;else if(V(z,Q))H=z.decoder;else H=z.sql.decoder;let W=G;for(let[A,D]of Y.entries())if(A<Y.length-1){if(!(D in W))W[D]={};W=W[D]}else{let O=$[F],R=W[D]=O===null?null:H.mapFromDriverValue(O);if(X&&V(z,p)&&Y.length===2){let N=Y[0];if(!(N in Z))Z[N]=R===null?E1(z.table):!1;else if(typeof Z[N]==="string"&&Z[N]!==E1(z.table))Z[N]=!1}}return G},{});if(X&&Object.keys(Z).length>0){for(let[G,Y]of Object.entries(Z))if(typeof Y==="string"&&!X[Y])J[G]=null}return J}function y0(_,$){return Object.entries(_).reduce((X,[Z,J])=>{if(typeof Z!=="string")return X;let G=$?[...$,Z]:[Z];if(V(J,p)||V(J,Q)||V(J,Q.Aliased))X.push({path:G,field:J});else if(V(J,B))X.push(...y0(J[B.Symbol.Columns],G));else X.push(...y0(J,G));return X},[])}function U_(_,$){let X=Object.keys(_),Z=Object.keys($);if(X.length!==Z.length)return!1;for(let[J,G]of X.entries())if(G!==Z[J])return!1;return!0}function R6(_,$){let X=Object.entries($).filter(([,Z])=>Z!==void 0).map(([Z,J])=>{if(V(J,Q)||V(J,p))return[Z,J];else return[Z,new L0(J,_[B.Symbol.Columns][Z])]});if(X.length===0)throw Error("No values to set");return Object.fromEntries(X)}function u3(_,$){for(let X of $)for(let Z of Object.getOwnPropertyNames(X.prototype)){if(Z==="constructor")continue;Object.defineProperty(_.prototype,Z,Object.getOwnPropertyDescriptor(X.prototype,Z)||Object.create(null))}}function d3(_){return _[B.Symbol.Columns]}function A_(_){return V(_,$0)?_._.alias:V(_,h0)?_[o].name:V(_,Q)?void 0:_[B.Symbol.IsAlias]?_[B.Symbol.Name]:_[B.Symbol.BaseName]}function _1(_,$){return{name:typeof _==="string"&&_.length>0?_:"",config:typeof _==="object"?_:$}}function c3(_){if(typeof _!=="object"||_===null)return!1;if(_.constructor.name!=="Object")return!1;if("logger"in _){let $=typeof _.logger;if($!=="boolean"&&($!=="object"||typeof _.logger.logQuery!=="function")&&$!=="undefined")return!1;return!0}if("schema"in _){let $=typeof _.schema;if($!=="object"&&$!=="undefined")return!1;return!0}if("casing"in _){let $=typeof _.casing;if($!=="string"&&$!=="undefined")return!1;return!0}if("mode"in _){if(_.mode!=="default"||_.mode!=="planetscale"||_.mode!==void 0)return!1;return!0}if("connection"in _){let $=typeof _.connection;if($!=="string"&&$!=="object"&&$!=="undefined")return!1;return!0}if("client"in _){let $=typeof _.client;if($!=="object"&&$!=="function"&&$!=="undefined")return!1;return!0}if(Object.keys(_).length===0)return!0;return!1}var s8=typeof TextDecoder>"u"?null:new TextDecoder;var l3=Symbol.for("drizzle:PgInlineForeignKeys"),i3=Symbol.for("drizzle:EnableRLS");class r8 extends B{static[K]="PgTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:l3,EnableRLS:i3});[l3]=[];[i3]=!1;[B.Symbol.ExtraConfigBuilder]=void 0;[B.Symbol.ExtraConfigColumns]={}}class a8{static[K]="PgPrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new n3(_,this.columns,this.name)}}class n3{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[K]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[r8.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function E0(_,$){if(b3($)&&!d8(_)&&!V(_,L0)&&!V(_,j1)&&!V(_,p)&&!V(_,B)&&!V(_,h0))return new L0(_,$);return _}var j=(_,$)=>{return U`${_} = ${E0($,_)}`},o3=(_,$)=>{return U`${_} <> ${E0($,_)}`};function A0(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new Q($);return new Q([new z0("("),U.join($,new z0(" and ")),new z0(")")])}function K_(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new Q($);return new Q([new z0("("),U.join($,new z0(" or ")),new z0(")")])}function s3(_){return U`not ${_}`}var r3=(_,$)=>{return U`${_} > ${E0($,_)}`},a3=(_,$)=>{return U`${_} >= ${E0($,_)}`},t3=(_,$)=>{return U`${_} < ${E0($,_)}`},e3=(_,$)=>{return U`${_} <= ${E0($,_)}`};function _7(_,$){if(Array.isArray($)){if($.length===0)return U`false`;return U`${_} in ${$.map((X)=>E0(X,_))}`}return U`${_} in ${E0($,_)}`}function $7(_,$){if(Array.isArray($)){if($.length===0)return U`true`;return U`${_} not in ${$.map((X)=>E0(X,_))}`}return U`${_} not in ${E0($,_)}`}function X7(_){return U`${_} is null`}function Z7(_){return U`${_} is not null`}function J7(_){return U`exists ${_}`}function G7(_){return U`not exists ${_}`}function Y7(_,$,X){return U`${_} between ${E0($,_)} and ${E0(X,_)}`}function z7(_,$,X){return U`${_} not between ${E0($,_)} and ${E0(X,_)}`}function $1(_,$){return U`${_} like ${$}`}function F7(_,$){return U`${_} not like ${$}`}function H7(_,$){return U`${_} ilike ${$}`}function W7(_,$){return U`${_} not ilike ${$}`}function U7(_){return U`${_} asc`}function f0(_){return U`${_} desc`}class t8{constructor(_,$,X){this.sourceTable=_,this.referencedTable=$,this.relationName=X,this.referencedTableName=$[B.Symbol.Name]}static[K]="Relation";referencedTableName;fieldName}class A7{constructor(_,$){this.table=_,this.config=$}static[K]="Relations"}class T1 extends t8{constructor(_,$,X,Z){super(_,$,X?.relationName);this.config=X,this.isNullable=Z}static[K]="One";withFieldName(_){let $=new T1(this.sourceTable,this.referencedTable,this.config,this.isNullable);return $.fieldName=_,$}}class D_ extends t8{constructor(_,$,X){super(_,$,X?.relationName);this.config=X}static[K]="Many";withFieldName(_){let $=new D_(this.sourceTable,this.referencedTable,this.config);return $.fieldName=_,$}}function K7(){return{and:A0,between:Y7,eq:j,exists:J7,gt:r3,gte:a3,ilike:H7,inArray:_7,isNull:X7,isNotNull:Z7,like:$1,lt:t3,lte:e3,ne:o3,not:s3,notBetween:z7,notExists:G7,notLike:F7,notIlike:W7,notInArray:$7,or:K_,sql:U}}function D7(){return{sql:U,asc:U7,desc:f0}}function O7(_,$){if(Object.keys(_).length===1&&"default"in _&&!V(_.default,B))_=_.default;let X={},Z={},J={};for(let[G,Y]of Object.entries(_))if(V(Y,B)){let z=c1(Y),F=Z[z];X[z]=G,J[G]={tsName:G,dbName:Y[B.Symbol.Name],schema:Y[B.Symbol.Schema],columns:Y[B.Symbol.Columns],relations:F?.relations??{},primaryKey:F?.primaryKey??[]};for(let W of Object.values(Y[B.Symbol.Columns]))if(W.primary)J[G].primaryKey.push(W);let H=Y[B.Symbol.ExtraConfigBuilder]?.(Y[B.Symbol.ExtraConfigColumns]);if(H){for(let W of Object.values(H))if(V(W,a8))J[G].primaryKey.push(...W.columns)}}else if(V(Y,A7)){let z=c1(Y.table),F=X[z],H=Y.config($(Y.table)),W;for(let[A,D]of Object.entries(H))if(F){let O=J[F];if(O.relations[A]=D,W)O.primaryKey.push(...W)}else{if(!(z in Z))Z[z]={relations:{},primaryKey:W};Z[z].relations[A]=D}}return{tables:J,tableNamesMap:X}}function tG(_){return function(X,Z){return new T1(_,X,Z,Z?.fields.reduce((J,G)=>J&&G.notNull,!0)??!1)}}function eG(_){return function(X,Z){return new D_(_,X,Z)}}function R7(_,$,X){if(V(X,T1)&&X.config)return{fields:X.config.fields,references:X.config.references};let Z=$[c1(X.referencedTable)];if(!Z)throw Error(`Table "${X.referencedTable[B.Symbol.Name]}" not found in schema`);let J=_[Z];if(!J)throw Error(`Table "${Z}" not found in schema`);let G=X.sourceTable,Y=$[c1(G)];if(!Y)throw Error(`Table "${G[B.Symbol.Name]}" not found in schema`);let z=[];for(let F of Object.values(J.relations))if(X.relationName&&X!==F&&F.relationName===X.relationName||!X.relationName&&F.referencedTable===X.sourceTable)z.push(F);if(z.length>1)throw X.relationName?Error(`There are multiple relations with name "${X.relationName}" in table "${Z}"`):Error(`There are multiple relations between "${Z}" and "${X.sourceTable[B.Symbol.Name]}". Please specify relation name`);if(z[0]&&V(z[0],T1)&&z[0].config)return{fields:z[0].config.references,references:z[0].config.fields};throw Error(`There is not enough information to infer relation "${Y}.${X.fieldName}"`)}function V7(_){return{one:tG(_),many:eG(_)}}function V6(_,$,X,Z,J=(G)=>G){let G={};for(let[Y,z]of Z.entries())if(z.isJson){let F=$.relations[z.tsKey],H=X[Y],W=typeof H==="string"?JSON.parse(H):H;G[z.tsKey]=V(F,T1)?W&&V6(_,_[z.relationTableTsKey],W,z.selection,J):W.map((A)=>V6(_,_[z.relationTableTsKey],A,z.selection,J))}else{let F=J(X[Y]),H=z.field,W;if(V(H,p))W=H;else if(V(H,Q))W=H.decoder;else W=H.sql.decoder;G[z.tsKey]=F===null?null:W.mapFromDriverValue(F)}return G}function c0(_){return U`count(${_||U.raw("*")})`.mapWith(Number)}import*as t4 from"node:path";class X0 extends Error{operation;cause;context;constructor(_,$,X,Z){super(_);this.operation=$;this.cause=X;this.context=Z;if(this.name="DatabaseError",Error.captureStackTrace)Error.captureStackTrace(this,X0)}toJSON(){return{name:this.name,message:this.message,operation:this.operation,context:this.context,cause:this.cause?.message,stack:this.stack}}}class N6 extends X0{field;value;constructor(_,$,X,Z){super(_,"validation",Z,{field:$,value:X});this.field=$;this.value=X;this.name="ValidationError"}}class O_ extends X0{connectionDetails;constructor(_,$,X){super(_,"connection",X,$);this.connectionDetails=$;this.name="ConnectionError"}}async function c(_,$,X){try{return await $()}catch(Z){if(Z instanceof X0)throw Z;throw new X0(`Database operation failed: ${_}`,_,Z,X)}}import*as Z8 from"node:fs";import*as o_ from"node:path";class L extends Error{code;rawCode;constructor(_,$,X,Z){if($!==void 0)_=`${$}: ${_}`;super(_,{cause:Z});this.code=$,this.rawCode=X,this.name="LibsqlError"}}function N7(_){let $=_Y.exec(_);if($===null)throw new L(`The URL '${_}' is not in a valid format`,"URL_INVALID");let X=$.groups,Z=X.scheme,J=X.authority!==void 0?$Y(X.authority):void 0,G=l1(X.path),Y=X.query!==void 0?ZY(X.query):void 0,z=X.fragment!==void 0?l1(X.fragment):void 0;return{scheme:Z,authority:J,path:G,query:Y,fragment:z}}var _Y=(()=>{return new RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su")})();function $Y(_){let $=XY.exec(_);if($===null)throw new L("The authority part of the URL is not in a valid format","URL_INVALID");let X=$.groups,Z=l1(X.host_br??X.host),J=X.port?parseInt(X.port,10):void 0,G=X.username!==void 0?{username:l1(X.username),password:X.password!==void 0?l1(X.password):void 0}:void 0;return{host:Z,port:J,userinfo:G}}var XY=(()=>{return new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su")})();function ZY(_){let $=_.split("&"),X=[];for(let Z of $){if(Z==="")continue;let J,G,Y=Z.indexOf("=");if(Y<0)J=Z,G="";else J=Z.substring(0,Y),G=Z.substring(Y+1);X.push({key:l1(J.replaceAll("+"," ")),value:l1(G.replaceAll("+"," "))})}return{pairs:X}}function l1(_){try{return decodeURIComponent(_)}catch($){if($ instanceof URIError)throw new L(`URL component has invalid percent encoding: ${$}`,"URL_INVALID",void 0,$);throw $}}function R_(_,$,X){if($===void 0)throw new L(`URL with scheme ${JSON.stringify(_+":")} requires authority (the "//" part)`,"URL_INVALID");let Z=`${_}:`,J=JY($.host),G=GY($.port),z=`//${YY($.userinfo)}${J}${G}`,F=X.split("/").map(encodeURIComponent).join("/");if(F!==""&&!F.startsWith("/"))F="/"+F;return new URL(`${Z}${z}${F}`)}function JY(_){return _.includes(":")?`[${encodeURI(_)}]`:encodeURI(_)}function GY(_){return _!==void 0?`:${_}`:""}function YY(_){if(_===void 0)return"";let $=encodeURIComponent(_.username),X=_.password!==void 0?`:${encodeURIComponent(_.password)}`:"";return`${$}${X}@`}var N2=typeof Buffer==="function",M7=typeof TextDecoder==="function"?new TextDecoder:void 0,B7=typeof TextEncoder==="function"?new TextEncoder:void 0;var V_=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),M6=((_)=>{let $={};return _.forEach((X,Z)=>$[X]=Z),$})(V_),zY=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,K0=String.fromCharCode.bind(String),I7=typeof Uint8Array.from==="function"?Uint8Array.from.bind(Uint8Array):(_)=>new Uint8Array(Array.prototype.slice.call(_,0)),j7=(_)=>_.replace(/=/g,"").replace(/[+\/]/g,($)=>$=="+"?"-":"_"),T7=(_)=>_.replace(/[^A-Za-z0-9\+\/]/g,""),L7=(_)=>{let $,X,Z,J,G="",Y=_.length%3;for(let z=0;z<_.length;){if((X=_.charCodeAt(z++))>255||(Z=_.charCodeAt(z++))>255||(J=_.charCodeAt(z++))>255)throw TypeError("invalid character found");$=X<<16|Z<<8|J,G+=V_[$>>18&63]+V_[$>>12&63]+V_[$>>6&63]+V_[$&63]}return Y?G.slice(0,Y-3)+"===".substring(Y):G},$4=typeof btoa==="function"?(_)=>btoa(_):N2?(_)=>Buffer.from(_,"binary").toString("base64"):L7,e8=N2?(_)=>Buffer.from(_).toString("base64"):(_)=>{let X=[];for(let Z=0,J=_.length;Z<J;Z+=4096)X.push(K0.apply(null,_.subarray(Z,Z+4096)));return $4(X.join(""))},B6=(_,$=!1)=>$?j7(e8(_)):e8(_),FY=(_)=>{if(_.length<2){var $=_.charCodeAt(0);return $<128?_:$<2048?K0(192|$>>>6)+K0(128|$&63):K0(224|$>>>12&15)+K0(128|$>>>6&63)+K0(128|$&63)}else{var $=65536+(_.charCodeAt(0)-55296)*1024+(_.charCodeAt(1)-56320);return K0(240|$>>>18&7)+K0(128|$>>>12&63)+K0(128|$>>>6&63)+K0(128|$&63)}},HY=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,P7=(_)=>_.replace(HY,FY),Q7=N2?(_)=>Buffer.from(_,"utf8").toString("base64"):B7?(_)=>e8(B7.encode(_)):(_)=>$4(P7(_)),V2=(_,$=!1)=>$?j7(Q7(_)):Q7(_),E7=(_)=>V2(_,!0),WY=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,UY=(_)=>{switch(_.length){case 4:var $=(7&_.charCodeAt(0))<<18|(63&_.charCodeAt(1))<<12|(63&_.charCodeAt(2))<<6|63&_.charCodeAt(3),X=$-65536;return K0((X>>>10)+55296)+K0((X&1023)+56320);case 3:return K0((15&_.charCodeAt(0))<<12|(63&_.charCodeAt(1))<<6|63&_.charCodeAt(2));default:return K0((31&_.charCodeAt(0))<<6|63&_.charCodeAt(1))}},w7=(_)=>_.replace(WY,UY),x7=(_)=>{if(_=_.replace(/\s+/g,""),!zY.test(_))throw TypeError("malformed base64.");_+="==".slice(2-(_.length&3));let $,X,Z,J=[];for(let G=0;G<_.length;)if($=M6[_.charAt(G++)]<<18|M6[_.charAt(G++)]<<12|(X=M6[_.charAt(G++)])<<6|(Z=M6[_.charAt(G++)]),X===64)J.push(K0($>>16&255));else if(Z===64)J.push(K0($>>16&255,$>>8&255));else J.push(K0($>>16&255,$>>8&255,$&255));return J.join("")},X4=typeof atob==="function"?(_)=>atob(T7(_)):N2?(_)=>Buffer.from(_,"base64").toString("binary"):x7,q7=N2?(_)=>I7(Buffer.from(_,"base64")):(_)=>I7(X4(_).split("").map(($)=>$.charCodeAt(0))),C7=(_)=>q7(S7(_)),AY=N2?(_)=>Buffer.from(_,"base64").toString("utf8"):M7?(_)=>M7.decode(q7(_)):(_)=>w7(X4(_)),S7=(_)=>T7(_.replace(/[-_]/g,($)=>$=="-"?"+":"/")),_4=(_)=>AY(S7(_)),KY=(_)=>{if(typeof _!=="string")return!1;let $=_.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test($)||!/[^\s0-9a-zA-Z\-_]/.test($)},k7=(_)=>{return{value:_,enumerable:!1,writable:!0,configurable:!0}},v7=function(){let _=($,X)=>Object.defineProperty(String.prototype,$,k7(X));_("fromBase64",function(){return _4(this)}),_("toBase64",function($){return V2(this,$)}),_("toBase64URI",function(){return V2(this,!0)}),_("toBase64URL",function(){return V2(this,!0)}),_("toUint8Array",function(){return C7(this)})},h7=function(){let _=($,X)=>Object.defineProperty(Uint8Array.prototype,$,k7(X));_("toBase64",function($){return B6(this,$)}),_("toBase64URI",function(){return B6(this,!0)}),_("toBase64URL",function(){return B6(this,!0)})},DY=()=>{v7(),h7()},M2={version:"3.7.8",VERSION:"3.7.8",atob:X4,atobPolyfill:x7,btoa:$4,btoaPolyfill:L7,fromBase64:_4,toBase64:V2,encode:V2,encodeURI:E7,encodeURL:E7,utob:P7,btou:w7,decode:_4,isValid:KY,fromUint8Array:B6,toUint8Array:C7,extendString:v7,extendUint8Array:h7,extendBuiltins:DY};var X1="https://github.com/libsql/libsql-client-ts#supported-urls";function L1(_){if(_==="write")return"BEGIN IMMEDIATE";else if(_==="read")return"BEGIN TRANSACTION READONLY";else if(_==="deferred")return"BEGIN DEFERRED";else throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class B2{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(_,$,X,Z,J){this.columns=_,this.columnTypes=$,this.rows=X,this.rowsAffected=Z,this.lastInsertRowid=J}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(OY),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}}function OY(_){return Array.prototype.map.call(_,RY)}function RY(_){if(typeof _==="bigint")return""+_;else if(_ instanceof ArrayBuffer)return M2.fromUint8Array(new Uint8Array(_));else return _}var y7=":memory:";function f7(_){return _.scheme==="file"&&(_.path===":memory:"||_.path.startsWith(":memory:?"))}function N_(_,$){if(typeof _!=="object")throw TypeError(`Expected client configuration as object, got ${typeof _}`);let{url:X,authToken:Z,tls:J,intMode:G,concurrency:Y}=_;Y=Math.max(0,Y||20),G??="number";let z=[];if(X===y7)X="file::memory:";let F=N7(X),H=F.scheme.toLowerCase(),W=H==="file"&&F.path===y7&&F.authority===void 0,A;if(W)A={cache:{values:["shared","private"],update:(N,I)=>z.push(`${N}=${I}`)}};else A={tls:{values:["0","1"],update:(N,I)=>J=I==="1"},authToken:{update:(N,I)=>Z=I}};for(let{key:N,value:I}of F.query?.pairs??[]){if(!Object.hasOwn(A,N))throw new L(`Unsupported URL query parameter ${JSON.stringify(N)}`,"URL_PARAM_NOT_SUPPORTED");let y=A[N];if(y.values!==void 0&&!y.values.includes(I))throw new L(`Unknown value for the "${N}" query argument: ${JSON.stringify(I)}. Supported values are: [${y.values.map((k)=>'"'+k+'"').join(", ")}]`,"URL_INVALID");if(y.update!==void 0)y?.update(N,I)}let D=z.length===0?"":`?${z.join("&")}`,O=F.path+D,R;if(H==="libsql")if(J===!1){if(F.authority?.port===void 0)throw new L('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");R=$?"http":"ws"}else R=$?"https":"wss";else R=H;if(R==="http"||R==="ws")J??=!1;else J??=!0;if(R!=="http"&&R!=="ws"&&R!=="https"&&R!=="wss"&&R!=="file")throw new L(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(F.scheme+":")}. For more information, please read ${X1}`,"URL_SCHEME_NOT_SUPPORTED");if(G!=="number"&&G!=="bigint"&&G!=="string")throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(G)}`);if(F.fragment!==void 0)throw new L(`URL fragments are not supported: ${JSON.stringify("#"+F.fragment)}`,"URL_INVALID");if(W)return{scheme:"file",tls:!1,path:O,intMode:G,concurrency:Y,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0};return{scheme:R,tls:J,authority:F.authority,path:O,authToken:Z,intMode:G,concurrency:Y,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch}}var M_=Q0(B9(),1);import{Buffer as Q9}from"node:buffer";function E9(_){if(_.scheme!=="file")throw new L(`URL scheme ${JSON.stringify(_.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${X1}`,"URL_SCHEME_NOT_SUPPORTED");let $=_.authority;if($!==void 0){let Y=$.host.toLowerCase();if(Y!==""&&Y!=="localhost")throw new L(`Invalid host in file URL: ${JSON.stringify($.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${X1}`,"URL_INVALID");if($.port!==void 0)throw new L("File URL cannot have a port","URL_INVALID");if($.userinfo!==void 0)throw new L("File URL cannot have username and password","URL_INVALID")}let X=f7(_);if(X&&_.syncUrl)throw new L(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${_.path}`,"URL_INVALID");let Z=_.path;if(X)Z=`${_.scheme}:${_.path}`;let J={authToken:_.authToken,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncPeriod:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline},G=new M_.default(Z,J);return F0(G,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",_.intMode),new j9(Z,J,G,_.intMode)}class j9{#_;#$;#X;#Z;closed;protocol;constructor(_,$,X,Z){this.#_=_,this.#$=$,this.#X=X,this.#Z=Z,this.closed=!1,this.protocol="file"}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#J(),F0(this.#G(),X,this.#Z)}async batch(_,$="deferred"){this.#J();let X=this.#G();try{F0(X,L1($),this.#Z);let Z=_.map((J)=>{if(!X.inTransaction)throw new L("The transaction has been rolled back","TRANSACTION_CLOSED");let G=Array.isArray(J)?{sql:J[0],args:J[1]||[]}:J;return F0(X,G,this.#Z)});return F0(X,"COMMIT",this.#Z),Z}finally{if(X.inTransaction)F0(X,"ROLLBACK",this.#Z)}}async migrate(_){this.#J();let $=this.#G();try{F0($,"PRAGMA foreign_keys=off",this.#Z),F0($,L1("deferred"),this.#Z);let X=_.map((Z)=>{if(!$.inTransaction)throw new L("The transaction has been rolled back","TRANSACTION_CLOSED");return F0($,Z,this.#Z)});return F0($,"COMMIT",this.#Z),X}finally{if($.inTransaction)F0($,"ROLLBACK",this.#Z);F0($,"PRAGMA foreign_keys=on",this.#Z)}}async transaction(_="write"){let $=this.#G();return F0($,L1(_),this.#Z),this.#X=null,new T9($,this.#Z)}async executeMultiple(_){this.#J();let $=this.#G();try{return L9($,_)}finally{if($.inTransaction)F0($,"ROLLBACK",this.#Z)}}async sync(){this.#J();let _=await this.#G().sync();return{frames_synced:_.frames_synced,frame_no:_.frame_no}}async reconnect(){try{if(!this.closed&&this.#X!==null)this.#X.close()}finally{this.#X=new M_.default(this.#_,this.#$),this.closed=!1}}close(){if(this.closed=!0,this.#X!==null)this.#X.close(),this.#X=null}#J(){if(this.closed)throw new L("The client is closed","CLIENT_CLOSED")}#G(){if(this.#X===null)this.#X=new M_.default(this.#_,this.#$);return this.#X}}class T9{#_;#$;constructor(_,$){this.#_=_,this.#$=$}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#X(),F0(this.#_,X,this.#$)}async batch(_){return _.map(($)=>{this.#X();let X=Array.isArray($)?{sql:$[0],args:$[1]||[]}:$;return F0(this.#_,X,this.#$)})}async executeMultiple(_){return this.#X(),L9(this.#_,_)}async rollback(){if(!this.#_.open)return;this.#X(),F0(this.#_,"ROLLBACK",this.#$)}async commit(){this.#X(),F0(this.#_,"COMMIT",this.#$)}close(){if(this.#_.inTransaction)F0(this.#_,"ROLLBACK",this.#$)}get closed(){return!this.#_.inTransaction}#X(){if(this.closed)throw new L("The transaction is closed","TRANSACTION_CLOSED")}}function F0(_,$,X){let Z,J;if(typeof $==="string")Z=$,J=[];else if(Z=$.sql,Array.isArray($.args))J=$.args.map((G)=>I9(G,X));else{J={};for(let G in $.args){let Y=G[0]==="@"||G[0]==="$"||G[0]===":"?G.substring(1):G;J[Y]=I9($.args[G],X)}}try{let G=_.prepare(Z);G.safeIntegers(!0);let Y=!0;try{G.raw(!0)}catch{Y=!1}if(Y){let z=Array.from(G.columns().map((D)=>D.name)),F=Array.from(G.columns().map((D)=>D.type??"")),H=G.all(J).map((D)=>{return Wz(D,z,X)}),W=0,A=void 0;return new B2(z,F,H,0,void 0)}else{let z=G.run(J),F=z.changes,H=BigInt(z.lastInsertRowid);return new B2([],[],[],F,H)}}catch(G){throw P9(G)}}function Wz(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:_.length});for(let J=0;J<_.length;++J){let G=Uz(_[J],X);Object.defineProperty(Z,J,{value:G});let Y=$[J];if(!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function Uz(_,$){if(typeof _==="bigint")if($==="number"){if(_<Az||_>Kz)throw RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(_)}else if($==="bigint")return _;else if($==="string")return""+_;else throw Error("Invalid value for IntMode");else if(_ instanceof Q9)return _.buffer;return _}var Az=-9007199254740991n,Kz=9007199254740991n;function I9(_,$){if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<Dz||_>Oz)throw RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")switch($){case"bigint":return _?1n:0n;case"string":return _?"1":"0";default:return _?1:0}else if(_ instanceof ArrayBuffer)return Q9.from(_);else if(_ instanceof Date)return _.valueOf();else if(_===void 0)throw TypeError("undefined cannot be passed as argument to the database");else return _}var Dz=-9223372036854775808n,Oz=9223372036854775807n;function L9(_,$){try{_.exec($)}catch(X){throw P9(X)}}function P9(_){if(_ instanceof M_.default.SqliteError)return new L(_.message,_.code,_.rawCode,_);return _}var kF=Q0(Q$(),1),vF=Q0(W4(),1),hF=Q0(A4(),1),q2=Q0(k6(),1),yF=Q0(x$(),1);class C2{constructor(){this.intMode="number"}intMode}class m extends Error{constructor(_){super(_);this.name="ClientError"}}class E extends m{constructor(_){super(_);this.name="ProtoError"}}class w_ extends m{code;proto;constructor(_,$){super(_);this.name="ResponseError",this.code=$.code,this.proto=$,this.stack=void 0}}class e extends m{constructor(_,$){if($!==void 0){super(`${_}: ${$}`);this.cause=$}else super(_);this.name="ClosedError"}}class x_ extends m{constructor(_){super(_);this.name="WebSocketUnsupportedError"}}class S2 extends m{constructor(_){super(_);this.name="WebSocketError"}}class t1 extends m{status;constructor(_,$){super(_);this.status=$,this.name="HttpServerError"}}class i0 extends m{constructor(_){super(_);this.name="ProtocolVersionError"}}class R0 extends m{constructor(_){super(_);this.name="InternalError"}}class Y1 extends m{constructor(_){super(_);this.name="MisuseError"}}function j0(_){if(typeof _==="string")return _;throw k2(_,"string")}function w0(_){if(_===null||_===void 0)return;else if(typeof _==="string")return _;throw k2(_,"string or null")}function N1(_){if(typeof _==="number")return _;throw k2(_,"number")}function S1(_){if(typeof _==="boolean")return _;throw k2(_,"boolean")}function q_(_){if(Array.isArray(_))return _;throw k2(_,"array")}function Z0(_){if(_!==null&&typeof _==="object"&&!Array.isArray(_))return _;throw k2(_,"object")}function n0(_,$){return q_(_).map((X)=>$(Z0(X)))}function k2(_,$){if(_===void 0)return new E(`Expected ${$}, but the property was missing`);let X=typeof _;if(_===null)X="null";else if(Array.isArray(_))X="array";return new E(`Expected ${$}, received ${X}`)}function e1(_,$){return $(Z0(_))}class q${#_;#$;constructor(_){this.#_=_,this.#$=!1}begin(){this.#_.push("{"),this.#$=!0}end(){this.#_.push("}"),this.#$=!1}#X(_){if(this.#$)this.#_.push('"'),this.#$=!1;else this.#_.push(',"');this.#_.push(_),this.#_.push('":')}string(_,$){this.#X(_),this.#_.push(JSON.stringify($))}stringRaw(_,$){this.#X(_),this.#_.push('"'),this.#_.push($),this.#_.push('"')}number(_,$){this.#X(_),this.#_.push(""+$)}boolean(_,$){this.#X(_),this.#_.push($?"true":"false")}object(_,$,X){this.#X(_),this.begin(),X(this,$),this.end()}arrayObjects(_,$,X){this.#X(_),this.#_.push("[");for(let Z=0;Z<$.length;++Z){if(Z!==0)this.#_.push(",");this.begin(),X(this,$[Z]),this.end()}this.#_.push("]")}}function C_(_,$){let X=[],Z=new q$(X);return Z.begin(),$(Z,_),Z.end(),X.join("")}var _2=0,S_=1,k_=2;var C$=5;class S${#_;#$;#X;constructor(_){this.#_=_,this.#$=new DataView(_.buffer,_.byteOffset,_.byteLength),this.#X=0}varint(){let _=0;for(let $=0;;$+=7){let X=this.#_[this.#X++];if(_|=(X&127)<<$,!(X&128))break}return _}varintBig(){let _=0n;for(let $=0n;;$+=7n){let X=this.#_[this.#X++];if(_|=BigInt(X&127)<<$,!(X&128))break}return _}bytes(_){let $=new Uint8Array(this.#_.buffer,this.#_.byteOffset+this.#X,_);return this.#X+=_,$}double(){let _=this.#$.getFloat64(this.#X,!0);return this.#X+=8,_}skipVarint(){for(;;)if(!(this.#_[this.#X++]&128))break}skip(_){this.#X+=_}eof(){return this.#X>=this.#_.byteLength}}class k${#_;#$;constructor(_){this.#_=_,this.#$=-1}setup(_){this.#$=_}#X(_){if(this.#$!==_)throw new E(`Expected wire type ${_}, got ${this.#$}`);this.#$=-1}bytes(){this.#X(k_);let _=this.#_.varint();return this.#_.bytes(_)}string(){return new TextDecoder().decode(this.bytes())}message(_){return k1(this.bytes(),_)}int32(){return this.#X(_2),this.#_.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#X(_2),this.#_.varintBig()}sint64(){let _=this.uint64();return _>>1n^-(_&1n)}double(){return this.#X(S_),this.#_.double()}maybeSkip(){if(this.#$<0)return;else if(this.#$===_2)this.#_.skipVarint();else if(this.#$===S_)this.#_.skip(8);else if(this.#$===k_){let _=this.#_.varint();this.#_.skip(_)}else if(this.#$===C$)this.#_.skip(4);else throw new E(`Unexpected wire type ${this.#$}`);this.#$=-1}}function k1(_,$){let X=new S$(_),Z=new k$(X),J=$.default();while(!X.eof()){let G=X.varint(),Y=G>>3,z=G&7;Z.setup(z);let F=$[Y];if(F!==void 0){let H=F(Z,J);if(H!==void 0)J=H}Z.maybeSkip()}return J}class M4{#_;#$;#X;#Z;constructor(){this.#_=new ArrayBuffer(256),this.#$=new Uint8Array(this.#_),this.#X=new DataView(this.#_),this.#Z=0}#J(_){if(this.#Z+_<=this.#_.byteLength)return;let $=this.#_.byteLength;while($<this.#Z+_)$*=2;let X=new ArrayBuffer($),Z=new Uint8Array(X),J=new DataView(X);Z.set(new Uint8Array(this.#_,0,this.#Z)),this.#_=X,this.#$=Z,this.#X=J}#G(_){this.#J(5),_=0|_;do{let $=_&127;_>>>=7,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#Y(_){this.#J(10),_=_&0xffffffffffffffffn;do{let $=Number(_&0x7fn);_>>=7n,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#z(_,$){this.#G(_<<3|$)}bytes(_,$){this.#z(_,k_),this.#G($.byteLength),this.#J($.byteLength),this.#$.set($,this.#Z),this.#Z+=$.byteLength}string(_,$){this.bytes(_,new TextEncoder().encode($))}message(_,$,X){let Z=new M4;X(Z,$),this.bytes(_,Z.data())}int32(_,$){this.#z(_,_2),this.#G($)}uint32(_,$){this.int32(_,$)}bool(_,$){this.int32(_,$?1:0)}sint64(_,$){this.#z(_,_2),this.#Y($<<1n^$>>63n)}double(_,$){this.#z(_,S_),this.#J(8),this.#X.setFloat64(this.#Z,$,!0),this.#Z+=8}data(){return new Uint8Array(this.#_,0,this.#Z)}}function v_(_,$){let X=new M4;return $(X,_),X.data()}class v1{#_;#$;constructor(){this.#_=new Set,this.#$=new Set}alloc(){for(let $ of this.#$){if(this.#$.delete($),this.#_.add($),!this.#_.has(this.#_.size-1))this.#$.add(this.#_.size-1);return $}let _=this.#_.size;return this.#_.add(_),_}free(_){if(!this.#_.delete(_))throw new R0("Freeing an id that is not allocated");if(this.#$.delete(this.#_.size),_<this.#_.size)this.#$.add(_)}}function b(_,$){throw new R0($)}function v2(_){if(_===null)return null;else if(typeof _==="string")return _;else if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<bF||_>gF)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")return _?1n:0n;else if(_ instanceof ArrayBuffer)return new Uint8Array(_);else if(_ instanceof Uint8Array)return _;else if(_ instanceof Date)return+_.valueOf();else if(typeof _==="object")return""+_.toString();else throw TypeError("Unsupported type of value")}var bF=-9223372036854775808n,gF=9223372036854775807n;function B4(_,$){if(_===null)return null;else if(typeof _==="number")return _;else if(typeof _==="string")return _;else if(typeof _==="bigint")if($==="number"){let X=Number(_);if(!Number.isSafeInteger(X))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return X}else if($==="bigint")return _;else if($==="string")return""+_;else throw new Y1("Invalid value for IntMode");else if(_ instanceof Uint8Array)return _.slice().buffer;else if(_===void 0)throw new E("Received unrecognized type of Value");else throw b(_,"Impossible type of Value")}function $2(_){return{affectedRowCount:_.affectedRowCount,lastInsertRowid:_.lastInsertRowid,columnNames:_.cols.map(($)=>$.name),columnDecltypes:_.cols.map(($)=>$.decltype)}}function y6(_,$){let X=$2(_),Z=_.rows.map((J)=>v$(X.columnNames,J,$));return{...X,rows:Z}}function f6(_,$){let X=$2(_),Z;if(_.rows.length>0)Z=v$(X.columnNames,_.rows[0],$);return{...X,row:Z}}function b6(_,$){let X=$2(_),Z;if(_.rows.length>0&&X.columnNames.length>0)Z=B4(_.rows[0][0],$);return{...X,value:Z}}function v$(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:$.length});for(let J=0;J<$.length;++J){let G=B4($[J],X);Object.defineProperty(Z,J,{value:G});let Y=_[J];if(Y!==void 0&&!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function M1(_){return new w_(_.message,_)}class X2{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}_getSqlId(_){if(this.#_!==_)throw new Y1("Attempted to use SQL text opened with other object");else if(this.#X!==void 0)throw new e("SQL text is closed",this.#X);return this.#$}close(){this._setClosed(new m("SQL text was manually closed"))}_setClosed(_){if(this.#X===void 0)this.#X=_,this.#_._closeSql(this.#$)}get closed(){return this.#X!==void 0}}function h_(_,$){if($ instanceof X2)return{sqlId:$._getSqlId(_)};else return{sql:""+$}}class h1{#_;#$;constructor(){this.#_=[],this.#$=[]}get length(){return this.#_.length+this.#$.length}push(_){this.#_.push(_)}shift(){if(this.#$.length===0&&this.#_.length>0)this.#$=this.#_.reverse(),this.#_=[];return this.#$.pop()}first(){return this.#$.length!==0?this.#$[this.#$.length-1]:this.#_[0]}}class y_{sql;_args;_namedArgs;constructor(_){this.sql=_,this._args=[],this._namedArgs=new Map}bindIndexes(_){this._args.length=0;for(let $ of _)this._args.push(v2($));return this}bindIndex(_,$){if(_!==(_|0)||_<=0)throw RangeError("Index of a positional argument must be positive integer");while(this._args.length<_)this._args.push(null);return this._args[_-1]=v2($),this}bindName(_,$){return this._namedArgs.set(_,v2($)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function g6(_,$,X){let Z,J=[],G=[];if($ instanceof y_){Z=$.sql,J=$._args;for(let[F,H]of $._namedArgs.entries())G.push({name:F,value:H})}else if(Array.isArray($))if(Z=$[0],Array.isArray($[1]))J=$[1].map((F)=>v2(F));else G=Object.entries($[1]).map(([F,H])=>{return{name:F,value:v2(H)}});else Z=$;let{sql:Y,sqlId:z}=h_(_,Z);return{sql:Y,sqlId:z,args:J,namedArgs:G,wantRows:X}}class p6{_stream;#_;_steps;#$;constructor(_,$){this._stream=_,this.#_=$,this._steps=[],this.#$=!1}step(){return new I4(this)}execute(){if(this.#$)throw new Y1("This batch has already been executed");this.#$=!0;let _={steps:this._steps.map(($)=>$.proto)};if(this.#_)return mF(this._stream,this._steps,_);else return pF(this._stream,this._steps,_)}}function pF(_,$,X){return _._batch(X).then((Z)=>{for(let J=0;J<$.length;++J){let G=Z.stepResults.get(J),Y=Z.stepErrors.get(J);$[J].callback(G,Y)}})}async function mF(_,$,X){let Z=await _._openCursor(X);try{let J=0,G=void 0,Y=[];for(;;){let z=await Z.next();if(z===void 0)break;if(z.type==="step_begin"){if(z.step<J||z.step>=$.length)throw new E("Server produced StepBeginEntry for unexpected step");else if(G!==void 0)throw new E("Server produced StepBeginEntry before terminating previous step");for(let F=J;F<z.step;++F)$[F].callback(void 0,void 0);J=z.step+1,G=z,Y=[]}else if(z.type==="step_end"){if(G===void 0)throw new E("Server produced StepEndEntry but no step is active");let F={cols:G.cols,rows:Y,affectedRowCount:z.affectedRowCount,lastInsertRowid:z.lastInsertRowid};$[G.step].callback(F,void 0),G=void 0,Y=[]}else if(z.type==="step_error"){if(G===void 0){if(z.step>=$.length)throw new E("Server produced StepErrorEntry for unexpected step");for(let F=J;F<z.step;++F)$[F].callback(void 0,void 0)}else{if(z.step!==G.step)throw new E("Server produced StepErrorEntry for unexpected step");G=void 0,Y=[]}$[z.step].callback(void 0,z.error),J=z.step+1}else if(z.type==="row"){if(G===void 0)throw new E("Server produced RowEntry but no step is active");Y.push(z.row)}else if(z.type==="error")throw M1(z.error);else if(z.type==="none")throw new E("Server produced unrecognized CursorEntry");else throw b(z,"Impossible CursorEntry")}if(G!==void 0)throw new E("Server closed Cursor before terminating active step");for(let z=J;z<$.length;++z)$[z].callback(void 0,void 0)}finally{Z.close()}}class I4{_batch;#_;_index;constructor(_){this._batch=_,this.#_=[],this._index=void 0}condition(_){return this.#_.push(_._proto),this}query(_){return this.#$(_,!0,y6)}queryRow(_){return this.#$(_,!0,f6)}queryValue(_){return this.#$(_,!0,b6)}run(_){return this.#$(_,!1,$2)}#$(_,$,X){if(this._index!==void 0)throw new Y1("This BatchStep has already been added to the batch");let Z=g6(this._batch._stream._sqlOwner(),_,$),J;if(this.#_.length===0)J=void 0;else if(this.#_.length===1)J=this.#_[0];else J={type:"and",conds:this.#_.slice()};let G={stmt:Z,condition:J};return new Promise((Y,z)=>{let F=(H,W)=>{if(H!==void 0&&W!==void 0)z(new E("Server returned both result and error"));else if(W!==void 0)z(M1(W));else if(H!==void 0)Y(X(H,this._batch._stream.intMode));else Y(void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:G,callback:F})})}}class s{_batch;_proto;constructor(_,$){this._batch=_,this._proto=$}static ok(_){return new s(_._batch,{type:"ok",step:h$(_)})}static error(_){return new s(_._batch,{type:"error",step:h$(_)})}static not(_){return new s(_._batch,{type:"not",cond:_._proto})}static and(_,$){for(let X of $)y$(_,X);return new s(_,{type:"and",conds:$.map((X)=>X._proto)})}static or(_,$){for(let X of $)y$(_,X);return new s(_,{type:"or",conds:$.map((X)=>X._proto)})}static isAutocommit(_){return _._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new s(_,{type:"is_autocommit"})}}function h$(_){if(_._index===void 0)throw new Y1("Cannot add a condition referencing a step that has not been added to the batch");return _._index}function y$(_,$){if($._batch!==_)throw new Y1("Cannot mix BatchCond objects for different Batch objects")}function f$(_){return{paramNames:_.params.map(($)=>$.name),columns:_.cols,isExplain:_.isExplain,isReadonly:_.isReadonly}}class h2{constructor(_){this.intMode=_}query(_){return this.#_(_,!0,y6)}queryRow(_){return this.#_(_,!0,f6)}queryValue(_){return this.#_(_,!0,b6)}run(_){return this.#_(_,!1,$2)}#_(_,$,X){let Z=g6(this._sqlOwner(),_,$);return this._execute(Z).then((J)=>X(J,this.intMode))}batch(_=!1){return new p6(this,_)}describe(_){let $=h_(this._sqlOwner(),_);return this._describe($).then(f$)}sequence(_){let $=h_(this._sqlOwner(),_);return this._sequence($)}intMode}class f_{}var uF=1000,dF=10;class Q4 extends f_{#_;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X){super();this.#_=_,this.#$=$,this.#X=X,this.#Z=new h1,this.#J=new h1,this.#G=void 0,this.#Y=!1}async next(){for(;;){if(this.#G!==void 0)throw new e("Cursor is closed",this.#G);while(!this.#Y&&this.#J.length<dF)this.#J.push(this.#z());let _=this.#Z.shift();if(this.#Y||_!==void 0)return _;await this.#J.shift().then(($)=>{if($===void 0)return;for(let X of $.entries)this.#Z.push(X);this.#Y||=$.done})}}#z(){return this.#$._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#X,maxCount:uF}).then((_)=>_,(_)=>{this._setClosed(_);return})}_setClosed(_){if(this.#G!==void 0)return;this.#G=_,this.#$._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#X}).catch(()=>{return}),this.#$._cursorClosed(this)}close(){this._setClosed(new m("Cursor was manually closed"))}get closed(){return this.#G!==void 0}}class b_ extends h2{#_;#$;#X;#Z;#J;#G;static open(_){let $=_._streamIdAlloc.alloc(),X=new b_(_,$),Z=()=>{return},J=(Y)=>X.#W(Y),G={type:"open_stream",streamId:$};return _._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}constructor(_,$){super(_.intMode);this.#_=_,this.#$=$,this.#X=new h1,this.#Z=void 0,this.#J=!1,this.#G=void 0}client(){return this.#_}_sqlOwner(){return this.#_}_execute(_){return this.#Y({type:"execute",streamId:this.#$,stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#Y({type:"batch",streamId:this.#$,batch:_}).then(($)=>{return $.result})}_describe(_){return this.#_._ensureVersion(2,"describe()"),this.#Y({type:"describe",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#_._ensureVersion(2,"sequence()"),this.#Y({type:"sequence",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#Y({type:"get_autocommit",streamId:this.#$}).then((_)=>{return _.isAutocommit})}#Y(_){return new Promise(($,X)=>{this.#z({type:"request",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return this.#_._ensureVersion(3,"cursor"),new Promise(($,X)=>{this.#z({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_sendCursorRequest(_,$){if(_!==this.#Z)throw new R0("Cursor not associated with the stream attempted to execute a request");return new Promise((X,Z)=>{if(this.#G!==void 0)Z(new e("Stream is closed",this.#G));else this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})})}_cursorClosed(_){if(_!==this.#Z)throw new R0("Cursor was closed, but it was not associated with the stream");this.#Z=void 0,this.#F()}#z(_){if(this.#G!==void 0)_.errorCallback(new e("Stream is closed",this.#G));else if(this.#J)_.errorCallback(new e("Stream is closing",void 0));else this.#X.push(_),this.#F()}#F(){for(;;){let _=this.#X.first();if(_===void 0&&this.#Z===void 0&&this.#J){this.#W(new m("Stream was gracefully closed"));break}else if(_?.type==="request"&&this.#Z===void 0){let{request:$,responseCallback:X,errorCallback:Z}=_;this.#X.shift(),this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}else if(_?.type==="cursor"&&this.#Z===void 0){let{batch:$,cursorCallback:X}=_;this.#X.shift();let Z=this.#_._cursorIdAlloc.alloc(),J=new Q4(this.#_,this,Z),G={type:"open_cursor",streamId:this.#$,cursorId:Z,batch:$},Y=()=>{return},z=(F)=>J._setClosed(F);this.#_._sendRequest(G,{responseCallback:Y,errorCallback:z}),this.#Z=J,X(J)}else break}}#W(_){if(this.#G!==void 0)return;if(this.#G=_,this.#Z!==void 0)this.#Z._setClosed(_);for(;;){let J=this.#X.shift();if(J!==void 0)J.errorCallback(_);else break}let $={type:"close_stream",streamId:this.#$},X=()=>this.#_._streamIdAlloc.free(this.#$),Z=()=>{return};this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}close(){this.#W(new m("Stream was manually closed"))}closeGracefully(){this.#J=!0,this.#F()}get closed(){return this.#G!==void 0||this.#J}}function g_(_,$){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId);_.arrayObjects("args",$.args,b$),_.arrayObjects("named_args",$.namedArgs,cF),_.boolean("want_rows",$.wantRows)}function cF(_,$){_.string("name",$.name),_.object("value",$.value,b$)}function y2(_,$){_.arrayObjects("steps",$.steps,lF)}function lF(_,$){if($.condition!==void 0)_.object("condition",$.condition,E4);_.object("stmt",$.stmt,g_)}function E4(_,$){if(_.stringRaw("type",$.type),$.type==="ok"||$.type==="error")_.number("step",$.step);else if($.type==="not")_.object("cond",$.cond,E4);else if($.type==="and"||$.type==="or")_.arrayObjects("conds",$.conds,E4);else if($.type==="is_autocommit");else throw b($,"Impossible type of BatchCond")}function b$(_,$){if($===null)_.stringRaw("type","null");else if(typeof $==="bigint")_.stringRaw("type","integer"),_.stringRaw("value",""+$);else if(typeof $==="number")_.stringRaw("type","float"),_.number("value",$);else if(typeof $==="string")_.stringRaw("type","text"),_.string("value",$);else if($ instanceof Uint8Array)_.stringRaw("type","blob"),_.stringRaw("base64",M2.fromUint8Array($));else if($===void 0);else throw b($,"Impossible type of Value")}function g$(_,$){if(_.stringRaw("type",$.type),$.type==="hello"){if($.jwt!==void 0)_.string("jwt",$.jwt)}else if($.type==="request")_.number("request_id",$.requestId),_.object("request",$.request,iF);else throw b($,"Impossible type of ClientMsg")}function iF(_,$){if(_.stringRaw("type",$.type),$.type==="open_stream")_.number("stream_id",$.streamId);else if($.type==="close_stream")_.number("stream_id",$.streamId);else if($.type==="execute")_.number("stream_id",$.streamId),_.object("stmt",$.stmt,g_);else if($.type==="batch")_.number("stream_id",$.streamId),_.object("batch",$.batch,y2);else if($.type==="open_cursor")_.number("stream_id",$.streamId),_.number("cursor_id",$.cursorId),_.object("batch",$.batch,y2);else if($.type==="close_cursor")_.number("cursor_id",$.cursorId);else if($.type==="fetch_cursor")_.number("cursor_id",$.cursorId),_.number("max_count",$.maxCount);else if($.type==="sequence"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit")_.number("stream_id",$.streamId);else throw b($,"Impossible type of Request")}function p_(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId);for(let X of $.args)_.message(3,X,m$);for(let X of $.namedArgs)_.message(4,X,nF);_.bool(5,$.wantRows)}function nF(_,$){_.string(1,$.name),_.message(2,$.value,m$)}function f2(_,$){for(let X of $.steps)_.message(1,X,oF)}function oF(_,$){if($.condition!==void 0)_.message(1,$.condition,j4);_.message(2,$.stmt,p_)}function j4(_,$){if($.type==="ok")_.uint32(1,$.step);else if($.type==="error")_.uint32(2,$.step);else if($.type==="not")_.message(3,$.cond,j4);else if($.type==="and")_.message(4,$.conds,p$);else if($.type==="or")_.message(5,$.conds,p$);else if($.type==="is_autocommit")_.message(6,void 0,u$);else throw b($,"Impossible type of BatchCond")}function p$(_,$){for(let X of $)_.message(1,X,j4)}function m$(_,$){if($===null)_.message(1,void 0,u$);else if(typeof $==="bigint")_.sint64(2,$);else if(typeof $==="number")_.double(3,$);else if(typeof $==="string")_.string(4,$);else if($ instanceof Uint8Array)_.bytes(5,$);else if($===void 0);else throw b($,"Impossible type of Value")}function u$(_,$){}function d$(_,$){if($.type==="hello")_.message(1,$,sF);else if($.type==="request")_.message(2,$,rF);else throw b($,"Impossible type of ClientMsg")}function sF(_,$){if($.jwt!==void 0)_.string(1,$.jwt)}function rF(_,$){_.int32(1,$.requestId);let X=$.request;if(X.type==="open_stream")_.message(2,X,aF);else if(X.type==="close_stream")_.message(3,X,tF);else if(X.type==="execute")_.message(4,X,eF);else if(X.type==="batch")_.message(5,X,_H);else if(X.type==="open_cursor")_.message(6,X,$H);else if(X.type==="close_cursor")_.message(7,X,XH);else if(X.type==="fetch_cursor")_.message(8,X,ZH);else if(X.type==="sequence")_.message(9,X,JH);else if(X.type==="describe")_.message(10,X,GH);else if(X.type==="store_sql")_.message(11,X,YH);else if(X.type==="close_sql")_.message(12,X,zH);else if(X.type==="get_autocommit")_.message(13,X,FH);else throw b(X,"Impossible type of Request")}function aF(_,$){_.int32(1,$.streamId)}function tF(_,$){_.int32(1,$.streamId)}function eF(_,$){_.int32(1,$.streamId),_.message(2,$.stmt,p_)}function _H(_,$){_.int32(1,$.streamId),_.message(2,$.batch,f2)}function $H(_,$){_.int32(1,$.streamId),_.int32(2,$.cursorId),_.message(3,$.batch,f2)}function XH(_,$){_.int32(1,$.cursorId)}function ZH(_,$){_.int32(1,$.cursorId),_.uint32(2,$.maxCount)}function JH(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function GH(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function YH(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function zH(_,$){_.int32(1,$.sqlId)}function FH(_,$){_.int32(1,$.streamId)}function y1(_){let $=j0(_.message),X=w0(_.code);return{message:$,code:X}}function m_(_){let $=n0(_.cols,c$),X=q_(_.rows).map((Y)=>n0(Y,l$)),Z=N1(_.affected_row_count),J=w0(_.last_insert_rowid),G=J!==void 0?BigInt(J):void 0;return{cols:$,rows:X,affectedRowCount:Z,lastInsertRowid:G}}function c$(_){let $=w0(_.name),X=w0(_.decltype);return{name:$,decltype:X}}function m6(_){let $=new Map;q_(_.step_results).forEach((Z,J)=>{if(Z!==null)$.set(J,m_(Z0(Z)))});let X=new Map;return q_(_.step_errors).forEach((Z,J)=>{if(Z!==null)X.set(J,y1(Z0(Z)))}),{stepResults:$,stepErrors:X}}function u6(_){let $=j0(_.type);if($==="step_begin"){let X=N1(_.step),Z=n0(_.cols,c$);return{type:"step_begin",step:X,cols:Z}}else if($==="step_end"){let X=N1(_.affected_row_count),Z=w0(_.last_insert_rowid),J=Z!==void 0?BigInt(Z):void 0;return{type:"step_end",affectedRowCount:X,lastInsertRowid:J}}else if($==="step_error"){let X=N1(_.step),Z=y1(Z0(_.error));return{type:"step_error",step:X,error:Z}}else if($==="row")return{type:"row",row:n0(_.row,l$)};else if($==="error")return{type:"error",error:y1(Z0(_.error))};else throw new E("Unexpected type of CursorEntry")}function d6(_){let $=n0(_.params,HH),X=n0(_.cols,WH),Z=S1(_.is_explain),J=S1(_.is_readonly);return{params:$,cols:X,isExplain:Z,isReadonly:J}}function HH(_){return{name:w0(_.name)}}function WH(_){let $=j0(_.name),X=w0(_.decltype);return{name:$,decltype:X}}function l$(_){let $=j0(_.type);if($==="null")return null;else if($==="integer"){let X=j0(_.value);return BigInt(X)}else if($==="float")return N1(_.value);else if($==="text")return j0(_.value);else if($==="blob")return M2.toUint8Array(j0(_.base64));else throw new E("Unexpected type of Value")}function i$(_){let $=j0(_.type);if($==="hello_ok")return{type:"hello_ok"};else if($==="hello_error")return{type:"hello_error",error:y1(Z0(_.error))};else if($==="response_ok"){let X=N1(_.request_id),Z=UH(Z0(_.response));return{type:"response_ok",requestId:X,response:Z}}else if($==="response_error"){let X=N1(_.request_id),Z=y1(Z0(_.error));return{type:"response_error",requestId:X,error:Z}}else throw new E("Unexpected type of ServerMsg")}function UH(_){let $=j0(_.type);if($==="open_stream")return{type:"open_stream"};else if($==="close_stream")return{type:"close_stream"};else if($==="execute")return{type:"execute",result:m_(Z0(_.result))};else if($==="batch")return{type:"batch",result:m6(Z0(_.result))};else if($==="open_cursor")return{type:"open_cursor"};else if($==="close_cursor")return{type:"close_cursor"};else if($==="fetch_cursor"){let X=n0(_.entries,u6),Z=S1(_.done);return{type:"fetch_cursor",entries:X,done:Z}}else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:d6(Z0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:S1(_.is_autocommit)};else throw new E("Unexpected type of Response")}var p0={default(){return{message:"",code:void 0}},1(_,$){$.message=_.string()},2(_,$){$.code=_.string()}},f1={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.cols.push(_.message(n$))},2(_,$){$.rows.push(_.message(o$))},3(_,$){$.affectedRowCount=Number(_.uint64())},4(_,$){$.lastInsertRowid=_.sint64()}},n$={default(){return{name:void 0,decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},o$={default(){return[]},1(_,$){$.push(_.message(MH))}},b2={default(){return{stepResults:new Map,stepErrors:new Map}},1(_,$){let[X,Z]=_.message(AH);$.stepResults.set(X,Z)},2(_,$){let[X,Z]=_.message(KH);$.stepErrors.set(X,Z)}},AH={default(){return[0,f1.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(f1)}},KH={default(){return[0,p0.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(p0)}},c6={default(){return{type:"none"}},1(_){return _.message(DH)},2(_){return _.message(OH)},3(_){return _.message(RH)},4(_){return{type:"row",row:_.message(o$)}},5(_){return{type:"error",error:_.message(p0)}}},DH={default(){return{type:"step_begin",step:0,cols:[]}},1(_,$){$.step=_.uint32()},2(_,$){$.cols.push(_.message(n$))}},OH={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.affectedRowCount=_.uint32()},2(_,$){$.lastInsertRowid=_.uint64()}},RH={default(){return{type:"step_error",step:0,error:p0.default()}},1(_,$){$.step=_.uint32()},2(_,$){$.error=_.message(p0)}},g2={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(_,$){$.params.push(_.message(VH))},2(_,$){$.cols.push(_.message(NH))},3(_,$){$.isExplain=_.bool()},4(_,$){$.isReadonly=_.bool()}},VH={default(){return{name:void 0}},1(_,$){$.name=_.string()}},NH={default(){return{name:"",decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},MH={default(){return},1(_){return null},2(_){return _.sint64()},3(_){return _.double()},4(_){return _.string()},5(_){return _.bytes()}};var s$={default(){return{type:"none"}},1(_){return{type:"hello_ok"}},2(_){return _.message(BH)},3(_){return _.message(QH)},4(_){return _.message(IH)}},BH={default(){return{type:"hello_error",error:p0.default()}},1(_,$){$.error=_.message(p0)}},IH={default(){return{type:"response_error",requestId:0,error:p0.default()}},1(_,$){$.requestId=_.int32()},2(_,$){$.error=_.message(p0)}},QH={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(_,$){$.requestId=_.int32()},2(_,$){$.response={type:"open_stream"}},3(_,$){$.response={type:"close_stream"}},4(_,$){$.response=_.message(EH)},5(_,$){$.response=_.message(jH)},6(_,$){$.response={type:"open_cursor"}},7(_,$){$.response={type:"close_cursor"}},8(_,$){$.response=_.message(TH)},9(_,$){$.response={type:"sequence"}},10(_,$){$.response=_.message(LH)},11(_,$){$.response={type:"store_sql"}},12(_,$){$.response={type:"close_sql"}},13(_,$){$.response=_.message(PH)}},EH={default(){return{type:"execute",result:f1.default()}},1(_,$){$.result=_.message(f1)}},jH={default(){return{type:"batch",result:b2.default()}},1(_,$){$.result=_.message(b2)}},TH={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(_,$){$.entries.push(_.message(c6))},2(_,$){$.done=_.bool()}},LH={default(){return{type:"describe",result:g2.default()}},1(_,$){$.result=_.message(g2)}},PH={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}};var r$=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),T4=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class l6 extends C2{#_;#$;#X;#Z;#J;#G;#Y;#z;#F;_streamIdAlloc;_cursorIdAlloc;#W;constructor(_,$){super();this.#_=_,this.#$=[],this.#X=!1,this.#Z=void 0,this.#J=!1,this.#G=void 0,this.#Y=!1,this.#z=new Map,this.#F=new v1,this._streamIdAlloc=new v1,this._cursorIdAlloc=new v1,this.#W=new v1,this.#_.binaryType="arraybuffer",this.#_.addEventListener("open",()=>this.#K()),this.#_.addEventListener("close",(X)=>this.#O(X)),this.#_.addEventListener("error",(X)=>this.#D(X)),this.#_.addEventListener("message",(X)=>this.#R(X)),this.#A({type:"hello",jwt:$})}#A(_){if(this.#Z!==void 0)throw new R0("Trying to send a message on a closed client");if(this.#X)this.#U(_);else{let $=()=>this.#U(_),X=()=>{return};this.#$.push({openCallback:$,errorCallback:X})}}#K(){let _=this.#_.protocol;if(_===void 0){this.#H(new m("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(_==="")this.#G={version:1,encoding:"json"};else if(this.#G=T4.get(_),this.#G===void 0){this.#H(new E(`Unrecognized WebSocket subprotocol: ${JSON.stringify(_)}`));return}for(let $ of this.#$)$.openCallback();this.#$.length=0,this.#X=!0}#U(_){let $=this.#G.encoding;if($==="json"){let X=C_(_,g$);this.#_.send(X)}else if($==="protobuf"){let X=v_(_,d$);this.#_.send(X)}else throw b($,"Impossible encoding")}getVersion(){return new Promise((_,$)=>{if(this.#Y=!0,this.#Z!==void 0)$(this.#Z);else if(!this.#X){let X=()=>_(this.#G.version);this.#$.push({openCallback:X,errorCallback:$})}else _(this.#G.version)})}_ensureVersion(_,$){if(this.#G===void 0||!this.#Y)throw new i0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this.#G.version<_)throw new i0(`${$} is supported on protocol version ${_} and higher, but the WebSocket server only supports version ${this.#G.version}`)}_sendRequest(_,$){if(this.#Z!==void 0){$.errorCallback(new e("Client is closed",this.#Z));return}let X=this.#F.alloc();this.#z.set(X,{...$,type:_.type}),this.#A({type:"request",requestId:X,request:_})}#D(_){let X=_.message??"WebSocket was closed due to an error";this.#H(new S2(X))}#O(_){let $=`WebSocket was closed with code ${_.code}`;if(_.reason)$+=`: ${_.reason}`;this.#H(new S2($))}#H(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of this.#$)$.errorCallback(_);this.#$.length=0;for(let[$,X]of this.#z.entries())X.errorCallback(_),this.#F.free($);this.#z.clear(),this.#_.close()}#R(_){if(this.#Z!==void 0)return;try{let $,X=this.#G.encoding;if(X==="json"){if(typeof _.data!=="string"){this.#_.close(3003,"Only text messages are accepted with JSON encoding"),this.#H(new E("Received non-text message from server with JSON encoding"));return}$=e1(JSON.parse(_.data),i$)}else if(X==="protobuf"){if(!(_.data instanceof ArrayBuffer)){this.#_.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#H(new E("Received non-binary message from server with Protobuf encoding"));return}$=k1(new Uint8Array(_.data),s$)}else throw b(X,"Impossible encoding");this.#V($)}catch($){this.#_.close(3007,"Could not handle message"),this.#H($)}}#V(_){if(_.type==="none")throw new E("Received an unrecognized ServerMsg");else if(_.type==="hello_ok"||_.type==="hello_error"){if(this.#J)throw new E("Received a duplicated hello response");if(this.#J=!0,_.type==="hello_error")throw M1(_.error);return}else if(!this.#J)throw new E("Received a non-hello message before a hello response");if(_.type==="response_ok"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new E("Received unexpected OK response");this.#F.free($);try{if(X.type!==_.response.type)throw console.dir({responseState:X,msg:_}),new E("Received unexpected type of response");X.responseCallback(_.response)}catch(Z){throw X.errorCallback(Z),Z}}else if(_.type==="response_error"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new E("Received unexpected error response");this.#F.free($),X.errorCallback(M1(_.error))}else throw b(_,"Impossible ServerMsg type")}openStream(){return b_.open(this)}storeSql(_){this._ensureVersion(2,"storeSql()");let $=this.#W.alloc(),X=new X2(this,$),Z=()=>{return},J=(Y)=>X._setClosed(Y),G={type:"store_sql",sqlId:$,sql:_};return this._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}_closeSql(_){if(this.#Z!==void 0)return;let $=()=>this.#W.free(_),X=(J)=>this.#H(J),Z={type:"close_sql",sqlId:_};this._sendRequest(Z,{responseCallback:$,errorCallback:X})}close(){this.#H(new m("Client was manually closed"))}get closed(){return this.#Z!==void 0}}var u_=Request,L4=Headers,P4=fetch;var Z2;if(typeof queueMicrotask<"u")Z2=queueMicrotask;else{let _=Promise.resolve();Z2=($)=>{_.then($)}}class w4{#_;#$;#X;constructor(_){this.#_=new Uint8Array(new ArrayBuffer(_)),this.#$=0,this.#X=0}get length(){return this.#X-this.#$}data(){return this.#_.slice(this.#$,this.#X)}push(_){this.#Z(_.byteLength),this.#_.set(_,this.#X),this.#X+=_.byteLength}#Z(_){if(this.#X+_<=this.#_.byteLength)return;let $=this.#X-this.#$;if($+_<=this.#_.byteLength&&2*this.#X>=this.#_.byteLength)this.#_.copyWithin(0,this.#$,this.#X);else{let X=this.#_.byteLength;do X*=2;while($+_>X);let Z=new Uint8Array(new ArrayBuffer(X));Z.set(this.#_.slice(this.#$,this.#X),0),this.#_=Z}this.#X=$,this.#$=0}shift(_){this.#$+=_}}function a$(_){let $=w0(_.baton),X=w0(_.base_url),Z=n0(_.results,wH);return{baton:$,baseUrl:X,results:Z}}function wH(_){let $=j0(_.type);if($==="ok")return{type:"ok",response:xH(Z0(_.response))};else if($==="error")return{type:"error",error:y1(Z0(_.error))};else throw new E("Unexpected type of StreamResult")}function xH(_){let $=j0(_.type);if($==="close")return{type:"close"};else if($==="execute")return{type:"execute",result:m_(Z0(_.result))};else if($==="batch")return{type:"batch",result:m6(Z0(_.result))};else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:d6(Z0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:S1(_.is_autocommit)};else throw new E("Unexpected type of StreamResponse")}function t$(_){let $=w0(_.baton),X=w0(_.base_url);return{baton:$,baseUrl:X}}var e$={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()},3(_,$){$.results.push(_.message(qH))}},qH={default(){return{type:"none"}},1(_){return{type:"ok",response:_.message(CH)}},2(_){return{type:"error",error:_.message(p0)}}},CH={default(){return{type:"none"}},1(_){return{type:"close"}},2(_){return _.message(SH)},3(_){return _.message(kH)},4(_){return{type:"sequence"}},5(_){return _.message(vH)},6(_){return{type:"store_sql"}},7(_){return{type:"close_sql"}},8(_){return _.message(hH)}},SH={default(){return{type:"execute",result:f1.default()}},1(_,$){$.result=_.message(f1)}},kH={default(){return{type:"batch",result:b2.default()}},1(_,$){$.result=_.message(b2)}},vH={default(){return{type:"describe",result:g2.default()}},1(_,$){$.result=_.message(g2)}},hH={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}},_X={default(){return{baton:void 0,baseUrl:void 0}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()}};class x4 extends f_{#_;#$;#X;#Z;#J;#G;constructor(_,$){super();this.#_=_,this.#$=$,this.#X=void 0,this.#Z=new w4(16384),this.#J=void 0,this.#G=!1}async open(_){if(_.body===null)throw new E("No response body for cursor request");this.#X=_.body.getReader();let $=await this.#Y(t$,_X);if($===void 0)throw new E("Empty response to cursor request");return $}next(){return this.#Y(u6,c6)}close(){this._setClosed(new m("Cursor was manually closed"))}_setClosed(_){if(this.#J!==void 0)return;if(this.#J=_,this.#_._cursorClosed(this),this.#X!==void 0)this.#X.cancel()}get closed(){return this.#J!==void 0}async#Y(_,$){for(;;){if(this.#G)return;else if(this.#J!==void 0)throw new e("Cursor is closed",this.#J);if(this.#$==="json"){let J=this.#z();if(J!==void 0){let G=new TextDecoder().decode(J),Y=JSON.parse(G);return e1(Y,_)}}else if(this.#$==="protobuf"){let J=this.#F();if(J!==void 0)return k1(J,$)}else throw b(this.#$,"Impossible encoding");if(this.#X===void 0)throw new R0("Attempted to read from HTTP cursor before it was opened");let{value:X,done:Z}=await this.#X.read();if(Z&&this.#Z.length===0)this.#G=!0;else if(Z)throw new E("Unexpected end of cursor stream");else this.#Z.push(X)}}#z(){let _=this.#Z.data(),$=10,X=_.indexOf(10);if(X<0)return;let Z=_.slice(0,X);return this.#Z.shift(X+1),Z}#F(){let _=this.#Z.data(),$=0,X=0;for(;;){if(X>=_.byteLength)return;let J=_[X];if($|=(J&127)<<7*X,X+=1,!(J&128))break}if(_.byteLength<X+$)return;let Z=_.slice(X,X+$);return this.#Z.shift(X+$),Z}}function $X(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.arrayObjects("requests",$.requests,yH)}function yH(_,$){if(_.stringRaw("type",$.type),$.type==="close");else if($.type==="execute")_.object("stmt",$.stmt,g_);else if($.type==="batch")_.object("batch",$.batch,y2);else if($.type==="sequence"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit");else throw b($,"Impossible type of StreamRequest")}function XX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.object("batch",$.batch,y2)}function ZX(_,$){if($.baton!==void 0)_.string(1,$.baton);for(let X of $.requests)_.message(2,X,fH)}function fH(_,$){if($.type==="close")_.message(1,$,bH);else if($.type==="execute")_.message(2,$,gH);else if($.type==="batch")_.message(3,$,pH);else if($.type==="sequence")_.message(4,$,mH);else if($.type==="describe")_.message(5,$,uH);else if($.type==="store_sql")_.message(6,$,dH);else if($.type==="close_sql")_.message(7,$,cH);else if($.type==="get_autocommit")_.message(8,$,lH);else throw b($,"Impossible type of StreamRequest")}function bH(_,$){}function gH(_,$){_.message(1,$.stmt,p_)}function pH(_,$){_.message(1,$.batch,f2)}function mH(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function uH(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function dH(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function cH(_,$){_.int32(1,$.sqlId)}function lH(_,$){}function JX(_,$){if($.baton!==void 0)_.string(1,$.baton);_.message(2,$.batch,f2)}class i6 extends h2{#_;#$;#X;#Z;#J;#G;#Y;#z;#F;#W;#A;#K;constructor(_,$,X,Z){super(_.intMode);this.#_=_,this.#$=$.toString(),this.#X=X,this.#Z=Z,this.#J=void 0,this.#G=new h1,this.#Y=!1,this.#F=!1,this.#W=!1,this.#A=void 0,this.#K=new v1}client(){return this.#_}_sqlOwner(){return this}storeSql(_){let $=this.#K.alloc();return this.#U({type:"store_sql",sqlId:$,sql:_}).then(()=>{return},(X)=>this._setClosed(X)),new X2(this,$)}_closeSql(_){if(this.#A!==void 0)return;this.#U({type:"close_sql",sqlId:_}).then(()=>this.#K.free(_),($)=>this._setClosed($))}_execute(_){return this.#U({type:"execute",stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#U({type:"batch",batch:_}).then(($)=>{return $.result})}_describe(_){return this.#U({type:"describe",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#U({type:"sequence",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#U({type:"get_autocommit"}).then((_)=>{return _.isAutocommit})}#U(_){return new Promise(($,X)=>{this.#D({type:"pipeline",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return new Promise(($,X)=>{this.#D({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_cursorClosed(_){if(_!==this.#z)throw new R0("Cursor was closed, but it was not associated with the stream");this.#z=void 0,Z2(()=>this.#O())}close(){this._setClosed(new m("Stream was manually closed"))}closeGracefully(){this.#F=!0,Z2(()=>this.#O())}get closed(){return this.#A!==void 0||this.#F}_setClosed(_){if(this.#A!==void 0)return;if(this.#A=_,this.#z!==void 0)this.#z._setClosed(_);this.#_._streamClosed(this);for(;;){let $=this.#G.shift();if($!==void 0)$.errorCallback(_);else break}if((this.#J!==void 0||this.#Y)&&!this.#W)this.#G.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#W=!0,Z2(()=>this.#O())}#D(_){if(this.#A!==void 0)throw new e("Stream is closed",this.#A);else if(this.#F)throw new e("Stream is closing",void 0);else this.#G.push(_),Z2(()=>this.#O())}#O(){if(this.#Y||this.#z!==void 0)return;if(this.#F&&this.#G.length===0){this._setClosed(new m("Stream was gracefully closed"));return}let _=this.#_._endpoint;if(_===void 0){this.#_._endpointPromise.then(()=>this.#O(),(X)=>this._setClosed(X));return}let $=this.#G.shift();if($===void 0)return;else if($.type==="pipeline"){let X=[$];for(;;){let Z=this.#G.first();if(Z!==void 0&&Z.type==="pipeline")X.push(Z),this.#G.shift();else if(Z===void 0&&this.#F&&!this.#W){X.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#W=!0;break}else break}this.#H(_,X)}else if($.type==="cursor")this.#R(_,$);else throw b($,"Impossible type of QueueEntry")}#H(_,$){this.#V(()=>this.#M($,_),(X)=>nH(X,_.encoding),(X)=>X.baton,(X)=>X.baseUrl,(X)=>iH($,X),(X)=>$.forEach((Z)=>Z.errorCallback(X)))}#R(_,$){let X=new x4(this,_.encoding);this.#z=X,this.#V(()=>this.#B($,_),(Z)=>X.open(Z),(Z)=>Z.baton,(Z)=>Z.baseUrl,(Z)=>$.cursorCallback(X),(Z)=>$.errorCallback(Z))}#V(_,$,X,Z,J,G){let Y;try{let z=_(),F=this.#Z;Y=F(z)}catch(z){Y=Promise.reject(z)}this.#Y=!0,Y.then((z)=>{if(!z.ok)return oH(z).then((F)=>{throw F});return $(z)}).then((z)=>{this.#J=X(z),this.#$=Z(z)??this.#$,J(z)}).catch((z)=>{this._setClosed(z),G(z)}).finally(()=>{this.#Y=!1,this.#O()})}#M(_,$){return this.#N(new URL($.pipelinePath,this.#$),{baton:this.#J,requests:_.map((X)=>X.request)},$.encoding,$X,ZX)}#B(_,$){if($.cursorPath===void 0)throw new i0(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${$.version}.`);return this.#N(new URL($.cursorPath,this.#$),{baton:this.#J,batch:_.batch},$.encoding,XX,JX)}#N(_,$,X,Z,J){let G,Y;if(X==="json")G=C_($,Z),Y="application/json";else if(X==="protobuf")G=v_($,J),Y="application/x-protobuf";else throw b(X,"Impossible encoding");let z=new L4;if(z.set("content-type",Y),this.#X!==void 0)z.set("authorization",`Bearer ${this.#X}`);return new u_(_.toString(),{method:"POST",headers:z,body:G})}}function iH(_,$){if($.results.length!==_.length)throw new E("Server returned unexpected number of pipeline results");for(let X=0;X<_.length;++X){let Z=$.results[X],J=_[X];if(Z.type==="ok"){if(Z.response.type!==J.request.type)throw new E("Received unexpected type of response");J.responseCallback(Z.response)}else if(Z.type==="error")J.errorCallback(M1(Z.error));else if(Z.type==="none")throw new E("Received unrecognized type of StreamResult");else throw b(Z,"Received impossible type of StreamResult")}}async function nH(_,$){if($==="json"){let X=await _.json();return e1(X,a$)}if($==="protobuf"){let X=await _.arrayBuffer();return k1(new Uint8Array(X),e$)}throw await _.body?.cancel(),b($,"Impossible encoding")}async function oH(_){let $=_.headers.get("content-type")??"text/plain",X=`Server returned HTTP status ${_.status}`;if($==="application/json"){let Z=await _.json();if("message"in Z)return M1(Z);return new t1(X,_.status)}if($==="text/plain"){let Z=(await _.text()).trim();if(Z!=="")X+=`: ${Z}`;return new t1(X,_.status)}return await _.body?.cancel(),new t1(X,_.status)}var sH=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],q4={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class n6 extends C2{#_;#$;#X;#Z;#J;_endpointPromise;_endpoint;constructor(_,$,X,Z=2){super();if(this.#_=_,this.#$=$,this.#X=X??P4,this.#Z=void 0,this.#J=new Set,Z==3)this._endpointPromise=rH(this.#X,this.#_),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J));else this._endpointPromise=Promise.resolve(q4),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J))}async getVersion(){if(this._endpoint!==void 0)return this._endpoint.version;return(await this._endpointPromise).version}_ensureVersion(_,$){if(_<=q4.version)return;else if(this._endpoint===void 0)throw new i0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this._endpoint.version<_)throw new i0(`${$} is supported only on protocol version ${_} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}openStream(){if(this.#Z!==void 0)throw new e("Client is closed",this.#Z);let _=new i6(this,this.#_,this.#$,this.#X);return this.#J.add(_),_}_streamClosed(_){this.#J.delete(_)}close(){this.#G(new m("Client was manually closed"))}get closed(){return this.#Z!==void 0}#G(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of Array.from(this.#J))$._setClosed(new e("Client was closed",_))}}async function rH(_,$){let X=_;for(let Z of sH){let J=new URL(Z.versionPath,$),G=new u_(J.toString(),{method:"GET"}),Y=await X(G);if(await Y.arrayBuffer(),Y.ok)return Z}return q4}function C4(_,$,X=2){if(typeof q2.default>"u")throw new x_("WebSockets are not supported in this environment");var Z=void 0;if(X==3)Z=Array.from(T4.keys());else Z=Array.from(r$.keys());let J=new q2.default(_,Z);return new l6(J,$)}function S4(_,$,X,Z=2){return new n6(_ instanceof URL?_:new URL(_),$,X,Z)}class d_{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}execute(_){return this.batch([_]).then(($)=>$[0])}async batch(_){let $=this._getStream();if($.closed)throw new L("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let X=_.map(B1),Z;if(this.#X===void 0){this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=G.step(),z=Y.run(L1(this.#_)),F=Y;Z=X.map((H)=>{let W=G.step().condition(s.ok(F));if(this.#$>=3)W.condition(s.not(s.isAutocommit(G)));let A=W.query(H);return A.catch(()=>{return}),F=W,A}),this.#X=G.execute().then(()=>z).then(()=>{return});try{await this.#X}catch(H){throw this.close(),H}}else{if(this.#$<3)await this.#X;this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=void 0;Z=X.map((z)=>{let F=G.step();if(Y!==void 0)F.condition(s.ok(Y));if(this.#$>=3)F.condition(s.not(s.isAutocommit(G)));let H=F.query(z);return H.catch(()=>{return}),Y=F,H}),await G.execute()}let J=[];for(let G of Z){let Y=await G;if(Y===void 0)throw new L("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");J.push(m2(Y))}return J}catch(X){throw a(X)}}async executeMultiple(_){let $=this._getStream();if($.closed)throw new L("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#X===void 0){this.#X=$.run(L1(this.#_)).then(()=>{return});try{await this.#X}catch(X){throw this.close(),X}}else await this.#X;await $.sequence(_)}catch(X){throw a(X)}}async rollback(){try{let _=this._getStream();if(_.closed)return;if(this.#X!==void 0);else return;let $=_.run("ROLLBACK").catch((X)=>{throw a(X)});_.closeGracefully(),await $}catch(_){throw a(_)}finally{this.close()}}async commit(){try{let _=this._getStream();if(_.closed)throw new L("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#X!==void 0)await this.#X;else return;let $=_.run("COMMIT").catch((X)=>{throw a(X)});_.closeGracefully(),await $}catch(_){throw a(_)}finally{this.close()}}}async function p2(_,$,X,Z,J=!1){if(J)X.step().run("PRAGMA foreign_keys=off");let G=X.step(),Y=G.run(L1(_)),z=G,F=Z.map((O)=>{let R=X.step().condition(s.ok(z));if($>=3)R.condition(s.not(s.isAutocommit(X)));let N=R.query(O);return z=R,N}),H=X.step().condition(s.ok(z));if($>=3)H.condition(s.not(s.isAutocommit(X)));let W=H.run("COMMIT");if(X.step().condition(s.not(s.ok(H))).run("ROLLBACK").catch((O)=>{return}),J)X.step().run("PRAGMA foreign_keys=on");await X.execute();let D=[];await Y;for(let O of F){let R=await O;if(R===void 0)throw new L("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");D.push(m2(R))}return await W,D}function B1(_){let $,X;if(Array.isArray(_))[$,X]=_;else if(typeof _==="string")$=_;else $=_.sql,X=_.args;let Z=new y_($);if(X)if(Array.isArray(X))Z.bindIndexes(X);else for(let[J,G]of Object.entries(X))Z.bindName(J,G);return Z}function m2(_){let $=_.columnNames.map((Y)=>Y??""),X=_.columnDecltypes.map((Y)=>Y??""),Z=_.rows,J=_.affectedRowCount,G=_.lastInsertRowid!==void 0?_.lastInsertRowid:void 0;return new B2($,X,Z,J,G)}function a(_){if(_ instanceof m){let $=GX(_);return new L(_.message,$,void 0,_)}return _}function GX(_){if(_ instanceof w_&&_.code!==void 0)return _.code;else if(_ instanceof E)return"HRANA_PROTO_ERROR";else if(_ instanceof e)return _.cause instanceof m?GX(_.cause):"HRANA_CLOSED_ERROR";else if(_ instanceof S2)return"HRANA_WEBSOCKET_ERROR";else if(_ instanceof t1)return"SERVER_ERROR";else if(_ instanceof i0)return"PROTOCOL_VERSION_ERROR";else if(_ instanceof R0)return"INTERNAL_ERROR";else return"UNKNOWN"}class u2{#_;#$;capacity;constructor(_,$){this.#_=_,this.#$=new YX,this.capacity=$}apply(_){if(this.capacity<=0)return;let $=new Set;for(let X of _){if(typeof X.sql!=="string")continue;let Z=X.sql;if(Z.length>=5000)continue;let J=this.#$.get(Z);if(J===void 0){while(this.#$.size+1>this.capacity){let[G,Y]=this.#$.peekLru();if($.has(Y))break;Y.close(),this.#$.delete(G)}if(this.#$.size+1<=this.capacity)J=this.#_.storeSql(Z),this.#$.set(Z,J)}if(J!==void 0)X.sql=J,$.add(J)}}}class YX{#_;constructor(){this.#_=new Map}get(_){let $=this.#_.get(_);if($!==void 0)this.#_.delete(_),this.#_.set(_,$);return $}set(_,$){this.#_.set(_,$)}peekLru(){for(let _ of this.#_.entries())return _;return}delete(_){this.#_.delete(_)}get size(){return this.#_.size}}var WX=Q0(v4(),1);function UX(_){if(_.scheme!=="wss"&&_.scheme!=="ws")throw new L(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${X1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new L("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="ws"&&_.tls)throw new L('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="wss"&&!_.tls)throw new L('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=R_(_.scheme,_.authority,_.path),X;try{X=C4($,_.authToken)}catch(Z){if(Z instanceof x_){let J=_.scheme==="wss"?"https":"http",G=R_(J,_.authority,_.path);throw new L(`This environment does not support WebSockets, please switch to the HTTP client by using a "${J}:" URL (${JSON.stringify(G)}). For more information, please read ${X1}`,"WEBSOCKETS_NOT_SUPPORTED")}throw a(Z)}return new AX(X,$,_.authToken,_.intMode,_.concurrency)}var eH=60000,HX=100;class AX{#_;#$;#X;#Z;#J;closed;protocol;#G;#Y;constructor(_,$,X,Z,J){this.#_=$,this.#$=X,this.#X=Z,this.#Z=this.#F(_),this.#J=void 0,this.closed=!1,this.protocol="ws",this.#Y=WX.default(J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{let Z=await this.#z();try{let J=B1(X);Z.conn.sqlCache.apply([J]);let G=Z.stream.query(J);Z.stream.closeGracefully();let Y=await G;return m2(Y)}catch(J){throw a(J)}finally{this._closeStream(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{let X=await this.#z();try{let J=_.map((H)=>{if(Array.isArray(H))return{sql:H[0],args:H[1]||[]};return H}).map(B1),G=await X.conn.client.getVersion();X.conn.sqlCache.apply(J);let Y=X.stream.batch(G>=3);return await p2($,G,Y,J)}catch(Z){throw a(Z)}finally{this._closeStream(X)}})}async migrate(_){return this.limit(async()=>{let $=await this.#z();try{let X=_.map(B1),Z=await $.conn.client.getVersion(),J=$.stream.batch(Z>=3);return await p2("deferred",Z,J,X,!0)}catch(X){throw a(X)}finally{this._closeStream($)}})}async transaction(_="write"){return this.limit(async()=>{let $=await this.#z();try{let X=await $.conn.client.getVersion();return new KX(this,$,_,X)}catch(X){throw this._closeStream($),a(X)}})}async executeMultiple(_){return this.limit(async()=>{let $=await this.#z();try{let X=$.stream.sequence(_);$.stream.closeGracefully(),await X}catch(X){throw a(X)}finally{this._closeStream($)}})}sync(){throw new L("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async#z(){if(this.closed)throw new L("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#Z.openTime.valueOf()>eH&&this.#J===void 0){let Z=this.#F();this.#J=Z,Z.client.getVersion().then((J)=>{if(this.#Z!==Z){if(this.#Z.streamStates.size===0)this.#Z.client.close()}this.#Z=Z,this.#J=void 0},(J)=>{this.#J=void 0})}if(this.#Z.client.closed)try{if(this.#J!==void 0)this.#Z=this.#J;else this.#Z=this.#F()}catch(Z){throw a(Z)}let X=this.#Z;try{if(X.useSqlCache===void 0){if(X.useSqlCache=await X.client.getVersion()>=2,X.useSqlCache)X.sqlCache.capacity=HX}let Z=X.client.openStream();Z.intMode=this.#X;let J={conn:X,stream:Z};return X.streamStates.add(J),J}catch(Z){throw a(Z)}}#F(_){try{return _??=C4(this.#_,this.#$),{client:_,useSqlCache:void 0,sqlCache:new u2(_,0),openTime:new Date,streamStates:new Set}}catch($){throw a($)}}async reconnect(){try{for(let X of Array.from(this.#Z.streamStates))try{X.stream.close()}catch{}this.#Z.client.close()}catch{}if(this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}let _=this.#F(),$=await _.client.getVersion();if(_.useSqlCache=$>=2,_.useSqlCache)_.sqlCache.capacity=HX;this.#Z=_,this.closed=!1}_closeStream(_){_.stream.close();let $=_.conn;if($.streamStates.delete(_),$.streamStates.size===0&&$!==this.#Z)$.client.close()}close(){if(this.#Z.client.close(),this.closed=!0,this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}this.closed=!0}}class KX extends d_{#_;#$;constructor(_,$,X,Z){super(X,Z);this.#_=_,this.#$=$}_getStream(){return this.#$.stream}_getSqlCache(){return this.#$.conn.sqlCache}close(){this.#_._closeStream(this.#$)}get closed(){return this.#$.stream.closed}}var DX=Q0(v4(),1);function OX(_){if(_.scheme!=="https"&&_.scheme!=="http")throw new L(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${X1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new L("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="http"&&_.tls)throw new L('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="https"&&!_.tls)throw new L('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=R_(_.scheme,_.authority,_.path);return new VX($,_.authToken,_.intMode,_.fetch,_.concurrency)}var RX=30;class VX{#_;protocol;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X,Z,J){this.#$=_,this.#G=$,this.#X=X,this.#Z=Z,this.#J=J,this.#_=S4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X,this.protocol="http",this.#Y=DX.default(this.#J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{try{let Z=B1(X),J,G=this.#_.openStream();try{J=G.query(Z)}finally{G.closeGracefully()}let Y=await J;return m2(Y)}catch(Z){throw a(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{try{let Z=_.map((F)=>{if(Array.isArray(F))return{sql:F[0],args:F[1]||[]};return F}).map(B1),J=await this.#_.getVersion(),G,Y=this.#_.openStream();try{new u2(Y,RX).apply(Z);let H=Y.batch(!1);G=p2($,J,H,Z)}finally{Y.closeGracefully()}return await G}catch(X){throw a(X)}})}async migrate(_){return this.limit(async()=>{try{let $=_.map(B1),X=await this.#_.getVersion(),Z,J=this.#_.openStream();try{let Y=J.batch(!1);Z=p2("deferred",X,Y,$,!0)}finally{J.closeGracefully()}return await Z}catch($){throw a($)}})}async transaction(_="write"){return this.limit(async()=>{try{let $=await this.#_.getVersion();return new NX(this.#_.openStream(),_,$)}catch($){throw a($)}})}async executeMultiple(_){return this.limit(async()=>{try{let $,X=this.#_.openStream();try{$=X.sequence(_)}finally{X.closeGracefully()}await $}catch($){throw a($)}})}sync(){throw new L("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#_.close()}async reconnect(){try{if(!this.closed)this.#_.close()}finally{this.#_=S4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X}}get closed(){return this.#_.closed}}class NX extends d_{#_;#$;constructor(_,$,X){super($,X);this.#_=_,this.#$=new u2(_,RX)}_getStream(){return this.#_}_getSqlCache(){return this.#$}close(){this.#_.close()}get closed(){return this.#_.closed}}function b1(_){return _W(N_(_,!0))}function _W(_){if(_.scheme==="wss"||_.scheme==="ws")return UX(_);else if(_.scheme==="https"||_.scheme==="http")return OX(_);else return E9(_)}class J0{static[K]="SelectionProxyHandler";config;constructor(_){this.config={..._}}get(_,$){if($==="_")return{..._._,selectedFields:new Proxy(_._.selectedFields,this)};if($===o)return{..._[o],selectedFields:new Proxy(_[o].selectedFields,this)};if(typeof $==="symbol")return _[$];let Z=(V(_,$0)?_._.selectedFields:V(_,h0)?_[o].selectedFields:_)[$];if(V(Z,Q.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!Z.isSelectionField)return Z.sql;let J=Z.clone();return J.isSelectionField=!0,J}if(V(Z,Q)){if(this.config.sqlBehavior==="sql")return Z;throw Error(`You tried to reference "${$}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}if(V(Z,p)){if(this.config.alias)return new Proxy(Z,new O2(new Proxy(Z.table,new H_(this.config.alias,this.config.replaceOriginalName??!1))));return Z}if(typeof Z!=="object"||Z===null)return Z;return new Proxy(Z,new J0(this.config))}}class h4{static[K]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(_,$){if(this.reference=()=>{let{name:X,columns:Z,foreignColumns:J}=_();return{name:X,columns:Z,foreignTable:J[0].table,foreignColumns:J}},$)this._onUpdate=$.onUpdate,this._onDelete=$.onDelete}onUpdate(_){return this._onUpdate=_,this}onDelete(_){return this._onDelete=_,this}build(_){return new MX(_,this)}}class MX{constructor(_,$){this.table=_,this.reference=$.reference,this.onUpdate=$._onUpdate,this.onDelete=$._onDelete}static[K]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:_,columns:$,foreignColumns:X}=this.reference(),Z=$.map((Y)=>Y.name),J=X.map((Y)=>Y.name),G=[this.table[T0],...Z,X[0].table[T0],...J];return _??`${G.join("_")}_fk`}}function BX(_,$){return`${_[T0]}_${$.join("_")}_unique`}class W0 extends b8{static[K]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(_,$={}){return this.foreignKeyConfigs.push({ref:_,actions:$}),this}unique(_){return this.config.isUnique=!0,this.config.uniqueName=_,this}generatedAlwaysAs(_,$){return this.config.generated={as:_,type:"always",mode:$?.mode??"virtual"},this}buildForeignKeys(_,$){return this.foreignKeyConfigs.map(({ref:X,actions:Z})=>{return((J,G)=>{let Y=new h4(()=>{let z=J();return{columns:[_],foreignColumns:[z]}});if(G.onUpdate)Y.onUpdate(G.onUpdate);if(G.onDelete)Y.onDelete(G.onDelete);return Y.build($)})(X,Z)})}}class t extends p{constructor(_,$){if(!$.uniqueName)$.uniqueName=BX(_,[$.name]);super(_,$);this.table=_}static[K]="SQLiteColumn"}class IX extends W0{static[K]="SQLiteBigIntBuilder";constructor(_){super(_,"bigint","SQLiteBigInt")}build(_){return new QX(_,this.config)}}class QX extends t{static[K]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return BigInt($.toString("utf8"))}return BigInt(s8.decode(_))}mapToDriverValue(_){return Buffer.from(_.toString())}}class EX extends W0{static[K]="SQLiteBlobJsonBuilder";constructor(_){super(_,"json","SQLiteBlobJson")}build(_){return new jX(_,this.config)}}class jX extends t{static[K]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return JSON.parse($.toString("utf8"))}return JSON.parse(s8.decode(_))}mapToDriverValue(_){return Buffer.from(JSON.stringify(_))}}class TX extends W0{static[K]="SQLiteBlobBufferBuilder";constructor(_){super(_,"buffer","SQLiteBlobBuffer")}build(_){return new LX(_,this.config)}}class LX extends t{static[K]="SQLiteBlobBuffer";mapFromDriverValue(_){if(Buffer.isBuffer(_))return _;return Buffer.from(_)}getSQLType(){return"blob"}}function PX(_,$){let{name:X,config:Z}=_1(_,$);if(Z?.mode==="json")return new EX(X);if(Z?.mode==="bigint")return new IX(X);return new TX(X)}class wX extends W0{static[K]="SQLiteCustomColumnBuilder";constructor(_,$,X){super(_,"custom","SQLiteCustomColumn");this.config.fieldConfig=$,this.config.customTypeParams=X}build(_){return new xX(_,this.config)}}class xX extends t{static[K]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(_,$){super(_,$);this.sqlName=$.customTypeParams.dataType($.fieldConfig),this.mapTo=$.customTypeParams.toDriver,this.mapFrom=$.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(_){return typeof this.mapFrom==="function"?this.mapFrom(_):_}mapToDriverValue(_){return typeof this.mapTo==="function"?this.mapTo(_):_}}function qX(_){return($,X)=>{let{name:Z,config:J}=_1($,X);return new wX(Z,J,_)}}class o6 extends W0{static[K]="SQLiteBaseIntegerBuilder";constructor(_,$,X){super(_,$,X);this.config.autoIncrement=!1}primaryKey(_){if(_?.autoIncrement)this.config.autoIncrement=!0;return this.config.hasDefault=!0,super.primaryKey()}}class s6 extends t{static[K]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class CX extends o6{static[K]="SQLiteIntegerBuilder";constructor(_){super(_,"number","SQLiteInteger")}build(_){return new SX(_,this.config)}}class SX extends s6{static[K]="SQLiteInteger"}class kX extends o6{static[K]="SQLiteTimestampBuilder";constructor(_,$){super(_,"date","SQLiteTimestamp");this.config.mode=$}defaultNow(){return this.default(U`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(_){return new vX(_,this.config)}}class vX extends s6{static[K]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(_){if(this.config.mode==="timestamp")return new Date(_*1000);return new Date(_)}mapToDriverValue(_){let $=_.getTime();if(this.config.mode==="timestamp")return Math.floor($/1000);return $}}class hX extends o6{static[K]="SQLiteBooleanBuilder";constructor(_,$){super(_,"boolean","SQLiteBoolean");this.config.mode=$}build(_){return new yX(_,this.config)}}class yX extends s6{static[K]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(_){return Number(_)===1}mapToDriverValue(_){return _?1:0}}function x0(_,$){let{name:X,config:Z}=_1(_,$);if(Z?.mode==="timestamp"||Z?.mode==="timestamp_ms")return new kX(X,Z.mode);if(Z?.mode==="boolean")return new hX(X,Z.mode);return new CX(X)}class fX extends W0{static[K]="SQLiteNumericBuilder";constructor(_){super(_,"string","SQLiteNumeric")}build(_){return new bX(_,this.config)}}class bX extends t{static[K]="SQLiteNumeric";mapFromDriverValue(_){if(typeof _==="string")return _;return String(_)}getSQLType(){return"numeric"}}class gX extends W0{static[K]="SQLiteNumericNumberBuilder";constructor(_){super(_,"number","SQLiteNumericNumber")}build(_){return new pX(_,this.config)}}class pX extends t{static[K]="SQLiteNumericNumber";mapFromDriverValue(_){if(typeof _==="number")return _;return Number(_)}mapToDriverValue=String;getSQLType(){return"numeric"}}class mX extends W0{static[K]="SQLiteNumericBigIntBuilder";constructor(_){super(_,"bigint","SQLiteNumericBigInt")}build(_){return new uX(_,this.config)}}class uX extends t{static[K]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function dX(_,$){let{name:X,config:Z}=_1(_,$),J=Z?.mode;return J==="number"?new gX(X):J==="bigint"?new mX(X):new fX(X)}class cX extends W0{static[K]="SQLiteRealBuilder";constructor(_){super(_,"number","SQLiteReal")}build(_){return new lX(_,this.config)}}class lX extends t{static[K]="SQLiteReal";getSQLType(){return"real"}}function z1(_){return new cX(_??"")}class iX extends W0{static[K]="SQLiteTextBuilder";constructor(_,$){super(_,"string","SQLiteText");this.config.enumValues=$.enum,this.config.length=$.length}build(_){return new nX(_,this.config)}}class nX extends t{static[K]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(_,$){super(_,$)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class oX extends W0{static[K]="SQLiteTextJsonBuilder";constructor(_){super(_,"json","SQLiteTextJson")}build(_){return new sX(_,this.config)}}class sX extends t{static[K]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(_){return JSON.parse(_)}mapToDriverValue(_){return JSON.stringify(_)}}function x(_,$={}){let{name:X,config:Z}=_1(_,$);if(Z.mode==="json")return new oX(X);return new iX(X,Z)}function rX(){return{blob:PX,customType:qX,integer:x0,numeric:dX,real:z1,text:x}}var y4=Symbol.for("drizzle:SQLiteInlineForeignKeys");class G0 extends B{static[K]="SQLiteTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:y4});[B.Symbol.Columns];[y4]=[];[B.Symbol.ExtraConfigBuilder]=void 0}function $W(_,$,X,Z,J=_){let G=new G0(_,Z,J),Y=typeof $==="function"?$(rX()):$,z=Object.fromEntries(Object.entries(Y).map(([H,W])=>{let A=W;A.setName(H);let D=A.build(G);return G[y4].push(...A.buildForeignKeys(D,G)),[H,D]})),F=Object.assign(G,z);if(F[B.Symbol.Columns]=z,F[B.Symbol.ExtraConfigColumns]=z,X)F[G0.Symbol.ExtraConfigBuilder]=X;return F}var B0=(_,$,X)=>{return $W(_,$,X)};class aX{constructor(_,$){this.name=_,this.unique=$}static[K]="SQLiteIndexBuilderOn";on(..._){return new tX(this.name,_,this.unique)}}class tX{static[K]="SQLiteIndexBuilder";config;constructor(_,$,X){this.config={name:_,columns:$,unique:X,where:void 0}}where(_){return this.config.where=_,this}build(_){return new eX(this.config,_)}}class eX{static[K]="SQLiteIndex";config;constructor(_,$){this.config={..._,table:$}}}function D0(_){return new aX(_,!1)}function d2(..._){if(_[0].columns)return new f4(_[0].columns,_[0].name);return new f4(_)}class f4{static[K]="SQLitePrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new _Z(_,this.columns,this.name)}}class _Z{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[K]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[G0.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function o0(_){if(V(_,G0))return[`${_[B.Symbol.BaseName]}`];if(V(_,$0))return _._.usedTables??[];if(V(_,Q))return _.usedTables??[];return[]}class r6 extends M0{constructor(_,$,X,Z){super();this.table=_,this.session=$,this.dialect=X,this.config={table:_,withList:Z}}static[K]="SQLiteDelete";config;where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new J0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.table[G0.Symbol.Columns]){return this.config.returning=y0(_),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:o0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(_){return this._prepare().execute(_)}$dynamic(){return this}}function XW(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map((X)=>X.toLowerCase()).join("_")}function ZW(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((X,Z,J)=>{let G=J===0?Z.toLowerCase():`${Z[0].toUpperCase()}${Z.slice(1)}`;return X+G},"")}function JW(_){return _}class b4{static[K]="CasingCache";cache={};cachedTables={};convert;constructor(_){this.convert=_==="snake_case"?XW:_==="camelCase"?ZW:JW}getColumnCasing(_){if(!_.keyAsName)return _.name;let $=_.table[B.Symbol.Schema]??"public",X=_.table[B.Symbol.OriginalName],Z=`${$}.${X}.${_.name}`;if(!this.cache[Z])this.cacheTable(_.table);return this.cache[Z]}cacheTable(_){let $=_[B.Symbol.Schema]??"public",X=_[B.Symbol.OriginalName],Z=`${$}.${X}`;if(!this.cachedTables[Z]){for(let J of Object.values(_[B.Symbol.Columns])){let G=`${Z}.${J.name}`;this.cache[G]=this.convert(J.name)}this.cachedTables[Z]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class J2 extends h0{static[K]="SQLiteViewBase"}class c2{static[K]="SQLiteDialect";casing;constructor(_){this.casing=new b4(_?.casing)}escapeName(_){return`"${_}"`}escapeParam(_){return"?"}escapeString(_){return`'${_.replace(/'/g,"''")}'`}buildWithCTE(_){if(!_?.length)return;let $=[U`with `];for(let[X,Z]of _.entries())if($.push(U`${U.identifier(Z._.alias)} as (${Z._.sql})`),X<_.length-1)$.push(U`, `);return $.push(U` `),U.join($)}buildDeleteQuery({table:_,where:$,returning:X,withList:Z,limit:J,orderBy:G}){let Y=this.buildWithCTE(Z),z=X?U` returning ${this.buildSelection(X,{isSingleTable:!0})}`:void 0,F=$?U` where ${$}`:void 0,H=this.buildOrderBy(G),W=this.buildLimit(J);return U`${Y}delete from ${_}${F}${z}${H}${W}`}buildUpdateSet(_,$){let X=_[B.Symbol.Columns],Z=Object.keys(X).filter((G)=>$[G]!==void 0||X[G]?.onUpdateFn!==void 0),J=Z.length;return U.join(Z.flatMap((G,Y)=>{let z=X[G],F=$[G]??U.param(z.onUpdateFn(),z),H=U`${U.identifier(this.casing.getColumnCasing(z))} = ${F}`;if(Y<J-1)return[H,U.raw(", ")];return[H]}))}buildUpdateQuery({table:_,set:$,where:X,returning:Z,withList:J,joins:G,from:Y,limit:z,orderBy:F}){let H=this.buildWithCTE(J),W=this.buildUpdateSet(_,$),A=Y&&U.join([U.raw(" from "),this.buildFromTable(Y)]),D=this.buildJoins(G),O=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,R=X?U` where ${X}`:void 0,N=this.buildOrderBy(F),I=this.buildLimit(z);return U`${H}update ${_} set ${W}${A}${D}${R}${O}${N}${I}`}buildSelection(_,{isSingleTable:$=!1}={}){let X=_.length,Z=_.flatMap(({field:J},G)=>{let Y=[];if(V(J,Q.Aliased)&&J.isSelectionField)Y.push(U.identifier(J.fieldAlias));else if(V(J,Q.Aliased)||V(J,Q)){let z=V(J,Q.Aliased)?J.sql:J;if($)Y.push(new Q(z.queryChunks.map((F)=>{if(V(F,p))return U.identifier(this.casing.getColumnCasing(F));return F})));else Y.push(z);if(V(J,Q.Aliased))Y.push(U` as ${U.identifier(J.fieldAlias)}`)}else if(V(J,p)){let z=J.table[B.Symbol.Name];if(J.columnType==="SQLiteNumericBigInt")if($)Y.push(U`cast(${U.identifier(this.casing.getColumnCasing(J))} as text)`);else Y.push(U`cast(${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))} as text)`);else if($)Y.push(U.identifier(this.casing.getColumnCasing(J)));else Y.push(U`${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))}`)}if(G<X-1)Y.push(U`, `);return Y});return U.join(Z)}buildJoins(_){if(!_||_.length===0)return;let $=[];if(_)for(let[X,Z]of _.entries()){if(X===0)$.push(U` `);let J=Z.table,G=Z.on?U` on ${Z.on}`:void 0;if(V(J,G0)){let Y=J[G0.Symbol.Name],z=J[G0.Symbol.Schema],F=J[G0.Symbol.OriginalName],H=Y===F?void 0:Z.alias;$.push(U`${U.raw(Z.joinType)} join ${z?U`${U.identifier(z)}.`:void 0}${U.identifier(F)}${H&&U` ${U.identifier(H)}`}${G}`)}else $.push(U`${U.raw(Z.joinType)} join ${J}${G}`);if(X<_.length-1)$.push(U` `)}return U.join($)}buildLimit(_){return typeof _==="object"||typeof _==="number"&&_>=0?U` limit ${_}`:void 0}buildOrderBy(_){let $=[];if(_){for(let[X,Z]of _.entries())if($.push(Z),X<_.length-1)$.push(U`, `)}return $.length>0?U` order by ${U.join($)}`:void 0}buildFromTable(_){if(V(_,B)&&_[B.Symbol.IsAlias])return U`${U`${U.identifier(_[B.Symbol.Schema]??"")}.`.if(_[B.Symbol.Schema])}${U.identifier(_[B.Symbol.OriginalName])} ${U.identifier(_[B.Symbol.Name])}`;return _}buildSelectQuery({withList:_,fields:$,fieldsFlat:X,where:Z,having:J,table:G,joins:Y,orderBy:z,groupBy:F,limit:H,offset:W,distinct:A,setOperators:D}){let O=X??y0($);for(let u0 of O)if(V(u0.field,p)&&E1(u0.field.table)!==(V(G,$0)?G._.alias:V(G,J2)?G[o].name:V(G,Q)?void 0:E1(G))&&!((a0)=>Y?.some(({alias:t_})=>t_===(a0[B.Symbol.IsAlias]?E1(a0):a0[B.Symbol.BaseName])))(u0.field.table)){let a0=E1(u0.field.table);throw Error(`Your "${u0.path.join("->")}" field references a column "${a0}"."${u0.field.name}", but the table "${a0}" is not part of the query! Did you forget to join it?`)}let R=!Y||Y.length===0,N=this.buildWithCTE(_),I=A?U` distinct`:void 0,y=this.buildSelection(O,{isSingleTable:R}),k=this.buildFromTable(G),C=this.buildJoins(Y),Y0=Z?U` where ${Z}`:void 0,_0=J?U` having ${J}`:void 0,T=[];if(F){for(let[u0,a0]of F.entries())if(T.push(a0),u0<F.length-1)T.push(U`, `)}let g=T.length>0?U` group by ${U.join(T)}`:void 0,S0=this.buildOrderBy(z),Q1=this.buildLimit(H),a2=W?U` offset ${W}`:void 0,H2=U`${N}select${I} ${y} from ${k}${C}${Y0}${g}${_0}${S0}${Q1}${a2}`;if(D.length>0)return this.buildSetOperations(H2,D);return H2}buildSetOperations(_,$){let[X,...Z]=$;if(!X)throw Error("Cannot pass undefined values to any set operator");if(Z.length===0)return this.buildSetOperationQuery({leftSelect:_,setOperator:X});return this.buildSetOperations(this.buildSetOperationQuery({leftSelect:_,setOperator:X}),Z)}buildSetOperationQuery({leftSelect:_,setOperator:{type:$,isAll:X,rightSelect:Z,limit:J,orderBy:G,offset:Y}}){let z=U`${_.getSQL()} `,F=U`${Z.getSQL()}`,H;if(G&&G.length>0){let O=[];for(let R of G)if(V(R,t))O.push(U.identifier(R.name));else if(V(R,Q)){for(let N=0;N<R.queryChunks.length;N++){let I=R.queryChunks[N];if(V(I,t))R.queryChunks[N]=U.identifier(this.casing.getColumnCasing(I))}O.push(U`${R}`)}else O.push(U`${R}`);H=U` order by ${U.join(O,U`, `)}`}let W=typeof J==="object"||typeof J==="number"&&J>=0?U` limit ${J}`:void 0,A=U.raw(`${$} ${X?"all ":""}`),D=Y?U` offset ${Y}`:void 0;return U`${z}${A}${F}${H}${W}${D}`}buildInsertQuery({table:_,values:$,onConflict:X,returning:Z,withList:J,select:G}){let Y=[],z=_[B.Symbol.Columns],F=Object.entries(z).filter(([R,N])=>!N.shouldDisableInsert()),H=F.map(([,R])=>U.identifier(this.casing.getColumnCasing(R)));if(G){let R=$;if(V(R,Q))Y.push(R);else Y.push(R.getSQL())}else{let R=$;Y.push(U.raw("values "));for(let[N,I]of R.entries()){let y=[];for(let[k,C]of F){let Y0=I[k];if(Y0===void 0||V(Y0,L0)&&Y0.value===void 0){let _0;if(C.default!==null&&C.default!==void 0)_0=V(C.default,Q)?C.default:U.param(C.default,C);else if(C.defaultFn!==void 0){let T=C.defaultFn();_0=V(T,Q)?T:U.param(T,C)}else if(!C.default&&C.onUpdateFn!==void 0){let T=C.onUpdateFn();_0=V(T,Q)?T:U.param(T,C)}else _0=U`null`;y.push(_0)}else y.push(Y0)}if(Y.push(y),N<R.length-1)Y.push(U`, `)}}let W=this.buildWithCTE(J),A=U.join(Y),D=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,O=X?.length?U.join(X):void 0;return U`${W}insert into ${_} ${H} ${A}${O}${D}`}sqlToQuery(_,$){return _.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:$})}buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:Z,tableConfig:J,queryConfig:G,tableAlias:Y,nestedQueryRelation:z,joinOn:F}){let H=[],W,A,D=[],O,R=[];if(G===!0)H=Object.entries(J.columns).map(([y,k])=>({dbKey:k.name,tsKey:y,field:e0(k,Y),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let I=Object.fromEntries(Object.entries(J.columns).map(([T,g])=>[T,e0(g,Y)]));if(G.where){let T=typeof G.where==="function"?G.where(I,K7()):G.where;O=T&&W_(T,Y)}let y=[],k=[];if(G.columns){let T=!1;for(let[g,S0]of Object.entries(G.columns)){if(S0===void 0)continue;if(g in J.columns){if(!T&&S0===!0)T=!0;k.push(g)}}if(k.length>0)k=T?k.filter((g)=>G.columns?.[g]===!0):Object.keys(J.columns).filter((g)=>!k.includes(g))}else k=Object.keys(J.columns);for(let T of k){let g=J.columns[T];y.push({tsKey:T,value:g})}let C=[];if(G.with)C=Object.entries(G.with).filter((T)=>!!T[1]).map(([T,g])=>({tsKey:T,queryConfig:g,relation:J.relations[T]}));let Y0;if(G.extras){Y0=typeof G.extras==="function"?G.extras(I,{sql:U}):G.extras;for(let[T,g]of Object.entries(Y0))y.push({tsKey:T,value:c8(g,Y)})}for(let{tsKey:T,value:g}of y)H.push({dbKey:V(g,Q.Aliased)?g.fieldAlias:J.columns[T].name,tsKey:T,field:V(g,p)?e0(g,Y):g,relationTableTsKey:void 0,isJson:!1,selection:[]});let _0=typeof G.orderBy==="function"?G.orderBy(I,D7()):G.orderBy??[];if(!Array.isArray(_0))_0=[_0];D=_0.map((T)=>{if(V(T,p))return e0(T,Y);return W_(T,Y)}),W=G.limit,A=G.offset;for(let{tsKey:T,queryConfig:g,relation:S0}of C){let Q1=R7($,X,S0),a2=c1(S0.referencedTable),H2=X[a2],u0=`${Y}_${T}`,a0=A0(...Q1.fields.map((nZ,oZ)=>j(e0(Q1.references[oZ],u0),e0(nZ,Y)))),t_=this.buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:_[H2],tableConfig:$[H2],queryConfig:V(S0,T1)?g===!0?{limit:1}:{...g,limit:1}:g,tableAlias:u0,joinOn:a0,nestedQueryRelation:S0}),iZ=U`(${t_.sql})`.as(T);H.push({dbKey:T,tsKey:T,field:iZ,relationTableTsKey:H2,isJson:!0,selection:t_.selection})}}if(H.length===0)throw new R2({message:`No fields selected for table "${J.tsName}" ("${Y}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let N;if(O=A0(F,O),z){let I=U`json_array(${U.join(H.map(({field:C})=>V(C,t)?U.identifier(this.casing.getColumnCasing(C)):V(C,Q.Aliased)?C.sql:C),U`, `)})`;if(V(z,D_))I=U`coalesce(json_group_array(${I}), json_array())`;let y=[{dbKey:"data",tsKey:"data",field:I.as("data"),isJson:!0,relationTableTsKey:J.tsName,selection:H}];if(W!==void 0||A!==void 0||D.length>0)N=this.buildSelectQuery({table:O6(Z,Y),fields:{},fieldsFlat:[{path:[],field:U.raw("*")}],where:O,limit:W,offset:A,orderBy:D,setOperators:[]}),O=void 0,W=void 0,A=void 0,D=void 0;else N=O6(Z,Y);N=this.buildSelectQuery({table:V(N,G0)?N:new $0(N,{},Y),fields:{},fieldsFlat:y.map(({field:C})=>({path:[],field:V(C,p)?e0(C,Y):C})),joins:R,where:O,limit:W,offset:A,orderBy:D,setOperators:[]})}else N=this.buildSelectQuery({table:O6(Z,Y),fields:{},fieldsFlat:H.map(({field:I})=>({path:[],field:V(I,p)?e0(I,Y):I})),joins:R,where:O,limit:W,offset:A,orderBy:D,setOperators:[]});return{tableTsKey:J.tsName,sql:N,selection:H}}}class g4 extends c2{static[K]="SQLiteSyncDialect";migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;$.run(J);let Y=$.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;$.run(U`BEGIN`);try{for(let z of _)if(!Y||Number(Y[2])<z.folderMillis){for(let F of z.sql)$.run(U.raw(F));$.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${z.hash}, ${z.folderMillis})`)}$.run(U`COMMIT`)}catch(z){throw $.run(U`ROLLBACK`),z}}}class p4 extends c2{static[K]="SQLiteAsyncDialect";async migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await $.run(J);let Y=(await $.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await $.transaction(async(z)=>{for(let F of _)if(!Y||Number(Y[2])<F.folderMillis){for(let H of F.sql)await z.run(U.raw(H));await z.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${F.hash}, ${F.folderMillis})`)}})}}class m4{static[K]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class s0{static[K]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(_){this.fields=_.fields,this.session=_.session,this.dialect=_.dialect,this.withList=_.withList,this.distinct=_.distinct}from(_){let $=!!this.fields,X;if(this.fields)X=this.fields;else if(V(_,$0))X=Object.fromEntries(Object.keys(_._.selectedFields).map((Z)=>[Z,_[Z]]));else if(V(_,J2))X=_[o].selectedFields;else if(V(_,Q))X={};else X=d3(_);return new u4({table:_,fields:X,isPartialSelect:$,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class $Z extends m4{static[K]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:_,fields:$,isPartialSelect:X,session:Z,dialect:J,withList:G,distinct:Y}){super();this.config={withList:G,table:_,fields:{...$},distinct:Y,setOperators:[]},this.isPartialSelect=X,this.session=Z,this.dialect=J,this._={selectedFields:$,config:this.config},this.tableName=A_(_),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{};for(let z of o0(_))this.usedTables.add(z)}getUsedTables(){return[...this.usedTables]}createJoin(_){return($,X)=>{let Z=this.tableName,J=A_($);for(let G of o0($))this.usedTables.add(G);if(typeof J==="string"&&this.config.joins?.some((G)=>G.alias===J))throw Error(`Alias "${J}" is already used in this query`);if(!this.isPartialSelect){if(Object.keys(this.joinsNotNullableMap).length===1&&typeof Z==="string")this.config.fields={[Z]:this.config.fields};if(typeof J==="string"&&!V($,Q)){let G=V($,$0)?$._.selectedFields:V($,h0)?$[o].selectedFields:$[B.Symbol.Columns];this.config.fields[J]=G}}if(typeof X==="function")X=X(new Proxy(this.config.fields,new J0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));if(!this.config.joins)this.config.joins=[];if(this.config.joins.push({on:X,table:$,joinType:_,alias:J}),typeof J==="string")switch(_){case"left":{this.joinsNotNullableMap[J]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[J]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(_,$){return(X)=>{let Z=typeof X==="function"?X(GW()):X;if(!U_(this.getSelectedFields(),Z.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:_,isAll:$,rightSelect:Z}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(_){return this.config.setOperators.push(..._),this}where(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new J0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.where=_,this}having(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new J0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.having=_,this}groupBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new J0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray($)?$:[$]}else this.config.groupBy=_;return this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new J0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=X;else this.config.orderBy=X}else{let $=_;if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=$;else this.config.orderBy=$}return this}limit(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).limit=_;else this.config.limit=_;return this}offset(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).offset=_;else this.config.offset=_;return this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}as(_){let $=[];if($.push(...o0(this.config.table)),this.config.joins)for(let X of this.config.joins)$.push(...o0(X.table));return new Proxy(new $0(this.getSQL(),this.config.fields,_,!1,[...new Set($)]),new J0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new J0({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class u4 extends $Z{static[K]="SQLiteSelect";_prepare(_=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let $=y0(this.config.fields),X=this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),$,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return X.joinsNotNullableMap=this.joinsNotNullableMap,X}$withCache(_){return this.cacheConfig=_===void 0?{config:{},enable:!0,autoInvalidate:!0}:_===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,..._},this}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.all()}}u3(u4,[M0]);function a6(_,$){return(X,Z,...J)=>{let G=[Z,...J].map((Y)=>({type:_,isAll:$,rightSelect:Y}));for(let Y of G)if(!U_(X.getSelectedFields(),Y.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return X.addSetOperators(G)}}var GW=()=>({union:YW,unionAll:zW,intersect:FW,except:HW}),YW=a6("union",!1),zW=a6("union",!0),FW=a6("intersect",!1),HW=a6("except",!1);class c_{static[K]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(_){this.dialect=V(_,c2)?_:void 0,this.dialectConfig=V(_,c2)?void 0:_}$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(X);return new Proxy(new Y_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new J0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};with(..._){let $=this;function X(J){return new s0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_})}function Z(J){return new s0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_,distinct:!0})}return{select:X,selectDistinct:Z}}select(_){return new s0({fields:_??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(_){return new s0({fields:_??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){if(!this.dialect)this.dialect=new g4(this.dialectConfig);return this.dialect}}class t6{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[K]="SQLiteInsertBuilder";values(_){if(_=Array.isArray(_)?_:[_],_.length===0)throw Error("values() must be called with at least one value");let $=_.map((X)=>{let Z={},J=this.table[B.Symbol.Columns];for(let G of Object.keys(X)){let Y=X[G];Z[G]=V(Y,Q)?Y:new L0(Y,J[G])}return Z});return new d4(this.table,$,this.session,this.dialect,this.withList)}select(_){let $=typeof _==="function"?_(new c_):_;if(!V($,Q)&&!U_(this.table[K6],$._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new d4(this.table,$,this.session,this.dialect,this.withList,!0)}}class d4 extends M0{constructor(_,$,X,Z,J,G){super();this.session=X,this.dialect=Z,this.config={table:_,values:$,withList:J,select:G}}static[K]="SQLiteInsert";config;returning(_=this.config.table[G0.Symbol.Columns]){return this.config.returning=y0(_),this}onConflictDoNothing(_={}){if(!this.config.onConflict)this.config.onConflict=[];if(_.target===void 0)this.config.onConflict.push(U` on conflict do nothing`);else{let $=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,X=_.where?U` where ${_.where}`:U``;this.config.onConflict.push(U` on conflict ${$} do nothing${X}`)}return this}onConflictDoUpdate(_){if(_.where&&(_.targetWhere||_.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');if(!this.config.onConflict)this.config.onConflict=[];let $=_.where?U` where ${_.where}`:void 0,X=_.targetWhere?U` where ${_.targetWhere}`:void 0,Z=_.setWhere?U` where ${_.setWhere}`:void 0,J=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,G=this.dialect.buildUpdateSet(this.config.table,R6(this.config.table,_.set));return this.config.onConflict.push(U` on conflict ${J}${X} do update set ${G}${$}${Z}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:o0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class e6{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[K]="SQLiteUpdateBuilder";set(_){return new XZ(this.table,R6(this.table,_),this.session,this.dialect,this.withList)}}class XZ extends M0{constructor(_,$,X,Z,J){super();this.session=X,this.dialect=Z,this.config={set:$,table:_,withList:J,joins:[]}}static[K]="SQLiteUpdate";config;from(_){return this.config.from=_,this}createJoin(_){return($,X)=>{let Z=A_($);if(typeof Z==="string"&&this.config.joins.some((J)=>J.alias===Z))throw Error(`Alias "${Z}" is already used in this query`);if(typeof X==="function"){let J=this.config.from?V($,G0)?$[B.Symbol.Columns]:V($,$0)?$._.selectedFields:V($,J2)?$[o].selectedFields:void 0:void 0;X=X(new Proxy(this.config.table[B.Symbol.Columns],new J0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),J&&new Proxy(J,new J0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:X,table:$,joinType:_,alias:Z}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new J0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.config.table[G0.Symbol.Columns]){return this.config.returning=y0(_),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:o0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class l_ extends Q{constructor(_){super(l_.buildEmbeddedCount(_.source,_.filters).queryChunks);this.params=_,this.session=_.session,this.sql=l_.buildCount(_.source,_.filters)}sql;static[K]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(_,$){return U`(select count(*) from ${_}${U.raw(" where ").if($)}${$})`}static buildCount(_,$){return U`select count(*) from ${_}${U.raw(" where ").if($)}${$}`}then(_,$){return Promise.resolve(this.session.count(this.sql)).then(_,$)}catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}}class l4{constructor(_,$,X,Z,J,G,Y,z){this.mode=_,this.fullSchema=$,this.schema=X,this.tableNamesMap=Z,this.table=J,this.tableConfig=G,this.dialect=Y,this.session=z}static[K]="SQLiteAsyncRelationalQueryBuilder";findMany(_){return this.mode==="sync"?new c4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many"):new _8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many")}findFirst(_){return this.mode==="sync"?new c4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first"):new _8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first")}}class _8 extends M0{constructor(_,$,X,Z,J,G,Y,z,F){super();this.fullSchema=_,this.schema=$,this.tableNamesMap=X,this.table=Z,this.tableConfig=J,this.dialect=G,this.session=Y,this.config=z,this.mode=F}static[K]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(_=!1){let{query:$,builtQuery:X}=this._toSQL();return this.session[_?"prepareOneTimeQuery":"prepareQuery"](X,void 0,this.mode==="first"?"get":"all",!0,(Z,J)=>{let G=Z.map((Y)=>V6(this.schema,this.tableConfig,Y,$.selection,J));if(this.mode==="first")return G[0];return G})}prepare(){return this._prepare(!1)}_toSQL(){let _=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),$=this.dialect.sqlToQuery(_.sql);return{query:_,builtQuery:$}}toSQL(){return this._toSQL().builtQuery}executeRaw(){if(this.mode==="first")return this._prepare(!1).get();return this._prepare(!1).all()}async execute(){return this.executeRaw()}}class c4 extends _8{static[K]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class l2 extends M0{constructor(_,$,X,Z,J){super();this.execute=_,this.getSQL=$,this.dialect=Z,this.mapBatchResult=J,this.config={action:X}}static[K]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(_,$){return $?this.mapBatchResult(_):_}_prepare(){return this}isResponseInArrayMode(){return!1}}class i_{constructor(_,$,X,Z){this.resultKind=_,this.dialect=$,this.session=X,this._=Z?{schema:Z.schema,fullSchema:Z.fullSchema,tableNamesMap:Z.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let J=this.query;if(this._.schema)for(let[G,Y]of Object.entries(this._.schema))J[G]=new l4(_,Z.fullSchema,this._.schema,this._.tableNamesMap,Z.fullSchema[G],Y,$,X);this.$cache={invalidate:async(G)=>{}}}static[K]="BaseSQLiteDatabase";query;$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(new c_(X.dialect));return new Proxy(new Y_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new J0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};$count(_,$){return new l_({source:_,filters:$,session:this.session})}with(..._){let $=this;function X(z){return new s0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_})}function Z(z){return new s0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_,distinct:!0})}function J(z){return new e6(z,$.session,$.dialect,_)}function G(z){return new t6(z,$.session,$.dialect,_)}function Y(z){return new r6(z,$.session,$.dialect,_)}return{select:X,selectDistinct:Z,update:J,insert:G,delete:Y}}select(_){return new s0({fields:_??void 0,session:this.session,dialect:this.dialect})}selectDistinct(_){return new s0({fields:_??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(_){return new e6(_,this.session,this.dialect)}$cache;insert(_){return new t6(_,this.session,this.dialect)}delete(_){return new r6(_,this.session,this.dialect)}run(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new l2(async()=>this.session.run($),()=>$,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session));return this.session.run($)}all(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new l2(async()=>this.session.all($),()=>$,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session));return this.session.all($)}get(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new l2(async()=>this.session.get($),()=>$,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session));return this.session.get($)}values(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new l2(async()=>this.session.values($),()=>$,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session));return this.session.values($)}transaction(_,$){return this.session.transaction(_,$)}}class ZZ{static[K]="Cache"}class n_ extends ZZ{strategy(){return"all"}static[K]="NoopCache";async get(_){return}async put(_,$,X,Z){}async onMutate(_){}}async function i4(_,$){let X=`${_}-${JSON.stringify($)}`,J=new TextEncoder().encode(X),G=await crypto.subtle.digest("SHA-256",J);return[...new Uint8Array(G)].map((F)=>F.toString(16).padStart(2,"0")).join("")}class JZ extends M0{constructor(_){super();this.resultCb=_}static[K]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class n4{constructor(_,$,X,Z,J,G){if(this.mode=_,this.executeMethod=$,this.query=X,this.cache=Z,this.queryMetadata=J,this.cacheConfig=G,Z&&Z.strategy()==="all"&&G===void 0)this.cacheConfig={enable:!0,autoInvalidate:!0};if(!this.cacheConfig?.enable)this.cacheConfig=void 0}static[K]="PreparedQuery";joinsNotNullableMap;async queryWithCache(_,$,X){if(this.cache===void 0||V(this.cache,n_)||this.queryMetadata===void 0)try{return await X()}catch(Z){throw new K1(_,$,Z)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await X()}catch(Z){throw new K1(_,$,Z)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[Z]=await Promise.all([X(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return Z}catch(Z){throw new K1(_,$,Z)}if(!this.cacheConfig)try{return await X()}catch(Z){throw new K1(_,$,Z)}if(this.queryMetadata.type==="select"){let Z=await this.cache.get(this.cacheConfig.tag??await i4(_,$),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(Z===void 0){let J;try{J=await X()}catch(G){throw new K1(_,$,G)}return await this.cache.put(this.cacheConfig.tag??await i4(_,$),J,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),J}return Z}try{return await X()}catch(Z){throw new K1(_,$,Z)}}getQuery(){return this.query}mapRunResult(_,$){return _}mapAllResult(_,$){throw Error("Not implemented")}mapGetResult(_,$){throw Error("Not implemented")}execute(_){if(this.mode==="async")return this[this.executeMethod](_);return new JZ(()=>this[this.executeMethod](_))}mapResult(_,$){switch(this.executeMethod){case"run":return this.mapRunResult(_,$);case"all":return this.mapAllResult(_,$);case"get":return this.mapGetResult(_,$)}}}class o4{constructor(_){this.dialect=_}static[K]="SQLiteSession";prepareOneTimeQuery(_,$,X,Z,J,G,Y){return this.prepareQuery(_,$,X,Z,J,G,Y)}run(_){let $=this.dialect.sqlToQuery(_);try{return this.prepareOneTimeQuery($,void 0,"run",!1).run()}catch(X){throw new R2({cause:X,message:`Failed to run the query '${$.sql}'`})}}extractRawRunValueFromBatchResult(_){return _}all(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(_){throw Error("Not implemented")}get(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(_){throw Error("Not implemented")}values(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).values()}async count(_){return(await this.values(_))[0][0]}extractRawValuesValueFromBatchResult(_){throw Error("Not implemented")}}class s4 extends i_{constructor(_,$,X,Z,J=0){super(_,$,X,Z);this.schema=Z,this.nestedIndex=J}static[K]="SQLiteTransaction";rollback(){throw new l8}}class X8 extends o4{constructor(_,$,X,Z,J){super($);this.client=_,this.schema=X,this.options=Z,this.tx=J,this.logger=Z.logger??new n8,this.cache=Z.cache??new n_}static[K]="LibSQLSession";logger;cache;prepareQuery(_,$,X,Z,J,G,Y){return new YZ(this.client,_,this.logger,this.cache,G,Y,$,this.tx,X,Z,J)}async batch(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.batch(X)).map((J,G)=>$[G].mapResult(J,!0))}async migrate(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.migrate(X)).map((J,G)=>$[G].mapResult(J,!0))}async transaction(_,$){let X=await this.client.transaction(),Z=new X8(this.client,this.dialect,this.schema,this.options,X),J=new r4("async",this.dialect,Z,this.schema);try{let G=await _(J);return await X.commit(),G}catch(G){throw await X.rollback(),G}}extractRawAllValueFromBatchResult(_){return _.rows}extractRawGetValueFromBatchResult(_){return _.rows[0]}extractRawValuesValueFromBatchResult(_){return _.rows}}class r4 extends s4{static[K]="LibSQLTransaction";async transaction(_){let $=`sp${this.nestedIndex}`,X=new r4("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(U.raw(`savepoint ${$}`));try{let Z=await _(X);return await this.session.run(U.raw(`release savepoint ${$}`)),Z}catch(Z){throw await this.session.run(U.raw(`rollback to savepoint ${$}`)),Z}}}class YZ extends n4{constructor(_,$,X,Z,J,G,Y,z,F,H,W){super("async",F,$,Z,J,G);this.client=_,this.logger=X,this.fields=Y,this.tx=z,this._isResponseInArrayMode=H,this.customResultMapper=W,this.customResultMapper=W,this.fields=Y}static[K]="LibSQLPreparedQuery";async run(_){let $=F_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return this.tx?this.tx.execute(X):this.client.execute(X)})}async all(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let F=F_(Z.params,_??{});return X.logQuery(Z.sql,F),await this.queryWithCache(Z.sql,F,async()=>{let H={sql:Z.sql,args:F};return(J?J.execute(H):G.execute(H)).then(({rows:W})=>this.mapAllResult(W))})}let z=await this.values(_);return this.mapAllResult(z)}mapAllResult(_,$){if($)_=_.rows;if(!this.fields&&!this.customResultMapper)return _.map((X)=>GZ(X));if(this.customResultMapper)return this.customResultMapper(_,$8);return _.map((X)=>{return o8(this.fields,Array.prototype.slice.call(X).map((Z)=>$8(Z)),this.joinsNotNullableMap)})}async get(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let F=F_(Z.params,_??{});return X.logQuery(Z.sql,F),await this.queryWithCache(Z.sql,F,async()=>{let H={sql:Z.sql,args:F};return(J?J.execute(H):G.execute(H)).then(({rows:W})=>this.mapGetResult(W))})}let z=await this.values(_);return this.mapGetResult(z)}mapGetResult(_,$){if($)_=_.rows;let X=_[0];if(!this.fields&&!this.customResultMapper)return GZ(X);if(!X)return;if(this.customResultMapper)return this.customResultMapper(_,$8);return o8(this.fields,Array.prototype.slice.call(X).map((Z)=>$8(Z)),this.joinsNotNullableMap)}async values(_){let $=F_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return(this.tx?this.tx.execute(X):this.client.execute(X)).then(({rows:Z})=>Z)})}isResponseInArrayMode(){return this._isResponseInArrayMode}}function GZ(_){return Object.keys(_).reduce(($,X)=>{if(Object.prototype.propertyIsEnumerable.call(_,X))$[X]=_[X];return $},{})}function $8(_){if(typeof ArrayBuffer<"u"&&_ instanceof ArrayBuffer){if(typeof Buffer<"u"){if(!(_ instanceof Buffer))return Buffer.from(_);return _}if(typeof TextDecoder<"u")return new TextDecoder().decode(_);throw Error("TextDecoder is not available. Please provide either Buffer or TextDecoder polyfill.")}return _}class zZ extends i_{static[K]="LibSQLDatabase";async batch(_){return this.session.batch(_)}}function i2(_,$={}){let X=new p4({casing:$.casing}),Z;if($.logger===!0)Z=new i8;else if($.logger!==!1)Z=$.logger;let J;if($.schema){let z=O7($.schema,V7);J={fullSchema:$.schema,schema:z.tables,tableNamesMap:z.tableNamesMap}}let G=new X8(_,X,J,{logger:Z,cache:$.cache},void 0),Y=new zZ("async",X,G,J);if(Y.$client=_,Y.$cache=$.cache,Y.$cache)Y.$cache.invalidate=$.cache?.onMutate;return Y}function n2(..._){if(typeof _[0]==="string"){let $=b1({url:_[0]});return i2($,_[1])}if(c3(_[0])){let{connection:$,client:X,...Z}=_[0];if(X)return i2(X,Z);let J=typeof $==="string"?b1({url:$}):b1($);return i2(J,Z)}return i2(_[0],_[1])}((_)=>{function $(X){return i2({},X)}_.mock=$})(n2||(n2={}));class s_{client;db;dbName;constructor(_,$){this.dbName=_;try{let X=o_.join(process.cwd(),".sylphx-flow");if(!Z8.existsSync(X))Z8.mkdirSync(X,{recursive:!0});let Z=o_.join(X,`${_}.db`);this.client=b1({url:`file:${Z}`}),this.db=n2(this.client,{schema:$})}catch(X){throw new O_(`Failed to initialize ${_} database connection`,{url:`file:${o_.join(process.cwd(),".sylphx-flow",`${_}.db`)}`},X)}}async close(){}getDatabasePath(){return o_.join(process.cwd(),".sylphx-flow",`${this.dbName}.db`)}async createTable(_){try{await this.client.execute(_)}catch($){throw new X0(`Failed to create table for ${this.dbName}`,`${this.dbName}.createTable`,$)}}async createIndex(_){try{await this.client.execute(_)}catch($){throw new X0(`Failed to create index for ${this.dbName}`,`${this.dbName}.createIndex`,$)}}async tableExists(_){try{return(await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name='${_}'
      `)).rows.length>0}catch($){throw new X0(`Failed to check if table ${_} exists`,`${this.dbName}.tableExists`,$)}}}var a4={};Y6(a4,{tfidfTerms:()=>m0,tfidfIdf:()=>H1,tfidfDocuments:()=>F1,codebaseMetadata:()=>q0,codebaseFiles:()=>O0});var O0=B0("codebase_files_table",{path:x("path").primaryKey(),mtime:x0("mtime").notNull(),hash:x("hash").notNull(),content:x("content"),language:x("language"),size:x0("size"),indexedAt:x("indexed_at").notNull()},(_)=>[D0("idx_codebase_files_mtime").on(_.mtime),D0("idx_codebase_files_hash").on(_.hash)]),q0=B0("codebase_metadata_table",{key:x("key").primaryKey(),value:x("value").notNull()}),m0=B0("tfidf_terms_table",{filePath:x("file_path").notNull().references(()=>O0.path,{onDelete:"cascade"}),term:x("term").notNull(),frequency:z1("frequency").notNull()},(_)=>[d2({columns:[_.filePath,_.term]}),D0("idx_tfidf_terms_term").on(_.term),D0("idx_tfidf_terms_file").on(_.filePath)]),F1=B0("tfidf_documents_table",{filePath:x("file_path").primaryKey().references(()=>O0.path,{onDelete:"cascade"}),magnitude:z1("magnitude").notNull(),termCount:x0("term_count").notNull(),rawTerms:x("raw_terms").notNull()}),H1=B0("tfidf_idf_table",{term:x("term").primaryKey(),idfValue:z1("idf_value").notNull()});class e4 extends s_{constructor(){super("cache",a4)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Cache database tables already exist");return}await this.createTables(),console.error("[INFO] Cache database tables created")}catch(_){throw new X0("Failed to initialize cache database","cache.initialize",_)}}async createTables(){await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_files_table (
        path TEXT PRIMARY KEY,
        mtime INTEGER NOT NULL,
        hash TEXT NOT NULL,
        content TEXT,
        language TEXT,
        size INTEGER,
        indexed_at TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_metadata_table (
        key TEXT PRIMARY KEY,
        value TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_documents_table (
        file_path TEXT PRIMARY KEY,
        magnitude REAL NOT NULL,
        term_count INTEGER NOT NULL,
        raw_terms TEXT NOT NULL,
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_idf_table (
        term TEXT PRIMARY KEY,
        idf_value REAL NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_terms_table (
        file_path TEXT NOT NULL,
        term TEXT NOT NULL,
        frequency REAL NOT NULL,
        PRIMARY KEY (file_path, term),
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_mtime ON codebase_files_table (mtime)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_hash ON codebase_files_table (hash)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_term ON tfidf_terms_table (term)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_file ON tfidf_terms_table (file_path)
    `)}async getMigrationStatus(){try{let _=["codebase_files_table","tfidf_terms_table","tfidf_documents_table"],$=0;for(let X of _)if(await this.tableExists(X))$++;return{isMigrated:$>=2,migrationCount:$}}catch(_){throw new X0("Failed to check cache database migration status","cache.getMigrationStatus",_)}}async clearCache(){try{await this.client.execute("DELETE FROM tfidf_terms_table"),await this.client.execute("DELETE FROM tfidf_documents_table"),await this.client.execute("DELETE FROM tfidf_idf_table"),await this.client.execute("DELETE FROM codebase_files_table"),await this.client.execute("DELETE FROM codebase_metadata_table"),console.error("[INFO] Cache database cleared")}catch(_){throw new X0("Failed to clear cache database","cache.clearCache",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM codebase_files_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,cachedFiles:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=t4.join(process.cwd(),".sylphx-flow");return t4.join(_,"cache.db")}}class _5{cacheDb;cache;constructor(){this.cacheDb=new e4,this.cache=this.cacheDb.db}async initialize(){await this.cacheDb.initialize()}async setCodebaseFile(_){return c(`set codebase file: ${_.path}`,async()=>{await this.cache.insert(O0).values(_).onConflictDoUpdate({target:O0.path,set:{mtime:_.mtime,hash:_.hash,content:_.content,language:_.language,size:_.size,indexedAt:_.indexedAt}})})}async getCodebaseFile(_){return c(`get codebase file: ${_}`,async()=>{let $=await this.cache.select().from(O0).where(j(O0.path,_)).limit(1);if($.length===0)return null;let X=$[0];return{path:X.path,mtime:X.mtime,hash:X.hash,content:X.content||void 0,language:X.language||void 0,size:X.size||void 0,indexedAt:X.indexedAt}})}async getAllCodebaseFiles(){return c("get all codebase files",async()=>{return(await this.cache.select().from(O0).orderBy(f0(O0.mtime))).map(($)=>({path:$.path,mtime:$.mtime,hash:$.hash,content:$.content||void 0,language:$.language||void 0,size:$.size||void 0,indexedAt:$.indexedAt}))})}async deleteCodebaseFile(_){return c(`delete codebase file: ${_}`,async()=>{let $=await this.cache.delete(O0).where(j(O0.path,_));return(await this.cache.select().from(O0).where(j(O0.path,_)).limit(1)).length===0})}async clearCodebaseFiles(){return c("clear codebase files",async()=>{await this.cache.delete(O0)})}async setMetadata(_,$){return c(`set metadata: ${_}`,async()=>{await this.cache.insert(q0).values({key:_,value:$}).onConflictDoUpdate({target:q0.key,set:{value:$}})})}async getMetadata(_){return c(`get metadata: ${_}`,async()=>{let $=await this.cache.select().from(q0).where(j(q0.key,_)).limit(1);return $.length>0?$[0].value:null})}async getAllMetadata(){return c("get all metadata",async()=>{let _=await this.cache.select().from(q0),$={};for(let X of _)$[X.key]=X.value;return $})}async deleteMetadata(_){return c(`delete metadata: ${_}`,async()=>{let $=await this.cache.delete(q0).where(j(q0.key,_));return(await this.cache.select().from(q0).where(j(q0.key,_)).limit(1)).length===0})}async setTfidfTerms(_){return c("set TF-IDF terms",async()=>{let $=[...new Set(_.map((X)=>X.filePath))];for(let X of $)await this.cache.delete(m0).where(j(m0.filePath,X));if(_.length>0)await this.cache.insert(m0).values(_)})}async getTfidfTerms(_){return c(`get TF-IDF terms for file: ${_}`,async()=>{return(await this.cache.select().from(m0).where(j(m0.filePath,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async getTfidfTermsByTerm(_){return c(`get TF-IDF terms by term: ${_}`,async()=>{return(await this.cache.select().from(m0).where(j(m0.term,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async clearTfidfTerms(){return c("clear TF-IDF terms",async()=>{await this.cache.delete(m0)})}async setTfidfDocument(_){return c(`set TF-IDF document: ${_.filePath}`,async()=>{await this.cache.insert(F1).values(_).onConflictDoUpdate({target:F1.filePath,set:{magnitude:_.magnitude,termCount:_.termCount,rawTerms:_.rawTerms}})})}async getTfidfDocument(_){return c(`get TF-IDF document: ${_}`,async()=>{let $=await this.cache.select().from(F1).where(j(F1.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{filePath:X.filePath,magnitude:X.magnitude,termCount:X.termCount,rawTerms:X.rawTerms}})}async getAllTfidfDocuments(){return c("get all TF-IDF documents",async()=>{return(await this.cache.select().from(F1)).map(($)=>({filePath:$.filePath,magnitude:$.magnitude,termCount:$.termCount,rawTerms:$.rawTerms}))})}async clearTfidfDocuments(){return c("clear TF-IDF documents",async()=>{await this.cache.delete(F1)})}async setTfidfIdf(_){return c(`set TF-IDF IDF: ${_.term}`,async()=>{await this.cache.insert(H1).values(_).onConflictDoUpdate({target:H1.term,set:{idfValue:_.idfValue}})})}async getTfidfIdf(_){return c(`get TF-IDF IDF: ${_}`,async()=>{let $=await this.cache.select().from(H1).where(j(H1.term,_)).limit(1);if($.length===0)return null;let X=$[0];return{term:X.term,idfValue:X.idfValue}})}async getAllTfidfIdf(){return c("get all TF-IDF IDF values",async()=>{return(await this.cache.select().from(H1)).map(($)=>({term:$.term,idfValue:$.idfValue}))})}async clearTfidfIdf(){return c("clear TF-IDF IDF values",async()=>{await this.cache.delete(H1)})}async getStats(){return c("get cache statistics",async()=>{let[_,$,X,Z,J]=await Promise.all([this.cache.select({count:c0()}).from(O0),this.cache.select({count:c0()}).from(q0),this.cache.select({count:c0()}).from(m0),this.cache.select({count:c0()}).from(F1),this.cache.select({count:c0()}).from(H1)]);return{codebaseFiles:_[0]?.count||0,metadataEntries:$[0]?.count||0,tfidfTerms:X[0]?.count||0,tfidfDocuments:Z[0]?.count||0,tfidfIdfValues:J[0]?.count||0}})}async clearAll(){return c("clear all cache data",async()=>{await Promise.all([this.cache.delete(O0),this.cache.delete(q0),this.cache.delete(m0),this.cache.delete(F1),this.cache.delete(H1)])})}}import*as J8 from"node:path";var $5={};Y6($5,{memory:()=>v});var v=B0("memory_table",{key:x("key").notNull(),namespace:x("namespace").notNull().default("default"),value:x("value").notNull(),timestamp:x0("timestamp").notNull(),created_at:x("created_at").notNull(),updated_at:x("updated_at").notNull()},(_)=>[d2({columns:[_.key,_.namespace]}),D0("idx_memory_namespace").on(_.namespace),D0("idx_memory_timestamp").on(_.timestamp),D0("idx_memory_key").on(_.key)]);class X5 extends s_{constructor(){super("memory",$5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Memory database tables already exist");return}let $=J8.join(process.cwd(),"drizzle","memory");await this.createTables(),console.error("[INFO] Memory database tables created")}catch(_){throw new X0("Failed to initialize memory database","memory.initialize",_)}}async createTables(){await this.createTable(`
        CREATE TABLE IF NOT EXISTS memory_table (
          key TEXT NOT NULL,
          namespace TEXT NOT NULL DEFAULT 'default',
          value TEXT NOT NULL,
          timestamp INTEGER NOT NULL,
          created_at TEXT NOT NULL,
          updated_at TEXT NOT NULL,
          PRIMARY KEY (key, namespace)
        )
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_namespace ON memory_table (namespace)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_timestamp ON memory_table (timestamp)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_key ON memory_table (key)
      `)}async getMigrationStatus(){try{let _=await this.tableExists("memory_table");return{isMigrated:_,migrationCount:_?1:0}}catch(_){throw new X0("Failed to check memory database migration status","memory.getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=J8.join(process.cwd(),".sylphx-flow");return J8.join(_,"memory.db")}}class Z5{memoryDb;memory;constructor(){this.memoryDb=new X5,this.memory=this.memoryDb.db}async initialize(){await this.memoryDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch($){throw Error(`Failed to deserialize value: ${$.message}`)}}async set(_,$,X="default"){let Z=`Failed to set memory entry: ${X}:${_}`;try{let J=new Date().toISOString(),G=Date.now(),Y=this.safeSerialize($);if((await this.memory.select().from(v).where(A0(j(v.key,_),j(v.namespace,X))).limit(1)).length>0)await this.memory.update(v).set({value:Y,timestamp:G,updated_at:J}).where(A0(j(v.key,_),j(v.namespace,X)));else await this.memory.insert(v).values({key:_,namespace:X,value:Y,timestamp:G,created_at:J,updated_at:J})}catch(J){throw Error(`${Z}: ${J.message}`)}}async get(_,$="default"){let X=`Failed to get memory entry: ${$}:${_}`;try{let Z=await this.memory.select().from(v).where(A0(j(v.key,_),j(v.namespace,$))).limit(1);if(Z.length===0)return null;let J=Z[0];return{key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}}catch(Z){throw Error(`${X}: ${Z.message}`)}}async getAll(_){try{let X=this.memory.select().from(v);if(_&&_!=="all")X=X.where(j(v.namespace,_));return(await X.orderBy(f0(v.timestamp))).map((J)=>({key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}))}catch(X){throw Error(`Failed to get all memory entries: ${X.message}`)}}async search(_,$){let X=`Failed to search memory entries: ${_}`;try{let Z=this.memory.select().from(v).where(K_($1(v.key,`%${_}%`),$1(v.value,`%${_}%`)));if($&&$!=="all")Z=Z.where(A0(j(v.namespace,$),K_($1(v.key,`%${_}%`),$1(v.value,`%${_}%`))));return(await Z.orderBy(f0(v.timestamp))).map((G)=>({key:G.key,namespace:G.namespace,value:this.safeDeserialize(G.value),timestamp:G.timestamp,created_at:G.created_at,updated_at:G.updated_at}))}catch(Z){throw Error(`${X}: ${Z.message}`)}}async delete(_,$="default"){let X=`Failed to delete memory entry: ${$}:${_}`;try{let Z=await this.memory.delete(v).where(A0(j(v.key,_),j(v.namespace,$)));return(await this.memory.select().from(v).where(A0(j(v.key,_),j(v.namespace,$))).limit(1)).length===0}catch(Z){throw Error(`${X}: ${Z.message}`)}}async clear(_="default"){let $=`Failed to clear memory namespace: ${_}`;try{await this.memory.delete(v).where(j(v.namespace,_))}catch(X){throw Error(`${$}: ${X.message}`)}}async getStats(_){try{let X=this.memory.select({count:c0()}).from(v);if(_&&_!=="all")X=X.where(j(v.namespace,_));let J=(await X)[0]?.count||0,Y=(await this.memory.selectDistinct({namespace:v.namespace}).from(v)).map((z)=>z.namespace);return{totalEntries:J,namespaces:Y}}catch(X){throw Error(`Failed to get memory statistics: ${X.message}`)}}}class C0{memoryStorage;cacheStorage;constructor(){this.memoryStorage=new Z5,this.cacheStorage=new _5}async initialize(){await Promise.all([this.memoryStorage.initialize(),this.cacheStorage.initialize()])}async set(_,$,X="default"){return this.memoryStorage.set(_,$,X)}async get(_,$="default"){return this.memoryStorage.get(_,$)}async getAll(_){return this.memoryStorage.getAll(_)}async search(_,$){return this.memoryStorage.search(_,$)}async delete(_,$="default"){return this.memoryStorage.delete(_,$)}async clear(_="default"){return this.memoryStorage.clear(_)}async getStats(_){return this.memoryStorage.getStats(_)}async setCodebaseFile(_,$,X,Z,J,G){let Y=new Date().toISOString();return this.cacheStorage.setCodebaseFile({path:_,mtime:$,hash:X,content:Z,language:J,size:G,indexedAt:Y})}async getCodebaseFile(_){return this.cacheStorage.getCodebaseFile(_)}async getAllCodebaseFiles(){return this.cacheStorage.getAllCodebaseFiles()}async deleteCodebaseFile(_){return this.cacheStorage.deleteCodebaseFile(_)}async clearCodebaseFiles(){return this.cacheStorage.clearCodebaseFiles()}async setMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async getMetadata(_){return this.cacheStorage.getMetadata(_)}async getAllMetadata(){return this.cacheStorage.getAllMetadata()}async deleteMetadata(_){return this.cacheStorage.deleteMetadata(_)}async setTfidfTerms(_){return this.cacheStorage.setTfidfTerms(_)}async getTfidfTerms(_){return this.cacheStorage.getTfidfTerms(_)}async getTfidfTermsByTerm(_){return this.cacheStorage.getTfidfTermsByTerm(_)}async clearTfidfTerms(){return this.cacheStorage.clearTfidfTerms()}async setTfidfDocument(_,$,X,Z){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$,termCount:X,rawTerms:Z})}async getTFIDFDocument(_){return this.cacheStorage.getTfidfDocument(_)}async getAllTfidfDocuments(){return this.cacheStorage.getAllTfidfDocuments()}async clearTfidfDocuments(){return this.cacheStorage.clearTfidfDocuments()}async setTfidfIdf(_,$){return this.cacheStorage.setTfidfIdf({term:_,idfValue:$})}async getTfidfIdf(_){return this.cacheStorage.getTfidfIdf(_)}async getAllTfidfIdf(){return this.cacheStorage.getAllTfidfIdf()}async clearTfidfIdf(){return this.cacheStorage.clearTfidfIdf()}async getCacheStats(){return this.cacheStorage.getStats()}async clearAllCache(){return this.cacheStorage.clearAll()}async getAllStats(){let[_,$]=await Promise.all([this.memoryStorage.getStats(),this.cacheStorage.getStats()]);return{memory:_,cache:$}}async clearAll(){await Promise.all([this.memoryStorage.clear("default"),this.cacheStorage.clearAll()])}async getCodebaseIndexStats(){let _=await this.cacheStorage.getAllMetadata();return{indexedAt:_.indexedAt,totalFiles:Number.parseInt(_.totalFiles||"0"),totalTerms:Number.parseInt(_.totalTerms||"0")}}async getIDFValues(){return this.cacheStorage.getAllTfidfIdf()}async upsertTFIDFDocument(_,$){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:JSON.stringify($.rawTerms)})}async upsertCodebaseFile(_){return this.cacheStorage.setCodebaseFile({..._,indexedAt:_.indexedAt||new Date().toISOString()})}async setIDFValues(_){let $=Object.entries(_).map(([X,Z])=>this.cacheStorage.setTfidfIdf({term:X,idfValue:Z}));await Promise.all($)}async clearCodebaseIndex(){await Promise.all([this.cacheStorage.clearCodebaseFiles(),this.cacheStorage.clearTfidfTerms(),this.cacheStorage.clearTfidfDocuments(),this.cacheStorage.clearTfidfIdf()])}async getCodebaseMetadata(_){return this.cacheStorage.getMetadata(_)}async setCodebaseMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async setTFIDFTerms(_,$){let X=Object.entries($).map(([Z,J])=>({filePath:_,term:Z,frequency:J}));return this.cacheStorage.setTfidfTerms(X)}}class FZ{static step1aRules=[{pattern:/sses$/i,replacement:"ss"},{pattern:/ies$/i,replacement:"i"},{pattern:/ss$/i,replacement:"ss"},{pattern:/s$/i,replacement:""}];static step1bRules=[{pattern:/eed$/i,replacement:"ee"},{pattern:/ed$/i,replacement:""},{pattern:/ing$/i,replacement:""}];static step1cRules=[{pattern:/y$/i,replacement:"i"}];static step2Rules=[{pattern:/ational$/i,replacement:"ate"},{pattern:/tional$/i,replacement:"tion"},{pattern:/enci$/i,replacement:"ence"},{pattern:/anci$/i,replacement:"ance"},{pattern:/izer$/i,replacement:"ize"},{pattern:/abli$/i,replacement:"able"},{pattern:/alli$/i,replacement:"al"},{pattern:/entli$/i,replacement:"ent"},{pattern:/eli$/i,replacement:"e"},{pattern:/ousli$/i,replacement:"ous"},{pattern:/ization$/i,replacement:"ize"},{pattern:/ation$/i,replacement:"ate"},{pattern:/ator$/i,replacement:"ate"},{pattern:/alism$/i,replacement:"al"},{pattern:/iveness$/i,replacement:"ive"},{pattern:/fulness$/i,replacement:"ful"},{pattern:/ousness$/i,replacement:"ous"},{pattern:/aliti$/i,replacement:"al"},{pattern:/iviti$/i,replacement:"ive"},{pattern:/biliti$/i,replacement:"ble"}];static step3Rules=[{pattern:/icate$/i,replacement:"ic"},{pattern:/ative$/i,replacement:""},{pattern:/alize$/i,replacement:"al"},{pattern:/iciti$/i,replacement:"ic"},{pattern:/ical$/i,replacement:"ic"},{pattern:/ful$/i,replacement:""},{pattern:/ness$/i,replacement:""}];static step4Rules=[{pattern:/al$/i,replacement:""},{pattern:/ance$/i,replacement:""},{pattern:/ence$/i,replacement:""},{pattern:/er$/i,replacement:""},{pattern:/ic$/i,replacement:""},{pattern:/able$/i,replacement:""},{pattern:/ible$/i,replacement:""},{pattern:/ant$/i,replacement:""},{pattern:/ement$/i,replacement:""},{pattern:/ment$/i,replacement:""},{pattern:/ent$/i,replacement:""},{pattern:/ion$/i,replacement:""},{pattern:/ou$/i,replacement:""},{pattern:/ism$/i,replacement:""},{pattern:/ate$/i,replacement:""},{pattern:/iti$/i,replacement:""},{pattern:/ous$/i,replacement:""},{pattern:/ive$/i,replacement:""},{pattern:/ize$/i,replacement:""}];static step5Rules=[{pattern:/e$/i,replacement:""},{pattern:/ll$/i,replacement:"l"}];static stem(_){if(_.length<3)return _.toLowerCase();let $=_.toLowerCase();for(let X of this.step1aRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1bRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1cRules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step2Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step3Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step4Rules)if(X.pattern.test($)&&$.length>3){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step5Rules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}return $}}function J5(_){return _.replace(/```[\s\S]*?```/g," ").replace(/`[^`]+`/g," ").replace(/#{1,6}\s/g,"").replace(/[*_~]/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").toLowerCase().split(/[^a-z0-9_-]+/).filter((Z)=>Z.length>1)}function G5(_){let $=J5(_),X=new Map;for(let Z of $){let J=FZ.stem(Z);X.set(J,(X.get(J)||0)+1)}return X}var WW=new Set(["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","will","with","this","but","they","have","had","what","when","where","who","which","why","how"]);function HZ(_){return _.filter(($)=>!WW.has($.toLowerCase()))}function WZ(_){let $=Array.from(_.values()).reduce((Z,J)=>Z+J,0),X=new Map;for(let[Z,J]of _.entries())X.set(Z,J/$);return X}function UW(_,$){let X=new Map;for(let J of _){let G=new Set(J.keys());for(let Y of G)X.set(Y,(X.get(Y)||0)+1)}let Z=new Map;for(let[J,G]of X.entries())Z.set(J,Math.log($/G));return Z}function UZ(_,$){let X=new Map;for(let[Z,J]of _.entries()){let G=$.get(Z)||0;X.set(Z,J*G)}return X}function AZ(_){let $=0;for(let X of _.values())$+=X*X;return Math.sqrt($)}function G8(_){let $=_.map((J)=>({uri:J.uri,terms:G5(J.content)})),X=UW($.map((J)=>J.terms),_.length);return{documents:$.map((J)=>{let G=WZ(J.terms),Y=UZ(G,X),z=AZ(Y);return{uri:J.uri,terms:Y,rawTerms:J.terms,magnitude:z}}),idf:X,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}function AW(_,$){let X=0;for(let[J,G]of _.entries()){let Y=$.terms.get(J)||0;X+=G*Y}let Z=AZ(_);if(Z===0||$.magnitude===0)return 0;return X/(Z*$.magnitude)}function KW(_,$){let X=G5(_),Z=WZ(X);return UZ(Z,$)}function Y5(_,$,X={}){let{limit:Z=10,minScore:J=0,boostFactors:G={}}=X,{exactMatch:Y=1.5,phraseMatch:z=2}=G,F=KW(_,$.idf),H=HZ(J5(_));return $.documents.map((A)=>{let D=AW(F,A),O=[];for(let R of H)if(A.rawTerms.has(R))D*=Y,O.push(R);if(O.length===H.length&&H.length>1)D*=z;return{uri:A.uri,score:D,matchedTerms:O}}).filter((A)=>A.score>=J).sort((A,D)=>D.score-A.score).slice(0,Z)}function DW(_){let $=W1.extname(_).toLowerCase();return{".ts":"TypeScript",".tsx":"TSX",".js":"JavaScript",".jsx":"JSX",".py":"Python",".java":"Java",".go":"Go",".rs":"Rust",".c":"C",".cpp":"C++",".cs":"C#",".rb":"Ruby",".php":"PHP",".swift":"Swift",".kt":"Kotlin",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".sql":"SQL",".sh":"Shell",".bash":"Bash"}[$]}function OW(_){let $=new Set([".ts",".tsx",".js",".jsx",".py",".java",".go",".rs",".c",".cpp",".h",".hpp",".cs",".rb",".php",".swift",".kt",".md",".txt",".json",".yaml",".yml",".toml",".xml",".html",".css",".scss",".sass",".less",".sql",".sh",".bash",".env",".gitignore",".dockerignore"]),X=W1.extname(_).toLowerCase();return $.has(X)||!X}function RW(_){let $=KZ.default();$.add(["node_modules/",".git/","dist/","build/",".next/",".cache/","coverage/","*.log",".DS_Store","Thumbs.db"]);let X=W1.join(_,".gitignore");if(I1.existsSync(X)){let Z=I1.readFileSync(X,"utf8");$.add(Z)}return $}function VW(_,$,X,Z={}){let{maxFileSize:J=1048576,maxFiles:G=50000}=Z,Y=[];function z(F){if(Y.length>=G)return;let H=I1.readdirSync(F,{withFileTypes:!0});for(let W of H){if(Y.length>=G)break;let A=W1.join(F,W.name),D=W1.relative($,A);if(X.ignores(D))continue;if(W.isDirectory())z(A);else if(W.isFile()&&OW(W.name))try{let O=I1.statSync(A);if(O.size>J){console.warn(`[WARN] Skipping large file: ${D} (${O.size} bytes)`);continue}let R=I1.readFileSync(A,"utf8"),N=DW(W.name);Y.push({path:D,absolutePath:A,content:R,language:N,size:O.size,mtime:O.mtimeMs})}catch(O){console.warn(`[WARN] Failed to read file: ${D}`,O)}}}return z(_),Y}function NW(_){let $=0;for(let X=0;X<_.length;X++){let Z=_.charCodeAt(X);$=($<<5)-$+Z,$=$&$}return $.toString(36)}class z5{codebaseRoot;cacheDir;cache=null;ig;db;options;constructor(_={}){this.options={batchSize:100,..._},this.codebaseRoot=_.codebaseRoot||process.cwd(),this.cacheDir=_.cacheDir||W1.join(this.codebaseRoot,".sylphx-flow","cache"),this.ig=RW(this.codebaseRoot),this.db=new C0}async buildTFIDFIndexFromDB(){try{let _=[],$=await this.db.getAllCodebaseFiles();for(let J of $){let G=await this.db.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,F=new Map;for(let[H,W]of Object.entries(Y))z.set(H,W),F.set(H,W);_.push({uri:`file://${J.path}`,terms:z,rawTerms:F,magnitude:G.magnitude})}}let X=await this.db.getIDFValues(),Z=new Map;for(let[J,G]of Object.entries(X))Z.set(J,G);if(_.length===0)return;return{documents:_,idf:Z,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch(_){console.error("[ERROR] Failed to build TF-IDF index from database:",_);return}}async loadCache(){try{await this.db.initialize();let _=await this.db.getCodebaseMetadata("version"),$=await this.db.getCodebaseMetadata("codebaseRoot"),X=await this.db.getCodebaseMetadata("indexedAt"),Z=await this.db.getCodebaseMetadata("fileCount");if(!_||!$||!X||!Z)return null;let J=await this.db.getAllCodebaseFiles(),G=new Map;for(let F of J)G.set(F.path,{mtime:F.mtime,hash:F.hash});let Y=await this.buildTFIDFIndexFromDB(),z=await this.db.getCodebaseMetadata("vectorIndexPath");return{version:_,codebaseRoot:$,indexedAt:X,fileCount:Number.parseInt(Z),files:G,tfidfIndex:Y,vectorIndexPath:z}}catch(_){return console.error("[ERROR] Failed to load cache from database:",_),null}}async saveCache(_){try{if(await this.db.initialize(),await this.db.setCodebaseMetadata("version",_.version),await this.db.setCodebaseMetadata("codebaseRoot",_.codebaseRoot),await this.db.setCodebaseMetadata("indexedAt",_.indexedAt),await this.db.setCodebaseMetadata("fileCount",_.fileCount.toString()),_.vectorIndexPath)await this.db.setCodebaseMetadata("vectorIndexPath",_.vectorIndexPath);for(let[$,X]of _.files.entries())await this.db.upsertCodebaseFile({path:$,mtime:X.mtime,hash:X.hash});if(_.tfidfIndex){for(let X of _.tfidfIndex.documents){let Z=X.uri.replace("file://",""),J={};for(let[Y,z]of X.rawTerms.entries())J[Y]=z;await this.db.upsertTFIDFDocument(Z,{magnitude:X.magnitude,termCount:X.terms.size,rawTerms:J});let G={};for(let[Y,z]of X.terms.entries())G[Y]=z;await this.db.setTFIDFTerms(Z,G)}let $={};for(let[X,Z]of _.tfidfIndex.idf.entries())$[X]=Z;await this.db.setIDFValues($)}console.error("[INFO] Cache saved to database")}catch($){throw console.error("[ERROR] Failed to save cache to database:",$),$}}async indexCodebase(_={}){let{force:$=!1}=_,{embeddingProvider:X}=_;this.cache=await this.loadCache(),console.error("[INFO] Scanning codebase...");let Z=VW(this.codebaseRoot,this.codebaseRoot,this.ig);if(console.error(`[INFO] Found ${Z.length} files`),this.cache&&!$){let O=Math.abs(Z.length-this.cache.fileCount)/this.cache.fileCount*100;if(O>20)console.error(`[WARN] File count changed significantly (${O.toFixed(1)}%), forcing full reindex`),$=!0,this.cache=null}let J=[],G=[],Y=new Map;for(let D of Z){let O=NW(D.content);Y.set(D.path,{mtime:D.mtime,hash:O});let R=this.cache?.files.get(D.path);if($||!R||R.hash!==O)J.push(D)}if(this.cache?.files){for(let D of this.cache.files.keys())if(!Y.has(D))G.push(D)}let z=J.length>0||G.length>0;if(!$&&!z&&this.cache?.tfidfIndex)return console.error("[INFO] Cache hit! Using cached index"),{tfidfIndex:this.cache.tfidfIndex,stats:{totalFiles:Z.length,indexedFiles:0,skippedFiles:Z.length,cacheHit:!0}};if(J.length>0)console.error(`[INFO] Changed files: ${J.length}`);if(G.length>0)console.error(`[INFO] Deleted files: ${G.length}`);console.error(`[INFO] Indexing ${J.length} changed files...`);let H=Z.map((D)=>({uri:`file://${D.path}`,content:D.content})),W=G8(H),A;if(X){console.error("[INFO] Generating embeddings...");let D=W1.join(this.cacheDir,"codebase-vectors.hnsw");A=new Y8(D,X.dimensions);let O=10;for(let R=0;R<Z.length;R+=O){let N=Z.slice(R,R+O),I=N.map((k)=>k.content),y=await X.generateEmbeddings(I);for(let k=0;k<N.length;k++){let C=N[k],Y0=y[k],_0={id:`file://${C.path}`,embedding:Y0,metadata:{type:"code",language:C.language||"",content:C.content.slice(0,500),category:""}};A.addDocument(_0)}console.error(`[INFO] Embedded ${Math.min(R+O,Z.length)}/${Z.length} files`)}A.save()}return this.cache={version:"1.0.0",codebaseRoot:this.codebaseRoot,indexedAt:new Date().toISOString(),fileCount:Z.length,files:Y,tfidfIndex:W,vectorIndexPath:A?W1.join(this.cacheDir,"codebase-vectors.hnsw"):void 0},await this.saveCache(this.cache),{tfidfIndex:W,vectorStorage:A,stats:{totalFiles:Z.length,indexedFiles:J.length,skippedFiles:Z.length-J.length,cacheHit:!1}}}async getCacheStats(){try{await this.db.initialize();let _=await this.db.getCodebaseIndexStats();return{exists:_.fileCount>0,fileCount:_.fileCount,indexedAt:_.indexedAt}}catch(_){return console.error("[ERROR] Failed to get cache stats:",_),{exists:!1,fileCount:0}}}async clearCache(){try{await this.db.initialize(),await this.db.clearCodebaseIndex();let _=W1.join(this.cacheDir,"codebase-index.json");if(I1.existsSync(_))I1.unlinkSync(_);let $=W1.join(this.cacheDir,"codebase-vectors.hnsw");if(I1.existsSync($))I1.unlinkSync($);console.error("[INFO] Cache cleared from database and files")}catch(_){console.error("[ERROR] Failed to clear cache:",_)}}}import H5 from"node:fs";import W5 from"node:path";class F5{config;cachedIndex=null;indexingPromise=null;status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0};constructor(_){this.config=_}getStatus(){return{...this.status}}isReady(){return this.cachedIndex!==null&&!this.status.isIndexing}startBackgroundIndexing(){if(this.status.isIndexing||this.cachedIndex)return;console.error(`[INFO] Starting background ${this.config.name} indexing...`),this.loadIndex().catch((_)=>{console.error(`[ERROR] Background ${this.config.name} indexing failed:`,_)})}async loadIndex(){if(this.cachedIndex)return this.cachedIndex;if(this.indexingPromise)return this.indexingPromise;return this.status.isIndexing=!0,this.status.progress=0,this.status.startTime=Date.now(),this.status.error=void 0,this.indexingPromise=this.buildIndex().then((_)=>{return this.cachedIndex=_,this.status.isIndexing=!1,this.status.progress=100,this.status.totalItems=_.totalDocuments,this.status.indexedItems=_.totalDocuments,console.error(`[INFO] ${this.config.name} indexing complete: ${_.totalDocuments} documents`),_}).catch((_)=>{throw this.status.isIndexing=!1,this.status.error=_ instanceof Error?_.message:String(_),console.error(`[ERROR] ${this.config.name} indexing failed:`,_),_}),this.indexingPromise}clearCache(){this.cachedIndex=null,this.indexingPromise=null,this.status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0}}async getStats(){let _=await this.loadIndex();if(!_)return null;return{totalDocuments:_.totalDocuments,uniqueTerms:_.idf.size,generatedAt:_.metadata.generatedAt,version:_.metadata.version}}}class DZ extends F5{embeddingProvider;vectorStorage;constructor(_){super({name:"knowledge",autoStart:!0});this.embeddingProvider=_}scanKnowledgeFiles(_){let $=[],X=(Z,J)=>{let G=H5.readdirSync(Z,{withFileTypes:!0});for(let Y of G){let z=W5.join(Z,Y.name);if(Y.isDirectory())X(z,J);else if(Y.isFile()&&Y.name.endsWith(".md")){let H=W5.relative(J,z).replace(/\.md$/,"").replace(/\\/g,"/"),W=H5.readFileSync(z,"utf8");$.push({uri:`knowledge://${H}`,content:W})}}};return X(_,_),$}async buildIndex(){let _=A5();if(!H5.existsSync(_))throw Error(`Knowledge directory not found: ${_}`);let $=this.scanKnowledgeFiles(_);console.error(`[INFO] Found ${$.length} knowledge files`);let X=G8($);if(this.embeddingProvider&&$.length>0){console.error("[INFO] Building vector index for knowledge...");try{let Z=W5.join(A5(),"..",".sylphx-flow","knowledge-vectors.hnsw");this.vectorStorage=new Y8(Z,this.embeddingProvider.dimensions||1536),await this.vectorStorage.initialize();let J=10;for(let G=0;G<$.length;G+=J){let Y=$.slice(G,G+J),z=await this.embeddingProvider.generateEmbeddings(Y.map((F)=>F.content));for(let F=0;F<Y.length;F++){let H=Y[F],W=z[F];await this.vectorStorage.addDocument({id:H.uri,embedding:W,metadata:{type:"knowledge",content:H.content.slice(0,500),category:"knowledge",language:"markdown"}})}console.error(`[INFO] Processed ${Math.min(G+J,$.length)}/${$.length} knowledge files`)}await this.vectorStorage.save(),console.error("[INFO] Vector index built successfully")}catch(Z){console.error("[ERROR] Failed to build vector index:",Z),this.vectorStorage=void 0}}return X}}var U5=null;function K5(_){if(!U5)U5=new DZ(_);return U5}class OZ{memoryStorage;knowledgeIndexer=K5();embeddingProvider;constructor(){this.memoryStorage=new C0}async initialize(){if(await this.memoryStorage.initialize(),!this.embeddingProvider)this.embeddingProvider=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();this.knowledgeIndexer=K5(this.embeddingProvider)}async getStatus(){let _=await this.memoryStorage.getAllCodebaseFiles(),$=await this.memoryStorage.getCodebaseIndexStats(),X=this.knowledgeIndexer.getStatus(),Z=!1,J=0;try{let G=await this.knowledgeIndexer.loadIndex();Z=!0,J=G.totalDocuments}catch{}return{codebase:{indexed:_.length>0,fileCount:_.length,indexedAt:$.indexedAt},knowledge:{indexed:Z,documentCount:J,isIndexing:X.isIndexing,progress:X.progress}}}async searchCodebase(_,$={}){let{limit:X=10,include_content:Z=!0,file_extensions:J,path_filter:G,exclude_paths:Y,min_score:z=0.1}=$,F=await this.memoryStorage.getAllCodebaseFiles();if(F.length===0)throw Error('Codebase not indexed yet. Run "sylphx search reindex" first.');let H=F;if(J?.length)H=H.filter((O)=>J.some((R)=>O.path.endsWith(R)));if(G)H=H.filter((O)=>O.path.includes(G));if(Y?.length)H=H.filter((O)=>!Y.some((R)=>O.path.includes(R)));if(H.length===0)return{results:[],totalIndexed:F.length,query:_};let W=await this.buildSearchIndex(H);if(!W)throw Error("No searchable content found");let A=await Y5(_,W,{limit:X,minScore:z}),D=[];for(let O of A){let R=O.uri?.replace("file://","")||"Unknown",N="";if(Z){let I=await this.memoryStorage.getCodebaseFile(R);if(I?.content){if(N=I.content.substring(0,500),I.content.length>500)N+="..."}}D.push({uri:O.uri,score:O.score||0,title:R.split("/").pop()||R,content:Z?N:void 0})}return{results:D,totalIndexed:F.length,query:_}}async searchKnowledge(_,$={}){let{limit:X=10,include_content:Z=!0}=$;try{let J=await this.knowledgeIndexer.loadIndex();return{results:(await Y5(_,J,{limit:X})).map((z)=>({uri:z.uri,score:z.score||0,title:z.uri?.split("/").pop()||"Unknown",content:Z?"":void 0})),totalIndexed:J.totalDocuments,query:_}}catch{throw Error("Knowledge base not indexed yet")}}async buildSearchIndex(_){try{let $=[];for(let J of _){let G=await this.memoryStorage.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,F=new Map;for(let[H,W]of Object.entries(Y))z.set(H,W),F.set(H,W);$.push({uri:`file://${J.path}`,terms:z,rawTerms:F,magnitude:G.magnitude})}}if($.length===0)return null;let X=await this.memoryStorage.getIDFValues(),Z=new Map;for(let J of X)if(J.term&&J.idfValue!==void 0)Z.set(J.term,J.idfValue);return{documents:$,idf:Z,totalDocuments:$.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch($){return console.error("[ERROR] Failed to build search index:",$),null}}formatResultsForCLI(_,$,X){if(_.length===0)return`\uD83D\uDCED No results found for "${$}"

**Total indexed files:** ${X}`;let Z=`✓ Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let F=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${F}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA Source: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
   \`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return Z+J}formatResultsForMCP(_,$,X){let Z=`Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let F=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${F}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA URI: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
\`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return{content:[{type:"text",text:Z+J}]}}async getAvailableKnowledgeURIs(){try{return(await this.knowledgeIndexer.loadIndex()).documents.map(($)=>$.uri)}catch{return[]}}}var I0=new OZ;var MW=new N0("search").description("Search codebase files and source code").argument("<query>","Search query - use natural language, function names, or technical terms").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include file content snippets in results (default: true)","true").option("--extensions <exts...>","Filter by file extensions (e.g., .ts .tsx .js)").option("--path <pattern>","Filter by path pattern (e.g., src/components)").option("--exclude <patterns...>","Exclude paths containing these patterns").action(async(_,$)=>{try{console.log(""),console.log(M.cyan.bold("▸ Search Codebase")),console.log(M.gray(`  Query: "${_}"`));let X=v0("Searching...").start();await I0.initialize();let Z=await I0.searchCodebase(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false",file_extensions:$.extensions,path_filter:$.path,exclude_paths:$.exclude});X.stop();let J=I0.formatResultsForCLI(Z.results,_,Z.totalIndexed);console.log(J),console.log("")}catch(X){console.error(M.red(`
✗ Error: ${X.message}
`)),process.exit(1)}}),BW=new N0("reindex").description("Reindex all codebase files").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Reindex Codebase"));let _=v0("Scanning and indexing files...").start(),$=new z5,X=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();await $.indexCodebase({embeddingProvider:X}),_.succeed(M.green("Indexing complete")),console.log("")}catch(_){throw new h(`Codebase reindex failed: ${_.message}`)}}),IW=new N0("status").description("Get codebase search system status").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Codebase Status")),await I0.initialize();let _=await I0.getStatus();if(_.codebase.indexed){if(console.log(M.green(`
✓ Indexed and ready`)),console.log(M.gray(`  Files: ${_.codebase.fileCount}`)),_.codebase.indexedAt)console.log(M.gray(`  Last indexed: ${new Date(_.codebase.indexedAt).toLocaleString()}`))}else console.log(M.yellow(`
⚠ Not indexed`)),console.log(M.gray("  Run: sylphx-flow codebase reindex"));console.log(M.cyan(`
▸ Available Commands`)),console.log(M.gray("  • codebase search <query>")),console.log(M.gray("  • codebase reindex")),console.log(M.gray("  • codebase status")),console.log("")}catch(_){console.error(M.red(`
✗ Error: ${_.message}
`)),process.exit(1)}}),RZ=new N0("codebase").description("Manage codebase indexing and search").addCommand(MW).addCommand(BW).addCommand(IW);import r0 from"node:fs";import g1 from"node:path";var QW={core:"core.md"};function D5(_="core"){return VZ(QW[_])}function NZ(_){try{return D5(_),!0}catch{return!1}}function o2(_,$="white"){let X={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",reset:"\x1B[0m"},Z=X[$]||X.white;console.log(`${Z}${_}${X.reset}`)}import QZ from"node:path";import G2 from"node:fs/promises";import MZ from"node:path";async function R5(_,$={}){let{encoding:X="utf8",fallback:Z}=$;try{return await G2.readFile(_,X)}catch(J){if(J.code==="ENOENT"&&Z!==void 0)return Z;throw J}}async function BZ(_){try{return await G2.access(_),!0}catch{return!1}}async function z8(_){try{let $=await G2.stat(_);return{exists:!0,isFile:$.isFile(),isDirectory:$.isDirectory(),size:$.size,mtime:$.mtime,atime:$.atime,ctime:$.ctime}}catch{return{exists:!1,isFile:!1,isDirectory:!1}}}async function IZ(_){if(O5.validatePath(_),!await BZ(_))return;if((await z8(_)).isDirectory)await G2.rmdir(_,{recursive:!0});else await G2.unlink(_)}async function F8(_,$={}){let{recursive:X=!1,includeFiles:Z=!0,includeDirectories:J=!0}=$;if(O5.validatePath(_),!await BZ(_))throw Error(`Directory does not exist: ${_}`);if(!(await z8(_)).isDirectory)throw Error(`Path is not a directory: ${_}`);if(X){let Y=[],z=await G2.readdir(_,{withFileTypes:!0});for(let F of z){let H=MZ.join(_,F.name);if(F.isDirectory()&&J){Y.push(H);let W=await F8(H,$);Y.push(...W)}else if(F.isFile()&&Z)Y.push(H)}return Y}else return(await G2.readdir(_,{withFileTypes:!0})).filter((z)=>{if(z.isFile()&&Z)return!0;if(z.isDirectory()&&J)return!0;return!1}).map((z)=>MZ.join(_,z.name))}async function V5(_,$){try{return(await F8(_,{recursive:!0,includeFiles:!0,includeDirectories:!1})).filter((Z)=>$.some((J)=>Z.endsWith(J))).map((Z)=>QZ.relative(_,Z)).sort()}catch{return[]}}async function r_(_){let $=await z8(_);if(!$.exists||!$.isFile)return null;let X=await R5(_);if(X===null)return null;return{content:X,mtime:$.mtime}}async function N5(_,$,X,Z){try{let J=await F8(_,{recursive:!1,includeFiles:!0,includeDirectories:!1});for(let G of J){let Y=QZ.basename(G);if(X.some((F)=>Y.endsWith(F))&&!$.has(Y))await IZ(G),Z.push({file:Y,status:"skipped",action:"Removed obsolete file"})}}catch{}}async function M5(_,$,X,Z,J=!1,G=!1){if(G)return;if(!J){let A=_.length,D=_.filter((O)=>O.status==="added"||O.status==="updated").length;if(D>0)console.log(`✓ ${D} files updated`);else console.log(`✓ All ${A} files already current`);return}console.log(`
\uD83D\uDCCA ${Z} Results for ${X}`),console.log("=====================================");let Y=_.reduce((A,D)=>{if(!A[D.status])A[D.status]=[];return A[D.status].push(D),A},{}),z=["added","updated","current","skipped"],F={added:"green",updated:"yellow",current:"blue",skipped:"magenta"};for(let A of z){let D=Y[A];if(D&&D.length>0){let O=F[A];o2(`${A.toUpperCase()} (${D.length}):`,O);for(let R of D)o2(`  ${R.file} - ${R.action}`,O);console.log("")}}let H=_.length,W=_.filter((A)=>A.status==="added"||A.status==="updated").length;if(W>0)o2(`✓ ${Z} complete: ${W}/${H} files modified`,"green");else o2(`✓ ${Z} complete: All ${H} files already current`,"blue");console.log(`\uD83D\uDCC1 Target directory: ${$}`)}async function EZ(){let{getAgentsDir:_}=await import("./paths-2re3k191.js"),$=_();if(!r0.existsSync($))throw Error(`Could not find agents directory at: ${$}`);let X=[],Z=r0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isFile()&&G.name.endsWith(".md")).map((G)=>G.name);X.push(...Z);let J=r0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isDirectory()&&G.name!=="archived").map((G)=>G.name);for(let G of J){let Y=g1.join($,G),z=await V5(Y,[".md"]);X.push(...z.map((F)=>g1.join(G,F)))}return X}async function jZ(_){let $=process.cwd(),X=[],Z=await q.resolveTarget({target:_.target}),J=q.getTarget(Z);if(!J)throw Error(`Target not found: ${Z}`);if(_.quiet!==!0)console.log(`Using target: ${J.name}`);let G=J.config,Y=g1.join($,G.agentDir),z=async(D,O)=>{return await J.transformAgentContent(D,void 0,O)};if(_.clear&&r0.existsSync(Y)){let D,O=await EZ();D=new Set(O.map((R)=>{let N=g1.parse(R),I=N.name,y=N.dir;if(G.flatten)return`${y?`${y.replace(/[\/\\]/g,"-")}-${I}`:I}${G.agentExtension}`;return R})),N5(Y,D,[G.agentExtension],X)}r0.mkdirSync(Y,{recursive:!0});let F=await EZ();if(_.quiet!==!0)console.log(`Installing ${F.length} agents to ${Y.replace(`${process.cwd()}/`,"")}`),console.log("");if(_.dryRun){console.log("✓ Dry run completed - no files were modified");return}let{getAgentsDir:H}=await import("./paths-2re3k191.js"),W=H(),A=F.map(async(D)=>{let O=g1.join(W,D),R=g1.join(Y,D),N=g1.dirname(R);if(!r0.existsSync(N))r0.mkdirSync(N,{recursive:!0});let I=await r_(R),y=!I,k=r0.readFileSync(O,"utf8");k=await z(k,D);let C=I?await z(I.content,D):"";if(!I||C!==k)r0.writeFileSync(R,k,"utf8"),X.push({file:D,status:I?"updated":"added",action:I?"Updated":"Created"});else X.push({file:D,status:"current",action:"Already current"})});await Promise.all(A),M5(X,Y,J.name,"Install",_.verbose,_.quiet)}async function TZ(_){let $=process.cwd(),X=await q.resolveTarget({target:_.target}),Z=q.getTarget(X);if(!Z)throw Error(`Target not found: ${X}`);if(!Z.config.rulesFile)return;if(!NZ("core")){console.warn("⚠️ Core rules file not found");return}let J=D5("core"),Y=r0.readFileSync(J,"utf8"),z=g1.join($,Z.config.rulesFile),F=await r_(z),H=Y;if(_.dryRun){console.log(`Dry run: Would install rules file to ${z.replace(`${$}/`,"")}`);return}if(F&&F.content===H){if(_.quiet!==!0)console.log(`Rules file already current: ${Z.config.rulesFile}`);return}if(r0.writeFileSync(z,H,"utf8"),_.quiet!==!0)console.log(`${F?"Updated":"Created"} rules file: ${Z.config.rulesFile}`)}function EW(_){return _.type==="stdio"}function B5(_){return EW(_)}function I5(_){if(typeof _==="function"){let $=_();return Promise.resolve($)}return Promise.resolve(_)}class p1{target;constructor(_){let $=q.getTarget(_);if(!$)throw Error(`Target not found: ${_}`);this.target=$}getAllServerIds(){return Object.keys(U0)}async getAvailableServers(){let _=await this.getInstalledServerIds();return this.getAllServerIds().filter(($)=>!_.includes($))}async getInstalledServerIds(){try{let _=await this.target.readConfig(process.cwd()),$=this.target.config.mcpConfigPath,X=this.getNestedProperty(_,$)||{},Z=Object.keys(X);return Object.values(U0).filter((J)=>Z.includes(J.name)).map((J)=>J.id)}catch(_){return[]}}getRequiringConfiguration(_){return _.filter(($)=>{return!!U0[$].envVars})}validateServer(_,$){let X=U0[_];if(!X?.envVars)return{isValid:!0,missingRequired:[],invalidValues:[]};let Z=[],J=[];for(let[G,Y]of Object.entries(X.envVars)){let z=$[G]||process.env[G]||"";if(Y.required&&(!z||z===""))Z.push(G)}return{isValid:Z.length===0&&J.length===0,missingRequired:Z,invalidValues:J}}async configureServer(_,$={}){let X=U0[_],Z={};if(!X.envVars)return Z;console.log(""),console.log(M.cyan(`▸ ${X.name}`)),console.log(M.gray(`  ${X.description}`)),console.log("");for(let[J,G]of Object.entries(X.envVars)){if(G.dependsOn){if(G.dependsOn.filter((H)=>!($[H]||process.env[H])).length>0)continue}let Y=$[J]||process.env[J],z;if(Y&&Y.trim()!=="")z=Y;else if(G.fetchChoices){let F=v0("Fetching options...").start();for(let[H,W]of Object.entries($))if(W)process.env[H]=W;try{let H=await G.fetchChoices();F.stop(),z=(await d.prompt({type:"list",name:"value",message:`${J}${G.required?" *":""}`,choices:H,default:G.default||H[0]})).value}catch(H){let W=H instanceof Error?H.message:String(H);F.fail(M.red(`Failed to fetch options: ${W}`)),z=(await d.prompt({type:"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default})).value}}else if(J==="GEMINI_MODEL")z=(await d.prompt({type:"list",name:"model",message:`${J}${G.required?" *":""}`,choices:["gemini-2.5-flash","gemini-2.5-pro","gemini-1.5-flash","gemini-1.5-pro"],default:G.default||"gemini-2.5-flash"})).model;else z=(await d.prompt({type:G.secret?"password":"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default,mask:G.secret?"•":void 0})).value;if(z)Z[J]=z,$[J]=z}return console.log(M.green("✓ Configured")),console.log(""),Z}async installServers(_,$={}){if(_.length===0)return;try{let X=await this.target.readConfig(process.cwd()),Z=this.target.config.mcpConfigPath,G={...this.getNestedProperty(X,Z)||{}};for(let Y of _){let z=U0[Y],F=$[Y]||{},H={...z.config},W,A;if(B5(z.config))W=z.config.command?await I5(z.config.command):void 0,A=z.config.args?await I5(z.config.args):[];if(B5(z.config))H={...z.config,command:W,args:A};if(Object.keys(F).length>0){let R={...z.config.type==="local"?z.config.environment:z.config.type==="stdio"?z.config.env:{}};for(let[N,I]of Object.entries(F))if(I&&I.trim()!=="")R[N]=I;if(H.type==="local")H.environment=R;else if(H.type==="stdio")H.env=R}let D=this.target.transformMCPConfig(H,Y);G[z.name]=D}if(this.setNestedProperty(X,Z,G),await this.target.writeConfig(process.cwd(),X),this.target.approveMCPServers){let Y=_.map((z)=>U0[z].name);await this.target.approveMCPServers(process.cwd(),Y)}}catch(X){throw Error(`Failed to install MCP servers: ${X instanceof Error?X.message:String(X)}`)}}async readConfig(){try{return await this.target.readConfig(process.cwd())}catch(_){return{settings:{}}}}async writeConfig(_){await this.target.writeConfig(process.cwd(),_)}getNestedProperty(_,$){return $.split(".").reduce((X,Z)=>{if(typeof X==="object"&&X!==null)return X[Z];return},_)}setNestedProperty(_,$,X){let Z=$.split("."),J=Z.pop();if(!J)return;let G=Z.reduce((Y,z)=>{if(!Y[z])Y[z]={};return Y[z]},_);G[J]=X}}async function LZ(_,$){let X=q.getTarget($);if(!X)throw Error(`Target not found: ${$}`);let Z=await X.readConfig(_),J=X.config.mcpConfigPath,G=jW(Z,J);if(!G||Object.keys(G).length===0){console.log("ℹ️  No MCP servers configured");return}console.log(`\uD83D\uDCCB Currently configured MCP servers for ${X.name}:`),console.log("");for(let[Y,z]of Object.entries(G)){let F="";if(z&&typeof z==="object"&&"type"in z){if(z.type==="local")F=z.command?.join(" ")||"Unknown command";else if(z.type==="remote")F=`HTTP: ${z.url}`}console.log(`  • ${Y}: ${F}`);let H=Object.values(U0).find((W)=>W.name===Y);if(H)console.log(`    ${H.description}`);console.log("")}}function PZ(_){let $=q.getTarget(_);if(!$)throw Error(`Unknown target: ${_}. Available targets: ${q.getImplementedTargetIDs().join(", ")}`);if(!$.isImplemented)throw Error(`Target '${_}' is not implemented. Available targets: ${q.getImplementedTargetIDs().join(", ")}`);return _}function m1(_){return q.getTarget(_)?.config.installation.supportedMcpServers??!1}function jW(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}async function TW(_){let $=await q.resolveTarget({target:_.target});_.target=$;try{PZ($)}catch(X){if(X instanceof Error)throw new h(X.message,"UNSUPPORTED_TARGET");throw X}if(_.merge)throw new h("The --merge option is not supported with init command.","INVALID_OPTION")}var xZ={name:"init",description:"Initialize project with Sylphx Flow development agents and MCP tools",options:[{flags:"--target <type>",description:`Force specific target (${q.getImplementedTargetIDs().join(", ")}, default: opencode)`},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--no-mcp",description:"Skip MCP tools installation"}],handler:async(_)=>{let $=_.target;if(console.log(""),console.log(M.cyan.bold("▸ Sylphx Flow Setup")),!$)$=await q.promptForTargetSelection(),_.target=$;if(await TW(_),!$)throw Error("Target ID not set");if(_.dryRun){if(console.log(M.yellow(`
  Dry run mode - no changes will be made`)),_.mcp!==!1&&m1($)){let G=await new p1($).getAvailableServers();console.log(M.cyan(`
▸ MCP Tools`));for(let Y of G)console.log(M.gray(`  • ${U0[Y].name}`))}console.log(M.cyan(`
▸ Agents`)),console.log(M.gray("  • Development agents")),console.log(M.cyan(`
▸ Rules`)),console.log(M.gray("  • Custom rules")),console.log(M.green(`
✓ Dry run complete
`));return}if(_.mcp!==!1&&m1($)){let J=new p1($),G=J.getAllServerIds(),Y=await J.getInstalledServerIds();console.log(""),console.log(M.cyan.bold("▸ Configure MCP Tools")),console.log("");let F=(await d.prompt([{type:"checkbox",name:"selectedServers",message:"Select MCP tools to install:",choices:G.map((W)=>{let A=U0[W],D=Y.includes(W);return{name:`${A.name} - ${A.description}`,value:W,checked:A.required||D||A.defaultInInit||!1,disabled:A.required?"(required)":!1}})}])).selectedServers,H=G.filter((W)=>U0[W].required);if(F=[...new Set([...H,...F])],F.length>0){let W=F.filter((O)=>{let R=U0[O];return R.envVars&&Object.keys(R.envVars).length>0}),A={};if(W.length>0){console.log(""),console.log(M.cyan.bold("▸ Configure selected MCP tools"));let O={};for(let R of W){let N=await J.configureServer(R,O);A[R]=N}}let D=v0("Installing MCP servers...").start();try{await J.installServers(F,A),D.succeed("MCP servers installed")}catch(O){throw D.fail(M.red("Failed to install MCP servers")),O}}}if($==="opencode")await H8.ensureSecretsDir(process.cwd()),await H8.addToGitignore(process.cwd());console.log("");let X=v0("Installing agents...").start();await jZ({..._,quiet:!0}),X.succeed("Agents installed"),console.log("");let Z=v0("Installing rules...").start();await TZ({..._,quiet:!0}),Z.succeed("Rules installed"),console.log(""),console.log(M.green.bold("✓ Setup complete!")),console.log(M.gray("  Start coding with Sylphx Flow")),console.log("");try{await wZ.setDefaultTarget($),console.log(M.gray(`  Default target set to: ${q.getTarget($)?.name||$}`))}catch(J){console.warn(M.yellow(`  Warning: Could not save default target: ${J instanceof Error?J.message:String(J)}`))}console.log("")}};function LW(){return[{uri:"knowledge://stacks/react-app",title:"React App",description:"React application patterns, hooks, components, and best practices",content:"",category:"stacks"},{uri:"knowledge://stacks/nextjs-app",title:"Next.js App",description:"Next.js patterns, routing, API routes, and deployment strategies",content:"",category:"stacks"},{uri:"knowledge://stacks/node-api",title:"Node.js API",description:"Node.js API patterns, middleware, authentication, and database integration",content:"",category:"stacks"},{uri:"knowledge://data/sql",title:"SQL Patterns",description:"SQL queries, indexing, migrations, and database optimization",content:"",category:"data"},{uri:"knowledge://guides/saas-template",title:"SaaS Template",description:"SaaS application architecture, multi-tenancy, and scaling patterns",content:"",category:"guides"},{uri:"knowledge://guides/tech-stack",title:"Tech Stack Guide",description:"Technology selection, architecture decisions, and stack composition",content:"",category:"guides"},{uri:"knowledge://guides/ui-ux",title:"UI/UX Patterns",description:"User interface patterns, UX principles, and frontend architecture",content:"",category:"guides"},{uri:"knowledge://universal/security",title:"Security",description:"Security best practices, authentication, authorization, and vulnerability prevention",content:"",category:"universal"},{uri:"knowledge://universal/performance",title:"Performance",description:"Performance optimization, caching, monitoring, and scaling strategies",content:"",category:"universal"},{uri:"knowledge://universal/testing",title:"Testing",description:"Testing strategies, unit tests, integration tests, and quality assurance",content:"",category:"universal"},{uri:"knowledge://universal/deployment",title:"Deployment",description:"Deployment strategies, CI/CD, infrastructure, and monitoring",content:"",category:"universal"}]}function qZ(_){let X=LW().find((G)=>G.uri===_);if(!X)throw Error(`Knowledge resource not found: ${_}`);let Z=_.split("/")[2],J=_.split("/").pop();return`# ${X.title}

**URI:** ${_}
**Category:** ${Z}
**Description:** ${X.description}

*Note: This is a placeholder implementation. In a full implementation, this would load the actual content from knowledge files.*`}var PW=new N0("search").description("Search knowledge base, documentation, and guides").argument("<query>","Search query - use natural language, technology names, or topic keywords").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include full content in results (default: true)","true").action(async(_,$)=>{try{console.log(`\uD83D\uDCDA Searching knowledge base for: "${_}"`),await I0.initialize();let X=await I0.searchKnowledge(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false"}),Z=I0.formatResultsForCLI(X.results,_,X.totalIndexed);console.log(Z)}catch(X){throw new h(`Knowledge search failed: ${X.message}`)}}),wW=new N0("get").description("Get specific knowledge document by URI").argument("<uri>",'Knowledge URI to access (e.g., "knowledge://stacks/react-app")').action(async(_)=>{try{let $=qZ(_);console.log($)}catch($){let X=`Knowledge get failed: ${$.message}`,Z=await I0.getAvailableKnowledgeURIs();if(Z.length>0)console.log(`
**Available knowledge URIs:**`),Z.forEach((J)=>console.log(`• ${J}`));throw new h(X)}}),xW=new N0("list").description("List all available knowledge resources").option("--category <type>","Filter by category (stacks, guides, universal, data)").action(async(_)=>{try{await I0.initialize();let $=await I0.getAvailableKnowledgeURIs();if($.length===0){console.log("\uD83D\uDCED No knowledge documents available");return}let X=$;if(_.category)X=$.filter((J)=>J.includes(`/${_.category}/`));console.log(`\uD83D\uDCDA Available Knowledge Resources (${X.length} documents):
`);let Z=X.reduce((J,G)=>{let Y=G.split("/")[2]||"unknown";if(!J[Y])J[Y]=[];return J[Y].push(G),J},{});Object.entries(Z).forEach(([J,G])=>{console.log(`### ${J.charAt(0).toUpperCase()+J.slice(1)}`),G.forEach((Y)=>{let z=Y.split("/").pop()||"Unknown";console.log(`• ${z} - ${Y}`)}),console.log("")}),console.log("**Usage:**"),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch($){throw new h(`Knowledge status failed: ${$.message}`)}}),qW=new N0("status").description("Get knowledge base system status").action(async()=>{try{console.log(`
### \uD83D\uDCDA Knowledge Base Status
`),await I0.initialize();let _=await I0.getStatus();if(_.knowledge.indexed)console.log("**Status:** ✓ Ready"),console.log(`**Documents:** ${_.knowledge.documentCount} files`);else if(_.knowledge.isIndexing)console.log(`**Status:** \uD83D\uDD04 Building index (${_.knowledge.progress||0}%)`),console.log("**Note:** Please wait a moment and try again");else console.log("**Status:** ⚠️ Not initialized"),console.log("**Note:** Will auto-index on first search");console.log(`
**Available Commands:**`),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch(_){throw new h(`Knowledge list failed: ${_.message}`)}}),s2=new N0("knowledge").description("Knowledge base search and management commands");s2.addCommand(PW);s2.addCommand(wW);s2.addCommand(xW);s2.addCommand(qW);function CW(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}var SW=async(_)=>{let $={disableMemory:_.disableMemory===!0,disableTime:_.disableTime===!0,disableProjectStartup:_.disableProjectStartup===!0,disableKnowledge:_.disableKnowledge===!0,disableCodebaseSearch:_.disableCodebaseSearch===!0},X=await q.resolveTarget({target:_.target,allowSelection:!0}),Z=q.getTarget(X);if(!Z)throw new h(`Target not found: ${X}`,"TARGET_NOT_FOUND");try{let J=await Z.readConfig(process.cwd()),G=Z.config.mcpConfigPath||"mcp",Y=CW(J,G)||{},z=["--disable-memory","--disable-time","--disable-project-startup","--disable-knowledge","--disable-codebase-search"],F=[];if($.disableMemory)F.push("--disable-memory");if($.disableTime)F.push("--disable-time");if($.disableProjectStartup)F.push("--disable-project-startup");if($.disableKnowledge)F.push("--disable-knowledge");if($.disableCodebaseSearch)F.push("--disable-codebase-search");for(let[H,W]of Object.entries(Y)){if(!W||typeof W!=="object")continue;if(W.type==="stdio"){if(!W.args)W.args=[];W.args.push(...F)}else if(W.type==="local"&&Array.isArray(W.command))W.command.push(...F);else if(W.type==="http"||W.type==="remote")continue}await Z.writeConfig(process.cwd(),J),console.log(M.green("✓ Sylphx Flow MCP server configuration updated"))}catch(J){throw new h(`Failed to update MCP configuration: ${J instanceof Error?J.message:String(J)}`,"MCP_CONFIG_ERROR")}},kW=async(_)=>{let $=_.server,X=await q.resolveTarget({target:_.target,allowSelection:!0});if(!m1(X))throw new h(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");console.log(""),console.log(M.cyan.bold("▸ Configure MCP Server")),console.log(M.gray(`  Target: ${X}`));let Z=new p1(X),J;if($){if(!Z.getAllServerIds().includes($))throw new h(`Invalid MCP server: ${$}. Available: ${Z.getAllServerIds().join(", ")}`,"INVALID_MCP_SERVER");J=$}else J=(await d.prompt([{type:"list",name:"server",message:"Select server to configure:",choices:Z.getAllServerIds().map((F)=>{let H=U0[F];return{name:`${H.name} - ${H.description}`,value:F}})}])).server;let G=U0[J];if(console.log(M.cyan(`
▸ ${G.name}`)),console.log(M.gray(`  ${G.description}`)),!G.envVars){console.log(M.gray(`
  No configuration needed`));return}await Z.configureServer(J);let Y=v0("Saving configuration...").start();try{await Z.installServers([J]),Y.succeed(M.green("✓ Configuration saved"))}catch(z){throw Y.fail(M.red("Failed to save configuration")),z}},vW=async(_)=>{let $=await q.resolveTarget({target:_.target,allowSelection:!0});if(!m1($))throw new h(`Target ${$} does not support MCP servers`,"UNSUPPORTED_TARGET");await LZ(process.cwd(),$)},hW=async(_)=>{let $=_.servers,X=await q.resolveTarget({target:_.target,allowSelection:!0});if(!m1(X))throw new h(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new h("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let Z=Array.isArray($)?$:[$],J=new p1(X),G=J.getAllServerIds(),Y=Z.filter((F)=>!G.includes(F));if(Y.length>0)throw new h(`Invalid MCP servers: ${Y.join(", ")}. Available: ${G.join(", ")}`,"INVALID_MCP_SERVERS");let z=Z;await J.installServers(z)},yW=async(_)=>{let $=_.servers,X=await q.resolveTarget({target:_.target,allowSelection:!0});if(!m1(X))throw new h(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new h("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let J=new p1(X).getInstalledServerIds(),G=$.filter((Y)=>!J.includes(Y));if(G.length>0)throw new h(`MCP servers not installed: ${G.join(", ")}. Installed: ${J.join(", ")}`,"SERVERS_NOT_INSTALLED");console.log(M.yellow("Remove functionality not yet implemented"))},CZ={name:"mcp",description:"Manage MCP (Model Context Protocol) servers",options:[{flags:"--target <type>",description:`Force specific target (${q.getImplementedTargetIDs().join(", ")}, default: opencode)`}],subcommands:[{name:"start",description:"Start Sylphx Flow MCP server with specific configuration",options:[{flags:"--disable-memory",description:"Disable memory functionality"},{flags:"--disable-time",description:"Disable time functionality"},{flags:"--disable-project-startup",description:"Disable project startup functionality"},{flags:"--disable-knowledge",description:"Disable knowledge functionality"},{flags:"--disable-codebase-search",description:"Disable codebase search functionality"}],handler:SW},{name:"config",description:"Configure MCP server settings",options:[{flags:"--server <name>",description:"Configure specific server (shows selection if not provided)"}],handler:kW},{name:"list",description:"List installed MCP servers",options:[],handler:vW},{name:"add",description:"Add MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to add"}],handler:hW},{name:"remove",description:"Remove MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to remove"}],handler:yW}]};var fW=async(_)=>{let X=await new C0().getAll();if(_.namespace&&_.namespace!=="all"){let Z=X.filter((Y)=>Y.namespace===_.namespace);if(console.log(`\uD83D\uDCCB Memory entries in namespace: ${_.namespace}`),console.log(`Total: ${Z.length} entries
`),Z.length===0){console.log("No entries found in this namespace.");return}let J=_.limit||50;Z.slice(0,J).forEach((Y,z)=>{let F=Y.value||"",H=typeof F==="string"?F.substring(0,50)+(F.length>50?"...":""):`${JSON.stringify(F).substring(0,50)}...`;console.log(`${z+1}. ${Y.namespace}:${Y.key}`),console.log(`   Value: ${H}`),console.log(`   Updated: ${Y.updated_at}`),console.log("")})}else{if(console.log(`\uD83D\uDCCB All memory entries (showing first ${_.limit||50}):`),console.log(`Total: ${X.length} entries
`),X.length===0){console.log("No memory entries found.");return}let Z=_.limit||50;X.slice(0,Z).forEach((G,Y)=>{let z=G.value||"",F=typeof z==="string"?z.substring(0,50)+(z.length>50?"...":""):`${JSON.stringify(z).substring(0,50)}...`;console.log(`${Y+1}. ${G.namespace}:${G.key}`),console.log(`   Value: ${F}`),console.log(`   Updated: ${G.updated_at}`),console.log("")})}},bW=async(_)=>{if(!_.pattern)throw new h("Search pattern is required. Use --pattern <pattern>");let X=await new C0().search(_.pattern,_.namespace);if(console.log(`\uD83D\uDD0D Search results for pattern: ${_.pattern}`),_.namespace&&_.namespace!=="all")console.log(`Namespace: ${_.namespace}`);if(console.log(`Found: ${X.length} results
`),X.length===0){console.log("No matching entries found.");return}X.forEach((Z,J)=>{let G=Z.value||"",Y=typeof G==="string"?G.substring(0,50)+(G.length>50?"...":""):`${JSON.stringify(G).substring(0,50)}...`;console.log(`${J+1}. ${Z.namespace}:${Z.key}`),console.log(`   Value: ${Y}`),console.log(`   Updated: ${Z.updated_at}`),console.log("")})},gW=async(_)=>{if(!_.key)throw new h("Key is required. Use --key <key>");if(await new C0().delete(_.key,_.namespace||"default"))console.log(`✓ Deleted memory entry: ${_.namespace||"default"}:${_.key}`);else console.log(`✗ Memory entry not found: ${_.namespace||"default"}:${_.key}`)},pW=async(_)=>{if(!_.confirm)throw new h("Confirmation required. Use --confirm to clear memory entries");let $=new C0;if(_.namespace)await $.clear(_.namespace),console.log(`✓ Cleared all memory entries in namespace: ${_.namespace}`);else await $.clear(),console.log("✓ Cleared all memory entries")},mW=async()=>{let $=await new C0().getStats();if(console.log("\uD83D\uDCCA Memory Statistics"),console.log("=================="),console.log(`Total Entries: ${$.totalEntries}`),console.log(`Namespaces: ${$.namespaces.length}`),console.log(""),$.namespaces.length>0)console.log("Namespaces:"),$.namespaces.forEach((X)=>{console.log(`  • ${X}`)}),console.log("");console.log("\uD83D\uDCCD Database: .sylphx-flow/memory.db")},uW=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("get")+1;if(X>=$.length)throw new h("Usage: flow memory get <key> [--namespace <namespace>]");let Z=$[X],J=_.namespace||"default",Y=await new C0().get(Z,J);if(Y)console.log(`\uD83D\uDCC4 Memory entry: ${J}:${Z}`),console.log(`Value: ${JSON.stringify(Y.value,null,2)}`),console.log(`Created: ${Y.created_at}`),console.log(`Updated: ${Y.updated_at}`);else console.log(`✗ Memory entry not found: ${J}:${Z}`)},dW=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("set")+1,Z=X+1;if(X>=$.length||Z>=$.length)throw new h("Usage: flow memory set <key> <value> [--namespace <namespace>]");let J=$[X],G=$[Z],Y=_.namespace||"default";await new C0().set(J,G,Y),console.log(`✓ Set memory entry: ${Y}:${J} = "${G}"`)},SZ={name:"memory",description:"Manage memory storage (set, get, search, list, delete, clear)",options:[{flags:"--target <type>",description:`Target platform (${q.getImplementedTargets().join(", ")}, default: auto-detect)`}],subcommands:[{name:"list",description:"List memory entries",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"},{flags:"--limit <number>",description:"Limit number of entries (default: 50)"}],handler:fW},{name:"search",description:"Search memory entries",arguments:[{name:"pattern",required:!0,description:"Search pattern"}],options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:bW},{name:"delete",description:"Delete memory entry",arguments:[{name:"key",required:!0,description:"Memory key to delete"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:gW},{name:"clear",description:"Clear memory entries",options:[{flags:"--namespace <name>",description:"Clear specific namespace (default: all)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:pW},{name:"stats",description:"Show memory statistics",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:mW},{name:"get",description:"Get memory entry",arguments:[{name:"key",required:!0,description:"Memory key to retrieve"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:uW},{name:"set",description:"Set memory entry",arguments:[{name:"key",description:"Memory key",required:!0},{name:"value",description:"Memory value",required:!0}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:dW}]};import*as a_ from"node:fs";import*as F2 from"node:path";import cW from"node:crypto";import Q5 from"node:fs";function kZ(_){let $=_.migrationsFolder,X=[],Z=`${$}/meta/_journal.json`;if(!Q5.existsSync(Z))throw Error("Can't find meta/_journal.json file");let J=Q5.readFileSync(`${$}/meta/_journal.json`).toString(),G=JSON.parse(J);for(let Y of G.entries){let z=`${$}/${Y.tag}.sql`;try{let F=Q5.readFileSync(`${$}/${Y.tag}.sql`).toString(),H=F.split("--> statement-breakpoint").map((W)=>{return W});X.push({sql:H,bps:Y.breakpoints,folderMillis:Y.when,hash:cW.createHash("sha256").update(F).digest("hex")})}catch{throw Error(`No file ${z} found in ${$} folder`)}}return X}async function vZ(_,$){let X=kZ($),Z=$.migrationsTable??"__drizzle_migrations",J=U`
		CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
			id SERIAL PRIMARY KEY,
			hash text NOT NULL,
			created_at numeric
		)
	`;await _.session.run(J);let Y=(await _.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0,z=[];for(let F of X)if(!Y||Number(Y[2])<F.folderMillis){for(let H of F.sql)z.push(_.run(U.raw(H)));z.push(_.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${F.hash}, ${F.folderMillis})`))}await _.session.migrate(z)}var W8={};Y6(W8,{tfidfTerms:()=>V0,tfidfIdf:()=>r2,tfidfDocuments:()=>Y2,memory:()=>f,codebaseMetadata:()=>z2,codebaseFiles:()=>l});var f=B0("memory",{key:x("key").notNull(),namespace:x("namespace").notNull().default("default"),value:x("value").notNull(),timestamp:x0("timestamp").notNull(),created_at:x("created_at").notNull(),updated_at:x("updated_at").notNull()},(_)=>({pk:d2({columns:[_.key,_.namespace]}),namespaceIdx:D0("idx_memory_namespace").on(_.namespace),timestampIdx:D0("idx_memory_timestamp").on(_.timestamp),keyIdx:D0("idx_memory_key").on(_.key)})),l=B0("codebase_files",{path:x("path").primaryKey(),mtime:x0("mtime").notNull(),hash:x("hash").notNull(),content:x("content"),language:x("language"),size:x0("size"),indexedAt:x("indexed_at").notNull()},(_)=>({mtimeIdx:D0("idx_codebase_files_mtime").on(_.mtime),hashIdx:D0("idx_codebase_files_hash").on(_.hash)})),V0=B0("tfidf_terms",{filePath:x("file_path").notNull().references(()=>l.path,{onDelete:"cascade"}),term:x("term").notNull(),frequency:z1("frequency").notNull()},(_)=>({termIdx:D0("idx_tfidf_terms_term").on(_.term),fileIdx:D0("idx_tfidf_terms_file").on(_.filePath)})),Y2=B0("tfidf_documents",{filePath:x("file_path").primaryKey().references(()=>l.path,{onDelete:"cascade"}),magnitude:z1("magnitude").notNull(),termCount:x0("term_count").notNull(),rawTerms:x("raw_terms").notNull()}),r2=B0("tfidf_idf",{term:x("term").primaryKey(),idfValue:z1("idf_value").notNull()}),z2=B0("codebase_metadata",{key:x("key").primaryKey(),value:x("value").notNull()});class E5{client;db;constructor(){try{let _=F2.join(process.cwd(),".sylphx-flow");if(!a_.existsSync(_))a_.mkdirSync(_,{recursive:!0});let $=F2.join(_,"memory.db");this.client=b1({url:`file:${$}`}),this.db=n2(this.client,{schema:W8})}catch(_){throw new O_("Failed to initialize database connection",{url:`file:${F2.join(process.cwd(),".sylphx-flow/memory.db")}`},_)}}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){if(console.error("[INFO] Database tables already exist, checking migration state"),(await this.client.execute(`
          SELECT name FROM sqlite_master 
          WHERE type='table' AND name='__drizzle_migrations'
        `)).rows.length===0)await this.client.execute(`
            CREATE TABLE IF NOT EXISTS __drizzle_migrations (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              hash text NOT NULL UNIQUE,
              created_at numeric NOT NULL DEFAULT (strftime('%s', 'now'))
            )
          `),await this.client.execute(`
            INSERT OR IGNORE INTO __drizzle_migrations (hash, created_at) 
            VALUES ('0000_wooden_lady_bullseye', strftime('%s', 'now'))
          `),console.error("[INFO] Migration tracking initialized for existing tables");return}let $=F2.join(process.cwd(),"drizzle");if(a_.existsSync($))await vZ(this.db,{migrationsFolder:$}),console.error("[INFO] Database migrations completed");else console.error("[WARN] No migrations folder found, using fallback table creation"),await this.createTablesFallback()}catch(_){let $=`Migration failed: ${_.message}`;console.error("[ERROR]",$);try{await this.createTablesFallback(),console.error("[WARN] Fallback table creation completed")}catch(X){throw new X0("Both migration and fallback failed","initialize",X,{originalError:_.message})}}}async createTablesFallback(){console.error("[INFO] Using fallback table creation")}async close(){}getDatabasePath(){let _=F2.join(process.cwd(),".sylphx-flow");return F2.join(_,"memory.db")}async getMigrationStatus(){try{let _=await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name IN ('memory', 'codebase_files', 'tfidf_terms')
      `);return{isMigrated:_.rows.length>=2,migrationCount:_.rows.length}}catch(_){throw new X0("Failed to check migration status","getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}}class j5{drizzleDb;db;constructor(){this.drizzleDb=new E5,this.db=this.drizzleDb.db}async initialize(){await this.drizzleDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch{return _}}async set(_,$,X="default"){if(!_||typeof _!=="string")throw new N6("Key must be a non-empty string","key",_);if(!X||typeof X!=="string")throw new N6("Namespace must be a non-empty string","namespace",X);await c("memory.set",async()=>{let Z=new Date,J=Z.getTime(),G=Z.toISOString(),Y=G,z=this.safeSerialize($);if(await this.get(_,X))await this.db.update(f).set({value:z,timestamp:J,updated_at:Y}).where(A0(j(f.key,_),j(f.namespace,X)));else{let H={key:_,namespace:X,value:z,timestamp:J,created_at:G,updated_at:Y};await this.db.insert(f).values(H)}},{key:_,namespace:X})}async get(_,$="default"){let X=await this.db.select().from(f).where(A0(j(f.key,_),j(f.namespace,$))).limit(1);if(X.length===0)return null;let Z=X[0];return{key:Z.key,namespace:Z.namespace,value:this.safeDeserialize(Z.value),timestamp:Z.timestamp,created_at:Z.created_at,updated_at:Z.updated_at}}async getAll(){return(await this.db.select().from(f).orderBy(f0(f.timestamp))).map(($)=>({key:$.key,namespace:$.namespace,value:this.safeDeserialize($.value),timestamp:$.timestamp,created_at:$.created_at,updated_at:$.updated_at}))}async search(_,$){if(!_||typeof _!=="string")throw Error("Search pattern must be a non-empty string");let X=_.replace(/[^a-zA-Z0-9\s*_\-]/g,"");if(X!==_)throw Error("Search pattern contains invalid characters");let Z=X.replace(/\*/g,"%"),J=$1(f.key,Z);if($&&$!=="all"){if(!/^[a-zA-Z0-9_\-]+$/.test($))throw Error("Namespace contains invalid characters");J=A0(J,j(f.namespace,$))}return(await this.db.select().from(f).where(J).orderBy(f0(f.timestamp)).limit(1000)).map((Y)=>({key:Y.key,namespace:Y.namespace,value:this.safeDeserialize(Y.value),timestamp:Y.timestamp,created_at:Y.created_at,updated_at:Y.updated_at}))}async delete(_,$="default"){return(await this.db.delete(f).where(A0(j(f.key,_),j(f.namespace,$)))).rowsAffected>0}async clear(_){if(_&&_!=="all")await this.db.delete(f).where(j(f.namespace,_));else await this.db.delete(f)}async getStats(){let[_,$,X,Z]=await Promise.all([this.db.select({count:c0()}).from(f),this.db.select({namespace:f.namespace,count:c0()}).from(f).groupBy(f.namespace).orderBy(f.namespace),this.db.select({created_at:f.created_at}).from(f).orderBy(f.created_at).limit(1),this.db.select({created_at:f.created_at}).from(f).orderBy(f0(f.created_at)).limit(1)]),J=_[0]?.count||0,G=$.map((H)=>H.namespace),Y=Object.fromEntries($.map((H)=>[H.namespace,H.count])),z=X[0]?.created_at||null,F=Z[0]?.created_at||null;return{totalEntries:J,namespaces:G,namespaceCounts:Y,oldestEntry:z,newestEntry:F}}async load(){let _=await this.getAll(),$={};return _.forEach((X)=>{if(!$[X.namespace])$[X.namespace]={};$[X.namespace][X.key]=X.value}),{namespaces:$}}async close(){await this.drizzleDb.close()}getDatabasePath(){return this.drizzleDb.getDatabasePath()}async setCodebaseMetadata(_,$){let X=this.safeSerialize($);await this.db.insert(z2).values({key:_,value:X}).onConflictDoUpdate({target:z2.key,set:{value:X}})}async getCodebaseMetadata(_){let $=await this.db.select().from(z2).where(j(z2.key,_)).limit(1);if($.length===0)return null;return this.safeDeserialize($[0].value)}async upsertCodebaseFile(_){let $=new Date().toISOString();await this.db.insert(l).values({path:_.path,mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}).onConflictDoUpdate({target:l.path,set:{mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}})}async getCodebaseFile(_){let $=await this.db.select().from(l).where(j(l.path,_)).limit(1);return $.length>0?$[0]:null}async getAllCodebaseFiles(){return await this.db.select({path:l.path,mtime:l.mtime,hash:l.hash,content:l.content,language:l.language,size:l.size,indexedAt:l.indexedAt}).from(l).orderBy(l.path)}async deleteCodebaseFile(_){await this.db.delete(l).where(j(l.path,_))}async upsertTFIDFDocument(_,$){await this.db.insert(Y2).values({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}).onConflictDoUpdate({target:Y2.filePath,set:{magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}})}async getTFIDFDocument(_){let $=await this.db.select().from(Y2).where(j(Y2.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{...X,rawTerms:this.safeDeserialize(X.rawTerms)}}async setTFIDFTerms(_,$){if(await this.db.delete(V0).where(j(V0.filePath,_)),Object.keys($).length>0){let X=Object.entries($).map(([J,G])=>({filePath:_,term:J,frequency:G})),Z=100;for(let J=0;J<X.length;J+=100){let G=X.slice(J,J+100);await this.db.insert(V0).values(G)}}}async getTFIDFTerms(_){let $=await this.db.select().from(V0).where(j(V0.filePath,_)),X={};return $.forEach((Z)=>{X[Z.term]=Z.frequency}),X}async setIDFValues(_){if(await this.db.delete(r2),Object.keys(_).length>0){let $=Object.entries(_).map(([Z,J])=>({term:Z,idfValue:J})),X=100;for(let Z=0;Z<$.length;Z+=100){let J=$.slice(Z,Z+100);await this.db.insert(r2).values(J)}}}async getIDFValues(){let _=await this.db.select().from(r2),$={};return _.forEach((X)=>{$[X.term]=X.idfValue}),$}async getCodebaseIndexStats(){let $=(await this.db.select({count:l.path}).from(l)).length,Z=(await this.db.selectDistinct({term:V0.term}).from(V0)).length,[J,G]=await Promise.all([this.getCodebaseMetadata("indexedAt"),this.getCodebaseMetadata("version")]);return{fileCount:$,termCount:Z,indexedAt:J,version:G}}async clearCodebaseIndex(){await Promise.all([this.db.delete(l),this.db.delete(V0),this.db.delete(Y2),this.db.delete(r2),this.db.delete(z2)])}async searchTFIDFTerms(_){if(!_||typeof _!=="string")throw Error("Term pattern must be a non-empty string");let $=_.replace(/[^a-zA-Z0-9\s_\-]/g,"");if($!==_)throw Error("Term pattern contains invalid characters");let X=`%${$}%`;return await this.db.select({path:l.path,term:V0.term,frequency:V0.frequency,language:l.language}).from(V0).innerJoin(l,j(V0.filePath,l.path)).where($1(V0.term,X)).orderBy(f0(V0.frequency)).limit(100)}}class hZ{memory;entries=[];running=!0;constructor(){this.memory=new j5}async start(){console.clear(),console.log(M.cyan.bold("\uD83E\uDDE0 Memory Manager")),console.log(M.gray(`Interactive memory management for Sylphx Flow
`)),await this.loadEntries();while(this.running)try{await this.showMainMenu()}catch(_){console.error(M.red(`Error: ${_}`)),await d.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}async loadEntries(){try{this.entries=await this.memory.getAll(),this.entries.sort((_,$)=>new Date($.updated_at).getTime()-new Date(_.updated_at).getTime())}catch(_){console.error(M.red(`Failed to load entries: ${_}`)),this.entries=[]}}async showMainMenu(){if(this.entries.length===0){console.log(M.yellow("No memory entries found."));let{action:X}=await d.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:[{name:"➕ Add new entry",value:"add"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh"},{name:"✗ Exit",value:"exit"}]}]);if(X==="add")await this.showAddEntry();else if(X==="refresh")await this.loadEntries();else this.running=!1;return}let _=[{name:"\uD83D\uDCDD View entry details",value:"view",short:"View"},{name:"✏️ Edit entry",value:"edit",short:"Edit"},{name:"➕ Add new entry",value:"add",short:"Add"},{name:"\uD83D\uDDD1️ Delete entry",value:"delete",short:"Delete"},{name:"\uD83D\uDD0D Search entries",value:"search",short:"Search"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh",short:"Refresh"},{name:"✗ Exit",value:"exit",short:"Exit"}],{action:$}=await d.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:_}]);switch($){case"view":await this.showViewEntry();break;case"edit":await this.showEditEntry();break;case"add":await this.showAddEntry();break;case"delete":await this.showDeleteEntry();break;case"search":await this.showSearchEntries();break;case"refresh":await this.loadEntries(),console.log(M.green("✓ Entries refreshed"));break;case"exit":this.running=!1;break}}async selectEntry(_,$=!1){if(this.entries.length===0){if($)return null;throw Error("No entries available")}let X=this.entries.map((J,G)=>({value:J,name:`${M.cyan(`${G+1}.`)} ${M.bold(J.namespace)}:${M.bold(J.key)}`,short:`${J.namespace}:${J.key}`}));if($)X.unshift({name:"← Back to menu",value:null,short:"Back"});let{selected:Z}=await d.prompt([{type:"list",name:"selected",message:_,choices:X,pageSize:15}]);return Z}async showViewEntry(){let _=await this.selectEntry("Select entry to view:",!0);if(!_)return;console.clear(),console.log(M.cyan.bold("\uD83D\uDCC4 Entry Details")),console.log(M.gray("─".repeat(50))),console.log(M.blue.bold("Namespace:"),_.namespace),console.log(M.blue.bold("Key:"),_.key),console.log(M.blue.bold("Updated:"),_.updated_at),console.log(M.blue.bold(`
Value:`));let $=JSON.stringify(_.value,null,2);console.log(M.gray($)),await d.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showEditEntry(){let _=await this.selectEntry("Select entry to edit:",!0);if(!_)return;console.clear(),console.log(M.yellow.bold("✏️ Edit Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Editing:")} ${_.namespace}:${_.key}
`);let $=await d.prompt([{type:"input",name:"namespace",message:"Namespace:",default:_.namespace,validate:(X)=>X.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",default:_.key,validate:(X)=>X.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:JSON.stringify(_.value,null,2),validate:(X)=>{try{return JSON.parse(X),!0}catch{return"Invalid JSON format"}}}]);try{let X=JSON.parse($.value);if(await this.memory.set($.key,X,$.namespace),$.namespace!==_.namespace||$.key!==_.key)await this.memory.delete(_.key,_.namespace);await this.loadEntries(),console.log(M.green(`✓ Updated ${$.namespace}:${$.key}`))}catch(X){console.error(M.red(`Failed to update entry: ${X}`))}await d.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showAddEntry(){console.clear(),console.log(M.green.bold("➕ Add New Entry")),console.log(M.gray("─".repeat(50)));let _=await d.prompt([{type:"input",name:"namespace",message:"Namespace:",default:"default",validate:($)=>$.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",validate:($)=>$.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:`{
  
}`,validate:($)=>{try{return JSON.parse($),!0}catch{return"Invalid JSON format"}}}]);try{let $=JSON.parse(_.value);await this.memory.set(_.key,$,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Added ${_.namespace}:${_.key}`))}catch($){console.error(M.red(`Failed to add entry: ${$}`))}await d.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showDeleteEntry(){let _=await this.selectEntry("Select entry to delete:",!0);if(!_)return;console.clear(),console.log(M.red.bold("\uD83D\uDDD1️ Delete Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Entry:")} ${_.namespace}:${_.key}`);let $=JSON.stringify(_.value),X=$.length>100?$.substring(0,100)+"...":$;console.log(`${M.blue("Value:")} ${M.gray(X)}`);let{confirmed:Z}=await d.prompt([{type:"confirm",name:"confirmed",message:M.yellow("Are you sure you want to delete this entry?"),default:!1}]);if(Z)try{await this.memory.delete(_.key,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Deleted ${_.namespace}:${_.key}`))}catch(J){console.error(M.red(`Failed to delete entry: ${J}`))}else console.log(M.gray("Delete cancelled"));await d.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showSearchEntries(){console.clear(),console.log(M.magenta.bold("\uD83D\uDD0D Search Entries")),console.log(M.gray("─".repeat(50)));let{query:_}=await d.prompt([{type:"input",name:"query",message:"Search query:",validate:(X)=>X.trim().length>0||"Search query is required"}]),$=this.entries.filter((X)=>X.namespace.toLowerCase().includes(_.toLowerCase())||X.key.toLowerCase().includes(_.toLowerCase())||JSON.stringify(X.value).toLowerCase().includes(_.toLowerCase()));if($.length===0)console.log(M.yellow("No entries found matching your search."));else console.log(M.cyan(`
Found ${$.length} matching entries:
`)),$.forEach((X,Z)=>{let J=JSON.stringify(X.value),G=J.length>80?J.substring(0,80)+"...":J;console.log(`${M.cyan(`${Z+1}.`)} ${M.bold(X.namespace)}:${M.bold(X.key)}`),console.log(`   ${M.gray(G)}
`)});await d.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}var yZ=async()=>{await new hZ().start()};var T5=async()=>{await yZ()},TT={name:"memory-tui",description:"Launch interactive memory management TUI",options:[{flags:"--target <type>",description:`Target platform (${q.getImplementedTargets().join(", ")}, default: auto-detect)`}],handler:T5};import fZ from"node:fs/promises";import bZ from"node:path";async function lW(_){if(_.target=await q.resolveTarget({target:_.target,allowSelection:!0}),!_.agent)_.agent="builder"}async function iW(_){try{let $=bZ.join(process.cwd(),"agents",`${_}.md`);try{return await fZ.readFile($,"utf-8")}catch(X){let Z=pZ(),J=bZ.join(Z,`${_}.md`);return await fZ.readFile(J,"utf-8")}}catch($){throw new h(`Agent '${_}' not found`,"AGENT_NOT_FOUND")}}function nW(_){let $=/^---\s*\n[\s\S]*?\n---\s*\n/,X=_.match($);if(X)return _.substring(X[0].length).trim();return _.trim()}function oW(_,$,X,Z){let J=q.getTarget(_);if(!J)throw new h(`Target not found: ${_}`,"TARGET_NOT_FOUND");if(!J.isImplemented)throw new h(`Target '${_}' is not implemented. Supported targets: ${gZ().join(", ")}`,"TARGET_NOT_IMPLEMENTED");if(!J.executeCommand)throw new h(`Target '${_}' does not support command execution. Supported targets: ${gZ().join(", ")}`,"EXECUTION_NOT_SUPPORTED");return J.executeCommand($,X,Z)}function gZ(){return q.getImplementedTargetIDs().filter((_)=>{return q.getTarget(_)?.executeCommand!==void 0})}var mZ={name:"run",description:"Run a prompt with a specific agent (default: sparc-orchestrator) using the detected or specified target",options:[{flags:"--target <name>",description:`Target platform (${q.getImplementedTargetIDs().join(", ")}, default: auto-detect)`},{flags:"--agent <name>",description:"Agent to use (default: sparc-orchestrator)"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without executing the command"}],arguments:[{name:"prompt",description:"The prompt to execute with the agent (optional - if not provided, will start Claude Code interactively)",required:!1}],handler:async(_)=>{await lW(_);let{prompt:$,agent:X,verbose:Z}=_;if(Z){if(console.log("\uD83D\uDE80 Sylphx Flow Run"),console.log("===================="),console.log(`\uD83C\uDFAF Target: ${_.target}`),console.log(`\uD83E\uDD16 Agent: ${X}`),$)console.log(`\uD83D\uDCAC Prompt: ${$}`);else console.log("\uD83D\uDCAC Prompt: [Interactive mode]");console.log("")}let J=await iW(X),Y=`AGENT INSTRUCTIONS:
${nW(J)}`,z="";if($&&$.trim()!=="")z=$;if(Z)if(console.log("\uD83D\uDCDD System Prompt:"),console.log("================"),console.log(Y.substring(0,500)+(Y.length>500?"...":"")),console.log(""),z.trim()!=="")console.log("\uD83D\uDCDD User Prompt:"),console.log("=============="),console.log(z.substring(0,500)+(z.length>500?"...":"")),console.log("");else console.log("\uD83D\uDCDD User Prompt: [Interactive mode - Claude will greet the user]"),console.log("");await oW(_.target,Y,z,_)}};function L5(_){let $=new N0(_.name);$.description(_.description);for(let X of _.options||[])$.option(X.flags,X.description);if(_.arguments)for(let X of _.arguments){let Z=X.name==="servers"?`[${X.name}...]`:X.required?`<${X.name}>`:`[${X.name}]`;$.argument(Z,X.description)}if(_.subcommands)for(let X of _.subcommands)$.addCommand(L5(X));if(_.handler){let X=uZ(_.handler,_.name);if(_.validator)$.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,F)=>{if(F<J.length)Y[z.name]=J[F]});return _.validator?.(Y),X(Y)});else $.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,F)=>{if(F<J.length)Y[z.name]=J[F]});return X(Y)})}return $}var yT=[{flags:"--target <type>",description:"Force specific target"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--mcp [servers...]",description:`Install MCP servers (${dZ().join(", ")})`}];function cZ(){console.log("\uD83D\uDE80 Sylphx Flow CLI - Type-safe development flow"),console.log("========================================="),console.log(""),console.log("Available commands:"),console.log("  init     Initialize project with Sylphx Flow"),console.log("  mcp      Manage MCP tools"),console.log("  memory   Manage memory storage"),console.log("  tui      Interactive TUI for all operations"),console.log(""),console.log("Examples:"),console.log("  sylphx-flow init"),console.log("  sylphx-flow init --target opencode"),console.log("  sylphx-flow mcp install --all"),console.log("  sylphx-flow memory set key value"),console.log("  sylphx-flow tui"),console.log(""),console.log('Run "sylphx-flow <command> --help" for more information about a command.')}function sW(){let _=new N0;_.name("sylphx-flow").description("Sylphx Flow - Type-safe development flow CLI").version("1.0.0");let $=[xZ,CZ,SZ,mZ];_.addCommand(RZ),_.addCommand(s2);for(let X of $)_.addCommand(L5(X));return _.command("tui").description("Launch interactive Sylphx Flow TUI").option("--target <type>","Target platform (opencode, default: auto-detect)").action(T5),_.action(()=>{cZ()}),_}function lZ(){let _=sW();if(process.argv.length===2)_.help();process.on("uncaughtException",($)=>{console.error(`✗ Uncaught error: ${$.message}`),process.exit(1)}),process.on("unhandledRejection",($)=>{console.error(`✗ Unhandled rejection: ${$}`),process.exit(1)});try{_.parse()}catch($){console.error(`✗ Error: ${$.message}`),process.exit(1)}}lZ();
