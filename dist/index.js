#!/usr/bin/env node
import{a as O8,b as V5,c as QZ}from"./paths-2re3k191.js";import{e as F8}from"./index-wyc164dh.js";import{f as k,g as rZ}from"./error-handler-s33btwbj.js";import{h as K0,i as aZ}from"./servers-kk8achc3.js";import{j as i,k as kZ,l as v}from"./index-jxkn0z7w.js";import"./targets-eqj2n0rv.js";import{s as A8}from"./secret-utils-zft4mj2q.js";import{u as B5}from"./index-bj3p86hf.js";import{A as y,x as j0,y as l,z as F6}from"./index-cq9vs79a.js";var $_=l((ZJ)=>{class R8 extends Error{constructor(_,$,X){super(X);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=_,this.nestedError=void 0}}class S5 extends R8{constructor(_){super(1,"commander.invalidArgument",_);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}ZJ.CommanderError=R8;ZJ.InvalidArgumentError=S5});var X6=l((HJ)=>{var{InvalidArgumentError:YJ}=$_();class k5{constructor(_,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,_[0]){case"<":this.required=!0,this._name=_.slice(1,-1);break;case"[":this.required=!1,this._name=_.slice(1,-1);break;default:this.required=!0,this._name=_;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}argParser(_){return this.parseArg=_,this}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new YJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function zJ(_){let $=_.name()+(_.variadic===!0?"...":"");return _.required?"<"+$+">":"["+$+"]"}HJ.Argument=k5;HJ.humanReadableArgName=zJ});var V8=l((AJ)=>{var{humanReadableArgName:UJ}=X6();class v5{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(_){let $=_.commands.filter((Z)=>!Z._hidden),X=_._getHelpCommand();if(X&&!X._hidden)$.push(X);if(this.sortSubcommands)$.sort((Z,J)=>{return Z.name().localeCompare(J.name())});return $}compareOptions(_,$){let X=(Z)=>{return Z.short?Z.short.replace(/^-/,""):Z.long.replace(/^--/,"")};return X(_).localeCompare(X($))}visibleOptions(_){let $=_.options.filter((Z)=>!Z.hidden),X=_._getHelpOption();if(X&&!X.hidden){let Z=X.short&&_._findOption(X.short),J=X.long&&_._findOption(X.long);if(!Z&&!J)$.push(X);else if(X.long&&!J)$.push(_.createOption(X.long,X.description));else if(X.short&&!Z)$.push(_.createOption(X.short,X.description))}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(_){if(!this.showGlobalOptions)return[];let $=[];for(let X=_.parent;X;X=X.parent){let Z=X.options.filter((J)=>!J.hidden);$.push(...Z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(_){if(_._argsDescription)_.registeredArguments.forEach(($)=>{$.description=$.description||_._argsDescription[$.name()]||""});if(_.registeredArguments.find(($)=>$.description))return _.registeredArguments;return[]}subcommandTerm(_){let $=_.registeredArguments.map((X)=>UJ(X)).join(" ");return _._name+(_._aliases[0]?"|"+_._aliases[0]:"")+(_.options.length?" [options]":"")+($?" "+$:"")}optionTerm(_){return _.flags}argumentTerm(_){return _.name()}longestSubcommandTermLength(_,$){return $.visibleCommands(_).reduce((X,Z)=>{return Math.max(X,$.subcommandTerm(Z).length)},0)}longestOptionTermLength(_,$){return $.visibleOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestGlobalOptionTermLength(_,$){return $.visibleGlobalOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestArgumentTermLength(_,$){return $.visibleArguments(_).reduce((X,Z)=>{return Math.max(X,$.argumentTerm(Z).length)},0)}commandUsage(_){let $=_._name;if(_._aliases[0])$=$+"|"+_._aliases[0];let X="";for(let Z=_.parent;Z;Z=Z.parent)X=Z.name()+" "+X;return X+$+" "+_.usage()}commandDescription(_){return _.description()}subcommandDescription(_){return _.summary()||_.description()}optionDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0){if(_.required||_.optional||_.isBoolean()&&typeof _.defaultValue==="boolean")$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`)}if(_.presetArg!==void 0&&_.optional)$.push(`preset: ${JSON.stringify(_.presetArg)}`);if(_.envVar!==void 0)$.push(`env: ${_.envVar}`);if($.length>0)return`${_.description} (${$.join(", ")})`;return _.description}argumentDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0)$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`);if($.length>0){let X=`(${$.join(", ")})`;if(_.description)return`${_.description} ${X}`;return X}return _.description}formatHelp(_,$){let X=$.padWidth(_,$),Z=$.helpWidth||80,J=2,G=2;function Y(D,R){if(R){let N=`${D.padEnd(X+2)}${R}`;return $.wrap(N,Z-2,X+2)}return D}function z(D){return D.join(`
`).replace(/^/gm," ".repeat(2))}let H=[`Usage: ${$.commandUsage(_)}`,""],F=$.commandDescription(_);if(F.length>0)H=H.concat([$.wrap(F,Z,0),""]);let W=$.visibleArguments(_).map((D)=>{return Y($.argumentTerm(D),$.argumentDescription(D))});if(W.length>0)H=H.concat(["Arguments:",z(W),""]);let A=$.visibleOptions(_).map((D)=>{return Y($.optionTerm(D),$.optionDescription(D))});if(A.length>0)H=H.concat(["Options:",z(A),""]);if(this.showGlobalOptions){let D=$.visibleGlobalOptions(_).map((R)=>{return Y($.optionTerm(R),$.optionDescription(R))});if(D.length>0)H=H.concat(["Global Options:",z(D),""])}let K=$.visibleCommands(_).map((D)=>{return Y($.subcommandTerm(D),$.subcommandDescription(D))});if(K.length>0)H=H.concat(["Commands:",z(K),""]);return H.join(`
`)}padWidth(_,$){return Math.max($.longestOptionTermLength(_,$),$.longestGlobalOptionTermLength(_,$),$.longestSubcommandTermLength(_,$),$.longestArgumentTermLength(_,$))}wrap(_,$,X,Z=40){let G=new RegExp(`[\\n][${" \\f\\t\\v   -   　\uFEFF"}]+`);if(_.match(G))return _;let Y=$-X;if(Y<Z)return _;let z=_.slice(0,X),H=_.slice(X).replace(`\r
`,`
`),F=" ".repeat(X),A=`\\s${"​"}`,K=new RegExp(`
|.{1,${Y-1}}([${A}]|$)|[^${A}]+?([${A}]|$)`,"g"),D=H.match(K)||[];return z+D.map((R,N)=>{if(R===`
`)return"";return(N>0?F:"")+R.trimEnd()}).join(`
`)}}AJ.Help=v5});var N8=l((VJ)=>{var{InvalidArgumentError:OJ}=$_();class y5{constructor(_,$){this.flags=_,this.description=$||"",this.required=_.includes("<"),this.optional=_.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(_),this.mandatory=!1;let X=RJ(_);if(this.short=X.shortFlag,this.long=X.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}preset(_){return this.presetArg=_,this}conflicts(_){return this.conflictsWith=this.conflictsWith.concat(_),this}implies(_){let $=_;if(typeof _==="string")$={[_]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(_){return this.envVar=_,this}argParser(_){return this.parseArg=_,this}makeOptionMandatory(_=!0){return this.mandatory=!!_,this}hideHelp(_=!0){return this.hidden=!!_,this}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new OJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return DJ(this.name().replace(/^no-/,""))}is(_){return this.short===_||this.long===_}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class h5{constructor(_){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,_.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,X)=>{if(this.positiveOptions.has(X))this.dualOptions.add(X)})}valueFromOption(_,$){let X=$.attributeName();if(!this.dualOptions.has(X))return!0;let Z=this.negativeOptions.get(X).presetArg,J=Z!==void 0?Z:!1;return $.negate===(J===_)}}function DJ(_){return _.split("-").reduce(($,X)=>{return $+X[0].toUpperCase()+X.slice(1)})}function RJ(_){let $,X,Z=_.split(/[ |,]+/);if(Z.length>1&&!/^[[<]/.test(Z[1]))$=Z.shift();if(X=Z.shift(),!$&&/^-[^-]$/.test(X))$=X,X=void 0;return{shortFlag:$,longFlag:X}}VJ.Option=y5;VJ.DualOptions=h5});var f5=l((QJ)=>{function BJ(_,$){if(Math.abs(_.length-$.length)>3)return Math.max(_.length,$.length);let X=[];for(let Z=0;Z<=_.length;Z++)X[Z]=[Z];for(let Z=0;Z<=$.length;Z++)X[0][Z]=Z;for(let Z=1;Z<=$.length;Z++)for(let J=1;J<=_.length;J++){let G=1;if(_[J-1]===$[Z-1])G=0;else G=1;if(X[J][Z]=Math.min(X[J-1][Z]+1,X[J][Z-1]+1,X[J-1][Z-1]+G),J>1&&Z>1&&_[J-1]===$[Z-2]&&_[J-2]===$[Z-1])X[J][Z]=Math.min(X[J][Z],X[J-2][Z-2]+1)}return X[_.length][$.length]}function IJ(_,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let X=_.startsWith("--");if(X)_=_.slice(2),$=$.map((Y)=>Y.slice(2));let Z=[],J=3,G=0.4;if($.forEach((Y)=>{if(Y.length<=1)return;let z=BJ(_,Y),H=Math.max(_.length,Y.length);if((H-z)/H>G){if(z<J)J=z,Z=[Y];else if(z===J)Z.push(Y)}}),Z.sort((Y,z)=>Y.localeCompare(z)),X)Z=Z.map((Y)=>`--${Y}`);if(Z.length>1)return`
(Did you mean one of ${Z.join(", ")}?)`;if(Z.length===1)return`
(Did you mean ${Z[0]}?)`;return""}QJ.suggestSimilar=IJ});var m5=l((xJ)=>{var jJ=y("node:events").EventEmitter,M8=y("node:child_process"),K1=y("node:path"),B8=y("node:fs"),e=y("node:process"),{Argument:TJ,humanReadableArgName:LJ}=X6(),{CommanderError:I8}=$_(),{Help:wJ}=V8(),{Option:b5,DualOptions:PJ}=N8(),{suggestSimilar:g5}=f5();class Q8 extends jJ{constructor(_){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=_||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>e.stdout.write($),writeErr:($)=>e.stderr.write($),getOutHelpWidth:()=>e.stdout.isTTY?e.stdout.columns:void 0,getErrHelpWidth:()=>e.stderr.isTTY?e.stderr.columns:void 0,outputError:($,X)=>X($)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(_){return this._outputConfiguration=_._outputConfiguration,this._helpOption=_._helpOption,this._helpCommand=_._helpCommand,this._helpConfiguration=_._helpConfiguration,this._exitCallback=_._exitCallback,this._storeOptionsAsProperties=_._storeOptionsAsProperties,this._combineFlagAndOptionalValue=_._combineFlagAndOptionalValue,this._allowExcessArguments=_._allowExcessArguments,this._enablePositionalOptions=_._enablePositionalOptions,this._showHelpAfterError=_._showHelpAfterError,this._showSuggestionAfterError=_._showSuggestionAfterError,this}_getCommandAndAncestors(){let _=[];for(let $=this;$;$=$.parent)_.push($);return _}command(_,$,X){let Z=$,J=X;if(typeof Z==="object"&&Z!==null)J=Z,Z=null;J=J||{};let[,G,Y]=_.match(/([^ ]+) *(.*)/),z=this.createCommand(G);if(Z)z.description(Z),z._executableHandler=!0;if(J.isDefault)this._defaultCommandName=z._name;if(z._hidden=!!(J.noHelp||J.hidden),z._executableFile=J.executableFile||null,Y)z.arguments(Y);if(this._registerCommand(z),z.parent=this,z.copyInheritedSettings(this),Z)return this;return z}createCommand(_){return new Q8(_)}createHelp(){return Object.assign(new wJ,this.configureHelp())}configureHelp(_){if(_===void 0)return this._helpConfiguration;return this._helpConfiguration=_,this}configureOutput(_){if(_===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,_),this}showHelpAfterError(_=!0){if(typeof _!=="string")_=!!_;return this._showHelpAfterError=_,this}showSuggestionAfterError(_=!0){return this._showSuggestionAfterError=!!_,this}addCommand(_,$){if(!_._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=_._name;if($.noHelp||$.hidden)_._hidden=!0;return this._registerCommand(_),_.parent=this,_._checkForBrokenPassThrough(),this}createArgument(_,$){return new TJ(_,$)}argument(_,$,X,Z){let J=this.createArgument(_,$);if(typeof X==="function")J.default(Z).argParser(X);else J.default(X);return this.addArgument(J),this}arguments(_){return _.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(_){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw Error(`only the last argument can be variadic '${$.name()}'`);if(_.required&&_.defaultValue!==void 0&&_.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${_.name()}'`);return this.registeredArguments.push(_),this}helpCommand(_,$){if(typeof _==="boolean")return this._addImplicitHelpCommand=_,this;_=_??"help [command]";let[,X,Z]=_.match(/([^ ]+) *(.*)/),J=$??"display help for command",G=this.createCommand(X);if(G.helpOption(!1),Z)G.arguments(Z);if(J)G.description(J);return this._addImplicitHelpCommand=!0,this._helpCommand=G,this}addHelpCommand(_,$){if(typeof _!=="object")return this.helpCommand(_,$),this;return this._addImplicitHelpCommand=!0,this._helpCommand=_,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook(_,$){let X=["preSubcommand","preAction","postAction"];if(!X.includes(_))throw Error(`Unexpected value for event passed to hook : '${_}'.
Expecting one of '${X.join("', '")}'`);if(this._lifeCycleHooks[_])this._lifeCycleHooks[_].push($);else this._lifeCycleHooks[_]=[$];return this}exitOverride(_){if(_)this._exitCallback=_;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(_,$,X){if(this._exitCallback)this._exitCallback(new I8(_,$,X));e.exit(_)}action(_){let $=(X)=>{let Z=this.registeredArguments.length,J=X.slice(0,Z);if(this._storeOptionsAsProperties)J[Z]=this;else J[Z]=this.opts();return J.push(this),_.apply(this,J)};return this._actionHandler=$,this}createOption(_,$){return new b5(_,$)}_callParseArg(_,$,X,Z){try{return _.parseArg($,X)}catch(J){if(J.code==="commander.invalidArgument"){let G=`${Z} ${J.message}`;this.error(G,{exitCode:J.exitCode,code:J.code})}throw J}}_registerOption(_){let $=_.short&&this._findOption(_.short)||_.long&&this._findOption(_.long);if($){let X=_.long&&this._findOption(_.long)?_.long:_.short;throw Error(`Cannot add option '${_.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${X}'
-  already used by option '${$.flags}'`)}this.options.push(_)}_registerCommand(_){let $=(Z)=>{return[Z.name()].concat(Z.aliases())},X=$(_).find((Z)=>this._findCommand(Z));if(X){let Z=$(this._findCommand(X)).join("|"),J=$(_).join("|");throw Error(`cannot add command '${J}' as already have command '${Z}'`)}this.commands.push(_)}addOption(_){this._registerOption(_);let $=_.name(),X=_.attributeName();if(_.negate){let J=_.long.replace(/^--no-/,"--");if(!this._findOption(J))this.setOptionValueWithSource(X,_.defaultValue===void 0?!0:_.defaultValue,"default")}else if(_.defaultValue!==void 0)this.setOptionValueWithSource(X,_.defaultValue,"default");let Z=(J,G,Y)=>{if(J==null&&_.presetArg!==void 0)J=_.presetArg;let z=this.getOptionValue(X);if(J!==null&&_.parseArg)J=this._callParseArg(_,J,z,G);else if(J!==null&&_.variadic)J=_._concatValue(J,z);if(J==null)if(_.negate)J=!1;else if(_.isBoolean()||_.optional)J=!0;else J="";this.setOptionValueWithSource(X,J,Y)};if(this.on("option:"+$,(J)=>{let G=`error: option '${_.flags}' argument '${J}' is invalid.`;Z(J,G,"cli")}),_.envVar)this.on("optionEnv:"+$,(J)=>{let G=`error: option '${_.flags}' value '${J}' from env '${_.envVar}' is invalid.`;Z(J,G,"env")});return this}_optionEx(_,$,X,Z,J){if(typeof $==="object"&&$ instanceof b5)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let G=this.createOption($,X);if(G.makeOptionMandatory(!!_.mandatory),typeof Z==="function")G.default(J).argParser(Z);else if(Z instanceof RegExp){let Y=Z;Z=(z,H)=>{let F=Y.exec(z);return F?F[0]:H},G.default(J).argParser(Z)}else G.default(Z);return this.addOption(G)}option(_,$,X,Z){return this._optionEx({},_,$,X,Z)}requiredOption(_,$,X,Z){return this._optionEx({mandatory:!0},_,$,X,Z)}combineFlagAndOptionalValue(_=!0){return this._combineFlagAndOptionalValue=!!_,this}allowUnknownOption(_=!0){return this._allowUnknownOption=!!_,this}allowExcessArguments(_=!0){return this._allowExcessArguments=!!_,this}enablePositionalOptions(_=!0){return this._enablePositionalOptions=!!_,this}passThroughOptions(_=!0){return this._passThroughOptions=!!_,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(_=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!_,this}getOptionValue(_){if(this._storeOptionsAsProperties)return this[_];return this._optionValues[_]}setOptionValue(_,$){return this.setOptionValueWithSource(_,$,void 0)}setOptionValueWithSource(_,$,X){if(this._storeOptionsAsProperties)this[_]=$;else this._optionValues[_]=$;return this._optionValueSources[_]=X,this}getOptionValueSource(_){return this._optionValueSources[_]}getOptionValueSourceWithGlobals(_){let $;return this._getCommandAndAncestors().forEach((X)=>{if(X.getOptionValueSource(_)!==void 0)$=X.getOptionValueSource(_)}),$}_prepareUserArgs(_,$){if(_!==void 0&&!Array.isArray(_))throw Error("first parameter to parse must be array or undefined");if($=$||{},_===void 0&&$.from===void 0){if(e.versions?.electron)$.from="electron";let Z=e.execArgv??[];if(Z.includes("-e")||Z.includes("--eval")||Z.includes("-p")||Z.includes("--print"))$.from="eval"}if(_===void 0)_=e.argv;this.rawArgs=_.slice();let X;switch($.from){case void 0:case"node":this._scriptPath=_[1],X=_.slice(2);break;case"electron":if(e.defaultApp)this._scriptPath=_[1],X=_.slice(2);else X=_.slice(1);break;case"user":X=_.slice(0);break;case"eval":X=_.slice(1);break;default:throw Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",X}parse(_,$){let X=this._prepareUserArgs(_,$);return this._parseCommand([],X),this}async parseAsync(_,$){let X=this._prepareUserArgs(_,$);return await this._parseCommand([],X),this}_executeSubCommand(_,$){$=$.slice();let X=!1,Z=[".js",".ts",".tsx",".mjs",".cjs"];function J(F,W){let A=K1.resolve(F,W);if(B8.existsSync(A))return A;if(Z.includes(K1.extname(W)))return;let K=Z.find((D)=>B8.existsSync(`${A}${D}`));if(K)return`${A}${K}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let G=_._executableFile||`${this._name}-${_._name}`,Y=this._executableDir||"";if(this._scriptPath){let F;try{F=B8.realpathSync(this._scriptPath)}catch(W){F=this._scriptPath}Y=K1.resolve(K1.dirname(F),Y)}if(Y){let F=J(Y,G);if(!F&&!_._executableFile&&this._scriptPath){let W=K1.basename(this._scriptPath,K1.extname(this._scriptPath));if(W!==this._name)F=J(Y,`${W}-${_._name}`)}G=F||G}X=Z.includes(K1.extname(G));let z;if(e.platform!=="win32")if(X)$.unshift(G),$=p5(e.execArgv).concat($),z=M8.spawn(e.argv[0],$,{stdio:"inherit"});else z=M8.spawn(G,$,{stdio:"inherit"});else $.unshift(G),$=p5(e.execArgv).concat($),z=M8.spawn(e.execPath,$,{stdio:"inherit"});if(!z.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((W)=>{e.on(W,()=>{if(z.killed===!1&&z.exitCode===null)z.kill(W)})});let H=this._exitCallback;z.on("close",(F)=>{if(F=F??1,!H)e.exit(F);else H(new I8(F,"commander.executeSubCommandAsync","(close)"))}),z.on("error",(F)=>{if(F.code==="ENOENT"){let W=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",A=`'${G}' does not exist
 - if '${_._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${W}`;throw Error(A)}else if(F.code==="EACCES")throw Error(`'${G}' not executable`);if(!H)e.exit(1);else{let W=new I8(1,"commander.executeSubCommandAsync","(error)");W.nestedError=F,H(W)}}),this.runningCommand=z}_dispatchSubcommand(_,$,X){let Z=this._findCommand(_);if(!Z)this.help({error:!0});let J;return J=this._chainOrCallSubCommandHook(J,Z,"preSubcommand"),J=this._chainOrCall(J,()=>{if(Z._executableHandler)this._executeSubCommand(Z,$.concat(X));else return Z._parseCommand($,X)}),J}_dispatchHelpCommand(_){if(!_)this.help();let $=this._findCommand(_);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(_,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((_,$)=>{if(_.required&&this.args[$]==null)this.missingArgument(_.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let _=(X,Z,J)=>{let G=Z;if(Z!==null&&X.parseArg){let Y=`error: command-argument value '${Z}' is invalid for argument '${X.name()}'.`;G=this._callParseArg(X,Z,J,Y)}return G};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((X,Z)=>{let J=X.defaultValue;if(X.variadic){if(Z<this.args.length){if(J=this.args.slice(Z),X.parseArg)J=J.reduce((G,Y)=>{return _(X,Y,G)},X.defaultValue)}else if(J===void 0)J=[]}else if(Z<this.args.length){if(J=this.args[Z],X.parseArg)J=_(X,J,X.defaultValue)}$[Z]=J}),this.processedArgs=$}_chainOrCall(_,$){if(_&&_.then&&typeof _.then==="function")return _.then(()=>$());return $()}_chainOrCallHooks(_,$){let X=_,Z=[];if(this._getCommandAndAncestors().reverse().filter((J)=>J._lifeCycleHooks[$]!==void 0).forEach((J)=>{J._lifeCycleHooks[$].forEach((G)=>{Z.push({hookedCommand:J,callback:G})})}),$==="postAction")Z.reverse();return Z.forEach((J)=>{X=this._chainOrCall(X,()=>{return J.callback(J.hookedCommand,this)})}),X}_chainOrCallSubCommandHook(_,$,X){let Z=_;if(this._lifeCycleHooks[X]!==void 0)this._lifeCycleHooks[X].forEach((J)=>{Z=this._chainOrCall(Z,()=>{return J(this,$)})});return Z}_parseCommand(_,$){let X=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),_=_.concat(X.operands),$=X.unknown,this.args=_.concat($),_&&this._findCommand(_[0]))return this._dispatchSubcommand(_[0],_.slice(1),$);if(this._getHelpCommand()&&_[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(_[1]);if(this._defaultCommandName)return this._outputHelpIfRequested($),this._dispatchSubcommand(this._defaultCommandName,_,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(X.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Z=()=>{if(X.unknown.length>0)this.unknownOption(X.unknown[0])},J=`command:${this.name()}`;if(this._actionHandler){Z(),this._processArguments();let G;if(G=this._chainOrCallHooks(G,"preAction"),G=this._chainOrCall(G,()=>this._actionHandler(this.processedArgs)),this.parent)G=this._chainOrCall(G,()=>{this.parent.emit(J,_,$)});return G=this._chainOrCallHooks(G,"postAction"),G}if(this.parent&&this.parent.listenerCount(J))Z(),this._processArguments(),this.parent.emit(J,_,$);else if(_.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",_,$);if(this.listenerCount("command:*"))this.emit("command:*",_,$);else if(this.commands.length)this.unknownCommand();else Z(),this._processArguments()}else if(this.commands.length)Z(),this.help({error:!0});else Z(),this._processArguments()}_findCommand(_){if(!_)return;return this.commands.find(($)=>$._name===_||$._aliases.includes(_))}_findOption(_){return this.options.find(($)=>$.is(_))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((_)=>{_.options.forEach(($)=>{if($.mandatory&&_.getOptionValue($.attributeName())===void 0)_.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let _=this.options.filter((X)=>{let Z=X.attributeName();if(this.getOptionValue(Z)===void 0)return!1;return this.getOptionValueSource(Z)!=="default"});_.filter((X)=>X.conflictsWith.length>0).forEach((X)=>{let Z=_.find((J)=>X.conflictsWith.includes(J.attributeName()));if(Z)this._conflictingOption(X,Z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((_)=>{_._checkForConflictingLocalOptions()})}parseOptions(_){let $=[],X=[],Z=$,J=_.slice();function G(z){return z.length>1&&z[0]==="-"}let Y=null;while(J.length){let z=J.shift();if(z==="--"){if(Z===X)Z.push(z);Z.push(...J);break}if(Y&&!G(z)){this.emit(`option:${Y.name()}`,z);continue}if(Y=null,G(z)){let H=this._findOption(z);if(H){if(H.required){let F=J.shift();if(F===void 0)this.optionMissingArgument(H);this.emit(`option:${H.name()}`,F)}else if(H.optional){let F=null;if(J.length>0&&!G(J[0]))F=J.shift();this.emit(`option:${H.name()}`,F)}else this.emit(`option:${H.name()}`);Y=H.variadic?H:null;continue}}if(z.length>2&&z[0]==="-"&&z[1]!=="-"){let H=this._findOption(`-${z[1]}`);if(H){if(H.required||H.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${H.name()}`,z.slice(2));else this.emit(`option:${H.name()}`),J.unshift(`-${z.slice(2)}`);continue}}if(/^--[^=]+=/.test(z)){let H=z.indexOf("="),F=this._findOption(z.slice(0,H));if(F&&(F.required||F.optional)){this.emit(`option:${F.name()}`,z.slice(H+1));continue}}if(G(z))Z=X;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&X.length===0){if(this._findCommand(z)){if($.push(z),J.length>0)X.push(...J);break}else if(this._getHelpCommand()&&z===this._getHelpCommand().name()){if($.push(z),J.length>0)$.push(...J);break}else if(this._defaultCommandName){if(X.push(z),J.length>0)X.push(...J);break}}if(this._passThroughOptions){if(Z.push(z),J.length>0)Z.push(...J);break}Z.push(z)}return{operands:$,unknown:X}}opts(){if(this._storeOptionsAsProperties){let _={},$=this.options.length;for(let X=0;X<$;X++){let Z=this.options[X].attributeName();_[Z]=Z===this._versionOptionName?this._version:this[Z]}return _}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((_,$)=>Object.assign(_,$.opts()),{})}error(_,$){if(this._outputConfiguration.outputError(`${_}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let X=$||{},Z=X.exitCode||1,J=X.code||"commander.error";this._exit(Z,J,_)}_parseOptionsEnv(){this.options.forEach((_)=>{if(_.envVar&&_.envVar in e.env){let $=_.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(_.required||_.optional)this.emit(`optionEnv:${_.name()}`,e.env[_.envVar]);else this.emit(`optionEnv:${_.name()}`)}})}_parseOptionsImplied(){let _=new PJ(this.options),$=(X)=>{return this.getOptionValue(X)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(X))};this.options.filter((X)=>X.implied!==void 0&&$(X.attributeName())&&_.valueFromOption(this.getOptionValue(X.attributeName()),X)).forEach((X)=>{Object.keys(X.implied).filter((Z)=>!$(Z)).forEach((Z)=>{this.setOptionValueWithSource(Z,X.implied[Z],"implied")})})}missingArgument(_){let $=`error: missing required argument '${_}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(_){let $=`error: option '${_.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(_){let $=`error: required option '${_.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(_,$){let X=(G)=>{let Y=G.attributeName(),z=this.getOptionValue(Y),H=this.options.find((W)=>W.negate&&Y===W.attributeName()),F=this.options.find((W)=>!W.negate&&Y===W.attributeName());if(H&&(H.presetArg===void 0&&z===!1||H.presetArg!==void 0&&z===H.presetArg))return H;return F||G},Z=(G)=>{let Y=X(G),z=Y.attributeName();if(this.getOptionValueSource(z)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},J=`error: ${Z(_)} cannot be used with ${Z($)}`;this.error(J,{code:"commander.conflictingOption"})}unknownOption(_){if(this._allowUnknownOption)return;let $="";if(_.startsWith("--")&&this._showSuggestionAfterError){let Z=[],J=this;do{let G=J.createHelp().visibleOptions(J).filter((Y)=>Y.long).map((Y)=>Y.long);Z=Z.concat(G),J=J.parent}while(J&&!J._enablePositionalOptions);$=g5(_,Z)}let X=`error: unknown option '${_}'${$}`;this.error(X,{code:"commander.unknownOption"})}_excessArguments(_){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,X=$===1?"":"s",J=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${X} but got ${_.length}.`;this.error(J,{code:"commander.excessArguments"})}unknownCommand(){let _=this.args[0],$="";if(this._showSuggestionAfterError){let Z=[];this.createHelp().visibleCommands(this).forEach((J)=>{if(Z.push(J.name()),J.alias())Z.push(J.alias())}),$=g5(_,Z)}let X=`error: unknown command '${_}'${$}`;this.error(X,{code:"commander.unknownCommand"})}version(_,$,X){if(_===void 0)return this._version;this._version=_,$=$||"-V, --version",X=X||"output the version number";let Z=this.createOption($,X);return this._versionOptionName=Z.attributeName(),this._registerOption(Z),this.on("option:"+Z.name(),()=>{this._outputConfiguration.writeOut(`${_}
`),this._exit(0,"commander.version",_)}),this}description(_,$){if(_===void 0&&$===void 0)return this._description;if(this._description=_,$)this._argsDescription=$;return this}summary(_){if(_===void 0)return this._summary;return this._summary=_,this}alias(_){if(_===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(_===$._name)throw Error("Command alias can't be the same as its name");let X=this.parent?._findCommand(_);if(X){let Z=[X.name()].concat(X.aliases()).join("|");throw Error(`cannot add alias '${_}' to command '${this.name()}' as already have command '${Z}'`)}return $._aliases.push(_),this}aliases(_){if(_===void 0)return this._aliases;return _.forEach(($)=>this.alias($)),this}usage(_){if(_===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((X)=>{return LJ(X)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=_,this}name(_){if(_===void 0)return this._name;return this._name=_,this}nameFromFilename(_){return this._name=K1.basename(_,K1.extname(_)),this}executableDir(_){if(_===void 0)return this._executableDir;return this._executableDir=_,this}helpInformation(_){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=_&&_.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(_){_=_||{};let $={error:!!_.error},X;if($.error)X=(Z)=>this._outputConfiguration.writeErr(Z);else X=(Z)=>this._outputConfiguration.writeOut(Z);return $.write=_.write||X,$.command=this,$}outputHelp(_){let $;if(typeof _==="function")$=_,_=void 0;let X=this._getHelpContext(_);this._getCommandAndAncestors().reverse().forEach((J)=>J.emit("beforeAllHelp",X)),this.emit("beforeHelp",X);let Z=this.helpInformation(X);if($){if(Z=$(Z),typeof Z!=="string"&&!Buffer.isBuffer(Z))throw Error("outputHelp callback must return a string or a Buffer")}if(X.write(Z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",X),this._getCommandAndAncestors().forEach((J)=>J.emit("afterAllHelp",X))}helpOption(_,$){if(typeof _==="boolean"){if(_)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return _=_??"-h, --help",$=$??"display help for command",this._helpOption=this.createOption(_,$),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption(_){return this._helpOption=_,this}help(_){this.outputHelp(_);let $=e.exitCode||0;if($===0&&_&&typeof _!=="function"&&_.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(_,$){let X=["beforeAll","before","after","afterAll"];if(!X.includes(_))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${X.join("', '")}'`);let Z=`${_}Help`;return this.on(Z,(J)=>{let G;if(typeof $==="function")G=$({error:J.error,command:J.command});else G=$;if(G)J.write(`${G}
`)}),this}_outputHelpIfRequested(_){let $=this._getHelpOption();if($&&_.find((Z)=>$.is(Z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function p5(_){return _.map(($)=>{if(!$.startsWith("--inspect"))return $;let X,Z="127.0.0.1",J="9229",G;if((G=$.match(/^(--inspect(-brk)?)$/))!==null)X=G[1];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(X=G[1],/^\d+$/.test(G[3]))J=G[3];else Z=G[3];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)X=G[1],Z=G[3],J=G[4];if(X&&J!=="0")return`${X}=${Z}:${parseInt(J)+1}`;return $})}xJ.Command=Q8});var l5=l((kJ)=>{var{Argument:u5}=X6(),{Command:E8}=m5(),{CommanderError:CJ,InvalidArgumentError:d5}=$_(),{Help:SJ}=V8(),{Option:c5}=N8();kJ.program=new E8;kJ.createCommand=(_)=>new E8(_);kJ.createOption=(_,$)=>new c5(_,$);kJ.createArgument=(_,$)=>new u5(_,$);kJ.Command=E8;kJ.Option=c5;kJ.Argument=u5;kJ.Help=SJ;kJ.CommanderError=CJ;kJ.InvalidArgumentError=d5;kJ.InvalidOptionArgumentError=d5});var v3=l((BK,O6)=>{function T3(_){return Array.isArray(_)?_:[_]}var vG=void 0,m8="",E3=" ",p8="\\",yG=/^\s+$/,hG=/(?:[^\\]|^)\\$/,fG=/^\\!/,bG=/^\\#/,gG=/\r?\n/g,pG=/^\.{0,2}\/|^\.{1,2}$/,mG=/\/$/,R2="/",L3="node-ignore";if(typeof Symbol<"u")L3=Symbol.for("node-ignore");var w3=L3,V2=(_,$,X)=>{return Object.defineProperty(_,$,{value:X}),X},uG=/([0-z])-([0-z])/g,P3=()=>!1,dG=(_)=>_.replace(uG,($,X,Z)=>X.charCodeAt(0)<=Z.charCodeAt(0)?$:m8),cG=(_)=>{let{length:$}=_;return _.slice(0,$-$%2)},lG=[[/^\uFEFF/,()=>m8],[/((?:\\\\)*?)(\\?\s+)$/,(_,$,X)=>$+(X.indexOf("\\")===0?E3:m8)],[/(\\+?)\s/g,(_,$)=>{let{length:X}=$;return $.slice(0,X-X%2)+E3}],[/[\\$.|*+(){^]/g,(_)=>`\\${_}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return!/\/(?!$)/.test(this)?"(?:^|\\/)":"^"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(_,$,X)=>$+6<X.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(_,$,X)=>{let Z=X.replace(/\\\*/g,"[^\\/]*");return $+Z}],[/\\\\\\(?=[$.|*+(){^])/g,()=>p8],[/\\\\/g,()=>p8],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(_,$,X,Z,J)=>$===p8?`\\[${X}${cG(Z)}${J}`:J==="]"?Z.length%2===0?`[${dG(X)}${Z}]`:"[]":"[]"],[/(?:[^*])$/,(_)=>/\/$/.test(_)?`${_}$`:`${_}(?=$|\\/$)`]],iG=/(^|\\\/)?\\\*$/,z_="regex",A6="checkRegex",j3="_",nG={[z_](_,$){return`${$?`${$}[^/]+`:"[^/]*"}(?=$|\\/$)`},[A6](_,$){return`${$?`${$}[^/]*`:"[^/]*"}(?=$|\\/$)`}},oG=(_)=>lG.reduce(($,[X,Z])=>$.replace(X,Z.bind(_)),_),K6=(_)=>typeof _==="string",sG=(_)=>_&&K6(_)&&!yG.test(_)&&!hG.test(_)&&_.indexOf("#")!==0,rG=(_)=>_.split(gG).filter(Boolean);class x3{constructor(_,$,X,Z,J,G){this.pattern=_,this.mark=$,this.negative=J,V2(this,"body",X),V2(this,"ignoreCase",Z),V2(this,"regexPrefix",G)}get regex(){let _=j3+z_;if(this[_])return this[_];return this._make(z_,_)}get checkRegex(){let _=j3+A6;if(this[_])return this[_];return this._make(A6,_)}_make(_,$){let X=this.regexPrefix.replace(iG,nG[_]),Z=this.ignoreCase?new RegExp(X,"i"):new RegExp(X);return V2(this,$,Z)}}var aG=({pattern:_,mark:$},X)=>{let Z=!1,J=_;if(J.indexOf("!")===0)Z=!0,J=J.substr(1);J=J.replace(fG,"!").replace(bG,"#");let G=oG(J);return new x3(_,$,J,X,Z,G)};class q3{constructor(_){this._ignoreCase=_,this._rules=[]}_add(_){if(_&&_[w3]){this._rules=this._rules.concat(_._rules._rules),this._added=!0;return}if(K6(_))_={pattern:_};if(sG(_.pattern)){let $=aG(_,this._ignoreCase);this._added=!0,this._rules.push($)}}add(_){return this._added=!1,T3(K6(_)?rG(_):_).forEach(this._add,this),this._added}test(_,$,X){let Z=!1,J=!1,G;this._rules.forEach((z)=>{let{negative:H}=z;if(J===H&&Z!==J||H&&!Z&&!J&&!$)return;if(!z[X].test(_))return;Z=!H,J=H,G=H?vG:z});let Y={ignored:Z,unignored:J};if(G)Y.rule=G;return Y}}var tG=(_,$)=>{throw new $(_)},O1=(_,$,X)=>{if(!K6(_))return X(`path must be a string, but got \`${$}\``,TypeError);if(!_)return X("path must not be empty",TypeError);if(O1.isNotRelative(_))return X(`path should be a \`path.relative()\`d string, but got "${$}"`,RangeError);return!0},C3=(_)=>pG.test(_);O1.isNotRelative=C3;O1.convert=(_)=>_;class S3{constructor({ignorecase:_=!0,ignoreCase:$=_,allowRelativePaths:X=!1}={}){V2(this,w3,!0),this._rules=new q3($),this._strictPathCheck=!X,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(_){if(this._rules.add(_))this._initCache();return this}addPattern(_){return this.add(_)}_test(_,$,X,Z){let J=_&&O1.convert(_);return O1(J,_,this._strictPathCheck?tG:P3),this._t(J,$,X,Z)}checkIgnore(_){if(!mG.test(_))return this.test(_);let $=_.split(R2).filter(Boolean);if($.pop(),$.length){let X=this._t($.join(R2)+R2,this._testCache,!0,$);if(X.ignored)return X}return this._rules.test(_,!1,A6)}_t(_,$,X,Z){if(_ in $)return $[_];if(!Z)Z=_.split(R2).filter(Boolean);if(Z.pop(),!Z.length)return $[_]=this._rules.test(_,X,z_);let J=this._t(Z.join(R2)+R2,$,X,Z);return $[_]=J.ignored?J:this._rules.test(_,X,z_)}ignores(_){return this._test(_,this._ignoreCache,!1).ignored}createFilter(){return(_)=>!this.ignores(_)}filter(_){return T3(_).filter(this.createFilter())}test(_){return this._test(_,this._testCache,!0)}}var u8=(_)=>new S3(_),eG=(_)=>O1(_&&O1.convert(_),_,P3),k3=()=>{let _=(X)=>/^\\\\\?\\/.test(X)||/["<>|\u0000-\u001F]+/u.test(X)?X:X.replace(/\\/g,"/");O1.convert=_;let $=/^[a-z]:\//i;O1.isNotRelative=(X)=>$.test(X)||C3(X)};if(typeof process<"u"&&process.platform==="win32")k3();O6.exports=u8;u8.default=u8;O6.exports.isPathValid=eG;V2(O6.exports,Symbol.for("setupWindows"),k3)});var c7=l((p0)=>{var TY=p0&&p0.__createBinding||(Object.create?function(_,$,X,Z){if(Z===void 0)Z=X;var J=Object.getOwnPropertyDescriptor($,X);if(!J||("get"in J?!$.__esModule:J.writable||J.configurable))J={enumerable:!0,get:function(){return $[X]}};Object.defineProperty(_,Z,J)}:function(_,$,X,Z){if(Z===void 0)Z=X;_[Z]=$[X]}),LY=p0&&p0.__setModuleDefault||(Object.create?function(_,$){Object.defineProperty(_,"default",{enumerable:!0,value:$})}:function(_,$){_.default=$}),d7=p0&&p0.__importStar||function(_){if(_&&_.__esModule)return _;var $={};if(_!=null){for(var X in _)if(X!=="default"&&Object.prototype.hasOwnProperty.call(_,X))TY($,_,X)}return LY($,_),$};Object.defineProperty(p0,"__esModule",{value:!0});p0.load=p0.currentTarget=void 0;var wY=d7(y("path")),PY=d7(y("fs"));function xY(){let _=null;switch(process.platform){case"android":switch(process.arch){case"arm":return"android-arm-eabi";case"arm64":return"android-arm64"}_="Android";break;case"win32":switch(process.arch){case"x64":return"win32-x64-msvc";case"arm64":return"win32-arm64-msvc";case"ia32":return"win32-ia32-msvc"}_="Windows";break;case"darwin":switch(process.arch){case"x64":return"darwin-x64";case"arm64":return"darwin-arm64"}_="macOS";break;case"linux":switch(process.arch){case"x64":case"arm64":return qY()?`linux-${process.arch}-gnu`:`linux-${process.arch}-musl`;case"arm":return"linux-arm-gnueabihf"}_="Linux";break;case"freebsd":if(process.arch==="x64")return"freebsd-x64";_="FreeBSD";break}if(_)throw Error(`Neon: unsupported ${_} architecture: ${process.arch}`);throw Error(`Neon: unsupported system: ${process.platform}`)}p0.currentTarget=xY;function qY(){let _=process.report?.getReport();if(typeof _!=="object"||!_||!("header"in _))return!1;let $=_.header;return typeof $==="object"&&!!$&&"glibcVersionRuntime"in $}function CY(_){let $=wY.join(_,"index.node");return PY.existsSync($)?y($):null}p0.load=CY});var n7=l((ZD,i7)=>{var l7=()=>process.platform==="linux",H4=null,SY=()=>{if(!H4)H4=l7()&&process.report?process.report.getReport():{};return H4};i7.exports={isLinux:l7,getReport:SY}});var r7=l((JD,s7)=>{var o7=y("fs"),kY=(_)=>o7.readFileSync(_,"utf-8"),vY=(_)=>new Promise(($,X)=>{o7.readFile(_,"utf-8",(Z,J)=>{if(Z)X(Z);else $(J)})});s7.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:kY,readFile:vY}});var K9=l((GD,A9)=>{var t7=y("child_process"),{isLinux:j2,getReport:e7}=n7(),{LDD_PATH:j6,readFile:_9,readFileSync:$9}=r7(),G1,Y1,q1="",X9=()=>{if(!q1)return new Promise((_)=>{t7.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",($,X)=>{q1=$?" ":X,_(q1)})});return q1},Z9=()=>{if(!q1)try{q1=t7.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(_){q1=" "}return q1},R1="glibc",J9=/GLIBC\s(\d+\.\d+)/,s1="musl",yY=R1.toUpperCase(),hY=s1.toLowerCase(),fY=(_)=>_.includes("libc.musl-")||_.includes("ld-musl-"),G9=()=>{let _=e7();if(_.header&&_.header.glibcVersionRuntime)return R1;if(Array.isArray(_.sharedObjects)){if(_.sharedObjects.some(fY))return s1}return null},Y9=(_)=>{let[$,X]=_.split(/[\r\n]+/);if($&&$.includes(R1))return R1;if(X&&X.includes(s1))return s1;return null},z9=(_)=>{if(_.includes(hY))return s1;if(_.includes(yY))return R1;return null},bY=async()=>{if(G1!==void 0)return G1;G1=null;try{let _=await _9(j6);G1=z9(_)}catch(_){}return G1},gY=()=>{if(G1!==void 0)return G1;G1=null;try{let _=$9(j6);G1=z9(_)}catch(_){}return G1},H9=async()=>{let _=null;if(j2()){if(_=await bY(),!_)_=G9();if(!_){let $=await X9();_=Y9($)}}return _},F9=()=>{let _=null;if(j2()){if(_=gY(),!_)_=G9();if(!_){let $=Z9();_=Y9($)}}return _},pY=async()=>j2()&&await H9()!==R1,mY=()=>j2()&&F9()!==R1,uY=async()=>{if(Y1!==void 0)return Y1;Y1=null;try{let $=(await _9(j6)).match(J9);if($)Y1=$[1]}catch(_){}return Y1},dY=()=>{if(Y1!==void 0)return Y1;Y1=null;try{let $=$9(j6).match(J9);if($)Y1=$[1]}catch(_){}return Y1},W9=()=>{let _=e7();if(_.header&&_.header.glibcVersionRuntime)return _.header.glibcVersionRuntime;return null},a7=(_)=>_.trim().split(/\s+/)[1],U9=(_)=>{let[$,X,Z]=_.split(/[\r\n]+/);if($&&$.includes(R1))return a7($);if(X&&Z&&X.includes(s1))return a7(Z);return null},cY=async()=>{let _=null;if(j2()){if(_=await uY(),!_)_=W9();if(!_){let $=await X9();_=U9($)}}return _},lY=()=>{let _=null;if(j2()){if(_=dY(),!_)_=W9();if(!_){let $=Z9();_=U9($)}}return _};A9.exports={GLIBC:R1,MUSL:s1,family:H9,familySync:F9,isNonGlibcLinux:pY,isNonGlibcLinuxSync:mY,version:cY,versionSync:lY}});var D9=l((YD,O9)=>{var iY={ALLOW:0,DENY:1};O9.exports=iY});var V9=l((zD,R9)=>{var F4={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function r1(_,$,X){if(new.target!==r1)return new r1(_,$);if(typeof $!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,_),F4.value=""+_,Object.defineProperty(this,"message",F4),Error.captureStackTrace(this,r1),this.code=$,this.rawCode=X}Object.setPrototypeOf(r1,Error);Object.setPrototypeOf(r1.prototype,Error.prototype);Object.defineProperty(r1.prototype,"name",F4);R9.exports=r1});var T9=l((HD,T6)=>{var __dirname="/Users/kyle/rules/node_modules/libsql",{load:nY,currentTarget:oY}=c7(),{familySync:N9,GLIBC:sY,MUSL:rY}=K9();function aY(){if(process.env.LIBSQL_JS_DEV)return nY(__dirname);let _=oY();if(N9()==sY)switch(_){case"linux-x64-musl":_="linux-x64-gnu";break;case"linux-arm64-musl":_="linux-arm64-gnu";break}if(_==="linux-arm-gnueabihf"&&N9()==rY)_="linux-arm-musleabihf";return y(`@libsql/${_}`)}var{databaseOpen:tY,databaseOpenWithSync:eY,databaseInTransaction:_z,databaseInterrupt:$z,databaseClose:Xz,databaseSyncSync:Zz,databaseSyncUntilSync:Jz,databaseExecSync:Gz,databasePrepareSync:Yz,databaseDefaultSafeIntegers:zz,databaseAuthorizer:Hz,databaseLoadExtension:Fz,databaseMaxWriteReplicationIndex:Wz,statementRaw:Uz,statementIsReader:Az,statementGet:M9,statementRun:B9,statementInterrupt:Kz,statementRowsSync:I9,statementColumns:Oz,statementSafeIntegers:Dz,rowsNext:Rz}=aY(),Vz=D9(),Q9=V9();function T2(_){if(_.libsqlError)return new Q9(_.message,_.code,_.rawCode);return _}class E9{constructor(_,$){let X=$?.encryptionCipher??"aes256cbc";if($&&$.syncUrl){var Z="";if($.syncAuth)console.warn("Warning: The `syncAuth` option is deprecated, please use `authToken` option instead."),Z=$.syncAuth;else if($.authToken)Z=$.authToken;let G=$?.encryptionKey??"",Y=$?.syncPeriod??0,z=$?.readYourWrites??!0,H=$?.offline??!1,F=$?.remoteEncryptionKey??"";this.db=eY(_,$.syncUrl,Z,X,G,Y,z,H,F)}else{let G=$?.authToken??"",Y=$?.encryptionKey??"",z=$?.timeout??0,H=$?.remoteEncryptionKey??"";this.db=tY(_,G,X,Y,z,H)}this.memory=_===":memory:",this.readonly=!1,this.name="",this.open=!0;let J=this.db;Object.defineProperties(this,{inTransaction:{get(){return _z(J)}}})}sync(){return Zz.call(this.db)}syncUntil(_){return Jz.call(this.db,_)}prepare(_){try{let $=Yz.call(this.db,_);return new j9($)}catch($){throw T2($)}}transaction(_){if(typeof _!=="function")throw TypeError("Expected first argument to be a function");let $=this,X=(J)=>{return(...G)=>{$.exec("BEGIN "+J);try{let Y=_(...G);return $.exec("COMMIT"),Y}catch(Y){throw $.exec("ROLLBACK"),Y}}},Z={default:{value:X("")},deferred:{value:X("DEFERRED")},immediate:{value:X("IMMEDIATE")},exclusive:{value:X("EXCLUSIVE")},database:{value:this,enumerable:!0}};return Object.defineProperties(Z.default.value,Z),Object.defineProperties(Z.deferred.value,Z),Object.defineProperties(Z.immediate.value,Z),Object.defineProperties(Z.exclusive.value,Z),Z.default.value}pragma(_,$){if($==null)$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");let X=$.simple,Z=this.prepare(`PRAGMA ${_}`,this,!0);return X?Z.pluck().get():Z.all()}backup(_,$){throw Error("not implemented")}serialize(_){throw Error("not implemented")}function(_,$,X){if($==null)$={};if(typeof $==="function")X=$,$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="function")throw TypeError("Expected last argument to be a function");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}aggregate(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object"||$===null)throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}table(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(!_)throw TypeError("Virtual table module name cannot be an empty string");throw Error("not implemented")}authorizer(_){Hz.call(this.db,_)}loadExtension(..._){Fz.call(this.db,..._)}maxWriteReplicationIndex(){return Wz.call(this.db)}exec(_){try{Gz.call(this.db,_)}catch($){throw T2($)}}interrupt(){$z.call(this.db)}close(){Xz.call(this.db),this.open=!1}defaultSafeIntegers(_){return zz.call(this.db,_??!0),this}unsafeMode(..._){throw Error("not implemented")}}class j9{constructor(_){this.stmt=_,this.pluckMode=!1}raw(_){return Uz.call(this.stmt,_??!0),this}pluck(_){return this.pluckMode=_??!0,this}get reader(){return Az.call(this.stmt)}run(..._){try{if(_.length==1&&typeof _[0]==="object")return B9.call(this.stmt,_[0]);else return B9.call(this.stmt,_.flat())}catch($){throw T2($)}}get(..._){try{if(_.length==1&&typeof _[0]==="object")return M9.call(this.stmt,_[0]);else return M9.call(this.stmt,_.flat())}catch($){throw T2($)}}iterate(..._){var $=void 0;if(_.length==1&&typeof _[0]==="object")$=I9.call(this.stmt,_[0]);else $=I9.call(this.stmt,_.flat());return{nextRows:Array(100),nextRowIndex:100,next(){try{if(this.nextRowIndex===100)Rz.call($,this.nextRows),this.nextRowIndex=0;let Z=this.nextRows[this.nextRowIndex];if(this.nextRows[this.nextRowIndex]=void 0,!Z)return{done:!0};return this.nextRowIndex++,{value:Z,done:!1}}catch(Z){throw T2(Z)}},[Symbol.iterator](){return this}}}all(..._){try{let $=[];for(let X of this.iterate(..._))if(this.pluckMode)$.push(X[Object.keys(X)[0]]);else $.push(X);return $}catch($){throw T2($)}}interrupt(){Kz.call(this.stmt)}columns(){return Oz.call(this.stmt)}safeIntegers(_){return Dz.call(this.stmt,_??!0),this}}T6.exports=E9;T6.exports.Authorization=Vz;T6.exports.SqliteError=Q9});var V1=l((RD,y9)=>{var k9=["nodebuffer","arraybuffer","fragments"],v9=typeof Blob<"u";if(v9)k9.push("blob");y9.exports={BINARY_TYPES:k9,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:v9,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var E_=l((VD,L6)=>{var{EMPTY_BUFFER:jz}=V1(),W4=Buffer[Symbol.species];function Tz(_,$){if(_.length===0)return jz;if(_.length===1)return _[0];let X=Buffer.allocUnsafe($),Z=0;for(let J=0;J<_.length;J++){let G=_[J];X.set(G,Z),Z+=G.length}if(Z<$)return new W4(X.buffer,X.byteOffset,Z);return X}function h9(_,$,X,Z,J){for(let G=0;G<J;G++)X[Z+G]=_[G]^$[G&3]}function f9(_,$){for(let X=0;X<_.length;X++)_[X]^=$[X&3]}function Lz(_){if(_.length===_.buffer.byteLength)return _.buffer;return _.buffer.slice(_.byteOffset,_.byteOffset+_.length)}function U4(_){if(U4.readOnly=!0,Buffer.isBuffer(_))return _;let $;if(_ instanceof ArrayBuffer)$=new W4(_);else if(ArrayBuffer.isView(_))$=new W4(_.buffer,_.byteOffset,_.byteLength);else $=Buffer.from(_),U4.readOnly=!1;return $}L6.exports={concat:Tz,mask:h9,toArrayBuffer:Lz,toBuffer:U4,unmask:f9};if(!process.env.WS_NO_BUFFER_UTIL)try{let _=(()=>{throw new Error("Cannot require module "+"bufferutil");})();L6.exports.mask=function($,X,Z,J,G){if(G<48)h9($,X,Z,J,G);else _.mask($,X,Z,J,G)},L6.exports.unmask=function($,X){if($.length<32)f9($,X);else _.unmask($,X)}}catch(_){}});var m9=l((ND,p9)=>{var b9=Symbol("kDone"),A4=Symbol("kRun");class g9{constructor(_){this[b9]=()=>{this.pending--,this[A4]()},this.concurrency=_||1/0,this.jobs=[],this.pending=0}add(_){this.jobs.push(_),this[A4]()}[A4](){if(this.pending===this.concurrency)return;if(this.jobs.length){let _=this.jobs.shift();this.pending++,_(this[b9])}}}p9.exports=g9});var T_=l((MD,i9)=>{var j_=y("zlib"),u9=E_(),wz=m9(),{kStatusCode:d9}=V1(),Pz=Buffer[Symbol.species],xz=Buffer.from([0,0,255,255]),P6=Symbol("permessage-deflate"),N1=Symbol("total-length"),L2=Symbol("callback"),C1=Symbol("buffers"),w2=Symbol("error"),w6;class c9{constructor(_,$,X){if(this._maxPayload=X|0,this._options=_||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!$,this._deflate=null,this._inflate=null,this.params=null,!w6){let Z=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;w6=new wz(Z)}}static get extensionName(){return"permessage-deflate"}offer(){let _={};if(this._options.serverNoContextTakeover)_.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)_.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)_.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)_.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)_.client_max_window_bits=!0;return _}accept(_){return _=this.normalizeParams(_),this.params=this._isServer?this.acceptAsServer(_):this.acceptAsClient(_),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let _=this._deflate[L2];if(this._deflate.close(),this._deflate=null,_)_(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(_){let $=this._options,X=_.find((Z)=>{if($.serverNoContextTakeover===!1&&Z.server_no_context_takeover||Z.server_max_window_bits&&($.serverMaxWindowBits===!1||typeof $.serverMaxWindowBits==="number"&&$.serverMaxWindowBits>Z.server_max_window_bits)||typeof $.clientMaxWindowBits==="number"&&!Z.client_max_window_bits)return!1;return!0});if(!X)throw Error("None of the extension offers can be accepted");if($.serverNoContextTakeover)X.server_no_context_takeover=!0;if($.clientNoContextTakeover)X.client_no_context_takeover=!0;if(typeof $.serverMaxWindowBits==="number")X.server_max_window_bits=$.serverMaxWindowBits;if(typeof $.clientMaxWindowBits==="number")X.client_max_window_bits=$.clientMaxWindowBits;else if(X.client_max_window_bits===!0||$.clientMaxWindowBits===!1)delete X.client_max_window_bits;return X}acceptAsClient(_){let $=_[0];if(this._options.clientNoContextTakeover===!1&&$.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!$.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")$.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&$.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return $}normalizeParams(_){return _.forEach(($)=>{Object.keys($).forEach((X)=>{let Z=$[X];if(Z.length>1)throw Error(`Parameter "${X}" must have only a single value`);if(Z=Z[0],X==="client_max_window_bits"){if(Z!==!0){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else if(X==="server_max_window_bits"){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(X==="client_no_context_takeover"||X==="server_no_context_takeover"){if(Z!==!0)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else throw Error(`Unknown parameter "${X}"`);$[X]=Z})}),_}decompress(_,$,X){w6.add((Z)=>{this._decompress(_,$,(J,G)=>{Z(),X(J,G)})})}compress(_,$,X){w6.add((Z)=>{this._compress(_,$,(J,G)=>{Z(),X(J,G)})})}_decompress(_,$,X){let Z=this._isServer?"client":"server";if(!this._inflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?j_.Z_DEFAULT_WINDOWBITS:this.params[J];this._inflate=j_.createInflateRaw({...this._options.zlibInflateOptions,windowBits:G}),this._inflate[P6]=this,this._inflate[N1]=0,this._inflate[C1]=[],this._inflate.on("error",Cz),this._inflate.on("data",l9)}if(this._inflate[L2]=X,this._inflate.write(_),$)this._inflate.write(xz);this._inflate.flush(()=>{let J=this._inflate[w2];if(J){this._inflate.close(),this._inflate=null,X(J);return}let G=u9.concat(this._inflate[C1],this._inflate[N1]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[N1]=0,this._inflate[C1]=[],$&&this.params[`${Z}_no_context_takeover`])this._inflate.reset();X(null,G)})}_compress(_,$,X){let Z=this._isServer?"server":"client";if(!this._deflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?j_.Z_DEFAULT_WINDOWBITS:this.params[J];this._deflate=j_.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:G}),this._deflate[N1]=0,this._deflate[C1]=[],this._deflate.on("data",qz)}this._deflate[L2]=X,this._deflate.write(_),this._deflate.flush(j_.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let J=u9.concat(this._deflate[C1],this._deflate[N1]);if($)J=new Pz(J.buffer,J.byteOffset,J.length-4);if(this._deflate[L2]=null,this._deflate[N1]=0,this._deflate[C1]=[],$&&this.params[`${Z}_no_context_takeover`])this._deflate.reset();X(null,J)})}}i9.exports=c9;function qz(_){this[C1].push(_),this[N1]+=_.length}function l9(_){if(this[N1]+=_.length,this[P6]._maxPayload<1||this[N1]<=this[P6]._maxPayload){this[C1].push(_);return}this[w2]=RangeError("Max payload size exceeded"),this[w2].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[w2][d9]=1009,this.removeListener("data",l9),this.reset()}function Cz(_){if(this[P6]._inflate=null,this[w2]){this[L2](this[w2]);return}_[d9]=1007,this[L2](_)}});var P2=l((BD,x6)=>{var{isUtf8:n9}=y("buffer"),{hasBlob:Sz}=V1(),kz=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function vz(_){return _>=1000&&_<=1014&&_!==1004&&_!==1005&&_!==1006||_>=3000&&_<=4999}function K4(_){let $=_.length,X=0;while(X<$)if((_[X]&128)===0)X++;else if((_[X]&224)===192){if(X+1===$||(_[X+1]&192)!==128||(_[X]&254)===192)return!1;X+=2}else if((_[X]&240)===224){if(X+2>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||_[X]===224&&(_[X+1]&224)===128||_[X]===237&&(_[X+1]&224)===160)return!1;X+=3}else if((_[X]&248)===240){if(X+3>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||(_[X+3]&192)!==128||_[X]===240&&(_[X+1]&240)===128||_[X]===244&&_[X+1]>143||_[X]>244)return!1;X+=4}else return!1;return!0}function yz(_){return Sz&&typeof _==="object"&&typeof _.arrayBuffer==="function"&&typeof _.type==="string"&&typeof _.stream==="function"&&(_[Symbol.toStringTag]==="Blob"||_[Symbol.toStringTag]==="File")}x6.exports={isBlob:yz,isValidStatusCode:vz,isValidUTF8:K4,tokenChars:kz};if(n9)x6.exports.isValidUTF8=function(_){return _.length<24?K4(_):n9(_)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let _=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();x6.exports.isValidUTF8=function($){return $.length<32?K4($):_($)}}catch(_){}});var D4=l((ID,t9)=>{var{Writable:hz}=y("stream"),o9=T_(),{BINARY_TYPES:fz,EMPTY_BUFFER:s9,kStatusCode:bz,kWebSocket:gz}=V1(),{concat:O4,toArrayBuffer:pz,unmask:mz}=E_(),{isValidStatusCode:uz,isValidUTF8:r9}=P2(),q6=Buffer[Symbol.species];class a9 extends hz{constructor(_={}){super();this._allowSynchronousEvents=_.allowSynchronousEvents!==void 0?_.allowSynchronousEvents:!0,this._binaryType=_.binaryType||fz[0],this._extensions=_.extensions||{},this._isServer=!!_.isServer,this._maxPayload=_.maxPayload|0,this._skipUTF8Validation=!!_.skipUTF8Validation,this[gz]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(_,$,X){if(this._opcode===8&&this._state==0)return X();this._bufferedBytes+=_.length,this._buffers.push(_),this.startLoop(X)}consume(_){if(this._bufferedBytes-=_,_===this._buffers[0].length)return this._buffers.shift();if(_<this._buffers[0].length){let X=this._buffers[0];return this._buffers[0]=new q6(X.buffer,X.byteOffset+_,X.length-_),new q6(X.buffer,X.byteOffset,_)}let $=Buffer.allocUnsafe(_);do{let X=this._buffers[0],Z=$.length-_;if(_>=X.length)$.set(this._buffers.shift(),Z);else $.set(new Uint8Array(X.buffer,X.byteOffset,_),Z),this._buffers[0]=new q6(X.buffer,X.byteOffset+_,X.length-_);_-=X.length}while(_>0);return $}startLoop(_){this._loop=!0;do switch(this._state){case 0:this.getInfo(_);break;case 1:this.getPayloadLength16(_);break;case 2:this.getPayloadLength64(_);break;case 3:this.getMask();break;case 4:this.getData(_);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)_()}getInfo(_){if(this._bufferedBytes<2){this._loop=!1;return}let $=this.consume(2);if(($[0]&48)!==0){let Z=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");_(Z);return}let X=($[0]&64)===64;if(X&&!this._extensions[o9.extensionName]){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._fin=($[0]&128)===128,this._opcode=$[0]&15,this._payloadLength=$[1]&127,this._opcode===0){if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(!this._fragmented){let Z=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._compressed=X}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let Z=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");_(Z);return}if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let Z=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");_(Z);return}}else{let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=($[1]&128)===128,this._isServer){if(!this._masked){let Z=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");_(Z);return}}else if(this._masked){let Z=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");_(Z);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(_)}getPayloadLength16(_){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(_)}getPayloadLength64(_){if(this._bufferedBytes<8){this._loop=!1;return}let $=this.consume(8),X=$.readUInt32BE(0);if(X>Math.pow(2,21)-1){let Z=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");_(Z);return}this._payloadLength=X*Math.pow(2,32)+$.readUInt32BE(4),this.haveLength(_)}haveLength(_){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let $=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");_($);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(_){let $=s9;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if($=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)mz($,this._mask)}if(this._opcode>7){this.controlMessage($,_);return}if(this._compressed){this._state=5,this.decompress($,_);return}if($.length)this._messageLength=this._totalPayloadLength,this._fragments.push($);this.dataMessage(_)}decompress(_,$){this._extensions[o9.extensionName].decompress(_,this._fin,(Z,J)=>{if(Z)return $(Z);if(J.length){if(this._messageLength+=J.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let G=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");$(G);return}this._fragments.push(J)}if(this.dataMessage($),this._state===0)this.startLoop($)})}dataMessage(_){if(!this._fin){this._state=0;return}let $=this._messageLength,X=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let Z;if(this._binaryType==="nodebuffer")Z=O4(X,$);else if(this._binaryType==="arraybuffer")Z=pz(O4(X,$));else if(this._binaryType==="blob")Z=new Blob(X);else Z=X;if(this._allowSynchronousEvents)this.emit("message",Z,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!0),this._state=0,this.startLoop(_)})}else{let Z=O4(X,$);if(!this._skipUTF8Validation&&!r9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");_(J);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",Z,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!1),this._state=0,this.startLoop(_)})}}controlMessage(_,$){if(this._opcode===8){if(_.length===0)this._loop=!1,this.emit("conclude",1005,s9),this.end();else{let X=_.readUInt16BE(0);if(!uz(X)){let J=this.createError(RangeError,`invalid status code ${X}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");$(J);return}let Z=new q6(_.buffer,_.byteOffset+2,_.length-2);if(!this._skipUTF8Validation&&!r9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");$(J);return}this._loop=!1,this.emit("conclude",X,Z),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",_),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",_),this._state=0,this.startLoop($)})}createError(_,$,X,Z,J){this._loop=!1,this._errored=!0;let G=new _(X?`Invalid WebSocket frame: ${$}`:$);return Error.captureStackTrace(G,this.createError),G.code=J,G[bz]=Z,G}}t9.exports=a9});var V4=l((ED,$$)=>{var{Duplex:QD}=y("stream"),{randomFillSync:dz}=y("crypto"),e9=T_(),{EMPTY_BUFFER:cz,kWebSocket:lz,NOOP:iz}=V1(),{isBlob:x2,isValidStatusCode:nz}=P2(),{mask:_$,toBuffer:a1}=E_(),m0=Symbol("kByteLength"),oz=Buffer.alloc(4),t1,q2=8192,n0=0,sz=1,rz=2;class S1{constructor(_,$,X){if(this._extensions=$||{},X)this._generateMask=X,this._maskBuffer=Buffer.alloc(4);this._socket=_,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=n0,this.onerror=iz,this[lz]=void 0}static frame(_,$){let X,Z=!1,J=2,G=!1;if($.mask){if(X=$.maskBuffer||oz,$.generateMask)$.generateMask(X);else{if(q2===8192){if(t1===void 0)t1=Buffer.alloc(8192);dz(t1,0,8192),q2=0}X[0]=t1[q2++],X[1]=t1[q2++],X[2]=t1[q2++],X[3]=t1[q2++]}G=(X[0]|X[1]|X[2]|X[3])===0,J=6}let Y;if(typeof _==="string")if((!$.mask||G)&&$[m0]!==void 0)Y=$[m0];else _=Buffer.from(_),Y=_.length;else Y=_.length,Z=$.mask&&$.readOnly&&!G;let z=Y;if(Y>=65536)J+=8,z=127;else if(Y>125)J+=2,z=126;let H=Buffer.allocUnsafe(Z?Y+J:J);if(H[0]=$.fin?$.opcode|128:$.opcode,$.rsv1)H[0]|=64;if(H[1]=z,z===126)H.writeUInt16BE(Y,2);else if(z===127)H[2]=H[3]=0,H.writeUIntBE(Y,4,6);if(!$.mask)return[H,_];if(H[1]|=128,H[J-4]=X[0],H[J-3]=X[1],H[J-2]=X[2],H[J-1]=X[3],G)return[H,_];if(Z)return _$(_,X,H,J,Y),[H];return _$(_,X,_,0,Y),[H,_]}close(_,$,X,Z){let J;if(_===void 0)J=cz;else if(typeof _!=="number"||!nz(_))throw TypeError("First argument must be a valid error code number");else if($===void 0||!$.length)J=Buffer.allocUnsafe(2),J.writeUInt16BE(_,0);else{let Y=Buffer.byteLength($);if(Y>123)throw RangeError("The message must not be greater than 123 bytes");if(J=Buffer.allocUnsafe(2+Y),J.writeUInt16BE(_,0),typeof $==="string")J.write($,2);else J.set($,2)}let G={[m0]:J.length,fin:!0,generateMask:this._generateMask,mask:X,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==n0)this.enqueue([this.dispatch,J,!1,G,Z]);else this.sendFrame(S1.frame(J,G),Z)}ping(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(x2(_))Z=_.size,J=!1;else _=a1(_),Z=_.length,J=a1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[m0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:9,readOnly:J,rsv1:!1};if(x2(_))if(this._state!==n0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==n0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(S1.frame(_,G),X)}pong(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(x2(_))Z=_.size,J=!1;else _=a1(_),Z=_.length,J=a1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[m0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:10,readOnly:J,rsv1:!1};if(x2(_))if(this._state!==n0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==n0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(S1.frame(_,G),X)}send(_,$,X){let Z=this._extensions[e9.extensionName],J=$.binary?2:1,G=$.compress,Y,z;if(typeof _==="string")Y=Buffer.byteLength(_),z=!1;else if(x2(_))Y=_.size,z=!1;else _=a1(_),Y=_.length,z=a1.readOnly;if(this._firstFragment){if(this._firstFragment=!1,G&&Z&&Z.params[Z._isServer?"server_no_context_takeover":"client_no_context_takeover"])G=Y>=Z._threshold;this._compress=G}else G=!1,J=0;if($.fin)this._firstFragment=!0;let H={[m0]:Y,fin:$.fin,generateMask:this._generateMask,mask:$.mask,maskBuffer:this._maskBuffer,opcode:J,readOnly:z,rsv1:G};if(x2(_))if(this._state!==n0)this.enqueue([this.getBlobData,_,this._compress,H,X]);else this.getBlobData(_,this._compress,H,X);else if(this._state!==n0)this.enqueue([this.dispatch,_,this._compress,H,X]);else this.dispatch(_,this._compress,H,X)}getBlobData(_,$,X,Z){this._bufferedBytes+=X[m0],this._state=rz,_.arrayBuffer().then((J)=>{if(this._socket.destroyed){let Y=Error("The socket was closed while the blob was being read");process.nextTick(R4,this,Y,Z);return}this._bufferedBytes-=X[m0];let G=a1(J);if(!$)this._state=n0,this.sendFrame(S1.frame(G,X),Z),this.dequeue();else this.dispatch(G,$,X,Z)}).catch((J)=>{process.nextTick(az,this,J,Z)})}dispatch(_,$,X,Z){if(!$){this.sendFrame(S1.frame(_,X),Z);return}let J=this._extensions[e9.extensionName];this._bufferedBytes+=X[m0],this._state=sz,J.compress(_,X.fin,(G,Y)=>{if(this._socket.destroyed){let z=Error("The socket was closed while data was being compressed");R4(this,z,Z);return}this._bufferedBytes-=X[m0],this._state=n0,X.readOnly=!1,this.sendFrame(S1.frame(Y,X),Z),this.dequeue()})}dequeue(){while(this._state===n0&&this._queue.length){let _=this._queue.shift();this._bufferedBytes-=_[3][m0],Reflect.apply(_[0],this,_.slice(1))}}enqueue(_){this._bufferedBytes+=_[3][m0],this._queue.push(_)}sendFrame(_,$){if(_.length===2)this._socket.cork(),this._socket.write(_[0]),this._socket.write(_[1],$),this._socket.uncork();else this._socket.write(_[0],$)}}$$.exports=S1;function R4(_,$,X){if(typeof X==="function")X($);for(let Z=0;Z<_._queue.length;Z++){let J=_._queue[Z],G=J[J.length-1];if(typeof G==="function")G($)}}function az(_,$,X){R4(_,$,X),_.onerror($)}});var W$=l((jD,F$)=>{var{kForOnEventAttribute:L_,kListener:N4}=V1(),X$=Symbol("kCode"),Z$=Symbol("kData"),J$=Symbol("kError"),G$=Symbol("kMessage"),Y$=Symbol("kReason"),C2=Symbol("kTarget"),z$=Symbol("kType"),H$=Symbol("kWasClean");class k1{constructor(_){this[C2]=null,this[z$]=_}get target(){return this[C2]}get type(){return this[z$]}}Object.defineProperty(k1.prototype,"target",{enumerable:!0});Object.defineProperty(k1.prototype,"type",{enumerable:!0});class S2 extends k1{constructor(_,$={}){super(_);this[X$]=$.code===void 0?0:$.code,this[Y$]=$.reason===void 0?"":$.reason,this[H$]=$.wasClean===void 0?!1:$.wasClean}get code(){return this[X$]}get reason(){return this[Y$]}get wasClean(){return this[H$]}}Object.defineProperty(S2.prototype,"code",{enumerable:!0});Object.defineProperty(S2.prototype,"reason",{enumerable:!0});Object.defineProperty(S2.prototype,"wasClean",{enumerable:!0});class w_ extends k1{constructor(_,$={}){super(_);this[J$]=$.error===void 0?null:$.error,this[G$]=$.message===void 0?"":$.message}get error(){return this[J$]}get message(){return this[G$]}}Object.defineProperty(w_.prototype,"error",{enumerable:!0});Object.defineProperty(w_.prototype,"message",{enumerable:!0});class S6 extends k1{constructor(_,$={}){super(_);this[Z$]=$.data===void 0?null:$.data}get data(){return this[Z$]}}Object.defineProperty(S6.prototype,"data",{enumerable:!0});var tz={addEventListener(_,$,X={}){for(let J of this.listeners(_))if(!X[L_]&&J[N4]===$&&!J[L_])return;let Z;if(_==="message")Z=function(G,Y){let z=new S6("message",{data:Y?G:G.toString()});z[C2]=this,C6($,this,z)};else if(_==="close")Z=function(G,Y){let z=new S2("close",{code:G,reason:Y.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});z[C2]=this,C6($,this,z)};else if(_==="error")Z=function(G){let Y=new w_("error",{error:G,message:G.message});Y[C2]=this,C6($,this,Y)};else if(_==="open")Z=function(){let G=new k1("open");G[C2]=this,C6($,this,G)};else return;if(Z[L_]=!!X[L_],Z[N4]=$,X.once)this.once(_,Z);else this.on(_,Z)},removeEventListener(_,$){for(let X of this.listeners(_))if(X[N4]===$&&!X[L_]){this.removeListener(_,X);break}}};F$.exports={CloseEvent:S2,ErrorEvent:w_,Event:k1,EventTarget:tz,MessageEvent:S6};function C6(_,$,X){if(typeof _==="object"&&_.handleEvent)_.handleEvent.call(_,X);else _.call($,X)}});var M4=l((TD,U$)=>{var{tokenChars:P_}=P2();function z1(_,$,X){if(_[$]===void 0)_[$]=[X];else _[$].push(X)}function ez(_){let $=Object.create(null),X=Object.create(null),Z=!1,J=!1,G=!1,Y,z,H=-1,F=-1,W=-1,A=0;for(;A<_.length;A++)if(F=_.charCodeAt(A),Y===void 0)if(W===-1&&P_[F]===1){if(H===-1)H=A}else if(A!==0&&(F===32||F===9)){if(W===-1&&H!==-1)W=A}else if(F===59||F===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;let D=_.slice(H,W);if(F===44)z1($,D,X),X=Object.create(null);else Y=D;H=W=-1}else throw SyntaxError(`Unexpected character at index ${A}`);else if(z===void 0)if(W===-1&&P_[F]===1){if(H===-1)H=A}else if(F===32||F===9){if(W===-1&&H!==-1)W=A}else if(F===59||F===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;if(z1(X,_.slice(H,W),!0),F===44)z1($,Y,X),X=Object.create(null),Y=void 0;H=W=-1}else if(F===61&&H!==-1&&W===-1)z=_.slice(H,A),H=W=-1;else throw SyntaxError(`Unexpected character at index ${A}`);else if(J){if(P_[F]!==1)throw SyntaxError(`Unexpected character at index ${A}`);if(H===-1)H=A;else if(!Z)Z=!0;J=!1}else if(G)if(P_[F]===1){if(H===-1)H=A}else if(F===34&&H!==-1)G=!1,W=A;else if(F===92)J=!0;else throw SyntaxError(`Unexpected character at index ${A}`);else if(F===34&&_.charCodeAt(A-1)===61)G=!0;else if(W===-1&&P_[F]===1){if(H===-1)H=A}else if(H!==-1&&(F===32||F===9)){if(W===-1)W=A}else if(F===59||F===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(W===-1)W=A;let D=_.slice(H,W);if(Z)D=D.replace(/\\/g,""),Z=!1;if(z1(X,z,D),F===44)z1($,Y,X),X=Object.create(null),Y=void 0;z=void 0,H=W=-1}else throw SyntaxError(`Unexpected character at index ${A}`);if(H===-1||G||F===32||F===9)throw SyntaxError("Unexpected end of input");if(W===-1)W=A;let K=_.slice(H,W);if(Y===void 0)z1($,K,X);else{if(z===void 0)z1(X,K,!0);else if(Z)z1(X,z,K.replace(/\\/g,""));else z1(X,z,K);z1($,Y,X)}return $}function _H(_){return Object.keys(_).map(($)=>{let X=_[$];if(!Array.isArray(X))X=[X];return X.map((Z)=>{return[$].concat(Object.keys(Z).map((J)=>{let G=Z[J];if(!Array.isArray(G))G=[G];return G.map((Y)=>Y===!0?J:`${J}=${Y}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}U$.exports={format:_H,parse:ez}});var h6=l((PD,E$)=>{var $H=y("events"),XH=y("https"),ZH=y("http"),O$=y("net"),JH=y("tls"),{randomBytes:GH,createHash:YH}=y("crypto"),{Duplex:LD,Readable:wD}=y("stream"),{URL:B4}=y("url"),v1=T_(),zH=D4(),HH=V4(),{isBlob:FH}=P2(),{BINARY_TYPES:A$,EMPTY_BUFFER:k6,GUID:WH,kForOnEventAttribute:I4,kListener:UH,kStatusCode:AH,kWebSocket:U0,NOOP:D$}=V1(),{EventTarget:{addEventListener:KH,removeEventListener:OH}}=W$(),{format:DH,parse:RH}=M4(),{toBuffer:VH}=E_(),R$=Symbol("kAborted"),Q4=[8,13],M1=["CONNECTING","OPEN","CLOSING","CLOSED"],NH=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class q extends $H{constructor(_,$,X){super();if(this._binaryType=A$[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=k6,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=q.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,_!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,$===void 0)$=[];else if(!Array.isArray($))if(typeof $==="object"&&$!==null)X=$,$=[];else $=[$];V$(this,_,$,X)}else this._autoPong=X.autoPong,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(_){if(!A$.includes(_))return;if(this._binaryType=_,this._receiver)this._receiver._binaryType=_}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(_,$,X){let Z=new zH({allowSynchronousEvents:X.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:X.maxPayload,skipUTF8Validation:X.skipUTF8Validation}),J=new HH(_,this._extensions,X.generateMask);if(this._receiver=Z,this._sender=J,this._socket=_,Z[U0]=this,J[U0]=this,_[U0]=this,Z.on("conclude",IH),Z.on("drain",QH),Z.on("error",EH),Z.on("message",jH),Z.on("ping",TH),Z.on("pong",LH),J.onerror=wH,_.setTimeout)_.setTimeout(0);if(_.setNoDelay)_.setNoDelay();if($.length>0)_.unshift($);_.on("close",B$),_.on("data",y6),_.on("end",I$),_.on("error",Q$),this._readyState=q.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=q.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[v1.extensionName])this._extensions[v1.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=q.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(_,$){if(this.readyState===q.CLOSED)return;if(this.readyState===q.CONNECTING){q0(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===q.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=q.CLOSING,this._sender.close(_,$,!this._isServer,(X)=>{if(X)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),M$(this)}pause(){if(this.readyState===q.CONNECTING||this.readyState===q.CLOSED)return;this._paused=!0,this._socket.pause()}ping(_,$,X){if(this.readyState===q.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==q.OPEN){E4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.ping(_||k6,$,X)}pong(_,$,X){if(this.readyState===q.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==q.OPEN){E4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.pong(_||k6,$,X)}resume(){if(this.readyState===q.CONNECTING||this.readyState===q.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(_,$,X){if(this.readyState===q.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")X=$,$={};if(typeof _==="number")_=_.toString();if(this.readyState!==q.OPEN){E4(this,_,X);return}let Z={binary:typeof _!=="string",mask:!this._isServer,compress:!0,fin:!0,...$};if(!this._extensions[v1.extensionName])Z.compress=!1;this._sender.send(_||k6,Z,X)}terminate(){if(this.readyState===q.CLOSED)return;if(this.readyState===q.CONNECTING){q0(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=q.CLOSING,this._socket.destroy()}}Object.defineProperty(q,"CONNECTING",{enumerable:!0,value:M1.indexOf("CONNECTING")});Object.defineProperty(q.prototype,"CONNECTING",{enumerable:!0,value:M1.indexOf("CONNECTING")});Object.defineProperty(q,"OPEN",{enumerable:!0,value:M1.indexOf("OPEN")});Object.defineProperty(q.prototype,"OPEN",{enumerable:!0,value:M1.indexOf("OPEN")});Object.defineProperty(q,"CLOSING",{enumerable:!0,value:M1.indexOf("CLOSING")});Object.defineProperty(q.prototype,"CLOSING",{enumerable:!0,value:M1.indexOf("CLOSING")});Object.defineProperty(q,"CLOSED",{enumerable:!0,value:M1.indexOf("CLOSED")});Object.defineProperty(q.prototype,"CLOSED",{enumerable:!0,value:M1.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((_)=>{Object.defineProperty(q.prototype,_,{enumerable:!0})});["open","error","close","message"].forEach((_)=>{Object.defineProperty(q.prototype,`on${_}`,{enumerable:!0,get(){for(let $ of this.listeners(_))if($[I4])return $[UH];return null},set($){for(let X of this.listeners(_))if(X[I4]){this.removeListener(_,X);break}if(typeof $!=="function")return;this.addEventListener(_,$,{[I4]:!0})}})});q.prototype.addEventListener=KH;q.prototype.removeEventListener=OH;E$.exports=q;function V$(_,$,X,Z){let J={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Q4[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...Z,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(_._autoPong=J.autoPong,!Q4.includes(J.protocolVersion))throw RangeError(`Unsupported protocol version: ${J.protocolVersion} (supported versions: ${Q4.join(", ")})`);let G;if($ instanceof B4)G=$;else try{G=new B4($)}catch(N){throw SyntaxError(`Invalid URL: ${$}`)}if(G.protocol==="http:")G.protocol="ws:";else if(G.protocol==="https:")G.protocol="wss:";_._url=G.href;let Y=G.protocol==="wss:",z=G.protocol==="ws+unix:",H;if(G.protocol!=="ws:"&&!Y&&!z)H=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(z&&!G.pathname)H="The URL's pathname is empty";else if(G.hash)H="The URL contains a fragment identifier";if(H){let N=SyntaxError(H);if(_._redirects===0)throw N;else{v6(_,N);return}}let F=Y?443:80,W=GH(16).toString("base64"),A=Y?XH.request:ZH.request,K=new Set,D;if(J.createConnection=J.createConnection||(Y?BH:MH),J.defaultPort=J.defaultPort||F,J.port=G.port||F,J.host=G.hostname.startsWith("[")?G.hostname.slice(1,-1):G.hostname,J.headers={...J.headers,"Sec-WebSocket-Version":J.protocolVersion,"Sec-WebSocket-Key":W,Connection:"Upgrade",Upgrade:"websocket"},J.path=G.pathname+G.search,J.timeout=J.handshakeTimeout,J.perMessageDeflate)D=new v1(J.perMessageDeflate!==!0?J.perMessageDeflate:{},!1,J.maxPayload),J.headers["Sec-WebSocket-Extensions"]=DH({[v1.extensionName]:D.offer()});if(X.length){for(let N of X){if(typeof N!=="string"||!NH.test(N)||K.has(N))throw SyntaxError("An invalid or duplicated subprotocol was specified");K.add(N)}J.headers["Sec-WebSocket-Protocol"]=X.join(",")}if(J.origin)if(J.protocolVersion<13)J.headers["Sec-WebSocket-Origin"]=J.origin;else J.headers.Origin=J.origin;if(G.username||G.password)J.auth=`${G.username}:${G.password}`;if(z){let N=J.path.split(":");J.socketPath=N[0],J.path=N[1]}let R;if(J.followRedirects){if(_._redirects===0){_._originalIpc=z,_._originalSecure=Y,_._originalHostOrSocketPath=z?J.socketPath:G.host;let N=Z&&Z.headers;if(Z={...Z,headers:{}},N)for(let[I,P]of Object.entries(N))Z.headers[I.toLowerCase()]=P}else if(_.listenerCount("redirect")===0){let N=z?_._originalIpc?J.socketPath===_._originalHostOrSocketPath:!1:_._originalIpc?!1:G.host===_._originalHostOrSocketPath;if(!N||_._originalSecure&&!Y){if(delete J.headers.authorization,delete J.headers.cookie,!N)delete J.headers.host;J.auth=void 0}}if(J.auth&&!Z.headers.authorization)Z.headers.authorization="Basic "+Buffer.from(J.auth).toString("base64");if(R=_._req=A(J),_._redirects)_.emit("redirect",_.url,R)}else R=_._req=A(J);if(J.timeout)R.on("timeout",()=>{q0(_,R,"Opening handshake has timed out")});if(R.on("error",(N)=>{if(R===null||R[R$])return;R=_._req=null,v6(_,N)}),R.on("response",(N)=>{let I=N.headers.location,P=N.statusCode;if(I&&J.followRedirects&&P>=300&&P<400){if(++_._redirects>J.maxRedirects){q0(_,R,"Maximum redirects exceeded");return}R.abort();let E;try{E=new B4(I,$)}catch(j){let b=SyntaxError(`Invalid URL: ${I}`);v6(_,b);return}V$(_,E,X,Z)}else if(!_.emit("unexpected-response",R,N))q0(_,R,`Unexpected server response: ${N.statusCode}`)}),R.on("upgrade",(N,I,P)=>{if(_.emit("upgrade",N),_.readyState!==q.CONNECTING)return;R=_._req=null;let E=N.headers.upgrade;if(E===void 0||E.toLowerCase()!=="websocket"){q0(_,I,"Invalid Upgrade header");return}let j=YH("sha1").update(W+WH).digest("base64");if(N.headers["sec-websocket-accept"]!==j){q0(_,I,"Invalid Sec-WebSocket-Accept header");return}let b=N.headers["sec-websocket-protocol"],f;if(b!==void 0){if(!K.size)f="Server sent a subprotocol but none was requested";else if(!K.has(b))f="Server sent an invalid subprotocol"}else if(K.size)f="Server sent no subprotocol";if(f){q0(_,I,f);return}if(b)_._protocol=b;let T=N.headers["sec-websocket-extensions"];if(T!==void 0){if(!D){q0(_,I,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let g;try{g=RH(T)}catch(T1){q0(_,I,"Invalid Sec-WebSocket-Extensions header");return}let w0=Object.keys(g);if(w0.length!==1||w0[0]!==v1.extensionName){q0(_,I,"Server indicated an extension that was not requested");return}try{D.accept(g[v1.extensionName])}catch(T1){q0(_,I,"Invalid Sec-WebSocket-Extensions header");return}_._extensions[v1.extensionName]=D}_.setSocket(I,P,{allowSynchronousEvents:J.allowSynchronousEvents,generateMask:J.generateMask,maxPayload:J.maxPayload,skipUTF8Validation:J.skipUTF8Validation})}),J.finishRequest)J.finishRequest(R,_);else R.end()}function v6(_,$){_._readyState=q.CLOSING,_._errorEmitted=!0,_.emit("error",$),_.emitClose()}function MH(_){return _.path=_.socketPath,O$.connect(_)}function BH(_){if(_.path=void 0,!_.servername&&_.servername!=="")_.servername=O$.isIP(_.host)?"":_.host;return JH.connect(_)}function q0(_,$,X){_._readyState=q.CLOSING;let Z=Error(X);if(Error.captureStackTrace(Z,q0),$.setHeader){if($[R$]=!0,$.abort(),$.socket&&!$.socket.destroyed)$.socket.destroy();process.nextTick(v6,_,Z)}else $.destroy(Z),$.once("error",_.emit.bind(_,"error")),$.once("close",_.emitClose.bind(_))}function E4(_,$,X){if($){let Z=FH($)?$.size:VH($).length;if(_._socket)_._sender._bufferedBytes+=Z;else _._bufferedAmount+=Z}if(X){let Z=Error(`WebSocket is not open: readyState ${_.readyState} (${M1[_.readyState]})`);process.nextTick(X,Z)}}function IH(_,$){let X=this[U0];if(X._closeFrameReceived=!0,X._closeMessage=$,X._closeCode=_,X._socket[U0]===void 0)return;if(X._socket.removeListener("data",y6),process.nextTick(N$,X._socket),_===1005)X.close();else X.close(_,$)}function QH(){let _=this[U0];if(!_.isPaused)_._socket.resume()}function EH(_){let $=this[U0];if($._socket[U0]!==void 0)$._socket.removeListener("data",y6),process.nextTick(N$,$._socket),$.close(_[AH]);if(!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function K$(){this[U0].emitClose()}function jH(_,$){this[U0].emit("message",_,$)}function TH(_){let $=this[U0];if($._autoPong)$.pong(_,!this._isServer,D$);$.emit("ping",_)}function LH(_){this[U0].emit("pong",_)}function N$(_){_.resume()}function wH(_){let $=this[U0];if($.readyState===q.CLOSED)return;if($.readyState===q.OPEN)$._readyState=q.CLOSING,M$($);if(this._socket.end(),!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function M$(_){_._closeTimer=setTimeout(_._socket.destroy.bind(_._socket),30000)}function B$(){let _=this[U0];this.removeListener("close",B$),this.removeListener("data",y6),this.removeListener("end",I$),_._readyState=q.CLOSING;let $;if(!this._readableState.endEmitted&&!_._closeFrameReceived&&!_._receiver._writableState.errorEmitted&&($=_._socket.read())!==null)_._receiver.write($);if(_._receiver.end(),this[U0]=void 0,clearTimeout(_._closeTimer),_._receiver._writableState.finished||_._receiver._writableState.errorEmitted)_.emitClose();else _._receiver.on("error",K$),_._receiver.on("finish",K$)}function y6(_){if(!this[U0]._receiver.write(_))this.pause()}function I$(){let _=this[U0];_._readyState=q.CLOSING,_._receiver.end(),this.end()}function Q$(){let _=this[U0];if(this.removeListener("error",Q$),this.on("error",D$),_)_._readyState=q.CLOSING,this.destroy()}});var w$=l((qD,L$)=>{var xD=h6(),{Duplex:PH}=y("stream");function j$(_){_.emit("close")}function xH(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function T$(_){if(this.removeListener("error",T$),this.destroy(),this.listenerCount("error")===0)this.emit("error",_)}function qH(_,$){let X=!0,Z=new PH({...$,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return _.on("message",function(G,Y){let z=!Y&&Z._readableState.objectMode?G.toString():G;if(!Z.push(z))_.pause()}),_.once("error",function(G){if(Z.destroyed)return;X=!1,Z.destroy(G)}),_.once("close",function(){if(Z.destroyed)return;Z.push(null)}),Z._destroy=function(J,G){if(_.readyState===_.CLOSED){G(J),process.nextTick(j$,Z);return}let Y=!1;if(_.once("error",function(H){Y=!0,G(H)}),_.once("close",function(){if(!Y)G(J);process.nextTick(j$,Z)}),X)_.terminate()},Z._final=function(J){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._final(J)});return}if(_._socket===null)return;if(_._socket._writableState.finished){if(J(),Z._readableState.endEmitted)Z.destroy()}else _._socket.once("finish",function(){J()}),_.close()},Z._read=function(){if(_.isPaused)_.resume()},Z._write=function(J,G,Y){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._write(J,G,Y)});return}_.send(J,Y)},Z.on("end",xH),Z.on("error",T$),Z}L$.exports=qH});var x$=l((CD,P$)=>{var{tokenChars:CH}=P2();function SH(_){let $=new Set,X=-1,Z=-1,J=0;for(J;J<_.length;J++){let Y=_.charCodeAt(J);if(Z===-1&&CH[Y]===1){if(X===-1)X=J}else if(J!==0&&(Y===32||Y===9)){if(Z===-1&&X!==-1)Z=J}else if(Y===44){if(X===-1)throw SyntaxError(`Unexpected character at index ${J}`);if(Z===-1)Z=J;let z=_.slice(X,Z);if($.has(z))throw SyntaxError(`The "${z}" subprotocol is duplicated`);$.add(z),X=Z=-1}else throw SyntaxError(`Unexpected character at index ${J}`)}if(X===-1||Z!==-1)throw SyntaxError("Unexpected end of input");let G=_.slice(X,J);if($.has(G))throw SyntaxError(`The "${G}" subprotocol is duplicated`);return $.add(G),$}P$.exports={parse:SH}});var v$=l((kD,k$)=>{var kH=y("events"),f6=y("http"),{Duplex:SD}=y("stream"),{createHash:vH}=y("crypto"),q$=M4(),e1=T_(),yH=x$(),hH=h6(),{GUID:fH,kWebSocket:bH}=V1(),gH=/^[+/0-9A-Za-z]{22}==$/;class S$ extends kH{constructor(_,$){super();if(_={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:hH,..._},_.port==null&&!_.server&&!_.noServer||_.port!=null&&(_.server||_.noServer)||_.server&&_.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(_.port!=null)this._server=f6.createServer((X,Z)=>{let J=f6.STATUS_CODES[426];Z.writeHead(426,{"Content-Length":J.length,"Content-Type":"text/plain"}),Z.end(J)}),this._server.listen(_.port,_.host,_.backlog,$);else if(_.server)this._server=_.server;if(this._server){let X=this.emit.bind(this,"connection");this._removeListeners=pH(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(Z,J,G)=>{this.handleUpgrade(Z,J,G,X)}})}if(_.perMessageDeflate===!0)_.perMessageDeflate={};if(_.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=_,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(_){if(this._state===2){if(_)this.once("close",()=>{_(Error("The server is not running"))});process.nextTick(x_,this);return}if(_)this.once("close",_);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(x_,this);else this._shouldEmitClose=!0;else process.nextTick(x_,this)}else{let $=this._server;this._removeListeners(),this._removeListeners=this._server=null,$.close(()=>{x_(this)})}}shouldHandle(_){if(this.options.path){let $=_.url.indexOf("?");if(($!==-1?_.url.slice(0,$):_.url)!==this.options.path)return!1}return!0}handleUpgrade(_,$,X,Z){$.on("error",C$);let J=_.headers["sec-websocket-key"],G=_.headers.upgrade,Y=+_.headers["sec-websocket-version"];if(_.method!=="GET"){_2(this,_,$,405,"Invalid HTTP method");return}if(G===void 0||G.toLowerCase()!=="websocket"){_2(this,_,$,400,"Invalid Upgrade header");return}if(J===void 0||!gH.test(J)){_2(this,_,$,400,"Missing or invalid Sec-WebSocket-Key header");return}if(Y!==13&&Y!==8){_2(this,_,$,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(_)){q_($,400);return}let z=_.headers["sec-websocket-protocol"],H=new Set;if(z!==void 0)try{H=yH.parse(z)}catch(A){_2(this,_,$,400,"Invalid Sec-WebSocket-Protocol header");return}let F=_.headers["sec-websocket-extensions"],W={};if(this.options.perMessageDeflate&&F!==void 0){let A=new e1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let K=q$.parse(F);if(K[e1.extensionName])A.accept(K[e1.extensionName]),W[e1.extensionName]=A}catch(K){_2(this,_,$,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let A={origin:_.headers[`${Y===8?"sec-websocket-origin":"origin"}`],secure:!!(_.socket.authorized||_.socket.encrypted),req:_};if(this.options.verifyClient.length===2){this.options.verifyClient(A,(K,D,R,N)=>{if(!K)return q_($,D||401,R,N);this.completeUpgrade(W,J,H,_,$,X,Z)});return}if(!this.options.verifyClient(A))return q_($,401)}this.completeUpgrade(W,J,H,_,$,X,Z)}completeUpgrade(_,$,X,Z,J,G,Y){if(!J.readable||!J.writable)return J.destroy();if(J[bH])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return q_(J,503);let H=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${vH("sha1").update($+fH).digest("base64")}`],F=new this.options.WebSocket(null,void 0,this.options);if(X.size){let W=this.options.handleProtocols?this.options.handleProtocols(X,Z):X.values().next().value;if(W)H.push(`Sec-WebSocket-Protocol: ${W}`),F._protocol=W}if(_[e1.extensionName]){let W=_[e1.extensionName].params,A=q$.format({[e1.extensionName]:[W]});H.push(`Sec-WebSocket-Extensions: ${A}`),F._extensions=_}if(this.emit("headers",H,Z),J.write(H.concat(`\r
`).join(`\r
`)),J.removeListener("error",C$),F.setSocket(J,G,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(F),F.on("close",()=>{if(this.clients.delete(F),this._shouldEmitClose&&!this.clients.size)process.nextTick(x_,this)});Y(F,Z)}}k$.exports=S$;function pH(_,$){for(let X of Object.keys($))_.on(X,$[X]);return function(){for(let Z of Object.keys($))_.removeListener(Z,$[Z])}}function x_(_){_._state=2,_.emit("close")}function C$(){this.destroy()}function q_(_,$,X,Z){X=X||f6.STATUS_CODES[$],Z={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(X),...Z},_.once("finish",_.destroy),_.end(`HTTP/1.1 ${$} ${f6.STATUS_CODES[$]}\r
`+Object.keys(Z).map((J)=>`${J}: ${Z[J]}`).join(`\r
`)+`\r
\r
`+X)}function _2(_,$,X,Z,J,G){if(_.listenerCount("wsClientError")){let Y=Error(J);Error.captureStackTrace(Y,_2),_.emit("wsClientError",Y,X,$)}else q_(X,Z,J,G)}});var g4=l((SN,KX)=>{function GW(_){var $=0,X=[];function Z(){if($--,$<_)J()}function J(){var H=X.shift();if(z.queue=X.length,H)Y(H.fn).then(H.resolve).catch(H.reject)}function G(H){return new Promise(function(F,W){X.push({fn:H,resolve:F,reject:W}),z.queue=X.length})}function Y(H){$++;try{return Promise.resolve(H()).then(function(F){return Z(),F},function(F){throw Z(),F})}catch(F){return Z(),Promise.reject(F)}}var z=function(H){if($>=_)return G(H);else return Y(H)};return z}function YW(_,$){var X=!1,Z=this;return Promise.all(_.map(function(){var J=arguments;return Z(function(){if(!X)return $.apply(void 0,J).catch(function(G){throw X=!0,G})})}))}function AX(_){return _.queue=0,_.map=YW,_}KX.exports=function(_){if(_)return AX(GW(_));else return AX(function($){return $()})}});var i5=j0(l5(),1),{program:VU,createCommand:NU,createArgument:MU,createOption:BU,CommanderError:IU,InvalidArgumentError:QU,InvalidOptionArgumentError:EU,Command:B0,Argument:jU,Option:TU,Help:LU}=i5.default;var n5=(_=0)=>($)=>`\x1B[${$+_}m`,o5=(_=0)=>($)=>`\x1B[${38+_};5;${$}m`,s5=(_=0)=>($,X,Z)=>`\x1B[${38+_};2;${$};${X};${Z}m`,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},PU=Object.keys(s.modifier),lJ=Object.keys(s.color),iJ=Object.keys(s.bgColor),xU=[...lJ,...iJ];function nJ(){let _=new Map;for(let[$,X]of Object.entries(s)){for(let[Z,J]of Object.entries(X))s[Z]={open:`\x1B[${J[0]}m`,close:`\x1B[${J[1]}m`},X[Z]=s[Z],_.set(J[0],J[1]);Object.defineProperty(s,$,{value:X,enumerable:!1})}return Object.defineProperty(s,"codes",{value:_,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi=n5(),s.color.ansi256=o5(),s.color.ansi16m=s5(),s.bgColor.ansi=n5(10),s.bgColor.ansi256=o5(10),s.bgColor.ansi16m=s5(10),Object.defineProperties(s,{rgbToAnsi256:{value($,X,Z){if($===X&&X===Z){if($<8)return 16;if($>248)return 231;return Math.round(($-8)/247*24)+232}return 16+36*Math.round($/255*5)+6*Math.round(X/255*5)+Math.round(Z/255*5)},enumerable:!1},hexToRgb:{value($){let X=/[a-f\d]{6}|[a-f\d]{3}/i.exec($.toString(16));if(!X)return[0,0,0];let[Z]=X;if(Z.length===3)Z=[...Z].map((G)=>G+G).join("");let J=Number.parseInt(Z,16);return[J>>16&255,J>>8&255,J&255]},enumerable:!1},hexToAnsi256:{value:($)=>s.rgbToAnsi256(...s.hexToRgb($)),enumerable:!1},ansi256ToAnsi:{value($){if($<8)return 30+$;if($<16)return 90+($-8);let X,Z,J;if($>=232)X=(($-232)*10+8)/255,Z=X,J=X;else{$-=16;let z=$%36;X=Math.floor($/36)/5,Z=Math.floor(z/6)/5,J=z%6/5}let G=Math.max(X,Z,J)*2;if(G===0)return 30;let Y=30+(Math.round(J)<<2|Math.round(Z)<<1|Math.round(X));if(G===2)Y+=60;return Y},enumerable:!1},rgbToAnsi:{value:($,X,Z)=>s.ansi256ToAnsi(s.rgbToAnsi256($,X,Z)),enumerable:!1},hexToAnsi:{value:($)=>s.ansi256ToAnsi(s.hexToAnsi256($)),enumerable:!1}}),s}var oJ=nJ(),l0=oJ;import j8 from"node:process";import sJ from"node:os";import r5 from"node:tty";function y0(_,$=globalThis.Deno?globalThis.Deno.args:j8.argv){let X=_.startsWith("-")?"":_.length===1?"-":"--",Z=$.indexOf(X+_),J=$.indexOf("--");return Z!==-1&&(J===-1||Z<J)}var{env:r}=j8,Z6;if(y0("no-color")||y0("no-colors")||y0("color=false")||y0("color=never"))Z6=0;else if(y0("color")||y0("colors")||y0("color=true")||y0("color=always"))Z6=1;function rJ(){if("FORCE_COLOR"in r){if(r.FORCE_COLOR==="true")return 1;if(r.FORCE_COLOR==="false")return 0;return r.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(r.FORCE_COLOR,10),3)}}function aJ(_){if(_===0)return!1;return{level:_,hasBasic:!0,has256:_>=2,has16m:_>=3}}function tJ(_,{streamIsTTY:$,sniffFlags:X=!0}={}){let Z=rJ();if(Z!==void 0)Z6=Z;let J=X?Z6:Z;if(J===0)return 0;if(X){if(y0("color=16m")||y0("color=full")||y0("color=truecolor"))return 3;if(y0("color=256"))return 2}if("TF_BUILD"in r&&"AGENT_NAME"in r)return 1;if(_&&!$&&J===void 0)return 0;let G=J||0;if(r.TERM==="dumb")return G;if(j8.platform==="win32"){let Y=sJ.release().split(".");if(Number(Y[0])>=10&&Number(Y[2])>=10586)return Number(Y[2])>=14931?3:2;return 1}if("CI"in r){if(["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some((Y)=>(Y in r)))return 3;if(["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some((Y)=>(Y in r))||r.CI_NAME==="codeship")return 1;return G}if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if(r.TERM==="xterm-kitty")return 3;if(r.TERM==="xterm-ghostty")return 3;if(r.TERM==="wezterm")return 3;if("TERM_PROGRAM"in r){let Y=Number.parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return Y>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(r.TERM))return 2;if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM))return 1;if("COLORTERM"in r)return 1;return G}function a5(_,$={}){let X=tJ(_,{streamIsTTY:_&&_.isTTY,...$});return aJ(X)}var eJ={stdout:a5({isTTY:r5.isatty(1)}),stderr:a5({isTTY:r5.isatty(2)})},t5=eJ;function e5(_,$,X){let Z=_.indexOf($);if(Z===-1)return _;let J=$.length,G=0,Y="";do Y+=_.slice(G,Z)+$+X,G=Z+J,Z=_.indexOf($,G);while(Z!==-1);return Y+=_.slice(G),Y}function _3(_,$,X,Z){let J=0,G="";do{let Y=_[Z-1]==="\r";G+=_.slice(J,Y?Z-1:Z)+$+(Y?`\r
`:`
`)+X,J=Z+1,Z=_.indexOf(`
`,J)}while(Z!==-1);return G+=_.slice(J),G}var{stdout:$3,stderr:X3}=t5,T8=Symbol("GENERATOR"),K2=Symbol("STYLER"),X_=Symbol("IS_EMPTY"),Z3=["ansi","ansi","ansi256","ansi16m"],O2=Object.create(null),_G=(_,$={})=>{if($.level&&!(Number.isInteger($.level)&&$.level>=0&&$.level<=3))throw Error("The `level` option should be an integer from 0 to 3");let X=$3?$3.level:0;_.level=$.level===void 0?X:$.level};var $G=(_)=>{let $=(...X)=>X.join(" ");return _G($,_),Object.setPrototypeOf($,Z_.prototype),$};function Z_(_){return $G(_)}Object.setPrototypeOf(Z_.prototype,Function.prototype);for(let[_,$]of Object.entries(l0))O2[_]={get(){let X=J6(this,w8($.open,$.close,this[K2]),this[X_]);return Object.defineProperty(this,_,{value:X}),X}};O2.visible={get(){let _=J6(this,this[K2],!0);return Object.defineProperty(this,"visible",{value:_}),_}};var L8=(_,$,X,...Z)=>{if(_==="rgb"){if($==="ansi16m")return l0[X].ansi16m(...Z);if($==="ansi256")return l0[X].ansi256(l0.rgbToAnsi256(...Z));return l0[X].ansi(l0.rgbToAnsi(...Z))}if(_==="hex")return L8("rgb",$,X,...l0.hexToRgb(...Z));return l0[X][_](...Z)},XG=["rgb","hex","ansi256"];for(let _ of XG){O2[_]={get(){let{level:X}=this;return function(...Z){let J=w8(L8(_,Z3[X],"color",...Z),l0.color.close,this[K2]);return J6(this,J,this[X_])}}};let $="bg"+_[0].toUpperCase()+_.slice(1);O2[$]={get(){let{level:X}=this;return function(...Z){let J=w8(L8(_,Z3[X],"bgColor",...Z),l0.bgColor.close,this[K2]);return J6(this,J,this[X_])}}}}var ZG=Object.defineProperties(()=>{},{...O2,level:{enumerable:!0,get(){return this[T8].level},set(_){this[T8].level=_}}}),w8=(_,$,X)=>{let Z,J;if(X===void 0)Z=_,J=$;else Z=X.openAll+_,J=$+X.closeAll;return{open:_,close:$,openAll:Z,closeAll:J,parent:X}},J6=(_,$,X)=>{let Z=(...J)=>JG(Z,J.length===1?""+J[0]:J.join(" "));return Object.setPrototypeOf(Z,ZG),Z[T8]=_,Z[K2]=$,Z[X_]=X,Z},JG=(_,$)=>{if(_.level<=0||!$)return _[X_]?"":$;let X=_[K2];if(X===void 0)return $;let{openAll:Z,closeAll:J}=X;if($.includes("\x1B"))while(X!==void 0)$=e5($,X.close,X.open),X=X.parent;let G=$.indexOf(`
`);if(G!==-1)$=_3($,J,Z,G);return Z+$+J};Object.defineProperties(Z_.prototype,O2);var GG=Z_(),gU=Z_({level:X3?X3.level:0});var M=GG;import U6 from"node:process";import A3 from"node:process";import z6 from"node:process";var YG=(_,$,X,Z)=>{if(X==="length"||X==="prototype")return;if(X==="arguments"||X==="caller")return;let J=Object.getOwnPropertyDescriptor(_,X),G=Object.getOwnPropertyDescriptor($,X);if(!zG(J,G)&&Z)return;Object.defineProperty(_,X,G)},zG=function(_,$){return _===void 0||_.configurable||_.writable===$.writable&&_.enumerable===$.enumerable&&_.configurable===$.configurable&&(_.writable||_.value===$.value)},HG=(_,$)=>{let X=Object.getPrototypeOf($);if(X===Object.getPrototypeOf(_))return;Object.setPrototypeOf(_,X)},FG=(_,$)=>`/* Wrapped ${_}*/
${$}`,WG=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),UG=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),AG=(_,$,X)=>{let Z=X===""?"":`with ${X.trim()}() `,J=FG.bind(null,Z,$.toString());Object.defineProperty(J,"name",UG);let{writable:G,enumerable:Y,configurable:z}=WG;Object.defineProperty(_,"toString",{value:J,writable:G,enumerable:Y,configurable:z})};function P8(_,$,{ignoreNonConfigurable:X=!1}={}){let{name:Z}=_;for(let J of Reflect.ownKeys($))YG(_,$,J,X);return HG(_,$),AG(_,$,Z),_}var G6=new WeakMap,J3=(_,$={})=>{if(typeof _!=="function")throw TypeError("Expected a function");let X,Z=0,J=_.displayName||_.name||"<anonymous>",G=function(...Y){if(G6.set(G,++Z),Z===1)X=_.apply(this,Y),_=void 0;else if($.throw===!0)throw Error(`Function \`${J}\` can only be called once`);return X};return P8(G,_),G6.set(G,Z),G};J3.callCount=(_)=>{if(!G6.has(_))throw Error(`The given function \`${_.name}\` is not wrapped by the \`onetime\` package`);return G6.get(_)};var G3=J3;var l1=[];l1.push("SIGHUP","SIGINT","SIGTERM");if(process.platform!=="win32")l1.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");if(process.platform==="linux")l1.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var Y6=(_)=>!!_&&typeof _==="object"&&typeof _.removeListener==="function"&&typeof _.emit==="function"&&typeof _.reallyExit==="function"&&typeof _.listeners==="function"&&typeof _.kill==="function"&&typeof _.pid==="number"&&typeof _.on==="function",x8=Symbol.for("signal-exit emitter"),q8=globalThis,KG=Object.defineProperty.bind(Object);class Y3{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(q8[x8])return q8[x8];KG(q8,x8,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(_,$){this.listeners[_].push($)}removeListener(_,$){let X=this.listeners[_],Z=X.indexOf($);if(Z===-1)return;if(Z===0&&X.length===1)X.length=0;else X.splice(Z,1)}emit(_,$,X){if(this.emitted[_])return!1;this.emitted[_]=!0;let Z=!1;for(let J of this.listeners[_])Z=J($,X)===!0||Z;if(_==="exit")Z=this.emit("afterExit",$,X)||Z;return Z}}class S8{}var OG=(_)=>{return{onExit($,X){return _.onExit($,X)},load(){return _.load()},unload(){return _.unload()}}};class z3 extends S8{onExit(){return()=>{}}load(){}unload(){}}class H3 extends S8{#_=C8.platform==="win32"?"SIGINT":"SIGHUP";#$=new Y3;#X;#Z;#J;#G={};#Y=!1;constructor(_){super();this.#X=_,this.#G={};for(let $ of l1)this.#G[$]=()=>{let X=this.#X.listeners($),{count:Z}=this.#$,J=_;if(typeof J.__signal_exit_emitter__==="object"&&typeof J.__signal_exit_emitter__.count==="number")Z+=J.__signal_exit_emitter__.count;if(X.length===Z){this.unload();let G=this.#$.emit("exit",null,$),Y=$==="SIGHUP"?this.#_:$;if(!G)_.kill(_.pid,Y)}};this.#J=_.reallyExit,this.#Z=_.emit}onExit(_,$){if(!Y6(this.#X))return()=>{};if(this.#Y===!1)this.load();let X=$?.alwaysLast?"afterExit":"exit";return this.#$.on(X,_),()=>{if(this.#$.removeListener(X,_),this.#$.listeners.exit.length===0&&this.#$.listeners.afterExit.length===0)this.unload()}}load(){if(this.#Y)return;this.#Y=!0,this.#$.count+=1;for(let _ of l1)try{let $=this.#G[_];if($)this.#X.on(_,$)}catch($){}this.#X.emit=(_,...$)=>{return this.#H(_,...$)},this.#X.reallyExit=(_)=>{return this.#z(_)}}unload(){if(!this.#Y)return;this.#Y=!1,l1.forEach((_)=>{let $=this.#G[_];if(!$)throw Error("Listener not defined for signal: "+_);try{this.#X.removeListener(_,$)}catch(X){}}),this.#X.emit=this.#Z,this.#X.reallyExit=this.#J,this.#$.count-=1}#z(_){if(!Y6(this.#X))return 0;return this.#X.exitCode=_||0,this.#$.emit("exit",this.#X.exitCode,null),this.#J.call(this.#X,this.#X.exitCode)}#H(_,...$){let X=this.#Z;if(_==="exit"&&Y6(this.#X)){if(typeof $[0]==="number")this.#X.exitCode=$[0];let Z=X.call(this.#X,_,...$);return this.#$.emit("exit",this.#X.exitCode,null),Z}else return X.call(this.#X,_,...$)}}var C8=globalThis.process,{onExit:F3,load:iU,unload:nU}=OG(Y6(C8)?new H3(C8):new z3);var W3=z6.stderr.isTTY?z6.stderr:z6.stdout.isTTY?z6.stdout:void 0,DG=W3?G3(()=>{F3(()=>{W3.write("\x1B[?25h")},{alwaysLast:!0})}):()=>{},U3=DG;var H6=!1,D2={};D2.show=(_=A3.stderr)=>{if(!_.isTTY)return;H6=!1,_.write("\x1B[?25h")};D2.hide=(_=A3.stderr)=>{if(!_.isTTY)return;U3(),H6=!0,_.write("\x1B[?25l")};D2.toggle=(_,$)=>{if(_!==void 0)H6=_;if(H6)D2.show($);else D2.hide($)};var k8=D2;var v8={dots:{interval:80,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"]},dots2:{interval:80,frames:["⣾","⣽","⣻","⢿","⡿","⣟","⣯","⣷"]},dots3:{interval:80,frames:["⠋","⠙","⠚","⠞","⠖","⠦","⠴","⠲","⠳","⠓"]},dots4:{interval:80,frames:["⠄","⠆","⠇","⠋","⠙","⠸","⠰","⠠","⠰","⠸","⠙","⠋","⠇","⠆"]},dots5:{interval:80,frames:["⠋","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋"]},dots6:{interval:80,frames:["⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠴","⠲","⠒","⠂","⠂","⠒","⠚","⠙","⠉","⠁"]},dots7:{interval:80,frames:["⠈","⠉","⠋","⠓","⠒","⠐","⠐","⠒","⠖","⠦","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈"]},dots8:{interval:80,frames:["⠁","⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈","⠈"]},dots9:{interval:80,frames:["⢹","⢺","⢼","⣸","⣇","⡧","⡗","⡏"]},dots10:{interval:80,frames:["⢄","⢂","⢁","⡁","⡈","⡐","⡠"]},dots11:{interval:100,frames:["⠁","⠂","⠄","⡀","⢀","⠠","⠐","⠈"]},dots12:{interval:80,frames:["⢀⠀","⡀⠀","⠄⠀","⢂⠀","⡂⠀","⠅⠀","⢃⠀","⡃⠀","⠍⠀","⢋⠀","⡋⠀","⠍⠁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⢈⠩","⡀⢙","⠄⡙","⢂⠩","⡂⢘","⠅⡘","⢃⠨","⡃⢐","⠍⡐","⢋⠠","⡋⢀","⠍⡁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⠈⠩","⠀⢙","⠀⡙","⠀⠩","⠀⢘","⠀⡘","⠀⠨","⠀⢐","⠀⡐","⠀⠠","⠀⢀","⠀⡀"]},dots13:{interval:80,frames:["⣼","⣹","⢻","⠿","⡟","⣏","⣧","⣶"]},dots14:{interval:80,frames:["⠉⠉","⠈⠙","⠀⠹","⠀⢸","⠀⣰","⢀⣠","⣀⣀","⣄⡀","⣆⠀","⡇⠀","⠏⠀","⠋⠁"]},dots8Bit:{interval:80,frames:["⠀","⠁","⠂","⠃","⠄","⠅","⠆","⠇","⡀","⡁","⡂","⡃","⡄","⡅","⡆","⡇","⠈","⠉","⠊","⠋","⠌","⠍","⠎","⠏","⡈","⡉","⡊","⡋","⡌","⡍","⡎","⡏","⠐","⠑","⠒","⠓","⠔","⠕","⠖","⠗","⡐","⡑","⡒","⡓","⡔","⡕","⡖","⡗","⠘","⠙","⠚","⠛","⠜","⠝","⠞","⠟","⡘","⡙","⡚","⡛","⡜","⡝","⡞","⡟","⠠","⠡","⠢","⠣","⠤","⠥","⠦","⠧","⡠","⡡","⡢","⡣","⡤","⡥","⡦","⡧","⠨","⠩","⠪","⠫","⠬","⠭","⠮","⠯","⡨","⡩","⡪","⡫","⡬","⡭","⡮","⡯","⠰","⠱","⠲","⠳","⠴","⠵","⠶","⠷","⡰","⡱","⡲","⡳","⡴","⡵","⡶","⡷","⠸","⠹","⠺","⠻","⠼","⠽","⠾","⠿","⡸","⡹","⡺","⡻","⡼","⡽","⡾","⡿","⢀","⢁","⢂","⢃","⢄","⢅","⢆","⢇","⣀","⣁","⣂","⣃","⣄","⣅","⣆","⣇","⢈","⢉","⢊","⢋","⢌","⢍","⢎","⢏","⣈","⣉","⣊","⣋","⣌","⣍","⣎","⣏","⢐","⢑","⢒","⢓","⢔","⢕","⢖","⢗","⣐","⣑","⣒","⣓","⣔","⣕","⣖","⣗","⢘","⢙","⢚","⢛","⢜","⢝","⢞","⢟","⣘","⣙","⣚","⣛","⣜","⣝","⣞","⣟","⢠","⢡","⢢","⢣","⢤","⢥","⢦","⢧","⣠","⣡","⣢","⣣","⣤","⣥","⣦","⣧","⢨","⢩","⢪","⢫","⢬","⢭","⢮","⢯","⣨","⣩","⣪","⣫","⣬","⣭","⣮","⣯","⢰","⢱","⢲","⢳","⢴","⢵","⢶","⢷","⣰","⣱","⣲","⣳","⣴","⣵","⣶","⣷","⢸","⢹","⢺","⢻","⢼","⢽","⢾","⢿","⣸","⣹","⣺","⣻","⣼","⣽","⣾","⣿"]},dotsCircle:{interval:80,frames:["⢎ ","⠎⠁","⠊⠑","⠈⠱"," ⡱","⢀⡰","⢄⡠","⢆⡀"]},sand:{interval:80,frames:["⠁","⠂","⠄","⡀","⡈","⡐","⡠","⣀","⣁","⣂","⣄","⣌","⣔","⣤","⣥","⣦","⣮","⣶","⣷","⣿","⡿","⠿","⢟","⠟","⡛","⠛","⠫","⢋","⠋","⠍","⡉","⠉","⠑","⠡","⢁"]},line:{interval:130,frames:["-","\\","|","/"]},line2:{interval:100,frames:["⠂","-","–","—","–","-"]},rollingLine:{interval:80,frames:["/  "," - "," \\ ","  |","  |"," \\ "," - ","/  "]},pipe:{interval:100,frames:["┤","┘","┴","└","├","┌","┬","┐"]},simpleDots:{interval:400,frames:[".  ",".. ","...","   "]},simpleDotsScrolling:{interval:200,frames:[".  ",".. ","..."," ..","  .","   "]},star:{interval:70,frames:["✶","✸","✹","✺","✹","✷"]},star2:{interval:80,frames:["+","x","*"]},flip:{interval:70,frames:["_","_","_","-","`","`","'","´","-","_","_","_"]},hamburger:{interval:100,frames:["☱","☲","☴"]},growVertical:{interval:120,frames:["▁","▃","▄","▅","▆","▇","▆","▅","▄","▃"]},growHorizontal:{interval:120,frames:["▏","▎","▍","▌","▋","▊","▉","▊","▋","▌","▍","▎"]},balloon:{interval:140,frames:[" ",".","o","O","@","*"," "]},balloon2:{interval:120,frames:[".","o","O","°","O","o","."]},noise:{interval:100,frames:["▓","▒","░"]},bounce:{interval:120,frames:["⠁","⠂","⠄","⠂"]},boxBounce:{interval:120,frames:["▖","▘","▝","▗"]},boxBounce2:{interval:100,frames:["▌","▀","▐","▄"]},triangle:{interval:50,frames:["◢","◣","◤","◥"]},binary:{interval:80,frames:["010010","001100","100101","111010","111101","010111","101011","111000","110011","110101"]},arc:{interval:100,frames:["◜","◠","◝","◞","◡","◟"]},circle:{interval:120,frames:["◡","⊙","◠"]},squareCorners:{interval:180,frames:["◰","◳","◲","◱"]},circleQuarters:{interval:120,frames:["◴","◷","◶","◵"]},circleHalves:{interval:50,frames:["◐","◓","◑","◒"]},squish:{interval:100,frames:["╫","╪"]},toggle:{interval:250,frames:["⊶","⊷"]},toggle2:{interval:80,frames:["▫","▪"]},toggle3:{interval:120,frames:["□","■"]},toggle4:{interval:100,frames:["■","□","▪","▫"]},toggle5:{interval:100,frames:["▮","▯"]},toggle6:{interval:300,frames:["ဝ","၀"]},toggle7:{interval:80,frames:["⦾","⦿"]},toggle8:{interval:100,frames:["◍","◌"]},toggle9:{interval:100,frames:["◉","◎"]},toggle10:{interval:100,frames:["㊂","㊀","㊁"]},toggle11:{interval:50,frames:["⧇","⧆"]},toggle12:{interval:120,frames:["☗","☖"]},toggle13:{interval:80,frames:["=","*","-"]},arrow:{interval:100,frames:["←","↖","↑","↗","→","↘","↓","↙"]},arrow2:{interval:80,frames:["⬆️ ","↗️ ","➡️ ","↘️ ","⬇️ ","↙️ ","⬅️ ","↖️ "]},arrow3:{interval:120,frames:["▹▹▹▹▹","▸▹▹▹▹","▹▸▹▹▹","▹▹▸▹▹","▹▹▹▸▹","▹▹▹▹▸"]},bouncingBar:{interval:80,frames:["[    ]","[=   ]","[==  ]","[=== ]","[====]","[ ===]","[  ==]","[   =]","[    ]","[   =]","[  ==]","[ ===]","[====]","[=== ]","[==  ]","[=   ]"]},bouncingBall:{interval:80,frames:["( ●    )","(  ●   )","(   ●  )","(    ● )","(     ●)","(    ● )","(   ●  )","(  ●   )","( ●    )","(●     )"]},smiley:{interval:200,frames:["😄 ","😝 "]},monkey:{interval:300,frames:["🙈 ","🙈 ","🙉 ","🙊 "]},hearts:{interval:100,frames:["💛 ","💙 ","💜 ","💚 ","💗 "]},clock:{interval:100,frames:["🕛 ","🕐 ","🕑 ","🕒 ","🕓 ","🕔 ","🕕 ","🕖 ","🕗 ","🕘 ","🕙 ","🕚 "]},earth:{interval:180,frames:["🌍 ","🌎 ","🌏 "]},material:{interval:17,frames:["█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███████▁▁▁▁▁▁▁▁▁▁▁▁▁","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","██████████▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","█████████████▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁██████████████▁▁▁▁","▁▁▁██████████████▁▁▁","▁▁▁▁█████████████▁▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁▁▁████████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","██████▁▁▁▁▁▁▁▁▁▁▁▁▁█","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁▁█████████████▁▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁▁███████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁▁█████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁"]},moon:{interval:80,frames:["🌑 ","🌒 ","🌓 ","🌔 ","🌕 ","🌖 ","🌗 ","🌘 "]},runner:{interval:140,frames:["🚶 ","🏃 "]},pong:{interval:80,frames:["▐⠂       ▌","▐⠈       ▌","▐ ⠂      ▌","▐ ⠠      ▌","▐  ⡀     ▌","▐  ⠠     ▌","▐   ⠂    ▌","▐   ⠈    ▌","▐    ⠂   ▌","▐    ⠠   ▌","▐     ⡀  ▌","▐     ⠠  ▌","▐      ⠂ ▌","▐      ⠈ ▌","▐       ⠂▌","▐       ⠠▌","▐       ⡀▌","▐      ⠠ ▌","▐      ⠂ ▌","▐     ⠈  ▌","▐     ⠂  ▌","▐    ⠠   ▌","▐    ⡀   ▌","▐   ⠠    ▌","▐   ⠂    ▌","▐  ⠈     ▌","▐  ⠂     ▌","▐ ⠠      ▌","▐ ⡀      ▌","▐⠠       ▌"]},shark:{interval:120,frames:["▐|\\____________▌","▐_|\\___________▌","▐__|\\__________▌","▐___|\\_________▌","▐____|\\________▌","▐_____|\\_______▌","▐______|\\______▌","▐_______|\\_____▌","▐________|\\____▌","▐_________|\\___▌","▐__________|\\__▌","▐___________|\\_▌","▐____________|\\▌","▐____________/|▌","▐___________/|_▌","▐__________/|__▌","▐_________/|___▌","▐________/|____▌","▐_______/|_____▌","▐______/|______▌","▐_____/|_______▌","▐____/|________▌","▐___/|_________▌","▐__/|__________▌","▐_/|___________▌","▐/|____________▌"]},dqpb:{interval:100,frames:["d","q","p","b"]},weather:{interval:100,frames:["☀️ ","☀️ ","☀️ ","🌤 ","⛅️ ","🌥 ","☁️ ","🌧 ","🌨 ","🌧 ","🌨 ","🌧 ","🌨 ","⛈ ","🌨 ","🌧 ","🌨 ","☁️ ","🌥 ","⛅️ ","🌤 ","☀️ ","☀️ "]},christmas:{interval:400,frames:["🌲","🎄"]},grenade:{interval:80,frames:["،  ","′  "," ´ "," ‾ ","  ⸌","  ⸊","  |","  ⁎","  ⁕"," ෴ ","  ⁓","   ","   ","   "]},point:{interval:125,frames:["∙∙∙","●∙∙","∙●∙","∙∙●","∙∙∙"]},layer:{interval:150,frames:["-","=","≡"]},betaWave:{interval:80,frames:["ρββββββ","βρβββββ","ββρββββ","βββρβββ","ββββρββ","βββββρβ","ββββββρ"]},fingerDance:{interval:160,frames:["🤘 ","🤟 ","🖖 ","✋ ","🤚 ","👆 "]},fistBump:{interval:80,frames:["🤜　　　　🤛 ","🤜　　　　🤛 ","🤜　　　　🤛 ","　🤜　　🤛　 ","　　🤜🤛　　 ","　🤜✨🤛　　 ","🤜　✨　🤛　 "]},soccerHeader:{interval:80,frames:[" 🧑⚽️       🧑 ","🧑  ⚽️      🧑 ","🧑   ⚽️     🧑 ","🧑    ⚽️    🧑 ","🧑     ⚽️   🧑 ","🧑      ⚽️  🧑 ","🧑       ⚽️🧑  ","🧑      ⚽️  🧑 ","🧑     ⚽️   🧑 ","🧑    ⚽️    🧑 ","🧑   ⚽️     🧑 ","🧑  ⚽️      🧑 "]},mindblown:{interval:160,frames:["😐 ","😐 ","😮 ","😮 ","😦 ","😦 ","😧 ","😧 ","🤯 ","💥 ","✨ ","　 ","　 ","　 "]},speaker:{interval:160,frames:["🔈 ","🔉 ","🔊 ","🔉 "]},orangePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 "]},bluePulse:{interval:100,frames:["🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},orangeBluePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 ","🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},timeTravel:{interval:100,frames:["🕛 ","🕚 ","🕙 ","🕘 ","🕗 ","🕖 ","🕕 ","🕔 ","🕓 ","🕒 ","🕑 ","🕐 "]},aesthetic:{interval:80,frames:["▰▱▱▱▱▱▱","▰▰▱▱▱▱▱","▰▰▰▱▱▱▱","▰▰▰▰▱▱▱","▰▰▰▰▰▱▱","▰▰▰▰▰▰▱","▰▰▰▰▰▰▰","▰▱▱▱▱▱▱"]},dwarfFortress:{interval:80,frames:[" ██████£££  ","☺██████£££  ","☺██████£££  ","☺▓█████£££  ","☺▓█████£££  ","☺▒█████£££  ","☺▒█████£££  ","☺░█████£££  ","☺░█████£££  ","☺ █████£££  "," ☺█████£££  "," ☺█████£££  "," ☺▓████£££  "," ☺▓████£££  "," ☺▒████£££  "," ☺▒████£££  "," ☺░████£££  "," ☺░████£££  "," ☺ ████£££  ","  ☺████£££  ","  ☺████£££  ","  ☺▓███£££  ","  ☺▓███£££  ","  ☺▒███£££  ","  ☺▒███£££  ","  ☺░███£££  ","  ☺░███£££  ","  ☺ ███£££  ","   ☺███£££  ","   ☺███£££  ","   ☺▓██£££  ","   ☺▓██£££  ","   ☺▒██£££  ","   ☺▒██£££  ","   ☺░██£££  ","   ☺░██£££  ","   ☺ ██£££  ","    ☺██£££  ","    ☺██£££  ","    ☺▓█£££  ","    ☺▓█£££  ","    ☺▒█£££  ","    ☺▒█£££  ","    ☺░█£££  ","    ☺░█£££  ","    ☺ █£££  ","     ☺█£££  ","     ☺█£££  ","     ☺▓£££  ","     ☺▓£££  ","     ☺▒£££  ","     ☺▒£££  ","     ☺░£££  ","     ☺░£££  ","     ☺ £££  ","      ☺£££  ","      ☺£££  ","      ☺▓££  ","      ☺▓££  ","      ☺▒££  ","      ☺▒££  ","      ☺░££  ","      ☺░££  ","      ☺ ££  ","       ☺££  ","       ☺££  ","       ☺▓£  ","       ☺▓£  ","       ☺▒£  ","       ☺▒£  ","       ☺░£  ","       ☺░£  ","       ☺ £  ","        ☺£  ","        ☺£  ","        ☺▓  ","        ☺▓  ","        ☺▒  ","        ☺▒  ","        ☺░  ","        ☺░  ","        ☺   ","        ☺  &","        ☺ ☼&","       ☺ ☼ &","       ☺☼  &","      ☺☼  & ","      ‼   & ","     ☺   &  ","    ‼    &  ","   ☺    &   ","  ‼     &   "," ☺     &    ","‼      &    ","      &     ","      &     ","     &   ░  ","     &   ▒  ","    &    ▓  ","    &    £  ","   &    ░£  ","   &    ▒£  ","  &     ▓£  ","  &     ££  "," &     ░££  "," &     ▒££  ","&      ▓££  ","&      £££  ","      ░£££  ","      ▒£££  ","      ▓£££  ","      █£££  ","     ░█£££  ","     ▒█£££  ","     ▓█£££  ","     ██£££  ","    ░██£££  ","    ▒██£££  ","    ▓██£££  ","    ███£££  ","   ░███£££  ","   ▒███£££  ","   ▓███£££  ","   ████£££  ","  ░████£££  ","  ▒████£££  ","  ▓████£££  ","  █████£££  "," ░█████£££  "," ▒█████£££  "," ▓█████£££  "," ██████£££  "," ██████£££  "]}};var J_=v8,JA=Object.keys(v8);var i1={};F6(i1,{warning:()=>IG,success:()=>BG,info:()=>MG,error:()=>QG});import VG from"node:tty";var NG=VG?.WriteStream?.prototype?.hasColors?.()??!1,C=(_,$)=>{if(!NG)return(J)=>J;let X=`\x1B[${_}m`,Z=`\x1B[${$}m`;return(J)=>{let G=J+"",Y=G.indexOf(Z);if(Y===-1)return X+G+Z;let z=X,H=0,W=($===22?Z:"")+X;while(Y!==-1)z+=G.slice(H,Y)+W,H=Y+Z.length,Y=G.indexOf(Z,H);return z+=G.slice(H)+Z,z}},zA=C(0,0),HA=C(1,22),FA=C(2,22),WA=C(3,23),UA=C(4,24),AA=C(53,55),KA=C(7,27),OA=C(8,28),DA=C(9,29),RA=C(30,39),K3=C(31,39),O3=C(32,39),D3=C(33,39),R3=C(34,39),VA=C(35,39),NA=C(36,39),MA=C(37,39),BA=C(90,39),IA=C(40,49),QA=C(41,49),EA=C(42,49),jA=C(43,49),TA=C(44,49),LA=C(45,49),wA=C(46,49),PA=C(47,49),xA=C(100,49),qA=C(91,39),CA=C(92,39),SA=C(93,39),kA=C(94,39),vA=C(95,39),yA=C(96,39),hA=C(97,39),fA=C(101,49),bA=C(102,49),gA=C(103,49),pA=C(104,49),mA=C(105,49),uA=C(106,49),dA=C(107,49);import V3 from"node:process";function G_(){let{env:_}=V3,{TERM:$,TERM_PROGRAM:X}=_;if(V3.platform!=="win32")return $!=="linux";return Boolean(_.WT_SESSION)||Boolean(_.TERMINUS_SUBLIME)||_.ConEmuTask==="{cmd::Cmder}"||X==="Terminus-Sublime"||X==="vscode"||$==="xterm-256color"||$==="alacritty"||$==="rxvt-unicode"||$==="rxvt-unicode-256color"||_.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var W6=G_(),MG=R3(W6?"ℹ":"i"),BG=O3(W6?"✔":"√"),IG=D3(W6?"⚠":"‼"),QG=K3(W6?"✖":"×");function y8({onlyFirst:_=!1}={}){return new RegExp("(?:\\u001B\\][\\s\\S]*?(?:\\u0007|\\u001B\\u005C|\\u009C))|[\\u001B\\u009B][[\\]()#;?]*(?:\\d{1,4}(?:[;:]\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]",_?void 0:"g")}var EG=y8();function Y_(_){if(typeof _!=="string")throw TypeError(`Expected a \`string\`, got \`${typeof _}\``);return _.replace(EG,"")}function N3(_){return _===161||_===164||_===167||_===168||_===170||_===173||_===174||_>=176&&_<=180||_>=182&&_<=186||_>=188&&_<=191||_===198||_===208||_===215||_===216||_>=222&&_<=225||_===230||_>=232&&_<=234||_===236||_===237||_===240||_===242||_===243||_>=247&&_<=250||_===252||_===254||_===257||_===273||_===275||_===283||_===294||_===295||_===299||_>=305&&_<=307||_===312||_>=319&&_<=322||_===324||_>=328&&_<=331||_===333||_===338||_===339||_===358||_===359||_===363||_===462||_===464||_===466||_===468||_===470||_===472||_===474||_===476||_===593||_===609||_===708||_===711||_>=713&&_<=715||_===717||_===720||_>=728&&_<=731||_===733||_===735||_>=768&&_<=879||_>=913&&_<=929||_>=931&&_<=937||_>=945&&_<=961||_>=963&&_<=969||_===1025||_>=1040&&_<=1103||_===1105||_===8208||_>=8211&&_<=8214||_===8216||_===8217||_===8220||_===8221||_>=8224&&_<=8226||_>=8228&&_<=8231||_===8240||_===8242||_===8243||_===8245||_===8251||_===8254||_===8308||_===8319||_>=8321&&_<=8324||_===8364||_===8451||_===8453||_===8457||_===8467||_===8470||_===8481||_===8482||_===8486||_===8491||_===8531||_===8532||_>=8539&&_<=8542||_>=8544&&_<=8555||_>=8560&&_<=8569||_===8585||_>=8592&&_<=8601||_===8632||_===8633||_===8658||_===8660||_===8679||_===8704||_===8706||_===8707||_===8711||_===8712||_===8715||_===8719||_===8721||_===8725||_===8730||_>=8733&&_<=8736||_===8739||_===8741||_>=8743&&_<=8748||_===8750||_>=8756&&_<=8759||_===8764||_===8765||_===8776||_===8780||_===8786||_===8800||_===8801||_>=8804&&_<=8807||_===8810||_===8811||_===8814||_===8815||_===8834||_===8835||_===8838||_===8839||_===8853||_===8857||_===8869||_===8895||_===8978||_>=9312&&_<=9449||_>=9451&&_<=9547||_>=9552&&_<=9587||_>=9600&&_<=9615||_>=9618&&_<=9621||_===9632||_===9633||_>=9635&&_<=9641||_===9650||_===9651||_===9654||_===9655||_===9660||_===9661||_===9664||_===9665||_>=9670&&_<=9672||_===9675||_>=9678&&_<=9681||_>=9698&&_<=9701||_===9711||_===9733||_===9734||_===9737||_===9742||_===9743||_===9756||_===9758||_===9792||_===9794||_===9824||_===9825||_>=9827&&_<=9829||_>=9831&&_<=9834||_===9836||_===9837||_===9839||_===9886||_===9887||_===9919||_>=9926&&_<=9933||_>=9935&&_<=9939||_>=9941&&_<=9953||_===9955||_===9960||_===9961||_>=9963&&_<=9969||_===9972||_>=9974&&_<=9977||_===9979||_===9980||_===9982||_===9983||_===10045||_>=10102&&_<=10111||_>=11094&&_<=11097||_>=12872&&_<=12879||_>=57344&&_<=63743||_>=65024&&_<=65039||_===65533||_>=127232&&_<=127242||_>=127248&&_<=127277||_>=127280&&_<=127337||_>=127344&&_<=127373||_===127375||_===127376||_>=127387&&_<=127404||_>=917760&&_<=917999||_>=983040&&_<=1048573||_>=1048576&&_<=1114109}function M3(_){return _===12288||_>=65281&&_<=65376||_>=65504&&_<=65510}function B3(_){return _>=4352&&_<=4447||_===8986||_===8987||_===9001||_===9002||_>=9193&&_<=9196||_===9200||_===9203||_===9725||_===9726||_===9748||_===9749||_>=9776&&_<=9783||_>=9800&&_<=9811||_===9855||_>=9866&&_<=9871||_===9875||_===9889||_===9898||_===9899||_===9917||_===9918||_===9924||_===9925||_===9934||_===9940||_===9962||_===9970||_===9971||_===9973||_===9978||_===9981||_===9989||_===9994||_===9995||_===10024||_===10060||_===10062||_>=10067&&_<=10069||_===10071||_>=10133&&_<=10135||_===10160||_===10175||_===11035||_===11036||_===11088||_===11093||_>=11904&&_<=11929||_>=11931&&_<=12019||_>=12032&&_<=12245||_>=12272&&_<=12287||_>=12289&&_<=12350||_>=12353&&_<=12438||_>=12441&&_<=12543||_>=12549&&_<=12591||_>=12593&&_<=12686||_>=12688&&_<=12773||_>=12783&&_<=12830||_>=12832&&_<=12871||_>=12880&&_<=42124||_>=42128&&_<=42182||_>=43360&&_<=43388||_>=44032&&_<=55203||_>=63744&&_<=64255||_>=65040&&_<=65049||_>=65072&&_<=65106||_>=65108&&_<=65126||_>=65128&&_<=65131||_>=94176&&_<=94180||_>=94192&&_<=94198||_>=94208&&_<=101589||_>=101631&&_<=101662||_>=101760&&_<=101874||_>=110576&&_<=110579||_>=110581&&_<=110587||_===110589||_===110590||_>=110592&&_<=110882||_===110898||_>=110928&&_<=110930||_===110933||_>=110948&&_<=110951||_>=110960&&_<=111355||_>=119552&&_<=119638||_>=119648&&_<=119670||_===126980||_===127183||_===127374||_>=127377&&_<=127386||_>=127488&&_<=127490||_>=127504&&_<=127547||_>=127552&&_<=127560||_===127568||_===127569||_>=127584&&_<=127589||_>=127744&&_<=127776||_>=127789&&_<=127797||_>=127799&&_<=127868||_>=127870&&_<=127891||_>=127904&&_<=127946||_>=127951&&_<=127955||_>=127968&&_<=127984||_===127988||_>=127992&&_<=128062||_===128064||_>=128066&&_<=128252||_>=128255&&_<=128317||_>=128331&&_<=128334||_>=128336&&_<=128359||_===128378||_===128405||_===128406||_===128420||_>=128507&&_<=128591||_>=128640&&_<=128709||_===128716||_>=128720&&_<=128722||_>=128725&&_<=128728||_>=128732&&_<=128735||_===128747||_===128748||_>=128756&&_<=128764||_>=128992&&_<=129003||_===129008||_>=129292&&_<=129338||_>=129340&&_<=129349||_>=129351&&_<=129535||_>=129648&&_<=129660||_>=129664&&_<=129674||_>=129678&&_<=129734||_===129736||_>=129741&&_<=129756||_>=129759&&_<=129770||_>=129775&&_<=129784||_>=131072&&_<=196605||_>=196608&&_<=262141}function jG(_){if(!Number.isSafeInteger(_))throw TypeError(`Expected a code point, got \`${typeof _}\`.`)}function h8(_,{ambiguousAsWide:$=!1}={}){if(jG(_),M3(_)||B3(_)||$&&N3(_))return 2;return 1}var TG=new Intl.Segmenter,LG=/^(?:\p{Default_Ignorable_Code_Point}|\p{Control}|\p{Mark}|\p{Surrogate})+$/v,wG=/^[\p{Default_Ignorable_Code_Point}\p{Control}\p{Format}\p{Mark}\p{Surrogate}]+/v,PG=/^\p{RGI_Emoji}$/v;function xG(_){return _.replace(wG,"")}function qG(_){return LG.test(_)}function CG(_,$){let X=0;if(_.length>1){for(let Z of _.slice(1))if(Z>="＀"&&Z<="￯")X+=h8(Z.codePointAt(0),$)}return X}function f8(_,$={}){if(typeof _!=="string"||_.length===0)return 0;let{ambiguousIsNarrow:X=!0,countAnsiEscapeCodes:Z=!1}=$,J=_;if(!Z)J=Y_(J);if(J.length===0)return 0;let G=0,Y={ambiguousAsWide:!X};for(let{segment:z}of TG.segment(J)){if(qG(z))continue;if(PG.test(z)){G+=2;continue}let H=xG(z).codePointAt(0);G+=h8(H,Y),G+=CG(z,Y)}return G}function b8({stream:_=process.stdout}={}){return Boolean(_&&_.isTTY&&process.env.TERM!=="dumb"&&!("CI"in process.env))}import _1 from"node:process";var SG=3;class I3{#_=0;start(){if(this.#_++,this.#_===1)this.#$()}stop(){if(this.#_<=0)throw Error("`stop` called more times than `start`");if(this.#_--,this.#_===0)this.#X()}#$(){if(_1.platform==="win32"||!_1.stdin.isTTY)return;_1.stdin.setRawMode(!0),_1.stdin.on("data",this.#Z),_1.stdin.resume()}#X(){if(!_1.stdin.isTTY)return;_1.stdin.off("data",this.#Z),_1.stdin.pause(),_1.stdin.setRawMode(!1)}#Z(_){if(_[0]===SG)_1.emit("SIGINT")}}var kG=new I3,g8=kG;class Q3{#_=0;#$=!1;#X=0;#Z=-1;#J=0;#G=0;#Y;#z;#H;#W;#A;#K;#U;#O;#D;#F;#R;color;constructor(_){if(typeof _==="string")_={text:_};if(this.#Y={color:"cyan",stream:U6.stderr,discardStdin:!0,hideCursor:!0,..._},this.color=this.#Y.color,this.spinner=this.#Y.spinner,this.#A=this.#Y.interval,this.#H=this.#Y.stream,this.#K=typeof this.#Y.isEnabled==="boolean"?this.#Y.isEnabled:b8({stream:this.#H}),this.#U=typeof this.#Y.isSilent==="boolean"?this.#Y.isSilent:!1,this.text=this.#Y.text,this.prefixText=this.#Y.prefixText,this.suffixText=this.#Y.suffixText,this.indent=this.#Y.indent,U6.env.NODE_ENV==="test")this._stream=this.#H,this._isEnabled=this.#K,Object.defineProperty(this,"_linesToClear",{get(){return this.#_},set($){this.#_=$}}),Object.defineProperty(this,"_frameIndex",{get(){return this.#Z}}),Object.defineProperty(this,"_lineCount",{get(){return this.#X}})}get indent(){return this.#O}set indent(_=0){if(!(_>=0&&Number.isInteger(_)))throw Error("The `indent` option must be an integer from 0 and up");this.#O=_,this.#I()}get interval(){return this.#A??this.#z.interval??100}get spinner(){return this.#z}set spinner(_){if(this.#Z=-1,this.#A=void 0,typeof _==="object"){if(!Array.isArray(_.frames)||_.frames.length===0||_.frames.some(($)=>typeof $!=="string"))throw Error("The given spinner must have a non-empty `frames` array of strings");if(_.interval!==void 0&&!(Number.isInteger(_.interval)&&_.interval>0))throw Error("`spinner.interval` must be a positive integer if provided");this.#z=_}else if(!G_())this.#z=J_.line;else if(_===void 0)this.#z=J_.dots;else if(_!=="default"&&J_[_])this.#z=J_[_];else throw Error(`There is no built-in spinner named '${_}'. See https://github.com/sindresorhus/cli-spinners/blob/main/spinners.json for a full list.`)}get text(){return this.#D}set text(_=""){this.#D=_,this.#I()}get prefixText(){return this.#F}set prefixText(_=""){this.#F=_,this.#I()}get suffixText(){return this.#R}set suffixText(_=""){this.#R=_,this.#I()}get isSpinning(){return this.#W!==void 0}#V(_,$,X=!1){let Z=typeof _==="function"?_():_;if(typeof Z==="string"&&Z!=="")return X?$+Z:Z+$;return""}#M(_=this.#F,$=" "){return this.#V(_,$,!1)}#B(_=this.#R,$=" "){return this.#V(_,$,!0)}#N(_,$){let X=0;for(let Z of Y_(_).split(`
`))X+=Math.max(1,Math.ceil(f8(Z)/$));return X}#I(){let _=this.#H.columns??80,$=typeof this.#F==="function"?"":this.#F,X=typeof this.#R==="function"?"":this.#R,Z=typeof $==="string"&&$!==""?$+" ":"",J=typeof X==="string"&&X!==""?" "+X:"",G="-",Y=" ".repeat(this.#O)+Z+"-"+(typeof this.#D==="string"?" "+this.#D:"")+J;this.#X=this.#N(Y,_)}get isEnabled(){return this.#K&&!this.#U}set isEnabled(_){if(typeof _!=="boolean")throw TypeError("The `isEnabled` option must be a boolean");this.#K=_}get isSilent(){return this.#U}set isSilent(_){if(typeof _!=="boolean")throw TypeError("The `isSilent` option must be a boolean");this.#U=_}frame(){let _=Date.now();if(this.#Z===-1||_-this.#J>=this.interval)this.#Z=++this.#Z%this.#z.frames.length,this.#J=_;let{frames:$}=this.#z,X=$[this.#Z];if(this.color)X=M[this.color](X);let Z=this.#M(this.#F," "),J=typeof this.text==="string"?" "+this.text:"",G=this.#B(this.#R," ");return Z+X+J+G}clear(){if(!this.#K||!this.#H.isTTY)return this;this.#H.cursorTo(0);for(let _=0;_<this.#_;_++){if(_>0)this.#H.moveCursor(0,-1);this.#H.clearLine(1)}if(this.#O||this.#G!==this.#O)this.#H.cursorTo(this.#O);return this.#G=this.#O,this.#_=0,this}render(){if(!this.#K||this.#U)return this;this.clear();let _=this.frame(),$=this.#H.columns??80,X=this.#N(_,$),Z=this.#H.rows;if(Z&&Z>1&&X>Z){let J=_.split(`
`),G=Z-1;_=[...J.slice(0,G),"... (content truncated to fit terminal)"].join(`
`)}return this.#H.write(_),this.#_=this.#N(_,$),this}start(_){if(_)this.text=_;if(this.#U)return this;if(!this.#K){let $=" ".repeat(this.#O)+this.#M(this.#F," ")+(this.text?`- ${this.text}`:"")+this.#B(this.#R," ");if($.trim()!=="")this.#H.write($+`
`);return this}if(this.isSpinning)return this;if(this.#Y.hideCursor)k8.hide(this.#H);if(this.#Y.discardStdin&&U6.stdin.isTTY)this.#$=!0,g8.start();return this.render(),this.#W=setInterval(this.render.bind(this),this.interval),this}stop(){if(clearInterval(this.#W),this.#W=void 0,this.#Z=0,this.#K){if(this.clear(),this.#Y.hideCursor)k8.show(this.#H)}if(this.#Y.discardStdin&&U6.stdin.isTTY&&this.#$)g8.stop(),this.#$=!1;return this}succeed(_){return this.stopAndPersist({symbol:i1.success,text:_})}fail(_){return this.stopAndPersist({symbol:i1.error,text:_})}warn(_){return this.stopAndPersist({symbol:i1.warning,text:_})}info(_){return this.stopAndPersist({symbol:i1.info,text:_})}stopAndPersist(_={}){if(this.#U)return this;let $=_.prefixText??this.#F,X=this.#M($," "),Z=_.symbol??" ",J=_.text??this.text,Y=typeof J==="string"?(Z?" ":"")+J:"",z=_.suffixText??this.#R,H=this.#B(z," "),F=X+Z+Y+H+`
`;return this.stop(),this.#H.write(F),this}}function h0(_){return new Q3(_)}var NZ=j0(v3(),1);import E1 from"node:fs";import A1 from"node:path";var O=Symbol.for("drizzle:entityKind");function V(_,$){if(!_||typeof _!=="object")return!1;if(_ instanceof $)return!0;if(!Object.prototype.hasOwnProperty.call($,O))throw Error(`Class "${$.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let X=Object.getPrototypeOf(_).constructor;if(X)while(X){if(O in X&&X[O]===$[O])return!0;X=Object.getPrototypeOf(X)}return!1}class u{constructor(_,$){this.table=_,this.config=$,this.name=$.name,this.keyAsName=$.keyAsName,this.notNull=$.notNull,this.default=$.default,this.defaultFn=$.defaultFn,this.onUpdateFn=$.onUpdateFn,this.hasDefault=$.hasDefault,this.primary=$.primaryKey,this.isUnique=$.isUnique,this.uniqueName=$.uniqueName,this.uniqueType=$.uniqueType,this.dataType=$.dataType,this.columnType=$.columnType,this.generated=$.generated,this.generatedIdentity=$.generatedIdentity}static[O]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(_){return _}mapToDriverValue(_){return _}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class d8{static[O]="ColumnBuilder";config;constructor(_,$,X){this.config={name:_,keyAsName:_==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:$,columnType:X,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(_){return this.config.default=_,this.config.hasDefault=!0,this}$defaultFn(_){return this.config.defaultFn=_,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(_){return this.config.onUpdateFn=_,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(_){if(this.config.name!=="")return;this.config.name=_}}var P0=Symbol.for("drizzle:Name");function y3(_,...$){return _(...$)}function h3(_,$){return`${_[P0]}_${$.join("_")}_unique`}class H_ extends u{constructor(_,$){if(!$.uniqueName)$.uniqueName=h3(_,[$.name]);super(_,$);this.table=_}static[O]="PgColumn"}class _Y extends H_{static[O]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(_){return this.indexConfig.opClass=_,this}}class $Y extends H_{static[O]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}var f3=Symbol.for("drizzle:isPgEnum");function b3(_){return!!_&&typeof _==="function"&&f3 in _&&_[f3]===!0}class XY extends H_{static[O]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}class J0{static[O]="Subquery";constructor(_,$,X,Z=!1,J=[]){this._={brand:"Subquery",sql:_,selectedFields:$,alias:X,isWith:Z,usedTables:J}}}class F_ extends J0{static[O]="WithSubquery"}var g3="0.44.7";var c8,l8,p3={startActiveSpan(_,$){if(!c8)return $();if(!l8)l8=c8.trace.getTracer("drizzle-orm",g3);return y3((X,Z)=>Z.startActiveSpan(_,(J)=>{try{return $(J)}catch(G){throw J.setStatus({code:X.SpanStatusCode.ERROR,message:G instanceof Error?G.message:"Unknown error"}),G}finally{J.end()}}),c8,l8)}};var a=Symbol.for("drizzle:ViewBaseConfig");var D6=Symbol.for("drizzle:Schema"),R6=Symbol.for("drizzle:Columns"),m3=Symbol.for("drizzle:ExtraConfigColumns"),i8=Symbol.for("drizzle:OriginalName"),n8=Symbol.for("drizzle:BaseName"),W_=Symbol.for("drizzle:IsAlias"),u3=Symbol.for("drizzle:ExtraConfigBuilder"),ZY=Symbol.for("drizzle:IsDrizzleTable");class B{static[O]="Table";static Symbol={Name:P0,Schema:D6,OriginalName:i8,Columns:R6,ExtraConfigColumns:m3,BaseName:n8,IsAlias:W_,ExtraConfigBuilder:u3};[P0];[i8];[D6];[R6];[m3];[n8];[W_]=!1;[ZY]=!0;[u3]=void 0;constructor(_,$,X){this[P0]=this[i8]=_,this[D6]=$,this[n8]=X}}function L1(_){return _[P0]}function n1(_){return`${_[D6]??"public"}.${_[P0]}`}function o8(_){return _!==null&&_!==void 0&&typeof _.getSQL==="function"}function JY(_){let $={sql:"",params:[]};for(let X of _)if($.sql+=X.sql,$.params.push(...X.params),X.typings?.length){if(!$.typings)$.typings=[];$.typings.push(...X.typings)}return $}class F0{static[O]="StringChunk";value;constructor(_){this.value=Array.isArray(_)?_:[_]}getSQL(){return new Q([this])}}class Q{constructor(_){this.queryChunks=_;for(let $ of _)if(V($,B)){let X=$[B.Symbol.Schema];this.usedTables.push(X===void 0?$[B.Symbol.Name]:X+"."+$[B.Symbol.Name])}}static[O]="SQL";decoder=c3;shouldInlineParams=!1;usedTables=[];append(_){return this.queryChunks.push(..._.queryChunks),this}toQuery(_){return p3.startActiveSpan("drizzle.buildSQL",($)=>{let X=this.buildQueryFromSourceParams(this.queryChunks,_);return $?.setAttributes({"drizzle.query.text":X.sql,"drizzle.query.params":JSON.stringify(X.params)}),X})}buildQueryFromSourceParams(_,$){let X=Object.assign({},$,{inlineParams:$.inlineParams||this.shouldInlineParams,paramStartIndex:$.paramStartIndex||{value:0}}),{casing:Z,escapeName:J,escapeParam:G,prepareTyping:Y,inlineParams:z,paramStartIndex:H}=X;return JY(_.map((F)=>{if(V(F,F0))return{sql:F.value.join(""),params:[]};if(V(F,V6))return{sql:J(F.value),params:[]};if(F===void 0)return{sql:"",params:[]};if(Array.isArray(F)){let W=[new F0("(")];for(let[A,K]of F.entries())if(W.push(K),A<F.length-1)W.push(new F0(", "));return W.push(new F0(")")),this.buildQueryFromSourceParams(W,X)}if(V(F,Q))return this.buildQueryFromSourceParams(F.queryChunks,{...X,inlineParams:z||F.shouldInlineParams});if(V(F,B)){let W=F[B.Symbol.Schema],A=F[B.Symbol.Name];return{sql:W===void 0||F[W_]?J(A):J(W)+"."+J(A),params:[]}}if(V(F,u)){let W=Z.getColumnCasing(F);if($.invokeSource==="indexes")return{sql:J(W),params:[]};let A=F.table[B.Symbol.Schema];return{sql:F.table[W_]||A===void 0?J(F.table[B.Symbol.Name])+"."+J(W):J(A)+"."+J(F.table[B.Symbol.Name])+"."+J(W),params:[]}}if(V(F,f0)){let W=F[a].schema,A=F[a].name;return{sql:W===void 0||F[a].isAlias?J(A):J(W)+"."+J(A),params:[]}}if(V(F,x0)){if(V(F.value,w1))return{sql:G(H.value++,F),params:[F],typings:["none"]};let W=F.value===null?null:F.encoder.mapToDriverValue(F.value);if(V(W,Q))return this.buildQueryFromSourceParams([W],X);if(z)return{sql:this.mapInlineParam(W,X),params:[]};let A=["none"];if(Y)A=[Y(F.encoder)];return{sql:G(H.value++,W),params:[W],typings:A}}if(V(F,w1))return{sql:G(H.value++,F),params:[F],typings:["none"]};if(V(F,Q.Aliased)&&F.fieldAlias!==void 0)return{sql:J(F.fieldAlias),params:[]};if(V(F,J0)){if(F._.isWith)return{sql:J(F._.alias),params:[]};return this.buildQueryFromSourceParams([new F0("("),F._.sql,new F0(") "),new V6(F._.alias)],X)}if(b3(F)){if(F.schema)return{sql:J(F.schema)+"."+J(F.enumName),params:[]};return{sql:J(F.enumName),params:[]}}if(o8(F)){if(F.shouldOmitSQLParens?.())return this.buildQueryFromSourceParams([F.getSQL()],X);return this.buildQueryFromSourceParams([new F0("("),F.getSQL(),new F0(")")],X)}if(z)return{sql:this.mapInlineParam(F,X),params:[]};return{sql:G(H.value++,F),params:[F],typings:["none"]}}))}mapInlineParam(_,{escapeString:$}){if(_===null)return"null";if(typeof _==="number"||typeof _==="boolean")return _.toString();if(typeof _==="string")return $(_);if(typeof _==="object"){let X=_.toString();if(X==="[object Object]")return $(JSON.stringify(_));return $(X)}throw Error("Unexpected param value: "+_)}getSQL(){return this}as(_){if(_===void 0)return this;return new Q.Aliased(this,_)}mapWith(_){return this.decoder=typeof _==="function"?{mapFromDriverValue:_}:_,this}inlineParams(){return this.shouldInlineParams=!0,this}if(_){return _?this:void 0}}class V6{constructor(_){this.value=_}static[O]="Name";brand;getSQL(){return new Q([this])}}function d3(_){return typeof _==="object"&&_!==null&&"mapToDriverValue"in _&&typeof _.mapToDriverValue==="function"}var c3={mapFromDriverValue:(_)=>_},l3={mapToDriverValue:(_)=>_},$O={...c3,...l3};class x0{constructor(_,$=l3){this.value=_,this.encoder=$}static[O]="Param";brand;getSQL(){return new Q([this])}}function U(_,...$){let X=[];if($.length>0||_.length>0&&_[0]!=="")X.push(new F0(_[0]));for(let[Z,J]of $.entries())X.push(J,new F0(_[Z+1]));return new Q(X)}((_)=>{function $(){return new Q([])}_.empty=$;function X(H){return new Q(H)}_.fromList=X;function Z(H){return new Q([new F0(H)])}_.raw=Z;function J(H,F){let W=[];for(let[A,K]of H.entries()){if(A>0&&F!==void 0)W.push(F);W.push(K)}return new Q(W)}_.join=J;function G(H){return new V6(H)}_.identifier=G;function Y(H){return new w1(H)}_.placeholder=Y;function z(H,F){return new x0(H,F)}_.param=z})(U||(U={}));((_)=>{class ${constructor(X,Z){this.sql=X,this.fieldAlias=Z}static[O]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new $(this.sql,this.fieldAlias)}}_.Aliased=$})(Q||(Q={}));class w1{constructor(_){this.name=_}static[O]="Placeholder";getSQL(){return new Q([this])}}function U_(_,$){return _.map((X)=>{if(V(X,w1)){if(!(X.name in $))throw Error(`No value for placeholder "${X.name}" was provided`);return $[X.name]}if(V(X,x0)&&V(X.value,w1)){if(!(X.value.name in $))throw Error(`No value for placeholder "${X.value.name}" was provided`);return X.encoder.mapToDriverValue($[X.value.name])}return X})}var GY=Symbol.for("drizzle:IsDrizzleView");class f0{static[O]="View";[a];[GY]=!0;constructor({name:_,schema:$,selectedFields:X,query:Z}){this[a]={name:_,originalName:_,schema:$,selectedFields:X,query:Z,isExisting:!Z,isAlias:!1}}getSQL(){return new Q([this])}}u.prototype.getSQL=function(){return new Q([this])};B.prototype.getSQL=function(){return new Q([this])};J0.prototype.getSQL=function(){return new Q([this])};class N2{constructor(_){this.table=_}static[O]="ColumnAliasProxyHandler";get(_,$){if($==="table")return this.table;return _[$]}}class A_{constructor(_,$){this.alias=_,this.replaceOriginalName=$}static[O]="TableAliasProxyHandler";get(_,$){if($===B.Symbol.IsAlias)return!0;if($===B.Symbol.Name)return this.alias;if(this.replaceOriginalName&&$===B.Symbol.OriginalName)return this.alias;if($===a)return{..._[a],name:this.alias,isAlias:!0};if($===B.Symbol.Columns){let Z=_[B.Symbol.Columns];if(!Z)return Z;let J={};return Object.keys(Z).map((G)=>{J[G]=new Proxy(Z[G],new N2(new Proxy(_,this)))}),J}let X=_[$];if(V(X,u))return new Proxy(X,new N2(new Proxy(_,this)));return X}}function N6(_,$){return new Proxy(_,new A_($,!1))}function $1(_,$){return new Proxy(_,new N2(new Proxy(_.table,new A_($,!1))))}function s8(_,$){return new Q.Aliased(K_(_.sql,$),_.fieldAlias)}function K_(_,$){return U.join(_.queryChunks.map((X)=>{if(V(X,u))return $1(X,$);if(V(X,Q))return K_(X,$);if(V(X,Q.Aliased))return s8(X,$);return X}))}class M2 extends Error{static[O]="DrizzleError";constructor({message:_,cause:$}){super(_);this.name="DrizzleError",this.cause=$}}class D1 extends Error{constructor(_,$,X){super(`Failed query: ${_}
params: ${$}`);if(this.query=_,this.params=$,this.cause=X,Error.captureStackTrace(this,D1),X)this.cause=X}}class r8 extends M2{static[O]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class i3{static[O]="ConsoleLogWriter";write(_){console.log(_)}}class a8{static[O]="DefaultLogger";writer;constructor(_){this.writer=_?.writer??new i3}logQuery(_,$){let X=$.map((J)=>{try{return JSON.stringify(J)}catch{return String(J)}}),Z=X.length?` -- params: [${X.join(", ")}]`:"";this.writer.write(`Query: ${_}${Z}`)}}class t8{static[O]="NoopLogger";logQuery(){}}class I0{static[O]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}then(_,$){return this.execute().then(_,$)}}function e8(_,$,X){let Z={},J=_.reduce((G,{path:Y,field:z},H)=>{let F;if(V(z,u))F=z;else if(V(z,Q))F=z.decoder;else F=z.sql.decoder;let W=G;for(let[A,K]of Y.entries())if(A<Y.length-1){if(!(K in W))W[K]={};W=W[K]}else{let D=$[H],R=W[K]=D===null?null:F.mapFromDriverValue(D);if(X&&V(z,u)&&Y.length===2){let N=Y[0];if(!(N in Z))Z[N]=R===null?L1(z.table):!1;else if(typeof Z[N]==="string"&&Z[N]!==L1(z.table))Z[N]=!1}}return G},{});if(X&&Object.keys(Z).length>0){for(let[G,Y]of Object.entries(Z))if(typeof Y==="string"&&!X[Y])J[G]=null}return J}function b0(_,$){return Object.entries(_).reduce((X,[Z,J])=>{if(typeof Z!=="string")return X;let G=$?[...$,Z]:[Z];if(V(J,u)||V(J,Q)||V(J,Q.Aliased))X.push({path:G,field:J});else if(V(J,B))X.push(...b0(J[B.Symbol.Columns],G));else X.push(...b0(J,G));return X},[])}function O_(_,$){let X=Object.keys(_),Z=Object.keys($);if(X.length!==Z.length)return!1;for(let[J,G]of X.entries())if(G!==Z[J])return!1;return!0}function M6(_,$){let X=Object.entries($).filter(([,Z])=>Z!==void 0).map(([Z,J])=>{if(V(J,Q)||V(J,u))return[Z,J];else return[Z,new x0(J,_[B.Symbol.Columns][Z])]});if(X.length===0)throw Error("No values to set");return Object.fromEntries(X)}function n3(_,$){for(let X of $)for(let Z of Object.getOwnPropertyNames(X.prototype)){if(Z==="constructor")continue;Object.defineProperty(_.prototype,Z,Object.getOwnPropertyDescriptor(X.prototype,Z)||Object.create(null))}}function o3(_){return _[B.Symbol.Columns]}function D_(_){return V(_,J0)?_._.alias:V(_,f0)?_[a].name:V(_,Q)?void 0:_[B.Symbol.IsAlias]?_[B.Symbol.Name]:_[B.Symbol.BaseName]}function X1(_,$){return{name:typeof _==="string"&&_.length>0?_:"",config:typeof _==="object"?_:$}}function s3(_){if(typeof _!=="object"||_===null)return!1;if(_.constructor.name!=="Object")return!1;if("logger"in _){let $=typeof _.logger;if($!=="boolean"&&($!=="object"||typeof _.logger.logQuery!=="function")&&$!=="undefined")return!1;return!0}if("schema"in _){let $=typeof _.schema;if($!=="object"&&$!=="undefined")return!1;return!0}if("casing"in _){let $=typeof _.casing;if($!=="string"&&$!=="undefined")return!1;return!0}if("mode"in _){if(_.mode!=="default"||_.mode!=="planetscale"||_.mode!==void 0)return!1;return!0}if("connection"in _){let $=typeof _.connection;if($!=="string"&&$!=="object"&&$!=="undefined")return!1;return!0}if("client"in _){let $=typeof _.client;if($!=="object"&&$!=="function"&&$!=="undefined")return!1;return!0}if(Object.keys(_).length===0)return!0;return!1}var _4=typeof TextDecoder>"u"?null:new TextDecoder;var r3=Symbol.for("drizzle:PgInlineForeignKeys"),a3=Symbol.for("drizzle:EnableRLS");class $4 extends B{static[O]="PgTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:r3,EnableRLS:a3});[r3]=[];[a3]=!1;[B.Symbol.ExtraConfigBuilder]=void 0;[B.Symbol.ExtraConfigColumns]={}}class X4{static[O]="PgPrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new t3(_,this.columns,this.name)}}class t3{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[O]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[$4.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function T0(_,$){if(d3($)&&!o8(_)&&!V(_,x0)&&!V(_,w1)&&!V(_,u)&&!V(_,B)&&!V(_,f0))return new x0(_,$);return _}var w=(_,$)=>{return U`${_} = ${T0($,_)}`},e3=(_,$)=>{return U`${_} <> ${T0($,_)}`};function O0(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new Q($);return new Q([new F0("("),U.join($,new F0(" and ")),new F0(")")])}function R_(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new Q($);return new Q([new F0("("),U.join($,new F0(" or ")),new F0(")")])}function _7(_){return U`not ${_}`}var $7=(_,$)=>{return U`${_} > ${T0($,_)}`},X7=(_,$)=>{return U`${_} >= ${T0($,_)}`},Z7=(_,$)=>{return U`${_} < ${T0($,_)}`},J7=(_,$)=>{return U`${_} <= ${T0($,_)}`};function G7(_,$){if(Array.isArray($)){if($.length===0)return U`false`;return U`${_} in ${$.map((X)=>T0(X,_))}`}return U`${_} in ${T0($,_)}`}function Y7(_,$){if(Array.isArray($)){if($.length===0)return U`true`;return U`${_} not in ${$.map((X)=>T0(X,_))}`}return U`${_} not in ${T0($,_)}`}function z7(_){return U`${_} is null`}function H7(_){return U`${_} is not null`}function F7(_){return U`exists ${_}`}function W7(_){return U`not exists ${_}`}function U7(_,$,X){return U`${_} between ${T0($,_)} and ${T0(X,_)}`}function A7(_,$,X){return U`${_} not between ${T0($,_)} and ${T0(X,_)}`}function Z1(_,$){return U`${_} like ${$}`}function K7(_,$){return U`${_} not like ${$}`}function O7(_,$){return U`${_} ilike ${$}`}function D7(_,$){return U`${_} not ilike ${$}`}function R7(_){return U`${_} asc`}function g0(_){return U`${_} desc`}class Z4{constructor(_,$,X){this.sourceTable=_,this.referencedTable=$,this.relationName=X,this.referencedTableName=$[B.Symbol.Name]}static[O]="Relation";referencedTableName;fieldName}class V7{constructor(_,$){this.table=_,this.config=$}static[O]="Relations"}class P1 extends Z4{constructor(_,$,X,Z){super(_,$,X?.relationName);this.config=X,this.isNullable=Z}static[O]="One";withFieldName(_){let $=new P1(this.sourceTable,this.referencedTable,this.config,this.isNullable);return $.fieldName=_,$}}class V_ extends Z4{constructor(_,$,X){super(_,$,X?.relationName);this.config=X}static[O]="Many";withFieldName(_){let $=new V_(this.sourceTable,this.referencedTable,this.config);return $.fieldName=_,$}}function N7(){return{and:O0,between:U7,eq:w,exists:F7,gt:$7,gte:X7,ilike:O7,inArray:G7,isNull:z7,isNotNull:H7,like:Z1,lt:Z7,lte:J7,ne:e3,not:_7,notBetween:A7,notExists:W7,notLike:K7,notIlike:D7,notInArray:Y7,or:R_,sql:U}}function M7(){return{sql:U,asc:R7,desc:g0}}function B7(_,$){if(Object.keys(_).length===1&&"default"in _&&!V(_.default,B))_=_.default;let X={},Z={},J={};for(let[G,Y]of Object.entries(_))if(V(Y,B)){let z=n1(Y),H=Z[z];X[z]=G,J[G]={tsName:G,dbName:Y[B.Symbol.Name],schema:Y[B.Symbol.Schema],columns:Y[B.Symbol.Columns],relations:H?.relations??{},primaryKey:H?.primaryKey??[]};for(let W of Object.values(Y[B.Symbol.Columns]))if(W.primary)J[G].primaryKey.push(W);let F=Y[B.Symbol.ExtraConfigBuilder]?.(Y[B.Symbol.ExtraConfigColumns]);if(F){for(let W of Object.values(F))if(V(W,X4))J[G].primaryKey.push(...W.columns)}}else if(V(Y,V7)){let z=n1(Y.table),H=X[z],F=Y.config($(Y.table)),W;for(let[A,K]of Object.entries(F))if(H){let D=J[H];if(D.relations[A]=K,W)D.primaryKey.push(...W)}else{if(!(z in Z))Z[z]={relations:{},primaryKey:W};Z[z].relations[A]=K}}return{tables:J,tableNamesMap:X}}function YY(_){return function(X,Z){return new P1(_,X,Z,Z?.fields.reduce((J,G)=>J&&G.notNull,!0)??!1)}}function zY(_){return function(X,Z){return new V_(_,X,Z)}}function I7(_,$,X){if(V(X,P1)&&X.config)return{fields:X.config.fields,references:X.config.references};let Z=$[n1(X.referencedTable)];if(!Z)throw Error(`Table "${X.referencedTable[B.Symbol.Name]}" not found in schema`);let J=_[Z];if(!J)throw Error(`Table "${Z}" not found in schema`);let G=X.sourceTable,Y=$[n1(G)];if(!Y)throw Error(`Table "${G[B.Symbol.Name]}" not found in schema`);let z=[];for(let H of Object.values(J.relations))if(X.relationName&&X!==H&&H.relationName===X.relationName||!X.relationName&&H.referencedTable===X.sourceTable)z.push(H);if(z.length>1)throw X.relationName?Error(`There are multiple relations with name "${X.relationName}" in table "${Z}"`):Error(`There are multiple relations between "${Z}" and "${X.sourceTable[B.Symbol.Name]}". Please specify relation name`);if(z[0]&&V(z[0],P1)&&z[0].config)return{fields:z[0].config.references,references:z[0].config.fields};throw Error(`There is not enough information to infer relation "${Y}.${X.fieldName}"`)}function Q7(_){return{one:YY(_),many:zY(_)}}function B6(_,$,X,Z,J=(G)=>G){let G={};for(let[Y,z]of Z.entries())if(z.isJson){let H=$.relations[z.tsKey],F=X[Y],W=typeof F==="string"?JSON.parse(F):F;G[z.tsKey]=V(H,P1)?W&&B6(_,_[z.relationTableTsKey],W,z.selection,J):W.map((A)=>B6(_,_[z.relationTableTsKey],A,z.selection,J))}else{let H=J(X[Y]),F=z.field,W;if(V(F,u))W=F;else if(V(F,Q))W=F.decoder;else W=F.sql.decoder;G[z.tsKey]=H===null?null:W.mapFromDriverValue(H)}return G}function i0(_){return U`count(${_||U.raw("*")})`.mapWith(Number)}import*as Z5 from"node:path";class G0 extends Error{operation;cause;context;constructor(_,$,X,Z){super(_);this.operation=$;this.cause=X;this.context=Z;if(this.name="DatabaseError",Error.captureStackTrace)Error.captureStackTrace(this,G0)}toJSON(){return{name:this.name,message:this.message,operation:this.operation,context:this.context,cause:this.cause?.message,stack:this.stack}}}class I6 extends G0{field;value;constructor(_,$,X,Z){super(_,"validation",Z,{field:$,value:X});this.field=$;this.value=X;this.name="ValidationError"}}class N_ extends G0{connectionDetails;constructor(_,$,X){super(_,"connection",X,$);this.connectionDetails=$;this.name="ConnectionError"}}async function n(_,$,X){try{return await $()}catch(Z){if(Z instanceof G0)throw Z;throw new G0(`Database operation failed: ${_}`,_,Z,X)}}import*as Y8 from"node:fs";import*as a_ from"node:path";class x extends Error{code;rawCode;constructor(_,$,X,Z){if($!==void 0)_=`${$}: ${_}`;super(_,{cause:Z});this.code=$,this.rawCode=X,this.name="LibsqlError"}}function E7(_){let $=HY.exec(_);if($===null)throw new x(`The URL '${_}' is not in a valid format`,"URL_INVALID");let X=$.groups,Z=X.scheme,J=X.authority!==void 0?FY(X.authority):void 0,G=o1(X.path),Y=X.query!==void 0?UY(X.query):void 0,z=X.fragment!==void 0?o1(X.fragment):void 0;return{scheme:Z,authority:J,path:G,query:Y,fragment:z}}var HY=(()=>{return new RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su")})();function FY(_){let $=WY.exec(_);if($===null)throw new x("The authority part of the URL is not in a valid format","URL_INVALID");let X=$.groups,Z=o1(X.host_br??X.host),J=X.port?parseInt(X.port,10):void 0,G=X.username!==void 0?{username:o1(X.username),password:X.password!==void 0?o1(X.password):void 0}:void 0;return{host:Z,port:J,userinfo:G}}var WY=(()=>{return new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su")})();function UY(_){let $=_.split("&"),X=[];for(let Z of $){if(Z==="")continue;let J,G,Y=Z.indexOf("=");if(Y<0)J=Z,G="";else J=Z.substring(0,Y),G=Z.substring(Y+1);X.push({key:o1(J.replaceAll("+"," ")),value:o1(G.replaceAll("+"," "))})}return{pairs:X}}function o1(_){try{return decodeURIComponent(_)}catch($){if($ instanceof URIError)throw new x(`URL component has invalid percent encoding: ${$}`,"URL_INVALID",void 0,$);throw $}}function M_(_,$,X){if($===void 0)throw new x(`URL with scheme ${JSON.stringify(_+":")} requires authority (the "//" part)`,"URL_INVALID");let Z=`${_}:`,J=AY($.host),G=KY($.port),z=`//${OY($.userinfo)}${J}${G}`,H=X.split("/").map(encodeURIComponent).join("/");if(H!==""&&!H.startsWith("/"))H="/"+H;return new URL(`${Z}${z}${H}`)}function AY(_){return _.includes(":")?`[${encodeURI(_)}]`:encodeURI(_)}function KY(_){return _!==void 0?`:${_}`:""}function OY(_){if(_===void 0)return"";let $=encodeURIComponent(_.username),X=_.password!==void 0?`:${encodeURIComponent(_.password)}`:"";return`${$}${X}@`}var I2=typeof Buffer==="function",j7=typeof TextDecoder==="function"?new TextDecoder:void 0,T7=typeof TextEncoder==="function"?new TextEncoder:void 0;var B_=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Q6=((_)=>{let $={};return _.forEach((X,Z)=>$[X]=Z),$})(B_),DY=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,D0=String.fromCharCode.bind(String),L7=typeof Uint8Array.from==="function"?Uint8Array.from.bind(Uint8Array):(_)=>new Uint8Array(Array.prototype.slice.call(_,0)),x7=(_)=>_.replace(/=/g,"").replace(/[+\/]/g,($)=>$=="+"?"-":"_"),q7=(_)=>_.replace(/[^A-Za-z0-9\+\/]/g,""),C7=(_)=>{let $,X,Z,J,G="",Y=_.length%3;for(let z=0;z<_.length;){if((X=_.charCodeAt(z++))>255||(Z=_.charCodeAt(z++))>255||(J=_.charCodeAt(z++))>255)throw TypeError("invalid character found");$=X<<16|Z<<8|J,G+=B_[$>>18&63]+B_[$>>12&63]+B_[$>>6&63]+B_[$&63]}return Y?G.slice(0,Y-3)+"===".substring(Y):G},Y4=typeof btoa==="function"?(_)=>btoa(_):I2?(_)=>Buffer.from(_,"binary").toString("base64"):C7,J4=I2?(_)=>Buffer.from(_).toString("base64"):(_)=>{let X=[];for(let Z=0,J=_.length;Z<J;Z+=4096)X.push(D0.apply(null,_.subarray(Z,Z+4096)));return Y4(X.join(""))},E6=(_,$=!1)=>$?x7(J4(_)):J4(_),RY=(_)=>{if(_.length<2){var $=_.charCodeAt(0);return $<128?_:$<2048?D0(192|$>>>6)+D0(128|$&63):D0(224|$>>>12&15)+D0(128|$>>>6&63)+D0(128|$&63)}else{var $=65536+(_.charCodeAt(0)-55296)*1024+(_.charCodeAt(1)-56320);return D0(240|$>>>18&7)+D0(128|$>>>12&63)+D0(128|$>>>6&63)+D0(128|$&63)}},VY=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,S7=(_)=>_.replace(VY,RY),w7=I2?(_)=>Buffer.from(_,"utf8").toString("base64"):T7?(_)=>J4(T7.encode(_)):(_)=>Y4(S7(_)),B2=(_,$=!1)=>$?x7(w7(_)):w7(_),P7=(_)=>B2(_,!0),NY=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,MY=(_)=>{switch(_.length){case 4:var $=(7&_.charCodeAt(0))<<18|(63&_.charCodeAt(1))<<12|(63&_.charCodeAt(2))<<6|63&_.charCodeAt(3),X=$-65536;return D0((X>>>10)+55296)+D0((X&1023)+56320);case 3:return D0((15&_.charCodeAt(0))<<12|(63&_.charCodeAt(1))<<6|63&_.charCodeAt(2));default:return D0((31&_.charCodeAt(0))<<6|63&_.charCodeAt(1))}},k7=(_)=>_.replace(NY,MY),v7=(_)=>{if(_=_.replace(/\s+/g,""),!DY.test(_))throw TypeError("malformed base64.");_+="==".slice(2-(_.length&3));let $,X,Z,J=[];for(let G=0;G<_.length;)if($=Q6[_.charAt(G++)]<<18|Q6[_.charAt(G++)]<<12|(X=Q6[_.charAt(G++)])<<6|(Z=Q6[_.charAt(G++)]),X===64)J.push(D0($>>16&255));else if(Z===64)J.push(D0($>>16&255,$>>8&255));else J.push(D0($>>16&255,$>>8&255,$&255));return J.join("")},z4=typeof atob==="function"?(_)=>atob(q7(_)):I2?(_)=>Buffer.from(_,"base64").toString("binary"):v7,y7=I2?(_)=>L7(Buffer.from(_,"base64")):(_)=>L7(z4(_).split("").map(($)=>$.charCodeAt(0))),h7=(_)=>y7(f7(_)),BY=I2?(_)=>Buffer.from(_,"base64").toString("utf8"):j7?(_)=>j7.decode(y7(_)):(_)=>k7(z4(_)),f7=(_)=>q7(_.replace(/[-_]/g,($)=>$=="-"?"+":"/")),G4=(_)=>BY(f7(_)),IY=(_)=>{if(typeof _!=="string")return!1;let $=_.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test($)||!/[^\s0-9a-zA-Z\-_]/.test($)},b7=(_)=>{return{value:_,enumerable:!1,writable:!0,configurable:!0}},g7=function(){let _=($,X)=>Object.defineProperty(String.prototype,$,b7(X));_("fromBase64",function(){return G4(this)}),_("toBase64",function($){return B2(this,$)}),_("toBase64URI",function(){return B2(this,!0)}),_("toBase64URL",function(){return B2(this,!0)}),_("toUint8Array",function(){return h7(this)})},p7=function(){let _=($,X)=>Object.defineProperty(Uint8Array.prototype,$,b7(X));_("toBase64",function($){return E6(this,$)}),_("toBase64URI",function(){return E6(this,!0)}),_("toBase64URL",function(){return E6(this,!0)})},QY=()=>{g7(),p7()},Q2={version:"3.7.8",VERSION:"3.7.8",atob:z4,atobPolyfill:v7,btoa:Y4,btoaPolyfill:C7,fromBase64:G4,toBase64:B2,encode:B2,encodeURI:P7,encodeURL:P7,utob:S7,btou:k7,decode:G4,isValid:IY,fromUint8Array:E6,toUint8Array:h7,extendString:g7,extendUint8Array:p7,extendBuiltins:QY};var J1="https://github.com/libsql/libsql-client-ts#supported-urls";function x1(_){if(_==="write")return"BEGIN IMMEDIATE";else if(_==="read")return"BEGIN TRANSACTION READONLY";else if(_==="deferred")return"BEGIN DEFERRED";else throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class E2{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(_,$,X,Z,J){this.columns=_,this.columnTypes=$,this.rows=X,this.rowsAffected=Z,this.lastInsertRowid=J}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(EY),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}}function EY(_){return Array.prototype.map.call(_,jY)}function jY(_){if(typeof _==="bigint")return""+_;else if(_ instanceof ArrayBuffer)return Q2.fromUint8Array(new Uint8Array(_));else return _}var m7=":memory:";function u7(_){return _.scheme==="file"&&(_.path===":memory:"||_.path.startsWith(":memory:?"))}function I_(_,$){if(typeof _!=="object")throw TypeError(`Expected client configuration as object, got ${typeof _}`);let{url:X,authToken:Z,tls:J,intMode:G,concurrency:Y}=_;Y=Math.max(0,Y||20),G??="number";let z=[];if(X===m7)X="file::memory:";let H=E7(X),F=H.scheme.toLowerCase(),W=F==="file"&&H.path===m7&&H.authority===void 0,A;if(W)A={cache:{values:["shared","private"],update:(N,I)=>z.push(`${N}=${I}`)}};else A={tls:{values:["0","1"],update:(N,I)=>J=I==="1"},authToken:{update:(N,I)=>Z=I}};for(let{key:N,value:I}of H.query?.pairs??[]){if(!Object.hasOwn(A,N))throw new x(`Unsupported URL query parameter ${JSON.stringify(N)}`,"URL_PARAM_NOT_SUPPORTED");let P=A[N];if(P.values!==void 0&&!P.values.includes(I))throw new x(`Unknown value for the "${N}" query argument: ${JSON.stringify(I)}. Supported values are: [${P.values.map((E)=>'"'+E+'"').join(", ")}]`,"URL_INVALID");if(P.update!==void 0)P?.update(N,I)}let K=z.length===0?"":`?${z.join("&")}`,D=H.path+K,R;if(F==="libsql")if(J===!1){if(H.authority?.port===void 0)throw new x('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");R=$?"http":"ws"}else R=$?"https":"wss";else R=F;if(R==="http"||R==="ws")J??=!1;else J??=!0;if(R!=="http"&&R!=="ws"&&R!=="https"&&R!=="wss"&&R!=="file")throw new x(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(H.scheme+":")}. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");if(G!=="number"&&G!=="bigint"&&G!=="string")throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(G)}`);if(H.fragment!==void 0)throw new x(`URL fragments are not supported: ${JSON.stringify("#"+H.fragment)}`,"URL_INVALID");if(W)return{scheme:"file",tls:!1,path:D,intMode:G,concurrency:Y,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0};return{scheme:R,tls:J,authority:H.authority,path:D,authToken:Z,intMode:G,concurrency:Y,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch}}var Q_=j0(T9(),1);import{Buffer as w9}from"node:buffer";function P9(_){if(_.scheme!=="file")throw new x(`URL scheme ${JSON.stringify(_.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");let $=_.authority;if($!==void 0){let Y=$.host.toLowerCase();if(Y!==""&&Y!=="localhost")throw new x(`Invalid host in file URL: ${JSON.stringify($.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${J1}`,"URL_INVALID");if($.port!==void 0)throw new x("File URL cannot have a port","URL_INVALID");if($.userinfo!==void 0)throw new x("File URL cannot have username and password","URL_INVALID")}let X=u7(_);if(X&&_.syncUrl)throw new x(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${_.path}`,"URL_INVALID");let Z=_.path;if(X)Z=`${_.scheme}:${_.path}`;let J={authToken:_.authToken,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncPeriod:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline},G=new Q_.default(Z,J);return W0(G,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",_.intMode),new x9(Z,J,G,_.intMode)}class x9{#_;#$;#X;#Z;closed;protocol;constructor(_,$,X,Z){this.#_=_,this.#$=$,this.#X=X,this.#Z=Z,this.closed=!1,this.protocol="file"}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#J(),W0(this.#G(),X,this.#Z)}async batch(_,$="deferred"){this.#J();let X=this.#G();try{W0(X,x1($),this.#Z);let Z=_.map((J)=>{if(!X.inTransaction)throw new x("The transaction has been rolled back","TRANSACTION_CLOSED");let G=Array.isArray(J)?{sql:J[0],args:J[1]||[]}:J;return W0(X,G,this.#Z)});return W0(X,"COMMIT",this.#Z),Z}finally{if(X.inTransaction)W0(X,"ROLLBACK",this.#Z)}}async migrate(_){this.#J();let $=this.#G();try{W0($,"PRAGMA foreign_keys=off",this.#Z),W0($,x1("deferred"),this.#Z);let X=_.map((Z)=>{if(!$.inTransaction)throw new x("The transaction has been rolled back","TRANSACTION_CLOSED");return W0($,Z,this.#Z)});return W0($,"COMMIT",this.#Z),X}finally{if($.inTransaction)W0($,"ROLLBACK",this.#Z);W0($,"PRAGMA foreign_keys=on",this.#Z)}}async transaction(_="write"){let $=this.#G();return W0($,x1(_),this.#Z),this.#X=null,new q9($,this.#Z)}async executeMultiple(_){this.#J();let $=this.#G();try{return C9($,_)}finally{if($.inTransaction)W0($,"ROLLBACK",this.#Z)}}async sync(){this.#J();let _=await this.#G().sync();return{frames_synced:_.frames_synced,frame_no:_.frame_no}}async reconnect(){try{if(!this.closed&&this.#X!==null)this.#X.close()}finally{this.#X=new Q_.default(this.#_,this.#$),this.closed=!1}}close(){if(this.closed=!0,this.#X!==null)this.#X.close(),this.#X=null}#J(){if(this.closed)throw new x("The client is closed","CLIENT_CLOSED")}#G(){if(this.#X===null)this.#X=new Q_.default(this.#_,this.#$);return this.#X}}class q9{#_;#$;constructor(_,$){this.#_=_,this.#$=$}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#X(),W0(this.#_,X,this.#$)}async batch(_){return _.map(($)=>{this.#X();let X=Array.isArray($)?{sql:$[0],args:$[1]||[]}:$;return W0(this.#_,X,this.#$)})}async executeMultiple(_){return this.#X(),C9(this.#_,_)}async rollback(){if(!this.#_.open)return;this.#X(),W0(this.#_,"ROLLBACK",this.#$)}async commit(){this.#X(),W0(this.#_,"COMMIT",this.#$)}close(){if(this.#_.inTransaction)W0(this.#_,"ROLLBACK",this.#$)}get closed(){return!this.#_.inTransaction}#X(){if(this.closed)throw new x("The transaction is closed","TRANSACTION_CLOSED")}}function W0(_,$,X){let Z,J;if(typeof $==="string")Z=$,J=[];else if(Z=$.sql,Array.isArray($.args))J=$.args.map((G)=>L9(G,X));else{J={};for(let G in $.args){let Y=G[0]==="@"||G[0]==="$"||G[0]===":"?G.substring(1):G;J[Y]=L9($.args[G],X)}}try{let G=_.prepare(Z);G.safeIntegers(!0);let Y=!0;try{G.raw(!0)}catch{Y=!1}if(Y){let z=Array.from(G.columns().map((K)=>K.name)),H=Array.from(G.columns().map((K)=>K.type??"")),F=G.all(J).map((K)=>{return Nz(K,z,X)}),W=0,A=void 0;return new E2(z,H,F,0,void 0)}else{let z=G.run(J),H=z.changes,F=BigInt(z.lastInsertRowid);return new E2([],[],[],H,F)}}catch(G){throw S9(G)}}function Nz(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:_.length});for(let J=0;J<_.length;++J){let G=Mz(_[J],X);Object.defineProperty(Z,J,{value:G});let Y=$[J];if(!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function Mz(_,$){if(typeof _==="bigint")if($==="number"){if(_<Bz||_>Iz)throw RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(_)}else if($==="bigint")return _;else if($==="string")return""+_;else throw Error("Invalid value for IntMode");else if(_ instanceof w9)return _.buffer;return _}var Bz=-9007199254740991n,Iz=9007199254740991n;function L9(_,$){if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<Qz||_>Ez)throw RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")switch($){case"bigint":return _?1n:0n;case"string":return _?"1":"0";default:return _?1:0}else if(_ instanceof ArrayBuffer)return w9.from(_);else if(_ instanceof Date)return _.valueOf();else if(_===void 0)throw TypeError("undefined cannot be passed as argument to the database");else return _}var Qz=-9223372036854775808n,Ez=9223372036854775807n;function C9(_,$){try{_.exec($)}catch(X){throw S9(X)}}function S9(_){if(_ instanceof Q_.default.SqliteError)return new x(_.message,_.code,_.rawCode,_);return _}var mH=j0(w$(),1),uH=j0(D4(),1),dH=j0(V4(),1),k2=j0(h6(),1),cH=j0(v$(),1);class v2{constructor(){this.intMode="number"}intMode}class d extends Error{constructor(_){super(_);this.name="ClientError"}}class L extends d{constructor(_){super(_);this.name="ProtoError"}}class C_ extends d{code;proto;constructor(_,$){super(_);this.name="ResponseError",this.code=$.code,this.proto=$,this.stack=void 0}}class Z0 extends d{constructor(_,$){if($!==void 0){super(`${_}: ${$}`);this.cause=$}else super(_);this.name="ClosedError"}}class S_ extends d{constructor(_){super(_);this.name="WebSocketUnsupportedError"}}class y2 extends d{constructor(_){super(_);this.name="WebSocketError"}}class $2 extends d{status;constructor(_,$){super(_);this.status=$,this.name="HttpServerError"}}class o0 extends d{constructor(_){super(_);this.name="ProtocolVersionError"}}class N0 extends d{constructor(_){super(_);this.name="InternalError"}}class H1 extends d{constructor(_){super(_);this.name="MisuseError"}}function L0(_){if(typeof _==="string")return _;throw h2(_,"string")}function C0(_){if(_===null||_===void 0)return;else if(typeof _==="string")return _;throw h2(_,"string or null")}function B1(_){if(typeof _==="number")return _;throw h2(_,"number")}function y1(_){if(typeof _==="boolean")return _;throw h2(_,"boolean")}function k_(_){if(Array.isArray(_))return _;throw h2(_,"array")}function Y0(_){if(_!==null&&typeof _==="object"&&!Array.isArray(_))return _;throw h2(_,"object")}function s0(_,$){return k_(_).map((X)=>$(Y0(X)))}function h2(_,$){if(_===void 0)return new L(`Expected ${$}, but the property was missing`);let X=typeof _;if(_===null)X="null";else if(Array.isArray(_))X="array";return new L(`Expected ${$}, received ${X}`)}function X2(_,$){return $(Y0(_))}class y${#_;#$;constructor(_){this.#_=_,this.#$=!1}begin(){this.#_.push("{"),this.#$=!0}end(){this.#_.push("}"),this.#$=!1}#X(_){if(this.#$)this.#_.push('"'),this.#$=!1;else this.#_.push(',"');this.#_.push(_),this.#_.push('":')}string(_,$){this.#X(_),this.#_.push(JSON.stringify($))}stringRaw(_,$){this.#X(_),this.#_.push('"'),this.#_.push($),this.#_.push('"')}number(_,$){this.#X(_),this.#_.push(""+$)}boolean(_,$){this.#X(_),this.#_.push($?"true":"false")}object(_,$,X){this.#X(_),this.begin(),X(this,$),this.end()}arrayObjects(_,$,X){this.#X(_),this.#_.push("[");for(let Z=0;Z<$.length;++Z){if(Z!==0)this.#_.push(",");this.begin(),X(this,$[Z]),this.end()}this.#_.push("]")}}function v_(_,$){let X=[],Z=new y$(X);return Z.begin(),$(Z,_),Z.end(),X.join("")}var Z2=0,y_=1,h_=2;var h$=5;class f${#_;#$;#X;constructor(_){this.#_=_,this.#$=new DataView(_.buffer,_.byteOffset,_.byteLength),this.#X=0}varint(){let _=0;for(let $=0;;$+=7){let X=this.#_[this.#X++];if(_|=(X&127)<<$,!(X&128))break}return _}varintBig(){let _=0n;for(let $=0n;;$+=7n){let X=this.#_[this.#X++];if(_|=BigInt(X&127)<<$,!(X&128))break}return _}bytes(_){let $=new Uint8Array(this.#_.buffer,this.#_.byteOffset+this.#X,_);return this.#X+=_,$}double(){let _=this.#$.getFloat64(this.#X,!0);return this.#X+=8,_}skipVarint(){for(;;)if(!(this.#_[this.#X++]&128))break}skip(_){this.#X+=_}eof(){return this.#X>=this.#_.byteLength}}class b${#_;#$;constructor(_){this.#_=_,this.#$=-1}setup(_){this.#$=_}#X(_){if(this.#$!==_)throw new L(`Expected wire type ${_}, got ${this.#$}`);this.#$=-1}bytes(){this.#X(h_);let _=this.#_.varint();return this.#_.bytes(_)}string(){return new TextDecoder().decode(this.bytes())}message(_){return h1(this.bytes(),_)}int32(){return this.#X(Z2),this.#_.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#X(Z2),this.#_.varintBig()}sint64(){let _=this.uint64();return _>>1n^-(_&1n)}double(){return this.#X(y_),this.#_.double()}maybeSkip(){if(this.#$<0)return;else if(this.#$===Z2)this.#_.skipVarint();else if(this.#$===y_)this.#_.skip(8);else if(this.#$===h_){let _=this.#_.varint();this.#_.skip(_)}else if(this.#$===h$)this.#_.skip(4);else throw new L(`Unexpected wire type ${this.#$}`);this.#$=-1}}function h1(_,$){let X=new f$(_),Z=new b$(X),J=$.default();while(!X.eof()){let G=X.varint(),Y=G>>3,z=G&7;Z.setup(z);let H=$[Y];if(H!==void 0){let F=H(Z,J);if(F!==void 0)J=F}Z.maybeSkip()}return J}class j4{#_;#$;#X;#Z;constructor(){this.#_=new ArrayBuffer(256),this.#$=new Uint8Array(this.#_),this.#X=new DataView(this.#_),this.#Z=0}#J(_){if(this.#Z+_<=this.#_.byteLength)return;let $=this.#_.byteLength;while($<this.#Z+_)$*=2;let X=new ArrayBuffer($),Z=new Uint8Array(X),J=new DataView(X);Z.set(new Uint8Array(this.#_,0,this.#Z)),this.#_=X,this.#$=Z,this.#X=J}#G(_){this.#J(5),_=0|_;do{let $=_&127;_>>>=7,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#Y(_){this.#J(10),_=_&0xffffffffffffffffn;do{let $=Number(_&0x7fn);_>>=7n,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#z(_,$){this.#G(_<<3|$)}bytes(_,$){this.#z(_,h_),this.#G($.byteLength),this.#J($.byteLength),this.#$.set($,this.#Z),this.#Z+=$.byteLength}string(_,$){this.bytes(_,new TextEncoder().encode($))}message(_,$,X){let Z=new j4;X(Z,$),this.bytes(_,Z.data())}int32(_,$){this.#z(_,Z2),this.#G($)}uint32(_,$){this.int32(_,$)}bool(_,$){this.int32(_,$?1:0)}sint64(_,$){this.#z(_,Z2),this.#Y($<<1n^$>>63n)}double(_,$){this.#z(_,y_),this.#J(8),this.#X.setFloat64(this.#Z,$,!0),this.#Z+=8}data(){return new Uint8Array(this.#_,0,this.#Z)}}function f_(_,$){let X=new j4;return $(X,_),X.data()}class f1{#_;#$;constructor(){this.#_=new Set,this.#$=new Set}alloc(){for(let $ of this.#$){if(this.#$.delete($),this.#_.add($),!this.#_.has(this.#_.size-1))this.#$.add(this.#_.size-1);return $}let _=this.#_.size;return this.#_.add(_),_}free(_){if(!this.#_.delete(_))throw new N0("Freeing an id that is not allocated");if(this.#$.delete(this.#_.size),_<this.#_.size)this.#$.add(_)}}function m(_,$){throw new N0($)}function f2(_){if(_===null)return null;else if(typeof _==="string")return _;else if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<iH||_>nH)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")return _?1n:0n;else if(_ instanceof ArrayBuffer)return new Uint8Array(_);else if(_ instanceof Uint8Array)return _;else if(_ instanceof Date)return+_.valueOf();else if(typeof _==="object")return""+_.toString();else throw TypeError("Unsupported type of value")}var iH=-9223372036854775808n,nH=9223372036854775807n;function T4(_,$){if(_===null)return null;else if(typeof _==="number")return _;else if(typeof _==="string")return _;else if(typeof _==="bigint")if($==="number"){let X=Number(_);if(!Number.isSafeInteger(X))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return X}else if($==="bigint")return _;else if($==="string")return""+_;else throw new H1("Invalid value for IntMode");else if(_ instanceof Uint8Array)return _.slice().buffer;else if(_===void 0)throw new L("Received unrecognized type of Value");else throw m(_,"Impossible type of Value")}function J2(_){return{affectedRowCount:_.affectedRowCount,lastInsertRowid:_.lastInsertRowid,columnNames:_.cols.map(($)=>$.name),columnDecltypes:_.cols.map(($)=>$.decltype)}}function g6(_,$){let X=J2(_),Z=_.rows.map((J)=>g$(X.columnNames,J,$));return{...X,rows:Z}}function p6(_,$){let X=J2(_),Z;if(_.rows.length>0)Z=g$(X.columnNames,_.rows[0],$);return{...X,row:Z}}function m6(_,$){let X=J2(_),Z;if(_.rows.length>0&&X.columnNames.length>0)Z=T4(_.rows[0][0],$);return{...X,value:Z}}function g$(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:$.length});for(let J=0;J<$.length;++J){let G=T4($[J],X);Object.defineProperty(Z,J,{value:G});let Y=_[J];if(Y!==void 0&&!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function I1(_){return new C_(_.message,_)}class G2{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}_getSqlId(_){if(this.#_!==_)throw new H1("Attempted to use SQL text opened with other object");else if(this.#X!==void 0)throw new Z0("SQL text is closed",this.#X);return this.#$}close(){this._setClosed(new d("SQL text was manually closed"))}_setClosed(_){if(this.#X===void 0)this.#X=_,this.#_._closeSql(this.#$)}get closed(){return this.#X!==void 0}}function b_(_,$){if($ instanceof G2)return{sqlId:$._getSqlId(_)};else return{sql:""+$}}class b1{#_;#$;constructor(){this.#_=[],this.#$=[]}get length(){return this.#_.length+this.#$.length}push(_){this.#_.push(_)}shift(){if(this.#$.length===0&&this.#_.length>0)this.#$=this.#_.reverse(),this.#_=[];return this.#$.pop()}first(){return this.#$.length!==0?this.#$[this.#$.length-1]:this.#_[0]}}class g_{sql;_args;_namedArgs;constructor(_){this.sql=_,this._args=[],this._namedArgs=new Map}bindIndexes(_){this._args.length=0;for(let $ of _)this._args.push(f2($));return this}bindIndex(_,$){if(_!==(_|0)||_<=0)throw RangeError("Index of a positional argument must be positive integer");while(this._args.length<_)this._args.push(null);return this._args[_-1]=f2($),this}bindName(_,$){return this._namedArgs.set(_,f2($)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function u6(_,$,X){let Z,J=[],G=[];if($ instanceof g_){Z=$.sql,J=$._args;for(let[H,F]of $._namedArgs.entries())G.push({name:H,value:F})}else if(Array.isArray($))if(Z=$[0],Array.isArray($[1]))J=$[1].map((H)=>f2(H));else G=Object.entries($[1]).map(([H,F])=>{return{name:H,value:f2(F)}});else Z=$;let{sql:Y,sqlId:z}=b_(_,Z);return{sql:Y,sqlId:z,args:J,namedArgs:G,wantRows:X}}class d6{_stream;#_;_steps;#$;constructor(_,$){this._stream=_,this.#_=$,this._steps=[],this.#$=!1}step(){return new L4(this)}execute(){if(this.#$)throw new H1("This batch has already been executed");this.#$=!0;let _={steps:this._steps.map(($)=>$.proto)};if(this.#_)return sH(this._stream,this._steps,_);else return oH(this._stream,this._steps,_)}}function oH(_,$,X){return _._batch(X).then((Z)=>{for(let J=0;J<$.length;++J){let G=Z.stepResults.get(J),Y=Z.stepErrors.get(J);$[J].callback(G,Y)}})}async function sH(_,$,X){let Z=await _._openCursor(X);try{let J=0,G=void 0,Y=[];for(;;){let z=await Z.next();if(z===void 0)break;if(z.type==="step_begin"){if(z.step<J||z.step>=$.length)throw new L("Server produced StepBeginEntry for unexpected step");else if(G!==void 0)throw new L("Server produced StepBeginEntry before terminating previous step");for(let H=J;H<z.step;++H)$[H].callback(void 0,void 0);J=z.step+1,G=z,Y=[]}else if(z.type==="step_end"){if(G===void 0)throw new L("Server produced StepEndEntry but no step is active");let H={cols:G.cols,rows:Y,affectedRowCount:z.affectedRowCount,lastInsertRowid:z.lastInsertRowid};$[G.step].callback(H,void 0),G=void 0,Y=[]}else if(z.type==="step_error"){if(G===void 0){if(z.step>=$.length)throw new L("Server produced StepErrorEntry for unexpected step");for(let H=J;H<z.step;++H)$[H].callback(void 0,void 0)}else{if(z.step!==G.step)throw new L("Server produced StepErrorEntry for unexpected step");G=void 0,Y=[]}$[z.step].callback(void 0,z.error),J=z.step+1}else if(z.type==="row"){if(G===void 0)throw new L("Server produced RowEntry but no step is active");Y.push(z.row)}else if(z.type==="error")throw I1(z.error);else if(z.type==="none")throw new L("Server produced unrecognized CursorEntry");else throw m(z,"Impossible CursorEntry")}if(G!==void 0)throw new L("Server closed Cursor before terminating active step");for(let z=J;z<$.length;++z)$[z].callback(void 0,void 0)}finally{Z.close()}}class L4{_batch;#_;_index;constructor(_){this._batch=_,this.#_=[],this._index=void 0}condition(_){return this.#_.push(_._proto),this}query(_){return this.#$(_,!0,g6)}queryRow(_){return this.#$(_,!0,p6)}queryValue(_){return this.#$(_,!0,m6)}run(_){return this.#$(_,!1,J2)}#$(_,$,X){if(this._index!==void 0)throw new H1("This BatchStep has already been added to the batch");let Z=u6(this._batch._stream._sqlOwner(),_,$),J;if(this.#_.length===0)J=void 0;else if(this.#_.length===1)J=this.#_[0];else J={type:"and",conds:this.#_.slice()};let G={stmt:Z,condition:J};return new Promise((Y,z)=>{let H=(F,W)=>{if(F!==void 0&&W!==void 0)z(new L("Server returned both result and error"));else if(W!==void 0)z(I1(W));else if(F!==void 0)Y(X(F,this._batch._stream.intMode));else Y(void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:G,callback:H})})}}class t{_batch;_proto;constructor(_,$){this._batch=_,this._proto=$}static ok(_){return new t(_._batch,{type:"ok",step:p$(_)})}static error(_){return new t(_._batch,{type:"error",step:p$(_)})}static not(_){return new t(_._batch,{type:"not",cond:_._proto})}static and(_,$){for(let X of $)m$(_,X);return new t(_,{type:"and",conds:$.map((X)=>X._proto)})}static or(_,$){for(let X of $)m$(_,X);return new t(_,{type:"or",conds:$.map((X)=>X._proto)})}static isAutocommit(_){return _._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new t(_,{type:"is_autocommit"})}}function p$(_){if(_._index===void 0)throw new H1("Cannot add a condition referencing a step that has not been added to the batch");return _._index}function m$(_,$){if($._batch!==_)throw new H1("Cannot mix BatchCond objects for different Batch objects")}function u$(_){return{paramNames:_.params.map(($)=>$.name),columns:_.cols,isExplain:_.isExplain,isReadonly:_.isReadonly}}class b2{constructor(_){this.intMode=_}query(_){return this.#_(_,!0,g6)}queryRow(_){return this.#_(_,!0,p6)}queryValue(_){return this.#_(_,!0,m6)}run(_){return this.#_(_,!1,J2)}#_(_,$,X){let Z=u6(this._sqlOwner(),_,$);return this._execute(Z).then((J)=>X(J,this.intMode))}batch(_=!1){return new d6(this,_)}describe(_){let $=b_(this._sqlOwner(),_);return this._describe($).then(u$)}sequence(_){let $=b_(this._sqlOwner(),_);return this._sequence($)}intMode}class p_{}var rH=1000,aH=10;class w4 extends p_{#_;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X){super();this.#_=_,this.#$=$,this.#X=X,this.#Z=new b1,this.#J=new b1,this.#G=void 0,this.#Y=!1}async next(){for(;;){if(this.#G!==void 0)throw new Z0("Cursor is closed",this.#G);while(!this.#Y&&this.#J.length<aH)this.#J.push(this.#z());let _=this.#Z.shift();if(this.#Y||_!==void 0)return _;await this.#J.shift().then(($)=>{if($===void 0)return;for(let X of $.entries)this.#Z.push(X);this.#Y||=$.done})}}#z(){return this.#$._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#X,maxCount:rH}).then((_)=>_,(_)=>{this._setClosed(_);return})}_setClosed(_){if(this.#G!==void 0)return;this.#G=_,this.#$._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#X}).catch(()=>{return}),this.#$._cursorClosed(this)}close(){this._setClosed(new d("Cursor was manually closed"))}get closed(){return this.#G!==void 0}}class m_ extends b2{#_;#$;#X;#Z;#J;#G;static open(_){let $=_._streamIdAlloc.alloc(),X=new m_(_,$),Z=()=>{return},J=(Y)=>X.#W(Y),G={type:"open_stream",streamId:$};return _._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}constructor(_,$){super(_.intMode);this.#_=_,this.#$=$,this.#X=new b1,this.#Z=void 0,this.#J=!1,this.#G=void 0}client(){return this.#_}_sqlOwner(){return this.#_}_execute(_){return this.#Y({type:"execute",streamId:this.#$,stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#Y({type:"batch",streamId:this.#$,batch:_}).then(($)=>{return $.result})}_describe(_){return this.#_._ensureVersion(2,"describe()"),this.#Y({type:"describe",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#_._ensureVersion(2,"sequence()"),this.#Y({type:"sequence",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#Y({type:"get_autocommit",streamId:this.#$}).then((_)=>{return _.isAutocommit})}#Y(_){return new Promise(($,X)=>{this.#z({type:"request",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return this.#_._ensureVersion(3,"cursor"),new Promise(($,X)=>{this.#z({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_sendCursorRequest(_,$){if(_!==this.#Z)throw new N0("Cursor not associated with the stream attempted to execute a request");return new Promise((X,Z)=>{if(this.#G!==void 0)Z(new Z0("Stream is closed",this.#G));else this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})})}_cursorClosed(_){if(_!==this.#Z)throw new N0("Cursor was closed, but it was not associated with the stream");this.#Z=void 0,this.#H()}#z(_){if(this.#G!==void 0)_.errorCallback(new Z0("Stream is closed",this.#G));else if(this.#J)_.errorCallback(new Z0("Stream is closing",void 0));else this.#X.push(_),this.#H()}#H(){for(;;){let _=this.#X.first();if(_===void 0&&this.#Z===void 0&&this.#J){this.#W(new d("Stream was gracefully closed"));break}else if(_?.type==="request"&&this.#Z===void 0){let{request:$,responseCallback:X,errorCallback:Z}=_;this.#X.shift(),this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}else if(_?.type==="cursor"&&this.#Z===void 0){let{batch:$,cursorCallback:X}=_;this.#X.shift();let Z=this.#_._cursorIdAlloc.alloc(),J=new w4(this.#_,this,Z),G={type:"open_cursor",streamId:this.#$,cursorId:Z,batch:$},Y=()=>{return},z=(H)=>J._setClosed(H);this.#_._sendRequest(G,{responseCallback:Y,errorCallback:z}),this.#Z=J,X(J)}else break}}#W(_){if(this.#G!==void 0)return;if(this.#G=_,this.#Z!==void 0)this.#Z._setClosed(_);for(;;){let J=this.#X.shift();if(J!==void 0)J.errorCallback(_);else break}let $={type:"close_stream",streamId:this.#$},X=()=>this.#_._streamIdAlloc.free(this.#$),Z=()=>{return};this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}close(){this.#W(new d("Stream was manually closed"))}closeGracefully(){this.#J=!0,this.#H()}get closed(){return this.#G!==void 0||this.#J}}function u_(_,$){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId);_.arrayObjects("args",$.args,d$),_.arrayObjects("named_args",$.namedArgs,tH),_.boolean("want_rows",$.wantRows)}function tH(_,$){_.string("name",$.name),_.object("value",$.value,d$)}function g2(_,$){_.arrayObjects("steps",$.steps,eH)}function eH(_,$){if($.condition!==void 0)_.object("condition",$.condition,P4);_.object("stmt",$.stmt,u_)}function P4(_,$){if(_.stringRaw("type",$.type),$.type==="ok"||$.type==="error")_.number("step",$.step);else if($.type==="not")_.object("cond",$.cond,P4);else if($.type==="and"||$.type==="or")_.arrayObjects("conds",$.conds,P4);else if($.type==="is_autocommit");else throw m($,"Impossible type of BatchCond")}function d$(_,$){if($===null)_.stringRaw("type","null");else if(typeof $==="bigint")_.stringRaw("type","integer"),_.stringRaw("value",""+$);else if(typeof $==="number")_.stringRaw("type","float"),_.number("value",$);else if(typeof $==="string")_.stringRaw("type","text"),_.string("value",$);else if($ instanceof Uint8Array)_.stringRaw("type","blob"),_.stringRaw("base64",Q2.fromUint8Array($));else if($===void 0);else throw m($,"Impossible type of Value")}function c$(_,$){if(_.stringRaw("type",$.type),$.type==="hello"){if($.jwt!==void 0)_.string("jwt",$.jwt)}else if($.type==="request")_.number("request_id",$.requestId),_.object("request",$.request,_F);else throw m($,"Impossible type of ClientMsg")}function _F(_,$){if(_.stringRaw("type",$.type),$.type==="open_stream")_.number("stream_id",$.streamId);else if($.type==="close_stream")_.number("stream_id",$.streamId);else if($.type==="execute")_.number("stream_id",$.streamId),_.object("stmt",$.stmt,u_);else if($.type==="batch")_.number("stream_id",$.streamId),_.object("batch",$.batch,g2);else if($.type==="open_cursor")_.number("stream_id",$.streamId),_.number("cursor_id",$.cursorId),_.object("batch",$.batch,g2);else if($.type==="close_cursor")_.number("cursor_id",$.cursorId);else if($.type==="fetch_cursor")_.number("cursor_id",$.cursorId),_.number("max_count",$.maxCount);else if($.type==="sequence"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit")_.number("stream_id",$.streamId);else throw m($,"Impossible type of Request")}function d_(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId);for(let X of $.args)_.message(3,X,i$);for(let X of $.namedArgs)_.message(4,X,$F);_.bool(5,$.wantRows)}function $F(_,$){_.string(1,$.name),_.message(2,$.value,i$)}function p2(_,$){for(let X of $.steps)_.message(1,X,XF)}function XF(_,$){if($.condition!==void 0)_.message(1,$.condition,x4);_.message(2,$.stmt,d_)}function x4(_,$){if($.type==="ok")_.uint32(1,$.step);else if($.type==="error")_.uint32(2,$.step);else if($.type==="not")_.message(3,$.cond,x4);else if($.type==="and")_.message(4,$.conds,l$);else if($.type==="or")_.message(5,$.conds,l$);else if($.type==="is_autocommit")_.message(6,void 0,n$);else throw m($,"Impossible type of BatchCond")}function l$(_,$){for(let X of $)_.message(1,X,x4)}function i$(_,$){if($===null)_.message(1,void 0,n$);else if(typeof $==="bigint")_.sint64(2,$);else if(typeof $==="number")_.double(3,$);else if(typeof $==="string")_.string(4,$);else if($ instanceof Uint8Array)_.bytes(5,$);else if($===void 0);else throw m($,"Impossible type of Value")}function n$(_,$){}function o$(_,$){if($.type==="hello")_.message(1,$,ZF);else if($.type==="request")_.message(2,$,JF);else throw m($,"Impossible type of ClientMsg")}function ZF(_,$){if($.jwt!==void 0)_.string(1,$.jwt)}function JF(_,$){_.int32(1,$.requestId);let X=$.request;if(X.type==="open_stream")_.message(2,X,GF);else if(X.type==="close_stream")_.message(3,X,YF);else if(X.type==="execute")_.message(4,X,zF);else if(X.type==="batch")_.message(5,X,HF);else if(X.type==="open_cursor")_.message(6,X,FF);else if(X.type==="close_cursor")_.message(7,X,WF);else if(X.type==="fetch_cursor")_.message(8,X,UF);else if(X.type==="sequence")_.message(9,X,AF);else if(X.type==="describe")_.message(10,X,KF);else if(X.type==="store_sql")_.message(11,X,OF);else if(X.type==="close_sql")_.message(12,X,DF);else if(X.type==="get_autocommit")_.message(13,X,RF);else throw m(X,"Impossible type of Request")}function GF(_,$){_.int32(1,$.streamId)}function YF(_,$){_.int32(1,$.streamId)}function zF(_,$){_.int32(1,$.streamId),_.message(2,$.stmt,d_)}function HF(_,$){_.int32(1,$.streamId),_.message(2,$.batch,p2)}function FF(_,$){_.int32(1,$.streamId),_.int32(2,$.cursorId),_.message(3,$.batch,p2)}function WF(_,$){_.int32(1,$.cursorId)}function UF(_,$){_.int32(1,$.cursorId),_.uint32(2,$.maxCount)}function AF(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function KF(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function OF(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function DF(_,$){_.int32(1,$.sqlId)}function RF(_,$){_.int32(1,$.streamId)}function g1(_){let $=L0(_.message),X=C0(_.code);return{message:$,code:X}}function c_(_){let $=s0(_.cols,s$),X=k_(_.rows).map((Y)=>s0(Y,r$)),Z=B1(_.affected_row_count),J=C0(_.last_insert_rowid),G=J!==void 0?BigInt(J):void 0;return{cols:$,rows:X,affectedRowCount:Z,lastInsertRowid:G}}function s$(_){let $=C0(_.name),X=C0(_.decltype);return{name:$,decltype:X}}function c6(_){let $=new Map;k_(_.step_results).forEach((Z,J)=>{if(Z!==null)$.set(J,c_(Y0(Z)))});let X=new Map;return k_(_.step_errors).forEach((Z,J)=>{if(Z!==null)X.set(J,g1(Y0(Z)))}),{stepResults:$,stepErrors:X}}function l6(_){let $=L0(_.type);if($==="step_begin"){let X=B1(_.step),Z=s0(_.cols,s$);return{type:"step_begin",step:X,cols:Z}}else if($==="step_end"){let X=B1(_.affected_row_count),Z=C0(_.last_insert_rowid),J=Z!==void 0?BigInt(Z):void 0;return{type:"step_end",affectedRowCount:X,lastInsertRowid:J}}else if($==="step_error"){let X=B1(_.step),Z=g1(Y0(_.error));return{type:"step_error",step:X,error:Z}}else if($==="row")return{type:"row",row:s0(_.row,r$)};else if($==="error")return{type:"error",error:g1(Y0(_.error))};else throw new L("Unexpected type of CursorEntry")}function i6(_){let $=s0(_.params,VF),X=s0(_.cols,NF),Z=y1(_.is_explain),J=y1(_.is_readonly);return{params:$,cols:X,isExplain:Z,isReadonly:J}}function VF(_){return{name:C0(_.name)}}function NF(_){let $=L0(_.name),X=C0(_.decltype);return{name:$,decltype:X}}function r$(_){let $=L0(_.type);if($==="null")return null;else if($==="integer"){let X=L0(_.value);return BigInt(X)}else if($==="float")return B1(_.value);else if($==="text")return L0(_.value);else if($==="blob")return Q2.toUint8Array(L0(_.base64));else throw new L("Unexpected type of Value")}function a$(_){let $=L0(_.type);if($==="hello_ok")return{type:"hello_ok"};else if($==="hello_error")return{type:"hello_error",error:g1(Y0(_.error))};else if($==="response_ok"){let X=B1(_.request_id),Z=MF(Y0(_.response));return{type:"response_ok",requestId:X,response:Z}}else if($==="response_error"){let X=B1(_.request_id),Z=g1(Y0(_.error));return{type:"response_error",requestId:X,error:Z}}else throw new L("Unexpected type of ServerMsg")}function MF(_){let $=L0(_.type);if($==="open_stream")return{type:"open_stream"};else if($==="close_stream")return{type:"close_stream"};else if($==="execute")return{type:"execute",result:c_(Y0(_.result))};else if($==="batch")return{type:"batch",result:c6(Y0(_.result))};else if($==="open_cursor")return{type:"open_cursor"};else if($==="close_cursor")return{type:"close_cursor"};else if($==="fetch_cursor"){let X=s0(_.entries,l6),Z=y1(_.done);return{type:"fetch_cursor",entries:X,done:Z}}else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:i6(Y0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:y1(_.is_autocommit)};else throw new L("Unexpected type of Response")}var u0={default(){return{message:"",code:void 0}},1(_,$){$.message=_.string()},2(_,$){$.code=_.string()}},p1={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.cols.push(_.message(t$))},2(_,$){$.rows.push(_.message(e$))},3(_,$){$.affectedRowCount=Number(_.uint64())},4(_,$){$.lastInsertRowid=_.sint64()}},t$={default(){return{name:void 0,decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},e$={default(){return[]},1(_,$){$.push(_.message(wF))}},m2={default(){return{stepResults:new Map,stepErrors:new Map}},1(_,$){let[X,Z]=_.message(BF);$.stepResults.set(X,Z)},2(_,$){let[X,Z]=_.message(IF);$.stepErrors.set(X,Z)}},BF={default(){return[0,p1.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(p1)}},IF={default(){return[0,u0.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(u0)}},n6={default(){return{type:"none"}},1(_){return _.message(QF)},2(_){return _.message(EF)},3(_){return _.message(jF)},4(_){return{type:"row",row:_.message(e$)}},5(_){return{type:"error",error:_.message(u0)}}},QF={default(){return{type:"step_begin",step:0,cols:[]}},1(_,$){$.step=_.uint32()},2(_,$){$.cols.push(_.message(t$))}},EF={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.affectedRowCount=_.uint32()},2(_,$){$.lastInsertRowid=_.uint64()}},jF={default(){return{type:"step_error",step:0,error:u0.default()}},1(_,$){$.step=_.uint32()},2(_,$){$.error=_.message(u0)}},u2={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(_,$){$.params.push(_.message(TF))},2(_,$){$.cols.push(_.message(LF))},3(_,$){$.isExplain=_.bool()},4(_,$){$.isReadonly=_.bool()}},TF={default(){return{name:void 0}},1(_,$){$.name=_.string()}},LF={default(){return{name:"",decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},wF={default(){return},1(_){return null},2(_){return _.sint64()},3(_){return _.double()},4(_){return _.string()},5(_){return _.bytes()}};var _X={default(){return{type:"none"}},1(_){return{type:"hello_ok"}},2(_){return _.message(PF)},3(_){return _.message(qF)},4(_){return _.message(xF)}},PF={default(){return{type:"hello_error",error:u0.default()}},1(_,$){$.error=_.message(u0)}},xF={default(){return{type:"response_error",requestId:0,error:u0.default()}},1(_,$){$.requestId=_.int32()},2(_,$){$.error=_.message(u0)}},qF={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(_,$){$.requestId=_.int32()},2(_,$){$.response={type:"open_stream"}},3(_,$){$.response={type:"close_stream"}},4(_,$){$.response=_.message(CF)},5(_,$){$.response=_.message(SF)},6(_,$){$.response={type:"open_cursor"}},7(_,$){$.response={type:"close_cursor"}},8(_,$){$.response=_.message(kF)},9(_,$){$.response={type:"sequence"}},10(_,$){$.response=_.message(vF)},11(_,$){$.response={type:"store_sql"}},12(_,$){$.response={type:"close_sql"}},13(_,$){$.response=_.message(yF)}},CF={default(){return{type:"execute",result:p1.default()}},1(_,$){$.result=_.message(p1)}},SF={default(){return{type:"batch",result:m2.default()}},1(_,$){$.result=_.message(m2)}},kF={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(_,$){$.entries.push(_.message(n6))},2(_,$){$.done=_.bool()}},vF={default(){return{type:"describe",result:u2.default()}},1(_,$){$.result=_.message(u2)}},yF={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}};var $X=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),q4=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class o6 extends v2{#_;#$;#X;#Z;#J;#G;#Y;#z;#H;_streamIdAlloc;_cursorIdAlloc;#W;constructor(_,$){super();this.#_=_,this.#$=[],this.#X=!1,this.#Z=void 0,this.#J=!1,this.#G=void 0,this.#Y=!1,this.#z=new Map,this.#H=new f1,this._streamIdAlloc=new f1,this._cursorIdAlloc=new f1,this.#W=new f1,this.#_.binaryType="arraybuffer",this.#_.addEventListener("open",()=>this.#K()),this.#_.addEventListener("close",(X)=>this.#D(X)),this.#_.addEventListener("error",(X)=>this.#O(X)),this.#_.addEventListener("message",(X)=>this.#R(X)),this.#A({type:"hello",jwt:$})}#A(_){if(this.#Z!==void 0)throw new N0("Trying to send a message on a closed client");if(this.#X)this.#U(_);else{let $=()=>this.#U(_),X=()=>{return};this.#$.push({openCallback:$,errorCallback:X})}}#K(){let _=this.#_.protocol;if(_===void 0){this.#F(new d("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(_==="")this.#G={version:1,encoding:"json"};else if(this.#G=q4.get(_),this.#G===void 0){this.#F(new L(`Unrecognized WebSocket subprotocol: ${JSON.stringify(_)}`));return}for(let $ of this.#$)$.openCallback();this.#$.length=0,this.#X=!0}#U(_){let $=this.#G.encoding;if($==="json"){let X=v_(_,c$);this.#_.send(X)}else if($==="protobuf"){let X=f_(_,o$);this.#_.send(X)}else throw m($,"Impossible encoding")}getVersion(){return new Promise((_,$)=>{if(this.#Y=!0,this.#Z!==void 0)$(this.#Z);else if(!this.#X){let X=()=>_(this.#G.version);this.#$.push({openCallback:X,errorCallback:$})}else _(this.#G.version)})}_ensureVersion(_,$){if(this.#G===void 0||!this.#Y)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this.#G.version<_)throw new o0(`${$} is supported on protocol version ${_} and higher, but the WebSocket server only supports version ${this.#G.version}`)}_sendRequest(_,$){if(this.#Z!==void 0){$.errorCallback(new Z0("Client is closed",this.#Z));return}let X=this.#H.alloc();this.#z.set(X,{...$,type:_.type}),this.#A({type:"request",requestId:X,request:_})}#O(_){let X=_.message??"WebSocket was closed due to an error";this.#F(new y2(X))}#D(_){let $=`WebSocket was closed with code ${_.code}`;if(_.reason)$+=`: ${_.reason}`;this.#F(new y2($))}#F(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of this.#$)$.errorCallback(_);this.#$.length=0;for(let[$,X]of this.#z.entries())X.errorCallback(_),this.#H.free($);this.#z.clear(),this.#_.close()}#R(_){if(this.#Z!==void 0)return;try{let $,X=this.#G.encoding;if(X==="json"){if(typeof _.data!=="string"){this.#_.close(3003,"Only text messages are accepted with JSON encoding"),this.#F(new L("Received non-text message from server with JSON encoding"));return}$=X2(JSON.parse(_.data),a$)}else if(X==="protobuf"){if(!(_.data instanceof ArrayBuffer)){this.#_.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#F(new L("Received non-binary message from server with Protobuf encoding"));return}$=h1(new Uint8Array(_.data),_X)}else throw m(X,"Impossible encoding");this.#V($)}catch($){this.#_.close(3007,"Could not handle message"),this.#F($)}}#V(_){if(_.type==="none")throw new L("Received an unrecognized ServerMsg");else if(_.type==="hello_ok"||_.type==="hello_error"){if(this.#J)throw new L("Received a duplicated hello response");if(this.#J=!0,_.type==="hello_error")throw I1(_.error);return}else if(!this.#J)throw new L("Received a non-hello message before a hello response");if(_.type==="response_ok"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new L("Received unexpected OK response");this.#H.free($);try{if(X.type!==_.response.type)throw console.dir({responseState:X,msg:_}),new L("Received unexpected type of response");X.responseCallback(_.response)}catch(Z){throw X.errorCallback(Z),Z}}else if(_.type==="response_error"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new L("Received unexpected error response");this.#H.free($),X.errorCallback(I1(_.error))}else throw m(_,"Impossible ServerMsg type")}openStream(){return m_.open(this)}storeSql(_){this._ensureVersion(2,"storeSql()");let $=this.#W.alloc(),X=new G2(this,$),Z=()=>{return},J=(Y)=>X._setClosed(Y),G={type:"store_sql",sqlId:$,sql:_};return this._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}_closeSql(_){if(this.#Z!==void 0)return;let $=()=>this.#W.free(_),X=(J)=>this.#F(J),Z={type:"close_sql",sqlId:_};this._sendRequest(Z,{responseCallback:$,errorCallback:X})}close(){this.#F(new d("Client was manually closed"))}get closed(){return this.#Z!==void 0}}var l_=Request,C4=Headers,S4=fetch;var Y2;if(typeof queueMicrotask<"u")Y2=queueMicrotask;else{let _=Promise.resolve();Y2=($)=>{_.then($)}}class k4{#_;#$;#X;constructor(_){this.#_=new Uint8Array(new ArrayBuffer(_)),this.#$=0,this.#X=0}get length(){return this.#X-this.#$}data(){return this.#_.slice(this.#$,this.#X)}push(_){this.#Z(_.byteLength),this.#_.set(_,this.#X),this.#X+=_.byteLength}#Z(_){if(this.#X+_<=this.#_.byteLength)return;let $=this.#X-this.#$;if($+_<=this.#_.byteLength&&2*this.#X>=this.#_.byteLength)this.#_.copyWithin(0,this.#$,this.#X);else{let X=this.#_.byteLength;do X*=2;while($+_>X);let Z=new Uint8Array(new ArrayBuffer(X));Z.set(this.#_.slice(this.#$,this.#X),0),this.#_=Z}this.#X=$,this.#$=0}shift(_){this.#$+=_}}function XX(_){let $=C0(_.baton),X=C0(_.base_url),Z=s0(_.results,hF);return{baton:$,baseUrl:X,results:Z}}function hF(_){let $=L0(_.type);if($==="ok")return{type:"ok",response:fF(Y0(_.response))};else if($==="error")return{type:"error",error:g1(Y0(_.error))};else throw new L("Unexpected type of StreamResult")}function fF(_){let $=L0(_.type);if($==="close")return{type:"close"};else if($==="execute")return{type:"execute",result:c_(Y0(_.result))};else if($==="batch")return{type:"batch",result:c6(Y0(_.result))};else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:i6(Y0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:y1(_.is_autocommit)};else throw new L("Unexpected type of StreamResponse")}function ZX(_){let $=C0(_.baton),X=C0(_.base_url);return{baton:$,baseUrl:X}}var JX={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()},3(_,$){$.results.push(_.message(bF))}},bF={default(){return{type:"none"}},1(_){return{type:"ok",response:_.message(gF)}},2(_){return{type:"error",error:_.message(u0)}}},gF={default(){return{type:"none"}},1(_){return{type:"close"}},2(_){return _.message(pF)},3(_){return _.message(mF)},4(_){return{type:"sequence"}},5(_){return _.message(uF)},6(_){return{type:"store_sql"}},7(_){return{type:"close_sql"}},8(_){return _.message(dF)}},pF={default(){return{type:"execute",result:p1.default()}},1(_,$){$.result=_.message(p1)}},mF={default(){return{type:"batch",result:m2.default()}},1(_,$){$.result=_.message(m2)}},uF={default(){return{type:"describe",result:u2.default()}},1(_,$){$.result=_.message(u2)}},dF={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}},GX={default(){return{baton:void 0,baseUrl:void 0}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()}};class v4 extends p_{#_;#$;#X;#Z;#J;#G;constructor(_,$){super();this.#_=_,this.#$=$,this.#X=void 0,this.#Z=new k4(16384),this.#J=void 0,this.#G=!1}async open(_){if(_.body===null)throw new L("No response body for cursor request");this.#X=_.body.getReader();let $=await this.#Y(ZX,GX);if($===void 0)throw new L("Empty response to cursor request");return $}next(){return this.#Y(l6,n6)}close(){this._setClosed(new d("Cursor was manually closed"))}_setClosed(_){if(this.#J!==void 0)return;if(this.#J=_,this.#_._cursorClosed(this),this.#X!==void 0)this.#X.cancel()}get closed(){return this.#J!==void 0}async#Y(_,$){for(;;){if(this.#G)return;else if(this.#J!==void 0)throw new Z0("Cursor is closed",this.#J);if(this.#$==="json"){let J=this.#z();if(J!==void 0){let G=new TextDecoder().decode(J),Y=JSON.parse(G);return X2(Y,_)}}else if(this.#$==="protobuf"){let J=this.#H();if(J!==void 0)return h1(J,$)}else throw m(this.#$,"Impossible encoding");if(this.#X===void 0)throw new N0("Attempted to read from HTTP cursor before it was opened");let{value:X,done:Z}=await this.#X.read();if(Z&&this.#Z.length===0)this.#G=!0;else if(Z)throw new L("Unexpected end of cursor stream");else this.#Z.push(X)}}#z(){let _=this.#Z.data(),$=10,X=_.indexOf(10);if(X<0)return;let Z=_.slice(0,X);return this.#Z.shift(X+1),Z}#H(){let _=this.#Z.data(),$=0,X=0;for(;;){if(X>=_.byteLength)return;let J=_[X];if($|=(J&127)<<7*X,X+=1,!(J&128))break}if(_.byteLength<X+$)return;let Z=_.slice(X,X+$);return this.#Z.shift(X+$),Z}}function YX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.arrayObjects("requests",$.requests,cF)}function cF(_,$){if(_.stringRaw("type",$.type),$.type==="close");else if($.type==="execute")_.object("stmt",$.stmt,u_);else if($.type==="batch")_.object("batch",$.batch,g2);else if($.type==="sequence"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit");else throw m($,"Impossible type of StreamRequest")}function zX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.object("batch",$.batch,g2)}function HX(_,$){if($.baton!==void 0)_.string(1,$.baton);for(let X of $.requests)_.message(2,X,lF)}function lF(_,$){if($.type==="close")_.message(1,$,iF);else if($.type==="execute")_.message(2,$,nF);else if($.type==="batch")_.message(3,$,oF);else if($.type==="sequence")_.message(4,$,sF);else if($.type==="describe")_.message(5,$,rF);else if($.type==="store_sql")_.message(6,$,aF);else if($.type==="close_sql")_.message(7,$,tF);else if($.type==="get_autocommit")_.message(8,$,eF);else throw m($,"Impossible type of StreamRequest")}function iF(_,$){}function nF(_,$){_.message(1,$.stmt,d_)}function oF(_,$){_.message(1,$.batch,p2)}function sF(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function rF(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function aF(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function tF(_,$){_.int32(1,$.sqlId)}function eF(_,$){}function FX(_,$){if($.baton!==void 0)_.string(1,$.baton);_.message(2,$.batch,p2)}class s6 extends b2{#_;#$;#X;#Z;#J;#G;#Y;#z;#H;#W;#A;#K;constructor(_,$,X,Z){super(_.intMode);this.#_=_,this.#$=$.toString(),this.#X=X,this.#Z=Z,this.#J=void 0,this.#G=new b1,this.#Y=!1,this.#H=!1,this.#W=!1,this.#A=void 0,this.#K=new f1}client(){return this.#_}_sqlOwner(){return this}storeSql(_){let $=this.#K.alloc();return this.#U({type:"store_sql",sqlId:$,sql:_}).then(()=>{return},(X)=>this._setClosed(X)),new G2(this,$)}_closeSql(_){if(this.#A!==void 0)return;this.#U({type:"close_sql",sqlId:_}).then(()=>this.#K.free(_),($)=>this._setClosed($))}_execute(_){return this.#U({type:"execute",stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#U({type:"batch",batch:_}).then(($)=>{return $.result})}_describe(_){return this.#U({type:"describe",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#U({type:"sequence",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#U({type:"get_autocommit"}).then((_)=>{return _.isAutocommit})}#U(_){return new Promise(($,X)=>{this.#O({type:"pipeline",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return new Promise(($,X)=>{this.#O({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_cursorClosed(_){if(_!==this.#z)throw new N0("Cursor was closed, but it was not associated with the stream");this.#z=void 0,Y2(()=>this.#D())}close(){this._setClosed(new d("Stream was manually closed"))}closeGracefully(){this.#H=!0,Y2(()=>this.#D())}get closed(){return this.#A!==void 0||this.#H}_setClosed(_){if(this.#A!==void 0)return;if(this.#A=_,this.#z!==void 0)this.#z._setClosed(_);this.#_._streamClosed(this);for(;;){let $=this.#G.shift();if($!==void 0)$.errorCallback(_);else break}if((this.#J!==void 0||this.#Y)&&!this.#W)this.#G.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#W=!0,Y2(()=>this.#D())}#O(_){if(this.#A!==void 0)throw new Z0("Stream is closed",this.#A);else if(this.#H)throw new Z0("Stream is closing",void 0);else this.#G.push(_),Y2(()=>this.#D())}#D(){if(this.#Y||this.#z!==void 0)return;if(this.#H&&this.#G.length===0){this._setClosed(new d("Stream was gracefully closed"));return}let _=this.#_._endpoint;if(_===void 0){this.#_._endpointPromise.then(()=>this.#D(),(X)=>this._setClosed(X));return}let $=this.#G.shift();if($===void 0)return;else if($.type==="pipeline"){let X=[$];for(;;){let Z=this.#G.first();if(Z!==void 0&&Z.type==="pipeline")X.push(Z),this.#G.shift();else if(Z===void 0&&this.#H&&!this.#W){X.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#W=!0;break}else break}this.#F(_,X)}else if($.type==="cursor")this.#R(_,$);else throw m($,"Impossible type of QueueEntry")}#F(_,$){this.#V(()=>this.#M($,_),(X)=>$W(X,_.encoding),(X)=>X.baton,(X)=>X.baseUrl,(X)=>_W($,X),(X)=>$.forEach((Z)=>Z.errorCallback(X)))}#R(_,$){let X=new v4(this,_.encoding);this.#z=X,this.#V(()=>this.#B($,_),(Z)=>X.open(Z),(Z)=>Z.baton,(Z)=>Z.baseUrl,(Z)=>$.cursorCallback(X),(Z)=>$.errorCallback(Z))}#V(_,$,X,Z,J,G){let Y;try{let z=_(),H=this.#Z;Y=H(z)}catch(z){Y=Promise.reject(z)}this.#Y=!0,Y.then((z)=>{if(!z.ok)return XW(z).then((H)=>{throw H});return $(z)}).then((z)=>{this.#J=X(z),this.#$=Z(z)??this.#$,J(z)}).catch((z)=>{this._setClosed(z),G(z)}).finally(()=>{this.#Y=!1,this.#D()})}#M(_,$){return this.#N(new URL($.pipelinePath,this.#$),{baton:this.#J,requests:_.map((X)=>X.request)},$.encoding,YX,HX)}#B(_,$){if($.cursorPath===void 0)throw new o0(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${$.version}.`);return this.#N(new URL($.cursorPath,this.#$),{baton:this.#J,batch:_.batch},$.encoding,zX,FX)}#N(_,$,X,Z,J){let G,Y;if(X==="json")G=v_($,Z),Y="application/json";else if(X==="protobuf")G=f_($,J),Y="application/x-protobuf";else throw m(X,"Impossible encoding");let z=new C4;if(z.set("content-type",Y),this.#X!==void 0)z.set("authorization",`Bearer ${this.#X}`);return new l_(_.toString(),{method:"POST",headers:z,body:G})}}function _W(_,$){if($.results.length!==_.length)throw new L("Server returned unexpected number of pipeline results");for(let X=0;X<_.length;++X){let Z=$.results[X],J=_[X];if(Z.type==="ok"){if(Z.response.type!==J.request.type)throw new L("Received unexpected type of response");J.responseCallback(Z.response)}else if(Z.type==="error")J.errorCallback(I1(Z.error));else if(Z.type==="none")throw new L("Received unrecognized type of StreamResult");else throw m(Z,"Received impossible type of StreamResult")}}async function $W(_,$){if($==="json"){let X=await _.json();return X2(X,XX)}if($==="protobuf"){let X=await _.arrayBuffer();return h1(new Uint8Array(X),JX)}throw await _.body?.cancel(),m($,"Impossible encoding")}async function XW(_){let $=_.headers.get("content-type")??"text/plain",X=`Server returned HTTP status ${_.status}`;if($==="application/json"){let Z=await _.json();if("message"in Z)return I1(Z);return new $2(X,_.status)}if($==="text/plain"){let Z=(await _.text()).trim();if(Z!=="")X+=`: ${Z}`;return new $2(X,_.status)}return await _.body?.cancel(),new $2(X,_.status)}var ZW=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],y4={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class r6 extends v2{#_;#$;#X;#Z;#J;_endpointPromise;_endpoint;constructor(_,$,X,Z=2){super();if(this.#_=_,this.#$=$,this.#X=X??S4,this.#Z=void 0,this.#J=new Set,Z==3)this._endpointPromise=JW(this.#X,this.#_),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J));else this._endpointPromise=Promise.resolve(y4),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J))}async getVersion(){if(this._endpoint!==void 0)return this._endpoint.version;return(await this._endpointPromise).version}_ensureVersion(_,$){if(_<=y4.version)return;else if(this._endpoint===void 0)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this._endpoint.version<_)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}openStream(){if(this.#Z!==void 0)throw new Z0("Client is closed",this.#Z);let _=new s6(this,this.#_,this.#$,this.#X);return this.#J.add(_),_}_streamClosed(_){this.#J.delete(_)}close(){this.#G(new d("Client was manually closed"))}get closed(){return this.#Z!==void 0}#G(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of Array.from(this.#J))$._setClosed(new Z0("Client was closed",_))}}async function JW(_,$){let X=_;for(let Z of ZW){let J=new URL(Z.versionPath,$),G=new l_(J.toString(),{method:"GET"}),Y=await X(G);if(await Y.arrayBuffer(),Y.ok)return Z}return y4}function h4(_,$,X=2){if(typeof k2.default>"u")throw new S_("WebSockets are not supported in this environment");var Z=void 0;if(X==3)Z=Array.from(q4.keys());else Z=Array.from($X.keys());let J=new k2.default(_,Z);return new o6(J,$)}function f4(_,$,X,Z=2){return new r6(_ instanceof URL?_:new URL(_),$,X,Z)}class i_{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}execute(_){return this.batch([_]).then(($)=>$[0])}async batch(_){let $=this._getStream();if($.closed)throw new x("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let X=_.map(Q1),Z;if(this.#X===void 0){this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=G.step(),z=Y.run(x1(this.#_)),H=Y;Z=X.map((F)=>{let W=G.step().condition(t.ok(H));if(this.#$>=3)W.condition(t.not(t.isAutocommit(G)));let A=W.query(F);return A.catch(()=>{return}),H=W,A}),this.#X=G.execute().then(()=>z).then(()=>{return});try{await this.#X}catch(F){throw this.close(),F}}else{if(this.#$<3)await this.#X;this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=void 0;Z=X.map((z)=>{let H=G.step();if(Y!==void 0)H.condition(t.ok(Y));if(this.#$>=3)H.condition(t.not(t.isAutocommit(G)));let F=H.query(z);return F.catch(()=>{return}),Y=H,F}),await G.execute()}let J=[];for(let G of Z){let Y=await G;if(Y===void 0)throw new x("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");J.push(c2(Y))}return J}catch(X){throw _0(X)}}async executeMultiple(_){let $=this._getStream();if($.closed)throw new x("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#X===void 0){this.#X=$.run(x1(this.#_)).then(()=>{return});try{await this.#X}catch(X){throw this.close(),X}}else await this.#X;await $.sequence(_)}catch(X){throw _0(X)}}async rollback(){try{let _=this._getStream();if(_.closed)return;if(this.#X!==void 0);else return;let $=_.run("ROLLBACK").catch((X)=>{throw _0(X)});_.closeGracefully(),await $}catch(_){throw _0(_)}finally{this.close()}}async commit(){try{let _=this._getStream();if(_.closed)throw new x("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#X!==void 0)await this.#X;else return;let $=_.run("COMMIT").catch((X)=>{throw _0(X)});_.closeGracefully(),await $}catch(_){throw _0(_)}finally{this.close()}}}async function d2(_,$,X,Z,J=!1){if(J)X.step().run("PRAGMA foreign_keys=off");let G=X.step(),Y=G.run(x1(_)),z=G,H=Z.map((D)=>{let R=X.step().condition(t.ok(z));if($>=3)R.condition(t.not(t.isAutocommit(X)));let N=R.query(D);return z=R,N}),F=X.step().condition(t.ok(z));if($>=3)F.condition(t.not(t.isAutocommit(X)));let W=F.run("COMMIT");if(X.step().condition(t.not(t.ok(F))).run("ROLLBACK").catch((D)=>{return}),J)X.step().run("PRAGMA foreign_keys=on");await X.execute();let K=[];await Y;for(let D of H){let R=await D;if(R===void 0)throw new x("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");K.push(c2(R))}return await W,K}function Q1(_){let $,X;if(Array.isArray(_))[$,X]=_;else if(typeof _==="string")$=_;else $=_.sql,X=_.args;let Z=new g_($);if(X)if(Array.isArray(X))Z.bindIndexes(X);else for(let[J,G]of Object.entries(X))Z.bindName(J,G);return Z}function c2(_){let $=_.columnNames.map((Y)=>Y??""),X=_.columnDecltypes.map((Y)=>Y??""),Z=_.rows,J=_.affectedRowCount,G=_.lastInsertRowid!==void 0?_.lastInsertRowid:void 0;return new E2($,X,Z,J,G)}function _0(_){if(_ instanceof d){let $=WX(_);return new x(_.message,$,void 0,_)}return _}function WX(_){if(_ instanceof C_&&_.code!==void 0)return _.code;else if(_ instanceof L)return"HRANA_PROTO_ERROR";else if(_ instanceof Z0)return _.cause instanceof d?WX(_.cause):"HRANA_CLOSED_ERROR";else if(_ instanceof y2)return"HRANA_WEBSOCKET_ERROR";else if(_ instanceof $2)return"SERVER_ERROR";else if(_ instanceof o0)return"PROTOCOL_VERSION_ERROR";else if(_ instanceof N0)return"INTERNAL_ERROR";else return"UNKNOWN"}class l2{#_;#$;capacity;constructor(_,$){this.#_=_,this.#$=new UX,this.capacity=$}apply(_){if(this.capacity<=0)return;let $=new Set;for(let X of _){if(typeof X.sql!=="string")continue;let Z=X.sql;if(Z.length>=5000)continue;let J=this.#$.get(Z);if(J===void 0){while(this.#$.size+1>this.capacity){let[G,Y]=this.#$.peekLru();if($.has(Y))break;Y.close(),this.#$.delete(G)}if(this.#$.size+1<=this.capacity)J=this.#_.storeSql(Z),this.#$.set(Z,J)}if(J!==void 0)X.sql=J,$.add(J)}}}class UX{#_;constructor(){this.#_=new Map}get(_){let $=this.#_.get(_);if($!==void 0)this.#_.delete(_),this.#_.set(_,$);return $}set(_,$){this.#_.set(_,$)}peekLru(){for(let _ of this.#_.entries())return _;return}delete(_){this.#_.delete(_)}get size(){return this.#_.size}}var DX=j0(g4(),1);function RX(_){if(_.scheme!=="wss"&&_.scheme!=="ws")throw new x(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new x("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="ws"&&_.tls)throw new x('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="wss"&&!_.tls)throw new x('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=M_(_.scheme,_.authority,_.path),X;try{X=h4($,_.authToken)}catch(Z){if(Z instanceof S_){let J=_.scheme==="wss"?"https":"http",G=M_(J,_.authority,_.path);throw new x(`This environment does not support WebSockets, please switch to the HTTP client by using a "${J}:" URL (${JSON.stringify(G)}). For more information, please read ${J1}`,"WEBSOCKETS_NOT_SUPPORTED")}throw _0(Z)}return new VX(X,$,_.authToken,_.intMode,_.concurrency)}var zW=60000,OX=100;class VX{#_;#$;#X;#Z;#J;closed;protocol;#G;#Y;constructor(_,$,X,Z,J){this.#_=$,this.#$=X,this.#X=Z,this.#Z=this.#H(_),this.#J=void 0,this.closed=!1,this.protocol="ws",this.#Y=DX.default(J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{let Z=await this.#z();try{let J=Q1(X);Z.conn.sqlCache.apply([J]);let G=Z.stream.query(J);Z.stream.closeGracefully();let Y=await G;return c2(Y)}catch(J){throw _0(J)}finally{this._closeStream(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{let X=await this.#z();try{let J=_.map((F)=>{if(Array.isArray(F))return{sql:F[0],args:F[1]||[]};return F}).map(Q1),G=await X.conn.client.getVersion();X.conn.sqlCache.apply(J);let Y=X.stream.batch(G>=3);return await d2($,G,Y,J)}catch(Z){throw _0(Z)}finally{this._closeStream(X)}})}async migrate(_){return this.limit(async()=>{let $=await this.#z();try{let X=_.map(Q1),Z=await $.conn.client.getVersion(),J=$.stream.batch(Z>=3);return await d2("deferred",Z,J,X,!0)}catch(X){throw _0(X)}finally{this._closeStream($)}})}async transaction(_="write"){return this.limit(async()=>{let $=await this.#z();try{let X=await $.conn.client.getVersion();return new NX(this,$,_,X)}catch(X){throw this._closeStream($),_0(X)}})}async executeMultiple(_){return this.limit(async()=>{let $=await this.#z();try{let X=$.stream.sequence(_);$.stream.closeGracefully(),await X}catch(X){throw _0(X)}finally{this._closeStream($)}})}sync(){throw new x("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async#z(){if(this.closed)throw new x("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#Z.openTime.valueOf()>zW&&this.#J===void 0){let Z=this.#H();this.#J=Z,Z.client.getVersion().then((J)=>{if(this.#Z!==Z){if(this.#Z.streamStates.size===0)this.#Z.client.close()}this.#Z=Z,this.#J=void 0},(J)=>{this.#J=void 0})}if(this.#Z.client.closed)try{if(this.#J!==void 0)this.#Z=this.#J;else this.#Z=this.#H()}catch(Z){throw _0(Z)}let X=this.#Z;try{if(X.useSqlCache===void 0){if(X.useSqlCache=await X.client.getVersion()>=2,X.useSqlCache)X.sqlCache.capacity=OX}let Z=X.client.openStream();Z.intMode=this.#X;let J={conn:X,stream:Z};return X.streamStates.add(J),J}catch(Z){throw _0(Z)}}#H(_){try{return _??=h4(this.#_,this.#$),{client:_,useSqlCache:void 0,sqlCache:new l2(_,0),openTime:new Date,streamStates:new Set}}catch($){throw _0($)}}async reconnect(){try{for(let X of Array.from(this.#Z.streamStates))try{X.stream.close()}catch{}this.#Z.client.close()}catch{}if(this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}let _=this.#H(),$=await _.client.getVersion();if(_.useSqlCache=$>=2,_.useSqlCache)_.sqlCache.capacity=OX;this.#Z=_,this.closed=!1}_closeStream(_){_.stream.close();let $=_.conn;if($.streamStates.delete(_),$.streamStates.size===0&&$!==this.#Z)$.client.close()}close(){if(this.#Z.client.close(),this.closed=!0,this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}this.closed=!0}}class NX extends i_{#_;#$;constructor(_,$,X,Z){super(X,Z);this.#_=_,this.#$=$}_getStream(){return this.#$.stream}_getSqlCache(){return this.#$.conn.sqlCache}close(){this.#_._closeStream(this.#$)}get closed(){return this.#$.stream.closed}}var MX=j0(g4(),1);function BX(_){if(_.scheme!=="https"&&_.scheme!=="http")throw new x(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${J1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new x("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="http"&&_.tls)throw new x('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="https"&&!_.tls)throw new x('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=M_(_.scheme,_.authority,_.path);return new QX($,_.authToken,_.intMode,_.fetch,_.concurrency)}var IX=30;class QX{#_;protocol;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X,Z,J){this.#$=_,this.#G=$,this.#X=X,this.#Z=Z,this.#J=J,this.#_=f4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X,this.protocol="http",this.#Y=MX.default(this.#J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{try{let Z=Q1(X),J,G=this.#_.openStream();try{J=G.query(Z)}finally{G.closeGracefully()}let Y=await J;return c2(Y)}catch(Z){throw _0(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{try{let Z=_.map((H)=>{if(Array.isArray(H))return{sql:H[0],args:H[1]||[]};return H}).map(Q1),J=await this.#_.getVersion(),G,Y=this.#_.openStream();try{new l2(Y,IX).apply(Z);let F=Y.batch(!1);G=d2($,J,F,Z)}finally{Y.closeGracefully()}return await G}catch(X){throw _0(X)}})}async migrate(_){return this.limit(async()=>{try{let $=_.map(Q1),X=await this.#_.getVersion(),Z,J=this.#_.openStream();try{let Y=J.batch(!1);Z=d2("deferred",X,Y,$,!0)}finally{J.closeGracefully()}return await Z}catch($){throw _0($)}})}async transaction(_="write"){return this.limit(async()=>{try{let $=await this.#_.getVersion();return new EX(this.#_.openStream(),_,$)}catch($){throw _0($)}})}async executeMultiple(_){return this.limit(async()=>{try{let $,X=this.#_.openStream();try{$=X.sequence(_)}finally{X.closeGracefully()}await $}catch($){throw _0($)}})}sync(){throw new x("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#_.close()}async reconnect(){try{if(!this.closed)this.#_.close()}finally{this.#_=f4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X}}get closed(){return this.#_.closed}}class EX extends i_{#_;#$;constructor(_,$,X){super($,X);this.#_=_,this.#$=new l2(_,IX)}_getStream(){return this.#_}_getSqlCache(){return this.#$}close(){this.#_.close()}get closed(){return this.#_.closed}}function m1(_){return HW(I_(_,!0))}function HW(_){if(_.scheme==="wss"||_.scheme==="ws")return RX(_);else if(_.scheme==="https"||_.scheme==="http")return BX(_);else return P9(_)}class z0{static[O]="SelectionProxyHandler";config;constructor(_){this.config={..._}}get(_,$){if($==="_")return{..._._,selectedFields:new Proxy(_._.selectedFields,this)};if($===a)return{..._[a],selectedFields:new Proxy(_[a].selectedFields,this)};if(typeof $==="symbol")return _[$];let Z=(V(_,J0)?_._.selectedFields:V(_,f0)?_[a].selectedFields:_)[$];if(V(Z,Q.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!Z.isSelectionField)return Z.sql;let J=Z.clone();return J.isSelectionField=!0,J}if(V(Z,Q)){if(this.config.sqlBehavior==="sql")return Z;throw Error(`You tried to reference "${$}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}if(V(Z,u)){if(this.config.alias)return new Proxy(Z,new N2(new Proxy(Z.table,new A_(this.config.alias,this.config.replaceOriginalName??!1))));return Z}if(typeof Z!=="object"||Z===null)return Z;return new Proxy(Z,new z0(this.config))}}class p4{static[O]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(_,$){if(this.reference=()=>{let{name:X,columns:Z,foreignColumns:J}=_();return{name:X,columns:Z,foreignTable:J[0].table,foreignColumns:J}},$)this._onUpdate=$.onUpdate,this._onDelete=$.onDelete}onUpdate(_){return this._onUpdate=_,this}onDelete(_){return this._onDelete=_,this}build(_){return new jX(_,this)}}class jX{constructor(_,$){this.table=_,this.reference=$.reference,this.onUpdate=$._onUpdate,this.onDelete=$._onDelete}static[O]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:_,columns:$,foreignColumns:X}=this.reference(),Z=$.map((Y)=>Y.name),J=X.map((Y)=>Y.name),G=[this.table[P0],...Z,X[0].table[P0],...J];return _??`${G.join("_")}_fk`}}function TX(_,$){return`${_[P0]}_${$.join("_")}_unique`}class A0 extends d8{static[O]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(_,$={}){return this.foreignKeyConfigs.push({ref:_,actions:$}),this}unique(_){return this.config.isUnique=!0,this.config.uniqueName=_,this}generatedAlwaysAs(_,$){return this.config.generated={as:_,type:"always",mode:$?.mode??"virtual"},this}buildForeignKeys(_,$){return this.foreignKeyConfigs.map(({ref:X,actions:Z})=>{return((J,G)=>{let Y=new p4(()=>{let z=J();return{columns:[_],foreignColumns:[z]}});if(G.onUpdate)Y.onUpdate(G.onUpdate);if(G.onDelete)Y.onDelete(G.onDelete);return Y.build($)})(X,Z)})}}class $0 extends u{constructor(_,$){if(!$.uniqueName)$.uniqueName=TX(_,[$.name]);super(_,$);this.table=_}static[O]="SQLiteColumn"}class LX extends A0{static[O]="SQLiteBigIntBuilder";constructor(_){super(_,"bigint","SQLiteBigInt")}build(_){return new wX(_,this.config)}}class wX extends $0{static[O]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return BigInt($.toString("utf8"))}return BigInt(_4.decode(_))}mapToDriverValue(_){return Buffer.from(_.toString())}}class PX extends A0{static[O]="SQLiteBlobJsonBuilder";constructor(_){super(_,"json","SQLiteBlobJson")}build(_){return new xX(_,this.config)}}class xX extends $0{static[O]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return JSON.parse($.toString("utf8"))}return JSON.parse(_4.decode(_))}mapToDriverValue(_){return Buffer.from(JSON.stringify(_))}}class qX extends A0{static[O]="SQLiteBlobBufferBuilder";constructor(_){super(_,"buffer","SQLiteBlobBuffer")}build(_){return new CX(_,this.config)}}class CX extends $0{static[O]="SQLiteBlobBuffer";mapFromDriverValue(_){if(Buffer.isBuffer(_))return _;return Buffer.from(_)}getSQLType(){return"blob"}}function SX(_,$){let{name:X,config:Z}=X1(_,$);if(Z?.mode==="json")return new PX(X);if(Z?.mode==="bigint")return new LX(X);return new qX(X)}class kX extends A0{static[O]="SQLiteCustomColumnBuilder";constructor(_,$,X){super(_,"custom","SQLiteCustomColumn");this.config.fieldConfig=$,this.config.customTypeParams=X}build(_){return new vX(_,this.config)}}class vX extends $0{static[O]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(_,$){super(_,$);this.sqlName=$.customTypeParams.dataType($.fieldConfig),this.mapTo=$.customTypeParams.toDriver,this.mapFrom=$.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(_){return typeof this.mapFrom==="function"?this.mapFrom(_):_}mapToDriverValue(_){return typeof this.mapTo==="function"?this.mapTo(_):_}}function yX(_){return($,X)=>{let{name:Z,config:J}=X1($,X);return new kX(Z,J,_)}}class a6 extends A0{static[O]="SQLiteBaseIntegerBuilder";constructor(_,$,X){super(_,$,X);this.config.autoIncrement=!1}primaryKey(_){if(_?.autoIncrement)this.config.autoIncrement=!0;return this.config.hasDefault=!0,super.primaryKey()}}class t6 extends $0{static[O]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class hX extends a6{static[O]="SQLiteIntegerBuilder";constructor(_){super(_,"number","SQLiteInteger")}build(_){return new fX(_,this.config)}}class fX extends t6{static[O]="SQLiteInteger"}class bX extends a6{static[O]="SQLiteTimestampBuilder";constructor(_,$){super(_,"date","SQLiteTimestamp");this.config.mode=$}defaultNow(){return this.default(U`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(_){return new gX(_,this.config)}}class gX extends t6{static[O]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(_){if(this.config.mode==="timestamp")return new Date(_*1000);return new Date(_)}mapToDriverValue(_){let $=_.getTime();if(this.config.mode==="timestamp")return Math.floor($/1000);return $}}class pX extends a6{static[O]="SQLiteBooleanBuilder";constructor(_,$){super(_,"boolean","SQLiteBoolean");this.config.mode=$}build(_){return new mX(_,this.config)}}class mX extends t6{static[O]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(_){return Number(_)===1}mapToDriverValue(_){return _?1:0}}function S0(_,$){let{name:X,config:Z}=X1(_,$);if(Z?.mode==="timestamp"||Z?.mode==="timestamp_ms")return new bX(X,Z.mode);if(Z?.mode==="boolean")return new pX(X,Z.mode);return new hX(X)}class uX extends A0{static[O]="SQLiteNumericBuilder";constructor(_){super(_,"string","SQLiteNumeric")}build(_){return new dX(_,this.config)}}class dX extends $0{static[O]="SQLiteNumeric";mapFromDriverValue(_){if(typeof _==="string")return _;return String(_)}getSQLType(){return"numeric"}}class cX extends A0{static[O]="SQLiteNumericNumberBuilder";constructor(_){super(_,"number","SQLiteNumericNumber")}build(_){return new lX(_,this.config)}}class lX extends $0{static[O]="SQLiteNumericNumber";mapFromDriverValue(_){if(typeof _==="number")return _;return Number(_)}mapToDriverValue=String;getSQLType(){return"numeric"}}class iX extends A0{static[O]="SQLiteNumericBigIntBuilder";constructor(_){super(_,"bigint","SQLiteNumericBigInt")}build(_){return new nX(_,this.config)}}class nX extends $0{static[O]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function oX(_,$){let{name:X,config:Z}=X1(_,$),J=Z?.mode;return J==="number"?new cX(X):J==="bigint"?new iX(X):new uX(X)}class sX extends A0{static[O]="SQLiteRealBuilder";constructor(_){super(_,"number","SQLiteReal")}build(_){return new rX(_,this.config)}}class rX extends $0{static[O]="SQLiteReal";getSQLType(){return"real"}}function F1(_){return new sX(_??"")}class aX extends A0{static[O]="SQLiteTextBuilder";constructor(_,$){super(_,"string","SQLiteText");this.config.enumValues=$.enum,this.config.length=$.length}build(_){return new tX(_,this.config)}}class tX extends $0{static[O]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(_,$){super(_,$)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class eX extends A0{static[O]="SQLiteTextJsonBuilder";constructor(_){super(_,"json","SQLiteTextJson")}build(_){return new _Z(_,this.config)}}class _Z extends $0{static[O]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(_){return JSON.parse(_)}mapToDriverValue(_){return JSON.stringify(_)}}function S(_,$={}){let{name:X,config:Z}=X1(_,$);if(Z.mode==="json")return new eX(X);return new aX(X,Z)}function $Z(){return{blob:SX,customType:yX,integer:S0,numeric:oX,real:F1,text:S}}var m4=Symbol.for("drizzle:SQLiteInlineForeignKeys");class H0 extends B{static[O]="SQLiteTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:m4});[B.Symbol.Columns];[m4]=[];[B.Symbol.ExtraConfigBuilder]=void 0}function FW(_,$,X,Z,J=_){let G=new H0(_,Z,J),Y=typeof $==="function"?$($Z()):$,z=Object.fromEntries(Object.entries(Y).map(([F,W])=>{let A=W;A.setName(F);let K=A.build(G);return G[m4].push(...A.buildForeignKeys(K,G)),[F,K]})),H=Object.assign(G,z);if(H[B.Symbol.Columns]=z,H[B.Symbol.ExtraConfigColumns]=z,X)H[H0.Symbol.ExtraConfigBuilder]=X;return H}var Q0=(_,$,X)=>{return FW(_,$,X)};class XZ{constructor(_,$){this.name=_,this.unique=$}static[O]="SQLiteIndexBuilderOn";on(..._){return new ZZ(this.name,_,this.unique)}}class ZZ{static[O]="SQLiteIndexBuilder";config;constructor(_,$,X){this.config={name:_,columns:$,unique:X,where:void 0}}where(_){return this.config.where=_,this}build(_){return new JZ(this.config,_)}}class JZ{static[O]="SQLiteIndex";config;constructor(_,$){this.config={..._,table:$}}}function R0(_){return new XZ(_,!1)}function i2(..._){if(_[0].columns)return new u4(_[0].columns,_[0].name);return new u4(_)}class u4{static[O]="SQLitePrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new GZ(_,this.columns,this.name)}}class GZ{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[O]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[H0.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function r0(_){if(V(_,H0))return[`${_[B.Symbol.BaseName]}`];if(V(_,J0))return _._.usedTables??[];if(V(_,Q))return _.usedTables??[];return[]}class e6 extends I0{constructor(_,$,X,Z){super();this.table=_,this.session=$,this.dialect=X,this.config={table:_,withList:Z}}static[O]="SQLiteDelete";config;where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new z0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.table[H0.Symbol.Columns]){return this.config.returning=b0(_),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:r0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(_){return this._prepare().execute(_)}$dynamic(){return this}}function WW(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map((X)=>X.toLowerCase()).join("_")}function UW(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((X,Z,J)=>{let G=J===0?Z.toLowerCase():`${Z[0].toUpperCase()}${Z.slice(1)}`;return X+G},"")}function AW(_){return _}class d4{static[O]="CasingCache";cache={};cachedTables={};convert;constructor(_){this.convert=_==="snake_case"?WW:_==="camelCase"?UW:AW}getColumnCasing(_){if(!_.keyAsName)return _.name;let $=_.table[B.Symbol.Schema]??"public",X=_.table[B.Symbol.OriginalName],Z=`${$}.${X}.${_.name}`;if(!this.cache[Z])this.cacheTable(_.table);return this.cache[Z]}cacheTable(_){let $=_[B.Symbol.Schema]??"public",X=_[B.Symbol.OriginalName],Z=`${$}.${X}`;if(!this.cachedTables[Z]){for(let J of Object.values(_[B.Symbol.Columns])){let G=`${Z}.${J.name}`;this.cache[G]=this.convert(J.name)}this.cachedTables[Z]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class z2 extends f0{static[O]="SQLiteViewBase"}class n2{static[O]="SQLiteDialect";casing;constructor(_){this.casing=new d4(_?.casing)}escapeName(_){return`"${_}"`}escapeParam(_){return"?"}escapeString(_){return`'${_.replace(/'/g,"''")}'`}buildWithCTE(_){if(!_?.length)return;let $=[U`with `];for(let[X,Z]of _.entries())if($.push(U`${U.identifier(Z._.alias)} as (${Z._.sql})`),X<_.length-1)$.push(U`, `);return $.push(U` `),U.join($)}buildDeleteQuery({table:_,where:$,returning:X,withList:Z,limit:J,orderBy:G}){let Y=this.buildWithCTE(Z),z=X?U` returning ${this.buildSelection(X,{isSingleTable:!0})}`:void 0,H=$?U` where ${$}`:void 0,F=this.buildOrderBy(G),W=this.buildLimit(J);return U`${Y}delete from ${_}${H}${z}${F}${W}`}buildUpdateSet(_,$){let X=_[B.Symbol.Columns],Z=Object.keys(X).filter((G)=>$[G]!==void 0||X[G]?.onUpdateFn!==void 0),J=Z.length;return U.join(Z.flatMap((G,Y)=>{let z=X[G],H=$[G]??U.param(z.onUpdateFn(),z),F=U`${U.identifier(this.casing.getColumnCasing(z))} = ${H}`;if(Y<J-1)return[F,U.raw(", ")];return[F]}))}buildUpdateQuery({table:_,set:$,where:X,returning:Z,withList:J,joins:G,from:Y,limit:z,orderBy:H}){let F=this.buildWithCTE(J),W=this.buildUpdateSet(_,$),A=Y&&U.join([U.raw(" from "),this.buildFromTable(Y)]),K=this.buildJoins(G),D=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,R=X?U` where ${X}`:void 0,N=this.buildOrderBy(H),I=this.buildLimit(z);return U`${F}update ${_} set ${W}${A}${K}${R}${D}${N}${I}`}buildSelection(_,{isSingleTable:$=!1}={}){let X=_.length,Z=_.flatMap(({field:J},G)=>{let Y=[];if(V(J,Q.Aliased)&&J.isSelectionField)Y.push(U.identifier(J.fieldAlias));else if(V(J,Q.Aliased)||V(J,Q)){let z=V(J,Q.Aliased)?J.sql:J;if($)Y.push(new Q(z.queryChunks.map((H)=>{if(V(H,u))return U.identifier(this.casing.getColumnCasing(H));return H})));else Y.push(z);if(V(J,Q.Aliased))Y.push(U` as ${U.identifier(J.fieldAlias)}`)}else if(V(J,u)){let z=J.table[B.Symbol.Name];if(J.columnType==="SQLiteNumericBigInt")if($)Y.push(U`cast(${U.identifier(this.casing.getColumnCasing(J))} as text)`);else Y.push(U`cast(${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))} as text)`);else if($)Y.push(U.identifier(this.casing.getColumnCasing(J)));else Y.push(U`${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))}`)}if(G<X-1)Y.push(U`, `);return Y});return U.join(Z)}buildJoins(_){if(!_||_.length===0)return;let $=[];if(_)for(let[X,Z]of _.entries()){if(X===0)$.push(U` `);let J=Z.table,G=Z.on?U` on ${Z.on}`:void 0;if(V(J,H0)){let Y=J[H0.Symbol.Name],z=J[H0.Symbol.Schema],H=J[H0.Symbol.OriginalName],F=Y===H?void 0:Z.alias;$.push(U`${U.raw(Z.joinType)} join ${z?U`${U.identifier(z)}.`:void 0}${U.identifier(H)}${F&&U` ${U.identifier(F)}`}${G}`)}else $.push(U`${U.raw(Z.joinType)} join ${J}${G}`);if(X<_.length-1)$.push(U` `)}return U.join($)}buildLimit(_){return typeof _==="object"||typeof _==="number"&&_>=0?U` limit ${_}`:void 0}buildOrderBy(_){let $=[];if(_){for(let[X,Z]of _.entries())if($.push(Z),X<_.length-1)$.push(U`, `)}return $.length>0?U` order by ${U.join($)}`:void 0}buildFromTable(_){if(V(_,B)&&_[B.Symbol.IsAlias])return U`${U`${U.identifier(_[B.Symbol.Schema]??"")}.`.if(_[B.Symbol.Schema])}${U.identifier(_[B.Symbol.OriginalName])} ${U.identifier(_[B.Symbol.Name])}`;return _}buildSelectQuery({withList:_,fields:$,fieldsFlat:X,where:Z,having:J,table:G,joins:Y,orderBy:z,groupBy:H,limit:F,offset:W,distinct:A,setOperators:K}){let D=X??b0($);for(let c0 of D)if(V(c0.field,u)&&L1(c0.field.table)!==(V(G,J0)?G._.alias:V(G,z2)?G[a].name:V(G,Q)?void 0:L1(G))&&!((e0)=>Y?.some(({alias:$6})=>$6===(e0[B.Symbol.IsAlias]?L1(e0):e0[B.Symbol.BaseName])))(c0.field.table)){let e0=L1(c0.field.table);throw Error(`Your "${c0.path.join("->")}" field references a column "${e0}"."${c0.field.name}", but the table "${e0}" is not part of the query! Did you forget to join it?`)}let R=!Y||Y.length===0,N=this.buildWithCTE(_),I=A?U` distinct`:void 0,P=this.buildSelection(D,{isSingleTable:R}),E=this.buildFromTable(G),j=this.buildJoins(Y),b=Z?U` where ${Z}`:void 0,f=J?U` having ${J}`:void 0,T=[];if(H){for(let[c0,e0]of H.entries())if(T.push(e0),c0<H.length-1)T.push(U`, `)}let g=T.length>0?U` group by ${U.join(T)}`:void 0,w0=this.buildOrderBy(z),T1=this.buildLimit(F),__=W?U` offset ${W}`:void 0,A2=U`${N}select${I} ${P} from ${E}${j}${b}${g}${f}${w0}${T1}${__}`;if(K.length>0)return this.buildSetOperations(A2,K);return A2}buildSetOperations(_,$){let[X,...Z]=$;if(!X)throw Error("Cannot pass undefined values to any set operator");if(Z.length===0)return this.buildSetOperationQuery({leftSelect:_,setOperator:X});return this.buildSetOperations(this.buildSetOperationQuery({leftSelect:_,setOperator:X}),Z)}buildSetOperationQuery({leftSelect:_,setOperator:{type:$,isAll:X,rightSelect:Z,limit:J,orderBy:G,offset:Y}}){let z=U`${_.getSQL()} `,H=U`${Z.getSQL()}`,F;if(G&&G.length>0){let D=[];for(let R of G)if(V(R,$0))D.push(U.identifier(R.name));else if(V(R,Q)){for(let N=0;N<R.queryChunks.length;N++){let I=R.queryChunks[N];if(V(I,$0))R.queryChunks[N]=U.identifier(this.casing.getColumnCasing(I))}D.push(U`${R}`)}else D.push(U`${R}`);F=U` order by ${U.join(D,U`, `)}`}let W=typeof J==="object"||typeof J==="number"&&J>=0?U` limit ${J}`:void 0,A=U.raw(`${$} ${X?"all ":""}`),K=Y?U` offset ${Y}`:void 0;return U`${z}${A}${H}${F}${W}${K}`}buildInsertQuery({table:_,values:$,onConflict:X,returning:Z,withList:J,select:G}){let Y=[],z=_[B.Symbol.Columns],H=Object.entries(z).filter(([R,N])=>!N.shouldDisableInsert()),F=H.map(([,R])=>U.identifier(this.casing.getColumnCasing(R)));if(G){let R=$;if(V(R,Q))Y.push(R);else Y.push(R.getSQL())}else{let R=$;Y.push(U.raw("values "));for(let[N,I]of R.entries()){let P=[];for(let[E,j]of H){let b=I[E];if(b===void 0||V(b,x0)&&b.value===void 0){let f;if(j.default!==null&&j.default!==void 0)f=V(j.default,Q)?j.default:U.param(j.default,j);else if(j.defaultFn!==void 0){let T=j.defaultFn();f=V(T,Q)?T:U.param(T,j)}else if(!j.default&&j.onUpdateFn!==void 0){let T=j.onUpdateFn();f=V(T,Q)?T:U.param(T,j)}else f=U`null`;P.push(f)}else P.push(b)}if(Y.push(P),N<R.length-1)Y.push(U`, `)}}let W=this.buildWithCTE(J),A=U.join(Y),K=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,D=X?.length?U.join(X):void 0;return U`${W}insert into ${_} ${F} ${A}${D}${K}`}sqlToQuery(_,$){return _.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:$})}buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:Z,tableConfig:J,queryConfig:G,tableAlias:Y,nestedQueryRelation:z,joinOn:H}){let F=[],W,A,K=[],D,R=[];if(G===!0)F=Object.entries(J.columns).map(([P,E])=>({dbKey:E.name,tsKey:P,field:$1(E,Y),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let I=Object.fromEntries(Object.entries(J.columns).map(([T,g])=>[T,$1(g,Y)]));if(G.where){let T=typeof G.where==="function"?G.where(I,N7()):G.where;D=T&&K_(T,Y)}let P=[],E=[];if(G.columns){let T=!1;for(let[g,w0]of Object.entries(G.columns)){if(w0===void 0)continue;if(g in J.columns){if(!T&&w0===!0)T=!0;E.push(g)}}if(E.length>0)E=T?E.filter((g)=>G.columns?.[g]===!0):Object.keys(J.columns).filter((g)=>!E.includes(g))}else E=Object.keys(J.columns);for(let T of E){let g=J.columns[T];P.push({tsKey:T,value:g})}let j=[];if(G.with)j=Object.entries(G.with).filter((T)=>!!T[1]).map(([T,g])=>({tsKey:T,queryConfig:g,relation:J.relations[T]}));let b;if(G.extras){b=typeof G.extras==="function"?G.extras(I,{sql:U}):G.extras;for(let[T,g]of Object.entries(b))P.push({tsKey:T,value:s8(g,Y)})}for(let{tsKey:T,value:g}of P)F.push({dbKey:V(g,Q.Aliased)?g.fieldAlias:J.columns[T].name,tsKey:T,field:V(g,u)?$1(g,Y):g,relationTableTsKey:void 0,isJson:!1,selection:[]});let f=typeof G.orderBy==="function"?G.orderBy(I,M7()):G.orderBy??[];if(!Array.isArray(f))f=[f];K=f.map((T)=>{if(V(T,u))return $1(T,Y);return K_(T,Y)}),W=G.limit,A=G.offset;for(let{tsKey:T,queryConfig:g,relation:w0}of j){let T1=I7($,X,w0),__=n1(w0.referencedTable),A2=X[__],c0=`${Y}_${T}`,e0=O0(...T1.fields.map(($J,XJ)=>w($1(T1.references[XJ],c0),$1($J,Y)))),$6=this.buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:_[A2],tableConfig:$[A2],queryConfig:V(w0,P1)?g===!0?{limit:1}:{...g,limit:1}:g,tableAlias:c0,joinOn:e0,nestedQueryRelation:w0}),_J=U`(${$6.sql})`.as(T);F.push({dbKey:T,tsKey:T,field:_J,relationTableTsKey:A2,isJson:!0,selection:$6.selection})}}if(F.length===0)throw new M2({message:`No fields selected for table "${J.tsName}" ("${Y}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let N;if(D=O0(H,D),z){let I=U`json_array(${U.join(F.map(({field:j})=>V(j,$0)?U.identifier(this.casing.getColumnCasing(j)):V(j,Q.Aliased)?j.sql:j),U`, `)})`;if(V(z,V_))I=U`coalesce(json_group_array(${I}), json_array())`;let P=[{dbKey:"data",tsKey:"data",field:I.as("data"),isJson:!0,relationTableTsKey:J.tsName,selection:F}];if(W!==void 0||A!==void 0||K.length>0)N=this.buildSelectQuery({table:N6(Z,Y),fields:{},fieldsFlat:[{path:[],field:U.raw("*")}],where:D,limit:W,offset:A,orderBy:K,setOperators:[]}),D=void 0,W=void 0,A=void 0,K=void 0;else N=N6(Z,Y);N=this.buildSelectQuery({table:V(N,H0)?N:new J0(N,{},Y),fields:{},fieldsFlat:P.map(({field:j})=>({path:[],field:V(j,u)?$1(j,Y):j})),joins:R,where:D,limit:W,offset:A,orderBy:K,setOperators:[]})}else N=this.buildSelectQuery({table:N6(Z,Y),fields:{},fieldsFlat:F.map(({field:I})=>({path:[],field:V(I,u)?$1(I,Y):I})),joins:R,where:D,limit:W,offset:A,orderBy:K,setOperators:[]});return{tableTsKey:J.tsName,sql:N,selection:F}}}class c4 extends n2{static[O]="SQLiteSyncDialect";migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;$.run(J);let Y=$.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;$.run(U`BEGIN`);try{for(let z of _)if(!Y||Number(Y[2])<z.folderMillis){for(let H of z.sql)$.run(U.raw(H));$.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${z.hash}, ${z.folderMillis})`)}$.run(U`COMMIT`)}catch(z){throw $.run(U`ROLLBACK`),z}}}class l4 extends n2{static[O]="SQLiteAsyncDialect";async migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await $.run(J);let Y=(await $.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await $.transaction(async(z)=>{for(let H of _)if(!Y||Number(Y[2])<H.folderMillis){for(let F of H.sql)await z.run(U.raw(F));await z.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${H.hash}, ${H.folderMillis})`)}})}}class i4{static[O]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class a0{static[O]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(_){this.fields=_.fields,this.session=_.session,this.dialect=_.dialect,this.withList=_.withList,this.distinct=_.distinct}from(_){let $=!!this.fields,X;if(this.fields)X=this.fields;else if(V(_,J0))X=Object.fromEntries(Object.keys(_._.selectedFields).map((Z)=>[Z,_[Z]]));else if(V(_,z2))X=_[a].selectedFields;else if(V(_,Q))X={};else X=o3(_);return new n4({table:_,fields:X,isPartialSelect:$,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class YZ extends i4{static[O]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:_,fields:$,isPartialSelect:X,session:Z,dialect:J,withList:G,distinct:Y}){super();this.config={withList:G,table:_,fields:{...$},distinct:Y,setOperators:[]},this.isPartialSelect=X,this.session=Z,this.dialect=J,this._={selectedFields:$,config:this.config},this.tableName=D_(_),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{};for(let z of r0(_))this.usedTables.add(z)}getUsedTables(){return[...this.usedTables]}createJoin(_){return($,X)=>{let Z=this.tableName,J=D_($);for(let G of r0($))this.usedTables.add(G);if(typeof J==="string"&&this.config.joins?.some((G)=>G.alias===J))throw Error(`Alias "${J}" is already used in this query`);if(!this.isPartialSelect){if(Object.keys(this.joinsNotNullableMap).length===1&&typeof Z==="string")this.config.fields={[Z]:this.config.fields};if(typeof J==="string"&&!V($,Q)){let G=V($,J0)?$._.selectedFields:V($,f0)?$[a].selectedFields:$[B.Symbol.Columns];this.config.fields[J]=G}}if(typeof X==="function")X=X(new Proxy(this.config.fields,new z0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));if(!this.config.joins)this.config.joins=[];if(this.config.joins.push({on:X,table:$,joinType:_,alias:J}),typeof J==="string")switch(_){case"left":{this.joinsNotNullableMap[J]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[J]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(_,$){return(X)=>{let Z=typeof X==="function"?X(KW()):X;if(!O_(this.getSelectedFields(),Z.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:_,isAll:$,rightSelect:Z}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(_){return this.config.setOperators.push(..._),this}where(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new z0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.where=_,this}having(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new z0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.having=_,this}groupBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new z0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray($)?$:[$]}else this.config.groupBy=_;return this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new z0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=X;else this.config.orderBy=X}else{let $=_;if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=$;else this.config.orderBy=$}return this}limit(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).limit=_;else this.config.limit=_;return this}offset(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).offset=_;else this.config.offset=_;return this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}as(_){let $=[];if($.push(...r0(this.config.table)),this.config.joins)for(let X of this.config.joins)$.push(...r0(X.table));return new Proxy(new J0(this.getSQL(),this.config.fields,_,!1,[...new Set($)]),new z0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new z0({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class n4 extends YZ{static[O]="SQLiteSelect";_prepare(_=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let $=b0(this.config.fields),X=this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),$,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return X.joinsNotNullableMap=this.joinsNotNullableMap,X}$withCache(_){return this.cacheConfig=_===void 0?{config:{},enable:!0,autoInvalidate:!0}:_===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,..._},this}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.all()}}n3(n4,[I0]);function _8(_,$){return(X,Z,...J)=>{let G=[Z,...J].map((Y)=>({type:_,isAll:$,rightSelect:Y}));for(let Y of G)if(!O_(X.getSelectedFields(),Y.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return X.addSetOperators(G)}}var KW=()=>({union:OW,unionAll:DW,intersect:RW,except:VW}),OW=_8("union",!1),DW=_8("union",!0),RW=_8("intersect",!1),VW=_8("except",!1);class n_{static[O]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(_){this.dialect=V(_,n2)?_:void 0,this.dialectConfig=V(_,n2)?void 0:_}$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(X);return new Proxy(new F_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new z0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};with(..._){let $=this;function X(J){return new a0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_})}function Z(J){return new a0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_,distinct:!0})}return{select:X,selectDistinct:Z}}select(_){return new a0({fields:_??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(_){return new a0({fields:_??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){if(!this.dialect)this.dialect=new c4(this.dialectConfig);return this.dialect}}class $8{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[O]="SQLiteInsertBuilder";values(_){if(_=Array.isArray(_)?_:[_],_.length===0)throw Error("values() must be called with at least one value");let $=_.map((X)=>{let Z={},J=this.table[B.Symbol.Columns];for(let G of Object.keys(X)){let Y=X[G];Z[G]=V(Y,Q)?Y:new x0(Y,J[G])}return Z});return new o4(this.table,$,this.session,this.dialect,this.withList)}select(_){let $=typeof _==="function"?_(new n_):_;if(!V($,Q)&&!O_(this.table[R6],$._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new o4(this.table,$,this.session,this.dialect,this.withList,!0)}}class o4 extends I0{constructor(_,$,X,Z,J,G){super();this.session=X,this.dialect=Z,this.config={table:_,values:$,withList:J,select:G}}static[O]="SQLiteInsert";config;returning(_=this.config.table[H0.Symbol.Columns]){return this.config.returning=b0(_),this}onConflictDoNothing(_={}){if(!this.config.onConflict)this.config.onConflict=[];if(_.target===void 0)this.config.onConflict.push(U` on conflict do nothing`);else{let $=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,X=_.where?U` where ${_.where}`:U``;this.config.onConflict.push(U` on conflict ${$} do nothing${X}`)}return this}onConflictDoUpdate(_){if(_.where&&(_.targetWhere||_.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');if(!this.config.onConflict)this.config.onConflict=[];let $=_.where?U` where ${_.where}`:void 0,X=_.targetWhere?U` where ${_.targetWhere}`:void 0,Z=_.setWhere?U` where ${_.setWhere}`:void 0,J=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,G=this.dialect.buildUpdateSet(this.config.table,M6(this.config.table,_.set));return this.config.onConflict.push(U` on conflict ${J}${X} do update set ${G}${$}${Z}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:r0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class X8{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[O]="SQLiteUpdateBuilder";set(_){return new zZ(this.table,M6(this.table,_),this.session,this.dialect,this.withList)}}class zZ extends I0{constructor(_,$,X,Z,J){super();this.session=X,this.dialect=Z,this.config={set:$,table:_,withList:J,joins:[]}}static[O]="SQLiteUpdate";config;from(_){return this.config.from=_,this}createJoin(_){return($,X)=>{let Z=D_($);if(typeof Z==="string"&&this.config.joins.some((J)=>J.alias===Z))throw Error(`Alias "${Z}" is already used in this query`);if(typeof X==="function"){let J=this.config.from?V($,H0)?$[B.Symbol.Columns]:V($,J0)?$._.selectedFields:V($,z2)?$[a].selectedFields:void 0:void 0;X=X(new Proxy(this.config.table[B.Symbol.Columns],new z0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),J&&new Proxy(J,new z0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:X,table:$,joinType:_,alias:Z}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new z0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.config.table[H0.Symbol.Columns]){return this.config.returning=b0(_),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:r0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class o_ extends Q{constructor(_){super(o_.buildEmbeddedCount(_.source,_.filters).queryChunks);this.params=_,this.session=_.session,this.sql=o_.buildCount(_.source,_.filters)}sql;static[O]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(_,$){return U`(select count(*) from ${_}${U.raw(" where ").if($)}${$})`}static buildCount(_,$){return U`select count(*) from ${_}${U.raw(" where ").if($)}${$}`}then(_,$){return Promise.resolve(this.session.count(this.sql)).then(_,$)}catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}}class r4{constructor(_,$,X,Z,J,G,Y,z){this.mode=_,this.fullSchema=$,this.schema=X,this.tableNamesMap=Z,this.table=J,this.tableConfig=G,this.dialect=Y,this.session=z}static[O]="SQLiteAsyncRelationalQueryBuilder";findMany(_){return this.mode==="sync"?new s4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many"):new Z8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many")}findFirst(_){return this.mode==="sync"?new s4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first"):new Z8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first")}}class Z8 extends I0{constructor(_,$,X,Z,J,G,Y,z,H){super();this.fullSchema=_,this.schema=$,this.tableNamesMap=X,this.table=Z,this.tableConfig=J,this.dialect=G,this.session=Y,this.config=z,this.mode=H}static[O]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(_=!1){let{query:$,builtQuery:X}=this._toSQL();return this.session[_?"prepareOneTimeQuery":"prepareQuery"](X,void 0,this.mode==="first"?"get":"all",!0,(Z,J)=>{let G=Z.map((Y)=>B6(this.schema,this.tableConfig,Y,$.selection,J));if(this.mode==="first")return G[0];return G})}prepare(){return this._prepare(!1)}_toSQL(){let _=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),$=this.dialect.sqlToQuery(_.sql);return{query:_,builtQuery:$}}toSQL(){return this._toSQL().builtQuery}executeRaw(){if(this.mode==="first")return this._prepare(!1).get();return this._prepare(!1).all()}async execute(){return this.executeRaw()}}class s4 extends Z8{static[O]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class o2 extends I0{constructor(_,$,X,Z,J){super();this.execute=_,this.getSQL=$,this.dialect=Z,this.mapBatchResult=J,this.config={action:X}}static[O]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(_,$){return $?this.mapBatchResult(_):_}_prepare(){return this}isResponseInArrayMode(){return!1}}class s_{constructor(_,$,X,Z){this.resultKind=_,this.dialect=$,this.session=X,this._=Z?{schema:Z.schema,fullSchema:Z.fullSchema,tableNamesMap:Z.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let J=this.query;if(this._.schema)for(let[G,Y]of Object.entries(this._.schema))J[G]=new r4(_,Z.fullSchema,this._.schema,this._.tableNamesMap,Z.fullSchema[G],Y,$,X);this.$cache={invalidate:async(G)=>{}}}static[O]="BaseSQLiteDatabase";query;$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(new n_(X.dialect));return new Proxy(new F_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new z0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};$count(_,$){return new o_({source:_,filters:$,session:this.session})}with(..._){let $=this;function X(z){return new a0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_})}function Z(z){return new a0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_,distinct:!0})}function J(z){return new X8(z,$.session,$.dialect,_)}function G(z){return new $8(z,$.session,$.dialect,_)}function Y(z){return new e6(z,$.session,$.dialect,_)}return{select:X,selectDistinct:Z,update:J,insert:G,delete:Y}}select(_){return new a0({fields:_??void 0,session:this.session,dialect:this.dialect})}selectDistinct(_){return new a0({fields:_??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(_){return new X8(_,this.session,this.dialect)}$cache;insert(_){return new $8(_,this.session,this.dialect)}delete(_){return new e6(_,this.session,this.dialect)}run(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.run($),()=>$,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session));return this.session.run($)}all(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.all($),()=>$,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session));return this.session.all($)}get(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.get($),()=>$,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session));return this.session.get($)}values(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.values($),()=>$,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session));return this.session.values($)}transaction(_,$){return this.session.transaction(_,$)}}class HZ{static[O]="Cache"}class r_ extends HZ{strategy(){return"all"}static[O]="NoopCache";async get(_){return}async put(_,$,X,Z){}async onMutate(_){}}async function a4(_,$){let X=`${_}-${JSON.stringify($)}`,J=new TextEncoder().encode(X),G=await crypto.subtle.digest("SHA-256",J);return[...new Uint8Array(G)].map((H)=>H.toString(16).padStart(2,"0")).join("")}class FZ extends I0{constructor(_){super();this.resultCb=_}static[O]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class t4{constructor(_,$,X,Z,J,G){if(this.mode=_,this.executeMethod=$,this.query=X,this.cache=Z,this.queryMetadata=J,this.cacheConfig=G,Z&&Z.strategy()==="all"&&G===void 0)this.cacheConfig={enable:!0,autoInvalidate:!0};if(!this.cacheConfig?.enable)this.cacheConfig=void 0}static[O]="PreparedQuery";joinsNotNullableMap;async queryWithCache(_,$,X){if(this.cache===void 0||V(this.cache,r_)||this.queryMetadata===void 0)try{return await X()}catch(Z){throw new D1(_,$,Z)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await X()}catch(Z){throw new D1(_,$,Z)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[Z]=await Promise.all([X(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return Z}catch(Z){throw new D1(_,$,Z)}if(!this.cacheConfig)try{return await X()}catch(Z){throw new D1(_,$,Z)}if(this.queryMetadata.type==="select"){let Z=await this.cache.get(this.cacheConfig.tag??await a4(_,$),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(Z===void 0){let J;try{J=await X()}catch(G){throw new D1(_,$,G)}return await this.cache.put(this.cacheConfig.tag??await a4(_,$),J,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),J}return Z}try{return await X()}catch(Z){throw new D1(_,$,Z)}}getQuery(){return this.query}mapRunResult(_,$){return _}mapAllResult(_,$){throw Error("Not implemented")}mapGetResult(_,$){throw Error("Not implemented")}execute(_){if(this.mode==="async")return this[this.executeMethod](_);return new FZ(()=>this[this.executeMethod](_))}mapResult(_,$){switch(this.executeMethod){case"run":return this.mapRunResult(_,$);case"all":return this.mapAllResult(_,$);case"get":return this.mapGetResult(_,$)}}}class e4{constructor(_){this.dialect=_}static[O]="SQLiteSession";prepareOneTimeQuery(_,$,X,Z,J,G,Y){return this.prepareQuery(_,$,X,Z,J,G,Y)}run(_){let $=this.dialect.sqlToQuery(_);try{return this.prepareOneTimeQuery($,void 0,"run",!1).run()}catch(X){throw new M2({cause:X,message:`Failed to run the query '${$.sql}'`})}}extractRawRunValueFromBatchResult(_){return _}all(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(_){throw Error("Not implemented")}get(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(_){throw Error("Not implemented")}values(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).values()}async count(_){return(await this.values(_))[0][0]}extractRawValuesValueFromBatchResult(_){throw Error("Not implemented")}}class _5 extends s_{constructor(_,$,X,Z,J=0){super(_,$,X,Z);this.schema=Z,this.nestedIndex=J}static[O]="SQLiteTransaction";rollback(){throw new r8}}class G8 extends e4{constructor(_,$,X,Z,J){super($);this.client=_,this.schema=X,this.options=Z,this.tx=J,this.logger=Z.logger??new t8,this.cache=Z.cache??new r_}static[O]="LibSQLSession";logger;cache;prepareQuery(_,$,X,Z,J,G,Y){return new UZ(this.client,_,this.logger,this.cache,G,Y,$,this.tx,X,Z,J)}async batch(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.batch(X)).map((J,G)=>$[G].mapResult(J,!0))}async migrate(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.migrate(X)).map((J,G)=>$[G].mapResult(J,!0))}async transaction(_,$){let X=await this.client.transaction(),Z=new G8(this.client,this.dialect,this.schema,this.options,X),J=new $5("async",this.dialect,Z,this.schema);try{let G=await _(J);return await X.commit(),G}catch(G){throw await X.rollback(),G}}extractRawAllValueFromBatchResult(_){return _.rows}extractRawGetValueFromBatchResult(_){return _.rows[0]}extractRawValuesValueFromBatchResult(_){return _.rows}}class $5 extends _5{static[O]="LibSQLTransaction";async transaction(_){let $=`sp${this.nestedIndex}`,X=new $5("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(U.raw(`savepoint ${$}`));try{let Z=await _(X);return await this.session.run(U.raw(`release savepoint ${$}`)),Z}catch(Z){throw await this.session.run(U.raw(`rollback to savepoint ${$}`)),Z}}}class UZ extends t4{constructor(_,$,X,Z,J,G,Y,z,H,F,W){super("async",H,$,Z,J,G);this.client=_,this.logger=X,this.fields=Y,this.tx=z,this._isResponseInArrayMode=F,this.customResultMapper=W,this.customResultMapper=W,this.fields=Y}static[O]="LibSQLPreparedQuery";async run(_){let $=U_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return this.tx?this.tx.execute(X):this.client.execute(X)})}async all(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let H=U_(Z.params,_??{});return X.logQuery(Z.sql,H),await this.queryWithCache(Z.sql,H,async()=>{let F={sql:Z.sql,args:H};return(J?J.execute(F):G.execute(F)).then(({rows:W})=>this.mapAllResult(W))})}let z=await this.values(_);return this.mapAllResult(z)}mapAllResult(_,$){if($)_=_.rows;if(!this.fields&&!this.customResultMapper)return _.map((X)=>WZ(X));if(this.customResultMapper)return this.customResultMapper(_,J8);return _.map((X)=>{return e8(this.fields,Array.prototype.slice.call(X).map((Z)=>J8(Z)),this.joinsNotNullableMap)})}async get(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let H=U_(Z.params,_??{});return X.logQuery(Z.sql,H),await this.queryWithCache(Z.sql,H,async()=>{let F={sql:Z.sql,args:H};return(J?J.execute(F):G.execute(F)).then(({rows:W})=>this.mapGetResult(W))})}let z=await this.values(_);return this.mapGetResult(z)}mapGetResult(_,$){if($)_=_.rows;let X=_[0];if(!this.fields&&!this.customResultMapper)return WZ(X);if(!X)return;if(this.customResultMapper)return this.customResultMapper(_,J8);return e8(this.fields,Array.prototype.slice.call(X).map((Z)=>J8(Z)),this.joinsNotNullableMap)}async values(_){let $=U_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return(this.tx?this.tx.execute(X):this.client.execute(X)).then(({rows:Z})=>Z)})}isResponseInArrayMode(){return this._isResponseInArrayMode}}function WZ(_){return Object.keys(_).reduce(($,X)=>{if(Object.prototype.propertyIsEnumerable.call(_,X))$[X]=_[X];return $},{})}function J8(_){if(typeof ArrayBuffer<"u"&&_ instanceof ArrayBuffer){if(typeof Buffer<"u"){if(!(_ instanceof Buffer))return Buffer.from(_);return _}if(typeof TextDecoder<"u")return new TextDecoder().decode(_);throw Error("TextDecoder is not available. Please provide either Buffer or TextDecoder polyfill.")}return _}class AZ extends s_{static[O]="LibSQLDatabase";async batch(_){return this.session.batch(_)}}function s2(_,$={}){let X=new l4({casing:$.casing}),Z;if($.logger===!0)Z=new a8;else if($.logger!==!1)Z=$.logger;let J;if($.schema){let z=B7($.schema,Q7);J={fullSchema:$.schema,schema:z.tables,tableNamesMap:z.tableNamesMap}}let G=new G8(_,X,J,{logger:Z,cache:$.cache},void 0),Y=new AZ("async",X,G,J);if(Y.$client=_,Y.$cache=$.cache,Y.$cache)Y.$cache.invalidate=$.cache?.onMutate;return Y}function r2(..._){if(typeof _[0]==="string"){let $=m1({url:_[0]});return s2($,_[1])}if(s3(_[0])){let{connection:$,client:X,...Z}=_[0];if(X)return s2(X,Z);let J=typeof $==="string"?m1({url:$}):m1($);return s2(J,Z)}return s2(_[0],_[1])}((_)=>{function $(X){return s2({},X)}_.mock=$})(r2||(r2={}));class t_{client;db;dbName;constructor(_,$){this.dbName=_;try{let X=a_.join(process.cwd(),".sylphx-flow");if(!Y8.existsSync(X))Y8.mkdirSync(X,{recursive:!0});let Z=a_.join(X,`${_}.db`);this.client=m1({url:`file:${Z}`}),this.db=r2(this.client,{schema:$})}catch(X){throw new N_(`Failed to initialize ${_} database connection`,{url:`file:${a_.join(process.cwd(),".sylphx-flow",`${_}.db`)}`},X)}}async close(){}getDatabasePath(){return a_.join(process.cwd(),".sylphx-flow",`${this.dbName}.db`)}async createTable(_){try{await this.client.execute(_)}catch($){throw new G0(`Failed to create table for ${this.dbName}`,`${this.dbName}.createTable`,$)}}async createIndex(_){try{await this.client.execute(_)}catch($){throw new G0(`Failed to create index for ${this.dbName}`,`${this.dbName}.createIndex`,$)}}async tableExists(_){try{return(await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name='${_}'
      `)).rows.length>0}catch($){throw new G0(`Failed to check if table ${_} exists`,`${this.dbName}.tableExists`,$)}}}var X5={};F6(X5,{tfidfTerms:()=>d0,tfidfIdf:()=>U1,tfidfDocuments:()=>W1,codebaseMetadata:()=>k0,codebaseFiles:()=>V0});var V0=Q0("codebase_files_table",{path:S("path").primaryKey(),mtime:S0("mtime").notNull(),hash:S("hash").notNull(),content:S("content"),language:S("language"),size:S0("size"),indexedAt:S("indexed_at").notNull()},(_)=>[R0("idx_codebase_files_mtime").on(_.mtime),R0("idx_codebase_files_hash").on(_.hash)]),k0=Q0("codebase_metadata_table",{key:S("key").primaryKey(),value:S("value").notNull()}),d0=Q0("tfidf_terms_table",{filePath:S("file_path").notNull().references(()=>V0.path,{onDelete:"cascade"}),term:S("term").notNull(),frequency:F1("frequency").notNull()},(_)=>[i2({columns:[_.filePath,_.term]}),R0("idx_tfidf_terms_term").on(_.term),R0("idx_tfidf_terms_file").on(_.filePath)]),W1=Q0("tfidf_documents_table",{filePath:S("file_path").primaryKey().references(()=>V0.path,{onDelete:"cascade"}),magnitude:F1("magnitude").notNull(),termCount:S0("term_count").notNull(),rawTerms:S("raw_terms").notNull()}),U1=Q0("tfidf_idf_table",{term:S("term").primaryKey(),idfValue:F1("idf_value").notNull()});class J5 extends t_{constructor(){super("cache",X5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Cache database tables already exist");return}await this.createTables(),console.error("[INFO] Cache database tables created")}catch(_){throw new G0("Failed to initialize cache database","cache.initialize",_)}}async createTables(){await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_files_table (
        path TEXT PRIMARY KEY,
        mtime INTEGER NOT NULL,
        hash TEXT NOT NULL,
        content TEXT,
        language TEXT,
        size INTEGER,
        indexed_at TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_metadata_table (
        key TEXT PRIMARY KEY,
        value TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_documents_table (
        file_path TEXT PRIMARY KEY,
        magnitude REAL NOT NULL,
        term_count INTEGER NOT NULL,
        raw_terms TEXT NOT NULL,
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_idf_table (
        term TEXT PRIMARY KEY,
        idf_value REAL NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_terms_table (
        file_path TEXT NOT NULL,
        term TEXT NOT NULL,
        frequency REAL NOT NULL,
        PRIMARY KEY (file_path, term),
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_mtime ON codebase_files_table (mtime)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_hash ON codebase_files_table (hash)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_term ON tfidf_terms_table (term)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_file ON tfidf_terms_table (file_path)
    `)}async getMigrationStatus(){try{let _=["codebase_files_table","tfidf_terms_table","tfidf_documents_table"],$=0;for(let X of _)if(await this.tableExists(X))$++;return{isMigrated:$>=2,migrationCount:$}}catch(_){throw new G0("Failed to check cache database migration status","cache.getMigrationStatus",_)}}async clearCache(){try{await this.client.execute("DELETE FROM tfidf_terms_table"),await this.client.execute("DELETE FROM tfidf_documents_table"),await this.client.execute("DELETE FROM tfidf_idf_table"),await this.client.execute("DELETE FROM codebase_files_table"),await this.client.execute("DELETE FROM codebase_metadata_table"),console.error("[INFO] Cache database cleared")}catch(_){throw new G0("Failed to clear cache database","cache.clearCache",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM codebase_files_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,cachedFiles:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=Z5.join(process.cwd(),".sylphx-flow");return Z5.join(_,"cache.db")}}class G5{cacheDb;cache;constructor(){this.cacheDb=new J5,this.cache=this.cacheDb.db}async initialize(){await this.cacheDb.initialize()}async setCodebaseFile(_){return n(`set codebase file: ${_.path}`,async()=>{await this.cache.insert(V0).values(_).onConflictDoUpdate({target:V0.path,set:{mtime:_.mtime,hash:_.hash,content:_.content,language:_.language,size:_.size,indexedAt:_.indexedAt}})})}async getCodebaseFile(_){return n(`get codebase file: ${_}`,async()=>{let $=await this.cache.select().from(V0).where(w(V0.path,_)).limit(1);if($.length===0)return null;let X=$[0];return{path:X.path,mtime:X.mtime,hash:X.hash,content:X.content||void 0,language:X.language||void 0,size:X.size||void 0,indexedAt:X.indexedAt}})}async getAllCodebaseFiles(){return n("get all codebase files",async()=>{return(await this.cache.select().from(V0).orderBy(g0(V0.mtime))).map(($)=>({path:$.path,mtime:$.mtime,hash:$.hash,content:$.content||void 0,language:$.language||void 0,size:$.size||void 0,indexedAt:$.indexedAt}))})}async deleteCodebaseFile(_){return n(`delete codebase file: ${_}`,async()=>{let $=await this.cache.delete(V0).where(w(V0.path,_));return(await this.cache.select().from(V0).where(w(V0.path,_)).limit(1)).length===0})}async clearCodebaseFiles(){return n("clear codebase files",async()=>{await this.cache.delete(V0)})}async setMetadata(_,$){return n(`set metadata: ${_}`,async()=>{await this.cache.insert(k0).values({key:_,value:$}).onConflictDoUpdate({target:k0.key,set:{value:$}})})}async getMetadata(_){return n(`get metadata: ${_}`,async()=>{let $=await this.cache.select().from(k0).where(w(k0.key,_)).limit(1);return $.length>0?$[0].value:null})}async getAllMetadata(){return n("get all metadata",async()=>{let _=await this.cache.select().from(k0),$={};for(let X of _)$[X.key]=X.value;return $})}async deleteMetadata(_){return n(`delete metadata: ${_}`,async()=>{let $=await this.cache.delete(k0).where(w(k0.key,_));return(await this.cache.select().from(k0).where(w(k0.key,_)).limit(1)).length===0})}async setTfidfTerms(_){return n("set TF-IDF terms",async()=>{let $=[...new Set(_.map((X)=>X.filePath))];for(let X of $)await this.cache.delete(d0).where(w(d0.filePath,X));if(_.length>0)await this.cache.insert(d0).values(_)})}async getTfidfTerms(_){return n(`get TF-IDF terms for file: ${_}`,async()=>{return(await this.cache.select().from(d0).where(w(d0.filePath,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async getTfidfTermsByTerm(_){return n(`get TF-IDF terms by term: ${_}`,async()=>{return(await this.cache.select().from(d0).where(w(d0.term,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async clearTfidfTerms(){return n("clear TF-IDF terms",async()=>{await this.cache.delete(d0)})}async setTfidfDocument(_){return n(`set TF-IDF document: ${_.filePath}`,async()=>{await this.cache.insert(W1).values(_).onConflictDoUpdate({target:W1.filePath,set:{magnitude:_.magnitude,termCount:_.termCount,rawTerms:_.rawTerms}})})}async getTfidfDocument(_){return n(`get TF-IDF document: ${_}`,async()=>{let $=await this.cache.select().from(W1).where(w(W1.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{filePath:X.filePath,magnitude:X.magnitude,termCount:X.termCount,rawTerms:X.rawTerms}})}async getAllTfidfDocuments(){return n("get all TF-IDF documents",async()=>{return(await this.cache.select().from(W1)).map(($)=>({filePath:$.filePath,magnitude:$.magnitude,termCount:$.termCount,rawTerms:$.rawTerms}))})}async clearTfidfDocuments(){return n("clear TF-IDF documents",async()=>{await this.cache.delete(W1)})}async setTfidfIdf(_){return n(`set TF-IDF IDF: ${_.term}`,async()=>{await this.cache.insert(U1).values(_).onConflictDoUpdate({target:U1.term,set:{idfValue:_.idfValue}})})}async getTfidfIdf(_){return n(`get TF-IDF IDF: ${_}`,async()=>{let $=await this.cache.select().from(U1).where(w(U1.term,_)).limit(1);if($.length===0)return null;let X=$[0];return{term:X.term,idfValue:X.idfValue}})}async getAllTfidfIdf(){return n("get all TF-IDF IDF values",async()=>{return(await this.cache.select().from(U1)).map(($)=>({term:$.term,idfValue:$.idfValue}))})}async clearTfidfIdf(){return n("clear TF-IDF IDF values",async()=>{await this.cache.delete(U1)})}async getStats(){return n("get cache statistics",async()=>{let[_,$,X,Z,J]=await Promise.all([this.cache.select({count:i0()}).from(V0),this.cache.select({count:i0()}).from(k0),this.cache.select({count:i0()}).from(d0),this.cache.select({count:i0()}).from(W1),this.cache.select({count:i0()}).from(U1)]);return{codebaseFiles:_[0]?.count||0,metadataEntries:$[0]?.count||0,tfidfTerms:X[0]?.count||0,tfidfDocuments:Z[0]?.count||0,tfidfIdfValues:J[0]?.count||0}})}async clearAll(){return n("clear all cache data",async()=>{await Promise.all([this.cache.delete(V0),this.cache.delete(k0),this.cache.delete(d0),this.cache.delete(W1),this.cache.delete(U1)])})}}import*as z8 from"node:path";var Y5={};F6(Y5,{memory:()=>h});var h=Q0("memory_table",{key:S("key").notNull(),namespace:S("namespace").notNull().default("default"),value:S("value").notNull(),timestamp:S0("timestamp").notNull(),created_at:S("created_at").notNull(),updated_at:S("updated_at").notNull()},(_)=>[i2({columns:[_.key,_.namespace]}),R0("idx_memory_namespace").on(_.namespace),R0("idx_memory_timestamp").on(_.timestamp),R0("idx_memory_key").on(_.key)]);class z5 extends t_{constructor(){super("memory",Y5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Memory database tables already exist");return}let $=z8.join(process.cwd(),"drizzle","memory");await this.createTables(),console.error("[INFO] Memory database tables created")}catch(_){throw new G0("Failed to initialize memory database","memory.initialize",_)}}async createTables(){await this.createTable(`
        CREATE TABLE IF NOT EXISTS memory_table (
          key TEXT NOT NULL,
          namespace TEXT NOT NULL DEFAULT 'default',
          value TEXT NOT NULL,
          timestamp INTEGER NOT NULL,
          created_at TEXT NOT NULL,
          updated_at TEXT NOT NULL,
          PRIMARY KEY (key, namespace)
        )
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_namespace ON memory_table (namespace)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_timestamp ON memory_table (timestamp)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_key ON memory_table (key)
      `)}async getMigrationStatus(){try{let _=await this.tableExists("memory_table");return{isMigrated:_,migrationCount:_?1:0}}catch(_){throw new G0("Failed to check memory database migration status","memory.getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=z8.join(process.cwd(),".sylphx-flow");return z8.join(_,"memory.db")}}class H5{memoryDb;memory;constructor(){this.memoryDb=new z5,this.memory=this.memoryDb.db}async initialize(){await this.memoryDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch($){throw Error(`Failed to deserialize value: ${$.message}`)}}async set(_,$,X="default"){let Z=`Failed to set memory entry: ${X}:${_}`;try{let J=new Date().toISOString(),G=Date.now(),Y=this.safeSerialize($);if((await this.memory.select().from(h).where(O0(w(h.key,_),w(h.namespace,X))).limit(1)).length>0)await this.memory.update(h).set({value:Y,timestamp:G,updated_at:J}).where(O0(w(h.key,_),w(h.namespace,X)));else await this.memory.insert(h).values({key:_,namespace:X,value:Y,timestamp:G,created_at:J,updated_at:J})}catch(J){throw Error(`${Z}: ${J.message}`)}}async get(_,$="default"){let X=`Failed to get memory entry: ${$}:${_}`;try{let Z=await this.memory.select().from(h).where(O0(w(h.key,_),w(h.namespace,$))).limit(1);if(Z.length===0)return null;let J=Z[0];return{key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}}catch(Z){throw Error(`${X}: ${Z.message}`)}}async getAll(_){try{let X=this.memory.select().from(h);if(_&&_!=="all")X=X.where(w(h.namespace,_));return(await X.orderBy(g0(h.timestamp))).map((J)=>({key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}))}catch(X){throw Error(`Failed to get all memory entries: ${X.message}`)}}async search(_,$){let X=`Failed to search memory entries: ${_}`;try{let Z=this.memory.select().from(h).where(R_(Z1(h.key,`%${_}%`),Z1(h.value,`%${_}%`)));if($&&$!=="all")Z=Z.where(O0(w(h.namespace,$),R_(Z1(h.key,`%${_}%`),Z1(h.value,`%${_}%`))));return(await Z.orderBy(g0(h.timestamp))).map((G)=>({key:G.key,namespace:G.namespace,value:this.safeDeserialize(G.value),timestamp:G.timestamp,created_at:G.created_at,updated_at:G.updated_at}))}catch(Z){throw Error(`${X}: ${Z.message}`)}}async delete(_,$="default"){let X=`Failed to delete memory entry: ${$}:${_}`;try{let Z=await this.memory.delete(h).where(O0(w(h.key,_),w(h.namespace,$)));return(await this.memory.select().from(h).where(O0(w(h.key,_),w(h.namespace,$))).limit(1)).length===0}catch(Z){throw Error(`${X}: ${Z.message}`)}}async clear(_="default"){let $=`Failed to clear memory namespace: ${_}`;try{await this.memory.delete(h).where(w(h.namespace,_))}catch(X){throw Error(`${$}: ${X.message}`)}}async getStats(_){try{let X=this.memory.select({count:i0()}).from(h);if(_&&_!=="all")X=X.where(w(h.namespace,_));let J=(await X)[0]?.count||0,Y=(await this.memory.selectDistinct({namespace:h.namespace}).from(h)).map((z)=>z.namespace);return{totalEntries:J,namespaces:Y}}catch(X){throw Error(`Failed to get memory statistics: ${X.message}`)}}}class v0{memoryStorage;cacheStorage;constructor(){this.memoryStorage=new H5,this.cacheStorage=new G5}async initialize(){await Promise.all([this.memoryStorage.initialize(),this.cacheStorage.initialize()])}async set(_,$,X="default"){return this.memoryStorage.set(_,$,X)}async get(_,$="default"){return this.memoryStorage.get(_,$)}async getAll(_){return this.memoryStorage.getAll(_)}async search(_,$){return this.memoryStorage.search(_,$)}async delete(_,$="default"){return this.memoryStorage.delete(_,$)}async clear(_="default"){return this.memoryStorage.clear(_)}async getStats(_){return this.memoryStorage.getStats(_)}async setCodebaseFile(_,$,X,Z,J,G){let Y=new Date().toISOString();return this.cacheStorage.setCodebaseFile({path:_,mtime:$,hash:X,content:Z,language:J,size:G,indexedAt:Y})}async getCodebaseFile(_){return this.cacheStorage.getCodebaseFile(_)}async getAllCodebaseFiles(){return this.cacheStorage.getAllCodebaseFiles()}async deleteCodebaseFile(_){return this.cacheStorage.deleteCodebaseFile(_)}async clearCodebaseFiles(){return this.cacheStorage.clearCodebaseFiles()}async setMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async getMetadata(_){return this.cacheStorage.getMetadata(_)}async getAllMetadata(){return this.cacheStorage.getAllMetadata()}async deleteMetadata(_){return this.cacheStorage.deleteMetadata(_)}async setTfidfTerms(_){return this.cacheStorage.setTfidfTerms(_)}async getTfidfTerms(_){return this.cacheStorage.getTfidfTerms(_)}async getTfidfTermsByTerm(_){return this.cacheStorage.getTfidfTermsByTerm(_)}async clearTfidfTerms(){return this.cacheStorage.clearTfidfTerms()}async setTfidfDocument(_,$,X,Z){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$,termCount:X,rawTerms:Z})}async getTFIDFDocument(_){return this.cacheStorage.getTfidfDocument(_)}async getAllTfidfDocuments(){return this.cacheStorage.getAllTfidfDocuments()}async clearTfidfDocuments(){return this.cacheStorage.clearTfidfDocuments()}async setTfidfIdf(_,$){return this.cacheStorage.setTfidfIdf({term:_,idfValue:$})}async getTfidfIdf(_){return this.cacheStorage.getTfidfIdf(_)}async getAllTfidfIdf(){return this.cacheStorage.getAllTfidfIdf()}async clearTfidfIdf(){return this.cacheStorage.clearTfidfIdf()}async getCacheStats(){return this.cacheStorage.getStats()}async clearAllCache(){return this.cacheStorage.clearAll()}async getAllStats(){let[_,$]=await Promise.all([this.memoryStorage.getStats(),this.cacheStorage.getStats()]);return{memory:_,cache:$}}async clearAll(){await Promise.all([this.memoryStorage.clear("default"),this.cacheStorage.clearAll()])}async getCodebaseIndexStats(){let _=await this.cacheStorage.getAllMetadata();return{indexedAt:_.indexedAt,totalFiles:Number.parseInt(_.totalFiles||"0"),totalTerms:Number.parseInt(_.totalTerms||"0")}}async getIDFValues(){return this.cacheStorage.getAllTfidfIdf()}async upsertTFIDFDocument(_,$){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:JSON.stringify($.rawTerms)})}async upsertCodebaseFile(_){return this.cacheStorage.setCodebaseFile({..._,indexedAt:_.indexedAt||new Date().toISOString()})}async setIDFValues(_){let $=Object.entries(_).map(([X,Z])=>this.cacheStorage.setTfidfIdf({term:X,idfValue:Z}));await Promise.all($)}async clearCodebaseIndex(){await Promise.all([this.cacheStorage.clearCodebaseFiles(),this.cacheStorage.clearTfidfTerms(),this.cacheStorage.clearTfidfDocuments(),this.cacheStorage.clearTfidfIdf()])}async getCodebaseMetadata(_){return this.cacheStorage.getMetadata(_)}async setCodebaseMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async setTFIDFTerms(_,$){let X=Object.entries($).map(([Z,J])=>({filePath:_,term:Z,frequency:J}));return this.cacheStorage.setTfidfTerms(X)}}class KZ{static step1aRules=[{pattern:/sses$/i,replacement:"ss"},{pattern:/ies$/i,replacement:"i"},{pattern:/ss$/i,replacement:"ss"},{pattern:/s$/i,replacement:""}];static step1bRules=[{pattern:/eed$/i,replacement:"ee"},{pattern:/ed$/i,replacement:""},{pattern:/ing$/i,replacement:""}];static step1cRules=[{pattern:/y$/i,replacement:"i"}];static step2Rules=[{pattern:/ational$/i,replacement:"ate"},{pattern:/tional$/i,replacement:"tion"},{pattern:/enci$/i,replacement:"ence"},{pattern:/anci$/i,replacement:"ance"},{pattern:/izer$/i,replacement:"ize"},{pattern:/abli$/i,replacement:"able"},{pattern:/alli$/i,replacement:"al"},{pattern:/entli$/i,replacement:"ent"},{pattern:/eli$/i,replacement:"e"},{pattern:/ousli$/i,replacement:"ous"},{pattern:/ization$/i,replacement:"ize"},{pattern:/ation$/i,replacement:"ate"},{pattern:/ator$/i,replacement:"ate"},{pattern:/alism$/i,replacement:"al"},{pattern:/iveness$/i,replacement:"ive"},{pattern:/fulness$/i,replacement:"ful"},{pattern:/ousness$/i,replacement:"ous"},{pattern:/aliti$/i,replacement:"al"},{pattern:/iviti$/i,replacement:"ive"},{pattern:/biliti$/i,replacement:"ble"}];static step3Rules=[{pattern:/icate$/i,replacement:"ic"},{pattern:/ative$/i,replacement:""},{pattern:/alize$/i,replacement:"al"},{pattern:/iciti$/i,replacement:"ic"},{pattern:/ical$/i,replacement:"ic"},{pattern:/ful$/i,replacement:""},{pattern:/ness$/i,replacement:""}];static step4Rules=[{pattern:/al$/i,replacement:""},{pattern:/ance$/i,replacement:""},{pattern:/ence$/i,replacement:""},{pattern:/er$/i,replacement:""},{pattern:/ic$/i,replacement:""},{pattern:/able$/i,replacement:""},{pattern:/ible$/i,replacement:""},{pattern:/ant$/i,replacement:""},{pattern:/ement$/i,replacement:""},{pattern:/ment$/i,replacement:""},{pattern:/ent$/i,replacement:""},{pattern:/ion$/i,replacement:""},{pattern:/ou$/i,replacement:""},{pattern:/ism$/i,replacement:""},{pattern:/ate$/i,replacement:""},{pattern:/iti$/i,replacement:""},{pattern:/ous$/i,replacement:""},{pattern:/ive$/i,replacement:""},{pattern:/ize$/i,replacement:""}];static step5Rules=[{pattern:/e$/i,replacement:""},{pattern:/ll$/i,replacement:"l"}];static stem(_){if(_.length<3)return _.toLowerCase();let $=_.toLowerCase();for(let X of this.step1aRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1bRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1cRules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step2Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step3Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step4Rules)if(X.pattern.test($)&&$.length>3){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step5Rules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}return $}}function F5(_){return _.replace(/```[\s\S]*?```/g," ").replace(/`[^`]+`/g," ").replace(/#{1,6}\s/g,"").replace(/[*_~]/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").toLowerCase().split(/[^a-z0-9_-]+/).filter((Z)=>Z.length>1)}function W5(_){let $=F5(_),X=new Map;for(let Z of $){let J=KZ.stem(Z);X.set(J,(X.get(J)||0)+1)}return X}var NW=new Set(["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","will","with","this","but","they","have","had","what","when","where","who","which","why","how"]);function OZ(_){return _.filter(($)=>!NW.has($.toLowerCase()))}function DZ(_){let $=Array.from(_.values()).reduce((Z,J)=>Z+J,0),X=new Map;for(let[Z,J]of _.entries())X.set(Z,J/$);return X}function MW(_,$){let X=new Map;for(let J of _){let G=new Set(J.keys());for(let Y of G)X.set(Y,(X.get(Y)||0)+1)}let Z=new Map;for(let[J,G]of X.entries())Z.set(J,Math.log($/G));return Z}function RZ(_,$){let X=new Map;for(let[Z,J]of _.entries()){let G=$.get(Z)||0;X.set(Z,J*G)}return X}function VZ(_){let $=0;for(let X of _.values())$+=X*X;return Math.sqrt($)}function H8(_){let $=_.map((J)=>({uri:J.uri,terms:W5(J.content)})),X=MW($.map((J)=>J.terms),_.length);return{documents:$.map((J)=>{let G=DZ(J.terms),Y=RZ(G,X),z=VZ(Y);return{uri:J.uri,terms:Y,rawTerms:J.terms,magnitude:z}}),idf:X,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}function BW(_,$){let X=0;for(let[J,G]of _.entries()){let Y=$.terms.get(J)||0;X+=G*Y}let Z=VZ(_);if(Z===0||$.magnitude===0)return 0;return X/(Z*$.magnitude)}function IW(_,$){let X=W5(_),Z=DZ(X);return RZ(Z,$)}function U5(_,$,X={}){let{limit:Z=10,minScore:J=0,boostFactors:G={}}=X,{exactMatch:Y=1.5,phraseMatch:z=2}=G,H=IW(_,$.idf),F=OZ(F5(_));return $.documents.map((A)=>{let K=BW(H,A),D=[];for(let R of F)if(A.rawTerms.has(R))K*=Y,D.push(R);if(D.length===F.length&&F.length>1)K*=z;return{uri:A.uri,score:K,matchedTerms:D}}).filter((A)=>A.score>=J).sort((A,K)=>K.score-A.score).slice(0,Z)}function QW(_){let $=A1.extname(_).toLowerCase();return{".ts":"TypeScript",".tsx":"TSX",".js":"JavaScript",".jsx":"JSX",".py":"Python",".java":"Java",".go":"Go",".rs":"Rust",".c":"C",".cpp":"C++",".cs":"C#",".rb":"Ruby",".php":"PHP",".swift":"Swift",".kt":"Kotlin",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".sql":"SQL",".sh":"Shell",".bash":"Bash"}[$]}function EW(_){let $=new Set([".ts",".tsx",".js",".jsx",".py",".java",".go",".rs",".c",".cpp",".h",".hpp",".cs",".rb",".php",".swift",".kt",".md",".txt",".json",".yaml",".yml",".toml",".xml",".html",".css",".scss",".sass",".less",".sql",".sh",".bash",".env",".gitignore",".dockerignore"]),X=A1.extname(_).toLowerCase();return $.has(X)||!X}function jW(_){let $=NZ.default();$.add(["node_modules/",".git/","dist/","build/",".next/",".cache/","coverage/","*.log",".DS_Store","Thumbs.db"]);let X=A1.join(_,".gitignore");if(E1.existsSync(X)){let Z=E1.readFileSync(X,"utf8");$.add(Z)}return $}function TW(_,$,X,Z={}){let{maxFileSize:J=1048576,maxFiles:G=50000}=Z,Y=[];function z(H){if(Y.length>=G)return;let F=E1.readdirSync(H,{withFileTypes:!0});for(let W of F){if(Y.length>=G)break;let A=A1.join(H,W.name),K=A1.relative($,A);if(X.ignores(K))continue;if(W.isDirectory())z(A);else if(W.isFile()&&EW(W.name))try{let D=E1.statSync(A);if(D.size>J){console.warn(`[WARN] Skipping large file: ${K} (${D.size} bytes)`);continue}let R=E1.readFileSync(A,"utf8"),N=QW(W.name);Y.push({path:K,absolutePath:A,content:R,language:N,size:D.size,mtime:D.mtimeMs})}catch(D){console.warn(`[WARN] Failed to read file: ${K}`,D)}}}return z(_),Y}function LW(_){let $=0;for(let X=0;X<_.length;X++){let Z=_.charCodeAt(X);$=($<<5)-$+Z,$=$&$}return $.toString(36)}class A5{codebaseRoot;cacheDir;cache=null;ig;db;options;constructor(_={}){this.options={batchSize:100,..._},this.codebaseRoot=_.codebaseRoot||process.cwd(),this.cacheDir=_.cacheDir||A1.join(this.codebaseRoot,".sylphx-flow","cache"),this.ig=jW(this.codebaseRoot),this.db=new v0}async buildTFIDFIndexFromDB(){try{let _=[],$=await this.db.getAllCodebaseFiles();for(let J of $){let G=await this.db.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,H=new Map;for(let[F,W]of Object.entries(Y))z.set(F,W),H.set(F,W);_.push({uri:`file://${J.path}`,terms:z,rawTerms:H,magnitude:G.magnitude})}}let X=await this.db.getIDFValues(),Z=new Map;for(let[J,G]of Object.entries(X))Z.set(J,G);if(_.length===0)return;return{documents:_,idf:Z,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch(_){console.error("[ERROR] Failed to build TF-IDF index from database:",_);return}}async loadCache(){try{await this.db.initialize();let _=await this.db.getCodebaseMetadata("version"),$=await this.db.getCodebaseMetadata("codebaseRoot"),X=await this.db.getCodebaseMetadata("indexedAt"),Z=await this.db.getCodebaseMetadata("fileCount");if(!_||!$||!X||!Z)return null;let J=await this.db.getAllCodebaseFiles(),G=new Map;for(let H of J)G.set(H.path,{mtime:H.mtime,hash:H.hash});let Y=await this.buildTFIDFIndexFromDB(),z=await this.db.getCodebaseMetadata("vectorIndexPath");return{version:_,codebaseRoot:$,indexedAt:X,fileCount:Number.parseInt(Z),files:G,tfidfIndex:Y,vectorIndexPath:z}}catch(_){return console.error("[ERROR] Failed to load cache from database:",_),null}}async saveCache(_){try{if(await this.db.initialize(),await this.db.setCodebaseMetadata("version",_.version),await this.db.setCodebaseMetadata("codebaseRoot",_.codebaseRoot),await this.db.setCodebaseMetadata("indexedAt",_.indexedAt),await this.db.setCodebaseMetadata("fileCount",_.fileCount.toString()),_.vectorIndexPath)await this.db.setCodebaseMetadata("vectorIndexPath",_.vectorIndexPath);for(let[$,X]of _.files.entries())await this.db.upsertCodebaseFile({path:$,mtime:X.mtime,hash:X.hash});if(_.tfidfIndex){for(let X of _.tfidfIndex.documents){let Z=X.uri.replace("file://",""),J={};for(let[Y,z]of X.rawTerms.entries())J[Y]=z;await this.db.upsertTFIDFDocument(Z,{magnitude:X.magnitude,termCount:X.terms.size,rawTerms:J});let G={};for(let[Y,z]of X.terms.entries())G[Y]=z;await this.db.setTFIDFTerms(Z,G)}let $={};for(let[X,Z]of _.tfidfIndex.idf.entries())$[X]=Z;await this.db.setIDFValues($)}console.error("[INFO] Cache saved to database")}catch($){throw console.error("[ERROR] Failed to save cache to database:",$),$}}async indexCodebase(_={}){let{force:$=!1}=_,{embeddingProvider:X}=_;this.cache=await this.loadCache(),console.error("[INFO] Scanning codebase...");let Z=TW(this.codebaseRoot,this.codebaseRoot,this.ig);if(console.error(`[INFO] Found ${Z.length} files`),this.cache&&!$){let D=Math.abs(Z.length-this.cache.fileCount)/this.cache.fileCount*100;if(D>20)console.error(`[WARN] File count changed significantly (${D.toFixed(1)}%), forcing full reindex`),$=!0,this.cache=null}let J=[],G=[],Y=new Map;for(let K of Z){let D=LW(K.content);Y.set(K.path,{mtime:K.mtime,hash:D});let R=this.cache?.files.get(K.path);if($||!R||R.hash!==D)J.push(K)}if(this.cache?.files){for(let K of this.cache.files.keys())if(!Y.has(K))G.push(K)}let z=J.length>0||G.length>0;if(!$&&!z&&this.cache?.tfidfIndex)return console.error("[INFO] Cache hit! Using cached index"),{tfidfIndex:this.cache.tfidfIndex,stats:{totalFiles:Z.length,indexedFiles:0,skippedFiles:Z.length,cacheHit:!0}};if(J.length>0)console.error(`[INFO] Changed files: ${J.length}`);if(G.length>0)console.error(`[INFO] Deleted files: ${G.length}`);console.error(`[INFO] Indexing ${J.length} changed files...`);let F=Z.map((K)=>({uri:`file://${K.path}`,content:K.content})),W=H8(F),A;if(X){console.error("[INFO] Generating embeddings...");let K=A1.join(this.cacheDir,"codebase-vectors.hnsw");A=new F8(K,X.dimensions);let D=10;for(let R=0;R<Z.length;R+=D){let N=Z.slice(R,R+D),I=N.map((E)=>E.content),P=await X.generateEmbeddings(I);for(let E=0;E<N.length;E++){let j=N[E],b=P[E],f={id:`file://${j.path}`,embedding:b,metadata:{type:"code",language:j.language||"",content:j.content.slice(0,500),category:""}};A.addDocument(f)}console.error(`[INFO] Embedded ${Math.min(R+D,Z.length)}/${Z.length} files`)}A.save()}return this.cache={version:"1.0.0",codebaseRoot:this.codebaseRoot,indexedAt:new Date().toISOString(),fileCount:Z.length,files:Y,tfidfIndex:W,vectorIndexPath:A?A1.join(this.cacheDir,"codebase-vectors.hnsw"):void 0},await this.saveCache(this.cache),{tfidfIndex:W,vectorStorage:A,stats:{totalFiles:Z.length,indexedFiles:J.length,skippedFiles:Z.length-J.length,cacheHit:!1}}}async getCacheStats(){try{await this.db.initialize();let _=await this.db.getCodebaseIndexStats();return{exists:_.fileCount>0,fileCount:_.fileCount,indexedAt:_.indexedAt}}catch(_){return console.error("[ERROR] Failed to get cache stats:",_),{exists:!1,fileCount:0}}}async clearCache(){try{await this.db.initialize(),await this.db.clearCodebaseIndex();let _=A1.join(this.cacheDir,"codebase-index.json");if(E1.existsSync(_))E1.unlinkSync(_);let $=A1.join(this.cacheDir,"codebase-vectors.hnsw");if(E1.existsSync($))E1.unlinkSync($);console.error("[INFO] Cache cleared from database and files")}catch(_){console.error("[ERROR] Failed to clear cache:",_)}}}import O5 from"node:fs";import D5 from"node:path";class K5{config;cachedIndex=null;indexingPromise=null;status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0};constructor(_){this.config=_}getStatus(){return{...this.status}}isReady(){return this.cachedIndex!==null&&!this.status.isIndexing}startBackgroundIndexing(){if(this.status.isIndexing||this.cachedIndex)return;console.error(`[INFO] Starting background ${this.config.name} indexing...`),this.loadIndex().catch((_)=>{console.error(`[ERROR] Background ${this.config.name} indexing failed:`,_)})}async loadIndex(){if(this.cachedIndex)return this.cachedIndex;if(this.indexingPromise)return this.indexingPromise;return this.status.isIndexing=!0,this.status.progress=0,this.status.startTime=Date.now(),this.status.error=void 0,this.indexingPromise=this.buildIndex().then((_)=>{return this.cachedIndex=_,this.status.isIndexing=!1,this.status.progress=100,this.status.totalItems=_.totalDocuments,this.status.indexedItems=_.totalDocuments,console.error(`[INFO] ${this.config.name} indexing complete: ${_.totalDocuments} documents`),_}).catch((_)=>{throw this.status.isIndexing=!1,this.status.error=_ instanceof Error?_.message:String(_),console.error(`[ERROR] ${this.config.name} indexing failed:`,_),_}),this.indexingPromise}clearCache(){this.cachedIndex=null,this.indexingPromise=null,this.status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0}}async getStats(){let _=await this.loadIndex();if(!_)return null;return{totalDocuments:_.totalDocuments,uniqueTerms:_.idf.size,generatedAt:_.metadata.generatedAt,version:_.metadata.version}}}class MZ extends K5{embeddingProvider;vectorStorage;constructor(_){super({name:"knowledge",autoStart:!0});this.embeddingProvider=_}scanKnowledgeFiles(_){let $=[],X=(Z,J)=>{let G=O5.readdirSync(Z,{withFileTypes:!0});for(let Y of G){let z=D5.join(Z,Y.name);if(Y.isDirectory())X(z,J);else if(Y.isFile()&&Y.name.endsWith(".md")){let F=D5.relative(J,z).replace(/\.md$/,"").replace(/\\/g,"/"),W=O5.readFileSync(z,"utf8");$.push({uri:`knowledge://${F}`,content:W})}}};return X(_,_),$}async buildIndex(){let _=V5();if(!O5.existsSync(_))throw Error(`Knowledge directory not found: ${_}`);let $=this.scanKnowledgeFiles(_);console.error(`[INFO] Found ${$.length} knowledge files`);let X=H8($);if(this.embeddingProvider&&$.length>0){console.error("[INFO] Building vector index for knowledge...");try{let Z=D5.join(V5(),"..",".sylphx-flow","knowledge-vectors.hnsw");this.vectorStorage=new F8(Z,this.embeddingProvider.dimensions||1536),await this.vectorStorage.initialize();let J=10;for(let G=0;G<$.length;G+=J){let Y=$.slice(G,G+J),z=await this.embeddingProvider.generateEmbeddings(Y.map((H)=>H.content));for(let H=0;H<Y.length;H++){let F=Y[H],W=z[H];await this.vectorStorage.addDocument({id:F.uri,embedding:W,metadata:{type:"knowledge",content:F.content.slice(0,500),category:"knowledge",language:"markdown"}})}console.error(`[INFO] Processed ${Math.min(G+J,$.length)}/${$.length} knowledge files`)}await this.vectorStorage.save(),console.error("[INFO] Vector index built successfully")}catch(Z){console.error("[ERROR] Failed to build vector index:",Z),this.vectorStorage=void 0}}return X}}var R5=null;function N5(_){if(!R5)R5=new MZ(_);return R5}class BZ{memoryStorage;knowledgeIndexer=N5();embeddingProvider;constructor(){this.memoryStorage=new v0}async initialize(){if(await this.memoryStorage.initialize(),!this.embeddingProvider)this.embeddingProvider=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();this.knowledgeIndexer=N5(this.embeddingProvider)}async getStatus(){let _=await this.memoryStorage.getAllCodebaseFiles(),$=await this.memoryStorage.getCodebaseIndexStats(),X=this.knowledgeIndexer.getStatus(),Z=!1,J=0;try{let G=await this.knowledgeIndexer.loadIndex();Z=!0,J=G.totalDocuments}catch{}return{codebase:{indexed:_.length>0,fileCount:_.length,indexedAt:$.indexedAt},knowledge:{indexed:Z,documentCount:J,isIndexing:X.isIndexing,progress:X.progress}}}async searchCodebase(_,$={}){let{limit:X=10,include_content:Z=!0,file_extensions:J,path_filter:G,exclude_paths:Y,min_score:z=0.1}=$,H=await this.memoryStorage.getAllCodebaseFiles();if(H.length===0)throw Error('Codebase not indexed yet. Run "sylphx search reindex" first.');let F=H;if(J?.length)F=F.filter((D)=>J.some((R)=>D.path.endsWith(R)));if(G)F=F.filter((D)=>D.path.includes(G));if(Y?.length)F=F.filter((D)=>!Y.some((R)=>D.path.includes(R)));if(F.length===0)return{results:[],totalIndexed:H.length,query:_};let W=await this.buildSearchIndex(F);if(!W)throw Error("No searchable content found");let A=await U5(_,W,{limit:X,minScore:z}),K=[];for(let D of A){let R=D.uri?.replace("file://","")||"Unknown",N="";if(Z){let I=await this.memoryStorage.getCodebaseFile(R);if(I?.content){if(N=I.content.substring(0,500),I.content.length>500)N+="..."}}K.push({uri:D.uri,score:D.score||0,title:R.split("/").pop()||R,content:Z?N:void 0})}return{results:K,totalIndexed:H.length,query:_}}async searchKnowledge(_,$={}){let{limit:X=10,include_content:Z=!0}=$;try{let J=await this.knowledgeIndexer.loadIndex();return{results:(await U5(_,J,{limit:X})).map((z)=>({uri:z.uri,score:z.score||0,title:z.uri?.split("/").pop()||"Unknown",content:Z?"":void 0})),totalIndexed:J.totalDocuments,query:_}}catch{throw Error("Knowledge base not indexed yet")}}async buildSearchIndex(_){try{let $=[];for(let J of _){let G=await this.memoryStorage.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,H=new Map;for(let[F,W]of Object.entries(Y))z.set(F,W),H.set(F,W);$.push({uri:`file://${J.path}`,terms:z,rawTerms:H,magnitude:G.magnitude})}}if($.length===0)return null;let X=await this.memoryStorage.getIDFValues(),Z=new Map;for(let J of X)if(J.term&&J.idfValue!==void 0)Z.set(J.term,J.idfValue);return{documents:$,idf:Z,totalDocuments:$.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch($){return console.error("[ERROR] Failed to build search index:",$),null}}formatResultsForCLI(_,$,X){if(_.length===0)return`\uD83D\uDCED No results found for "${$}"

**Total indexed files:** ${X}`;let Z=`✓ Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let H=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${H}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA Source: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
   \`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return Z+J}formatResultsForMCP(_,$,X){let Z=`Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let H=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${H}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA URI: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
\`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return{content:[{type:"text",text:Z+J}]}}async getAvailableKnowledgeURIs(){try{return(await this.knowledgeIndexer.loadIndex()).documents.map(($)=>$.uri)}catch{return[]}}}var E0=new BZ;var wW=new B0("search").description("Search codebase files and source code").argument("<query>","Search query - use natural language, function names, or technical terms").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include file content snippets in results (default: true)","true").option("--extensions <exts...>","Filter by file extensions (e.g., .ts .tsx .js)").option("--path <pattern>","Filter by path pattern (e.g., src/components)").option("--exclude <patterns...>","Exclude paths containing these patterns").action(async(_,$)=>{try{console.log(""),console.log(M.cyan.bold("▸ Search Codebase")),console.log(M.gray(`  Query: "${_}"`));let X=h0("Searching...").start();await E0.initialize();let Z=await E0.searchCodebase(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false",file_extensions:$.extensions,path_filter:$.path,exclude_paths:$.exclude});X.stop();let J=E0.formatResultsForCLI(Z.results,_,Z.totalIndexed);console.log(J),console.log("")}catch(X){console.error(M.red(`
✗ Error: ${X.message}
`)),process.exit(1)}}),PW=new B0("reindex").description("Reindex all codebase files").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Reindex Codebase"));let _=h0("Scanning and indexing files...").start(),$=new A5,X=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();await $.indexCodebase({embeddingProvider:X}),_.succeed(M.green("Indexing complete")),console.log("")}catch(_){throw new k(`Codebase reindex failed: ${_.message}`)}}),xW=new B0("status").description("Get codebase search system status").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Codebase Status")),await E0.initialize();let _=await E0.getStatus();if(_.codebase.indexed){if(console.log(M.green(`
✓ Indexed and ready`)),console.log(M.gray(`  Files: ${_.codebase.fileCount}`)),_.codebase.indexedAt)console.log(M.gray(`  Last indexed: ${new Date(_.codebase.indexedAt).toLocaleString()}`))}else console.log(M.yellow(`
⚠ Not indexed`)),console.log(M.gray("  Run: sylphx-flow codebase reindex"));console.log(M.cyan(`
▸ Available Commands`)),console.log(M.gray("  • codebase search <query>")),console.log(M.gray("  • codebase reindex")),console.log(M.gray("  • codebase status")),console.log("")}catch(_){console.error(M.red(`
✗ Error: ${_.message}
`)),process.exit(1)}}),IZ=new B0("codebase").description("Manage codebase indexing and search").addCommand(wW).addCommand(PW).addCommand(xW);import t0 from"node:fs";import u1 from"node:path";var qW={core:"core.md"};function M5(_="core"){return QZ(qW[_])}function EZ(_){try{return M5(_),!0}catch{return!1}}function a2(_,$="white"){let X={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",reset:"\x1B[0m"},Z=X[$]||X.white;console.log(`${Z}${_}${X.reset}`)}import wZ from"node:path";import H2 from"node:fs/promises";import jZ from"node:path";async function I5(_,$={}){let{encoding:X="utf8",fallback:Z}=$;try{return await H2.readFile(_,X)}catch(J){if(J.code==="ENOENT"&&Z!==void 0)return Z;throw J}}async function TZ(_){try{return await H2.access(_),!0}catch{return!1}}async function W8(_){try{let $=await H2.stat(_);return{exists:!0,isFile:$.isFile(),isDirectory:$.isDirectory(),size:$.size,mtime:$.mtime,atime:$.atime,ctime:$.ctime}}catch{return{exists:!1,isFile:!1,isDirectory:!1}}}async function LZ(_){if(B5.validatePath(_),!await TZ(_))return;if((await W8(_)).isDirectory)await H2.rmdir(_,{recursive:!0});else await H2.unlink(_)}async function U8(_,$={}){let{recursive:X=!1,includeFiles:Z=!0,includeDirectories:J=!0}=$;if(B5.validatePath(_),!await TZ(_))throw Error(`Directory does not exist: ${_}`);if(!(await W8(_)).isDirectory)throw Error(`Path is not a directory: ${_}`);if(X){let Y=[],z=await H2.readdir(_,{withFileTypes:!0});for(let H of z){let F=jZ.join(_,H.name);if(H.isDirectory()&&J){Y.push(F);let W=await U8(F,$);Y.push(...W)}else if(H.isFile()&&Z)Y.push(F)}return Y}else return(await H2.readdir(_,{withFileTypes:!0})).filter((z)=>{if(z.isFile()&&Z)return!0;if(z.isDirectory()&&J)return!0;return!1}).map((z)=>jZ.join(_,z.name))}async function Q5(_,$){try{return(await U8(_,{recursive:!0,includeFiles:!0,includeDirectories:!1})).filter((Z)=>$.some((J)=>Z.endsWith(J))).map((Z)=>wZ.relative(_,Z)).sort()}catch{return[]}}async function e_(_){let $=await W8(_);if(!$.exists||!$.isFile)return null;let X=await I5(_);if(X===null)return null;return{content:X,mtime:$.mtime}}async function E5(_,$,X,Z){try{let J=await U8(_,{recursive:!1,includeFiles:!0,includeDirectories:!1});for(let G of J){let Y=wZ.basename(G);if(X.some((H)=>Y.endsWith(H))&&!$.has(Y))await LZ(G),Z.push({file:Y,status:"skipped",action:"Removed obsolete file"})}}catch{}}async function j5(_,$,X,Z,J=!1,G=!1){if(G)return;if(!J){let A=_.length,K=_.filter((D)=>D.status==="added"||D.status==="updated").length;if(K>0)console.log(`✓ ${K} files updated`);else console.log(`✓ All ${A} files already current`);return}console.log(`
\uD83D\uDCCA ${Z} Results for ${X}`),console.log("=====================================");let Y=_.reduce((A,K)=>{if(!A[K.status])A[K.status]=[];return A[K.status].push(K),A},{}),z=["added","updated","current","skipped"],H={added:"green",updated:"yellow",current:"blue",skipped:"magenta"};for(let A of z){let K=Y[A];if(K&&K.length>0){let D=H[A];a2(`${A.toUpperCase()} (${K.length}):`,D);for(let R of K)a2(`  ${R.file} - ${R.action}`,D);console.log("")}}let F=_.length,W=_.filter((A)=>A.status==="added"||A.status==="updated").length;if(W>0)a2(`✓ ${Z} complete: ${W}/${F} files modified`,"green");else a2(`✓ ${Z} complete: All ${F} files already current`,"blue");console.log(`\uD83D\uDCC1 Target directory: ${$}`)}async function PZ(){let{getAgentsDir:_}=await import("./paths-2re3k191.js"),$=_();if(!t0.existsSync($))throw Error(`Could not find agents directory at: ${$}`);let X=[],Z=t0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isFile()&&G.name.endsWith(".md")).map((G)=>G.name);X.push(...Z);let J=t0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isDirectory()&&G.name!=="archived").map((G)=>G.name);for(let G of J){let Y=u1.join($,G),z=await Q5(Y,[".md"]);X.push(...z.map((H)=>u1.join(G,H)))}return X}async function xZ(_){let $=process.cwd(),X=[],Z=await v.resolveTarget({target:_.target}),J=v.getTarget(Z);if(!J)throw Error(`Target not found: ${Z}`);if(_.quiet!==!0)console.log(`Using target: ${J.name}`);let G=J.config,Y=u1.join($,G.agentDir),z=async(K,D)=>{return await J.transformAgentContent(K,void 0,D)};if(_.clear&&t0.existsSync(Y)){let K,D=await PZ();K=new Set(D.map((R)=>{let N=u1.parse(R),I=N.name,P=N.dir;if(G.flatten)return`${P?`${P.replace(/[\/\\]/g,"-")}-${I}`:I}${G.agentExtension}`;return R})),E5(Y,K,[G.agentExtension],X)}t0.mkdirSync(Y,{recursive:!0});let H=await PZ();if(_.quiet!==!0)console.log(`Installing ${H.length} agents to ${Y.replace(`${process.cwd()}/`,"")}`),console.log("");if(_.dryRun){console.log("✓ Dry run completed - no files were modified");return}let{getAgentsDir:F}=await import("./paths-2re3k191.js"),W=F(),A=H.map(async(K)=>{let D=u1.join(W,K),R=u1.join(Y,K),N=u1.dirname(R);if(!t0.existsSync(N))t0.mkdirSync(N,{recursive:!0});let I=await e_(R),P=!I,E=t0.readFileSync(D,"utf8");E=await z(E,K);let j=I?await z(I.content,K):"";if(!I||j!==E)t0.writeFileSync(R,E,"utf8"),X.push({file:K,status:I?"updated":"added",action:I?"Updated":"Created"});else X.push({file:K,status:"current",action:"Already current"})});await Promise.all(A),j5(X,Y,J.name,"Install",_.verbose,_.quiet)}async function qZ(_){let $=process.cwd(),X=await v.resolveTarget({target:_.target}),Z=v.getTarget(X);if(!Z)throw Error(`Target not found: ${X}`);if(!Z.config.rulesFile)return;if(!EZ("core")){console.warn("⚠️ Core rules file not found");return}let J=M5("core"),Y=t0.readFileSync(J,"utf8"),z=u1.join($,Z.config.rulesFile),H=await e_(z),F=Y;if(_.dryRun){console.log(`Dry run: Would install rules file to ${z.replace(`${$}/`,"")}`);return}if(H&&H.content===F){if(_.quiet!==!0)console.log(`Rules file already current: ${Z.config.rulesFile}`);return}if(t0.writeFileSync(z,F,"utf8"),_.quiet!==!0)console.log(`${H?"Updated":"Created"} rules file: ${Z.config.rulesFile}`)}function CW(_){return _.type==="stdio"}function T5(_){return CW(_)}function L5(_){if(typeof _==="function"){let $=_();return Promise.resolve($)}return Promise.resolve(_)}class d1{target;constructor(_){let $=v.getTarget(_);if(!$)throw Error(`Target not found: ${_}`);this.target=$}getAllServerIds(){return Object.keys(K0)}async getAvailableServers(){let _=await this.getInstalledServerIds();return this.getAllServerIds().filter(($)=>!_.includes($))}async getInstalledServerIds(){try{let _=await this.target.readConfig(process.cwd()),$=this.target.config.mcpConfigPath,X=this.getNestedProperty(_,$)||{},Z=Object.keys(X);return Object.values(K0).filter((J)=>Z.includes(J.name)).map((J)=>J.id)}catch(_){return[]}}getRequiringConfiguration(_){return _.filter(($)=>{return!!K0[$].envVars})}validateServer(_,$){let X=K0[_];if(!X?.envVars)return{isValid:!0,missingRequired:[],invalidValues:[]};let Z=[],J=[];for(let[G,Y]of Object.entries(X.envVars)){let z=$[G]||process.env[G]||"";if(Y.required&&(!z||z===""))Z.push(G)}return{isValid:Z.length===0&&J.length===0,missingRequired:Z,invalidValues:J}}async configureServer(_,$={}){let X=K0[_],Z={};if(!X.envVars)return Z;console.log(""),console.log(M.cyan(`▸ ${X.name}`)),console.log(M.gray(`  ${X.description}`)),console.log("");for(let[J,G]of Object.entries(X.envVars)){if(G.dependsOn){if(G.dependsOn.filter((F)=>!($[F]||process.env[F])).length>0)continue}let Y=$[J]||process.env[J],z;if(Y&&Y.trim()!=="")z=Y;else if(G.fetchChoices){let H=h0("Fetching options...").start();for(let[F,W]of Object.entries($))if(W)process.env[F]=W;try{let F=await G.fetchChoices();H.stop(),z=(await i.prompt({type:"list",name:"value",message:`${J}${G.required?" *":""}`,choices:F,default:G.default||F[0]})).value}catch(F){let W=F instanceof Error?F.message:String(F);H.fail(M.red(`Failed to fetch options: ${W}`)),z=(await i.prompt({type:"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default})).value}}else if(J==="GEMINI_MODEL")z=(await i.prompt({type:"list",name:"model",message:`${J}${G.required?" *":""}`,choices:["gemini-2.5-flash","gemini-2.5-pro","gemini-1.5-flash","gemini-1.5-pro"],default:G.default||"gemini-2.5-flash"})).model;else z=(await i.prompt({type:G.secret?"password":"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default,mask:G.secret?"•":void 0})).value;if(z)Z[J]=z,$[J]=z}return console.log(M.green("✓ Configured")),console.log(""),Z}async installServers(_,$={}){if(_.length===0)return;try{let X=await this.target.readConfig(process.cwd()),Z=this.target.config.mcpConfigPath,G={...this.getNestedProperty(X,Z)||{}};for(let Y of _){let z=K0[Y],H=$[Y]||{},F={...z.config},W,A;if(T5(z.config))W=z.config.command?await L5(z.config.command):void 0,A=z.config.args?await L5(z.config.args):[];if(T5(z.config))F={...z.config,command:W,args:A};if(Object.keys(H).length>0){let R={...z.config.type==="local"?z.config.environment:z.config.type==="stdio"?z.config.env:{}};for(let[N,I]of Object.entries(H))if(I&&I.trim()!=="")R[N]=I;if(F.type==="local")F.environment=R;else if(F.type==="stdio")F.env=R}let K=this.target.transformMCPConfig(F,Y);G[z.name]=K}if(this.setNestedProperty(X,Z,G),await this.target.writeConfig(process.cwd(),X),this.target.approveMCPServers){let Y=_.map((z)=>K0[z].name);await this.target.approveMCPServers(process.cwd(),Y)}}catch(X){throw Error(`Failed to install MCP servers: ${X instanceof Error?X.message:String(X)}`)}}async readConfig(){try{return await this.target.readConfig(process.cwd())}catch(_){return{settings:{}}}}async writeConfig(_){await this.target.writeConfig(process.cwd(),_)}getNestedProperty(_,$){return $.split(".").reduce((X,Z)=>{if(typeof X==="object"&&X!==null)return X[Z];return},_)}setNestedProperty(_,$,X){let Z=$.split("."),J=Z.pop();if(!J)return;let G=Z.reduce((Y,z)=>{if(!Y[z])Y[z]={};return Y[z]},_);G[J]=X}}async function CZ(_,$){let X=v.getTarget($);if(!X)throw Error(`Target not found: ${$}`);let Z=await X.readConfig(_),J=X.config.mcpConfigPath,G=SW(Z,J);if(!G||Object.keys(G).length===0){console.log("ℹ️  No MCP servers configured");return}console.log(`\uD83D\uDCCB Currently configured MCP servers for ${X.name}:`),console.log("");for(let[Y,z]of Object.entries(G)){let H="";if(z&&typeof z==="object"&&"type"in z){if(z.type==="local")H=z.command?.join(" ")||"Unknown command";else if(z.type==="remote")H=`HTTP: ${z.url}`}console.log(`  • ${Y}: ${H}`);let F=Object.values(K0).find((W)=>W.name===Y);if(F)console.log(`    ${F.description}`);console.log("")}}function SZ(_){let $=v.getTarget(_);if(!$)throw Error(`Unknown target: ${_}. Available targets: ${v.getImplementedTargetIDs().join(", ")}`);if(!$.isImplemented)throw Error(`Target '${_}' is not implemented. Available targets: ${v.getImplementedTargetIDs().join(", ")}`);return _}function c1(_){return v.getTarget(_)?.config.installation.supportedMcpServers??!1}function SW(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}async function kW(_){let $=await v.resolveTarget({target:_.target});_.target=$;try{SZ($)}catch(X){if(X instanceof Error)throw new k(X.message,"UNSUPPORTED_TARGET");throw X}if(_.merge)throw new k("The --merge option is not supported with init command.","INVALID_OPTION")}var vZ={name:"init",description:"Initialize project with Sylphx Flow development agents and MCP tools",options:[{flags:"--target <type>",description:`Force specific target (${v.getImplementedTargetIDs().join(", ")}, default: opencode)`},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--no-mcp",description:"Skip MCP tools installation"}],handler:async(_)=>{let $=_.target;if(console.log(""),console.log(M.cyan.bold("▸ Sylphx Flow Setup")),!$)$=await v.promptForTargetSelection(),_.target=$;if(await kW(_),!$)throw Error("Target ID not set");if(_.dryRun){if(console.log(M.yellow(`
  Dry run mode - no changes will be made`)),_.mcp!==!1&&c1($)){let G=await new d1($).getAvailableServers();console.log(M.cyan(`
▸ MCP Tools`));for(let Y of G)console.log(M.gray(`  • ${K0[Y].name}`))}console.log(M.cyan(`
▸ Agents`)),console.log(M.gray("  • Development agents")),console.log(M.cyan(`
▸ Rules`)),console.log(M.gray("  • Custom rules")),console.log(M.green(`
✓ Dry run complete
`));return}if(_.mcp!==!1&&c1($)){let J=new d1($),G=J.getAllServerIds(),Y=await J.getInstalledServerIds();console.log(""),console.log(M.cyan.bold("▸ Configure MCP Tools")),console.log("");let H=(await i.prompt([{type:"checkbox",name:"selectedServers",message:"Select MCP tools to install:",choices:G.map((W)=>{let A=K0[W],K=Y.includes(W);return{name:`${A.name} - ${A.description}`,value:W,checked:A.required||K||A.defaultInInit||!1,disabled:A.required?"(required)":!1}})}])).selectedServers,F=G.filter((W)=>K0[W].required);if(H=[...new Set([...F,...H])],H.length>0){let W=H.filter((D)=>{let R=K0[D];return R.envVars&&Object.keys(R.envVars).length>0}),A={};if(W.length>0){console.log(""),console.log(M.cyan.bold("▸ Configure selected MCP tools"));let D={};for(let R of W){let N=await J.configureServer(R,D);A[R]=N}}let K=h0("Installing MCP servers...").start();try{await J.installServers(H,A),K.succeed("MCP servers installed")}catch(D){throw K.fail(M.red("Failed to install MCP servers")),D}}}if($==="opencode")await A8.ensureSecretsDir(process.cwd()),await A8.addToGitignore(process.cwd());console.log("");let X=h0("Installing agents...").start();await xZ({..._,quiet:!0}),X.succeed("Agents installed"),console.log("");let Z=h0("Installing rules...").start();await qZ({..._,quiet:!0}),Z.succeed("Rules installed"),console.log(""),console.log(M.green.bold("✓ Setup complete!")),console.log(M.gray("  Start coding with Sylphx Flow")),console.log("");try{await kZ.setDefaultTarget($),console.log(M.gray(`  Default target set to: ${v.getTarget($)?.name||$}`))}catch(J){console.warn(M.yellow(`  Warning: Could not save default target: ${J instanceof Error?J.message:String(J)}`))}console.log("")}};function vW(){return[{uri:"knowledge://stacks/react-app",title:"React App",description:"React application patterns, hooks, components, and best practices",content:"",category:"stacks"},{uri:"knowledge://stacks/nextjs-app",title:"Next.js App",description:"Next.js patterns, routing, API routes, and deployment strategies",content:"",category:"stacks"},{uri:"knowledge://stacks/node-api",title:"Node.js API",description:"Node.js API patterns, middleware, authentication, and database integration",content:"",category:"stacks"},{uri:"knowledge://data/sql",title:"SQL Patterns",description:"SQL queries, indexing, migrations, and database optimization",content:"",category:"data"},{uri:"knowledge://guides/saas-template",title:"SaaS Template",description:"SaaS application architecture, multi-tenancy, and scaling patterns",content:"",category:"guides"},{uri:"knowledge://guides/tech-stack",title:"Tech Stack Guide",description:"Technology selection, architecture decisions, and stack composition",content:"",category:"guides"},{uri:"knowledge://guides/ui-ux",title:"UI/UX Patterns",description:"User interface patterns, UX principles, and frontend architecture",content:"",category:"guides"},{uri:"knowledge://universal/security",title:"Security",description:"Security best practices, authentication, authorization, and vulnerability prevention",content:"",category:"universal"},{uri:"knowledge://universal/performance",title:"Performance",description:"Performance optimization, caching, monitoring, and scaling strategies",content:"",category:"universal"},{uri:"knowledge://universal/testing",title:"Testing",description:"Testing strategies, unit tests, integration tests, and quality assurance",content:"",category:"universal"},{uri:"knowledge://universal/deployment",title:"Deployment",description:"Deployment strategies, CI/CD, infrastructure, and monitoring",content:"",category:"universal"}]}function yZ(_){let X=vW().find((G)=>G.uri===_);if(!X)throw Error(`Knowledge resource not found: ${_}`);let Z=_.split("/")[2],J=_.split("/").pop();return`# ${X.title}

**URI:** ${_}
**Category:** ${Z}
**Description:** ${X.description}

*Note: This is a placeholder implementation. In a full implementation, this would load the actual content from knowledge files.*`}var yW=new B0("search").description("Search knowledge base, documentation, and guides").argument("<query>","Search query - use natural language, technology names, or topic keywords").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include full content in results (default: true)","true").action(async(_,$)=>{try{console.log(`\uD83D\uDCDA Searching knowledge base for: "${_}"`),await E0.initialize();let X=await E0.searchKnowledge(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false"}),Z=E0.formatResultsForCLI(X.results,_,X.totalIndexed);console.log(Z)}catch(X){throw new k(`Knowledge search failed: ${X.message}`)}}),hW=new B0("get").description("Get specific knowledge document by URI").argument("<uri>",'Knowledge URI to access (e.g., "knowledge://stacks/react-app")').action(async(_)=>{try{let $=yZ(_);console.log($)}catch($){let X=`Knowledge get failed: ${$.message}`,Z=await E0.getAvailableKnowledgeURIs();if(Z.length>0)console.log(`
**Available knowledge URIs:**`),Z.forEach((J)=>console.log(`• ${J}`));throw new k(X)}}),fW=new B0("list").description("List all available knowledge resources").option("--category <type>","Filter by category (stacks, guides, universal, data)").action(async(_)=>{try{await E0.initialize();let $=await E0.getAvailableKnowledgeURIs();if($.length===0){console.log("\uD83D\uDCED No knowledge documents available");return}let X=$;if(_.category)X=$.filter((J)=>J.includes(`/${_.category}/`));console.log(`\uD83D\uDCDA Available Knowledge Resources (${X.length} documents):
`);let Z=X.reduce((J,G)=>{let Y=G.split("/")[2]||"unknown";if(!J[Y])J[Y]=[];return J[Y].push(G),J},{});Object.entries(Z).forEach(([J,G])=>{console.log(`### ${J.charAt(0).toUpperCase()+J.slice(1)}`),G.forEach((Y)=>{let z=Y.split("/").pop()||"Unknown";console.log(`• ${z} - ${Y}`)}),console.log("")}),console.log("**Usage:**"),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch($){throw new k(`Knowledge status failed: ${$.message}`)}}),bW=new B0("status").description("Get knowledge base system status").action(async()=>{try{console.log(`
### \uD83D\uDCDA Knowledge Base Status
`),await E0.initialize();let _=await E0.getStatus();if(_.knowledge.indexed)console.log("**Status:** ✓ Ready"),console.log(`**Documents:** ${_.knowledge.documentCount} files`);else if(_.knowledge.isIndexing)console.log(`**Status:** \uD83D\uDD04 Building index (${_.knowledge.progress||0}%)`),console.log("**Note:** Please wait a moment and try again");else console.log("**Status:** ⚠️ Not initialized"),console.log("**Note:** Will auto-index on first search");console.log(`
**Available Commands:**`),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch(_){throw new k(`Knowledge list failed: ${_.message}`)}}),t2=new B0("knowledge").description("Knowledge base search and management commands");t2.addCommand(yW);t2.addCommand(hW);t2.addCommand(fW);t2.addCommand(bW);function gW(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}var pW=async(_)=>{let $={disableMemory:_.disableMemory===!0,disableTime:_.disableTime===!0,disableProjectStartup:_.disableProjectStartup===!0,disableKnowledge:_.disableKnowledge===!0,disableCodebaseSearch:_.disableCodebaseSearch===!0},X=await v.resolveTarget({target:_.target,allowSelection:!0}),Z=v.getTarget(X);if(!Z)throw new k(`Target not found: ${X}`,"TARGET_NOT_FOUND");try{let J=await Z.readConfig(process.cwd()),G=Z.config.mcpConfigPath||"mcp",Y=gW(J,G)||{},z=["--disable-memory","--disable-time","--disable-project-startup","--disable-knowledge","--disable-codebase-search"],H=[];if($.disableMemory)H.push("--disable-memory");if($.disableTime)H.push("--disable-time");if($.disableProjectStartup)H.push("--disable-project-startup");if($.disableKnowledge)H.push("--disable-knowledge");if($.disableCodebaseSearch)H.push("--disable-codebase-search");for(let[F,W]of Object.entries(Y)){if(!W||typeof W!=="object")continue;if(W.type==="stdio"){if(!W.args)W.args=[];W.args.push(...H)}else if(W.type==="local"&&Array.isArray(W.command))W.command.push(...H);else if(W.type==="http"||W.type==="remote")continue}await Z.writeConfig(process.cwd(),J),console.log(M.green("✓ Sylphx Flow MCP server configuration updated"))}catch(J){throw new k(`Failed to update MCP configuration: ${J instanceof Error?J.message:String(J)}`,"MCP_CONFIG_ERROR")}},mW=async(_)=>{let $=_.server,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1(X))throw new k(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");console.log(""),console.log(M.cyan.bold("▸ Configure MCP Server")),console.log(M.gray(`  Target: ${X}`));let Z=new d1(X),J;if($){if(!Z.getAllServerIds().includes($))throw new k(`Invalid MCP server: ${$}. Available: ${Z.getAllServerIds().join(", ")}`,"INVALID_MCP_SERVER");J=$}else J=(await i.prompt([{type:"list",name:"server",message:"Select server to configure:",choices:Z.getAllServerIds().map((H)=>{let F=K0[H];return{name:`${F.name} - ${F.description}`,value:H}})}])).server;let G=K0[J];if(console.log(M.cyan(`
▸ ${G.name}`)),console.log(M.gray(`  ${G.description}`)),!G.envVars){console.log(M.gray(`
  No configuration needed`));return}await Z.configureServer(J);let Y=h0("Saving configuration...").start();try{await Z.installServers([J]),Y.succeed(M.green("✓ Configuration saved"))}catch(z){throw Y.fail(M.red("Failed to save configuration")),z}},uW=async(_)=>{let $=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1($))throw new k(`Target ${$} does not support MCP servers`,"UNSUPPORTED_TARGET");await CZ(process.cwd(),$)},dW=async(_)=>{let $=_.servers,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1(X))throw new k(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new k("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let Z=Array.isArray($)?$:[$],J=new d1(X),G=J.getAllServerIds(),Y=Z.filter((H)=>!G.includes(H));if(Y.length>0)throw new k(`Invalid MCP servers: ${Y.join(", ")}. Available: ${G.join(", ")}`,"INVALID_MCP_SERVERS");let z=Z;await J.installServers(z)},cW=async(_)=>{let $=_.servers,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1(X))throw new k(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new k("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let J=new d1(X).getInstalledServerIds(),G=$.filter((Y)=>!J.includes(Y));if(G.length>0)throw new k(`MCP servers not installed: ${G.join(", ")}. Installed: ${J.join(", ")}`,"SERVERS_NOT_INSTALLED");console.log(M.yellow("Remove functionality not yet implemented"))},hZ={name:"mcp",description:"Manage MCP (Model Context Protocol) servers",options:[{flags:"--target <type>",description:`Force specific target (${v.getImplementedTargetIDs().join(", ")}, default: opencode)`}],subcommands:[{name:"start",description:"Start Sylphx Flow MCP server with specific configuration",options:[{flags:"--disable-memory",description:"Disable memory functionality"},{flags:"--disable-time",description:"Disable time functionality"},{flags:"--disable-project-startup",description:"Disable project startup functionality"},{flags:"--disable-knowledge",description:"Disable knowledge functionality"},{flags:"--disable-codebase-search",description:"Disable codebase search functionality"}],handler:pW},{name:"config",description:"Configure MCP server settings",options:[{flags:"--server <name>",description:"Configure specific server (shows selection if not provided)"}],handler:mW},{name:"list",description:"List installed MCP servers",options:[],handler:uW},{name:"add",description:"Add MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to add"}],handler:dW},{name:"remove",description:"Remove MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to remove"}],handler:cW}]};var lW=async(_)=>{let X=await new v0().getAll();if(_.namespace&&_.namespace!=="all"){let Z=X.filter((Y)=>Y.namespace===_.namespace);if(console.log(`\uD83D\uDCCB Memory entries in namespace: ${_.namespace}`),console.log(`Total: ${Z.length} entries
`),Z.length===0){console.log("No entries found in this namespace.");return}let J=_.limit||50;Z.slice(0,J).forEach((Y,z)=>{let H=Y.value||"",F=typeof H==="string"?H.substring(0,50)+(H.length>50?"...":""):`${JSON.stringify(H).substring(0,50)}...`;console.log(`${z+1}. ${Y.namespace}:${Y.key}`),console.log(`   Value: ${F}`),console.log(`   Updated: ${Y.updated_at}`),console.log("")})}else{if(console.log(`\uD83D\uDCCB All memory entries (showing first ${_.limit||50}):`),console.log(`Total: ${X.length} entries
`),X.length===0){console.log("No memory entries found.");return}let Z=_.limit||50;X.slice(0,Z).forEach((G,Y)=>{let z=G.value||"",H=typeof z==="string"?z.substring(0,50)+(z.length>50?"...":""):`${JSON.stringify(z).substring(0,50)}...`;console.log(`${Y+1}. ${G.namespace}:${G.key}`),console.log(`   Value: ${H}`),console.log(`   Updated: ${G.updated_at}`),console.log("")})}},iW=async(_)=>{if(!_.pattern)throw new k("Search pattern is required. Use --pattern <pattern>");let X=await new v0().search(_.pattern,_.namespace);if(console.log(`\uD83D\uDD0D Search results for pattern: ${_.pattern}`),_.namespace&&_.namespace!=="all")console.log(`Namespace: ${_.namespace}`);if(console.log(`Found: ${X.length} results
`),X.length===0){console.log("No matching entries found.");return}X.forEach((Z,J)=>{let G=Z.value||"",Y=typeof G==="string"?G.substring(0,50)+(G.length>50?"...":""):`${JSON.stringify(G).substring(0,50)}...`;console.log(`${J+1}. ${Z.namespace}:${Z.key}`),console.log(`   Value: ${Y}`),console.log(`   Updated: ${Z.updated_at}`),console.log("")})},nW=async(_)=>{if(!_.key)throw new k("Key is required. Use --key <key>");if(await new v0().delete(_.key,_.namespace||"default"))console.log(`✓ Deleted memory entry: ${_.namespace||"default"}:${_.key}`);else console.log(`✗ Memory entry not found: ${_.namespace||"default"}:${_.key}`)},oW=async(_)=>{if(!_.confirm)throw new k("Confirmation required. Use --confirm to clear memory entries");let $=new v0;if(_.namespace)await $.clear(_.namespace),console.log(`✓ Cleared all memory entries in namespace: ${_.namespace}`);else await $.clear(),console.log("✓ Cleared all memory entries")},sW=async()=>{let $=await new v0().getStats();if(console.log("\uD83D\uDCCA Memory Statistics"),console.log("=================="),console.log(`Total Entries: ${$.totalEntries}`),console.log(`Namespaces: ${$.namespaces.length}`),console.log(""),$.namespaces.length>0)console.log("Namespaces:"),$.namespaces.forEach((X)=>{console.log(`  • ${X}`)}),console.log("");console.log("\uD83D\uDCCD Database: .sylphx-flow/memory.db")},rW=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("get")+1;if(X>=$.length)throw new k("Usage: flow memory get <key> [--namespace <namespace>]");let Z=$[X],J=_.namespace||"default",Y=await new v0().get(Z,J);if(Y)console.log(`\uD83D\uDCC4 Memory entry: ${J}:${Z}`),console.log(`Value: ${JSON.stringify(Y.value,null,2)}`),console.log(`Created: ${Y.created_at}`),console.log(`Updated: ${Y.updated_at}`);else console.log(`✗ Memory entry not found: ${J}:${Z}`)},aW=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("set")+1,Z=X+1;if(X>=$.length||Z>=$.length)throw new k("Usage: flow memory set <key> <value> [--namespace <namespace>]");let J=$[X],G=$[Z],Y=_.namespace||"default";await new v0().set(J,G,Y),console.log(`✓ Set memory entry: ${Y}:${J} = "${G}"`)},fZ={name:"memory",description:"Manage memory storage (set, get, search, list, delete, clear)",options:[{flags:"--target <type>",description:`Target platform (${v.getImplementedTargets().join(", ")}, default: auto-detect)`}],subcommands:[{name:"list",description:"List memory entries",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"},{flags:"--limit <number>",description:"Limit number of entries (default: 50)"}],handler:lW},{name:"search",description:"Search memory entries",arguments:[{name:"pattern",required:!0,description:"Search pattern"}],options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:iW},{name:"delete",description:"Delete memory entry",arguments:[{name:"key",required:!0,description:"Memory key to delete"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:nW},{name:"clear",description:"Clear memory entries",options:[{flags:"--namespace <name>",description:"Clear specific namespace (default: all)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:oW},{name:"stats",description:"Show memory statistics",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:sW},{name:"get",description:"Get memory entry",arguments:[{name:"key",required:!0,description:"Memory key to retrieve"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:rW},{name:"set",description:"Set memory entry",arguments:[{name:"key",description:"Memory key",required:!0},{name:"value",description:"Memory value",required:!0}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:aW}]};import*as _6 from"node:fs";import*as U2 from"node:path";import tW from"node:crypto";import w5 from"node:fs";function bZ(_){let $=_.migrationsFolder,X=[],Z=`${$}/meta/_journal.json`;if(!w5.existsSync(Z))throw Error("Can't find meta/_journal.json file");let J=w5.readFileSync(`${$}/meta/_journal.json`).toString(),G=JSON.parse(J);for(let Y of G.entries){let z=`${$}/${Y.tag}.sql`;try{let H=w5.readFileSync(`${$}/${Y.tag}.sql`).toString(),F=H.split("--> statement-breakpoint").map((W)=>{return W});X.push({sql:F,bps:Y.breakpoints,folderMillis:Y.when,hash:tW.createHash("sha256").update(H).digest("hex")})}catch{throw Error(`No file ${z} found in ${$} folder`)}}return X}async function gZ(_,$){let X=bZ($),Z=$.migrationsTable??"__drizzle_migrations",J=U`
		CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
			id SERIAL PRIMARY KEY,
			hash text NOT NULL,
			created_at numeric
		)
	`;await _.session.run(J);let Y=(await _.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0,z=[];for(let H of X)if(!Y||Number(Y[2])<H.folderMillis){for(let F of H.sql)z.push(_.run(U.raw(F)));z.push(_.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${H.hash}, ${H.folderMillis})`))}await _.session.migrate(z)}var K8={};F6(K8,{tfidfTerms:()=>M0,tfidfIdf:()=>e2,tfidfDocuments:()=>F2,memory:()=>p,codebaseMetadata:()=>W2,codebaseFiles:()=>o});var p=Q0("memory",{key:S("key").notNull(),namespace:S("namespace").notNull().default("default"),value:S("value").notNull(),timestamp:S0("timestamp").notNull(),created_at:S("created_at").notNull(),updated_at:S("updated_at").notNull()},(_)=>({pk:i2({columns:[_.key,_.namespace]}),namespaceIdx:R0("idx_memory_namespace").on(_.namespace),timestampIdx:R0("idx_memory_timestamp").on(_.timestamp),keyIdx:R0("idx_memory_key").on(_.key)})),o=Q0("codebase_files",{path:S("path").primaryKey(),mtime:S0("mtime").notNull(),hash:S("hash").notNull(),content:S("content"),language:S("language"),size:S0("size"),indexedAt:S("indexed_at").notNull()},(_)=>({mtimeIdx:R0("idx_codebase_files_mtime").on(_.mtime),hashIdx:R0("idx_codebase_files_hash").on(_.hash)})),M0=Q0("tfidf_terms",{filePath:S("file_path").notNull().references(()=>o.path,{onDelete:"cascade"}),term:S("term").notNull(),frequency:F1("frequency").notNull()},(_)=>({termIdx:R0("idx_tfidf_terms_term").on(_.term),fileIdx:R0("idx_tfidf_terms_file").on(_.filePath)})),F2=Q0("tfidf_documents",{filePath:S("file_path").primaryKey().references(()=>o.path,{onDelete:"cascade"}),magnitude:F1("magnitude").notNull(),termCount:S0("term_count").notNull(),rawTerms:S("raw_terms").notNull()}),e2=Q0("tfidf_idf",{term:S("term").primaryKey(),idfValue:F1("idf_value").notNull()}),W2=Q0("codebase_metadata",{key:S("key").primaryKey(),value:S("value").notNull()});class P5{client;db;constructor(){try{let _=U2.join(process.cwd(),".sylphx-flow");if(!_6.existsSync(_))_6.mkdirSync(_,{recursive:!0});let $=U2.join(_,"memory.db");this.client=m1({url:`file:${$}`}),this.db=r2(this.client,{schema:K8})}catch(_){throw new N_("Failed to initialize database connection",{url:`file:${U2.join(process.cwd(),".sylphx-flow/memory.db")}`},_)}}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){if(console.error("[INFO] Database tables already exist, checking migration state"),(await this.client.execute(`
          SELECT name FROM sqlite_master 
          WHERE type='table' AND name='__drizzle_migrations'
        `)).rows.length===0)await this.client.execute(`
            CREATE TABLE IF NOT EXISTS __drizzle_migrations (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              hash text NOT NULL UNIQUE,
              created_at numeric NOT NULL DEFAULT (strftime('%s', 'now'))
            )
          `),await this.client.execute(`
            INSERT OR IGNORE INTO __drizzle_migrations (hash, created_at) 
            VALUES ('0000_wooden_lady_bullseye', strftime('%s', 'now'))
          `),console.error("[INFO] Migration tracking initialized for existing tables");return}let $=U2.join(process.cwd(),"drizzle");if(_6.existsSync($))await gZ(this.db,{migrationsFolder:$}),console.error("[INFO] Database migrations completed");else console.error("[WARN] No migrations folder found, using fallback table creation"),await this.createTablesFallback()}catch(_){let $=`Migration failed: ${_.message}`;console.error("[ERROR]",$);try{await this.createTablesFallback(),console.error("[WARN] Fallback table creation completed")}catch(X){throw new G0("Both migration and fallback failed","initialize",X,{originalError:_.message})}}}async createTablesFallback(){console.error("[INFO] Using fallback table creation")}async close(){}getDatabasePath(){let _=U2.join(process.cwd(),".sylphx-flow");return U2.join(_,"memory.db")}async getMigrationStatus(){try{let _=await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name IN ('memory', 'codebase_files', 'tfidf_terms')
      `);return{isMigrated:_.rows.length>=2,migrationCount:_.rows.length}}catch(_){throw new G0("Failed to check migration status","getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}}class x5{drizzleDb;db;constructor(){this.drizzleDb=new P5,this.db=this.drizzleDb.db}async initialize(){await this.drizzleDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch{return _}}async set(_,$,X="default"){if(!_||typeof _!=="string")throw new I6("Key must be a non-empty string","key",_);if(!X||typeof X!=="string")throw new I6("Namespace must be a non-empty string","namespace",X);await n("memory.set",async()=>{let Z=new Date,J=Z.getTime(),G=Z.toISOString(),Y=G,z=this.safeSerialize($);if(await this.get(_,X))await this.db.update(p).set({value:z,timestamp:J,updated_at:Y}).where(O0(w(p.key,_),w(p.namespace,X)));else{let F={key:_,namespace:X,value:z,timestamp:J,created_at:G,updated_at:Y};await this.db.insert(p).values(F)}},{key:_,namespace:X})}async get(_,$="default"){let X=await this.db.select().from(p).where(O0(w(p.key,_),w(p.namespace,$))).limit(1);if(X.length===0)return null;let Z=X[0];return{key:Z.key,namespace:Z.namespace,value:this.safeDeserialize(Z.value),timestamp:Z.timestamp,created_at:Z.created_at,updated_at:Z.updated_at}}async getAll(){return(await this.db.select().from(p).orderBy(g0(p.timestamp))).map(($)=>({key:$.key,namespace:$.namespace,value:this.safeDeserialize($.value),timestamp:$.timestamp,created_at:$.created_at,updated_at:$.updated_at}))}async search(_,$){if(!_||typeof _!=="string")throw Error("Search pattern must be a non-empty string");let X=_.replace(/[^a-zA-Z0-9\s*_\-]/g,"");if(X!==_)throw Error("Search pattern contains invalid characters");let Z=X.replace(/\*/g,"%"),J=Z1(p.key,Z);if($&&$!=="all"){if(!/^[a-zA-Z0-9_\-]+$/.test($))throw Error("Namespace contains invalid characters");J=O0(J,w(p.namespace,$))}return(await this.db.select().from(p).where(J).orderBy(g0(p.timestamp)).limit(1000)).map((Y)=>({key:Y.key,namespace:Y.namespace,value:this.safeDeserialize(Y.value),timestamp:Y.timestamp,created_at:Y.created_at,updated_at:Y.updated_at}))}async delete(_,$="default"){return(await this.db.delete(p).where(O0(w(p.key,_),w(p.namespace,$)))).rowsAffected>0}async clear(_){if(_&&_!=="all")await this.db.delete(p).where(w(p.namespace,_));else await this.db.delete(p)}async getStats(){let[_,$,X,Z]=await Promise.all([this.db.select({count:i0()}).from(p),this.db.select({namespace:p.namespace,count:i0()}).from(p).groupBy(p.namespace).orderBy(p.namespace),this.db.select({created_at:p.created_at}).from(p).orderBy(p.created_at).limit(1),this.db.select({created_at:p.created_at}).from(p).orderBy(g0(p.created_at)).limit(1)]),J=_[0]?.count||0,G=$.map((F)=>F.namespace),Y=Object.fromEntries($.map((F)=>[F.namespace,F.count])),z=X[0]?.created_at||null,H=Z[0]?.created_at||null;return{totalEntries:J,namespaces:G,namespaceCounts:Y,oldestEntry:z,newestEntry:H}}async load(){let _=await this.getAll(),$={};return _.forEach((X)=>{if(!$[X.namespace])$[X.namespace]={};$[X.namespace][X.key]=X.value}),{namespaces:$}}async close(){await this.drizzleDb.close()}getDatabasePath(){return this.drizzleDb.getDatabasePath()}async setCodebaseMetadata(_,$){let X=this.safeSerialize($);await this.db.insert(W2).values({key:_,value:X}).onConflictDoUpdate({target:W2.key,set:{value:X}})}async getCodebaseMetadata(_){let $=await this.db.select().from(W2).where(w(W2.key,_)).limit(1);if($.length===0)return null;return this.safeDeserialize($[0].value)}async upsertCodebaseFile(_){let $=new Date().toISOString();await this.db.insert(o).values({path:_.path,mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}).onConflictDoUpdate({target:o.path,set:{mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}})}async getCodebaseFile(_){let $=await this.db.select().from(o).where(w(o.path,_)).limit(1);return $.length>0?$[0]:null}async getAllCodebaseFiles(){return await this.db.select({path:o.path,mtime:o.mtime,hash:o.hash,content:o.content,language:o.language,size:o.size,indexedAt:o.indexedAt}).from(o).orderBy(o.path)}async deleteCodebaseFile(_){await this.db.delete(o).where(w(o.path,_))}async upsertTFIDFDocument(_,$){await this.db.insert(F2).values({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}).onConflictDoUpdate({target:F2.filePath,set:{magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}})}async getTFIDFDocument(_){let $=await this.db.select().from(F2).where(w(F2.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{...X,rawTerms:this.safeDeserialize(X.rawTerms)}}async setTFIDFTerms(_,$){if(await this.db.delete(M0).where(w(M0.filePath,_)),Object.keys($).length>0){let X=Object.entries($).map(([J,G])=>({filePath:_,term:J,frequency:G})),Z=100;for(let J=0;J<X.length;J+=100){let G=X.slice(J,J+100);await this.db.insert(M0).values(G)}}}async getTFIDFTerms(_){let $=await this.db.select().from(M0).where(w(M0.filePath,_)),X={};return $.forEach((Z)=>{X[Z.term]=Z.frequency}),X}async setIDFValues(_){if(await this.db.delete(e2),Object.keys(_).length>0){let $=Object.entries(_).map(([Z,J])=>({term:Z,idfValue:J})),X=100;for(let Z=0;Z<$.length;Z+=100){let J=$.slice(Z,Z+100);await this.db.insert(e2).values(J)}}}async getIDFValues(){let _=await this.db.select().from(e2),$={};return _.forEach((X)=>{$[X.term]=X.idfValue}),$}async getCodebaseIndexStats(){let $=(await this.db.select({count:o.path}).from(o)).length,Z=(await this.db.selectDistinct({term:M0.term}).from(M0)).length,[J,G]=await Promise.all([this.getCodebaseMetadata("indexedAt"),this.getCodebaseMetadata("version")]);return{fileCount:$,termCount:Z,indexedAt:J,version:G}}async clearCodebaseIndex(){await Promise.all([this.db.delete(o),this.db.delete(M0),this.db.delete(F2),this.db.delete(e2),this.db.delete(W2)])}async searchTFIDFTerms(_){if(!_||typeof _!=="string")throw Error("Term pattern must be a non-empty string");let $=_.replace(/[^a-zA-Z0-9\s_\-]/g,"");if($!==_)throw Error("Term pattern contains invalid characters");let X=`%${$}%`;return await this.db.select({path:o.path,term:M0.term,frequency:M0.frequency,language:o.language}).from(M0).innerJoin(o,w(M0.filePath,o.path)).where(Z1(M0.term,X)).orderBy(g0(M0.frequency)).limit(100)}}class pZ{memory;entries=[];running=!0;constructor(){this.memory=new x5}async start(){console.clear(),console.log(M.cyan.bold("\uD83E\uDDE0 Memory Manager")),console.log(M.gray(`Interactive memory management for Sylphx Flow
`)),await this.loadEntries();while(this.running)try{await this.showMainMenu()}catch(_){console.error(M.red(`Error: ${_}`)),await i.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}async loadEntries(){try{this.entries=await this.memory.getAll(),this.entries.sort((_,$)=>new Date($.updated_at).getTime()-new Date(_.updated_at).getTime())}catch(_){console.error(M.red(`Failed to load entries: ${_}`)),this.entries=[]}}async showMainMenu(){if(this.entries.length===0){console.log(M.yellow("No memory entries found."));let{action:X}=await i.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:[{name:"➕ Add new entry",value:"add"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh"},{name:"✗ Exit",value:"exit"}]}]);if(X==="add")await this.showAddEntry();else if(X==="refresh")await this.loadEntries();else this.running=!1;return}let _=[{name:"\uD83D\uDCDD View entry details",value:"view",short:"View"},{name:"✏️ Edit entry",value:"edit",short:"Edit"},{name:"➕ Add new entry",value:"add",short:"Add"},{name:"\uD83D\uDDD1️ Delete entry",value:"delete",short:"Delete"},{name:"\uD83D\uDD0D Search entries",value:"search",short:"Search"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh",short:"Refresh"},{name:"✗ Exit",value:"exit",short:"Exit"}],{action:$}=await i.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:_}]);switch($){case"view":await this.showViewEntry();break;case"edit":await this.showEditEntry();break;case"add":await this.showAddEntry();break;case"delete":await this.showDeleteEntry();break;case"search":await this.showSearchEntries();break;case"refresh":await this.loadEntries(),console.log(M.green("✓ Entries refreshed"));break;case"exit":this.running=!1;break}}async selectEntry(_,$=!1){if(this.entries.length===0){if($)return null;throw Error("No entries available")}let X=this.entries.map((J,G)=>({value:J,name:`${M.cyan(`${G+1}.`)} ${M.bold(J.namespace)}:${M.bold(J.key)}`,short:`${J.namespace}:${J.key}`}));if($)X.unshift({name:"← Back to menu",value:null,short:"Back"});let{selected:Z}=await i.prompt([{type:"list",name:"selected",message:_,choices:X,pageSize:15}]);return Z}async showViewEntry(){let _=await this.selectEntry("Select entry to view:",!0);if(!_)return;console.clear(),console.log(M.cyan.bold("\uD83D\uDCC4 Entry Details")),console.log(M.gray("─".repeat(50))),console.log(M.blue.bold("Namespace:"),_.namespace),console.log(M.blue.bold("Key:"),_.key),console.log(M.blue.bold("Updated:"),_.updated_at),console.log(M.blue.bold(`
Value:`));let $=JSON.stringify(_.value,null,2);console.log(M.gray($)),await i.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showEditEntry(){let _=await this.selectEntry("Select entry to edit:",!0);if(!_)return;console.clear(),console.log(M.yellow.bold("✏️ Edit Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Editing:")} ${_.namespace}:${_.key}
`);let $=await i.prompt([{type:"input",name:"namespace",message:"Namespace:",default:_.namespace,validate:(X)=>X.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",default:_.key,validate:(X)=>X.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:JSON.stringify(_.value,null,2),validate:(X)=>{try{return JSON.parse(X),!0}catch{return"Invalid JSON format"}}}]);try{let X=JSON.parse($.value);if(await this.memory.set($.key,X,$.namespace),$.namespace!==_.namespace||$.key!==_.key)await this.memory.delete(_.key,_.namespace);await this.loadEntries(),console.log(M.green(`✓ Updated ${$.namespace}:${$.key}`))}catch(X){console.error(M.red(`Failed to update entry: ${X}`))}await i.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showAddEntry(){console.clear(),console.log(M.green.bold("➕ Add New Entry")),console.log(M.gray("─".repeat(50)));let _=await i.prompt([{type:"input",name:"namespace",message:"Namespace:",default:"default",validate:($)=>$.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",validate:($)=>$.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:`{
  
}`,validate:($)=>{try{return JSON.parse($),!0}catch{return"Invalid JSON format"}}}]);try{let $=JSON.parse(_.value);await this.memory.set(_.key,$,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Added ${_.namespace}:${_.key}`))}catch($){console.error(M.red(`Failed to add entry: ${$}`))}await i.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showDeleteEntry(){let _=await this.selectEntry("Select entry to delete:",!0);if(!_)return;console.clear(),console.log(M.red.bold("\uD83D\uDDD1️ Delete Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Entry:")} ${_.namespace}:${_.key}`);let $=JSON.stringify(_.value),X=$.length>100?$.substring(0,100)+"...":$;console.log(`${M.blue("Value:")} ${M.gray(X)}`);let{confirmed:Z}=await i.prompt([{type:"confirm",name:"confirmed",message:M.yellow("Are you sure you want to delete this entry?"),default:!1}]);if(Z)try{await this.memory.delete(_.key,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Deleted ${_.namespace}:${_.key}`))}catch(J){console.error(M.red(`Failed to delete entry: ${J}`))}else console.log(M.gray("Delete cancelled"));await i.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showSearchEntries(){console.clear(),console.log(M.magenta.bold("\uD83D\uDD0D Search Entries")),console.log(M.gray("─".repeat(50)));let{query:_}=await i.prompt([{type:"input",name:"query",message:"Search query:",validate:(X)=>X.trim().length>0||"Search query is required"}]),$=this.entries.filter((X)=>X.namespace.toLowerCase().includes(_.toLowerCase())||X.key.toLowerCase().includes(_.toLowerCase())||JSON.stringify(X.value).toLowerCase().includes(_.toLowerCase()));if($.length===0)console.log(M.yellow("No entries found matching your search."));else console.log(M.cyan(`
Found ${$.length} matching entries:
`)),$.forEach((X,Z)=>{let J=JSON.stringify(X.value),G=J.length>80?J.substring(0,80)+"...":J;console.log(`${M.cyan(`${Z+1}.`)} ${M.bold(X.namespace)}:${M.bold(X.key)}`),console.log(`   ${M.gray(G)}
`)});await i.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}var mZ=async()=>{await new pZ().start()};var q5=async()=>{await mZ()},ST={name:"memory-tui",description:"Launch interactive memory management TUI",options:[{flags:"--target <type>",description:`Target platform (${v.getImplementedTargets().join(", ")}, default: auto-detect)`}],handler:q5};import uZ from"node:fs/promises";import dZ from"node:path";async function eW(_){if(_.target=await v.resolveTarget({target:_.target,allowSelection:!0}),!_.agent)_.agent="builder"}async function _U(_){try{let $=dZ.join(process.cwd(),"agents",`${_}.md`);try{return await uZ.readFile($,"utf-8")}catch(X){let Z=O8(),J=dZ.join(Z,`${_}.md`);return await uZ.readFile(J,"utf-8")}}catch($){throw new k(`Agent '${_}' not found`,"AGENT_NOT_FOUND")}}function $U(_){let $=/^---\s*\n[\s\S]*?\n---\s*\n/,X=_.match($);if(X)return _.substring(X[0].length).trim();return _.trim()}function XU(_,$,X,Z){let J=v.getTarget(_);if(!J)throw new k(`Target not found: ${_}`,"TARGET_NOT_FOUND");if(!J.isImplemented)throw new k(`Target '${_}' is not implemented. Supported targets: ${cZ().join(", ")}`,"TARGET_NOT_IMPLEMENTED");if(!J.executeCommand)throw new k(`Target '${_}' does not support command execution. Supported targets: ${cZ().join(", ")}`,"EXECUTION_NOT_SUPPORTED");return J.executeCommand($,X,Z)}function cZ(){return v.getImplementedTargetIDs().filter((_)=>{return v.getTarget(_)?.executeCommand!==void 0})}var lZ={name:"run",description:"Run a prompt with a specific agent (default: sparc-orchestrator) using the detected or specified target",options:[{flags:"--target <name>",description:`Target platform (${v.getImplementedTargetIDs().join(", ")}, default: auto-detect)`},{flags:"--agent <name>",description:"Agent to use (default: sparc-orchestrator)"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without executing the command"}],arguments:[{name:"prompt",description:"The prompt to execute with the agent (optional - if not provided, will start Claude Code interactively)",required:!1}],handler:async(_)=>{await eW(_);let{prompt:$,agent:X,verbose:Z}=_;if(Z){if(console.log("\uD83D\uDE80 Sylphx Flow Run"),console.log("===================="),console.log(`\uD83C\uDFAF Target: ${_.target}`),console.log(`\uD83E\uDD16 Agent: ${X}`),$)console.log(`\uD83D\uDCAC Prompt: ${$}`);else console.log("\uD83D\uDCAC Prompt: [Interactive mode]");console.log("")}let J=await _U(X),Y=`AGENT INSTRUCTIONS:
${$U(J)}`,z="";if($&&$.trim()!=="")z=$;if(Z)if(console.log("\uD83D\uDCDD System Prompt:"),console.log("================"),console.log(Y.substring(0,500)+(Y.length>500?"...":"")),console.log(""),z.trim()!=="")console.log("\uD83D\uDCDD User Prompt:"),console.log("=============="),console.log(z.substring(0,500)+(z.length>500?"...":"")),console.log("");else console.log("\uD83D\uDCDD User Prompt: [Interactive mode - Claude will greet the user]"),console.log("");await XU(_.target,Y,z,_)}};import c from"node:fs/promises";import X0 from"node:path";import{spawn as nZ}from"node:child_process";class j1{static instance;childProcesses=new Set;isShuttingDown=!1;static getInstance(){if(!j1.instance)j1.instance=new j1,j1.instance.setupSignalHandlers();return j1.instance}setupSignalHandlers(){let _=async($)=>{if(this.isShuttingDown)return;this.isShuttingDown=!0,console.log(`
\uD83D\uDED1 Received ${$}, shutting down benchmark...`),await this.killAllProcesses(),process.exit(0)};process.on("SIGINT",()=>_("SIGINT")),process.on("SIGTERM",()=>_("SIGTERM")),process.on("SIGHUP",()=>_("SIGHUP"))}trackChildProcess(_){this.childProcesses.add(_),_.on("exit",()=>{this.childProcesses.delete(_)})}async killAllProcesses(){console.log("\uD83D\uDD04 Terminating all running processes...");let _=Array.from(this.childProcesses).map(async($)=>{try{if($&&!$.killed)$.kill("SIGTERM"),setTimeout(()=>{if(!$.killed)$.kill("SIGKILL")},2000)}catch(X){console.warn("⚠️ Error killing child process:",X)}});await Promise.all(_),this.childProcesses.clear(),console.log("✅ All processes terminated")}}class oZ{agents=new Map;updateInterval;isRunning=!1;constructor(){this.setupSignalHandlers()}start(){this.isRunning=!0,console.log(`\uD83C\uDFAF Agent Benchmark Monitor - Real-time Console Output
`),this.updateInterval=setInterval(()=>{this.display()},500)}addAgent(_){this.agents.set(_,{status:"idle",output:[],startTime:void 0})}updateAgentStatus(_,$){let X=this.agents.get(_);if(X){if(X.status=$,$==="running"&&!X.startTime)X.startTime=Date.now();else if($==="completed"||$==="error")X.endTime=Date.now()}}addAgentOutput(_,$){let X=this.agents.get(_);if(X){let Z=$.split(`
`).filter((J)=>J.trim());X.output=[...X.output.slice(-4),...Z]}}display(){process.stdout.write("\x1B[2J\x1B[H"),console.log(`\uD83C\uDFAF Agent Benchmark Monitor - Real-time Console Output
`);for(let[_,$]of this.agents){let X=0;if($.startTime){if($.endTime)X=Math.floor(($.endTime-$.startTime)/1000);else if($.status==="running")X=Math.floor((Date.now()-$.startTime)/1000)}let Z=$.status==="completed"?"✅":$.status==="running"?"\uD83D\uDD04":$.status==="error"?"❌":"⏸️",J=$.startTime?`${X}s`:"pending";if(console.log(`${Z} ${_} - ${$.status.toUpperCase()} - Runtime: ${J}`),$.output.length>0)$.output.slice(-5).forEach((Y)=>{let z=Y.trim();if(z&&!z.startsWith("[")&&z.length>5)console.log(`    ${z}`)});else if($.status==="running")console.log("    (working...)");else if($.status==="idle")console.log("    (waiting to start...)");console.log("")}}stop(){if(this.isRunning=!1,this.updateInterval)clearInterval(this.updateInterval)}setupSignalHandlers(){let _=async($)=>{if(!this.isRunning)return;console.log(`
\uD83D\uDED1 Received ${$}, shutting down benchmark...`),this.stop(),await j1.getInstance().killAllProcesses(),process.exit(0)};process.on("SIGINT",()=>_("SIGINT")),process.on("SIGTERM",()=>_("SIGTERM")),process.on("SIGHUP",()=>_("SIGHUP"))}}var D8=["craftsman","practitioner","craftsman-reflective","practitioner-reflective"];async function ZU(_){if(!_.task)_.task="examples/benchmark-tasks/user-management-system.md";try{await c.access(_.task)}catch{throw new k(`Task file not found: ${_.task}`)}if(!_.output){let $=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);_.output=`/tmp/agent-benchmark-${$}`}if(!_.agents)_.agents="all";if(!_.context)_.context="";if(_.evaluate===void 0)_.evaluate=!0;if(!_.concurrency)_.concurrency=1;if(!_.delay)_.delay=2}async function JU(_){try{await c.mkdir(_,{recursive:!0}),console.log(`\uD83D\uDCC1 Created benchmark directory: ${_}`)}catch($){throw new k(`Failed to create benchmark directory: ${$}`)}}async function GU(_,$,X){let Z=await c.readFile(_,"utf-8");if(await c.writeFile(X0.join(X,"task-definition.txt"),Z),$)try{let J=await c.readFile($,"utf-8");await c.writeFile(X0.join(X,"context-info.txt"),J),console.log(`\uD83D\uDCC4 Copied context file: ${$}`)}catch(J){console.warn(`⚠️  Warning: Could not read context file: ${J}`)}console.log(`\uD83D\uDCCB Task definition copied from: ${_}`)}async function YU(_){if(_==="all")return D8;let $=_.split(",").map((X)=>X.trim());for(let X of $)if(!D8.includes(X))throw new k(`Invalid agent: ${X}. Available agents: ${D8.join(", ")}`);return $}async function iZ(_,$,X,Z,J,G,Y=3){let z=X0.join($,_);await c.mkdir(z,{recursive:!0});let H=O8(),F=X0.join(H,`${_}.md`);try{let W=await c.readFile(F,"utf-8"),A=await c.readFile(X,"utf-8"),K=A;if(Z)try{K=`CONTEXT:
${await c.readFile(Z,"utf-8")}

TASK:
${A}`}catch(R){console.warn(`⚠️  Warning: Could not read context file: ${R}`)}K+=`

IMPORTANT: Please implement your solution in the current working directory: ${z}
This is a temporary directory for testing, so you can create files freely without affecting any production codebase.`,console.log(`\uD83D\uDE80 Running agent: ${_} in ${z}`),console.log(`\uD83D\uDCDD Claude command: claude --system-prompt [${W.length} chars] --dangerously-skip-permissions --print [${K.length} chars]`),await(async()=>{let R=X0.join(z,".agent-prompt.md");return await c.writeFile(R,W),new Promise((N,I)=>{let P=nZ("claude",["--system-prompt",`@${R}`,"--dangerously-skip-permissions","--print",K],{cwd:z,stdio:["inherit","pipe","pipe"]});j1.getInstance().trackChildProcess(P);let E="",j="";P.stdout?.on("data",(b)=>{let f=b.toString();if(E+=f,J?.addOutput(_,f),G?.(_,f),!G)process.stdout.write(`[${_}] ${f}`)}),P.stderr?.on("data",(b)=>{let f=b.toString();if(j+=f,J?.addOutput(_,`ERROR: ${f}`),G?.(_,`ERROR: ${f}`),!G)process.stderr.write(`[${_} ERROR] ${f}`)}),P.on("close",async(b)=>{let f=Date.now();try{await c.unlink(R)}catch(w0){}let T=`Execution completed at: ${new Date(f).toISOString()}
Exit code: ${b}

=== STDOUT ===
${E}

=== STDERR ===
${j}
`;await c.writeFile(X0.join(z,"execution-log.txt"),T);let g={endTime:f,exitCode:b,stdoutLength:E.length,stderrLength:j.length};if(await c.writeFile(X0.join(z,"timing.json"),JSON.stringify(g,null,2)),b===0)console.log(`✅ Agent ${_} completed successfully`),N();else await c.writeFile(X0.join(z,"execution-error.txt"),j),I(Error(`Agent ${_} failed with code ${b}`))}),P.on("error",(b)=>{I(b)})})})()}catch(W){throw new k(`Failed to load agent ${_}: ${W}`)}}async function zU(_,$,X){console.log("\uD83D\uDD0D Evaluating code created by agents...");let Z={},J=D8.map((K)=>X0.join(_,K));for(let K of J){let D=X0.basename(K);try{let R=X0.join(K,"execution-time.txt"),I=(await c.readFile(R,"utf-8")).match(/Duration:\s*(\d+)\s*seconds/),P=I?parseInt(I[1]):0;Z[D]={duration:P}}catch(R){try{let N=X0.join(K,"timing.json"),I=await c.readFile(N,"utf-8"),P=JSON.parse(I);Z[D]={duration:0}}catch(N){Z[D]={duration:0}}}}let G=`
Please evaluate the code and solutions created by these software engineering agents. For each agent, analyze their work by examining the files they created in their respective directories.

**IMPORTANT: Performance and timing are critical evaluation factors.** Faster execution times that maintain quality are highly valued.

For each agent, evaluate:

1. **Performance & Speed** (1-10): Execution time, efficiency, how quickly they completed the task
2. **Code Quality** (1-10): Readability, structure, naming conventions, code organization
3. **Architecture Design** (1-10): Modularity, scalability, separation of concerns, best practices
4. **Functionality** (1-10): Requirements satisfaction, error handling, feature completeness
5. **Testing Coverage** (1-10): Test quality, coverage, testing strategies used
6. **Documentation** (1-10): Code comments, README files, API documentation, setup instructions
7. **Business Value** (1-10): Practicality, maintainability, innovation, solution effectiveness

**Scoring Guidelines for Performance:**
- 9-10: Extremely fast (under 5 seconds), excellent efficiency
- 7-8: Fast (5-10 seconds), good optimization
- 5-6: Average (10-20 seconds), acceptable speed
- 3-4: Slow (20-30 seconds), needs optimization
- 1-2: Very slow (30+ seconds), significant performance issues

**Approximate Timing Data:**
${Object.entries(Z).map(([K,D])=>`- ${K}: ${D.duration||"unknown"} seconds`).join(`
`)}

Agents to evaluate:
- craftsman: Idealistic craftsman with principles-based approach
- practitioner: Pragmatic practitioner with business-focused approach
- craftsman-reflective: Idealistic craftsman with reflective questioning
- practitioner-reflective: Pragmatic practitioner with contextual decision-making

For each agent, please:
1. Examine all files they created in their directory
2. Analyze the code quality and architecture
3. Check if requirements were met
4. **CRITICAL: Consider their execution speed and efficiency**
5. Evaluate the overall solution quality
6. Compare approaches between agents

Please provide:
1. Detailed scoring for each agent (1-10 scale) with special attention to performance
2. Analysis of differences between approaches, including speed vs quality tradeoffs
3. What each agent excels at (including speed advantages)
4. Recommendations for different use cases (when speed matters vs when quality matters more)
5. Overall comparison and insights with performance as a key factor

Format your response as a structured evaluation report with clear sections for each agent.
`,Y={};for(let K of J){let D=X0.basename(K);try{let R=await c.readdir(K),N=`=== ${D} WORK ===

`;for(let I of R){let P=X0.join(K,I);if((await c.stat(P)).isFile()){let j=await c.readFile(P,"utf-8");N+=`
--- File: ${I} ---
${j}
`}}Y[D]=N}catch(R){Y[D]=`=== ${D} WORK ===

ERROR: Could not read files - ${R}`}}let z=Object.values(Y).join(`
`+"=".repeat(80)+`
`),H=G+`

AGENT WORK TO EVALUATE:
`+z,F=X0.join(_,".evaluation-prompt.md");await c.writeFile(F,H);let W=nZ("claude",["--system-prompt",`@${F}`,"--dangerously-skip-permissions","--print","Please evaluate the agent work as described in the system prompt."],{cwd:_,stdio:["inherit","pipe","pipe"]});j1.getInstance().trackChildProcess(W);let A="";return W.stdout?.on("data",(K)=>{A+=K.toString()}),new Promise((K,D)=>{W.on("close",async(R)=>{if(R===0){let N=X0.join(_,"evaluation-report.md");await c.writeFile(N,A);let I=Object.entries(Y).map(([E,j])=>{let b=(j.match(/--- File: /g)||[]).length;return`${E}: ${b} files created`}).join(`
`),P=X0.join(_,"summary.txt");await c.writeFile(P,I);try{await c.unlink(F)}catch(E){}if(console.log("\uD83D\uDCCA Evaluation completed"),console.log(`\uD83D\uDCC4 Report saved to: ${N}`),$){let E=X0.join(process.cwd(),$,"evaluation-report.md"),j=X0.join(process.cwd(),$,"summary.txt");await c.mkdir(X0.dirname(E),{recursive:!0}),await c.writeFile(E,A),await c.writeFile(j,I),console.log(`\uD83D\uDCC4 Report also saved to: ${E}`)}console.log("\uD83D\uDCCB Summary of created files saved"),K()}else D(Error(`Evaluation failed with code ${R}`))}),W.on("error",(R)=>{D(R)})})}async function HU(_,$,X,Z,J,G,Y=!1){console.log(`\uD83D\uDD04 Running ${_.length} agents with concurrency: ${J}, delay: ${G}s`);let z;if(Y)z=new oZ,z.start(),_.forEach((H)=>{z.addAgent(H)});if(J<=1){console.log("\uD83D\uDCDD Running agents sequentially...");for(let H of _)try{let F=Date.now();z?.updateAgentStatus(H,"running"),await iZ(H,$,X,Z,void 0,(K,D)=>{z?.addAgentOutput(K,D)});let W=Date.now(),A=Math.floor((W-F)/1000);try{await c.writeFile(X0.join($,H,"execution-time.txt"),`Started: ${new Date(F).toISOString()}
Completed: ${new Date(W).toISOString()}
Duration: ${A} seconds
`)}catch(K){}if(z?.updateAgentStatus(H,"completed"),H!==_[_.length-1])console.log(`⏳ Waiting ${G}s before next agent...`),await new Promise((K)=>setTimeout(K,G*1000))}catch(F){z?.updateAgentStatus(H,"error"),z?.addAgentOutput(H,`❌ ERROR: ${F}`),console.error(`❌ Agent ${H} failed:`,F)}}else{let H=[];for(let F=0;F<_.length;F+=J)H.push(_.slice(F,F+J));for(let F=0;F<H.length;F++){console.log(`\uD83D\uDD04 Running chunk ${F+1}/${H.length} (${H[F].length} agents)...`);let W={};H[F].forEach((K)=>{W[K]=Date.now(),z?.updateAgentStatus(K,"running")});let A=H[F].map((K)=>iZ(K,$,X,Z,void 0,(D,R)=>{z?.addAgentOutput(D,R)}));try{await Promise.all(A);let K=Date.now();H[F].forEach((D)=>{let R=W[D],N=Math.floor((K-R)/1000);try{c.writeFile(X0.join($,D,"execution-time.txt"),`Started: ${new Date(R).toISOString()}
Completed: ${new Date(K).toISOString()}
Duration: ${N} seconds (parallel execution)
`).catch(()=>{})}catch(I){}z?.updateAgentStatus(D,"completed")}),console.log(`✅ Chunk ${F+1} completed`)}catch(K){H[F].forEach((D)=>{z?.updateAgentStatus(D,"error"),z?.addAgentOutput(D,`❌ ERROR: ${K}`)}),console.error(`❌ Chunk ${F+1} had failures:`,K)}if(F<H.length-1)console.log(`⏳ Waiting ${G}s before next chunk...`),await new Promise((K)=>setTimeout(K,G*1000))}}if(z)z.stop();console.log("✅ All agent executions completed")}var sZ={name:"benchmark",description:"Run benchmark tests comparing multiple agent designs",options:[{flags:"--agents <agents>",description:'Agents to test (comma-separated or "all")',defaultValue:"all"},{flags:"--task <file>",description:"Path to task definition file",defaultValue:"examples/benchmark-tasks/user-management-system.md"},{flags:"--output <dir>",description:"Output directory for results"},{flags:"--context <file>",description:"Path to context information file (optional)"},{flags:"--no-evaluate",description:"Skip LLM evaluation after agents complete"},{flags:"--report <dir>",description:"Directory to save evaluation reports",defaultValue:"benchmark-results"},{flags:"--concurrency <number>",description:"Number of agents to run concurrently",defaultValue:"1"},{flags:"--delay <seconds>",description:"Delay in seconds between agent executions",defaultValue:"2"},{flags:"--quiet",description:"Disable real-time monitoring, show minimal output"}],handler:async(_)=>{try{await ZU(_),console.log("\uD83C\uDFAF Starting agent benchmark test"),console.log(`\uD83D\uDCC1 Output directory: ${_.output}`),await JU(_.output),await GU(_.task,_.context,_.output);let $=await YU(_.agents);if(console.log(`\uD83E\uDD16 Testing agents: ${$.join(", ")}`),await HU($,_.output,_.task,_.context,_.concurrency,_.delay,_.quiet!==!0),_.evaluate)await zU(_.output,_.report,_);console.log("\uD83C\uDF89 Benchmark completed!"),console.log(`\uD83D\uDCC1 Results saved to: ${_.output}`)}catch($){throw new k(`Benchmark failed: ${$}`)}}};function C5(_){let $=new B0(_.name);$.description(_.description);for(let X of _.options||[])$.option(X.flags,X.description,X.defaultValue);if(_.arguments)for(let X of _.arguments){let Z=X.name==="servers"?`[${X.name}...]`:X.required?`<${X.name}>`:`[${X.name}]`;$.argument(Z,X.description)}if(_.subcommands)for(let X of _.subcommands)$.addCommand(C5(X));if(_.handler){let X=rZ(_.handler,_.name);if(_.validator)$.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,H)=>{if(H<J.length)Y[z.name]=J[H]});return _.validator?.(Y),X(Y)});else $.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,H)=>{if(H<J.length)Y[z.name]=J[H]});return X(Y)})}return $}var sT=[{flags:"--target <type>",description:"Force specific target"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--mcp [servers...]",description:`Install MCP servers (${aZ().join(", ")})`}];function tZ(){console.log("\uD83D\uDE80 Sylphx Flow CLI - Type-safe development flow"),console.log("========================================="),console.log(""),console.log("Available commands:"),console.log("  init     Initialize project with Sylphx Flow"),console.log("  mcp      Manage MCP tools"),console.log("  memory   Manage memory storage"),console.log("  tui      Interactive TUI for all operations"),console.log(""),console.log("Examples:"),console.log("  sylphx-flow init"),console.log("  sylphx-flow init --target opencode"),console.log("  sylphx-flow mcp install --all"),console.log("  sylphx-flow memory set key value"),console.log("  sylphx-flow tui"),console.log(""),console.log('Run "sylphx-flow <command> --help" for more information about a command.')}function FU(){let _=new B0;_.name("sylphx-flow").description("Sylphx Flow - Type-safe development flow CLI").version("1.0.0");let $=[vZ,hZ,fZ,lZ,sZ];_.addCommand(IZ),_.addCommand(t2);for(let X of $)_.addCommand(C5(X));return _.command("tui").description("Launch interactive Sylphx Flow TUI").option("--target <type>","Target platform (opencode, default: auto-detect)").action(q5),_.action(()=>{tZ()}),_}function eZ(){let _=FU();if(process.argv.length===2)_.help();process.on("uncaughtException",($)=>{console.error(`✗ Uncaught error: ${$.message}`),process.exit(1)}),process.on("unhandledRejection",($)=>{console.error(`✗ Unhandled rejection: ${$}`),process.exit(1)});try{_.parse()}catch($){console.error(`✗ Error: ${$.message}`),process.exit(1)}}eZ();
