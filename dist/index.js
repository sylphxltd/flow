#!/usr/bin/env node
import{a as $_,b as N5,c as EZ}from"./paths-2re3k191.js";import{e as U8}from"./index-wyc164dh.js";import{f as x,g as $J}from"./error-handler-s33btwbj.js";import{h as A0,i as XJ}from"./servers-kk8achc3.js";import{j as c,k as vZ,l as v}from"./index-jxkn0z7w.js";import"./targets-eqj2n0rv.js";import{s as O8}from"./secret-utils-zft4mj2q.js";import{u as Q5}from"./index-bj3p86hf.js";import{A as h,x as T0,y as u,z as U6}from"./index-cq9vs79a.js";var Z_=u((HJ)=>{class V8 extends Error{constructor(_,$,X){super(X);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=_,this.nestedError=void 0}}class k5 extends V8{constructor(_){super(1,"commander.invalidArgument",_);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}HJ.CommanderError=V8;HJ.InvalidArgumentError=k5});var J6=u((KJ)=>{var{InvalidArgumentError:UJ}=Z_();class v5{constructor(_,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,_[0]){case"<":this.required=!0,this._name=_.slice(1,-1);break;case"[":this.required=!1,this._name=_.slice(1,-1);break;default:this.required=!0,this._name=_;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}argParser(_){return this.parseArg=_,this}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new UJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function AJ(_){let $=_.name()+(_.variadic===!0?"...":"");return _.required?"<"+$+">":"["+$+"]"}KJ.Argument=v5;KJ.humanReadableArgName=AJ});var N8=u((VJ)=>{var{humanReadableArgName:DJ}=J6();class h5{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(_){let $=_.commands.filter((Z)=>!Z._hidden),X=_._getHelpCommand();if(X&&!X._hidden)$.push(X);if(this.sortSubcommands)$.sort((Z,J)=>{return Z.name().localeCompare(J.name())});return $}compareOptions(_,$){let X=(Z)=>{return Z.short?Z.short.replace(/^-/,""):Z.long.replace(/^--/,"")};return X(_).localeCompare(X($))}visibleOptions(_){let $=_.options.filter((Z)=>!Z.hidden),X=_._getHelpOption();if(X&&!X.hidden){let Z=X.short&&_._findOption(X.short),J=X.long&&_._findOption(X.long);if(!Z&&!J)$.push(X);else if(X.long&&!J)$.push(_.createOption(X.long,X.description));else if(X.short&&!Z)$.push(_.createOption(X.short,X.description))}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(_){if(!this.showGlobalOptions)return[];let $=[];for(let X=_.parent;X;X=X.parent){let Z=X.options.filter((J)=>!J.hidden);$.push(...Z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(_){if(_._argsDescription)_.registeredArguments.forEach(($)=>{$.description=$.description||_._argsDescription[$.name()]||""});if(_.registeredArguments.find(($)=>$.description))return _.registeredArguments;return[]}subcommandTerm(_){let $=_.registeredArguments.map((X)=>DJ(X)).join(" ");return _._name+(_._aliases[0]?"|"+_._aliases[0]:"")+(_.options.length?" [options]":"")+($?" "+$:"")}optionTerm(_){return _.flags}argumentTerm(_){return _.name()}longestSubcommandTermLength(_,$){return $.visibleCommands(_).reduce((X,Z)=>{return Math.max(X,$.subcommandTerm(Z).length)},0)}longestOptionTermLength(_,$){return $.visibleOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestGlobalOptionTermLength(_,$){return $.visibleGlobalOptions(_).reduce((X,Z)=>{return Math.max(X,$.optionTerm(Z).length)},0)}longestArgumentTermLength(_,$){return $.visibleArguments(_).reduce((X,Z)=>{return Math.max(X,$.argumentTerm(Z).length)},0)}commandUsage(_){let $=_._name;if(_._aliases[0])$=$+"|"+_._aliases[0];let X="";for(let Z=_.parent;Z;Z=Z.parent)X=Z.name()+" "+X;return X+$+" "+_.usage()}commandDescription(_){return _.description()}subcommandDescription(_){return _.summary()||_.description()}optionDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0){if(_.required||_.optional||_.isBoolean()&&typeof _.defaultValue==="boolean")$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`)}if(_.presetArg!==void 0&&_.optional)$.push(`preset: ${JSON.stringify(_.presetArg)}`);if(_.envVar!==void 0)$.push(`env: ${_.envVar}`);if($.length>0)return`${_.description} (${$.join(", ")})`;return _.description}argumentDescription(_){let $=[];if(_.argChoices)$.push(`choices: ${_.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if(_.defaultValue!==void 0)$.push(`default: ${_.defaultValueDescription||JSON.stringify(_.defaultValue)}`);if($.length>0){let X=`(${$.join(", ")})`;if(_.description)return`${_.description} ${X}`;return X}return _.description}formatHelp(_,$){let X=$.padWidth(_,$),Z=$.helpWidth||80,J=2,G=2;function Y(R,D){if(D){let N=`${R.padEnd(X+2)}${D}`;return $.wrap(N,Z-2,X+2)}return R}function z(R){return R.join(`
`).replace(/^/gm," ".repeat(2))}let H=[`Usage: ${$.commandUsage(_)}`,""],W=$.commandDescription(_);if(W.length>0)H=H.concat([$.wrap(W,Z,0),""]);let F=$.visibleArguments(_).map((R)=>{return Y($.argumentTerm(R),$.argumentDescription(R))});if(F.length>0)H=H.concat(["Arguments:",z(F),""]);let A=$.visibleOptions(_).map((R)=>{return Y($.optionTerm(R),$.optionDescription(R))});if(A.length>0)H=H.concat(["Options:",z(A),""]);if(this.showGlobalOptions){let R=$.visibleGlobalOptions(_).map((D)=>{return Y($.optionTerm(D),$.optionDescription(D))});if(R.length>0)H=H.concat(["Global Options:",z(R),""])}let O=$.visibleCommands(_).map((R)=>{return Y($.subcommandTerm(R),$.subcommandDescription(R))});if(O.length>0)H=H.concat(["Commands:",z(O),""]);return H.join(`
`)}padWidth(_,$){return Math.max($.longestOptionTermLength(_,$),$.longestGlobalOptionTermLength(_,$),$.longestSubcommandTermLength(_,$),$.longestArgumentTermLength(_,$))}wrap(_,$,X,Z=40){let G=new RegExp(`[\\n][${" \\f\\t\\v   -   　\uFEFF"}]+`);if(_.match(G))return _;let Y=$-X;if(Y<Z)return _;let z=_.slice(0,X),H=_.slice(X).replace(`\r
`,`
`),W=" ".repeat(X),A=`\\s${"​"}`,O=new RegExp(`
|.{1,${Y-1}}([${A}]|$)|[^${A}]+?([${A}]|$)`,"g"),R=H.match(O)||[];return z+R.map((D,N)=>{if(D===`
`)return"";return(N>0?W:"")+D.trimEnd()}).join(`
`)}}VJ.Help=h5});var M8=u((IJ)=>{var{InvalidArgumentError:MJ}=Z_();class y5{constructor(_,$){this.flags=_,this.description=$||"",this.required=_.includes("<"),this.optional=_.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(_),this.mandatory=!1;let X=QJ(_);if(this.short=X.shortFlag,this.long=X.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(_,$){return this.defaultValue=_,this.defaultValueDescription=$,this}preset(_){return this.presetArg=_,this}conflicts(_){return this.conflictsWith=this.conflictsWith.concat(_),this}implies(_){let $=_;if(typeof _==="string")$={[_]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(_){return this.envVar=_,this}argParser(_){return this.parseArg=_,this}makeOptionMandatory(_=!0){return this.mandatory=!!_,this}hideHelp(_=!0){return this.hidden=!!_,this}_concatValue(_,$){if($===this.defaultValue||!Array.isArray($))return[_];return $.concat(_)}choices(_){return this.argChoices=_.slice(),this.parseArg=($,X)=>{if(!this.argChoices.includes($))throw new MJ(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,X);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return BJ(this.name().replace(/^no-/,""))}is(_){return this.short===_||this.long===_}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class f5{constructor(_){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,_.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,X)=>{if(this.positiveOptions.has(X))this.dualOptions.add(X)})}valueFromOption(_,$){let X=$.attributeName();if(!this.dualOptions.has(X))return!0;let Z=this.negativeOptions.get(X).presetArg,J=Z!==void 0?Z:!1;return $.negate===(J===_)}}function BJ(_){return _.split("-").reduce(($,X)=>{return $+X[0].toUpperCase()+X.slice(1)})}function QJ(_){let $,X,Z=_.split(/[ |,]+/);if(Z.length>1&&!/^[[<]/.test(Z[1]))$=Z.shift();if(X=Z.shift(),!$&&/^-[^-]$/.test(X))$=X,X=void 0;return{shortFlag:$,longFlag:X}}IJ.Option=y5;IJ.DualOptions=f5});var b5=u((wJ)=>{function TJ(_,$){if(Math.abs(_.length-$.length)>3)return Math.max(_.length,$.length);let X=[];for(let Z=0;Z<=_.length;Z++)X[Z]=[Z];for(let Z=0;Z<=$.length;Z++)X[0][Z]=Z;for(let Z=1;Z<=$.length;Z++)for(let J=1;J<=_.length;J++){let G=1;if(_[J-1]===$[Z-1])G=0;else G=1;if(X[J][Z]=Math.min(X[J-1][Z]+1,X[J][Z-1]+1,X[J-1][Z-1]+G),J>1&&Z>1&&_[J-1]===$[Z-2]&&_[J-2]===$[Z-1])X[J][Z]=Math.min(X[J][Z],X[J-2][Z-2]+1)}return X[_.length][$.length]}function LJ(_,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let X=_.startsWith("--");if(X)_=_.slice(2),$=$.map((Y)=>Y.slice(2));let Z=[],J=3,G=0.4;if($.forEach((Y)=>{if(Y.length<=1)return;let z=TJ(_,Y),H=Math.max(_.length,Y.length);if((H-z)/H>G){if(z<J)J=z,Z=[Y];else if(z===J)Z.push(Y)}}),Z.sort((Y,z)=>Y.localeCompare(z)),X)Z=Z.map((Y)=>`--${Y}`);if(Z.length>1)return`
(Did you mean one of ${Z.join(", ")}?)`;if(Z.length===1)return`
(Did you mean ${Z[0]}?)`;return""}wJ.suggestSimilar=LJ});var u5=u((vJ)=>{var xJ=h("node:events").EventEmitter,B8=h("node:child_process"),O1=h("node:path"),Q8=h("node:fs"),t=h("node:process"),{Argument:qJ,humanReadableArgName:CJ}=J6(),{CommanderError:I8}=Z_(),{Help:SJ}=N8(),{Option:g5,DualOptions:kJ}=M8(),{suggestSimilar:p5}=b5();class E8 extends xJ{constructor(_){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=_||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>t.stdout.write($),writeErr:($)=>t.stderr.write($),getOutHelpWidth:()=>t.stdout.isTTY?t.stdout.columns:void 0,getErrHelpWidth:()=>t.stderr.isTTY?t.stderr.columns:void 0,outputError:($,X)=>X($)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(_){return this._outputConfiguration=_._outputConfiguration,this._helpOption=_._helpOption,this._helpCommand=_._helpCommand,this._helpConfiguration=_._helpConfiguration,this._exitCallback=_._exitCallback,this._storeOptionsAsProperties=_._storeOptionsAsProperties,this._combineFlagAndOptionalValue=_._combineFlagAndOptionalValue,this._allowExcessArguments=_._allowExcessArguments,this._enablePositionalOptions=_._enablePositionalOptions,this._showHelpAfterError=_._showHelpAfterError,this._showSuggestionAfterError=_._showSuggestionAfterError,this}_getCommandAndAncestors(){let _=[];for(let $=this;$;$=$.parent)_.push($);return _}command(_,$,X){let Z=$,J=X;if(typeof Z==="object"&&Z!==null)J=Z,Z=null;J=J||{};let[,G,Y]=_.match(/([^ ]+) *(.*)/),z=this.createCommand(G);if(Z)z.description(Z),z._executableHandler=!0;if(J.isDefault)this._defaultCommandName=z._name;if(z._hidden=!!(J.noHelp||J.hidden),z._executableFile=J.executableFile||null,Y)z.arguments(Y);if(this._registerCommand(z),z.parent=this,z.copyInheritedSettings(this),Z)return this;return z}createCommand(_){return new E8(_)}createHelp(){return Object.assign(new SJ,this.configureHelp())}configureHelp(_){if(_===void 0)return this._helpConfiguration;return this._helpConfiguration=_,this}configureOutput(_){if(_===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,_),this}showHelpAfterError(_=!0){if(typeof _!=="string")_=!!_;return this._showHelpAfterError=_,this}showSuggestionAfterError(_=!0){return this._showSuggestionAfterError=!!_,this}addCommand(_,$){if(!_._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=_._name;if($.noHelp||$.hidden)_._hidden=!0;return this._registerCommand(_),_.parent=this,_._checkForBrokenPassThrough(),this}createArgument(_,$){return new qJ(_,$)}argument(_,$,X,Z){let J=this.createArgument(_,$);if(typeof X==="function")J.default(Z).argParser(X);else J.default(X);return this.addArgument(J),this}arguments(_){return _.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(_){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw Error(`only the last argument can be variadic '${$.name()}'`);if(_.required&&_.defaultValue!==void 0&&_.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${_.name()}'`);return this.registeredArguments.push(_),this}helpCommand(_,$){if(typeof _==="boolean")return this._addImplicitHelpCommand=_,this;_=_??"help [command]";let[,X,Z]=_.match(/([^ ]+) *(.*)/),J=$??"display help for command",G=this.createCommand(X);if(G.helpOption(!1),Z)G.arguments(Z);if(J)G.description(J);return this._addImplicitHelpCommand=!0,this._helpCommand=G,this}addHelpCommand(_,$){if(typeof _!=="object")return this.helpCommand(_,$),this;return this._addImplicitHelpCommand=!0,this._helpCommand=_,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook(_,$){let X=["preSubcommand","preAction","postAction"];if(!X.includes(_))throw Error(`Unexpected value for event passed to hook : '${_}'.
Expecting one of '${X.join("', '")}'`);if(this._lifeCycleHooks[_])this._lifeCycleHooks[_].push($);else this._lifeCycleHooks[_]=[$];return this}exitOverride(_){if(_)this._exitCallback=_;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(_,$,X){if(this._exitCallback)this._exitCallback(new I8(_,$,X));t.exit(_)}action(_){let $=(X)=>{let Z=this.registeredArguments.length,J=X.slice(0,Z);if(this._storeOptionsAsProperties)J[Z]=this;else J[Z]=this.opts();return J.push(this),_.apply(this,J)};return this._actionHandler=$,this}createOption(_,$){return new g5(_,$)}_callParseArg(_,$,X,Z){try{return _.parseArg($,X)}catch(J){if(J.code==="commander.invalidArgument"){let G=`${Z} ${J.message}`;this.error(G,{exitCode:J.exitCode,code:J.code})}throw J}}_registerOption(_){let $=_.short&&this._findOption(_.short)||_.long&&this._findOption(_.long);if($){let X=_.long&&this._findOption(_.long)?_.long:_.short;throw Error(`Cannot add option '${_.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${X}'
-  already used by option '${$.flags}'`)}this.options.push(_)}_registerCommand(_){let $=(Z)=>{return[Z.name()].concat(Z.aliases())},X=$(_).find((Z)=>this._findCommand(Z));if(X){let Z=$(this._findCommand(X)).join("|"),J=$(_).join("|");throw Error(`cannot add command '${J}' as already have command '${Z}'`)}this.commands.push(_)}addOption(_){this._registerOption(_);let $=_.name(),X=_.attributeName();if(_.negate){let J=_.long.replace(/^--no-/,"--");if(!this._findOption(J))this.setOptionValueWithSource(X,_.defaultValue===void 0?!0:_.defaultValue,"default")}else if(_.defaultValue!==void 0)this.setOptionValueWithSource(X,_.defaultValue,"default");let Z=(J,G,Y)=>{if(J==null&&_.presetArg!==void 0)J=_.presetArg;let z=this.getOptionValue(X);if(J!==null&&_.parseArg)J=this._callParseArg(_,J,z,G);else if(J!==null&&_.variadic)J=_._concatValue(J,z);if(J==null)if(_.negate)J=!1;else if(_.isBoolean()||_.optional)J=!0;else J="";this.setOptionValueWithSource(X,J,Y)};if(this.on("option:"+$,(J)=>{let G=`error: option '${_.flags}' argument '${J}' is invalid.`;Z(J,G,"cli")}),_.envVar)this.on("optionEnv:"+$,(J)=>{let G=`error: option '${_.flags}' value '${J}' from env '${_.envVar}' is invalid.`;Z(J,G,"env")});return this}_optionEx(_,$,X,Z,J){if(typeof $==="object"&&$ instanceof g5)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let G=this.createOption($,X);if(G.makeOptionMandatory(!!_.mandatory),typeof Z==="function")G.default(J).argParser(Z);else if(Z instanceof RegExp){let Y=Z;Z=(z,H)=>{let W=Y.exec(z);return W?W[0]:H},G.default(J).argParser(Z)}else G.default(Z);return this.addOption(G)}option(_,$,X,Z){return this._optionEx({},_,$,X,Z)}requiredOption(_,$,X,Z){return this._optionEx({mandatory:!0},_,$,X,Z)}combineFlagAndOptionalValue(_=!0){return this._combineFlagAndOptionalValue=!!_,this}allowUnknownOption(_=!0){return this._allowUnknownOption=!!_,this}allowExcessArguments(_=!0){return this._allowExcessArguments=!!_,this}enablePositionalOptions(_=!0){return this._enablePositionalOptions=!!_,this}passThroughOptions(_=!0){return this._passThroughOptions=!!_,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(_=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!_,this}getOptionValue(_){if(this._storeOptionsAsProperties)return this[_];return this._optionValues[_]}setOptionValue(_,$){return this.setOptionValueWithSource(_,$,void 0)}setOptionValueWithSource(_,$,X){if(this._storeOptionsAsProperties)this[_]=$;else this._optionValues[_]=$;return this._optionValueSources[_]=X,this}getOptionValueSource(_){return this._optionValueSources[_]}getOptionValueSourceWithGlobals(_){let $;return this._getCommandAndAncestors().forEach((X)=>{if(X.getOptionValueSource(_)!==void 0)$=X.getOptionValueSource(_)}),$}_prepareUserArgs(_,$){if(_!==void 0&&!Array.isArray(_))throw Error("first parameter to parse must be array or undefined");if($=$||{},_===void 0&&$.from===void 0){if(t.versions?.electron)$.from="electron";let Z=t.execArgv??[];if(Z.includes("-e")||Z.includes("--eval")||Z.includes("-p")||Z.includes("--print"))$.from="eval"}if(_===void 0)_=t.argv;this.rawArgs=_.slice();let X;switch($.from){case void 0:case"node":this._scriptPath=_[1],X=_.slice(2);break;case"electron":if(t.defaultApp)this._scriptPath=_[1],X=_.slice(2);else X=_.slice(1);break;case"user":X=_.slice(0);break;case"eval":X=_.slice(1);break;default:throw Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",X}parse(_,$){let X=this._prepareUserArgs(_,$);return this._parseCommand([],X),this}async parseAsync(_,$){let X=this._prepareUserArgs(_,$);return await this._parseCommand([],X),this}_executeSubCommand(_,$){$=$.slice();let X=!1,Z=[".js",".ts",".tsx",".mjs",".cjs"];function J(W,F){let A=O1.resolve(W,F);if(Q8.existsSync(A))return A;if(Z.includes(O1.extname(F)))return;let O=Z.find((R)=>Q8.existsSync(`${A}${R}`));if(O)return`${A}${O}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let G=_._executableFile||`${this._name}-${_._name}`,Y=this._executableDir||"";if(this._scriptPath){let W;try{W=Q8.realpathSync(this._scriptPath)}catch(F){W=this._scriptPath}Y=O1.resolve(O1.dirname(W),Y)}if(Y){let W=J(Y,G);if(!W&&!_._executableFile&&this._scriptPath){let F=O1.basename(this._scriptPath,O1.extname(this._scriptPath));if(F!==this._name)W=J(Y,`${F}-${_._name}`)}G=W||G}X=Z.includes(O1.extname(G));let z;if(t.platform!=="win32")if(X)$.unshift(G),$=m5(t.execArgv).concat($),z=B8.spawn(t.argv[0],$,{stdio:"inherit"});else z=B8.spawn(G,$,{stdio:"inherit"});else $.unshift(G),$=m5(t.execArgv).concat($),z=B8.spawn(t.execPath,$,{stdio:"inherit"});if(!z.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((F)=>{t.on(F,()=>{if(z.killed===!1&&z.exitCode===null)z.kill(F)})});let H=this._exitCallback;z.on("close",(W)=>{if(W=W??1,!H)t.exit(W);else H(new I8(W,"commander.executeSubCommandAsync","(close)"))}),z.on("error",(W)=>{if(W.code==="ENOENT"){let F=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",A=`'${G}' does not exist
 - if '${_._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${F}`;throw Error(A)}else if(W.code==="EACCES")throw Error(`'${G}' not executable`);if(!H)t.exit(1);else{let F=new I8(1,"commander.executeSubCommandAsync","(error)");F.nestedError=W,H(F)}}),this.runningCommand=z}_dispatchSubcommand(_,$,X){let Z=this._findCommand(_);if(!Z)this.help({error:!0});let J;return J=this._chainOrCallSubCommandHook(J,Z,"preSubcommand"),J=this._chainOrCall(J,()=>{if(Z._executableHandler)this._executeSubCommand(Z,$.concat(X));else return Z._parseCommand($,X)}),J}_dispatchHelpCommand(_){if(!_)this.help();let $=this._findCommand(_);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(_,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((_,$)=>{if(_.required&&this.args[$]==null)this.missingArgument(_.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let _=(X,Z,J)=>{let G=Z;if(Z!==null&&X.parseArg){let Y=`error: command-argument value '${Z}' is invalid for argument '${X.name()}'.`;G=this._callParseArg(X,Z,J,Y)}return G};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((X,Z)=>{let J=X.defaultValue;if(X.variadic){if(Z<this.args.length){if(J=this.args.slice(Z),X.parseArg)J=J.reduce((G,Y)=>{return _(X,Y,G)},X.defaultValue)}else if(J===void 0)J=[]}else if(Z<this.args.length){if(J=this.args[Z],X.parseArg)J=_(X,J,X.defaultValue)}$[Z]=J}),this.processedArgs=$}_chainOrCall(_,$){if(_&&_.then&&typeof _.then==="function")return _.then(()=>$());return $()}_chainOrCallHooks(_,$){let X=_,Z=[];if(this._getCommandAndAncestors().reverse().filter((J)=>J._lifeCycleHooks[$]!==void 0).forEach((J)=>{J._lifeCycleHooks[$].forEach((G)=>{Z.push({hookedCommand:J,callback:G})})}),$==="postAction")Z.reverse();return Z.forEach((J)=>{X=this._chainOrCall(X,()=>{return J.callback(J.hookedCommand,this)})}),X}_chainOrCallSubCommandHook(_,$,X){let Z=_;if(this._lifeCycleHooks[X]!==void 0)this._lifeCycleHooks[X].forEach((J)=>{Z=this._chainOrCall(Z,()=>{return J(this,$)})});return Z}_parseCommand(_,$){let X=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),_=_.concat(X.operands),$=X.unknown,this.args=_.concat($),_&&this._findCommand(_[0]))return this._dispatchSubcommand(_[0],_.slice(1),$);if(this._getHelpCommand()&&_[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(_[1]);if(this._defaultCommandName)return this._outputHelpIfRequested($),this._dispatchSubcommand(this._defaultCommandName,_,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(X.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Z=()=>{if(X.unknown.length>0)this.unknownOption(X.unknown[0])},J=`command:${this.name()}`;if(this._actionHandler){Z(),this._processArguments();let G;if(G=this._chainOrCallHooks(G,"preAction"),G=this._chainOrCall(G,()=>this._actionHandler(this.processedArgs)),this.parent)G=this._chainOrCall(G,()=>{this.parent.emit(J,_,$)});return G=this._chainOrCallHooks(G,"postAction"),G}if(this.parent&&this.parent.listenerCount(J))Z(),this._processArguments(),this.parent.emit(J,_,$);else if(_.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",_,$);if(this.listenerCount("command:*"))this.emit("command:*",_,$);else if(this.commands.length)this.unknownCommand();else Z(),this._processArguments()}else if(this.commands.length)Z(),this.help({error:!0});else Z(),this._processArguments()}_findCommand(_){if(!_)return;return this.commands.find(($)=>$._name===_||$._aliases.includes(_))}_findOption(_){return this.options.find(($)=>$.is(_))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((_)=>{_.options.forEach(($)=>{if($.mandatory&&_.getOptionValue($.attributeName())===void 0)_.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let _=this.options.filter((X)=>{let Z=X.attributeName();if(this.getOptionValue(Z)===void 0)return!1;return this.getOptionValueSource(Z)!=="default"});_.filter((X)=>X.conflictsWith.length>0).forEach((X)=>{let Z=_.find((J)=>X.conflictsWith.includes(J.attributeName()));if(Z)this._conflictingOption(X,Z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((_)=>{_._checkForConflictingLocalOptions()})}parseOptions(_){let $=[],X=[],Z=$,J=_.slice();function G(z){return z.length>1&&z[0]==="-"}let Y=null;while(J.length){let z=J.shift();if(z==="--"){if(Z===X)Z.push(z);Z.push(...J);break}if(Y&&!G(z)){this.emit(`option:${Y.name()}`,z);continue}if(Y=null,G(z)){let H=this._findOption(z);if(H){if(H.required){let W=J.shift();if(W===void 0)this.optionMissingArgument(H);this.emit(`option:${H.name()}`,W)}else if(H.optional){let W=null;if(J.length>0&&!G(J[0]))W=J.shift();this.emit(`option:${H.name()}`,W)}else this.emit(`option:${H.name()}`);Y=H.variadic?H:null;continue}}if(z.length>2&&z[0]==="-"&&z[1]!=="-"){let H=this._findOption(`-${z[1]}`);if(H){if(H.required||H.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${H.name()}`,z.slice(2));else this.emit(`option:${H.name()}`),J.unshift(`-${z.slice(2)}`);continue}}if(/^--[^=]+=/.test(z)){let H=z.indexOf("="),W=this._findOption(z.slice(0,H));if(W&&(W.required||W.optional)){this.emit(`option:${W.name()}`,z.slice(H+1));continue}}if(G(z))Z=X;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&X.length===0){if(this._findCommand(z)){if($.push(z),J.length>0)X.push(...J);break}else if(this._getHelpCommand()&&z===this._getHelpCommand().name()){if($.push(z),J.length>0)$.push(...J);break}else if(this._defaultCommandName){if(X.push(z),J.length>0)X.push(...J);break}}if(this._passThroughOptions){if(Z.push(z),J.length>0)Z.push(...J);break}Z.push(z)}return{operands:$,unknown:X}}opts(){if(this._storeOptionsAsProperties){let _={},$=this.options.length;for(let X=0;X<$;X++){let Z=this.options[X].attributeName();_[Z]=Z===this._versionOptionName?this._version:this[Z]}return _}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((_,$)=>Object.assign(_,$.opts()),{})}error(_,$){if(this._outputConfiguration.outputError(`${_}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let X=$||{},Z=X.exitCode||1,J=X.code||"commander.error";this._exit(Z,J,_)}_parseOptionsEnv(){this.options.forEach((_)=>{if(_.envVar&&_.envVar in t.env){let $=_.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(_.required||_.optional)this.emit(`optionEnv:${_.name()}`,t.env[_.envVar]);else this.emit(`optionEnv:${_.name()}`)}})}_parseOptionsImplied(){let _=new kJ(this.options),$=(X)=>{return this.getOptionValue(X)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(X))};this.options.filter((X)=>X.implied!==void 0&&$(X.attributeName())&&_.valueFromOption(this.getOptionValue(X.attributeName()),X)).forEach((X)=>{Object.keys(X.implied).filter((Z)=>!$(Z)).forEach((Z)=>{this.setOptionValueWithSource(Z,X.implied[Z],"implied")})})}missingArgument(_){let $=`error: missing required argument '${_}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(_){let $=`error: option '${_.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(_){let $=`error: required option '${_.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(_,$){let X=(G)=>{let Y=G.attributeName(),z=this.getOptionValue(Y),H=this.options.find((F)=>F.negate&&Y===F.attributeName()),W=this.options.find((F)=>!F.negate&&Y===F.attributeName());if(H&&(H.presetArg===void 0&&z===!1||H.presetArg!==void 0&&z===H.presetArg))return H;return W||G},Z=(G)=>{let Y=X(G),z=Y.attributeName();if(this.getOptionValueSource(z)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},J=`error: ${Z(_)} cannot be used with ${Z($)}`;this.error(J,{code:"commander.conflictingOption"})}unknownOption(_){if(this._allowUnknownOption)return;let $="";if(_.startsWith("--")&&this._showSuggestionAfterError){let Z=[],J=this;do{let G=J.createHelp().visibleOptions(J).filter((Y)=>Y.long).map((Y)=>Y.long);Z=Z.concat(G),J=J.parent}while(J&&!J._enablePositionalOptions);$=p5(_,Z)}let X=`error: unknown option '${_}'${$}`;this.error(X,{code:"commander.unknownOption"})}_excessArguments(_){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,X=$===1?"":"s",J=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${X} but got ${_.length}.`;this.error(J,{code:"commander.excessArguments"})}unknownCommand(){let _=this.args[0],$="";if(this._showSuggestionAfterError){let Z=[];this.createHelp().visibleCommands(this).forEach((J)=>{if(Z.push(J.name()),J.alias())Z.push(J.alias())}),$=p5(_,Z)}let X=`error: unknown command '${_}'${$}`;this.error(X,{code:"commander.unknownCommand"})}version(_,$,X){if(_===void 0)return this._version;this._version=_,$=$||"-V, --version",X=X||"output the version number";let Z=this.createOption($,X);return this._versionOptionName=Z.attributeName(),this._registerOption(Z),this.on("option:"+Z.name(),()=>{this._outputConfiguration.writeOut(`${_}
`),this._exit(0,"commander.version",_)}),this}description(_,$){if(_===void 0&&$===void 0)return this._description;if(this._description=_,$)this._argsDescription=$;return this}summary(_){if(_===void 0)return this._summary;return this._summary=_,this}alias(_){if(_===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(_===$._name)throw Error("Command alias can't be the same as its name");let X=this.parent?._findCommand(_);if(X){let Z=[X.name()].concat(X.aliases()).join("|");throw Error(`cannot add alias '${_}' to command '${this.name()}' as already have command '${Z}'`)}return $._aliases.push(_),this}aliases(_){if(_===void 0)return this._aliases;return _.forEach(($)=>this.alias($)),this}usage(_){if(_===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((X)=>{return CJ(X)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=_,this}name(_){if(_===void 0)return this._name;return this._name=_,this}nameFromFilename(_){return this._name=O1.basename(_,O1.extname(_)),this}executableDir(_){if(_===void 0)return this._executableDir;return this._executableDir=_,this}helpInformation(_){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=_&&_.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(_){_=_||{};let $={error:!!_.error},X;if($.error)X=(Z)=>this._outputConfiguration.writeErr(Z);else X=(Z)=>this._outputConfiguration.writeOut(Z);return $.write=_.write||X,$.command=this,$}outputHelp(_){let $;if(typeof _==="function")$=_,_=void 0;let X=this._getHelpContext(_);this._getCommandAndAncestors().reverse().forEach((J)=>J.emit("beforeAllHelp",X)),this.emit("beforeHelp",X);let Z=this.helpInformation(X);if($){if(Z=$(Z),typeof Z!=="string"&&!Buffer.isBuffer(Z))throw Error("outputHelp callback must return a string or a Buffer")}if(X.write(Z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",X),this._getCommandAndAncestors().forEach((J)=>J.emit("afterAllHelp",X))}helpOption(_,$){if(typeof _==="boolean"){if(_)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return _=_??"-h, --help",$=$??"display help for command",this._helpOption=this.createOption(_,$),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption(_){return this._helpOption=_,this}help(_){this.outputHelp(_);let $=t.exitCode||0;if($===0&&_&&typeof _!=="function"&&_.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(_,$){let X=["beforeAll","before","after","afterAll"];if(!X.includes(_))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${X.join("', '")}'`);let Z=`${_}Help`;return this.on(Z,(J)=>{let G;if(typeof $==="function")G=$({error:J.error,command:J.command});else G=$;if(G)J.write(`${G}
`)}),this}_outputHelpIfRequested(_){let $=this._getHelpOption();if($&&_.find((Z)=>$.is(Z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function m5(_){return _.map(($)=>{if(!$.startsWith("--inspect"))return $;let X,Z="127.0.0.1",J="9229",G;if((G=$.match(/^(--inspect(-brk)?)$/))!==null)X=G[1];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(X=G[1],/^\d+$/.test(G[3]))J=G[3];else Z=G[3];else if((G=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)X=G[1],Z=G[3],J=G[4];if(X&&J!=="0")return`${X}=${Z}:${parseInt(J)+1}`;return $})}vJ.Command=E8});var i5=u((bJ)=>{var{Argument:d5}=J6(),{Command:j8}=u5(),{CommanderError:yJ,InvalidArgumentError:c5}=Z_(),{Help:fJ}=N8(),{Option:l5}=M8();bJ.program=new j8;bJ.createCommand=(_)=>new j8(_);bJ.createOption=(_,$)=>new l5(_,$);bJ.createArgument=(_,$)=>new d5(_,$);bJ.Command=j8;bJ.Option=l5;bJ.Argument=d5;bJ.Help=fJ;bJ.CommanderError=yJ;bJ.InvalidArgumentError=c5;bJ.InvalidOptionArgumentError=c5});var h3=u((qK,D6)=>{function L3(_){return Array.isArray(_)?_:[_]}var gG=void 0,u8="",j3=" ",m8="\\",pG=/^\s+$/,mG=/(?:[^\\]|^)\\$/,uG=/^\\!/,dG=/^\\#/,cG=/\r?\n/g,lG=/^\.{0,2}\/|^\.{1,2}$/,iG=/\/$/,V2="/",w3="node-ignore";if(typeof Symbol<"u")w3=Symbol.for("node-ignore");var P3=w3,N2=(_,$,X)=>{return Object.defineProperty(_,$,{value:X}),X},nG=/([0-z])-([0-z])/g,x3=()=>!1,sG=(_)=>_.replace(nG,($,X,Z)=>X.charCodeAt(0)<=Z.charCodeAt(0)?$:u8),oG=(_)=>{let{length:$}=_;return _.slice(0,$-$%2)},rG=[[/^\uFEFF/,()=>u8],[/((?:\\\\)*?)(\\?\s+)$/,(_,$,X)=>$+(X.indexOf("\\")===0?j3:u8)],[/(\\+?)\s/g,(_,$)=>{let{length:X}=$;return $.slice(0,X-X%2)+j3}],[/[\\$.|*+(){^]/g,(_)=>`\\${_}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return!/\/(?!$)/.test(this)?"(?:^|\\/)":"^"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(_,$,X)=>$+6<X.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(_,$,X)=>{let Z=X.replace(/\\\*/g,"[^\\/]*");return $+Z}],[/\\\\\\(?=[$.|*+(){^])/g,()=>m8],[/\\\\/g,()=>m8],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(_,$,X,Z,J)=>$===m8?`\\[${X}${oG(Z)}${J}`:J==="]"?Z.length%2===0?`[${sG(X)}${Z}]`:"[]":"[]"],[/(?:[^*])$/,(_)=>/\/$/.test(_)?`${_}$`:`${_}(?=$|\\/$)`]],aG=/(^|\\\/)?\\\*$/,W_="regex",O6="checkRegex",T3="_",tG={[W_](_,$){return`${$?`${$}[^/]+`:"[^/]*"}(?=$|\\/$)`},[O6](_,$){return`${$?`${$}[^/]*`:"[^/]*"}(?=$|\\/$)`}},eG=(_)=>rG.reduce(($,[X,Z])=>$.replace(X,Z.bind(_)),_),R6=(_)=>typeof _==="string",_Y=(_)=>_&&R6(_)&&!pG.test(_)&&!mG.test(_)&&_.indexOf("#")!==0,$Y=(_)=>_.split(cG).filter(Boolean);class q3{constructor(_,$,X,Z,J,G){this.pattern=_,this.mark=$,this.negative=J,N2(this,"body",X),N2(this,"ignoreCase",Z),N2(this,"regexPrefix",G)}get regex(){let _=T3+W_;if(this[_])return this[_];return this._make(W_,_)}get checkRegex(){let _=T3+O6;if(this[_])return this[_];return this._make(O6,_)}_make(_,$){let X=this.regexPrefix.replace(aG,tG[_]),Z=this.ignoreCase?new RegExp(X,"i"):new RegExp(X);return N2(this,$,Z)}}var XY=({pattern:_,mark:$},X)=>{let Z=!1,J=_;if(J.indexOf("!")===0)Z=!0,J=J.substr(1);J=J.replace(uG,"!").replace(dG,"#");let G=eG(J);return new q3(_,$,J,X,Z,G)};class C3{constructor(_){this._ignoreCase=_,this._rules=[]}_add(_){if(_&&_[P3]){this._rules=this._rules.concat(_._rules._rules),this._added=!0;return}if(R6(_))_={pattern:_};if(_Y(_.pattern)){let $=XY(_,this._ignoreCase);this._added=!0,this._rules.push($)}}add(_){return this._added=!1,L3(R6(_)?$Y(_):_).forEach(this._add,this),this._added}test(_,$,X){let Z=!1,J=!1,G;this._rules.forEach((z)=>{let{negative:H}=z;if(J===H&&Z!==J||H&&!Z&&!J&&!$)return;if(!z[X].test(_))return;Z=!H,J=H,G=H?gG:z});let Y={ignored:Z,unignored:J};if(G)Y.rule=G;return Y}}var ZY=(_,$)=>{throw new $(_)},R1=(_,$,X)=>{if(!R6(_))return X(`path must be a string, but got \`${$}\``,TypeError);if(!_)return X("path must not be empty",TypeError);if(R1.isNotRelative(_))return X(`path should be a \`path.relative()\`d string, but got "${$}"`,RangeError);return!0},S3=(_)=>lG.test(_);R1.isNotRelative=S3;R1.convert=(_)=>_;class k3{constructor({ignorecase:_=!0,ignoreCase:$=_,allowRelativePaths:X=!1}={}){N2(this,P3,!0),this._rules=new C3($),this._strictPathCheck=!X,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(_){if(this._rules.add(_))this._initCache();return this}addPattern(_){return this.add(_)}_test(_,$,X,Z){let J=_&&R1.convert(_);return R1(J,_,this._strictPathCheck?ZY:x3),this._t(J,$,X,Z)}checkIgnore(_){if(!iG.test(_))return this.test(_);let $=_.split(V2).filter(Boolean);if($.pop(),$.length){let X=this._t($.join(V2)+V2,this._testCache,!0,$);if(X.ignored)return X}return this._rules.test(_,!1,O6)}_t(_,$,X,Z){if(_ in $)return $[_];if(!Z)Z=_.split(V2).filter(Boolean);if(Z.pop(),!Z.length)return $[_]=this._rules.test(_,X,W_);let J=this._t(Z.join(V2)+V2,$,X,Z);return $[_]=J.ignored?J:this._rules.test(_,X,W_)}ignores(_){return this._test(_,this._ignoreCache,!1).ignored}createFilter(){return(_)=>!this.ignores(_)}filter(_){return L3(_).filter(this.createFilter())}test(_){return this._test(_,this._testCache,!0)}}var d8=(_)=>new k3(_),JY=(_)=>R1(_&&R1.convert(_),_,x3),v3=()=>{let _=(X)=>/^\\\\\?\\/.test(X)||/["<>|\u0000-\u001F]+/u.test(X)?X:X.replace(/\\/g,"/");R1.convert=_;let $=/^[a-z]:\//i;R1.isNotRelative=(X)=>$.test(X)||S3(X)};if(typeof process<"u"&&process.platform==="win32")v3();D6.exports=d8;d8.default=d8;D6.exports.isPathValid=JY;N2(D6.exports,Symbol.for("setupWindows"),v3)});var l7=u((m0)=>{var qY=m0&&m0.__createBinding||(Object.create?function(_,$,X,Z){if(Z===void 0)Z=X;var J=Object.getOwnPropertyDescriptor($,X);if(!J||("get"in J?!$.__esModule:J.writable||J.configurable))J={enumerable:!0,get:function(){return $[X]}};Object.defineProperty(_,Z,J)}:function(_,$,X,Z){if(Z===void 0)Z=X;_[Z]=$[X]}),CY=m0&&m0.__setModuleDefault||(Object.create?function(_,$){Object.defineProperty(_,"default",{enumerable:!0,value:$})}:function(_,$){_.default=$}),c7=m0&&m0.__importStar||function(_){if(_&&_.__esModule)return _;var $={};if(_!=null){for(var X in _)if(X!=="default"&&Object.prototype.hasOwnProperty.call(_,X))qY($,_,X)}return CY($,_),$};Object.defineProperty(m0,"__esModule",{value:!0});m0.load=m0.currentTarget=void 0;var SY=c7(h("path")),kY=c7(h("fs"));function vY(){let _=null;switch(process.platform){case"android":switch(process.arch){case"arm":return"android-arm-eabi";case"arm64":return"android-arm64"}_="Android";break;case"win32":switch(process.arch){case"x64":return"win32-x64-msvc";case"arm64":return"win32-arm64-msvc";case"ia32":return"win32-ia32-msvc"}_="Windows";break;case"darwin":switch(process.arch){case"x64":return"darwin-x64";case"arm64":return"darwin-arm64"}_="macOS";break;case"linux":switch(process.arch){case"x64":case"arm64":return hY()?`linux-${process.arch}-gnu`:`linux-${process.arch}-musl`;case"arm":return"linux-arm-gnueabihf"}_="Linux";break;case"freebsd":if(process.arch==="x64")return"freebsd-x64";_="FreeBSD";break}if(_)throw Error(`Neon: unsupported ${_} architecture: ${process.arch}`);throw Error(`Neon: unsupported system: ${process.platform}`)}m0.currentTarget=vY;function hY(){let _=process.report?.getReport();if(typeof _!=="object"||!_||!("header"in _))return!1;let $=_.header;return typeof $==="object"&&!!$&&"glibcVersionRuntime"in $}function yY(_){let $=SY.join(_,"index.node");return kY.existsSync($)?h($):null}m0.load=yY});var s7=u((KR,n7)=>{var i7=()=>process.platform==="linux",W4=null,fY=()=>{if(!W4)W4=i7()&&process.report?process.report.getReport():{};return W4};n7.exports={isLinux:i7,getReport:fY}});var a7=u((OR,r7)=>{var o7=h("fs"),bY=(_)=>o7.readFileSync(_,"utf-8"),gY=(_)=>new Promise(($,X)=>{o7.readFile(_,"utf-8",(Z,J)=>{if(Z)X(Z);else $(J)})});r7.exports={LDD_PATH:"/usr/bin/ldd",readFileSync:bY,readFile:gY}});var O9=u((RR,K9)=>{var e7=h("child_process"),{isLinux:T2,getReport:_9}=s7(),{LDD_PATH:L6,readFile:$9,readFileSync:X9}=a7(),Y1,z1,q1="",Z9=()=>{if(!q1)return new Promise((_)=>{e7.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",($,X)=>{q1=$?" ":X,_(q1)})});return q1},J9=()=>{if(!q1)try{q1=e7.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(_){q1=" "}return q1},V1="glibc",G9=/GLIBC\s(\d+\.\d+)/,o1="musl",pY=V1.toUpperCase(),mY=o1.toLowerCase(),uY=(_)=>_.includes("libc.musl-")||_.includes("ld-musl-"),Y9=()=>{let _=_9();if(_.header&&_.header.glibcVersionRuntime)return V1;if(Array.isArray(_.sharedObjects)){if(_.sharedObjects.some(uY))return o1}return null},z9=(_)=>{let[$,X]=_.split(/[\r\n]+/);if($&&$.includes(V1))return V1;if(X&&X.includes(o1))return o1;return null},H9=(_)=>{if(_.includes(mY))return o1;if(_.includes(pY))return V1;return null},dY=async()=>{if(Y1!==void 0)return Y1;Y1=null;try{let _=await $9(L6);Y1=H9(_)}catch(_){}return Y1},cY=()=>{if(Y1!==void 0)return Y1;Y1=null;try{let _=X9(L6);Y1=H9(_)}catch(_){}return Y1},W9=async()=>{let _=null;if(T2()){if(_=await dY(),!_)_=Y9();if(!_){let $=await Z9();_=z9($)}}return _},F9=()=>{let _=null;if(T2()){if(_=cY(),!_)_=Y9();if(!_){let $=J9();_=z9($)}}return _},lY=async()=>T2()&&await W9()!==V1,iY=()=>T2()&&F9()!==V1,nY=async()=>{if(z1!==void 0)return z1;z1=null;try{let $=(await $9(L6)).match(G9);if($)z1=$[1]}catch(_){}return z1},sY=()=>{if(z1!==void 0)return z1;z1=null;try{let $=X9(L6).match(G9);if($)z1=$[1]}catch(_){}return z1},U9=()=>{let _=_9();if(_.header&&_.header.glibcVersionRuntime)return _.header.glibcVersionRuntime;return null},t7=(_)=>_.trim().split(/\s+/)[1],A9=(_)=>{let[$,X,Z]=_.split(/[\r\n]+/);if($&&$.includes(V1))return t7($);if(X&&Z&&X.includes(o1))return t7(Z);return null},oY=async()=>{let _=null;if(T2()){if(_=await nY(),!_)_=U9();if(!_){let $=await Z9();_=A9($)}}return _},rY=()=>{let _=null;if(T2()){if(_=sY(),!_)_=U9();if(!_){let $=J9();_=A9($)}}return _};K9.exports={GLIBC:V1,MUSL:o1,family:W9,familySync:F9,isNonGlibcLinux:lY,isNonGlibcLinuxSync:iY,version:oY,versionSync:rY}});var D9=u((DR,R9)=>{var aY={ALLOW:0,DENY:1};R9.exports=aY});var N9=u((VR,V9)=>{var F4={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function r1(_,$,X){if(new.target!==r1)return new r1(_,$);if(typeof $!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,_),F4.value=""+_,Object.defineProperty(this,"message",F4),Error.captureStackTrace(this,r1),this.code=$,this.rawCode=X}Object.setPrototypeOf(r1,Error);Object.setPrototypeOf(r1.prototype,Error.prototype);Object.defineProperty(r1.prototype,"name",F4);V9.exports=r1});var L9=u((NR,w6)=>{var __dirname="/Users/kyle/rules/node_modules/libsql",{load:tY,currentTarget:eY}=l7(),{familySync:M9,GLIBC:_z,MUSL:$z}=O9();function Xz(){if(process.env.LIBSQL_JS_DEV)return tY(__dirname);let _=eY();if(M9()==_z)switch(_){case"linux-x64-musl":_="linux-x64-gnu";break;case"linux-arm64-musl":_="linux-arm64-gnu";break}if(_==="linux-arm-gnueabihf"&&M9()==$z)_="linux-arm-musleabihf";return h(`@libsql/${_}`)}var{databaseOpen:Zz,databaseOpenWithSync:Jz,databaseInTransaction:Gz,databaseInterrupt:Yz,databaseClose:zz,databaseSyncSync:Hz,databaseSyncUntilSync:Wz,databaseExecSync:Fz,databasePrepareSync:Uz,databaseDefaultSafeIntegers:Az,databaseAuthorizer:Kz,databaseLoadExtension:Oz,databaseMaxWriteReplicationIndex:Rz,statementRaw:Dz,statementIsReader:Vz,statementGet:B9,statementRun:Q9,statementInterrupt:Nz,statementRowsSync:I9,statementColumns:Mz,statementSafeIntegers:Bz,rowsNext:Qz}=Xz(),Iz=D9(),E9=N9();function L2(_){if(_.libsqlError)return new E9(_.message,_.code,_.rawCode);return _}class j9{constructor(_,$){let X=$?.encryptionCipher??"aes256cbc";if($&&$.syncUrl){var Z="";if($.syncAuth)console.warn("Warning: The `syncAuth` option is deprecated, please use `authToken` option instead."),Z=$.syncAuth;else if($.authToken)Z=$.authToken;let G=$?.encryptionKey??"",Y=$?.syncPeriod??0,z=$?.readYourWrites??!0,H=$?.offline??!1,W=$?.remoteEncryptionKey??"";this.db=Jz(_,$.syncUrl,Z,X,G,Y,z,H,W)}else{let G=$?.authToken??"",Y=$?.encryptionKey??"",z=$?.timeout??0,H=$?.remoteEncryptionKey??"";this.db=Zz(_,G,X,Y,z,H)}this.memory=_===":memory:",this.readonly=!1,this.name="",this.open=!0;let J=this.db;Object.defineProperties(this,{inTransaction:{get(){return Gz(J)}}})}sync(){return Hz.call(this.db)}syncUntil(_){return Wz.call(this.db,_)}prepare(_){try{let $=Uz.call(this.db,_);return new T9($)}catch($){throw L2($)}}transaction(_){if(typeof _!=="function")throw TypeError("Expected first argument to be a function");let $=this,X=(J)=>{return(...G)=>{$.exec("BEGIN "+J);try{let Y=_(...G);return $.exec("COMMIT"),Y}catch(Y){throw $.exec("ROLLBACK"),Y}}},Z={default:{value:X("")},deferred:{value:X("DEFERRED")},immediate:{value:X("IMMEDIATE")},exclusive:{value:X("EXCLUSIVE")},database:{value:this,enumerable:!0}};return Object.defineProperties(Z.default.value,Z),Object.defineProperties(Z.deferred.value,Z),Object.defineProperties(Z.immediate.value,Z),Object.defineProperties(Z.exclusive.value,Z),Z.default.value}pragma(_,$){if($==null)$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");let X=$.simple,Z=this.prepare(`PRAGMA ${_}`,this,!0);return X?Z.pluck().get():Z.all()}backup(_,$){throw Error("not implemented")}serialize(_){throw Error("not implemented")}function(_,$,X){if($==null)$={};if(typeof $==="function")X=$,$={};if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="function")throw TypeError("Expected last argument to be a function");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}aggregate(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object"||$===null)throw TypeError("Expected second argument to be an options object");if(!_)throw TypeError("User-defined function name cannot be an empty string");throw Error("not implemented")}table(_,$){if(typeof _!=="string")throw TypeError("Expected first argument to be a string");if(!_)throw TypeError("Virtual table module name cannot be an empty string");throw Error("not implemented")}authorizer(_){Kz.call(this.db,_)}loadExtension(..._){Oz.call(this.db,..._)}maxWriteReplicationIndex(){return Rz.call(this.db)}exec(_){try{Fz.call(this.db,_)}catch($){throw L2($)}}interrupt(){Yz.call(this.db)}close(){zz.call(this.db),this.open=!1}defaultSafeIntegers(_){return Az.call(this.db,_??!0),this}unsafeMode(..._){throw Error("not implemented")}}class T9{constructor(_){this.stmt=_,this.pluckMode=!1}raw(_){return Dz.call(this.stmt,_??!0),this}pluck(_){return this.pluckMode=_??!0,this}get reader(){return Vz.call(this.stmt)}run(..._){try{if(_.length==1&&typeof _[0]==="object")return Q9.call(this.stmt,_[0]);else return Q9.call(this.stmt,_.flat())}catch($){throw L2($)}}get(..._){try{if(_.length==1&&typeof _[0]==="object")return B9.call(this.stmt,_[0]);else return B9.call(this.stmt,_.flat())}catch($){throw L2($)}}iterate(..._){var $=void 0;if(_.length==1&&typeof _[0]==="object")$=I9.call(this.stmt,_[0]);else $=I9.call(this.stmt,_.flat());return{nextRows:Array(100),nextRowIndex:100,next(){try{if(this.nextRowIndex===100)Qz.call($,this.nextRows),this.nextRowIndex=0;let Z=this.nextRows[this.nextRowIndex];if(this.nextRows[this.nextRowIndex]=void 0,!Z)return{done:!0};return this.nextRowIndex++,{value:Z,done:!1}}catch(Z){throw L2(Z)}},[Symbol.iterator](){return this}}}all(..._){try{let $=[];for(let X of this.iterate(..._))if(this.pluckMode)$.push(X[Object.keys(X)[0]]);else $.push(X);return $}catch($){throw L2($)}}interrupt(){Nz.call(this.stmt)}columns(){return Mz.call(this.stmt)}safeIntegers(_){return Bz.call(this.stmt,_??!0),this}}w6.exports=j9;w6.exports.Authorization=Iz;w6.exports.SqliteError=E9});var N1=u((LR,y9)=>{var v9=["nodebuffer","arraybuffer","fragments"],h9=typeof Blob<"u";if(h9)v9.push("blob");y9.exports={BINARY_TYPES:v9,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:h9,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var T_=u((wR,P6)=>{var{EMPTY_BUFFER:xz}=N1(),U4=Buffer[Symbol.species];function qz(_,$){if(_.length===0)return xz;if(_.length===1)return _[0];let X=Buffer.allocUnsafe($),Z=0;for(let J=0;J<_.length;J++){let G=_[J];X.set(G,Z),Z+=G.length}if(Z<$)return new U4(X.buffer,X.byteOffset,Z);return X}function f9(_,$,X,Z,J){for(let G=0;G<J;G++)X[Z+G]=_[G]^$[G&3]}function b9(_,$){for(let X=0;X<_.length;X++)_[X]^=$[X&3]}function Cz(_){if(_.length===_.buffer.byteLength)return _.buffer;return _.buffer.slice(_.byteOffset,_.byteOffset+_.length)}function A4(_){if(A4.readOnly=!0,Buffer.isBuffer(_))return _;let $;if(_ instanceof ArrayBuffer)$=new U4(_);else if(ArrayBuffer.isView(_))$=new U4(_.buffer,_.byteOffset,_.byteLength);else $=Buffer.from(_),A4.readOnly=!1;return $}P6.exports={concat:qz,mask:f9,toArrayBuffer:Cz,toBuffer:A4,unmask:b9};if(!process.env.WS_NO_BUFFER_UTIL)try{let _=(()=>{throw new Error("Cannot require module "+"bufferutil");})();P6.exports.mask=function($,X,Z,J,G){if(G<48)f9($,X,Z,J,G);else _.mask($,X,Z,J,G)},P6.exports.unmask=function($,X){if($.length<32)b9($,X);else _.unmask($,X)}}catch(_){}});var u9=u((PR,m9)=>{var g9=Symbol("kDone"),K4=Symbol("kRun");class p9{constructor(_){this[g9]=()=>{this.pending--,this[K4]()},this.concurrency=_||1/0,this.jobs=[],this.pending=0}add(_){this.jobs.push(_),this[K4]()}[K4](){if(this.pending===this.concurrency)return;if(this.jobs.length){let _=this.jobs.shift();this.pending++,_(this[g9])}}}m9.exports=p9});var w_=u((xR,n9)=>{var L_=h("zlib"),d9=T_(),Sz=u9(),{kStatusCode:c9}=N1(),kz=Buffer[Symbol.species],vz=Buffer.from([0,0,255,255]),q6=Symbol("permessage-deflate"),M1=Symbol("total-length"),w2=Symbol("callback"),C1=Symbol("buffers"),P2=Symbol("error"),x6;class l9{constructor(_,$,X){if(this._maxPayload=X|0,this._options=_||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!$,this._deflate=null,this._inflate=null,this.params=null,!x6){let Z=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;x6=new Sz(Z)}}static get extensionName(){return"permessage-deflate"}offer(){let _={};if(this._options.serverNoContextTakeover)_.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)_.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)_.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)_.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)_.client_max_window_bits=!0;return _}accept(_){return _=this.normalizeParams(_),this.params=this._isServer?this.acceptAsServer(_):this.acceptAsClient(_),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let _=this._deflate[w2];if(this._deflate.close(),this._deflate=null,_)_(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(_){let $=this._options,X=_.find((Z)=>{if($.serverNoContextTakeover===!1&&Z.server_no_context_takeover||Z.server_max_window_bits&&($.serverMaxWindowBits===!1||typeof $.serverMaxWindowBits==="number"&&$.serverMaxWindowBits>Z.server_max_window_bits)||typeof $.clientMaxWindowBits==="number"&&!Z.client_max_window_bits)return!1;return!0});if(!X)throw Error("None of the extension offers can be accepted");if($.serverNoContextTakeover)X.server_no_context_takeover=!0;if($.clientNoContextTakeover)X.client_no_context_takeover=!0;if(typeof $.serverMaxWindowBits==="number")X.server_max_window_bits=$.serverMaxWindowBits;if(typeof $.clientMaxWindowBits==="number")X.client_max_window_bits=$.clientMaxWindowBits;else if(X.client_max_window_bits===!0||$.clientMaxWindowBits===!1)delete X.client_max_window_bits;return X}acceptAsClient(_){let $=_[0];if(this._options.clientNoContextTakeover===!1&&$.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!$.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")$.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&$.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return $}normalizeParams(_){return _.forEach(($)=>{Object.keys($).forEach((X)=>{let Z=$[X];if(Z.length>1)throw Error(`Parameter "${X}" must have only a single value`);if(Z=Z[0],X==="client_max_window_bits"){if(Z!==!0){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else if(X==="server_max_window_bits"){let J=+Z;if(!Number.isInteger(J)||J<8||J>15)throw TypeError(`Invalid value for parameter "${X}": ${Z}`);Z=J}else if(X==="client_no_context_takeover"||X==="server_no_context_takeover"){if(Z!==!0)throw TypeError(`Invalid value for parameter "${X}": ${Z}`)}else throw Error(`Unknown parameter "${X}"`);$[X]=Z})}),_}decompress(_,$,X){x6.add((Z)=>{this._decompress(_,$,(J,G)=>{Z(),X(J,G)})})}compress(_,$,X){x6.add((Z)=>{this._compress(_,$,(J,G)=>{Z(),X(J,G)})})}_decompress(_,$,X){let Z=this._isServer?"client":"server";if(!this._inflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?L_.Z_DEFAULT_WINDOWBITS:this.params[J];this._inflate=L_.createInflateRaw({...this._options.zlibInflateOptions,windowBits:G}),this._inflate[q6]=this,this._inflate[M1]=0,this._inflate[C1]=[],this._inflate.on("error",yz),this._inflate.on("data",i9)}if(this._inflate[w2]=X,this._inflate.write(_),$)this._inflate.write(vz);this._inflate.flush(()=>{let J=this._inflate[P2];if(J){this._inflate.close(),this._inflate=null,X(J);return}let G=d9.concat(this._inflate[C1],this._inflate[M1]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[M1]=0,this._inflate[C1]=[],$&&this.params[`${Z}_no_context_takeover`])this._inflate.reset();X(null,G)})}_compress(_,$,X){let Z=this._isServer?"server":"client";if(!this._deflate){let J=`${Z}_max_window_bits`,G=typeof this.params[J]!=="number"?L_.Z_DEFAULT_WINDOWBITS:this.params[J];this._deflate=L_.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:G}),this._deflate[M1]=0,this._deflate[C1]=[],this._deflate.on("data",hz)}this._deflate[w2]=X,this._deflate.write(_),this._deflate.flush(L_.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let J=d9.concat(this._deflate[C1],this._deflate[M1]);if($)J=new kz(J.buffer,J.byteOffset,J.length-4);if(this._deflate[w2]=null,this._deflate[M1]=0,this._deflate[C1]=[],$&&this.params[`${Z}_no_context_takeover`])this._deflate.reset();X(null,J)})}}n9.exports=l9;function hz(_){this[C1].push(_),this[M1]+=_.length}function i9(_){if(this[M1]+=_.length,this[q6]._maxPayload<1||this[M1]<=this[q6]._maxPayload){this[C1].push(_);return}this[P2]=RangeError("Max payload size exceeded"),this[P2].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[P2][c9]=1009,this.removeListener("data",i9),this.reset()}function yz(_){if(this[q6]._inflate=null,this[P2]){this[w2](this[P2]);return}_[c9]=1007,this[w2](_)}});var x2=u((qR,C6)=>{var{isUtf8:s9}=h("buffer"),{hasBlob:fz}=N1(),bz=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function gz(_){return _>=1000&&_<=1014&&_!==1004&&_!==1005&&_!==1006||_>=3000&&_<=4999}function O4(_){let $=_.length,X=0;while(X<$)if((_[X]&128)===0)X++;else if((_[X]&224)===192){if(X+1===$||(_[X+1]&192)!==128||(_[X]&254)===192)return!1;X+=2}else if((_[X]&240)===224){if(X+2>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||_[X]===224&&(_[X+1]&224)===128||_[X]===237&&(_[X+1]&224)===160)return!1;X+=3}else if((_[X]&248)===240){if(X+3>=$||(_[X+1]&192)!==128||(_[X+2]&192)!==128||(_[X+3]&192)!==128||_[X]===240&&(_[X+1]&240)===128||_[X]===244&&_[X+1]>143||_[X]>244)return!1;X+=4}else return!1;return!0}function pz(_){return fz&&typeof _==="object"&&typeof _.arrayBuffer==="function"&&typeof _.type==="string"&&typeof _.stream==="function"&&(_[Symbol.toStringTag]==="Blob"||_[Symbol.toStringTag]==="File")}C6.exports={isBlob:pz,isValidStatusCode:gz,isValidUTF8:O4,tokenChars:bz};if(s9)C6.exports.isValidUTF8=function(_){return _.length<24?O4(_):s9(_)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let _=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();C6.exports.isValidUTF8=function($){return $.length<32?O4($):_($)}}catch(_){}});var D4=u((CR,e9)=>{var{Writable:mz}=h("stream"),o9=w_(),{BINARY_TYPES:uz,EMPTY_BUFFER:r9,kStatusCode:dz,kWebSocket:cz}=N1(),{concat:R4,toArrayBuffer:lz,unmask:iz}=T_(),{isValidStatusCode:nz,isValidUTF8:a9}=x2(),S6=Buffer[Symbol.species];class t9 extends mz{constructor(_={}){super();this._allowSynchronousEvents=_.allowSynchronousEvents!==void 0?_.allowSynchronousEvents:!0,this._binaryType=_.binaryType||uz[0],this._extensions=_.extensions||{},this._isServer=!!_.isServer,this._maxPayload=_.maxPayload|0,this._skipUTF8Validation=!!_.skipUTF8Validation,this[cz]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(_,$,X){if(this._opcode===8&&this._state==0)return X();this._bufferedBytes+=_.length,this._buffers.push(_),this.startLoop(X)}consume(_){if(this._bufferedBytes-=_,_===this._buffers[0].length)return this._buffers.shift();if(_<this._buffers[0].length){let X=this._buffers[0];return this._buffers[0]=new S6(X.buffer,X.byteOffset+_,X.length-_),new S6(X.buffer,X.byteOffset,_)}let $=Buffer.allocUnsafe(_);do{let X=this._buffers[0],Z=$.length-_;if(_>=X.length)$.set(this._buffers.shift(),Z);else $.set(new Uint8Array(X.buffer,X.byteOffset,_),Z),this._buffers[0]=new S6(X.buffer,X.byteOffset+_,X.length-_);_-=X.length}while(_>0);return $}startLoop(_){this._loop=!0;do switch(this._state){case 0:this.getInfo(_);break;case 1:this.getPayloadLength16(_);break;case 2:this.getPayloadLength64(_);break;case 3:this.getMask();break;case 4:this.getData(_);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)_()}getInfo(_){if(this._bufferedBytes<2){this._loop=!1;return}let $=this.consume(2);if(($[0]&48)!==0){let Z=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");_(Z);return}let X=($[0]&64)===64;if(X&&!this._extensions[o9.extensionName]){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._fin=($[0]&128)===128,this._opcode=$[0]&15,this._payloadLength=$[1]&127,this._opcode===0){if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(!this._fragmented){let Z=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}this._compressed=X}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let Z=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");_(Z);return}if(X){let Z=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");_(Z);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let Z=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");_(Z);return}}else{let Z=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");_(Z);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=($[1]&128)===128,this._isServer){if(!this._masked){let Z=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");_(Z);return}}else if(this._masked){let Z=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");_(Z);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(_)}getPayloadLength16(_){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(_)}getPayloadLength64(_){if(this._bufferedBytes<8){this._loop=!1;return}let $=this.consume(8),X=$.readUInt32BE(0);if(X>Math.pow(2,21)-1){let Z=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");_(Z);return}this._payloadLength=X*Math.pow(2,32)+$.readUInt32BE(4),this.haveLength(_)}haveLength(_){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let $=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");_($);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(_){let $=r9;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if($=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)iz($,this._mask)}if(this._opcode>7){this.controlMessage($,_);return}if(this._compressed){this._state=5,this.decompress($,_);return}if($.length)this._messageLength=this._totalPayloadLength,this._fragments.push($);this.dataMessage(_)}decompress(_,$){this._extensions[o9.extensionName].decompress(_,this._fin,(Z,J)=>{if(Z)return $(Z);if(J.length){if(this._messageLength+=J.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let G=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");$(G);return}this._fragments.push(J)}if(this.dataMessage($),this._state===0)this.startLoop($)})}dataMessage(_){if(!this._fin){this._state=0;return}let $=this._messageLength,X=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let Z;if(this._binaryType==="nodebuffer")Z=R4(X,$);else if(this._binaryType==="arraybuffer")Z=lz(R4(X,$));else if(this._binaryType==="blob")Z=new Blob(X);else Z=X;if(this._allowSynchronousEvents)this.emit("message",Z,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!0),this._state=0,this.startLoop(_)})}else{let Z=R4(X,$);if(!this._skipUTF8Validation&&!a9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");_(J);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",Z,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",Z,!1),this._state=0,this.startLoop(_)})}}controlMessage(_,$){if(this._opcode===8){if(_.length===0)this._loop=!1,this.emit("conclude",1005,r9),this.end();else{let X=_.readUInt16BE(0);if(!nz(X)){let J=this.createError(RangeError,`invalid status code ${X}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");$(J);return}let Z=new S6(_.buffer,_.byteOffset+2,_.length-2);if(!this._skipUTF8Validation&&!a9(Z)){let J=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");$(J);return}this._loop=!1,this.emit("conclude",X,Z),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",_),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",_),this._state=0,this.startLoop($)})}createError(_,$,X,Z,J){this._loop=!1,this._errored=!0;let G=new _(X?`Invalid WebSocket frame: ${$}`:$);return Error.captureStackTrace(G,this.createError),G.code=J,G[dz]=Z,G}}e9.exports=t9});var N4=u((kR,X$)=>{var{Duplex:SR}=h("stream"),{randomFillSync:sz}=h("crypto"),_$=w_(),{EMPTY_BUFFER:oz,kWebSocket:rz,NOOP:az}=N1(),{isBlob:q2,isValidStatusCode:tz}=x2(),{mask:$$,toBuffer:a1}=T_(),u0=Symbol("kByteLength"),ez=Buffer.alloc(4),t1,C2=8192,s0=0,_H=1,$H=2;class S1{constructor(_,$,X){if(this._extensions=$||{},X)this._generateMask=X,this._maskBuffer=Buffer.alloc(4);this._socket=_,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=s0,this.onerror=az,this[rz]=void 0}static frame(_,$){let X,Z=!1,J=2,G=!1;if($.mask){if(X=$.maskBuffer||ez,$.generateMask)$.generateMask(X);else{if(C2===8192){if(t1===void 0)t1=Buffer.alloc(8192);sz(t1,0,8192),C2=0}X[0]=t1[C2++],X[1]=t1[C2++],X[2]=t1[C2++],X[3]=t1[C2++]}G=(X[0]|X[1]|X[2]|X[3])===0,J=6}let Y;if(typeof _==="string")if((!$.mask||G)&&$[u0]!==void 0)Y=$[u0];else _=Buffer.from(_),Y=_.length;else Y=_.length,Z=$.mask&&$.readOnly&&!G;let z=Y;if(Y>=65536)J+=8,z=127;else if(Y>125)J+=2,z=126;let H=Buffer.allocUnsafe(Z?Y+J:J);if(H[0]=$.fin?$.opcode|128:$.opcode,$.rsv1)H[0]|=64;if(H[1]=z,z===126)H.writeUInt16BE(Y,2);else if(z===127)H[2]=H[3]=0,H.writeUIntBE(Y,4,6);if(!$.mask)return[H,_];if(H[1]|=128,H[J-4]=X[0],H[J-3]=X[1],H[J-2]=X[2],H[J-1]=X[3],G)return[H,_];if(Z)return $$(_,X,H,J,Y),[H];return $$(_,X,_,0,Y),[H,_]}close(_,$,X,Z){let J;if(_===void 0)J=oz;else if(typeof _!=="number"||!tz(_))throw TypeError("First argument must be a valid error code number");else if($===void 0||!$.length)J=Buffer.allocUnsafe(2),J.writeUInt16BE(_,0);else{let Y=Buffer.byteLength($);if(Y>123)throw RangeError("The message must not be greater than 123 bytes");if(J=Buffer.allocUnsafe(2+Y),J.writeUInt16BE(_,0),typeof $==="string")J.write($,2);else J.set($,2)}let G={[u0]:J.length,fin:!0,generateMask:this._generateMask,mask:X,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==s0)this.enqueue([this.dispatch,J,!1,G,Z]);else this.sendFrame(S1.frame(J,G),Z)}ping(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(q2(_))Z=_.size,J=!1;else _=a1(_),Z=_.length,J=a1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[u0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:9,readOnly:J,rsv1:!1};if(q2(_))if(this._state!==s0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==s0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(S1.frame(_,G),X)}pong(_,$,X){let Z,J;if(typeof _==="string")Z=Buffer.byteLength(_),J=!1;else if(q2(_))Z=_.size,J=!1;else _=a1(_),Z=_.length,J=a1.readOnly;if(Z>125)throw RangeError("The data size must not be greater than 125 bytes");let G={[u0]:Z,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:10,readOnly:J,rsv1:!1};if(q2(_))if(this._state!==s0)this.enqueue([this.getBlobData,_,!1,G,X]);else this.getBlobData(_,!1,G,X);else if(this._state!==s0)this.enqueue([this.dispatch,_,!1,G,X]);else this.sendFrame(S1.frame(_,G),X)}send(_,$,X){let Z=this._extensions[_$.extensionName],J=$.binary?2:1,G=$.compress,Y,z;if(typeof _==="string")Y=Buffer.byteLength(_),z=!1;else if(q2(_))Y=_.size,z=!1;else _=a1(_),Y=_.length,z=a1.readOnly;if(this._firstFragment){if(this._firstFragment=!1,G&&Z&&Z.params[Z._isServer?"server_no_context_takeover":"client_no_context_takeover"])G=Y>=Z._threshold;this._compress=G}else G=!1,J=0;if($.fin)this._firstFragment=!0;let H={[u0]:Y,fin:$.fin,generateMask:this._generateMask,mask:$.mask,maskBuffer:this._maskBuffer,opcode:J,readOnly:z,rsv1:G};if(q2(_))if(this._state!==s0)this.enqueue([this.getBlobData,_,this._compress,H,X]);else this.getBlobData(_,this._compress,H,X);else if(this._state!==s0)this.enqueue([this.dispatch,_,this._compress,H,X]);else this.dispatch(_,this._compress,H,X)}getBlobData(_,$,X,Z){this._bufferedBytes+=X[u0],this._state=$H,_.arrayBuffer().then((J)=>{if(this._socket.destroyed){let Y=Error("The socket was closed while the blob was being read");process.nextTick(V4,this,Y,Z);return}this._bufferedBytes-=X[u0];let G=a1(J);if(!$)this._state=s0,this.sendFrame(S1.frame(G,X),Z),this.dequeue();else this.dispatch(G,$,X,Z)}).catch((J)=>{process.nextTick(XH,this,J,Z)})}dispatch(_,$,X,Z){if(!$){this.sendFrame(S1.frame(_,X),Z);return}let J=this._extensions[_$.extensionName];this._bufferedBytes+=X[u0],this._state=_H,J.compress(_,X.fin,(G,Y)=>{if(this._socket.destroyed){let z=Error("The socket was closed while data was being compressed");V4(this,z,Z);return}this._bufferedBytes-=X[u0],this._state=s0,X.readOnly=!1,this.sendFrame(S1.frame(Y,X),Z),this.dequeue()})}dequeue(){while(this._state===s0&&this._queue.length){let _=this._queue.shift();this._bufferedBytes-=_[3][u0],Reflect.apply(_[0],this,_.slice(1))}}enqueue(_){this._bufferedBytes+=_[3][u0],this._queue.push(_)}sendFrame(_,$){if(_.length===2)this._socket.cork(),this._socket.write(_[0]),this._socket.write(_[1],$),this._socket.uncork();else this._socket.write(_[0],$)}}X$.exports=S1;function V4(_,$,X){if(typeof X==="function")X($);for(let Z=0;Z<_._queue.length;Z++){let J=_._queue[Z],G=J[J.length-1];if(typeof G==="function")G($)}}function XH(_,$,X){V4(_,$,X),_.onerror($)}});var U$=u((vR,F$)=>{var{kForOnEventAttribute:P_,kListener:M4}=N1(),Z$=Symbol("kCode"),J$=Symbol("kData"),G$=Symbol("kError"),Y$=Symbol("kMessage"),z$=Symbol("kReason"),S2=Symbol("kTarget"),H$=Symbol("kType"),W$=Symbol("kWasClean");class k1{constructor(_){this[S2]=null,this[H$]=_}get target(){return this[S2]}get type(){return this[H$]}}Object.defineProperty(k1.prototype,"target",{enumerable:!0});Object.defineProperty(k1.prototype,"type",{enumerable:!0});class k2 extends k1{constructor(_,$={}){super(_);this[Z$]=$.code===void 0?0:$.code,this[z$]=$.reason===void 0?"":$.reason,this[W$]=$.wasClean===void 0?!1:$.wasClean}get code(){return this[Z$]}get reason(){return this[z$]}get wasClean(){return this[W$]}}Object.defineProperty(k2.prototype,"code",{enumerable:!0});Object.defineProperty(k2.prototype,"reason",{enumerable:!0});Object.defineProperty(k2.prototype,"wasClean",{enumerable:!0});class x_ extends k1{constructor(_,$={}){super(_);this[G$]=$.error===void 0?null:$.error,this[Y$]=$.message===void 0?"":$.message}get error(){return this[G$]}get message(){return this[Y$]}}Object.defineProperty(x_.prototype,"error",{enumerable:!0});Object.defineProperty(x_.prototype,"message",{enumerable:!0});class v6 extends k1{constructor(_,$={}){super(_);this[J$]=$.data===void 0?null:$.data}get data(){return this[J$]}}Object.defineProperty(v6.prototype,"data",{enumerable:!0});var ZH={addEventListener(_,$,X={}){for(let J of this.listeners(_))if(!X[P_]&&J[M4]===$&&!J[P_])return;let Z;if(_==="message")Z=function(G,Y){let z=new v6("message",{data:Y?G:G.toString()});z[S2]=this,k6($,this,z)};else if(_==="close")Z=function(G,Y){let z=new k2("close",{code:G,reason:Y.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});z[S2]=this,k6($,this,z)};else if(_==="error")Z=function(G){let Y=new x_("error",{error:G,message:G.message});Y[S2]=this,k6($,this,Y)};else if(_==="open")Z=function(){let G=new k1("open");G[S2]=this,k6($,this,G)};else return;if(Z[P_]=!!X[P_],Z[M4]=$,X.once)this.once(_,Z);else this.on(_,Z)},removeEventListener(_,$){for(let X of this.listeners(_))if(X[M4]===$&&!X[P_]){this.removeListener(_,X);break}}};F$.exports={CloseEvent:k2,ErrorEvent:x_,Event:k1,EventTarget:ZH,MessageEvent:v6};function k6(_,$,X){if(typeof _==="object"&&_.handleEvent)_.handleEvent.call(_,X);else _.call($,X)}});var B4=u((hR,A$)=>{var{tokenChars:q_}=x2();function H1(_,$,X){if(_[$]===void 0)_[$]=[X];else _[$].push(X)}function JH(_){let $=Object.create(null),X=Object.create(null),Z=!1,J=!1,G=!1,Y,z,H=-1,W=-1,F=-1,A=0;for(;A<_.length;A++)if(W=_.charCodeAt(A),Y===void 0)if(F===-1&&q_[W]===1){if(H===-1)H=A}else if(A!==0&&(W===32||W===9)){if(F===-1&&H!==-1)F=A}else if(W===59||W===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(F===-1)F=A;let R=_.slice(H,F);if(W===44)H1($,R,X),X=Object.create(null);else Y=R;H=F=-1}else throw SyntaxError(`Unexpected character at index ${A}`);else if(z===void 0)if(F===-1&&q_[W]===1){if(H===-1)H=A}else if(W===32||W===9){if(F===-1&&H!==-1)F=A}else if(W===59||W===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(F===-1)F=A;if(H1(X,_.slice(H,F),!0),W===44)H1($,Y,X),X=Object.create(null),Y=void 0;H=F=-1}else if(W===61&&H!==-1&&F===-1)z=_.slice(H,A),H=F=-1;else throw SyntaxError(`Unexpected character at index ${A}`);else if(J){if(q_[W]!==1)throw SyntaxError(`Unexpected character at index ${A}`);if(H===-1)H=A;else if(!Z)Z=!0;J=!1}else if(G)if(q_[W]===1){if(H===-1)H=A}else if(W===34&&H!==-1)G=!1,F=A;else if(W===92)J=!0;else throw SyntaxError(`Unexpected character at index ${A}`);else if(W===34&&_.charCodeAt(A-1)===61)G=!0;else if(F===-1&&q_[W]===1){if(H===-1)H=A}else if(H!==-1&&(W===32||W===9)){if(F===-1)F=A}else if(W===59||W===44){if(H===-1)throw SyntaxError(`Unexpected character at index ${A}`);if(F===-1)F=A;let R=_.slice(H,F);if(Z)R=R.replace(/\\/g,""),Z=!1;if(H1(X,z,R),W===44)H1($,Y,X),X=Object.create(null),Y=void 0;z=void 0,H=F=-1}else throw SyntaxError(`Unexpected character at index ${A}`);if(H===-1||G||W===32||W===9)throw SyntaxError("Unexpected end of input");if(F===-1)F=A;let O=_.slice(H,F);if(Y===void 0)H1($,O,X);else{if(z===void 0)H1(X,O,!0);else if(Z)H1(X,z,O.replace(/\\/g,""));else H1(X,z,O);H1($,Y,X)}return $}function GH(_){return Object.keys(_).map(($)=>{let X=_[$];if(!Array.isArray(X))X=[X];return X.map((Z)=>{return[$].concat(Object.keys(Z).map((J)=>{let G=Z[J];if(!Array.isArray(G))G=[G];return G.map((Y)=>Y===!0?J:`${J}=${Y}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}A$.exports={format:GH,parse:JH}});var b6=u((bR,j$)=>{var YH=h("events"),zH=h("https"),HH=h("http"),R$=h("net"),WH=h("tls"),{randomBytes:FH,createHash:UH}=h("crypto"),{Duplex:yR,Readable:fR}=h("stream"),{URL:Q4}=h("url"),v1=w_(),AH=D4(),KH=N4(),{isBlob:OH}=x2(),{BINARY_TYPES:K$,EMPTY_BUFFER:h6,GUID:RH,kForOnEventAttribute:I4,kListener:DH,kStatusCode:VH,kWebSocket:F0,NOOP:D$}=N1(),{EventTarget:{addEventListener:NH,removeEventListener:MH}}=U$(),{format:BH,parse:QH}=B4(),{toBuffer:IH}=T_(),V$=Symbol("kAborted"),E4=[8,13],B1=["CONNECTING","OPEN","CLOSING","CLOSED"],EH=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class C extends YH{constructor(_,$,X){super();if(this._binaryType=K$[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=h6,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=C.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,_!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,$===void 0)$=[];else if(!Array.isArray($))if(typeof $==="object"&&$!==null)X=$,$=[];else $=[$];N$(this,_,$,X)}else this._autoPong=X.autoPong,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(_){if(!K$.includes(_))return;if(this._binaryType=_,this._receiver)this._receiver._binaryType=_}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(_,$,X){let Z=new AH({allowSynchronousEvents:X.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:X.maxPayload,skipUTF8Validation:X.skipUTF8Validation}),J=new KH(_,this._extensions,X.generateMask);if(this._receiver=Z,this._sender=J,this._socket=_,Z[F0]=this,J[F0]=this,_[F0]=this,Z.on("conclude",LH),Z.on("drain",wH),Z.on("error",PH),Z.on("message",xH),Z.on("ping",qH),Z.on("pong",CH),J.onerror=SH,_.setTimeout)_.setTimeout(0);if(_.setNoDelay)_.setNoDelay();if($.length>0)_.unshift($);_.on("close",Q$),_.on("data",f6),_.on("end",I$),_.on("error",E$),this._readyState=C.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[v1.extensionName])this._extensions[v1.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(_,$){if(this.readyState===C.CLOSED)return;if(this.readyState===C.CONNECTING){q0(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===C.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=C.CLOSING,this._sender.close(_,$,!this._isServer,(X)=>{if(X)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),B$(this)}pause(){if(this.readyState===C.CONNECTING||this.readyState===C.CLOSED)return;this._paused=!0,this._socket.pause()}ping(_,$,X){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==C.OPEN){j4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.ping(_||h6,$,X)}pong(_,$,X){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof _==="function")X=_,_=$=void 0;else if(typeof $==="function")X=$,$=void 0;if(typeof _==="number")_=_.toString();if(this.readyState!==C.OPEN){j4(this,_,X);return}if($===void 0)$=!this._isServer;this._sender.pong(_||h6,$,X)}resume(){if(this.readyState===C.CONNECTING||this.readyState===C.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(_,$,X){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")X=$,$={};if(typeof _==="number")_=_.toString();if(this.readyState!==C.OPEN){j4(this,_,X);return}let Z={binary:typeof _!=="string",mask:!this._isServer,compress:!0,fin:!0,...$};if(!this._extensions[v1.extensionName])Z.compress=!1;this._sender.send(_||h6,Z,X)}terminate(){if(this.readyState===C.CLOSED)return;if(this.readyState===C.CONNECTING){q0(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=C.CLOSING,this._socket.destroy()}}Object.defineProperty(C,"CONNECTING",{enumerable:!0,value:B1.indexOf("CONNECTING")});Object.defineProperty(C.prototype,"CONNECTING",{enumerable:!0,value:B1.indexOf("CONNECTING")});Object.defineProperty(C,"OPEN",{enumerable:!0,value:B1.indexOf("OPEN")});Object.defineProperty(C.prototype,"OPEN",{enumerable:!0,value:B1.indexOf("OPEN")});Object.defineProperty(C,"CLOSING",{enumerable:!0,value:B1.indexOf("CLOSING")});Object.defineProperty(C.prototype,"CLOSING",{enumerable:!0,value:B1.indexOf("CLOSING")});Object.defineProperty(C,"CLOSED",{enumerable:!0,value:B1.indexOf("CLOSED")});Object.defineProperty(C.prototype,"CLOSED",{enumerable:!0,value:B1.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((_)=>{Object.defineProperty(C.prototype,_,{enumerable:!0})});["open","error","close","message"].forEach((_)=>{Object.defineProperty(C.prototype,`on${_}`,{enumerable:!0,get(){for(let $ of this.listeners(_))if($[I4])return $[DH];return null},set($){for(let X of this.listeners(_))if(X[I4]){this.removeListener(_,X);break}if(typeof $!=="function")return;this.addEventListener(_,$,{[I4]:!0})}})});C.prototype.addEventListener=NH;C.prototype.removeEventListener=MH;j$.exports=C;function N$(_,$,X,Z){let J={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:E4[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...Z,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(_._autoPong=J.autoPong,!E4.includes(J.protocolVersion))throw RangeError(`Unsupported protocol version: ${J.protocolVersion} (supported versions: ${E4.join(", ")})`);let G;if($ instanceof Q4)G=$;else try{G=new Q4($)}catch(N){throw SyntaxError(`Invalid URL: ${$}`)}if(G.protocol==="http:")G.protocol="ws:";else if(G.protocol==="https:")G.protocol="wss:";_._url=G.href;let Y=G.protocol==="wss:",z=G.protocol==="ws+unix:",H;if(G.protocol!=="ws:"&&!Y&&!z)H=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(z&&!G.pathname)H="The URL's pathname is empty";else if(G.hash)H="The URL contains a fragment identifier";if(H){let N=SyntaxError(H);if(_._redirects===0)throw N;else{y6(_,N);return}}let W=Y?443:80,F=FH(16).toString("base64"),A=Y?zH.request:HH.request,O=new Set,R;if(J.createConnection=J.createConnection||(Y?TH:jH),J.defaultPort=J.defaultPort||W,J.port=G.port||W,J.host=G.hostname.startsWith("[")?G.hostname.slice(1,-1):G.hostname,J.headers={...J.headers,"Sec-WebSocket-Version":J.protocolVersion,"Sec-WebSocket-Key":F,Connection:"Upgrade",Upgrade:"websocket"},J.path=G.pathname+G.search,J.timeout=J.handshakeTimeout,J.perMessageDeflate)R=new v1(J.perMessageDeflate!==!0?J.perMessageDeflate:{},!1,J.maxPayload),J.headers["Sec-WebSocket-Extensions"]=BH({[v1.extensionName]:R.offer()});if(X.length){for(let N of X){if(typeof N!=="string"||!EH.test(N)||O.has(N))throw SyntaxError("An invalid or duplicated subprotocol was specified");O.add(N)}J.headers["Sec-WebSocket-Protocol"]=X.join(",")}if(J.origin)if(J.protocolVersion<13)J.headers["Sec-WebSocket-Origin"]=J.origin;else J.headers.Origin=J.origin;if(G.username||G.password)J.auth=`${G.username}:${G.password}`;if(z){let N=J.path.split(":");J.socketPath=N[0],J.path=N[1]}let D;if(J.followRedirects){if(_._redirects===0){_._originalIpc=z,_._originalSecure=Y,_._originalHostOrSocketPath=z?J.socketPath:G.host;let N=Z&&Z.headers;if(Z={...Z,headers:{}},N)for(let[Q,w]of Object.entries(N))Z.headers[Q.toLowerCase()]=w}else if(_.listenerCount("redirect")===0){let N=z?_._originalIpc?J.socketPath===_._originalHostOrSocketPath:!1:_._originalIpc?!1:G.host===_._originalHostOrSocketPath;if(!N||_._originalSecure&&!Y){if(delete J.headers.authorization,delete J.headers.cookie,!N)delete J.headers.host;J.auth=void 0}}if(J.auth&&!Z.headers.authorization)Z.headers.authorization="Basic "+Buffer.from(J.auth).toString("base64");if(D=_._req=A(J),_._redirects)_.emit("redirect",_.url,D)}else D=_._req=A(J);if(J.timeout)D.on("timeout",()=>{q0(_,D,"Opening handshake has timed out")});if(D.on("error",(N)=>{if(D===null||D[V$])return;D=_._req=null,y6(_,N)}),D.on("response",(N)=>{let Q=N.headers.location,w=N.statusCode;if(Q&&J.followRedirects&&w>=300&&w<400){if(++_._redirects>J.maxRedirects){q0(_,D,"Maximum redirects exceeded");return}D.abort();let j;try{j=new Q4(Q,$)}catch(E){let d=SyntaxError(`Invalid URL: ${Q}`);y6(_,d);return}N$(_,j,X,Z)}else if(!_.emit("unexpected-response",D,N))q0(_,D,`Unexpected server response: ${N.statusCode}`)}),D.on("upgrade",(N,Q,w)=>{if(_.emit("upgrade",N),_.readyState!==C.CONNECTING)return;D=_._req=null;let j=N.headers.upgrade;if(j===void 0||j.toLowerCase()!=="websocket"){q0(_,Q,"Invalid Upgrade header");return}let E=UH("sha1").update(F+RH).digest("base64");if(N.headers["sec-websocket-accept"]!==E){q0(_,Q,"Invalid Sec-WebSocket-Accept header");return}let d=N.headers["sec-websocket-protocol"],X0;if(d!==void 0){if(!O.size)X0="Server sent a subprotocol but none was requested";else if(!O.has(d))X0="Server sent an invalid subprotocol"}else if(O.size)X0="Server sent no subprotocol";if(X0){q0(_,Q,X0);return}if(d)_._protocol=d;let P=N.headers["sec-websocket-extensions"];if(P!==void 0){if(!R){q0(_,Q,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let g;try{g=QH(P)}catch(T1){q0(_,Q,"Invalid Sec-WebSocket-Extensions header");return}let h0=Object.keys(g);if(h0.length!==1||h0[0]!==v1.extensionName){q0(_,Q,"Server indicated an extension that was not requested");return}try{R.accept(g[v1.extensionName])}catch(T1){q0(_,Q,"Invalid Sec-WebSocket-Extensions header");return}_._extensions[v1.extensionName]=R}_.setSocket(Q,w,{allowSynchronousEvents:J.allowSynchronousEvents,generateMask:J.generateMask,maxPayload:J.maxPayload,skipUTF8Validation:J.skipUTF8Validation})}),J.finishRequest)J.finishRequest(D,_);else D.end()}function y6(_,$){_._readyState=C.CLOSING,_._errorEmitted=!0,_.emit("error",$),_.emitClose()}function jH(_){return _.path=_.socketPath,R$.connect(_)}function TH(_){if(_.path=void 0,!_.servername&&_.servername!=="")_.servername=R$.isIP(_.host)?"":_.host;return WH.connect(_)}function q0(_,$,X){_._readyState=C.CLOSING;let Z=Error(X);if(Error.captureStackTrace(Z,q0),$.setHeader){if($[V$]=!0,$.abort(),$.socket&&!$.socket.destroyed)$.socket.destroy();process.nextTick(y6,_,Z)}else $.destroy(Z),$.once("error",_.emit.bind(_,"error")),$.once("close",_.emitClose.bind(_))}function j4(_,$,X){if($){let Z=OH($)?$.size:IH($).length;if(_._socket)_._sender._bufferedBytes+=Z;else _._bufferedAmount+=Z}if(X){let Z=Error(`WebSocket is not open: readyState ${_.readyState} (${B1[_.readyState]})`);process.nextTick(X,Z)}}function LH(_,$){let X=this[F0];if(X._closeFrameReceived=!0,X._closeMessage=$,X._closeCode=_,X._socket[F0]===void 0)return;if(X._socket.removeListener("data",f6),process.nextTick(M$,X._socket),_===1005)X.close();else X.close(_,$)}function wH(){let _=this[F0];if(!_.isPaused)_._socket.resume()}function PH(_){let $=this[F0];if($._socket[F0]!==void 0)$._socket.removeListener("data",f6),process.nextTick(M$,$._socket),$.close(_[VH]);if(!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function O$(){this[F0].emitClose()}function xH(_,$){this[F0].emit("message",_,$)}function qH(_){let $=this[F0];if($._autoPong)$.pong(_,!this._isServer,D$);$.emit("ping",_)}function CH(_){this[F0].emit("pong",_)}function M$(_){_.resume()}function SH(_){let $=this[F0];if($.readyState===C.CLOSED)return;if($.readyState===C.OPEN)$._readyState=C.CLOSING,B$($);if(this._socket.end(),!$._errorEmitted)$._errorEmitted=!0,$.emit("error",_)}function B$(_){_._closeTimer=setTimeout(_._socket.destroy.bind(_._socket),30000)}function Q$(){let _=this[F0];this.removeListener("close",Q$),this.removeListener("data",f6),this.removeListener("end",I$),_._readyState=C.CLOSING;let $;if(!this._readableState.endEmitted&&!_._closeFrameReceived&&!_._receiver._writableState.errorEmitted&&($=_._socket.read())!==null)_._receiver.write($);if(_._receiver.end(),this[F0]=void 0,clearTimeout(_._closeTimer),_._receiver._writableState.finished||_._receiver._writableState.errorEmitted)_.emitClose();else _._receiver.on("error",O$),_._receiver.on("finish",O$)}function f6(_){if(!this[F0]._receiver.write(_))this.pause()}function I$(){let _=this[F0];_._readyState=C.CLOSING,_._receiver.end(),this.end()}function E$(){let _=this[F0];if(this.removeListener("error",E$),this.on("error",D$),_)_._readyState=C.CLOSING,this.destroy()}});var P$=u((pR,w$)=>{var gR=b6(),{Duplex:kH}=h("stream");function T$(_){_.emit("close")}function vH(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function L$(_){if(this.removeListener("error",L$),this.destroy(),this.listenerCount("error")===0)this.emit("error",_)}function hH(_,$){let X=!0,Z=new kH({...$,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return _.on("message",function(G,Y){let z=!Y&&Z._readableState.objectMode?G.toString():G;if(!Z.push(z))_.pause()}),_.once("error",function(G){if(Z.destroyed)return;X=!1,Z.destroy(G)}),_.once("close",function(){if(Z.destroyed)return;Z.push(null)}),Z._destroy=function(J,G){if(_.readyState===_.CLOSED){G(J),process.nextTick(T$,Z);return}let Y=!1;if(_.once("error",function(H){Y=!0,G(H)}),_.once("close",function(){if(!Y)G(J);process.nextTick(T$,Z)}),X)_.terminate()},Z._final=function(J){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._final(J)});return}if(_._socket===null)return;if(_._socket._writableState.finished){if(J(),Z._readableState.endEmitted)Z.destroy()}else _._socket.once("finish",function(){J()}),_.close()},Z._read=function(){if(_.isPaused)_.resume()},Z._write=function(J,G,Y){if(_.readyState===_.CONNECTING){_.once("open",function(){Z._write(J,G,Y)});return}_.send(J,Y)},Z.on("end",vH),Z.on("error",L$),Z}w$.exports=hH});var q$=u((mR,x$)=>{var{tokenChars:yH}=x2();function fH(_){let $=new Set,X=-1,Z=-1,J=0;for(J;J<_.length;J++){let Y=_.charCodeAt(J);if(Z===-1&&yH[Y]===1){if(X===-1)X=J}else if(J!==0&&(Y===32||Y===9)){if(Z===-1&&X!==-1)Z=J}else if(Y===44){if(X===-1)throw SyntaxError(`Unexpected character at index ${J}`);if(Z===-1)Z=J;let z=_.slice(X,Z);if($.has(z))throw SyntaxError(`The "${z}" subprotocol is duplicated`);$.add(z),X=Z=-1}else throw SyntaxError(`Unexpected character at index ${J}`)}if(X===-1||Z!==-1)throw SyntaxError("Unexpected end of input");let G=_.slice(X,J);if($.has(G))throw SyntaxError(`The "${G}" subprotocol is duplicated`);return $.add(G),$}x$.exports={parse:fH}});var h$=u((dR,v$)=>{var bH=h("events"),g6=h("http"),{Duplex:uR}=h("stream"),{createHash:gH}=h("crypto"),C$=B4(),e1=w_(),pH=q$(),mH=b6(),{GUID:uH,kWebSocket:dH}=N1(),cH=/^[+/0-9A-Za-z]{22}==$/;class k$ extends bH{constructor(_,$){super();if(_={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:mH,..._},_.port==null&&!_.server&&!_.noServer||_.port!=null&&(_.server||_.noServer)||_.server&&_.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(_.port!=null)this._server=g6.createServer((X,Z)=>{let J=g6.STATUS_CODES[426];Z.writeHead(426,{"Content-Length":J.length,"Content-Type":"text/plain"}),Z.end(J)}),this._server.listen(_.port,_.host,_.backlog,$);else if(_.server)this._server=_.server;if(this._server){let X=this.emit.bind(this,"connection");this._removeListeners=lH(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(Z,J,G)=>{this.handleUpgrade(Z,J,G,X)}})}if(_.perMessageDeflate===!0)_.perMessageDeflate={};if(_.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=_,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(_){if(this._state===2){if(_)this.once("close",()=>{_(Error("The server is not running"))});process.nextTick(C_,this);return}if(_)this.once("close",_);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(C_,this);else this._shouldEmitClose=!0;else process.nextTick(C_,this)}else{let $=this._server;this._removeListeners(),this._removeListeners=this._server=null,$.close(()=>{C_(this)})}}shouldHandle(_){if(this.options.path){let $=_.url.indexOf("?");if(($!==-1?_.url.slice(0,$):_.url)!==this.options.path)return!1}return!0}handleUpgrade(_,$,X,Z){$.on("error",S$);let J=_.headers["sec-websocket-key"],G=_.headers.upgrade,Y=+_.headers["sec-websocket-version"];if(_.method!=="GET"){_2(this,_,$,405,"Invalid HTTP method");return}if(G===void 0||G.toLowerCase()!=="websocket"){_2(this,_,$,400,"Invalid Upgrade header");return}if(J===void 0||!cH.test(J)){_2(this,_,$,400,"Missing or invalid Sec-WebSocket-Key header");return}if(Y!==13&&Y!==8){_2(this,_,$,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(_)){S_($,400);return}let z=_.headers["sec-websocket-protocol"],H=new Set;if(z!==void 0)try{H=pH.parse(z)}catch(A){_2(this,_,$,400,"Invalid Sec-WebSocket-Protocol header");return}let W=_.headers["sec-websocket-extensions"],F={};if(this.options.perMessageDeflate&&W!==void 0){let A=new e1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let O=C$.parse(W);if(O[e1.extensionName])A.accept(O[e1.extensionName]),F[e1.extensionName]=A}catch(O){_2(this,_,$,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let A={origin:_.headers[`${Y===8?"sec-websocket-origin":"origin"}`],secure:!!(_.socket.authorized||_.socket.encrypted),req:_};if(this.options.verifyClient.length===2){this.options.verifyClient(A,(O,R,D,N)=>{if(!O)return S_($,R||401,D,N);this.completeUpgrade(F,J,H,_,$,X,Z)});return}if(!this.options.verifyClient(A))return S_($,401)}this.completeUpgrade(F,J,H,_,$,X,Z)}completeUpgrade(_,$,X,Z,J,G,Y){if(!J.readable||!J.writable)return J.destroy();if(J[dH])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return S_(J,503);let H=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${gH("sha1").update($+uH).digest("base64")}`],W=new this.options.WebSocket(null,void 0,this.options);if(X.size){let F=this.options.handleProtocols?this.options.handleProtocols(X,Z):X.values().next().value;if(F)H.push(`Sec-WebSocket-Protocol: ${F}`),W._protocol=F}if(_[e1.extensionName]){let F=_[e1.extensionName].params,A=C$.format({[e1.extensionName]:[F]});H.push(`Sec-WebSocket-Extensions: ${A}`),W._extensions=_}if(this.emit("headers",H,Z),J.write(H.concat(`\r
`).join(`\r
`)),J.removeListener("error",S$),W.setSocket(J,G,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(W),W.on("close",()=>{if(this.clients.delete(W),this._shouldEmitClose&&!this.clients.size)process.nextTick(C_,this)});Y(W,Z)}}v$.exports=k$;function lH(_,$){for(let X of Object.keys($))_.on(X,$[X]);return function(){for(let Z of Object.keys($))_.removeListener(Z,$[Z])}}function C_(_){_._state=2,_.emit("close")}function S$(){this.destroy()}function S_(_,$,X,Z){X=X||g6.STATUS_CODES[$],Z={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(X),...Z},_.once("finish",_.destroy),_.end(`HTTP/1.1 ${$} ${g6.STATUS_CODES[$]}\r
`+Object.keys(Z).map((J)=>`${J}: ${Z[J]}`).join(`\r
`)+`\r
\r
`+X)}function _2(_,$,X,Z,J,G){if(_.listenerCount("wsClientError")){let Y=Error(J);Error.captureStackTrace(Y,_2),_.emit("wsClientError",Y,X,$)}else S_(X,Z,J,G)}});var p4=u((uN,OX)=>{function FF(_){var $=0,X=[];function Z(){if($--,$<_)J()}function J(){var H=X.shift();if(z.queue=X.length,H)Y(H.fn).then(H.resolve).catch(H.reject)}function G(H){return new Promise(function(W,F){X.push({fn:H,resolve:W,reject:F}),z.queue=X.length})}function Y(H){$++;try{return Promise.resolve(H()).then(function(W){return Z(),W},function(W){throw Z(),W})}catch(W){return Z(),Promise.reject(W)}}var z=function(H){if($>=_)return G(H);else return Y(H)};return z}function UF(_,$){var X=!1,Z=this;return Promise.all(_.map(function(){var J=arguments;return Z(function(){if(!X)return $.apply(void 0,J).catch(function(G){throw X=!0,G})})}))}function KX(_){return _.queue=0,_.map=UF,_}OX.exports=function(_){if(_)return KX(FF(_));else return KX(function($){return $()})}});var n5=T0(i5(),1),{program:wU,createCommand:PU,createArgument:xU,createOption:qU,CommanderError:CU,InvalidArgumentError:SU,InvalidOptionArgumentError:kU,Command:B0,Argument:vU,Option:hU,Help:yU}=n5.default;var s5=(_=0)=>($)=>`\x1B[${$+_}m`,o5=(_=0)=>($)=>`\x1B[${38+_};5;${$}m`,r5=(_=0)=>($,X,Z)=>`\x1B[${38+_};2;${$};${X};${Z}m`,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},bU=Object.keys(s.modifier),rJ=Object.keys(s.color),aJ=Object.keys(s.bgColor),gU=[...rJ,...aJ];function tJ(){let _=new Map;for(let[$,X]of Object.entries(s)){for(let[Z,J]of Object.entries(X))s[Z]={open:`\x1B[${J[0]}m`,close:`\x1B[${J[1]}m`},X[Z]=s[Z],_.set(J[0],J[1]);Object.defineProperty(s,$,{value:X,enumerable:!1})}return Object.defineProperty(s,"codes",{value:_,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi=s5(),s.color.ansi256=o5(),s.color.ansi16m=r5(),s.bgColor.ansi=s5(10),s.bgColor.ansi256=o5(10),s.bgColor.ansi16m=r5(10),Object.defineProperties(s,{rgbToAnsi256:{value($,X,Z){if($===X&&X===Z){if($<8)return 16;if($>248)return 231;return Math.round(($-8)/247*24)+232}return 16+36*Math.round($/255*5)+6*Math.round(X/255*5)+Math.round(Z/255*5)},enumerable:!1},hexToRgb:{value($){let X=/[a-f\d]{6}|[a-f\d]{3}/i.exec($.toString(16));if(!X)return[0,0,0];let[Z]=X;if(Z.length===3)Z=[...Z].map((G)=>G+G).join("");let J=Number.parseInt(Z,16);return[J>>16&255,J>>8&255,J&255]},enumerable:!1},hexToAnsi256:{value:($)=>s.rgbToAnsi256(...s.hexToRgb($)),enumerable:!1},ansi256ToAnsi:{value($){if($<8)return 30+$;if($<16)return 90+($-8);let X,Z,J;if($>=232)X=(($-232)*10+8)/255,Z=X,J=X;else{$-=16;let z=$%36;X=Math.floor($/36)/5,Z=Math.floor(z/6)/5,J=z%6/5}let G=Math.max(X,Z,J)*2;if(G===0)return 30;let Y=30+(Math.round(J)<<2|Math.round(Z)<<1|Math.round(X));if(G===2)Y+=60;return Y},enumerable:!1},rgbToAnsi:{value:($,X,Z)=>s.ansi256ToAnsi(s.rgbToAnsi256($,X,Z)),enumerable:!1},hexToAnsi:{value:($)=>s.ansi256ToAnsi(s.hexToAnsi256($)),enumerable:!1}}),s}var eJ=tJ(),i0=eJ;import T8 from"node:process";import _G from"node:os";import a5 from"node:tty";function y0(_,$=globalThis.Deno?globalThis.Deno.args:T8.argv){let X=_.startsWith("-")?"":_.length===1?"-":"--",Z=$.indexOf(X+_),J=$.indexOf("--");return Z!==-1&&(J===-1||Z<J)}var{env:o}=T8,G6;if(y0("no-color")||y0("no-colors")||y0("color=false")||y0("color=never"))G6=0;else if(y0("color")||y0("colors")||y0("color=true")||y0("color=always"))G6=1;function $G(){if("FORCE_COLOR"in o){if(o.FORCE_COLOR==="true")return 1;if(o.FORCE_COLOR==="false")return 0;return o.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(o.FORCE_COLOR,10),3)}}function XG(_){if(_===0)return!1;return{level:_,hasBasic:!0,has256:_>=2,has16m:_>=3}}function ZG(_,{streamIsTTY:$,sniffFlags:X=!0}={}){let Z=$G();if(Z!==void 0)G6=Z;let J=X?G6:Z;if(J===0)return 0;if(X){if(y0("color=16m")||y0("color=full")||y0("color=truecolor"))return 3;if(y0("color=256"))return 2}if("TF_BUILD"in o&&"AGENT_NAME"in o)return 1;if(_&&!$&&J===void 0)return 0;let G=J||0;if(o.TERM==="dumb")return G;if(T8.platform==="win32"){let Y=_G.release().split(".");if(Number(Y[0])>=10&&Number(Y[2])>=10586)return Number(Y[2])>=14931?3:2;return 1}if("CI"in o){if(["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some((Y)=>(Y in o)))return 3;if(["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some((Y)=>(Y in o))||o.CI_NAME==="codeship")return 1;return G}if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if(o.COLORTERM==="truecolor")return 3;if(o.TERM==="xterm-kitty")return 3;if(o.TERM==="xterm-ghostty")return 3;if(o.TERM==="wezterm")return 3;if("TERM_PROGRAM"in o){let Y=Number.parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return Y>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(o.TERM))return 2;if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM))return 1;if("COLORTERM"in o)return 1;return G}function t5(_,$={}){let X=ZG(_,{streamIsTTY:_&&_.isTTY,...$});return XG(X)}var JG={stdout:t5({isTTY:a5.isatty(1)}),stderr:t5({isTTY:a5.isatty(2)})},e5=JG;function _3(_,$,X){let Z=_.indexOf($);if(Z===-1)return _;let J=$.length,G=0,Y="";do Y+=_.slice(G,Z)+$+X,G=Z+J,Z=_.indexOf($,G);while(Z!==-1);return Y+=_.slice(G),Y}function $3(_,$,X,Z){let J=0,G="";do{let Y=_[Z-1]==="\r";G+=_.slice(J,Y?Z-1:Z)+$+(Y?`\r
`:`
`)+X,J=Z+1,Z=_.indexOf(`
`,J)}while(Z!==-1);return G+=_.slice(J),G}var{stdout:X3,stderr:Z3}=e5,L8=Symbol("GENERATOR"),O2=Symbol("STYLER"),J_=Symbol("IS_EMPTY"),J3=["ansi","ansi","ansi256","ansi16m"],R2=Object.create(null),GG=(_,$={})=>{if($.level&&!(Number.isInteger($.level)&&$.level>=0&&$.level<=3))throw Error("The `level` option should be an integer from 0 to 3");let X=X3?X3.level:0;_.level=$.level===void 0?X:$.level};var YG=(_)=>{let $=(...X)=>X.join(" ");return GG($,_),Object.setPrototypeOf($,G_.prototype),$};function G_(_){return YG(_)}Object.setPrototypeOf(G_.prototype,Function.prototype);for(let[_,$]of Object.entries(i0))R2[_]={get(){let X=Y6(this,P8($.open,$.close,this[O2]),this[J_]);return Object.defineProperty(this,_,{value:X}),X}};R2.visible={get(){let _=Y6(this,this[O2],!0);return Object.defineProperty(this,"visible",{value:_}),_}};var w8=(_,$,X,...Z)=>{if(_==="rgb"){if($==="ansi16m")return i0[X].ansi16m(...Z);if($==="ansi256")return i0[X].ansi256(i0.rgbToAnsi256(...Z));return i0[X].ansi(i0.rgbToAnsi(...Z))}if(_==="hex")return w8("rgb",$,X,...i0.hexToRgb(...Z));return i0[X][_](...Z)},zG=["rgb","hex","ansi256"];for(let _ of zG){R2[_]={get(){let{level:X}=this;return function(...Z){let J=P8(w8(_,J3[X],"color",...Z),i0.color.close,this[O2]);return Y6(this,J,this[J_])}}};let $="bg"+_[0].toUpperCase()+_.slice(1);R2[$]={get(){let{level:X}=this;return function(...Z){let J=P8(w8(_,J3[X],"bgColor",...Z),i0.bgColor.close,this[O2]);return Y6(this,J,this[J_])}}}}var HG=Object.defineProperties(()=>{},{...R2,level:{enumerable:!0,get(){return this[L8].level},set(_){this[L8].level=_}}}),P8=(_,$,X)=>{let Z,J;if(X===void 0)Z=_,J=$;else Z=X.openAll+_,J=$+X.closeAll;return{open:_,close:$,openAll:Z,closeAll:J,parent:X}},Y6=(_,$,X)=>{let Z=(...J)=>WG(Z,J.length===1?""+J[0]:J.join(" "));return Object.setPrototypeOf(Z,HG),Z[L8]=_,Z[O2]=$,Z[J_]=X,Z},WG=(_,$)=>{if(_.level<=0||!$)return _[J_]?"":$;let X=_[O2];if(X===void 0)return $;let{openAll:Z,closeAll:J}=X;if($.includes("\x1B"))while(X!==void 0)$=_3($,X.close,X.open),X=X.parent;let G=$.indexOf(`
`);if(G!==-1)$=$3($,J,Z,G);return Z+$+J};Object.defineProperties(G_.prototype,R2);var FG=G_(),oU=G_({level:Z3?Z3.level:0});var M=FG;import K6 from"node:process";import K3 from"node:process";import W6 from"node:process";var UG=(_,$,X,Z)=>{if(X==="length"||X==="prototype")return;if(X==="arguments"||X==="caller")return;let J=Object.getOwnPropertyDescriptor(_,X),G=Object.getOwnPropertyDescriptor($,X);if(!AG(J,G)&&Z)return;Object.defineProperty(_,X,G)},AG=function(_,$){return _===void 0||_.configurable||_.writable===$.writable&&_.enumerable===$.enumerable&&_.configurable===$.configurable&&(_.writable||_.value===$.value)},KG=(_,$)=>{let X=Object.getPrototypeOf($);if(X===Object.getPrototypeOf(_))return;Object.setPrototypeOf(_,X)},OG=(_,$)=>`/* Wrapped ${_}*/
${$}`,RG=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),DG=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),VG=(_,$,X)=>{let Z=X===""?"":`with ${X.trim()}() `,J=OG.bind(null,Z,$.toString());Object.defineProperty(J,"name",DG);let{writable:G,enumerable:Y,configurable:z}=RG;Object.defineProperty(_,"toString",{value:J,writable:G,enumerable:Y,configurable:z})};function x8(_,$,{ignoreNonConfigurable:X=!1}={}){let{name:Z}=_;for(let J of Reflect.ownKeys($))UG(_,$,J,X);return KG(_,$),VG(_,$,Z),_}var z6=new WeakMap,G3=(_,$={})=>{if(typeof _!=="function")throw TypeError("Expected a function");let X,Z=0,J=_.displayName||_.name||"<anonymous>",G=function(...Y){if(z6.set(G,++Z),Z===1)X=_.apply(this,Y),_=void 0;else if($.throw===!0)throw Error(`Function \`${J}\` can only be called once`);return X};return x8(G,_),z6.set(G,Z),G};G3.callCount=(_)=>{if(!z6.has(_))throw Error(`The given function \`${_.name}\` is not wrapped by the \`onetime\` package`);return z6.get(_)};var Y3=G3;var l1=[];l1.push("SIGHUP","SIGINT","SIGTERM");if(process.platform!=="win32")l1.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");if(process.platform==="linux")l1.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var H6=(_)=>!!_&&typeof _==="object"&&typeof _.removeListener==="function"&&typeof _.emit==="function"&&typeof _.reallyExit==="function"&&typeof _.listeners==="function"&&typeof _.kill==="function"&&typeof _.pid==="number"&&typeof _.on==="function",q8=Symbol.for("signal-exit emitter"),C8=globalThis,NG=Object.defineProperty.bind(Object);class z3{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(C8[q8])return C8[q8];NG(C8,q8,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(_,$){this.listeners[_].push($)}removeListener(_,$){let X=this.listeners[_],Z=X.indexOf($);if(Z===-1)return;if(Z===0&&X.length===1)X.length=0;else X.splice(Z,1)}emit(_,$,X){if(this.emitted[_])return!1;this.emitted[_]=!0;let Z=!1;for(let J of this.listeners[_])Z=J($,X)===!0||Z;if(_==="exit")Z=this.emit("afterExit",$,X)||Z;return Z}}class k8{}var MG=(_)=>{return{onExit($,X){return _.onExit($,X)},load(){return _.load()},unload(){return _.unload()}}};class H3 extends k8{onExit(){return()=>{}}load(){}unload(){}}class W3 extends k8{#_=S8.platform==="win32"?"SIGINT":"SIGHUP";#$=new z3;#X;#Z;#J;#G={};#Y=!1;constructor(_){super();this.#X=_,this.#G={};for(let $ of l1)this.#G[$]=()=>{let X=this.#X.listeners($),{count:Z}=this.#$,J=_;if(typeof J.__signal_exit_emitter__==="object"&&typeof J.__signal_exit_emitter__.count==="number")Z+=J.__signal_exit_emitter__.count;if(X.length===Z){this.unload();let G=this.#$.emit("exit",null,$),Y=$==="SIGHUP"?this.#_:$;if(!G)_.kill(_.pid,Y)}};this.#J=_.reallyExit,this.#Z=_.emit}onExit(_,$){if(!H6(this.#X))return()=>{};if(this.#Y===!1)this.load();let X=$?.alwaysLast?"afterExit":"exit";return this.#$.on(X,_),()=>{if(this.#$.removeListener(X,_),this.#$.listeners.exit.length===0&&this.#$.listeners.afterExit.length===0)this.unload()}}load(){if(this.#Y)return;this.#Y=!0,this.#$.count+=1;for(let _ of l1)try{let $=this.#G[_];if($)this.#X.on(_,$)}catch($){}this.#X.emit=(_,...$)=>{return this.#H(_,...$)},this.#X.reallyExit=(_)=>{return this.#z(_)}}unload(){if(!this.#Y)return;this.#Y=!1,l1.forEach((_)=>{let $=this.#G[_];if(!$)throw Error("Listener not defined for signal: "+_);try{this.#X.removeListener(_,$)}catch(X){}}),this.#X.emit=this.#Z,this.#X.reallyExit=this.#J,this.#$.count-=1}#z(_){if(!H6(this.#X))return 0;return this.#X.exitCode=_||0,this.#$.emit("exit",this.#X.exitCode,null),this.#J.call(this.#X,this.#X.exitCode)}#H(_,...$){let X=this.#Z;if(_==="exit"&&H6(this.#X)){if(typeof $[0]==="number")this.#X.exitCode=$[0];let Z=X.call(this.#X,_,...$);return this.#$.emit("exit",this.#X.exitCode,null),Z}else return X.call(this.#X,_,...$)}}var S8=globalThis.process,{onExit:F3,load:XA,unload:ZA}=MG(H6(S8)?new W3(S8):new H3);var U3=W6.stderr.isTTY?W6.stderr:W6.stdout.isTTY?W6.stdout:void 0,BG=U3?Y3(()=>{F3(()=>{U3.write("\x1B[?25h")},{alwaysLast:!0})}):()=>{},A3=BG;var F6=!1,D2={};D2.show=(_=K3.stderr)=>{if(!_.isTTY)return;F6=!1,_.write("\x1B[?25h")};D2.hide=(_=K3.stderr)=>{if(!_.isTTY)return;A3(),F6=!0,_.write("\x1B[?25l")};D2.toggle=(_,$)=>{if(_!==void 0)F6=_;if(F6)D2.show($);else D2.hide($)};var v8=D2;var h8={dots:{interval:80,frames:["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"]},dots2:{interval:80,frames:["⣾","⣽","⣻","⢿","⡿","⣟","⣯","⣷"]},dots3:{interval:80,frames:["⠋","⠙","⠚","⠞","⠖","⠦","⠴","⠲","⠳","⠓"]},dots4:{interval:80,frames:["⠄","⠆","⠇","⠋","⠙","⠸","⠰","⠠","⠰","⠸","⠙","⠋","⠇","⠆"]},dots5:{interval:80,frames:["⠋","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋"]},dots6:{interval:80,frames:["⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠴","⠲","⠒","⠂","⠂","⠒","⠚","⠙","⠉","⠁"]},dots7:{interval:80,frames:["⠈","⠉","⠋","⠓","⠒","⠐","⠐","⠒","⠖","⠦","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈"]},dots8:{interval:80,frames:["⠁","⠁","⠉","⠙","⠚","⠒","⠂","⠂","⠒","⠲","⠴","⠤","⠄","⠄","⠤","⠠","⠠","⠤","⠦","⠖","⠒","⠐","⠐","⠒","⠓","⠋","⠉","⠈","⠈"]},dots9:{interval:80,frames:["⢹","⢺","⢼","⣸","⣇","⡧","⡗","⡏"]},dots10:{interval:80,frames:["⢄","⢂","⢁","⡁","⡈","⡐","⡠"]},dots11:{interval:100,frames:["⠁","⠂","⠄","⡀","⢀","⠠","⠐","⠈"]},dots12:{interval:80,frames:["⢀⠀","⡀⠀","⠄⠀","⢂⠀","⡂⠀","⠅⠀","⢃⠀","⡃⠀","⠍⠀","⢋⠀","⡋⠀","⠍⠁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⢈⠩","⡀⢙","⠄⡙","⢂⠩","⡂⢘","⠅⡘","⢃⠨","⡃⢐","⠍⡐","⢋⠠","⡋⢀","⠍⡁","⢋⠁","⡋⠁","⠍⠉","⠋⠉","⠋⠉","⠉⠙","⠉⠙","⠉⠩","⠈⢙","⠈⡙","⠈⠩","⠀⢙","⠀⡙","⠀⠩","⠀⢘","⠀⡘","⠀⠨","⠀⢐","⠀⡐","⠀⠠","⠀⢀","⠀⡀"]},dots13:{interval:80,frames:["⣼","⣹","⢻","⠿","⡟","⣏","⣧","⣶"]},dots14:{interval:80,frames:["⠉⠉","⠈⠙","⠀⠹","⠀⢸","⠀⣰","⢀⣠","⣀⣀","⣄⡀","⣆⠀","⡇⠀","⠏⠀","⠋⠁"]},dots8Bit:{interval:80,frames:["⠀","⠁","⠂","⠃","⠄","⠅","⠆","⠇","⡀","⡁","⡂","⡃","⡄","⡅","⡆","⡇","⠈","⠉","⠊","⠋","⠌","⠍","⠎","⠏","⡈","⡉","⡊","⡋","⡌","⡍","⡎","⡏","⠐","⠑","⠒","⠓","⠔","⠕","⠖","⠗","⡐","⡑","⡒","⡓","⡔","⡕","⡖","⡗","⠘","⠙","⠚","⠛","⠜","⠝","⠞","⠟","⡘","⡙","⡚","⡛","⡜","⡝","⡞","⡟","⠠","⠡","⠢","⠣","⠤","⠥","⠦","⠧","⡠","⡡","⡢","⡣","⡤","⡥","⡦","⡧","⠨","⠩","⠪","⠫","⠬","⠭","⠮","⠯","⡨","⡩","⡪","⡫","⡬","⡭","⡮","⡯","⠰","⠱","⠲","⠳","⠴","⠵","⠶","⠷","⡰","⡱","⡲","⡳","⡴","⡵","⡶","⡷","⠸","⠹","⠺","⠻","⠼","⠽","⠾","⠿","⡸","⡹","⡺","⡻","⡼","⡽","⡾","⡿","⢀","⢁","⢂","⢃","⢄","⢅","⢆","⢇","⣀","⣁","⣂","⣃","⣄","⣅","⣆","⣇","⢈","⢉","⢊","⢋","⢌","⢍","⢎","⢏","⣈","⣉","⣊","⣋","⣌","⣍","⣎","⣏","⢐","⢑","⢒","⢓","⢔","⢕","⢖","⢗","⣐","⣑","⣒","⣓","⣔","⣕","⣖","⣗","⢘","⢙","⢚","⢛","⢜","⢝","⢞","⢟","⣘","⣙","⣚","⣛","⣜","⣝","⣞","⣟","⢠","⢡","⢢","⢣","⢤","⢥","⢦","⢧","⣠","⣡","⣢","⣣","⣤","⣥","⣦","⣧","⢨","⢩","⢪","⢫","⢬","⢭","⢮","⢯","⣨","⣩","⣪","⣫","⣬","⣭","⣮","⣯","⢰","⢱","⢲","⢳","⢴","⢵","⢶","⢷","⣰","⣱","⣲","⣳","⣴","⣵","⣶","⣷","⢸","⢹","⢺","⢻","⢼","⢽","⢾","⢿","⣸","⣹","⣺","⣻","⣼","⣽","⣾","⣿"]},dotsCircle:{interval:80,frames:["⢎ ","⠎⠁","⠊⠑","⠈⠱"," ⡱","⢀⡰","⢄⡠","⢆⡀"]},sand:{interval:80,frames:["⠁","⠂","⠄","⡀","⡈","⡐","⡠","⣀","⣁","⣂","⣄","⣌","⣔","⣤","⣥","⣦","⣮","⣶","⣷","⣿","⡿","⠿","⢟","⠟","⡛","⠛","⠫","⢋","⠋","⠍","⡉","⠉","⠑","⠡","⢁"]},line:{interval:130,frames:["-","\\","|","/"]},line2:{interval:100,frames:["⠂","-","–","—","–","-"]},rollingLine:{interval:80,frames:["/  "," - "," \\ ","  |","  |"," \\ "," - ","/  "]},pipe:{interval:100,frames:["┤","┘","┴","└","├","┌","┬","┐"]},simpleDots:{interval:400,frames:[".  ",".. ","...","   "]},simpleDotsScrolling:{interval:200,frames:[".  ",".. ","..."," ..","  .","   "]},star:{interval:70,frames:["✶","✸","✹","✺","✹","✷"]},star2:{interval:80,frames:["+","x","*"]},flip:{interval:70,frames:["_","_","_","-","`","`","'","´","-","_","_","_"]},hamburger:{interval:100,frames:["☱","☲","☴"]},growVertical:{interval:120,frames:["▁","▃","▄","▅","▆","▇","▆","▅","▄","▃"]},growHorizontal:{interval:120,frames:["▏","▎","▍","▌","▋","▊","▉","▊","▋","▌","▍","▎"]},balloon:{interval:140,frames:[" ",".","o","O","@","*"," "]},balloon2:{interval:120,frames:[".","o","O","°","O","o","."]},noise:{interval:100,frames:["▓","▒","░"]},bounce:{interval:120,frames:["⠁","⠂","⠄","⠂"]},boxBounce:{interval:120,frames:["▖","▘","▝","▗"]},boxBounce2:{interval:100,frames:["▌","▀","▐","▄"]},triangle:{interval:50,frames:["◢","◣","◤","◥"]},binary:{interval:80,frames:["010010","001100","100101","111010","111101","010111","101011","111000","110011","110101"]},arc:{interval:100,frames:["◜","◠","◝","◞","◡","◟"]},circle:{interval:120,frames:["◡","⊙","◠"]},squareCorners:{interval:180,frames:["◰","◳","◲","◱"]},circleQuarters:{interval:120,frames:["◴","◷","◶","◵"]},circleHalves:{interval:50,frames:["◐","◓","◑","◒"]},squish:{interval:100,frames:["╫","╪"]},toggle:{interval:250,frames:["⊶","⊷"]},toggle2:{interval:80,frames:["▫","▪"]},toggle3:{interval:120,frames:["□","■"]},toggle4:{interval:100,frames:["■","□","▪","▫"]},toggle5:{interval:100,frames:["▮","▯"]},toggle6:{interval:300,frames:["ဝ","၀"]},toggle7:{interval:80,frames:["⦾","⦿"]},toggle8:{interval:100,frames:["◍","◌"]},toggle9:{interval:100,frames:["◉","◎"]},toggle10:{interval:100,frames:["㊂","㊀","㊁"]},toggle11:{interval:50,frames:["⧇","⧆"]},toggle12:{interval:120,frames:["☗","☖"]},toggle13:{interval:80,frames:["=","*","-"]},arrow:{interval:100,frames:["←","↖","↑","↗","→","↘","↓","↙"]},arrow2:{interval:80,frames:["⬆️ ","↗️ ","➡️ ","↘️ ","⬇️ ","↙️ ","⬅️ ","↖️ "]},arrow3:{interval:120,frames:["▹▹▹▹▹","▸▹▹▹▹","▹▸▹▹▹","▹▹▸▹▹","▹▹▹▸▹","▹▹▹▹▸"]},bouncingBar:{interval:80,frames:["[    ]","[=   ]","[==  ]","[=== ]","[====]","[ ===]","[  ==]","[   =]","[    ]","[   =]","[  ==]","[ ===]","[====]","[=== ]","[==  ]","[=   ]"]},bouncingBall:{interval:80,frames:["( ●    )","(  ●   )","(   ●  )","(    ● )","(     ●)","(    ● )","(   ●  )","(  ●   )","( ●    )","(●     )"]},smiley:{interval:200,frames:["😄 ","😝 "]},monkey:{interval:300,frames:["🙈 ","🙈 ","🙉 ","🙊 "]},hearts:{interval:100,frames:["💛 ","💙 ","💜 ","💚 ","💗 "]},clock:{interval:100,frames:["🕛 ","🕐 ","🕑 ","🕒 ","🕓 ","🕔 ","🕕 ","🕖 ","🕗 ","🕘 ","🕙 ","🕚 "]},earth:{interval:180,frames:["🌍 ","🌎 ","🌏 "]},material:{interval:17,frames:["█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","██████▁▁▁▁▁▁▁▁▁▁▁▁▁▁","███████▁▁▁▁▁▁▁▁▁▁▁▁▁","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","██████████▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","█████████████▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁██████████████▁▁▁▁","▁▁▁██████████████▁▁▁","▁▁▁▁█████████████▁▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁██████████████▁▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁██████████████▁","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁██████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁█████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁████████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁███████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁██████████","▁▁▁▁▁▁▁▁▁▁▁▁████████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁██████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","██▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","███▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","████▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","█████▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","██████▁▁▁▁▁▁▁▁▁▁▁▁▁█","████████▁▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","█████████▁▁▁▁▁▁▁▁▁▁▁","███████████▁▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","████████████▁▁▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","██████████████▁▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁██████████████▁▁▁▁▁","▁▁▁█████████████▁▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁████████████▁▁▁","▁▁▁▁▁▁███████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁█████████▁▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁█████████▁▁","▁▁▁▁▁▁▁▁▁▁█████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁████████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁███████▁","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁███████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁████","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁███","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁██","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁","▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁"]},moon:{interval:80,frames:["🌑 ","🌒 ","🌓 ","🌔 ","🌕 ","🌖 ","🌗 ","🌘 "]},runner:{interval:140,frames:["🚶 ","🏃 "]},pong:{interval:80,frames:["▐⠂       ▌","▐⠈       ▌","▐ ⠂      ▌","▐ ⠠      ▌","▐  ⡀     ▌","▐  ⠠     ▌","▐   ⠂    ▌","▐   ⠈    ▌","▐    ⠂   ▌","▐    ⠠   ▌","▐     ⡀  ▌","▐     ⠠  ▌","▐      ⠂ ▌","▐      ⠈ ▌","▐       ⠂▌","▐       ⠠▌","▐       ⡀▌","▐      ⠠ ▌","▐      ⠂ ▌","▐     ⠈  ▌","▐     ⠂  ▌","▐    ⠠   ▌","▐    ⡀   ▌","▐   ⠠    ▌","▐   ⠂    ▌","▐  ⠈     ▌","▐  ⠂     ▌","▐ ⠠      ▌","▐ ⡀      ▌","▐⠠       ▌"]},shark:{interval:120,frames:["▐|\\____________▌","▐_|\\___________▌","▐__|\\__________▌","▐___|\\_________▌","▐____|\\________▌","▐_____|\\_______▌","▐______|\\______▌","▐_______|\\_____▌","▐________|\\____▌","▐_________|\\___▌","▐__________|\\__▌","▐___________|\\_▌","▐____________|\\▌","▐____________/|▌","▐___________/|_▌","▐__________/|__▌","▐_________/|___▌","▐________/|____▌","▐_______/|_____▌","▐______/|______▌","▐_____/|_______▌","▐____/|________▌","▐___/|_________▌","▐__/|__________▌","▐_/|___________▌","▐/|____________▌"]},dqpb:{interval:100,frames:["d","q","p","b"]},weather:{interval:100,frames:["☀️ ","☀️ ","☀️ ","🌤 ","⛅️ ","🌥 ","☁️ ","🌧 ","🌨 ","🌧 ","🌨 ","🌧 ","🌨 ","⛈ ","🌨 ","🌧 ","🌨 ","☁️ ","🌥 ","⛅️ ","🌤 ","☀️ ","☀️ "]},christmas:{interval:400,frames:["🌲","🎄"]},grenade:{interval:80,frames:["،  ","′  "," ´ "," ‾ ","  ⸌","  ⸊","  |","  ⁎","  ⁕"," ෴ ","  ⁓","   ","   ","   "]},point:{interval:125,frames:["∙∙∙","●∙∙","∙●∙","∙∙●","∙∙∙"]},layer:{interval:150,frames:["-","=","≡"]},betaWave:{interval:80,frames:["ρββββββ","βρβββββ","ββρββββ","βββρβββ","ββββρββ","βββββρβ","ββββββρ"]},fingerDance:{interval:160,frames:["🤘 ","🤟 ","🖖 ","✋ ","🤚 ","👆 "]},fistBump:{interval:80,frames:["🤜　　　　🤛 ","🤜　　　　🤛 ","🤜　　　　🤛 ","　🤜　　🤛　 ","　　🤜🤛　　 ","　🤜✨🤛　　 ","🤜　✨　🤛　 "]},soccerHeader:{interval:80,frames:[" 🧑⚽️       🧑 ","🧑  ⚽️      🧑 ","🧑   ⚽️     🧑 ","🧑    ⚽️    🧑 ","🧑     ⚽️   🧑 ","🧑      ⚽️  🧑 ","🧑       ⚽️🧑  ","🧑      ⚽️  🧑 ","🧑     ⚽️   🧑 ","🧑    ⚽️    🧑 ","🧑   ⚽️     🧑 ","🧑  ⚽️      🧑 "]},mindblown:{interval:160,frames:["😐 ","😐 ","😮 ","😮 ","😦 ","😦 ","😧 ","😧 ","🤯 ","💥 ","✨ ","　 ","　 ","　 "]},speaker:{interval:160,frames:["🔈 ","🔉 ","🔊 ","🔉 "]},orangePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 "]},bluePulse:{interval:100,frames:["🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},orangeBluePulse:{interval:100,frames:["🔸 ","🔶 ","🟠 ","🟠 ","🔶 ","🔹 ","🔷 ","🔵 ","🔵 ","🔷 "]},timeTravel:{interval:100,frames:["🕛 ","🕚 ","🕙 ","🕘 ","🕗 ","🕖 ","🕕 ","🕔 ","🕓 ","🕒 ","🕑 ","🕐 "]},aesthetic:{interval:80,frames:["▰▱▱▱▱▱▱","▰▰▱▱▱▱▱","▰▰▰▱▱▱▱","▰▰▰▰▱▱▱","▰▰▰▰▰▱▱","▰▰▰▰▰▰▱","▰▰▰▰▰▰▰","▰▱▱▱▱▱▱"]},dwarfFortress:{interval:80,frames:[" ██████£££  ","☺██████£££  ","☺██████£££  ","☺▓█████£££  ","☺▓█████£££  ","☺▒█████£££  ","☺▒█████£££  ","☺░█████£££  ","☺░█████£££  ","☺ █████£££  "," ☺█████£££  "," ☺█████£££  "," ☺▓████£££  "," ☺▓████£££  "," ☺▒████£££  "," ☺▒████£££  "," ☺░████£££  "," ☺░████£££  "," ☺ ████£££  ","  ☺████£££  ","  ☺████£££  ","  ☺▓███£££  ","  ☺▓███£££  ","  ☺▒███£££  ","  ☺▒███£££  ","  ☺░███£££  ","  ☺░███£££  ","  ☺ ███£££  ","   ☺███£££  ","   ☺███£££  ","   ☺▓██£££  ","   ☺▓██£££  ","   ☺▒██£££  ","   ☺▒██£££  ","   ☺░██£££  ","   ☺░██£££  ","   ☺ ██£££  ","    ☺██£££  ","    ☺██£££  ","    ☺▓█£££  ","    ☺▓█£££  ","    ☺▒█£££  ","    ☺▒█£££  ","    ☺░█£££  ","    ☺░█£££  ","    ☺ █£££  ","     ☺█£££  ","     ☺█£££  ","     ☺▓£££  ","     ☺▓£££  ","     ☺▒£££  ","     ☺▒£££  ","     ☺░£££  ","     ☺░£££  ","     ☺ £££  ","      ☺£££  ","      ☺£££  ","      ☺▓££  ","      ☺▓££  ","      ☺▒££  ","      ☺▒££  ","      ☺░££  ","      ☺░££  ","      ☺ ££  ","       ☺££  ","       ☺££  ","       ☺▓£  ","       ☺▓£  ","       ☺▒£  ","       ☺▒£  ","       ☺░£  ","       ☺░£  ","       ☺ £  ","        ☺£  ","        ☺£  ","        ☺▓  ","        ☺▓  ","        ☺▒  ","        ☺▒  ","        ☺░  ","        ☺░  ","        ☺   ","        ☺  &","        ☺ ☼&","       ☺ ☼ &","       ☺☼  &","      ☺☼  & ","      ‼   & ","     ☺   &  ","    ‼    &  ","   ☺    &   ","  ‼     &   "," ☺     &    ","‼      &    ","      &     ","      &     ","     &   ░  ","     &   ▒  ","    &    ▓  ","    &    £  ","   &    ░£  ","   &    ▒£  ","  &     ▓£  ","  &     ££  "," &     ░££  "," &     ▒££  ","&      ▓££  ","&      £££  ","      ░£££  ","      ▒£££  ","      ▓£££  ","      █£££  ","     ░█£££  ","     ▒█£££  ","     ▓█£££  ","     ██£££  ","    ░██£££  ","    ▒██£££  ","    ▓██£££  ","    ███£££  ","   ░███£££  ","   ▒███£££  ","   ▓███£££  ","   ████£££  ","  ░████£££  ","  ▒████£££  ","  ▓████£££  ","  █████£££  "," ░█████£££  "," ▒█████£££  "," ▓█████£££  "," ██████£££  "," ██████£££  "]}};var Y_=h8,OA=Object.keys(h8);var i1={};U6(i1,{warning:()=>LG,success:()=>TG,info:()=>jG,error:()=>wG});import IG from"node:tty";var EG=IG?.WriteStream?.prototype?.hasColors?.()??!1,S=(_,$)=>{if(!EG)return(J)=>J;let X=`\x1B[${_}m`,Z=`\x1B[${$}m`;return(J)=>{let G=J+"",Y=G.indexOf(Z);if(Y===-1)return X+G+Z;let z=X,H=0,F=($===22?Z:"")+X;while(Y!==-1)z+=G.slice(H,Y)+F,H=Y+Z.length,Y=G.indexOf(Z,H);return z+=G.slice(H)+Z,z}},VA=S(0,0),NA=S(1,22),MA=S(2,22),BA=S(3,23),QA=S(4,24),IA=S(53,55),EA=S(7,27),jA=S(8,28),TA=S(9,29),LA=S(30,39),O3=S(31,39),R3=S(32,39),D3=S(33,39),V3=S(34,39),wA=S(35,39),PA=S(36,39),xA=S(37,39),qA=S(90,39),CA=S(40,49),SA=S(41,49),kA=S(42,49),vA=S(43,49),hA=S(44,49),yA=S(45,49),fA=S(46,49),bA=S(47,49),gA=S(100,49),pA=S(91,39),mA=S(92,39),uA=S(93,39),dA=S(94,39),cA=S(95,39),lA=S(96,39),iA=S(97,39),nA=S(101,49),sA=S(102,49),oA=S(103,49),rA=S(104,49),aA=S(105,49),tA=S(106,49),eA=S(107,49);import N3 from"node:process";function z_(){let{env:_}=N3,{TERM:$,TERM_PROGRAM:X}=_;if(N3.platform!=="win32")return $!=="linux";return Boolean(_.WT_SESSION)||Boolean(_.TERMINUS_SUBLIME)||_.ConEmuTask==="{cmd::Cmder}"||X==="Terminus-Sublime"||X==="vscode"||$==="xterm-256color"||$==="alacritty"||$==="rxvt-unicode"||$==="rxvt-unicode-256color"||_.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var A6=z_(),jG=V3(A6?"ℹ":"i"),TG=R3(A6?"✔":"√"),LG=D3(A6?"⚠":"‼"),wG=O3(A6?"✖":"×");function y8({onlyFirst:_=!1}={}){return new RegExp("(?:\\u001B\\][\\s\\S]*?(?:\\u0007|\\u001B\\u005C|\\u009C))|[\\u001B\\u009B][[\\]()#;?]*(?:\\d{1,4}(?:[;:]\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]",_?void 0:"g")}var PG=y8();function H_(_){if(typeof _!=="string")throw TypeError(`Expected a \`string\`, got \`${typeof _}\``);return _.replace(PG,"")}function M3(_){return _===161||_===164||_===167||_===168||_===170||_===173||_===174||_>=176&&_<=180||_>=182&&_<=186||_>=188&&_<=191||_===198||_===208||_===215||_===216||_>=222&&_<=225||_===230||_>=232&&_<=234||_===236||_===237||_===240||_===242||_===243||_>=247&&_<=250||_===252||_===254||_===257||_===273||_===275||_===283||_===294||_===295||_===299||_>=305&&_<=307||_===312||_>=319&&_<=322||_===324||_>=328&&_<=331||_===333||_===338||_===339||_===358||_===359||_===363||_===462||_===464||_===466||_===468||_===470||_===472||_===474||_===476||_===593||_===609||_===708||_===711||_>=713&&_<=715||_===717||_===720||_>=728&&_<=731||_===733||_===735||_>=768&&_<=879||_>=913&&_<=929||_>=931&&_<=937||_>=945&&_<=961||_>=963&&_<=969||_===1025||_>=1040&&_<=1103||_===1105||_===8208||_>=8211&&_<=8214||_===8216||_===8217||_===8220||_===8221||_>=8224&&_<=8226||_>=8228&&_<=8231||_===8240||_===8242||_===8243||_===8245||_===8251||_===8254||_===8308||_===8319||_>=8321&&_<=8324||_===8364||_===8451||_===8453||_===8457||_===8467||_===8470||_===8481||_===8482||_===8486||_===8491||_===8531||_===8532||_>=8539&&_<=8542||_>=8544&&_<=8555||_>=8560&&_<=8569||_===8585||_>=8592&&_<=8601||_===8632||_===8633||_===8658||_===8660||_===8679||_===8704||_===8706||_===8707||_===8711||_===8712||_===8715||_===8719||_===8721||_===8725||_===8730||_>=8733&&_<=8736||_===8739||_===8741||_>=8743&&_<=8748||_===8750||_>=8756&&_<=8759||_===8764||_===8765||_===8776||_===8780||_===8786||_===8800||_===8801||_>=8804&&_<=8807||_===8810||_===8811||_===8814||_===8815||_===8834||_===8835||_===8838||_===8839||_===8853||_===8857||_===8869||_===8895||_===8978||_>=9312&&_<=9449||_>=9451&&_<=9547||_>=9552&&_<=9587||_>=9600&&_<=9615||_>=9618&&_<=9621||_===9632||_===9633||_>=9635&&_<=9641||_===9650||_===9651||_===9654||_===9655||_===9660||_===9661||_===9664||_===9665||_>=9670&&_<=9672||_===9675||_>=9678&&_<=9681||_>=9698&&_<=9701||_===9711||_===9733||_===9734||_===9737||_===9742||_===9743||_===9756||_===9758||_===9792||_===9794||_===9824||_===9825||_>=9827&&_<=9829||_>=9831&&_<=9834||_===9836||_===9837||_===9839||_===9886||_===9887||_===9919||_>=9926&&_<=9933||_>=9935&&_<=9939||_>=9941&&_<=9953||_===9955||_===9960||_===9961||_>=9963&&_<=9969||_===9972||_>=9974&&_<=9977||_===9979||_===9980||_===9982||_===9983||_===10045||_>=10102&&_<=10111||_>=11094&&_<=11097||_>=12872&&_<=12879||_>=57344&&_<=63743||_>=65024&&_<=65039||_===65533||_>=127232&&_<=127242||_>=127248&&_<=127277||_>=127280&&_<=127337||_>=127344&&_<=127373||_===127375||_===127376||_>=127387&&_<=127404||_>=917760&&_<=917999||_>=983040&&_<=1048573||_>=1048576&&_<=1114109}function B3(_){return _===12288||_>=65281&&_<=65376||_>=65504&&_<=65510}function Q3(_){return _>=4352&&_<=4447||_===8986||_===8987||_===9001||_===9002||_>=9193&&_<=9196||_===9200||_===9203||_===9725||_===9726||_===9748||_===9749||_>=9776&&_<=9783||_>=9800&&_<=9811||_===9855||_>=9866&&_<=9871||_===9875||_===9889||_===9898||_===9899||_===9917||_===9918||_===9924||_===9925||_===9934||_===9940||_===9962||_===9970||_===9971||_===9973||_===9978||_===9981||_===9989||_===9994||_===9995||_===10024||_===10060||_===10062||_>=10067&&_<=10069||_===10071||_>=10133&&_<=10135||_===10160||_===10175||_===11035||_===11036||_===11088||_===11093||_>=11904&&_<=11929||_>=11931&&_<=12019||_>=12032&&_<=12245||_>=12272&&_<=12287||_>=12289&&_<=12350||_>=12353&&_<=12438||_>=12441&&_<=12543||_>=12549&&_<=12591||_>=12593&&_<=12686||_>=12688&&_<=12773||_>=12783&&_<=12830||_>=12832&&_<=12871||_>=12880&&_<=42124||_>=42128&&_<=42182||_>=43360&&_<=43388||_>=44032&&_<=55203||_>=63744&&_<=64255||_>=65040&&_<=65049||_>=65072&&_<=65106||_>=65108&&_<=65126||_>=65128&&_<=65131||_>=94176&&_<=94180||_>=94192&&_<=94198||_>=94208&&_<=101589||_>=101631&&_<=101662||_>=101760&&_<=101874||_>=110576&&_<=110579||_>=110581&&_<=110587||_===110589||_===110590||_>=110592&&_<=110882||_===110898||_>=110928&&_<=110930||_===110933||_>=110948&&_<=110951||_>=110960&&_<=111355||_>=119552&&_<=119638||_>=119648&&_<=119670||_===126980||_===127183||_===127374||_>=127377&&_<=127386||_>=127488&&_<=127490||_>=127504&&_<=127547||_>=127552&&_<=127560||_===127568||_===127569||_>=127584&&_<=127589||_>=127744&&_<=127776||_>=127789&&_<=127797||_>=127799&&_<=127868||_>=127870&&_<=127891||_>=127904&&_<=127946||_>=127951&&_<=127955||_>=127968&&_<=127984||_===127988||_>=127992&&_<=128062||_===128064||_>=128066&&_<=128252||_>=128255&&_<=128317||_>=128331&&_<=128334||_>=128336&&_<=128359||_===128378||_===128405||_===128406||_===128420||_>=128507&&_<=128591||_>=128640&&_<=128709||_===128716||_>=128720&&_<=128722||_>=128725&&_<=128728||_>=128732&&_<=128735||_===128747||_===128748||_>=128756&&_<=128764||_>=128992&&_<=129003||_===129008||_>=129292&&_<=129338||_>=129340&&_<=129349||_>=129351&&_<=129535||_>=129648&&_<=129660||_>=129664&&_<=129674||_>=129678&&_<=129734||_===129736||_>=129741&&_<=129756||_>=129759&&_<=129770||_>=129775&&_<=129784||_>=131072&&_<=196605||_>=196608&&_<=262141}function xG(_){if(!Number.isSafeInteger(_))throw TypeError(`Expected a code point, got \`${typeof _}\`.`)}function f8(_,{ambiguousAsWide:$=!1}={}){if(xG(_),B3(_)||Q3(_)||$&&M3(_))return 2;return 1}var qG=new Intl.Segmenter,CG=/^(?:\p{Default_Ignorable_Code_Point}|\p{Control}|\p{Mark}|\p{Surrogate})+$/v,SG=/^[\p{Default_Ignorable_Code_Point}\p{Control}\p{Format}\p{Mark}\p{Surrogate}]+/v,kG=/^\p{RGI_Emoji}$/v;function vG(_){return _.replace(SG,"")}function hG(_){return CG.test(_)}function yG(_,$){let X=0;if(_.length>1){for(let Z of _.slice(1))if(Z>="＀"&&Z<="￯")X+=f8(Z.codePointAt(0),$)}return X}function b8(_,$={}){if(typeof _!=="string"||_.length===0)return 0;let{ambiguousIsNarrow:X=!0,countAnsiEscapeCodes:Z=!1}=$,J=_;if(!Z)J=H_(J);if(J.length===0)return 0;let G=0,Y={ambiguousAsWide:!X};for(let{segment:z}of qG.segment(J)){if(hG(z))continue;if(kG.test(z)){G+=2;continue}let H=vG(z).codePointAt(0);G+=f8(H,Y),G+=yG(z,Y)}return G}function g8({stream:_=process.stdout}={}){return Boolean(_&&_.isTTY&&process.env.TERM!=="dumb"&&!("CI"in process.env))}import $1 from"node:process";var fG=3;class I3{#_=0;start(){if(this.#_++,this.#_===1)this.#$()}stop(){if(this.#_<=0)throw Error("`stop` called more times than `start`");if(this.#_--,this.#_===0)this.#X()}#$(){if($1.platform==="win32"||!$1.stdin.isTTY)return;$1.stdin.setRawMode(!0),$1.stdin.on("data",this.#Z),$1.stdin.resume()}#X(){if(!$1.stdin.isTTY)return;$1.stdin.off("data",this.#Z),$1.stdin.pause(),$1.stdin.setRawMode(!1)}#Z(_){if(_[0]===fG)$1.emit("SIGINT")}}var bG=new I3,p8=bG;class E3{#_=0;#$=!1;#X=0;#Z=-1;#J=0;#G=0;#Y;#z;#H;#F;#A;#K;#U;#O;#R;#W;#D;color;constructor(_){if(typeof _==="string")_={text:_};if(this.#Y={color:"cyan",stream:K6.stderr,discardStdin:!0,hideCursor:!0,..._},this.color=this.#Y.color,this.spinner=this.#Y.spinner,this.#A=this.#Y.interval,this.#H=this.#Y.stream,this.#K=typeof this.#Y.isEnabled==="boolean"?this.#Y.isEnabled:g8({stream:this.#H}),this.#U=typeof this.#Y.isSilent==="boolean"?this.#Y.isSilent:!1,this.text=this.#Y.text,this.prefixText=this.#Y.prefixText,this.suffixText=this.#Y.suffixText,this.indent=this.#Y.indent,K6.env.NODE_ENV==="test")this._stream=this.#H,this._isEnabled=this.#K,Object.defineProperty(this,"_linesToClear",{get(){return this.#_},set($){this.#_=$}}),Object.defineProperty(this,"_frameIndex",{get(){return this.#Z}}),Object.defineProperty(this,"_lineCount",{get(){return this.#X}})}get indent(){return this.#O}set indent(_=0){if(!(_>=0&&Number.isInteger(_)))throw Error("The `indent` option must be an integer from 0 and up");this.#O=_,this.#Q()}get interval(){return this.#A??this.#z.interval??100}get spinner(){return this.#z}set spinner(_){if(this.#Z=-1,this.#A=void 0,typeof _==="object"){if(!Array.isArray(_.frames)||_.frames.length===0||_.frames.some(($)=>typeof $!=="string"))throw Error("The given spinner must have a non-empty `frames` array of strings");if(_.interval!==void 0&&!(Number.isInteger(_.interval)&&_.interval>0))throw Error("`spinner.interval` must be a positive integer if provided");this.#z=_}else if(!z_())this.#z=Y_.line;else if(_===void 0)this.#z=Y_.dots;else if(_!=="default"&&Y_[_])this.#z=Y_[_];else throw Error(`There is no built-in spinner named '${_}'. See https://github.com/sindresorhus/cli-spinners/blob/main/spinners.json for a full list.`)}get text(){return this.#R}set text(_=""){this.#R=_,this.#Q()}get prefixText(){return this.#W}set prefixText(_=""){this.#W=_,this.#Q()}get suffixText(){return this.#D}set suffixText(_=""){this.#D=_,this.#Q()}get isSpinning(){return this.#F!==void 0}#V(_,$,X=!1){let Z=typeof _==="function"?_():_;if(typeof Z==="string"&&Z!=="")return X?$+Z:Z+$;return""}#M(_=this.#W,$=" "){return this.#V(_,$,!1)}#B(_=this.#D,$=" "){return this.#V(_,$,!0)}#N(_,$){let X=0;for(let Z of H_(_).split(`
`))X+=Math.max(1,Math.ceil(b8(Z)/$));return X}#Q(){let _=this.#H.columns??80,$=typeof this.#W==="function"?"":this.#W,X=typeof this.#D==="function"?"":this.#D,Z=typeof $==="string"&&$!==""?$+" ":"",J=typeof X==="string"&&X!==""?" "+X:"",G="-",Y=" ".repeat(this.#O)+Z+"-"+(typeof this.#R==="string"?" "+this.#R:"")+J;this.#X=this.#N(Y,_)}get isEnabled(){return this.#K&&!this.#U}set isEnabled(_){if(typeof _!=="boolean")throw TypeError("The `isEnabled` option must be a boolean");this.#K=_}get isSilent(){return this.#U}set isSilent(_){if(typeof _!=="boolean")throw TypeError("The `isSilent` option must be a boolean");this.#U=_}frame(){let _=Date.now();if(this.#Z===-1||_-this.#J>=this.interval)this.#Z=++this.#Z%this.#z.frames.length,this.#J=_;let{frames:$}=this.#z,X=$[this.#Z];if(this.color)X=M[this.color](X);let Z=this.#M(this.#W," "),J=typeof this.text==="string"?" "+this.text:"",G=this.#B(this.#D," ");return Z+X+J+G}clear(){if(!this.#K||!this.#H.isTTY)return this;this.#H.cursorTo(0);for(let _=0;_<this.#_;_++){if(_>0)this.#H.moveCursor(0,-1);this.#H.clearLine(1)}if(this.#O||this.#G!==this.#O)this.#H.cursorTo(this.#O);return this.#G=this.#O,this.#_=0,this}render(){if(!this.#K||this.#U)return this;this.clear();let _=this.frame(),$=this.#H.columns??80,X=this.#N(_,$),Z=this.#H.rows;if(Z&&Z>1&&X>Z){let J=_.split(`
`),G=Z-1;_=[...J.slice(0,G),"... (content truncated to fit terminal)"].join(`
`)}return this.#H.write(_),this.#_=this.#N(_,$),this}start(_){if(_)this.text=_;if(this.#U)return this;if(!this.#K){let $=" ".repeat(this.#O)+this.#M(this.#W," ")+(this.text?`- ${this.text}`:"")+this.#B(this.#D," ");if($.trim()!=="")this.#H.write($+`
`);return this}if(this.isSpinning)return this;if(this.#Y.hideCursor)v8.hide(this.#H);if(this.#Y.discardStdin&&K6.stdin.isTTY)this.#$=!0,p8.start();return this.render(),this.#F=setInterval(this.render.bind(this),this.interval),this}stop(){if(clearInterval(this.#F),this.#F=void 0,this.#Z=0,this.#K){if(this.clear(),this.#Y.hideCursor)v8.show(this.#H)}if(this.#Y.discardStdin&&K6.stdin.isTTY&&this.#$)p8.stop(),this.#$=!1;return this}succeed(_){return this.stopAndPersist({symbol:i1.success,text:_})}fail(_){return this.stopAndPersist({symbol:i1.error,text:_})}warn(_){return this.stopAndPersist({symbol:i1.warning,text:_})}info(_){return this.stopAndPersist({symbol:i1.info,text:_})}stopAndPersist(_={}){if(this.#U)return this;let $=_.prefixText??this.#W,X=this.#M($," "),Z=_.symbol??" ",J=_.text??this.text,Y=typeof J==="string"?(Z?" ":"")+J:"",z=_.suffixText??this.#D,H=this.#B(z," "),W=X+Z+Y+H+`
`;return this.stop(),this.#H.write(W),this}}function f0(_){return new E3(_)}var MZ=T0(h3(),1);import j1 from"node:fs";import K1 from"node:path";var K=Symbol.for("drizzle:entityKind");function V(_,$){if(!_||typeof _!=="object")return!1;if(_ instanceof $)return!0;if(!Object.prototype.hasOwnProperty.call($,K))throw Error(`Class "${$.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let X=Object.getPrototypeOf(_).constructor;if(X)while(X){if(K in X&&X[K]===$[K])return!0;X=Object.getPrototypeOf(X)}return!1}class p{constructor(_,$){this.table=_,this.config=$,this.name=$.name,this.keyAsName=$.keyAsName,this.notNull=$.notNull,this.default=$.default,this.defaultFn=$.defaultFn,this.onUpdateFn=$.onUpdateFn,this.hasDefault=$.hasDefault,this.primary=$.primaryKey,this.isUnique=$.isUnique,this.uniqueName=$.uniqueName,this.uniqueType=$.uniqueType,this.dataType=$.dataType,this.columnType=$.columnType,this.generated=$.generated,this.generatedIdentity=$.generatedIdentity}static[K]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(_){return _}mapToDriverValue(_){return _}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class c8{static[K]="ColumnBuilder";config;constructor(_,$,X){this.config={name:_,keyAsName:_==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:$,columnType:X,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(_){return this.config.default=_,this.config.hasDefault=!0,this}$defaultFn(_){return this.config.defaultFn=_,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(_){return this.config.onUpdateFn=_,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(_){if(this.config.name!=="")return;this.config.name=_}}var P0=Symbol.for("drizzle:Name");function y3(_,...$){return _(...$)}function f3(_,$){return`${_[P0]}_${$.join("_")}_unique`}class F_ extends p{constructor(_,$){if(!$.uniqueName)$.uniqueName=f3(_,[$.name]);super(_,$);this.table=_}static[K]="PgColumn"}class GY extends F_{static[K]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(_){return this.indexConfig.opClass=_,this}}class YY extends F_{static[K]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}var b3=Symbol.for("drizzle:isPgEnum");function g3(_){return!!_&&typeof _==="function"&&b3 in _&&_[b3]===!0}class zY extends F_{static[K]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(_,$){super(_,$);this.enum=$.enum}getSQLType(){return this.enum.enumName}}class Z0{static[K]="Subquery";constructor(_,$,X,Z=!1,J=[]){this._={brand:"Subquery",sql:_,selectedFields:$,alias:X,isWith:Z,usedTables:J}}}class U_ extends Z0{static[K]="WithSubquery"}var p3="0.44.7";var l8,i8,m3={startActiveSpan(_,$){if(!l8)return $();if(!i8)i8=l8.trace.getTracer("drizzle-orm",p3);return y3((X,Z)=>Z.startActiveSpan(_,(J)=>{try{return $(J)}catch(G){throw J.setStatus({code:X.SpanStatusCode.ERROR,message:G instanceof Error?G.message:"Unknown error"}),G}finally{J.end()}}),l8,i8)}};var r=Symbol.for("drizzle:ViewBaseConfig");var V6=Symbol.for("drizzle:Schema"),N6=Symbol.for("drizzle:Columns"),u3=Symbol.for("drizzle:ExtraConfigColumns"),n8=Symbol.for("drizzle:OriginalName"),s8=Symbol.for("drizzle:BaseName"),A_=Symbol.for("drizzle:IsAlias"),d3=Symbol.for("drizzle:ExtraConfigBuilder"),HY=Symbol.for("drizzle:IsDrizzleTable");class B{static[K]="Table";static Symbol={Name:P0,Schema:V6,OriginalName:n8,Columns:N6,ExtraConfigColumns:u3,BaseName:s8,IsAlias:A_,ExtraConfigBuilder:d3};[P0];[n8];[V6];[N6];[u3];[s8];[A_]=!1;[HY]=!0;[d3]=void 0;constructor(_,$,X){this[P0]=this[n8]=_,this[V6]=$,this[s8]=X}}function L1(_){return _[P0]}function n1(_){return`${_[V6]??"public"}.${_[P0]}`}function o8(_){return _!==null&&_!==void 0&&typeof _.getSQL==="function"}function WY(_){let $={sql:"",params:[]};for(let X of _)if($.sql+=X.sql,$.params.push(...X.params),X.typings?.length){if(!$.typings)$.typings=[];$.typings.push(...X.typings)}return $}class H0{static[K]="StringChunk";value;constructor(_){this.value=Array.isArray(_)?_:[_]}getSQL(){return new I([this])}}class I{constructor(_){this.queryChunks=_;for(let $ of _)if(V($,B)){let X=$[B.Symbol.Schema];this.usedTables.push(X===void 0?$[B.Symbol.Name]:X+"."+$[B.Symbol.Name])}}static[K]="SQL";decoder=l3;shouldInlineParams=!1;usedTables=[];append(_){return this.queryChunks.push(..._.queryChunks),this}toQuery(_){return m3.startActiveSpan("drizzle.buildSQL",($)=>{let X=this.buildQueryFromSourceParams(this.queryChunks,_);return $?.setAttributes({"drizzle.query.text":X.sql,"drizzle.query.params":JSON.stringify(X.params)}),X})}buildQueryFromSourceParams(_,$){let X=Object.assign({},$,{inlineParams:$.inlineParams||this.shouldInlineParams,paramStartIndex:$.paramStartIndex||{value:0}}),{casing:Z,escapeName:J,escapeParam:G,prepareTyping:Y,inlineParams:z,paramStartIndex:H}=X;return WY(_.map((W)=>{if(V(W,H0))return{sql:W.value.join(""),params:[]};if(V(W,M6))return{sql:J(W.value),params:[]};if(W===void 0)return{sql:"",params:[]};if(Array.isArray(W)){let F=[new H0("(")];for(let[A,O]of W.entries())if(F.push(O),A<W.length-1)F.push(new H0(", "));return F.push(new H0(")")),this.buildQueryFromSourceParams(F,X)}if(V(W,I))return this.buildQueryFromSourceParams(W.queryChunks,{...X,inlineParams:z||W.shouldInlineParams});if(V(W,B)){let F=W[B.Symbol.Schema],A=W[B.Symbol.Name];return{sql:F===void 0||W[A_]?J(A):J(F)+"."+J(A),params:[]}}if(V(W,p)){let F=Z.getColumnCasing(W);if($.invokeSource==="indexes")return{sql:J(F),params:[]};let A=W.table[B.Symbol.Schema];return{sql:W.table[A_]||A===void 0?J(W.table[B.Symbol.Name])+"."+J(F):J(A)+"."+J(W.table[B.Symbol.Name])+"."+J(F),params:[]}}if(V(W,b0)){let F=W[r].schema,A=W[r].name;return{sql:F===void 0||W[r].isAlias?J(A):J(F)+"."+J(A),params:[]}}if(V(W,x0)){if(V(W.value,w1))return{sql:G(H.value++,W),params:[W],typings:["none"]};let F=W.value===null?null:W.encoder.mapToDriverValue(W.value);if(V(F,I))return this.buildQueryFromSourceParams([F],X);if(z)return{sql:this.mapInlineParam(F,X),params:[]};let A=["none"];if(Y)A=[Y(W.encoder)];return{sql:G(H.value++,F),params:[F],typings:A}}if(V(W,w1))return{sql:G(H.value++,W),params:[W],typings:["none"]};if(V(W,I.Aliased)&&W.fieldAlias!==void 0)return{sql:J(W.fieldAlias),params:[]};if(V(W,Z0)){if(W._.isWith)return{sql:J(W._.alias),params:[]};return this.buildQueryFromSourceParams([new H0("("),W._.sql,new H0(") "),new M6(W._.alias)],X)}if(g3(W)){if(W.schema)return{sql:J(W.schema)+"."+J(W.enumName),params:[]};return{sql:J(W.enumName),params:[]}}if(o8(W)){if(W.shouldOmitSQLParens?.())return this.buildQueryFromSourceParams([W.getSQL()],X);return this.buildQueryFromSourceParams([new H0("("),W.getSQL(),new H0(")")],X)}if(z)return{sql:this.mapInlineParam(W,X),params:[]};return{sql:G(H.value++,W),params:[W],typings:["none"]}}))}mapInlineParam(_,{escapeString:$}){if(_===null)return"null";if(typeof _==="number"||typeof _==="boolean")return _.toString();if(typeof _==="string")return $(_);if(typeof _==="object"){let X=_.toString();if(X==="[object Object]")return $(JSON.stringify(_));return $(X)}throw Error("Unexpected param value: "+_)}getSQL(){return this}as(_){if(_===void 0)return this;return new I.Aliased(this,_)}mapWith(_){return this.decoder=typeof _==="function"?{mapFromDriverValue:_}:_,this}inlineParams(){return this.shouldInlineParams=!0,this}if(_){return _?this:void 0}}class M6{constructor(_){this.value=_}static[K]="Name";brand;getSQL(){return new I([this])}}function c3(_){return typeof _==="object"&&_!==null&&"mapToDriverValue"in _&&typeof _.mapToDriverValue==="function"}var l3={mapFromDriverValue:(_)=>_},i3={mapToDriverValue:(_)=>_},UO={...l3,...i3};class x0{constructor(_,$=i3){this.value=_,this.encoder=$}static[K]="Param";brand;getSQL(){return new I([this])}}function U(_,...$){let X=[];if($.length>0||_.length>0&&_[0]!=="")X.push(new H0(_[0]));for(let[Z,J]of $.entries())X.push(J,new H0(_[Z+1]));return new I(X)}((_)=>{function $(){return new I([])}_.empty=$;function X(H){return new I(H)}_.fromList=X;function Z(H){return new I([new H0(H)])}_.raw=Z;function J(H,W){let F=[];for(let[A,O]of H.entries()){if(A>0&&W!==void 0)F.push(W);F.push(O)}return new I(F)}_.join=J;function G(H){return new M6(H)}_.identifier=G;function Y(H){return new w1(H)}_.placeholder=Y;function z(H,W){return new x0(H,W)}_.param=z})(U||(U={}));((_)=>{class ${constructor(X,Z){this.sql=X,this.fieldAlias=Z}static[K]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new $(this.sql,this.fieldAlias)}}_.Aliased=$})(I||(I={}));class w1{constructor(_){this.name=_}static[K]="Placeholder";getSQL(){return new I([this])}}function K_(_,$){return _.map((X)=>{if(V(X,w1)){if(!(X.name in $))throw Error(`No value for placeholder "${X.name}" was provided`);return $[X.name]}if(V(X,x0)&&V(X.value,w1)){if(!(X.value.name in $))throw Error(`No value for placeholder "${X.value.name}" was provided`);return X.encoder.mapToDriverValue($[X.value.name])}return X})}var FY=Symbol.for("drizzle:IsDrizzleView");class b0{static[K]="View";[r];[FY]=!0;constructor({name:_,schema:$,selectedFields:X,query:Z}){this[r]={name:_,originalName:_,schema:$,selectedFields:X,query:Z,isExisting:!Z,isAlias:!1}}getSQL(){return new I([this])}}p.prototype.getSQL=function(){return new I([this])};B.prototype.getSQL=function(){return new I([this])};Z0.prototype.getSQL=function(){return new I([this])};class M2{constructor(_){this.table=_}static[K]="ColumnAliasProxyHandler";get(_,$){if($==="table")return this.table;return _[$]}}class O_{constructor(_,$){this.alias=_,this.replaceOriginalName=$}static[K]="TableAliasProxyHandler";get(_,$){if($===B.Symbol.IsAlias)return!0;if($===B.Symbol.Name)return this.alias;if(this.replaceOriginalName&&$===B.Symbol.OriginalName)return this.alias;if($===r)return{..._[r],name:this.alias,isAlias:!0};if($===B.Symbol.Columns){let Z=_[B.Symbol.Columns];if(!Z)return Z;let J={};return Object.keys(Z).map((G)=>{J[G]=new Proxy(Z[G],new M2(new Proxy(_,this)))}),J}let X=_[$];if(V(X,p))return new Proxy(X,new M2(new Proxy(_,this)));return X}}function B6(_,$){return new Proxy(_,new O_($,!1))}function X1(_,$){return new Proxy(_,new M2(new Proxy(_.table,new O_($,!1))))}function r8(_,$){return new I.Aliased(R_(_.sql,$),_.fieldAlias)}function R_(_,$){return U.join(_.queryChunks.map((X)=>{if(V(X,p))return X1(X,$);if(V(X,I))return R_(X,$);if(V(X,I.Aliased))return r8(X,$);return X}))}class B2 extends Error{static[K]="DrizzleError";constructor({message:_,cause:$}){super(_);this.name="DrizzleError",this.cause=$}}class D1 extends Error{constructor(_,$,X){super(`Failed query: ${_}
params: ${$}`);if(this.query=_,this.params=$,this.cause=X,Error.captureStackTrace(this,D1),X)this.cause=X}}class a8 extends B2{static[K]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class n3{static[K]="ConsoleLogWriter";write(_){console.log(_)}}class t8{static[K]="DefaultLogger";writer;constructor(_){this.writer=_?.writer??new n3}logQuery(_,$){let X=$.map((J)=>{try{return JSON.stringify(J)}catch{return String(J)}}),Z=X.length?` -- params: [${X.join(", ")}]`:"";this.writer.write(`Query: ${_}${Z}`)}}class e8{static[K]="NoopLogger";logQuery(){}}class Q0{static[K]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}then(_,$){return this.execute().then(_,$)}}function _4(_,$,X){let Z={},J=_.reduce((G,{path:Y,field:z},H)=>{let W;if(V(z,p))W=z;else if(V(z,I))W=z.decoder;else W=z.sql.decoder;let F=G;for(let[A,O]of Y.entries())if(A<Y.length-1){if(!(O in F))F[O]={};F=F[O]}else{let R=$[H],D=F[O]=R===null?null:W.mapFromDriverValue(R);if(X&&V(z,p)&&Y.length===2){let N=Y[0];if(!(N in Z))Z[N]=D===null?L1(z.table):!1;else if(typeof Z[N]==="string"&&Z[N]!==L1(z.table))Z[N]=!1}}return G},{});if(X&&Object.keys(Z).length>0){for(let[G,Y]of Object.entries(Z))if(typeof Y==="string"&&!X[Y])J[G]=null}return J}function g0(_,$){return Object.entries(_).reduce((X,[Z,J])=>{if(typeof Z!=="string")return X;let G=$?[...$,Z]:[Z];if(V(J,p)||V(J,I)||V(J,I.Aliased))X.push({path:G,field:J});else if(V(J,B))X.push(...g0(J[B.Symbol.Columns],G));else X.push(...g0(J,G));return X},[])}function D_(_,$){let X=Object.keys(_),Z=Object.keys($);if(X.length!==Z.length)return!1;for(let[J,G]of X.entries())if(G!==Z[J])return!1;return!0}function Q6(_,$){let X=Object.entries($).filter(([,Z])=>Z!==void 0).map(([Z,J])=>{if(V(J,I)||V(J,p))return[Z,J];else return[Z,new x0(J,_[B.Symbol.Columns][Z])]});if(X.length===0)throw Error("No values to set");return Object.fromEntries(X)}function s3(_,$){for(let X of $)for(let Z of Object.getOwnPropertyNames(X.prototype)){if(Z==="constructor")continue;Object.defineProperty(_.prototype,Z,Object.getOwnPropertyDescriptor(X.prototype,Z)||Object.create(null))}}function o3(_){return _[B.Symbol.Columns]}function V_(_){return V(_,Z0)?_._.alias:V(_,b0)?_[r].name:V(_,I)?void 0:_[B.Symbol.IsAlias]?_[B.Symbol.Name]:_[B.Symbol.BaseName]}function Z1(_,$){return{name:typeof _==="string"&&_.length>0?_:"",config:typeof _==="object"?_:$}}function r3(_){if(typeof _!=="object"||_===null)return!1;if(_.constructor.name!=="Object")return!1;if("logger"in _){let $=typeof _.logger;if($!=="boolean"&&($!=="object"||typeof _.logger.logQuery!=="function")&&$!=="undefined")return!1;return!0}if("schema"in _){let $=typeof _.schema;if($!=="object"&&$!=="undefined")return!1;return!0}if("casing"in _){let $=typeof _.casing;if($!=="string"&&$!=="undefined")return!1;return!0}if("mode"in _){if(_.mode!=="default"||_.mode!=="planetscale"||_.mode!==void 0)return!1;return!0}if("connection"in _){let $=typeof _.connection;if($!=="string"&&$!=="object"&&$!=="undefined")return!1;return!0}if("client"in _){let $=typeof _.client;if($!=="object"&&$!=="function"&&$!=="undefined")return!1;return!0}if(Object.keys(_).length===0)return!0;return!1}var $4=typeof TextDecoder>"u"?null:new TextDecoder;var a3=Symbol.for("drizzle:PgInlineForeignKeys"),t3=Symbol.for("drizzle:EnableRLS");class X4 extends B{static[K]="PgTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:a3,EnableRLS:t3});[a3]=[];[t3]=!1;[B.Symbol.ExtraConfigBuilder]=void 0;[B.Symbol.ExtraConfigColumns]={}}class Z4{static[K]="PgPrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new e3(_,this.columns,this.name)}}class e3{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[K]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[X4.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function L0(_,$){if(c3($)&&!o8(_)&&!V(_,x0)&&!V(_,w1)&&!V(_,p)&&!V(_,B)&&!V(_,b0))return new x0(_,$);return _}var L=(_,$)=>{return U`${_} = ${L0($,_)}`},_7=(_,$)=>{return U`${_} <> ${L0($,_)}`};function K0(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new I($);return new I([new H0("("),U.join($,new H0(" and ")),new H0(")")])}function N_(..._){let $=_.filter((X)=>X!==void 0);if($.length===0)return;if($.length===1)return new I($);return new I([new H0("("),U.join($,new H0(" or ")),new H0(")")])}function $7(_){return U`not ${_}`}var X7=(_,$)=>{return U`${_} > ${L0($,_)}`},Z7=(_,$)=>{return U`${_} >= ${L0($,_)}`},J7=(_,$)=>{return U`${_} < ${L0($,_)}`},G7=(_,$)=>{return U`${_} <= ${L0($,_)}`};function Y7(_,$){if(Array.isArray($)){if($.length===0)return U`false`;return U`${_} in ${$.map((X)=>L0(X,_))}`}return U`${_} in ${L0($,_)}`}function z7(_,$){if(Array.isArray($)){if($.length===0)return U`true`;return U`${_} not in ${$.map((X)=>L0(X,_))}`}return U`${_} not in ${L0($,_)}`}function H7(_){return U`${_} is null`}function W7(_){return U`${_} is not null`}function F7(_){return U`exists ${_}`}function U7(_){return U`not exists ${_}`}function A7(_,$,X){return U`${_} between ${L0($,_)} and ${L0(X,_)}`}function K7(_,$,X){return U`${_} not between ${L0($,_)} and ${L0(X,_)}`}function J1(_,$){return U`${_} like ${$}`}function O7(_,$){return U`${_} not like ${$}`}function R7(_,$){return U`${_} ilike ${$}`}function D7(_,$){return U`${_} not ilike ${$}`}function V7(_){return U`${_} asc`}function p0(_){return U`${_} desc`}class J4{constructor(_,$,X){this.sourceTable=_,this.referencedTable=$,this.relationName=X,this.referencedTableName=$[B.Symbol.Name]}static[K]="Relation";referencedTableName;fieldName}class N7{constructor(_,$){this.table=_,this.config=$}static[K]="Relations"}class P1 extends J4{constructor(_,$,X,Z){super(_,$,X?.relationName);this.config=X,this.isNullable=Z}static[K]="One";withFieldName(_){let $=new P1(this.sourceTable,this.referencedTable,this.config,this.isNullable);return $.fieldName=_,$}}class M_ extends J4{constructor(_,$,X){super(_,$,X?.relationName);this.config=X}static[K]="Many";withFieldName(_){let $=new M_(this.sourceTable,this.referencedTable,this.config);return $.fieldName=_,$}}function M7(){return{and:K0,between:A7,eq:L,exists:F7,gt:X7,gte:Z7,ilike:R7,inArray:Y7,isNull:H7,isNotNull:W7,like:J1,lt:J7,lte:G7,ne:_7,not:$7,notBetween:K7,notExists:U7,notLike:O7,notIlike:D7,notInArray:z7,or:N_,sql:U}}function B7(){return{sql:U,asc:V7,desc:p0}}function Q7(_,$){if(Object.keys(_).length===1&&"default"in _&&!V(_.default,B))_=_.default;let X={},Z={},J={};for(let[G,Y]of Object.entries(_))if(V(Y,B)){let z=n1(Y),H=Z[z];X[z]=G,J[G]={tsName:G,dbName:Y[B.Symbol.Name],schema:Y[B.Symbol.Schema],columns:Y[B.Symbol.Columns],relations:H?.relations??{},primaryKey:H?.primaryKey??[]};for(let F of Object.values(Y[B.Symbol.Columns]))if(F.primary)J[G].primaryKey.push(F);let W=Y[B.Symbol.ExtraConfigBuilder]?.(Y[B.Symbol.ExtraConfigColumns]);if(W){for(let F of Object.values(W))if(V(F,Z4))J[G].primaryKey.push(...F.columns)}}else if(V(Y,N7)){let z=n1(Y.table),H=X[z],W=Y.config($(Y.table)),F;for(let[A,O]of Object.entries(W))if(H){let R=J[H];if(R.relations[A]=O,F)R.primaryKey.push(...F)}else{if(!(z in Z))Z[z]={relations:{},primaryKey:F};Z[z].relations[A]=O}}return{tables:J,tableNamesMap:X}}function UY(_){return function(X,Z){return new P1(_,X,Z,Z?.fields.reduce((J,G)=>J&&G.notNull,!0)??!1)}}function AY(_){return function(X,Z){return new M_(_,X,Z)}}function I7(_,$,X){if(V(X,P1)&&X.config)return{fields:X.config.fields,references:X.config.references};let Z=$[n1(X.referencedTable)];if(!Z)throw Error(`Table "${X.referencedTable[B.Symbol.Name]}" not found in schema`);let J=_[Z];if(!J)throw Error(`Table "${Z}" not found in schema`);let G=X.sourceTable,Y=$[n1(G)];if(!Y)throw Error(`Table "${G[B.Symbol.Name]}" not found in schema`);let z=[];for(let H of Object.values(J.relations))if(X.relationName&&X!==H&&H.relationName===X.relationName||!X.relationName&&H.referencedTable===X.sourceTable)z.push(H);if(z.length>1)throw X.relationName?Error(`There are multiple relations with name "${X.relationName}" in table "${Z}"`):Error(`There are multiple relations between "${Z}" and "${X.sourceTable[B.Symbol.Name]}". Please specify relation name`);if(z[0]&&V(z[0],P1)&&z[0].config)return{fields:z[0].config.references,references:z[0].config.fields};throw Error(`There is not enough information to infer relation "${Y}.${X.fieldName}"`)}function E7(_){return{one:UY(_),many:AY(_)}}function I6(_,$,X,Z,J=(G)=>G){let G={};for(let[Y,z]of Z.entries())if(z.isJson){let H=$.relations[z.tsKey],W=X[Y],F=typeof W==="string"?JSON.parse(W):W;G[z.tsKey]=V(H,P1)?F&&I6(_,_[z.relationTableTsKey],F,z.selection,J):F.map((A)=>I6(_,_[z.relationTableTsKey],A,z.selection,J))}else{let H=J(X[Y]),W=z.field,F;if(V(W,p))F=W;else if(V(W,I))F=W.decoder;else F=W.sql.decoder;G[z.tsKey]=H===null?null:F.mapFromDriverValue(H)}return G}function n0(_){return U`count(${_||U.raw("*")})`.mapWith(Number)}import*as J5 from"node:path";class J0 extends Error{operation;cause;context;constructor(_,$,X,Z){super(_);this.operation=$;this.cause=X;this.context=Z;if(this.name="DatabaseError",Error.captureStackTrace)Error.captureStackTrace(this,J0)}toJSON(){return{name:this.name,message:this.message,operation:this.operation,context:this.context,cause:this.cause?.message,stack:this.stack}}}class E6 extends J0{field;value;constructor(_,$,X,Z){super(_,"validation",Z,{field:$,value:X});this.field=$;this.value=X;this.name="ValidationError"}}class B_ extends J0{connectionDetails;constructor(_,$,X){super(_,"connection",X,$);this.connectionDetails=$;this.name="ConnectionError"}}async function l(_,$,X){try{return await $()}catch(Z){if(Z instanceof J0)throw Z;throw new J0(`Database operation failed: ${_}`,_,Z,X)}}import*as H8 from"node:fs";import*as e_ from"node:path";class q extends Error{code;rawCode;constructor(_,$,X,Z){if($!==void 0)_=`${$}: ${_}`;super(_,{cause:Z});this.code=$,this.rawCode=X,this.name="LibsqlError"}}function j7(_){let $=KY.exec(_);if($===null)throw new q(`The URL '${_}' is not in a valid format`,"URL_INVALID");let X=$.groups,Z=X.scheme,J=X.authority!==void 0?OY(X.authority):void 0,G=s1(X.path),Y=X.query!==void 0?DY(X.query):void 0,z=X.fragment!==void 0?s1(X.fragment):void 0;return{scheme:Z,authority:J,path:G,query:Y,fragment:z}}var KY=(()=>{return new RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su")})();function OY(_){let $=RY.exec(_);if($===null)throw new q("The authority part of the URL is not in a valid format","URL_INVALID");let X=$.groups,Z=s1(X.host_br??X.host),J=X.port?parseInt(X.port,10):void 0,G=X.username!==void 0?{username:s1(X.username),password:X.password!==void 0?s1(X.password):void 0}:void 0;return{host:Z,port:J,userinfo:G}}var RY=(()=>{return new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su")})();function DY(_){let $=_.split("&"),X=[];for(let Z of $){if(Z==="")continue;let J,G,Y=Z.indexOf("=");if(Y<0)J=Z,G="";else J=Z.substring(0,Y),G=Z.substring(Y+1);X.push({key:s1(J.replaceAll("+"," ")),value:s1(G.replaceAll("+"," "))})}return{pairs:X}}function s1(_){try{return decodeURIComponent(_)}catch($){if($ instanceof URIError)throw new q(`URL component has invalid percent encoding: ${$}`,"URL_INVALID",void 0,$);throw $}}function Q_(_,$,X){if($===void 0)throw new q(`URL with scheme ${JSON.stringify(_+":")} requires authority (the "//" part)`,"URL_INVALID");let Z=`${_}:`,J=VY($.host),G=NY($.port),z=`//${MY($.userinfo)}${J}${G}`,H=X.split("/").map(encodeURIComponent).join("/");if(H!==""&&!H.startsWith("/"))H="/"+H;return new URL(`${Z}${z}${H}`)}function VY(_){return _.includes(":")?`[${encodeURI(_)}]`:encodeURI(_)}function NY(_){return _!==void 0?`:${_}`:""}function MY(_){if(_===void 0)return"";let $=encodeURIComponent(_.username),X=_.password!==void 0?`:${encodeURIComponent(_.password)}`:"";return`${$}${X}@`}var I2=typeof Buffer==="function",T7=typeof TextDecoder==="function"?new TextDecoder:void 0,L7=typeof TextEncoder==="function"?new TextEncoder:void 0;var I_=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),j6=((_)=>{let $={};return _.forEach((X,Z)=>$[X]=Z),$})(I_),BY=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,O0=String.fromCharCode.bind(String),w7=typeof Uint8Array.from==="function"?Uint8Array.from.bind(Uint8Array):(_)=>new Uint8Array(Array.prototype.slice.call(_,0)),q7=(_)=>_.replace(/=/g,"").replace(/[+\/]/g,($)=>$=="+"?"-":"_"),C7=(_)=>_.replace(/[^A-Za-z0-9\+\/]/g,""),S7=(_)=>{let $,X,Z,J,G="",Y=_.length%3;for(let z=0;z<_.length;){if((X=_.charCodeAt(z++))>255||(Z=_.charCodeAt(z++))>255||(J=_.charCodeAt(z++))>255)throw TypeError("invalid character found");$=X<<16|Z<<8|J,G+=I_[$>>18&63]+I_[$>>12&63]+I_[$>>6&63]+I_[$&63]}return Y?G.slice(0,Y-3)+"===".substring(Y):G},z4=typeof btoa==="function"?(_)=>btoa(_):I2?(_)=>Buffer.from(_,"binary").toString("base64"):S7,G4=I2?(_)=>Buffer.from(_).toString("base64"):(_)=>{let X=[];for(let Z=0,J=_.length;Z<J;Z+=4096)X.push(O0.apply(null,_.subarray(Z,Z+4096)));return z4(X.join(""))},T6=(_,$=!1)=>$?q7(G4(_)):G4(_),QY=(_)=>{if(_.length<2){var $=_.charCodeAt(0);return $<128?_:$<2048?O0(192|$>>>6)+O0(128|$&63):O0(224|$>>>12&15)+O0(128|$>>>6&63)+O0(128|$&63)}else{var $=65536+(_.charCodeAt(0)-55296)*1024+(_.charCodeAt(1)-56320);return O0(240|$>>>18&7)+O0(128|$>>>12&63)+O0(128|$>>>6&63)+O0(128|$&63)}},IY=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,k7=(_)=>_.replace(IY,QY),P7=I2?(_)=>Buffer.from(_,"utf8").toString("base64"):L7?(_)=>G4(L7.encode(_)):(_)=>z4(k7(_)),Q2=(_,$=!1)=>$?q7(P7(_)):P7(_),x7=(_)=>Q2(_,!0),EY=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,jY=(_)=>{switch(_.length){case 4:var $=(7&_.charCodeAt(0))<<18|(63&_.charCodeAt(1))<<12|(63&_.charCodeAt(2))<<6|63&_.charCodeAt(3),X=$-65536;return O0((X>>>10)+55296)+O0((X&1023)+56320);case 3:return O0((15&_.charCodeAt(0))<<12|(63&_.charCodeAt(1))<<6|63&_.charCodeAt(2));default:return O0((31&_.charCodeAt(0))<<6|63&_.charCodeAt(1))}},v7=(_)=>_.replace(EY,jY),h7=(_)=>{if(_=_.replace(/\s+/g,""),!BY.test(_))throw TypeError("malformed base64.");_+="==".slice(2-(_.length&3));let $,X,Z,J=[];for(let G=0;G<_.length;)if($=j6[_.charAt(G++)]<<18|j6[_.charAt(G++)]<<12|(X=j6[_.charAt(G++)])<<6|(Z=j6[_.charAt(G++)]),X===64)J.push(O0($>>16&255));else if(Z===64)J.push(O0($>>16&255,$>>8&255));else J.push(O0($>>16&255,$>>8&255,$&255));return J.join("")},H4=typeof atob==="function"?(_)=>atob(C7(_)):I2?(_)=>Buffer.from(_,"base64").toString("binary"):h7,y7=I2?(_)=>w7(Buffer.from(_,"base64")):(_)=>w7(H4(_).split("").map(($)=>$.charCodeAt(0))),f7=(_)=>y7(b7(_)),TY=I2?(_)=>Buffer.from(_,"base64").toString("utf8"):T7?(_)=>T7.decode(y7(_)):(_)=>v7(H4(_)),b7=(_)=>C7(_.replace(/[-_]/g,($)=>$=="-"?"+":"/")),Y4=(_)=>TY(b7(_)),LY=(_)=>{if(typeof _!=="string")return!1;let $=_.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test($)||!/[^\s0-9a-zA-Z\-_]/.test($)},g7=(_)=>{return{value:_,enumerable:!1,writable:!0,configurable:!0}},p7=function(){let _=($,X)=>Object.defineProperty(String.prototype,$,g7(X));_("fromBase64",function(){return Y4(this)}),_("toBase64",function($){return Q2(this,$)}),_("toBase64URI",function(){return Q2(this,!0)}),_("toBase64URL",function(){return Q2(this,!0)}),_("toUint8Array",function(){return f7(this)})},m7=function(){let _=($,X)=>Object.defineProperty(Uint8Array.prototype,$,g7(X));_("toBase64",function($){return T6(this,$)}),_("toBase64URI",function(){return T6(this,!0)}),_("toBase64URL",function(){return T6(this,!0)})},wY=()=>{p7(),m7()},E2={version:"3.7.8",VERSION:"3.7.8",atob:H4,atobPolyfill:h7,btoa:z4,btoaPolyfill:S7,fromBase64:Y4,toBase64:Q2,encode:Q2,encodeURI:x7,encodeURL:x7,utob:k7,btou:v7,decode:Y4,isValid:LY,fromUint8Array:T6,toUint8Array:f7,extendString:p7,extendUint8Array:m7,extendBuiltins:wY};var G1="https://github.com/libsql/libsql-client-ts#supported-urls";function x1(_){if(_==="write")return"BEGIN IMMEDIATE";else if(_==="read")return"BEGIN TRANSACTION READONLY";else if(_==="deferred")return"BEGIN DEFERRED";else throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class j2{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(_,$,X,Z,J){this.columns=_,this.columnTypes=$,this.rows=X,this.rowsAffected=Z,this.lastInsertRowid=J}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(PY),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}}function PY(_){return Array.prototype.map.call(_,xY)}function xY(_){if(typeof _==="bigint")return""+_;else if(_ instanceof ArrayBuffer)return E2.fromUint8Array(new Uint8Array(_));else return _}var u7=":memory:";function d7(_){return _.scheme==="file"&&(_.path===":memory:"||_.path.startsWith(":memory:?"))}function E_(_,$){if(typeof _!=="object")throw TypeError(`Expected client configuration as object, got ${typeof _}`);let{url:X,authToken:Z,tls:J,intMode:G,concurrency:Y}=_;Y=Math.max(0,Y||20),G??="number";let z=[];if(X===u7)X="file::memory:";let H=j7(X),W=H.scheme.toLowerCase(),F=W==="file"&&H.path===u7&&H.authority===void 0,A;if(F)A={cache:{values:["shared","private"],update:(N,Q)=>z.push(`${N}=${Q}`)}};else A={tls:{values:["0","1"],update:(N,Q)=>J=Q==="1"},authToken:{update:(N,Q)=>Z=Q}};for(let{key:N,value:Q}of H.query?.pairs??[]){if(!Object.hasOwn(A,N))throw new q(`Unsupported URL query parameter ${JSON.stringify(N)}`,"URL_PARAM_NOT_SUPPORTED");let w=A[N];if(w.values!==void 0&&!w.values.includes(Q))throw new q(`Unknown value for the "${N}" query argument: ${JSON.stringify(Q)}. Supported values are: [${w.values.map((j)=>'"'+j+'"').join(", ")}]`,"URL_INVALID");if(w.update!==void 0)w?.update(N,Q)}let O=z.length===0?"":`?${z.join("&")}`,R=H.path+O,D;if(W==="libsql")if(J===!1){if(H.authority?.port===void 0)throw new q('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");D=$?"http":"ws"}else D=$?"https":"wss";else D=W;if(D==="http"||D==="ws")J??=!1;else J??=!0;if(D!=="http"&&D!=="ws"&&D!=="https"&&D!=="wss"&&D!=="file")throw new q(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(H.scheme+":")}. For more information, please read ${G1}`,"URL_SCHEME_NOT_SUPPORTED");if(G!=="number"&&G!=="bigint"&&G!=="string")throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(G)}`);if(H.fragment!==void 0)throw new q(`URL fragments are not supported: ${JSON.stringify("#"+H.fragment)}`,"URL_INVALID");if(F)return{scheme:"file",tls:!1,path:R,intMode:G,concurrency:Y,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0};return{scheme:D,tls:J,authority:H.authority,path:R,authToken:Z,intMode:G,concurrency:Y,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncInterval:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline,fetch:_.fetch}}var j_=T0(L9(),1);import{Buffer as P9}from"node:buffer";function x9(_){if(_.scheme!=="file")throw new q(`URL scheme ${JSON.stringify(_.scheme+":")} is not supported by the local sqlite3 client. For more information, please read ${G1}`,"URL_SCHEME_NOT_SUPPORTED");let $=_.authority;if($!==void 0){let Y=$.host.toLowerCase();if(Y!==""&&Y!=="localhost")throw new q(`Invalid host in file URL: ${JSON.stringify($.host)}. A "file:" URL with an absolute path should start with one slash ("file:/absolute/path.db") or with three slashes ("file:///absolute/path.db"). For more information, please read ${G1}`,"URL_INVALID");if($.port!==void 0)throw new q("File URL cannot have a port","URL_INVALID");if($.userinfo!==void 0)throw new q("File URL cannot have username and password","URL_INVALID")}let X=d7(_);if(X&&_.syncUrl)throw new q(`Embedded replica must use file for local db but URI with in-memory mode were provided instead: ${_.path}`,"URL_INVALID");let Z=_.path;if(X)Z=`${_.scheme}:${_.path}`;let J={authToken:_.authToken,encryptionKey:_.encryptionKey,syncUrl:_.syncUrl,syncPeriod:_.syncInterval,readYourWrites:_.readYourWrites,offline:_.offline},G=new j_.default(Z,J);return W0(G,"SELECT 1 AS checkThatTheDatabaseCanBeOpened",_.intMode),new q9(Z,J,G,_.intMode)}class q9{#_;#$;#X;#Z;closed;protocol;constructor(_,$,X,Z){this.#_=_,this.#$=$,this.#X=X,this.#Z=Z,this.closed=!1,this.protocol="file"}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#J(),W0(this.#G(),X,this.#Z)}async batch(_,$="deferred"){this.#J();let X=this.#G();try{W0(X,x1($),this.#Z);let Z=_.map((J)=>{if(!X.inTransaction)throw new q("The transaction has been rolled back","TRANSACTION_CLOSED");let G=Array.isArray(J)?{sql:J[0],args:J[1]||[]}:J;return W0(X,G,this.#Z)});return W0(X,"COMMIT",this.#Z),Z}finally{if(X.inTransaction)W0(X,"ROLLBACK",this.#Z)}}async migrate(_){this.#J();let $=this.#G();try{W0($,"PRAGMA foreign_keys=off",this.#Z),W0($,x1("deferred"),this.#Z);let X=_.map((Z)=>{if(!$.inTransaction)throw new q("The transaction has been rolled back","TRANSACTION_CLOSED");return W0($,Z,this.#Z)});return W0($,"COMMIT",this.#Z),X}finally{if($.inTransaction)W0($,"ROLLBACK",this.#Z);W0($,"PRAGMA foreign_keys=on",this.#Z)}}async transaction(_="write"){let $=this.#G();return W0($,x1(_),this.#Z),this.#X=null,new C9($,this.#Z)}async executeMultiple(_){this.#J();let $=this.#G();try{return S9($,_)}finally{if($.inTransaction)W0($,"ROLLBACK",this.#Z)}}async sync(){this.#J();let _=await this.#G().sync();return{frames_synced:_.frames_synced,frame_no:_.frame_no}}async reconnect(){try{if(!this.closed&&this.#X!==null)this.#X.close()}finally{this.#X=new j_.default(this.#_,this.#$),this.closed=!1}}close(){if(this.closed=!0,this.#X!==null)this.#X.close(),this.#X=null}#J(){if(this.closed)throw new q("The client is closed","CLIENT_CLOSED")}#G(){if(this.#X===null)this.#X=new j_.default(this.#_,this.#$);return this.#X}}class C9{#_;#$;constructor(_,$){this.#_=_,this.#$=$}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.#X(),W0(this.#_,X,this.#$)}async batch(_){return _.map(($)=>{this.#X();let X=Array.isArray($)?{sql:$[0],args:$[1]||[]}:$;return W0(this.#_,X,this.#$)})}async executeMultiple(_){return this.#X(),S9(this.#_,_)}async rollback(){if(!this.#_.open)return;this.#X(),W0(this.#_,"ROLLBACK",this.#$)}async commit(){this.#X(),W0(this.#_,"COMMIT",this.#$)}close(){if(this.#_.inTransaction)W0(this.#_,"ROLLBACK",this.#$)}get closed(){return!this.#_.inTransaction}#X(){if(this.closed)throw new q("The transaction is closed","TRANSACTION_CLOSED")}}function W0(_,$,X){let Z,J;if(typeof $==="string")Z=$,J=[];else if(Z=$.sql,Array.isArray($.args))J=$.args.map((G)=>w9(G,X));else{J={};for(let G in $.args){let Y=G[0]==="@"||G[0]==="$"||G[0]===":"?G.substring(1):G;J[Y]=w9($.args[G],X)}}try{let G=_.prepare(Z);G.safeIntegers(!0);let Y=!0;try{G.raw(!0)}catch{Y=!1}if(Y){let z=Array.from(G.columns().map((O)=>O.name)),H=Array.from(G.columns().map((O)=>O.type??"")),W=G.all(J).map((O)=>{return Ez(O,z,X)}),F=0,A=void 0;return new j2(z,H,W,0,void 0)}else{let z=G.run(J),H=z.changes,W=BigInt(z.lastInsertRowid);return new j2([],[],[],H,W)}}catch(G){throw k9(G)}}function Ez(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:_.length});for(let J=0;J<_.length;++J){let G=jz(_[J],X);Object.defineProperty(Z,J,{value:G});let Y=$[J];if(!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function jz(_,$){if(typeof _==="bigint")if($==="number"){if(_<Tz||_>Lz)throw RangeError("Received integer which cannot be safely represented as a JavaScript number");return Number(_)}else if($==="bigint")return _;else if($==="string")return""+_;else throw Error("Invalid value for IntMode");else if(_ instanceof P9)return _.buffer;return _}var Tz=-9007199254740991n,Lz=9007199254740991n;function w9(_,$){if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<wz||_>Pz)throw RangeError("bigint is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")switch($){case"bigint":return _?1n:0n;case"string":return _?"1":"0";default:return _?1:0}else if(_ instanceof ArrayBuffer)return P9.from(_);else if(_ instanceof Date)return _.valueOf();else if(_===void 0)throw TypeError("undefined cannot be passed as argument to the database");else return _}var wz=-9223372036854775808n,Pz=9223372036854775807n;function S9(_,$){try{_.exec($)}catch(X){throw k9(X)}}function k9(_){if(_ instanceof j_.default.SqliteError)return new q(_.message,_.code,_.rawCode,_);return _}var iH=T0(P$(),1),nH=T0(D4(),1),sH=T0(N4(),1),v2=T0(b6(),1),oH=T0(h$(),1);class h2{constructor(){this.intMode="number"}intMode}class m extends Error{constructor(_){super(_);this.name="ClientError"}}class T extends m{constructor(_){super(_);this.name="ProtoError"}}class k_ extends m{code;proto;constructor(_,$){super(_);this.name="ResponseError",this.code=$.code,this.proto=$,this.stack=void 0}}class $0 extends m{constructor(_,$){if($!==void 0){super(`${_}: ${$}`);this.cause=$}else super(_);this.name="ClosedError"}}class v_ extends m{constructor(_){super(_);this.name="WebSocketUnsupportedError"}}class y2 extends m{constructor(_){super(_);this.name="WebSocketError"}}class $2 extends m{status;constructor(_,$){super(_);this.status=$,this.name="HttpServerError"}}class o0 extends m{constructor(_){super(_);this.name="ProtocolVersionError"}}class V0 extends m{constructor(_){super(_);this.name="InternalError"}}class W1 extends m{constructor(_){super(_);this.name="MisuseError"}}function w0(_){if(typeof _==="string")return _;throw f2(_,"string")}function C0(_){if(_===null||_===void 0)return;else if(typeof _==="string")return _;throw f2(_,"string or null")}function Q1(_){if(typeof _==="number")return _;throw f2(_,"number")}function h1(_){if(typeof _==="boolean")return _;throw f2(_,"boolean")}function h_(_){if(Array.isArray(_))return _;throw f2(_,"array")}function G0(_){if(_!==null&&typeof _==="object"&&!Array.isArray(_))return _;throw f2(_,"object")}function r0(_,$){return h_(_).map((X)=>$(G0(X)))}function f2(_,$){if(_===void 0)return new T(`Expected ${$}, but the property was missing`);let X=typeof _;if(_===null)X="null";else if(Array.isArray(_))X="array";return new T(`Expected ${$}, received ${X}`)}function X2(_,$){return $(G0(_))}class y${#_;#$;constructor(_){this.#_=_,this.#$=!1}begin(){this.#_.push("{"),this.#$=!0}end(){this.#_.push("}"),this.#$=!1}#X(_){if(this.#$)this.#_.push('"'),this.#$=!1;else this.#_.push(',"');this.#_.push(_),this.#_.push('":')}string(_,$){this.#X(_),this.#_.push(JSON.stringify($))}stringRaw(_,$){this.#X(_),this.#_.push('"'),this.#_.push($),this.#_.push('"')}number(_,$){this.#X(_),this.#_.push(""+$)}boolean(_,$){this.#X(_),this.#_.push($?"true":"false")}object(_,$,X){this.#X(_),this.begin(),X(this,$),this.end()}arrayObjects(_,$,X){this.#X(_),this.#_.push("[");for(let Z=0;Z<$.length;++Z){if(Z!==0)this.#_.push(",");this.begin(),X(this,$[Z]),this.end()}this.#_.push("]")}}function y_(_,$){let X=[],Z=new y$(X);return Z.begin(),$(Z,_),Z.end(),X.join("")}var Z2=0,f_=1,b_=2;var f$=5;class b${#_;#$;#X;constructor(_){this.#_=_,this.#$=new DataView(_.buffer,_.byteOffset,_.byteLength),this.#X=0}varint(){let _=0;for(let $=0;;$+=7){let X=this.#_[this.#X++];if(_|=(X&127)<<$,!(X&128))break}return _}varintBig(){let _=0n;for(let $=0n;;$+=7n){let X=this.#_[this.#X++];if(_|=BigInt(X&127)<<$,!(X&128))break}return _}bytes(_){let $=new Uint8Array(this.#_.buffer,this.#_.byteOffset+this.#X,_);return this.#X+=_,$}double(){let _=this.#$.getFloat64(this.#X,!0);return this.#X+=8,_}skipVarint(){for(;;)if(!(this.#_[this.#X++]&128))break}skip(_){this.#X+=_}eof(){return this.#X>=this.#_.byteLength}}class g${#_;#$;constructor(_){this.#_=_,this.#$=-1}setup(_){this.#$=_}#X(_){if(this.#$!==_)throw new T(`Expected wire type ${_}, got ${this.#$}`);this.#$=-1}bytes(){this.#X(b_);let _=this.#_.varint();return this.#_.bytes(_)}string(){return new TextDecoder().decode(this.bytes())}message(_){return y1(this.bytes(),_)}int32(){return this.#X(Z2),this.#_.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#X(Z2),this.#_.varintBig()}sint64(){let _=this.uint64();return _>>1n^-(_&1n)}double(){return this.#X(f_),this.#_.double()}maybeSkip(){if(this.#$<0)return;else if(this.#$===Z2)this.#_.skipVarint();else if(this.#$===f_)this.#_.skip(8);else if(this.#$===b_){let _=this.#_.varint();this.#_.skip(_)}else if(this.#$===f$)this.#_.skip(4);else throw new T(`Unexpected wire type ${this.#$}`);this.#$=-1}}function y1(_,$){let X=new b$(_),Z=new g$(X),J=$.default();while(!X.eof()){let G=X.varint(),Y=G>>3,z=G&7;Z.setup(z);let H=$[Y];if(H!==void 0){let W=H(Z,J);if(W!==void 0)J=W}Z.maybeSkip()}return J}class T4{#_;#$;#X;#Z;constructor(){this.#_=new ArrayBuffer(256),this.#$=new Uint8Array(this.#_),this.#X=new DataView(this.#_),this.#Z=0}#J(_){if(this.#Z+_<=this.#_.byteLength)return;let $=this.#_.byteLength;while($<this.#Z+_)$*=2;let X=new ArrayBuffer($),Z=new Uint8Array(X),J=new DataView(X);Z.set(new Uint8Array(this.#_,0,this.#Z)),this.#_=X,this.#$=Z,this.#X=J}#G(_){this.#J(5),_=0|_;do{let $=_&127;_>>>=7,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#Y(_){this.#J(10),_=_&0xffffffffffffffffn;do{let $=Number(_&0x7fn);_>>=7n,$|=_?128:0,this.#$[this.#Z++]=$}while(_)}#z(_,$){this.#G(_<<3|$)}bytes(_,$){this.#z(_,b_),this.#G($.byteLength),this.#J($.byteLength),this.#$.set($,this.#Z),this.#Z+=$.byteLength}string(_,$){this.bytes(_,new TextEncoder().encode($))}message(_,$,X){let Z=new T4;X(Z,$),this.bytes(_,Z.data())}int32(_,$){this.#z(_,Z2),this.#G($)}uint32(_,$){this.int32(_,$)}bool(_,$){this.int32(_,$?1:0)}sint64(_,$){this.#z(_,Z2),this.#Y($<<1n^$>>63n)}double(_,$){this.#z(_,f_),this.#J(8),this.#X.setFloat64(this.#Z,$,!0),this.#Z+=8}data(){return new Uint8Array(this.#_,0,this.#Z)}}function g_(_,$){let X=new T4;return $(X,_),X.data()}class f1{#_;#$;constructor(){this.#_=new Set,this.#$=new Set}alloc(){for(let $ of this.#$){if(this.#$.delete($),this.#_.add($),!this.#_.has(this.#_.size-1))this.#$.add(this.#_.size-1);return $}let _=this.#_.size;return this.#_.add(_),_}free(_){if(!this.#_.delete(_))throw new V0("Freeing an id that is not allocated");if(this.#$.delete(this.#_.size),_<this.#_.size)this.#$.add(_)}}function b(_,$){throw new V0($)}function b2(_){if(_===null)return null;else if(typeof _==="string")return _;else if(typeof _==="number"){if(!Number.isFinite(_))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return _}else if(typeof _==="bigint"){if(_<aH||_>tH)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return _}else if(typeof _==="boolean")return _?1n:0n;else if(_ instanceof ArrayBuffer)return new Uint8Array(_);else if(_ instanceof Uint8Array)return _;else if(_ instanceof Date)return+_.valueOf();else if(typeof _==="object")return""+_.toString();else throw TypeError("Unsupported type of value")}var aH=-9223372036854775808n,tH=9223372036854775807n;function L4(_,$){if(_===null)return null;else if(typeof _==="number")return _;else if(typeof _==="string")return _;else if(typeof _==="bigint")if($==="number"){let X=Number(_);if(!Number.isSafeInteger(X))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return X}else if($==="bigint")return _;else if($==="string")return""+_;else throw new W1("Invalid value for IntMode");else if(_ instanceof Uint8Array)return _.slice().buffer;else if(_===void 0)throw new T("Received unrecognized type of Value");else throw b(_,"Impossible type of Value")}function J2(_){return{affectedRowCount:_.affectedRowCount,lastInsertRowid:_.lastInsertRowid,columnNames:_.cols.map(($)=>$.name),columnDecltypes:_.cols.map(($)=>$.decltype)}}function m6(_,$){let X=J2(_),Z=_.rows.map((J)=>p$(X.columnNames,J,$));return{...X,rows:Z}}function u6(_,$){let X=J2(_),Z;if(_.rows.length>0)Z=p$(X.columnNames,_.rows[0],$);return{...X,row:Z}}function d6(_,$){let X=J2(_),Z;if(_.rows.length>0&&X.columnNames.length>0)Z=L4(_.rows[0][0],$);return{...X,value:Z}}function p$(_,$,X){let Z={};Object.defineProperty(Z,"length",{value:$.length});for(let J=0;J<$.length;++J){let G=L4($[J],X);Object.defineProperty(Z,J,{value:G});let Y=_[J];if(Y!==void 0&&!Object.hasOwn(Z,Y))Object.defineProperty(Z,Y,{value:G,enumerable:!0,configurable:!0,writable:!0})}return Z}function I1(_){return new k_(_.message,_)}class G2{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}_getSqlId(_){if(this.#_!==_)throw new W1("Attempted to use SQL text opened with other object");else if(this.#X!==void 0)throw new $0("SQL text is closed",this.#X);return this.#$}close(){this._setClosed(new m("SQL text was manually closed"))}_setClosed(_){if(this.#X===void 0)this.#X=_,this.#_._closeSql(this.#$)}get closed(){return this.#X!==void 0}}function p_(_,$){if($ instanceof G2)return{sqlId:$._getSqlId(_)};else return{sql:""+$}}class b1{#_;#$;constructor(){this.#_=[],this.#$=[]}get length(){return this.#_.length+this.#$.length}push(_){this.#_.push(_)}shift(){if(this.#$.length===0&&this.#_.length>0)this.#$=this.#_.reverse(),this.#_=[];return this.#$.pop()}first(){return this.#$.length!==0?this.#$[this.#$.length-1]:this.#_[0]}}class m_{sql;_args;_namedArgs;constructor(_){this.sql=_,this._args=[],this._namedArgs=new Map}bindIndexes(_){this._args.length=0;for(let $ of _)this._args.push(b2($));return this}bindIndex(_,$){if(_!==(_|0)||_<=0)throw RangeError("Index of a positional argument must be positive integer");while(this._args.length<_)this._args.push(null);return this._args[_-1]=b2($),this}bindName(_,$){return this._namedArgs.set(_,b2($)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function c6(_,$,X){let Z,J=[],G=[];if($ instanceof m_){Z=$.sql,J=$._args;for(let[H,W]of $._namedArgs.entries())G.push({name:H,value:W})}else if(Array.isArray($))if(Z=$[0],Array.isArray($[1]))J=$[1].map((H)=>b2(H));else G=Object.entries($[1]).map(([H,W])=>{return{name:H,value:b2(W)}});else Z=$;let{sql:Y,sqlId:z}=p_(_,Z);return{sql:Y,sqlId:z,args:J,namedArgs:G,wantRows:X}}class l6{_stream;#_;_steps;#$;constructor(_,$){this._stream=_,this.#_=$,this._steps=[],this.#$=!1}step(){return new w4(this)}execute(){if(this.#$)throw new W1("This batch has already been executed");this.#$=!0;let _={steps:this._steps.map(($)=>$.proto)};if(this.#_)return _W(this._stream,this._steps,_);else return eH(this._stream,this._steps,_)}}function eH(_,$,X){return _._batch(X).then((Z)=>{for(let J=0;J<$.length;++J){let G=Z.stepResults.get(J),Y=Z.stepErrors.get(J);$[J].callback(G,Y)}})}async function _W(_,$,X){let Z=await _._openCursor(X);try{let J=0,G=void 0,Y=[];for(;;){let z=await Z.next();if(z===void 0)break;if(z.type==="step_begin"){if(z.step<J||z.step>=$.length)throw new T("Server produced StepBeginEntry for unexpected step");else if(G!==void 0)throw new T("Server produced StepBeginEntry before terminating previous step");for(let H=J;H<z.step;++H)$[H].callback(void 0,void 0);J=z.step+1,G=z,Y=[]}else if(z.type==="step_end"){if(G===void 0)throw new T("Server produced StepEndEntry but no step is active");let H={cols:G.cols,rows:Y,affectedRowCount:z.affectedRowCount,lastInsertRowid:z.lastInsertRowid};$[G.step].callback(H,void 0),G=void 0,Y=[]}else if(z.type==="step_error"){if(G===void 0){if(z.step>=$.length)throw new T("Server produced StepErrorEntry for unexpected step");for(let H=J;H<z.step;++H)$[H].callback(void 0,void 0)}else{if(z.step!==G.step)throw new T("Server produced StepErrorEntry for unexpected step");G=void 0,Y=[]}$[z.step].callback(void 0,z.error),J=z.step+1}else if(z.type==="row"){if(G===void 0)throw new T("Server produced RowEntry but no step is active");Y.push(z.row)}else if(z.type==="error")throw I1(z.error);else if(z.type==="none")throw new T("Server produced unrecognized CursorEntry");else throw b(z,"Impossible CursorEntry")}if(G!==void 0)throw new T("Server closed Cursor before terminating active step");for(let z=J;z<$.length;++z)$[z].callback(void 0,void 0)}finally{Z.close()}}class w4{_batch;#_;_index;constructor(_){this._batch=_,this.#_=[],this._index=void 0}condition(_){return this.#_.push(_._proto),this}query(_){return this.#$(_,!0,m6)}queryRow(_){return this.#$(_,!0,u6)}queryValue(_){return this.#$(_,!0,d6)}run(_){return this.#$(_,!1,J2)}#$(_,$,X){if(this._index!==void 0)throw new W1("This BatchStep has already been added to the batch");let Z=c6(this._batch._stream._sqlOwner(),_,$),J;if(this.#_.length===0)J=void 0;else if(this.#_.length===1)J=this.#_[0];else J={type:"and",conds:this.#_.slice()};let G={stmt:Z,condition:J};return new Promise((Y,z)=>{let H=(W,F)=>{if(W!==void 0&&F!==void 0)z(new T("Server returned both result and error"));else if(F!==void 0)z(I1(F));else if(W!==void 0)Y(X(W,this._batch._stream.intMode));else Y(void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:G,callback:H})})}}class a{_batch;_proto;constructor(_,$){this._batch=_,this._proto=$}static ok(_){return new a(_._batch,{type:"ok",step:m$(_)})}static error(_){return new a(_._batch,{type:"error",step:m$(_)})}static not(_){return new a(_._batch,{type:"not",cond:_._proto})}static and(_,$){for(let X of $)u$(_,X);return new a(_,{type:"and",conds:$.map((X)=>X._proto)})}static or(_,$){for(let X of $)u$(_,X);return new a(_,{type:"or",conds:$.map((X)=>X._proto)})}static isAutocommit(_){return _._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new a(_,{type:"is_autocommit"})}}function m$(_){if(_._index===void 0)throw new W1("Cannot add a condition referencing a step that has not been added to the batch");return _._index}function u$(_,$){if($._batch!==_)throw new W1("Cannot mix BatchCond objects for different Batch objects")}function d$(_){return{paramNames:_.params.map(($)=>$.name),columns:_.cols,isExplain:_.isExplain,isReadonly:_.isReadonly}}class g2{constructor(_){this.intMode=_}query(_){return this.#_(_,!0,m6)}queryRow(_){return this.#_(_,!0,u6)}queryValue(_){return this.#_(_,!0,d6)}run(_){return this.#_(_,!1,J2)}#_(_,$,X){let Z=c6(this._sqlOwner(),_,$);return this._execute(Z).then((J)=>X(J,this.intMode))}batch(_=!1){return new l6(this,_)}describe(_){let $=p_(this._sqlOwner(),_);return this._describe($).then(d$)}sequence(_){let $=p_(this._sqlOwner(),_);return this._sequence($)}intMode}class u_{}var $W=1000,XW=10;class P4 extends u_{#_;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X){super();this.#_=_,this.#$=$,this.#X=X,this.#Z=new b1,this.#J=new b1,this.#G=void 0,this.#Y=!1}async next(){for(;;){if(this.#G!==void 0)throw new $0("Cursor is closed",this.#G);while(!this.#Y&&this.#J.length<XW)this.#J.push(this.#z());let _=this.#Z.shift();if(this.#Y||_!==void 0)return _;await this.#J.shift().then(($)=>{if($===void 0)return;for(let X of $.entries)this.#Z.push(X);this.#Y||=$.done})}}#z(){return this.#$._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#X,maxCount:$W}).then((_)=>_,(_)=>{this._setClosed(_);return})}_setClosed(_){if(this.#G!==void 0)return;this.#G=_,this.#$._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#X}).catch(()=>{return}),this.#$._cursorClosed(this)}close(){this._setClosed(new m("Cursor was manually closed"))}get closed(){return this.#G!==void 0}}class d_ extends g2{#_;#$;#X;#Z;#J;#G;static open(_){let $=_._streamIdAlloc.alloc(),X=new d_(_,$),Z=()=>{return},J=(Y)=>X.#F(Y),G={type:"open_stream",streamId:$};return _._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}constructor(_,$){super(_.intMode);this.#_=_,this.#$=$,this.#X=new b1,this.#Z=void 0,this.#J=!1,this.#G=void 0}client(){return this.#_}_sqlOwner(){return this.#_}_execute(_){return this.#Y({type:"execute",streamId:this.#$,stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#Y({type:"batch",streamId:this.#$,batch:_}).then(($)=>{return $.result})}_describe(_){return this.#_._ensureVersion(2,"describe()"),this.#Y({type:"describe",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#_._ensureVersion(2,"sequence()"),this.#Y({type:"sequence",streamId:this.#$,sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#Y({type:"get_autocommit",streamId:this.#$}).then((_)=>{return _.isAutocommit})}#Y(_){return new Promise(($,X)=>{this.#z({type:"request",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return this.#_._ensureVersion(3,"cursor"),new Promise(($,X)=>{this.#z({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_sendCursorRequest(_,$){if(_!==this.#Z)throw new V0("Cursor not associated with the stream attempted to execute a request");return new Promise((X,Z)=>{if(this.#G!==void 0)Z(new $0("Stream is closed",this.#G));else this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})})}_cursorClosed(_){if(_!==this.#Z)throw new V0("Cursor was closed, but it was not associated with the stream");this.#Z=void 0,this.#H()}#z(_){if(this.#G!==void 0)_.errorCallback(new $0("Stream is closed",this.#G));else if(this.#J)_.errorCallback(new $0("Stream is closing",void 0));else this.#X.push(_),this.#H()}#H(){for(;;){let _=this.#X.first();if(_===void 0&&this.#Z===void 0&&this.#J){this.#F(new m("Stream was gracefully closed"));break}else if(_?.type==="request"&&this.#Z===void 0){let{request:$,responseCallback:X,errorCallback:Z}=_;this.#X.shift(),this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}else if(_?.type==="cursor"&&this.#Z===void 0){let{batch:$,cursorCallback:X}=_;this.#X.shift();let Z=this.#_._cursorIdAlloc.alloc(),J=new P4(this.#_,this,Z),G={type:"open_cursor",streamId:this.#$,cursorId:Z,batch:$},Y=()=>{return},z=(H)=>J._setClosed(H);this.#_._sendRequest(G,{responseCallback:Y,errorCallback:z}),this.#Z=J,X(J)}else break}}#F(_){if(this.#G!==void 0)return;if(this.#G=_,this.#Z!==void 0)this.#Z._setClosed(_);for(;;){let J=this.#X.shift();if(J!==void 0)J.errorCallback(_);else break}let $={type:"close_stream",streamId:this.#$},X=()=>this.#_._streamIdAlloc.free(this.#$),Z=()=>{return};this.#_._sendRequest($,{responseCallback:X,errorCallback:Z})}close(){this.#F(new m("Stream was manually closed"))}closeGracefully(){this.#J=!0,this.#H()}get closed(){return this.#G!==void 0||this.#J}}function c_(_,$){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId);_.arrayObjects("args",$.args,c$),_.arrayObjects("named_args",$.namedArgs,ZW),_.boolean("want_rows",$.wantRows)}function ZW(_,$){_.string("name",$.name),_.object("value",$.value,c$)}function p2(_,$){_.arrayObjects("steps",$.steps,JW)}function JW(_,$){if($.condition!==void 0)_.object("condition",$.condition,x4);_.object("stmt",$.stmt,c_)}function x4(_,$){if(_.stringRaw("type",$.type),$.type==="ok"||$.type==="error")_.number("step",$.step);else if($.type==="not")_.object("cond",$.cond,x4);else if($.type==="and"||$.type==="or")_.arrayObjects("conds",$.conds,x4);else if($.type==="is_autocommit");else throw b($,"Impossible type of BatchCond")}function c$(_,$){if($===null)_.stringRaw("type","null");else if(typeof $==="bigint")_.stringRaw("type","integer"),_.stringRaw("value",""+$);else if(typeof $==="number")_.stringRaw("type","float"),_.number("value",$);else if(typeof $==="string")_.stringRaw("type","text"),_.string("value",$);else if($ instanceof Uint8Array)_.stringRaw("type","blob"),_.stringRaw("base64",E2.fromUint8Array($));else if($===void 0);else throw b($,"Impossible type of Value")}function l$(_,$){if(_.stringRaw("type",$.type),$.type==="hello"){if($.jwt!==void 0)_.string("jwt",$.jwt)}else if($.type==="request")_.number("request_id",$.requestId),_.object("request",$.request,GW);else throw b($,"Impossible type of ClientMsg")}function GW(_,$){if(_.stringRaw("type",$.type),$.type==="open_stream")_.number("stream_id",$.streamId);else if($.type==="close_stream")_.number("stream_id",$.streamId);else if($.type==="execute")_.number("stream_id",$.streamId),_.object("stmt",$.stmt,c_);else if($.type==="batch")_.number("stream_id",$.streamId),_.object("batch",$.batch,p2);else if($.type==="open_cursor")_.number("stream_id",$.streamId),_.number("cursor_id",$.cursorId),_.object("batch",$.batch,p2);else if($.type==="close_cursor")_.number("cursor_id",$.cursorId);else if($.type==="fetch_cursor")_.number("cursor_id",$.cursorId),_.number("max_count",$.maxCount);else if($.type==="sequence"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if(_.number("stream_id",$.streamId),$.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit")_.number("stream_id",$.streamId);else throw b($,"Impossible type of Request")}function l_(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId);for(let X of $.args)_.message(3,X,n$);for(let X of $.namedArgs)_.message(4,X,YW);_.bool(5,$.wantRows)}function YW(_,$){_.string(1,$.name),_.message(2,$.value,n$)}function m2(_,$){for(let X of $.steps)_.message(1,X,zW)}function zW(_,$){if($.condition!==void 0)_.message(1,$.condition,q4);_.message(2,$.stmt,l_)}function q4(_,$){if($.type==="ok")_.uint32(1,$.step);else if($.type==="error")_.uint32(2,$.step);else if($.type==="not")_.message(3,$.cond,q4);else if($.type==="and")_.message(4,$.conds,i$);else if($.type==="or")_.message(5,$.conds,i$);else if($.type==="is_autocommit")_.message(6,void 0,s$);else throw b($,"Impossible type of BatchCond")}function i$(_,$){for(let X of $)_.message(1,X,q4)}function n$(_,$){if($===null)_.message(1,void 0,s$);else if(typeof $==="bigint")_.sint64(2,$);else if(typeof $==="number")_.double(3,$);else if(typeof $==="string")_.string(4,$);else if($ instanceof Uint8Array)_.bytes(5,$);else if($===void 0);else throw b($,"Impossible type of Value")}function s$(_,$){}function o$(_,$){if($.type==="hello")_.message(1,$,HW);else if($.type==="request")_.message(2,$,WW);else throw b($,"Impossible type of ClientMsg")}function HW(_,$){if($.jwt!==void 0)_.string(1,$.jwt)}function WW(_,$){_.int32(1,$.requestId);let X=$.request;if(X.type==="open_stream")_.message(2,X,FW);else if(X.type==="close_stream")_.message(3,X,UW);else if(X.type==="execute")_.message(4,X,AW);else if(X.type==="batch")_.message(5,X,KW);else if(X.type==="open_cursor")_.message(6,X,OW);else if(X.type==="close_cursor")_.message(7,X,RW);else if(X.type==="fetch_cursor")_.message(8,X,DW);else if(X.type==="sequence")_.message(9,X,VW);else if(X.type==="describe")_.message(10,X,NW);else if(X.type==="store_sql")_.message(11,X,MW);else if(X.type==="close_sql")_.message(12,X,BW);else if(X.type==="get_autocommit")_.message(13,X,QW);else throw b(X,"Impossible type of Request")}function FW(_,$){_.int32(1,$.streamId)}function UW(_,$){_.int32(1,$.streamId)}function AW(_,$){_.int32(1,$.streamId),_.message(2,$.stmt,l_)}function KW(_,$){_.int32(1,$.streamId),_.message(2,$.batch,m2)}function OW(_,$){_.int32(1,$.streamId),_.int32(2,$.cursorId),_.message(3,$.batch,m2)}function RW(_,$){_.int32(1,$.cursorId)}function DW(_,$){_.int32(1,$.cursorId),_.uint32(2,$.maxCount)}function VW(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function NW(_,$){if(_.int32(1,$.streamId),$.sql!==void 0)_.string(2,$.sql);if($.sqlId!==void 0)_.int32(3,$.sqlId)}function MW(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function BW(_,$){_.int32(1,$.sqlId)}function QW(_,$){_.int32(1,$.streamId)}function g1(_){let $=w0(_.message),X=C0(_.code);return{message:$,code:X}}function i_(_){let $=r0(_.cols,r$),X=h_(_.rows).map((Y)=>r0(Y,a$)),Z=Q1(_.affected_row_count),J=C0(_.last_insert_rowid),G=J!==void 0?BigInt(J):void 0;return{cols:$,rows:X,affectedRowCount:Z,lastInsertRowid:G}}function r$(_){let $=C0(_.name),X=C0(_.decltype);return{name:$,decltype:X}}function i6(_){let $=new Map;h_(_.step_results).forEach((Z,J)=>{if(Z!==null)$.set(J,i_(G0(Z)))});let X=new Map;return h_(_.step_errors).forEach((Z,J)=>{if(Z!==null)X.set(J,g1(G0(Z)))}),{stepResults:$,stepErrors:X}}function n6(_){let $=w0(_.type);if($==="step_begin"){let X=Q1(_.step),Z=r0(_.cols,r$);return{type:"step_begin",step:X,cols:Z}}else if($==="step_end"){let X=Q1(_.affected_row_count),Z=C0(_.last_insert_rowid),J=Z!==void 0?BigInt(Z):void 0;return{type:"step_end",affectedRowCount:X,lastInsertRowid:J}}else if($==="step_error"){let X=Q1(_.step),Z=g1(G0(_.error));return{type:"step_error",step:X,error:Z}}else if($==="row")return{type:"row",row:r0(_.row,a$)};else if($==="error")return{type:"error",error:g1(G0(_.error))};else throw new T("Unexpected type of CursorEntry")}function s6(_){let $=r0(_.params,IW),X=r0(_.cols,EW),Z=h1(_.is_explain),J=h1(_.is_readonly);return{params:$,cols:X,isExplain:Z,isReadonly:J}}function IW(_){return{name:C0(_.name)}}function EW(_){let $=w0(_.name),X=C0(_.decltype);return{name:$,decltype:X}}function a$(_){let $=w0(_.type);if($==="null")return null;else if($==="integer"){let X=w0(_.value);return BigInt(X)}else if($==="float")return Q1(_.value);else if($==="text")return w0(_.value);else if($==="blob")return E2.toUint8Array(w0(_.base64));else throw new T("Unexpected type of Value")}function t$(_){let $=w0(_.type);if($==="hello_ok")return{type:"hello_ok"};else if($==="hello_error")return{type:"hello_error",error:g1(G0(_.error))};else if($==="response_ok"){let X=Q1(_.request_id),Z=jW(G0(_.response));return{type:"response_ok",requestId:X,response:Z}}else if($==="response_error"){let X=Q1(_.request_id),Z=g1(G0(_.error));return{type:"response_error",requestId:X,error:Z}}else throw new T("Unexpected type of ServerMsg")}function jW(_){let $=w0(_.type);if($==="open_stream")return{type:"open_stream"};else if($==="close_stream")return{type:"close_stream"};else if($==="execute")return{type:"execute",result:i_(G0(_.result))};else if($==="batch")return{type:"batch",result:i6(G0(_.result))};else if($==="open_cursor")return{type:"open_cursor"};else if($==="close_cursor")return{type:"close_cursor"};else if($==="fetch_cursor"){let X=r0(_.entries,n6),Z=h1(_.done);return{type:"fetch_cursor",entries:X,done:Z}}else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:s6(G0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:h1(_.is_autocommit)};else throw new T("Unexpected type of Response")}var d0={default(){return{message:"",code:void 0}},1(_,$){$.message=_.string()},2(_,$){$.code=_.string()}},p1={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.cols.push(_.message(e$))},2(_,$){$.rows.push(_.message(_X))},3(_,$){$.affectedRowCount=Number(_.uint64())},4(_,$){$.lastInsertRowid=_.sint64()}},e$={default(){return{name:void 0,decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},_X={default(){return[]},1(_,$){$.push(_.message(SW))}},u2={default(){return{stepResults:new Map,stepErrors:new Map}},1(_,$){let[X,Z]=_.message(TW);$.stepResults.set(X,Z)},2(_,$){let[X,Z]=_.message(LW);$.stepErrors.set(X,Z)}},TW={default(){return[0,p1.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(p1)}},LW={default(){return[0,d0.default()]},1(_,$){$[0]=_.uint32()},2(_,$){$[1]=_.message(d0)}},o6={default(){return{type:"none"}},1(_){return _.message(wW)},2(_){return _.message(PW)},3(_){return _.message(xW)},4(_){return{type:"row",row:_.message(_X)}},5(_){return{type:"error",error:_.message(d0)}}},wW={default(){return{type:"step_begin",step:0,cols:[]}},1(_,$){$.step=_.uint32()},2(_,$){$.cols.push(_.message(e$))}},PW={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(_,$){$.affectedRowCount=_.uint32()},2(_,$){$.lastInsertRowid=_.uint64()}},xW={default(){return{type:"step_error",step:0,error:d0.default()}},1(_,$){$.step=_.uint32()},2(_,$){$.error=_.message(d0)}},d2={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(_,$){$.params.push(_.message(qW))},2(_,$){$.cols.push(_.message(CW))},3(_,$){$.isExplain=_.bool()},4(_,$){$.isReadonly=_.bool()}},qW={default(){return{name:void 0}},1(_,$){$.name=_.string()}},CW={default(){return{name:"",decltype:void 0}},1(_,$){$.name=_.string()},2(_,$){$.decltype=_.string()}},SW={default(){return},1(_){return null},2(_){return _.sint64()},3(_){return _.double()},4(_){return _.string()},5(_){return _.bytes()}};var $X={default(){return{type:"none"}},1(_){return{type:"hello_ok"}},2(_){return _.message(kW)},3(_){return _.message(hW)},4(_){return _.message(vW)}},kW={default(){return{type:"hello_error",error:d0.default()}},1(_,$){$.error=_.message(d0)}},vW={default(){return{type:"response_error",requestId:0,error:d0.default()}},1(_,$){$.requestId=_.int32()},2(_,$){$.error=_.message(d0)}},hW={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(_,$){$.requestId=_.int32()},2(_,$){$.response={type:"open_stream"}},3(_,$){$.response={type:"close_stream"}},4(_,$){$.response=_.message(yW)},5(_,$){$.response=_.message(fW)},6(_,$){$.response={type:"open_cursor"}},7(_,$){$.response={type:"close_cursor"}},8(_,$){$.response=_.message(bW)},9(_,$){$.response={type:"sequence"}},10(_,$){$.response=_.message(gW)},11(_,$){$.response={type:"store_sql"}},12(_,$){$.response={type:"close_sql"}},13(_,$){$.response=_.message(pW)}},yW={default(){return{type:"execute",result:p1.default()}},1(_,$){$.result=_.message(p1)}},fW={default(){return{type:"batch",result:u2.default()}},1(_,$){$.result=_.message(u2)}},bW={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(_,$){$.entries.push(_.message(o6))},2(_,$){$.done=_.bool()}},gW={default(){return{type:"describe",result:d2.default()}},1(_,$){$.result=_.message(d2)}},pW={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}};var XX=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),C4=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class r6 extends h2{#_;#$;#X;#Z;#J;#G;#Y;#z;#H;_streamIdAlloc;_cursorIdAlloc;#F;constructor(_,$){super();this.#_=_,this.#$=[],this.#X=!1,this.#Z=void 0,this.#J=!1,this.#G=void 0,this.#Y=!1,this.#z=new Map,this.#H=new f1,this._streamIdAlloc=new f1,this._cursorIdAlloc=new f1,this.#F=new f1,this.#_.binaryType="arraybuffer",this.#_.addEventListener("open",()=>this.#K()),this.#_.addEventListener("close",(X)=>this.#R(X)),this.#_.addEventListener("error",(X)=>this.#O(X)),this.#_.addEventListener("message",(X)=>this.#D(X)),this.#A({type:"hello",jwt:$})}#A(_){if(this.#Z!==void 0)throw new V0("Trying to send a message on a closed client");if(this.#X)this.#U(_);else{let $=()=>this.#U(_),X=()=>{return};this.#$.push({openCallback:$,errorCallback:X})}}#K(){let _=this.#_.protocol;if(_===void 0){this.#W(new m("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(_==="")this.#G={version:1,encoding:"json"};else if(this.#G=C4.get(_),this.#G===void 0){this.#W(new T(`Unrecognized WebSocket subprotocol: ${JSON.stringify(_)}`));return}for(let $ of this.#$)$.openCallback();this.#$.length=0,this.#X=!0}#U(_){let $=this.#G.encoding;if($==="json"){let X=y_(_,l$);this.#_.send(X)}else if($==="protobuf"){let X=g_(_,o$);this.#_.send(X)}else throw b($,"Impossible encoding")}getVersion(){return new Promise((_,$)=>{if(this.#Y=!0,this.#Z!==void 0)$(this.#Z);else if(!this.#X){let X=()=>_(this.#G.version);this.#$.push({openCallback:X,errorCallback:$})}else _(this.#G.version)})}_ensureVersion(_,$){if(this.#G===void 0||!this.#Y)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this.#G.version<_)throw new o0(`${$} is supported on protocol version ${_} and higher, but the WebSocket server only supports version ${this.#G.version}`)}_sendRequest(_,$){if(this.#Z!==void 0){$.errorCallback(new $0("Client is closed",this.#Z));return}let X=this.#H.alloc();this.#z.set(X,{...$,type:_.type}),this.#A({type:"request",requestId:X,request:_})}#O(_){let X=_.message??"WebSocket was closed due to an error";this.#W(new y2(X))}#R(_){let $=`WebSocket was closed with code ${_.code}`;if(_.reason)$+=`: ${_.reason}`;this.#W(new y2($))}#W(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of this.#$)$.errorCallback(_);this.#$.length=0;for(let[$,X]of this.#z.entries())X.errorCallback(_),this.#H.free($);this.#z.clear(),this.#_.close()}#D(_){if(this.#Z!==void 0)return;try{let $,X=this.#G.encoding;if(X==="json"){if(typeof _.data!=="string"){this.#_.close(3003,"Only text messages are accepted with JSON encoding"),this.#W(new T("Received non-text message from server with JSON encoding"));return}$=X2(JSON.parse(_.data),t$)}else if(X==="protobuf"){if(!(_.data instanceof ArrayBuffer)){this.#_.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#W(new T("Received non-binary message from server with Protobuf encoding"));return}$=y1(new Uint8Array(_.data),$X)}else throw b(X,"Impossible encoding");this.#V($)}catch($){this.#_.close(3007,"Could not handle message"),this.#W($)}}#V(_){if(_.type==="none")throw new T("Received an unrecognized ServerMsg");else if(_.type==="hello_ok"||_.type==="hello_error"){if(this.#J)throw new T("Received a duplicated hello response");if(this.#J=!0,_.type==="hello_error")throw I1(_.error);return}else if(!this.#J)throw new T("Received a non-hello message before a hello response");if(_.type==="response_ok"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new T("Received unexpected OK response");this.#H.free($);try{if(X.type!==_.response.type)throw console.dir({responseState:X,msg:_}),new T("Received unexpected type of response");X.responseCallback(_.response)}catch(Z){throw X.errorCallback(Z),Z}}else if(_.type==="response_error"){let $=_.requestId,X=this.#z.get($);if(this.#z.delete($),X===void 0)throw new T("Received unexpected error response");this.#H.free($),X.errorCallback(I1(_.error))}else throw b(_,"Impossible ServerMsg type")}openStream(){return d_.open(this)}storeSql(_){this._ensureVersion(2,"storeSql()");let $=this.#F.alloc(),X=new G2(this,$),Z=()=>{return},J=(Y)=>X._setClosed(Y),G={type:"store_sql",sqlId:$,sql:_};return this._sendRequest(G,{responseCallback:Z,errorCallback:J}),X}_closeSql(_){if(this.#Z!==void 0)return;let $=()=>this.#F.free(_),X=(J)=>this.#W(J),Z={type:"close_sql",sqlId:_};this._sendRequest(Z,{responseCallback:$,errorCallback:X})}close(){this.#W(new m("Client was manually closed"))}get closed(){return this.#Z!==void 0}}var n_=Request,S4=Headers,k4=fetch;var Y2;if(typeof queueMicrotask<"u")Y2=queueMicrotask;else{let _=Promise.resolve();Y2=($)=>{_.then($)}}class v4{#_;#$;#X;constructor(_){this.#_=new Uint8Array(new ArrayBuffer(_)),this.#$=0,this.#X=0}get length(){return this.#X-this.#$}data(){return this.#_.slice(this.#$,this.#X)}push(_){this.#Z(_.byteLength),this.#_.set(_,this.#X),this.#X+=_.byteLength}#Z(_){if(this.#X+_<=this.#_.byteLength)return;let $=this.#X-this.#$;if($+_<=this.#_.byteLength&&2*this.#X>=this.#_.byteLength)this.#_.copyWithin(0,this.#$,this.#X);else{let X=this.#_.byteLength;do X*=2;while($+_>X);let Z=new Uint8Array(new ArrayBuffer(X));Z.set(this.#_.slice(this.#$,this.#X),0),this.#_=Z}this.#X=$,this.#$=0}shift(_){this.#$+=_}}function ZX(_){let $=C0(_.baton),X=C0(_.base_url),Z=r0(_.results,mW);return{baton:$,baseUrl:X,results:Z}}function mW(_){let $=w0(_.type);if($==="ok")return{type:"ok",response:uW(G0(_.response))};else if($==="error")return{type:"error",error:g1(G0(_.error))};else throw new T("Unexpected type of StreamResult")}function uW(_){let $=w0(_.type);if($==="close")return{type:"close"};else if($==="execute")return{type:"execute",result:i_(G0(_.result))};else if($==="batch")return{type:"batch",result:i6(G0(_.result))};else if($==="sequence")return{type:"sequence"};else if($==="describe")return{type:"describe",result:s6(G0(_.result))};else if($==="store_sql")return{type:"store_sql"};else if($==="close_sql")return{type:"close_sql"};else if($==="get_autocommit")return{type:"get_autocommit",isAutocommit:h1(_.is_autocommit)};else throw new T("Unexpected type of StreamResponse")}function JX(_){let $=C0(_.baton),X=C0(_.base_url);return{baton:$,baseUrl:X}}var GX={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()},3(_,$){$.results.push(_.message(dW))}},dW={default(){return{type:"none"}},1(_){return{type:"ok",response:_.message(cW)}},2(_){return{type:"error",error:_.message(d0)}}},cW={default(){return{type:"none"}},1(_){return{type:"close"}},2(_){return _.message(lW)},3(_){return _.message(iW)},4(_){return{type:"sequence"}},5(_){return _.message(nW)},6(_){return{type:"store_sql"}},7(_){return{type:"close_sql"}},8(_){return _.message(sW)}},lW={default(){return{type:"execute",result:p1.default()}},1(_,$){$.result=_.message(p1)}},iW={default(){return{type:"batch",result:u2.default()}},1(_,$){$.result=_.message(u2)}},nW={default(){return{type:"describe",result:d2.default()}},1(_,$){$.result=_.message(d2)}},sW={default(){return{type:"get_autocommit",isAutocommit:!1}},1(_,$){$.isAutocommit=_.bool()}},YX={default(){return{baton:void 0,baseUrl:void 0}},1(_,$){$.baton=_.string()},2(_,$){$.baseUrl=_.string()}};class h4 extends u_{#_;#$;#X;#Z;#J;#G;constructor(_,$){super();this.#_=_,this.#$=$,this.#X=void 0,this.#Z=new v4(16384),this.#J=void 0,this.#G=!1}async open(_){if(_.body===null)throw new T("No response body for cursor request");this.#X=_.body.getReader();let $=await this.#Y(JX,YX);if($===void 0)throw new T("Empty response to cursor request");return $}next(){return this.#Y(n6,o6)}close(){this._setClosed(new m("Cursor was manually closed"))}_setClosed(_){if(this.#J!==void 0)return;if(this.#J=_,this.#_._cursorClosed(this),this.#X!==void 0)this.#X.cancel()}get closed(){return this.#J!==void 0}async#Y(_,$){for(;;){if(this.#G)return;else if(this.#J!==void 0)throw new $0("Cursor is closed",this.#J);if(this.#$==="json"){let J=this.#z();if(J!==void 0){let G=new TextDecoder().decode(J),Y=JSON.parse(G);return X2(Y,_)}}else if(this.#$==="protobuf"){let J=this.#H();if(J!==void 0)return y1(J,$)}else throw b(this.#$,"Impossible encoding");if(this.#X===void 0)throw new V0("Attempted to read from HTTP cursor before it was opened");let{value:X,done:Z}=await this.#X.read();if(Z&&this.#Z.length===0)this.#G=!0;else if(Z)throw new T("Unexpected end of cursor stream");else this.#Z.push(X)}}#z(){let _=this.#Z.data(),$=10,X=_.indexOf(10);if(X<0)return;let Z=_.slice(0,X);return this.#Z.shift(X+1),Z}#H(){let _=this.#Z.data(),$=0,X=0;for(;;){if(X>=_.byteLength)return;let J=_[X];if($|=(J&127)<<7*X,X+=1,!(J&128))break}if(_.byteLength<X+$)return;let Z=_.slice(X,X+$);return this.#Z.shift(X+$),Z}}function zX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.arrayObjects("requests",$.requests,oW)}function oW(_,$){if(_.stringRaw("type",$.type),$.type==="close");else if($.type==="execute")_.object("stmt",$.stmt,c_);else if($.type==="batch")_.object("batch",$.batch,p2);else if($.type==="sequence"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="describe"){if($.sql!==void 0)_.string("sql",$.sql);if($.sqlId!==void 0)_.number("sql_id",$.sqlId)}else if($.type==="store_sql")_.number("sql_id",$.sqlId),_.string("sql",$.sql);else if($.type==="close_sql")_.number("sql_id",$.sqlId);else if($.type==="get_autocommit");else throw b($,"Impossible type of StreamRequest")}function HX(_,$){if($.baton!==void 0)_.string("baton",$.baton);_.object("batch",$.batch,p2)}function WX(_,$){if($.baton!==void 0)_.string(1,$.baton);for(let X of $.requests)_.message(2,X,rW)}function rW(_,$){if($.type==="close")_.message(1,$,aW);else if($.type==="execute")_.message(2,$,tW);else if($.type==="batch")_.message(3,$,eW);else if($.type==="sequence")_.message(4,$,_F);else if($.type==="describe")_.message(5,$,$F);else if($.type==="store_sql")_.message(6,$,XF);else if($.type==="close_sql")_.message(7,$,ZF);else if($.type==="get_autocommit")_.message(8,$,JF);else throw b($,"Impossible type of StreamRequest")}function aW(_,$){}function tW(_,$){_.message(1,$.stmt,l_)}function eW(_,$){_.message(1,$.batch,m2)}function _F(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function $F(_,$){if($.sql!==void 0)_.string(1,$.sql);if($.sqlId!==void 0)_.int32(2,$.sqlId)}function XF(_,$){_.int32(1,$.sqlId),_.string(2,$.sql)}function ZF(_,$){_.int32(1,$.sqlId)}function JF(_,$){}function FX(_,$){if($.baton!==void 0)_.string(1,$.baton);_.message(2,$.batch,m2)}class a6 extends g2{#_;#$;#X;#Z;#J;#G;#Y;#z;#H;#F;#A;#K;constructor(_,$,X,Z){super(_.intMode);this.#_=_,this.#$=$.toString(),this.#X=X,this.#Z=Z,this.#J=void 0,this.#G=new b1,this.#Y=!1,this.#H=!1,this.#F=!1,this.#A=void 0,this.#K=new f1}client(){return this.#_}_sqlOwner(){return this}storeSql(_){let $=this.#K.alloc();return this.#U({type:"store_sql",sqlId:$,sql:_}).then(()=>{return},(X)=>this._setClosed(X)),new G2(this,$)}_closeSql(_){if(this.#A!==void 0)return;this.#U({type:"close_sql",sqlId:_}).then(()=>this.#K.free(_),($)=>this._setClosed($))}_execute(_){return this.#U({type:"execute",stmt:_}).then(($)=>{return $.result})}_batch(_){return this.#U({type:"batch",batch:_}).then(($)=>{return $.result})}_describe(_){return this.#U({type:"describe",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return $.result})}_sequence(_){return this.#U({type:"sequence",sql:_.sql,sqlId:_.sqlId}).then(($)=>{return})}getAutocommit(){return this.#_._ensureVersion(3,"getAutocommit()"),this.#U({type:"get_autocommit"}).then((_)=>{return _.isAutocommit})}#U(_){return new Promise(($,X)=>{this.#O({type:"pipeline",request:_,responseCallback:$,errorCallback:X})})}_openCursor(_){return new Promise(($,X)=>{this.#O({type:"cursor",batch:_,cursorCallback:$,errorCallback:X})})}_cursorClosed(_){if(_!==this.#z)throw new V0("Cursor was closed, but it was not associated with the stream");this.#z=void 0,Y2(()=>this.#R())}close(){this._setClosed(new m("Stream was manually closed"))}closeGracefully(){this.#H=!0,Y2(()=>this.#R())}get closed(){return this.#A!==void 0||this.#H}_setClosed(_){if(this.#A!==void 0)return;if(this.#A=_,this.#z!==void 0)this.#z._setClosed(_);this.#_._streamClosed(this);for(;;){let $=this.#G.shift();if($!==void 0)$.errorCallback(_);else break}if((this.#J!==void 0||this.#Y)&&!this.#F)this.#G.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#F=!0,Y2(()=>this.#R())}#O(_){if(this.#A!==void 0)throw new $0("Stream is closed",this.#A);else if(this.#H)throw new $0("Stream is closing",void 0);else this.#G.push(_),Y2(()=>this.#R())}#R(){if(this.#Y||this.#z!==void 0)return;if(this.#H&&this.#G.length===0){this._setClosed(new m("Stream was gracefully closed"));return}let _=this.#_._endpoint;if(_===void 0){this.#_._endpointPromise.then(()=>this.#R(),(X)=>this._setClosed(X));return}let $=this.#G.shift();if($===void 0)return;else if($.type==="pipeline"){let X=[$];for(;;){let Z=this.#G.first();if(Z!==void 0&&Z.type==="pipeline")X.push(Z),this.#G.shift();else if(Z===void 0&&this.#H&&!this.#F){X.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{return},errorCallback:()=>{return}}),this.#F=!0;break}else break}this.#W(_,X)}else if($.type==="cursor")this.#D(_,$);else throw b($,"Impossible type of QueueEntry")}#W(_,$){this.#V(()=>this.#M($,_),(X)=>YF(X,_.encoding),(X)=>X.baton,(X)=>X.baseUrl,(X)=>GF($,X),(X)=>$.forEach((Z)=>Z.errorCallback(X)))}#D(_,$){let X=new h4(this,_.encoding);this.#z=X,this.#V(()=>this.#B($,_),(Z)=>X.open(Z),(Z)=>Z.baton,(Z)=>Z.baseUrl,(Z)=>$.cursorCallback(X),(Z)=>$.errorCallback(Z))}#V(_,$,X,Z,J,G){let Y;try{let z=_(),H=this.#Z;Y=H(z)}catch(z){Y=Promise.reject(z)}this.#Y=!0,Y.then((z)=>{if(!z.ok)return zF(z).then((H)=>{throw H});return $(z)}).then((z)=>{this.#J=X(z),this.#$=Z(z)??this.#$,J(z)}).catch((z)=>{this._setClosed(z),G(z)}).finally(()=>{this.#Y=!1,this.#R()})}#M(_,$){return this.#N(new URL($.pipelinePath,this.#$),{baton:this.#J,requests:_.map((X)=>X.request)},$.encoding,zX,WX)}#B(_,$){if($.cursorPath===void 0)throw new o0(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${$.version}.`);return this.#N(new URL($.cursorPath,this.#$),{baton:this.#J,batch:_.batch},$.encoding,HX,FX)}#N(_,$,X,Z,J){let G,Y;if(X==="json")G=y_($,Z),Y="application/json";else if(X==="protobuf")G=g_($,J),Y="application/x-protobuf";else throw b(X,"Impossible encoding");let z=new S4;if(z.set("content-type",Y),this.#X!==void 0)z.set("authorization",`Bearer ${this.#X}`);return new n_(_.toString(),{method:"POST",headers:z,body:G})}}function GF(_,$){if($.results.length!==_.length)throw new T("Server returned unexpected number of pipeline results");for(let X=0;X<_.length;++X){let Z=$.results[X],J=_[X];if(Z.type==="ok"){if(Z.response.type!==J.request.type)throw new T("Received unexpected type of response");J.responseCallback(Z.response)}else if(Z.type==="error")J.errorCallback(I1(Z.error));else if(Z.type==="none")throw new T("Received unrecognized type of StreamResult");else throw b(Z,"Received impossible type of StreamResult")}}async function YF(_,$){if($==="json"){let X=await _.json();return X2(X,ZX)}if($==="protobuf"){let X=await _.arrayBuffer();return y1(new Uint8Array(X),GX)}throw await _.body?.cancel(),b($,"Impossible encoding")}async function zF(_){let $=_.headers.get("content-type")??"text/plain",X=`Server returned HTTP status ${_.status}`;if($==="application/json"){let Z=await _.json();if("message"in Z)return I1(Z);return new $2(X,_.status)}if($==="text/plain"){let Z=(await _.text()).trim();if(Z!=="")X+=`: ${Z}`;return new $2(X,_.status)}return await _.body?.cancel(),new $2(X,_.status)}var HF=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],y4={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class t6 extends h2{#_;#$;#X;#Z;#J;_endpointPromise;_endpoint;constructor(_,$,X,Z=2){super();if(this.#_=_,this.#$=$,this.#X=X??k4,this.#Z=void 0,this.#J=new Set,Z==3)this._endpointPromise=WF(this.#X,this.#_),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J));else this._endpointPromise=Promise.resolve(y4),this._endpointPromise.then((J)=>this._endpoint=J,(J)=>this.#G(J))}async getVersion(){if(this._endpoint!==void 0)return this._endpoint.version;return(await this._endpointPromise).version}_ensureVersion(_,$){if(_<=y4.version)return;else if(this._endpoint===void 0)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);else if(this._endpoint.version<_)throw new o0(`${$} is supported only on protocol version ${_} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}openStream(){if(this.#Z!==void 0)throw new $0("Client is closed",this.#Z);let _=new a6(this,this.#_,this.#$,this.#X);return this.#J.add(_),_}_streamClosed(_){this.#J.delete(_)}close(){this.#G(new m("Client was manually closed"))}get closed(){return this.#Z!==void 0}#G(_){if(this.#Z!==void 0)return;this.#Z=_;for(let $ of Array.from(this.#J))$._setClosed(new $0("Client was closed",_))}}async function WF(_,$){let X=_;for(let Z of HF){let J=new URL(Z.versionPath,$),G=new n_(J.toString(),{method:"GET"}),Y=await X(G);if(await Y.arrayBuffer(),Y.ok)return Z}return y4}function f4(_,$,X=2){if(typeof v2.default>"u")throw new v_("WebSockets are not supported in this environment");var Z=void 0;if(X==3)Z=Array.from(C4.keys());else Z=Array.from(XX.keys());let J=new v2.default(_,Z);return new r6(J,$)}function b4(_,$,X,Z=2){return new t6(_ instanceof URL?_:new URL(_),$,X,Z)}class s_{#_;#$;#X;constructor(_,$){this.#_=_,this.#$=$,this.#X=void 0}execute(_){return this.batch([_]).then(($)=>$[0])}async batch(_){let $=this._getStream();if($.closed)throw new q("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let X=_.map(E1),Z;if(this.#X===void 0){this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=G.step(),z=Y.run(x1(this.#_)),H=Y;Z=X.map((W)=>{let F=G.step().condition(a.ok(H));if(this.#$>=3)F.condition(a.not(a.isAutocommit(G)));let A=F.query(W);return A.catch(()=>{return}),H=F,A}),this.#X=G.execute().then(()=>z).then(()=>{return});try{await this.#X}catch(W){throw this.close(),W}}else{if(this.#$<3)await this.#X;this._getSqlCache().apply(X);let G=$.batch(this.#$>=3),Y=void 0;Z=X.map((z)=>{let H=G.step();if(Y!==void 0)H.condition(a.ok(Y));if(this.#$>=3)H.condition(a.not(a.isAutocommit(G)));let W=H.query(z);return W.catch(()=>{return}),Y=H,W}),await G.execute()}let J=[];for(let G of Z){let Y=await G;if(Y===void 0)throw new q("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");J.push(l2(Y))}return J}catch(X){throw e(X)}}async executeMultiple(_){let $=this._getStream();if($.closed)throw new q("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#X===void 0){this.#X=$.run(x1(this.#_)).then(()=>{return});try{await this.#X}catch(X){throw this.close(),X}}else await this.#X;await $.sequence(_)}catch(X){throw e(X)}}async rollback(){try{let _=this._getStream();if(_.closed)return;if(this.#X!==void 0);else return;let $=_.run("ROLLBACK").catch((X)=>{throw e(X)});_.closeGracefully(),await $}catch(_){throw e(_)}finally{this.close()}}async commit(){try{let _=this._getStream();if(_.closed)throw new q("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#X!==void 0)await this.#X;else return;let $=_.run("COMMIT").catch((X)=>{throw e(X)});_.closeGracefully(),await $}catch(_){throw e(_)}finally{this.close()}}}async function c2(_,$,X,Z,J=!1){if(J)X.step().run("PRAGMA foreign_keys=off");let G=X.step(),Y=G.run(x1(_)),z=G,H=Z.map((R)=>{let D=X.step().condition(a.ok(z));if($>=3)D.condition(a.not(a.isAutocommit(X)));let N=D.query(R);return z=D,N}),W=X.step().condition(a.ok(z));if($>=3)W.condition(a.not(a.isAutocommit(X)));let F=W.run("COMMIT");if(X.step().condition(a.not(a.ok(W))).run("ROLLBACK").catch((R)=>{return}),J)X.step().run("PRAGMA foreign_keys=on");await X.execute();let O=[];await Y;for(let R of H){let D=await R;if(D===void 0)throw new q("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");O.push(l2(D))}return await F,O}function E1(_){let $,X;if(Array.isArray(_))[$,X]=_;else if(typeof _==="string")$=_;else $=_.sql,X=_.args;let Z=new m_($);if(X)if(Array.isArray(X))Z.bindIndexes(X);else for(let[J,G]of Object.entries(X))Z.bindName(J,G);return Z}function l2(_){let $=_.columnNames.map((Y)=>Y??""),X=_.columnDecltypes.map((Y)=>Y??""),Z=_.rows,J=_.affectedRowCount,G=_.lastInsertRowid!==void 0?_.lastInsertRowid:void 0;return new j2($,X,Z,J,G)}function e(_){if(_ instanceof m){let $=UX(_);return new q(_.message,$,void 0,_)}return _}function UX(_){if(_ instanceof k_&&_.code!==void 0)return _.code;else if(_ instanceof T)return"HRANA_PROTO_ERROR";else if(_ instanceof $0)return _.cause instanceof m?UX(_.cause):"HRANA_CLOSED_ERROR";else if(_ instanceof y2)return"HRANA_WEBSOCKET_ERROR";else if(_ instanceof $2)return"SERVER_ERROR";else if(_ instanceof o0)return"PROTOCOL_VERSION_ERROR";else if(_ instanceof V0)return"INTERNAL_ERROR";else return"UNKNOWN"}class i2{#_;#$;capacity;constructor(_,$){this.#_=_,this.#$=new AX,this.capacity=$}apply(_){if(this.capacity<=0)return;let $=new Set;for(let X of _){if(typeof X.sql!=="string")continue;let Z=X.sql;if(Z.length>=5000)continue;let J=this.#$.get(Z);if(J===void 0){while(this.#$.size+1>this.capacity){let[G,Y]=this.#$.peekLru();if($.has(Y))break;Y.close(),this.#$.delete(G)}if(this.#$.size+1<=this.capacity)J=this.#_.storeSql(Z),this.#$.set(Z,J)}if(J!==void 0)X.sql=J,$.add(J)}}}class AX{#_;constructor(){this.#_=new Map}get(_){let $=this.#_.get(_);if($!==void 0)this.#_.delete(_),this.#_.set(_,$);return $}set(_,$){this.#_.set(_,$)}peekLru(){for(let _ of this.#_.entries())return _;return}delete(_){this.#_.delete(_)}get size(){return this.#_.size}}var DX=T0(p4(),1);function VX(_){if(_.scheme!=="wss"&&_.scheme!=="ws")throw new q(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${G1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new q("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="ws"&&_.tls)throw new q('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="wss"&&!_.tls)throw new q('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=Q_(_.scheme,_.authority,_.path),X;try{X=f4($,_.authToken)}catch(Z){if(Z instanceof v_){let J=_.scheme==="wss"?"https":"http",G=Q_(J,_.authority,_.path);throw new q(`This environment does not support WebSockets, please switch to the HTTP client by using a "${J}:" URL (${JSON.stringify(G)}). For more information, please read ${G1}`,"WEBSOCKETS_NOT_SUPPORTED")}throw e(Z)}return new NX(X,$,_.authToken,_.intMode,_.concurrency)}var AF=60000,RX=100;class NX{#_;#$;#X;#Z;#J;closed;protocol;#G;#Y;constructor(_,$,X,Z,J){this.#_=$,this.#$=X,this.#X=Z,this.#Z=this.#H(_),this.#J=void 0,this.closed=!1,this.protocol="ws",this.#Y=DX.default(J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{let Z=await this.#z();try{let J=E1(X);Z.conn.sqlCache.apply([J]);let G=Z.stream.query(J);Z.stream.closeGracefully();let Y=await G;return l2(Y)}catch(J){throw e(J)}finally{this._closeStream(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{let X=await this.#z();try{let J=_.map((W)=>{if(Array.isArray(W))return{sql:W[0],args:W[1]||[]};return W}).map(E1),G=await X.conn.client.getVersion();X.conn.sqlCache.apply(J);let Y=X.stream.batch(G>=3);return await c2($,G,Y,J)}catch(Z){throw e(Z)}finally{this._closeStream(X)}})}async migrate(_){return this.limit(async()=>{let $=await this.#z();try{let X=_.map(E1),Z=await $.conn.client.getVersion(),J=$.stream.batch(Z>=3);return await c2("deferred",Z,J,X,!0)}catch(X){throw e(X)}finally{this._closeStream($)}})}async transaction(_="write"){return this.limit(async()=>{let $=await this.#z();try{let X=await $.conn.client.getVersion();return new MX(this,$,_,X)}catch(X){throw this._closeStream($),e(X)}})}async executeMultiple(_){return this.limit(async()=>{let $=await this.#z();try{let X=$.stream.sequence(_);$.stream.closeGracefully(),await X}catch(X){throw e(X)}finally{this._closeStream($)}})}sync(){throw new q("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async#z(){if(this.closed)throw new q("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#Z.openTime.valueOf()>AF&&this.#J===void 0){let Z=this.#H();this.#J=Z,Z.client.getVersion().then((J)=>{if(this.#Z!==Z){if(this.#Z.streamStates.size===0)this.#Z.client.close()}this.#Z=Z,this.#J=void 0},(J)=>{this.#J=void 0})}if(this.#Z.client.closed)try{if(this.#J!==void 0)this.#Z=this.#J;else this.#Z=this.#H()}catch(Z){throw e(Z)}let X=this.#Z;try{if(X.useSqlCache===void 0){if(X.useSqlCache=await X.client.getVersion()>=2,X.useSqlCache)X.sqlCache.capacity=RX}let Z=X.client.openStream();Z.intMode=this.#X;let J={conn:X,stream:Z};return X.streamStates.add(J),J}catch(Z){throw e(Z)}}#H(_){try{return _??=f4(this.#_,this.#$),{client:_,useSqlCache:void 0,sqlCache:new i2(_,0),openTime:new Date,streamStates:new Set}}catch($){throw e($)}}async reconnect(){try{for(let X of Array.from(this.#Z.streamStates))try{X.stream.close()}catch{}this.#Z.client.close()}catch{}if(this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}let _=this.#H(),$=await _.client.getVersion();if(_.useSqlCache=$>=2,_.useSqlCache)_.sqlCache.capacity=RX;this.#Z=_,this.closed=!1}_closeStream(_){_.stream.close();let $=_.conn;if($.streamStates.delete(_),$.streamStates.size===0&&$!==this.#Z)$.client.close()}close(){if(this.#Z.client.close(),this.closed=!0,this.#J){try{this.#J.client.close()}catch{}this.#J=void 0}this.closed=!0}}class MX extends s_{#_;#$;constructor(_,$,X,Z){super(X,Z);this.#_=_,this.#$=$}_getStream(){return this.#$.stream}_getSqlCache(){return this.#$.conn.sqlCache}close(){this.#_._closeStream(this.#$)}get closed(){return this.#$.stream.closed}}var BX=T0(p4(),1);function QX(_){if(_.scheme!=="https"&&_.scheme!=="http")throw new q(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(_.scheme+":")}. For more information, please read ${G1}`,"URL_SCHEME_NOT_SUPPORTED");if(_.encryptionKey!==void 0)throw new q("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(_.scheme==="http"&&_.tls)throw new q('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");else if(_.scheme==="https"&&!_.tls)throw new q('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let $=Q_(_.scheme,_.authority,_.path);return new EX($,_.authToken,_.intMode,_.fetch,_.concurrency)}var IX=30;class EX{#_;protocol;#$;#X;#Z;#J;#G;#Y;constructor(_,$,X,Z,J){this.#$=_,this.#G=$,this.#X=X,this.#Z=Z,this.#J=J,this.#_=b4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X,this.protocol="http",this.#Y=BX.default(this.#J)}async limit(_){return this.#Y(_)}async execute(_,$){let X;if(typeof _==="string")X={sql:_,args:$||[]};else X=_;return this.limit(async()=>{try{let Z=E1(X),J,G=this.#_.openStream();try{J=G.query(Z)}finally{G.closeGracefully()}let Y=await J;return l2(Y)}catch(Z){throw e(Z)}})}async batch(_,$="deferred"){return this.limit(async()=>{try{let Z=_.map((H)=>{if(Array.isArray(H))return{sql:H[0],args:H[1]||[]};return H}).map(E1),J=await this.#_.getVersion(),G,Y=this.#_.openStream();try{new i2(Y,IX).apply(Z);let W=Y.batch(!1);G=c2($,J,W,Z)}finally{Y.closeGracefully()}return await G}catch(X){throw e(X)}})}async migrate(_){return this.limit(async()=>{try{let $=_.map(E1),X=await this.#_.getVersion(),Z,J=this.#_.openStream();try{let Y=J.batch(!1);Z=c2("deferred",X,Y,$,!0)}finally{J.closeGracefully()}return await Z}catch($){throw e($)}})}async transaction(_="write"){return this.limit(async()=>{try{let $=await this.#_.getVersion();return new jX(this.#_.openStream(),_,$)}catch($){throw e($)}})}async executeMultiple(_){return this.limit(async()=>{try{let $,X=this.#_.openStream();try{$=X.sequence(_)}finally{X.closeGracefully()}await $}catch($){throw e($)}})}sync(){throw new q("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#_.close()}async reconnect(){try{if(!this.closed)this.#_.close()}finally{this.#_=b4(this.#$,this.#G,this.#Z),this.#_.intMode=this.#X}}get closed(){return this.#_.closed}}class jX extends s_{#_;#$;constructor(_,$,X){super($,X);this.#_=_,this.#$=new i2(_,IX)}_getStream(){return this.#_}_getSqlCache(){return this.#$}close(){this.#_.close()}get closed(){return this.#_.closed}}function m1(_){return KF(E_(_,!0))}function KF(_){if(_.scheme==="wss"||_.scheme==="ws")return VX(_);else if(_.scheme==="https"||_.scheme==="http")return QX(_);else return x9(_)}class Y0{static[K]="SelectionProxyHandler";config;constructor(_){this.config={..._}}get(_,$){if($==="_")return{..._._,selectedFields:new Proxy(_._.selectedFields,this)};if($===r)return{..._[r],selectedFields:new Proxy(_[r].selectedFields,this)};if(typeof $==="symbol")return _[$];let Z=(V(_,Z0)?_._.selectedFields:V(_,b0)?_[r].selectedFields:_)[$];if(V(Z,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!Z.isSelectionField)return Z.sql;let J=Z.clone();return J.isSelectionField=!0,J}if(V(Z,I)){if(this.config.sqlBehavior==="sql")return Z;throw Error(`You tried to reference "${$}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}if(V(Z,p)){if(this.config.alias)return new Proxy(Z,new M2(new Proxy(Z.table,new O_(this.config.alias,this.config.replaceOriginalName??!1))));return Z}if(typeof Z!=="object"||Z===null)return Z;return new Proxy(Z,new Y0(this.config))}}class m4{static[K]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(_,$){if(this.reference=()=>{let{name:X,columns:Z,foreignColumns:J}=_();return{name:X,columns:Z,foreignTable:J[0].table,foreignColumns:J}},$)this._onUpdate=$.onUpdate,this._onDelete=$.onDelete}onUpdate(_){return this._onUpdate=_,this}onDelete(_){return this._onDelete=_,this}build(_){return new TX(_,this)}}class TX{constructor(_,$){this.table=_,this.reference=$.reference,this.onUpdate=$._onUpdate,this.onDelete=$._onDelete}static[K]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:_,columns:$,foreignColumns:X}=this.reference(),Z=$.map((Y)=>Y.name),J=X.map((Y)=>Y.name),G=[this.table[P0],...Z,X[0].table[P0],...J];return _??`${G.join("_")}_fk`}}function LX(_,$){return`${_[P0]}_${$.join("_")}_unique`}class U0 extends c8{static[K]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(_,$={}){return this.foreignKeyConfigs.push({ref:_,actions:$}),this}unique(_){return this.config.isUnique=!0,this.config.uniqueName=_,this}generatedAlwaysAs(_,$){return this.config.generated={as:_,type:"always",mode:$?.mode??"virtual"},this}buildForeignKeys(_,$){return this.foreignKeyConfigs.map(({ref:X,actions:Z})=>{return((J,G)=>{let Y=new m4(()=>{let z=J();return{columns:[_],foreignColumns:[z]}});if(G.onUpdate)Y.onUpdate(G.onUpdate);if(G.onDelete)Y.onDelete(G.onDelete);return Y.build($)})(X,Z)})}}class _0 extends p{constructor(_,$){if(!$.uniqueName)$.uniqueName=LX(_,[$.name]);super(_,$);this.table=_}static[K]="SQLiteColumn"}class wX extends U0{static[K]="SQLiteBigIntBuilder";constructor(_){super(_,"bigint","SQLiteBigInt")}build(_){return new PX(_,this.config)}}class PX extends _0{static[K]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return BigInt($.toString("utf8"))}return BigInt($4.decode(_))}mapToDriverValue(_){return Buffer.from(_.toString())}}class xX extends U0{static[K]="SQLiteBlobJsonBuilder";constructor(_){super(_,"json","SQLiteBlobJson")}build(_){return new qX(_,this.config)}}class qX extends _0{static[K]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(_){if(typeof Buffer<"u"&&Buffer.from){let $=Buffer.isBuffer(_)?_:_ instanceof ArrayBuffer?Buffer.from(_):_.buffer?Buffer.from(_.buffer,_.byteOffset,_.byteLength):Buffer.from(_);return JSON.parse($.toString("utf8"))}return JSON.parse($4.decode(_))}mapToDriverValue(_){return Buffer.from(JSON.stringify(_))}}class CX extends U0{static[K]="SQLiteBlobBufferBuilder";constructor(_){super(_,"buffer","SQLiteBlobBuffer")}build(_){return new SX(_,this.config)}}class SX extends _0{static[K]="SQLiteBlobBuffer";mapFromDriverValue(_){if(Buffer.isBuffer(_))return _;return Buffer.from(_)}getSQLType(){return"blob"}}function kX(_,$){let{name:X,config:Z}=Z1(_,$);if(Z?.mode==="json")return new xX(X);if(Z?.mode==="bigint")return new wX(X);return new CX(X)}class vX extends U0{static[K]="SQLiteCustomColumnBuilder";constructor(_,$,X){super(_,"custom","SQLiteCustomColumn");this.config.fieldConfig=$,this.config.customTypeParams=X}build(_){return new hX(_,this.config)}}class hX extends _0{static[K]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(_,$){super(_,$);this.sqlName=$.customTypeParams.dataType($.fieldConfig),this.mapTo=$.customTypeParams.toDriver,this.mapFrom=$.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(_){return typeof this.mapFrom==="function"?this.mapFrom(_):_}mapToDriverValue(_){return typeof this.mapTo==="function"?this.mapTo(_):_}}function yX(_){return($,X)=>{let{name:Z,config:J}=Z1($,X);return new vX(Z,J,_)}}class e6 extends U0{static[K]="SQLiteBaseIntegerBuilder";constructor(_,$,X){super(_,$,X);this.config.autoIncrement=!1}primaryKey(_){if(_?.autoIncrement)this.config.autoIncrement=!0;return this.config.hasDefault=!0,super.primaryKey()}}class _8 extends _0{static[K]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class fX extends e6{static[K]="SQLiteIntegerBuilder";constructor(_){super(_,"number","SQLiteInteger")}build(_){return new bX(_,this.config)}}class bX extends _8{static[K]="SQLiteInteger"}class gX extends e6{static[K]="SQLiteTimestampBuilder";constructor(_,$){super(_,"date","SQLiteTimestamp");this.config.mode=$}defaultNow(){return this.default(U`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(_){return new pX(_,this.config)}}class pX extends _8{static[K]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(_){if(this.config.mode==="timestamp")return new Date(_*1000);return new Date(_)}mapToDriverValue(_){let $=_.getTime();if(this.config.mode==="timestamp")return Math.floor($/1000);return $}}class mX extends e6{static[K]="SQLiteBooleanBuilder";constructor(_,$){super(_,"boolean","SQLiteBoolean");this.config.mode=$}build(_){return new uX(_,this.config)}}class uX extends _8{static[K]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(_){return Number(_)===1}mapToDriverValue(_){return _?1:0}}function S0(_,$){let{name:X,config:Z}=Z1(_,$);if(Z?.mode==="timestamp"||Z?.mode==="timestamp_ms")return new gX(X,Z.mode);if(Z?.mode==="boolean")return new mX(X,Z.mode);return new fX(X)}class dX extends U0{static[K]="SQLiteNumericBuilder";constructor(_){super(_,"string","SQLiteNumeric")}build(_){return new cX(_,this.config)}}class cX extends _0{static[K]="SQLiteNumeric";mapFromDriverValue(_){if(typeof _==="string")return _;return String(_)}getSQLType(){return"numeric"}}class lX extends U0{static[K]="SQLiteNumericNumberBuilder";constructor(_){super(_,"number","SQLiteNumericNumber")}build(_){return new iX(_,this.config)}}class iX extends _0{static[K]="SQLiteNumericNumber";mapFromDriverValue(_){if(typeof _==="number")return _;return Number(_)}mapToDriverValue=String;getSQLType(){return"numeric"}}class nX extends U0{static[K]="SQLiteNumericBigIntBuilder";constructor(_){super(_,"bigint","SQLiteNumericBigInt")}build(_){return new sX(_,this.config)}}class sX extends _0{static[K]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function oX(_,$){let{name:X,config:Z}=Z1(_,$),J=Z?.mode;return J==="number"?new lX(X):J==="bigint"?new nX(X):new dX(X)}class rX extends U0{static[K]="SQLiteRealBuilder";constructor(_){super(_,"number","SQLiteReal")}build(_){return new aX(_,this.config)}}class aX extends _0{static[K]="SQLiteReal";getSQLType(){return"real"}}function F1(_){return new rX(_??"")}class tX extends U0{static[K]="SQLiteTextBuilder";constructor(_,$){super(_,"string","SQLiteText");this.config.enumValues=$.enum,this.config.length=$.length}build(_){return new eX(_,this.config)}}class eX extends _0{static[K]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(_,$){super(_,$)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class _Z extends U0{static[K]="SQLiteTextJsonBuilder";constructor(_){super(_,"json","SQLiteTextJson")}build(_){return new $Z(_,this.config)}}class $Z extends _0{static[K]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(_){return JSON.parse(_)}mapToDriverValue(_){return JSON.stringify(_)}}function k(_,$={}){let{name:X,config:Z}=Z1(_,$);if(Z.mode==="json")return new _Z(X);return new tX(X,Z)}function XZ(){return{blob:kX,customType:yX,integer:S0,numeric:oX,real:F1,text:k}}var u4=Symbol.for("drizzle:SQLiteInlineForeignKeys");class z0 extends B{static[K]="SQLiteTable";static Symbol=Object.assign({},B.Symbol,{InlineForeignKeys:u4});[B.Symbol.Columns];[u4]=[];[B.Symbol.ExtraConfigBuilder]=void 0}function OF(_,$,X,Z,J=_){let G=new z0(_,Z,J),Y=typeof $==="function"?$(XZ()):$,z=Object.fromEntries(Object.entries(Y).map(([W,F])=>{let A=F;A.setName(W);let O=A.build(G);return G[u4].push(...A.buildForeignKeys(O,G)),[W,O]})),H=Object.assign(G,z);if(H[B.Symbol.Columns]=z,H[B.Symbol.ExtraConfigColumns]=z,X)H[z0.Symbol.ExtraConfigBuilder]=X;return H}var I0=(_,$,X)=>{return OF(_,$,X)};class ZZ{constructor(_,$){this.name=_,this.unique=$}static[K]="SQLiteIndexBuilderOn";on(..._){return new JZ(this.name,_,this.unique)}}class JZ{static[K]="SQLiteIndexBuilder";config;constructor(_,$,X){this.config={name:_,columns:$,unique:X,where:void 0}}where(_){return this.config.where=_,this}build(_){return new GZ(this.config,_)}}class GZ{static[K]="SQLiteIndex";config;constructor(_,$){this.config={..._,table:$}}}function R0(_){return new ZZ(_,!1)}function n2(..._){if(_[0].columns)return new d4(_[0].columns,_[0].name);return new d4(_)}class d4{static[K]="SQLitePrimaryKeyBuilder";columns;name;constructor(_,$){this.columns=_,this.name=$}build(_){return new YZ(_,this.columns,this.name)}}class YZ{constructor(_,$,X){this.table=_,this.columns=$,this.name=X}static[K]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[z0.Symbol.Name]}_${this.columns.map((_)=>_.name).join("_")}_pk`}}function a0(_){if(V(_,z0))return[`${_[B.Symbol.BaseName]}`];if(V(_,Z0))return _._.usedTables??[];if(V(_,I))return _.usedTables??[];return[]}class $8 extends Q0{constructor(_,$,X,Z){super();this.table=_,this.session=$,this.dialect=X,this.config={table:_,withList:Z}}static[K]="SQLiteDelete";config;where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.table[z0.Symbol.Columns]){return this.config.returning=g0(_),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:a0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(_){return this._prepare().execute(_)}$dynamic(){return this}}function RF(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map((X)=>X.toLowerCase()).join("_")}function DF(_){return(_.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((X,Z,J)=>{let G=J===0?Z.toLowerCase():`${Z[0].toUpperCase()}${Z.slice(1)}`;return X+G},"")}function VF(_){return _}class c4{static[K]="CasingCache";cache={};cachedTables={};convert;constructor(_){this.convert=_==="snake_case"?RF:_==="camelCase"?DF:VF}getColumnCasing(_){if(!_.keyAsName)return _.name;let $=_.table[B.Symbol.Schema]??"public",X=_.table[B.Symbol.OriginalName],Z=`${$}.${X}.${_.name}`;if(!this.cache[Z])this.cacheTable(_.table);return this.cache[Z]}cacheTable(_){let $=_[B.Symbol.Schema]??"public",X=_[B.Symbol.OriginalName],Z=`${$}.${X}`;if(!this.cachedTables[Z]){for(let J of Object.values(_[B.Symbol.Columns])){let G=`${Z}.${J.name}`;this.cache[G]=this.convert(J.name)}this.cachedTables[Z]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class z2 extends b0{static[K]="SQLiteViewBase"}class s2{static[K]="SQLiteDialect";casing;constructor(_){this.casing=new c4(_?.casing)}escapeName(_){return`"${_}"`}escapeParam(_){return"?"}escapeString(_){return`'${_.replace(/'/g,"''")}'`}buildWithCTE(_){if(!_?.length)return;let $=[U`with `];for(let[X,Z]of _.entries())if($.push(U`${U.identifier(Z._.alias)} as (${Z._.sql})`),X<_.length-1)$.push(U`, `);return $.push(U` `),U.join($)}buildDeleteQuery({table:_,where:$,returning:X,withList:Z,limit:J,orderBy:G}){let Y=this.buildWithCTE(Z),z=X?U` returning ${this.buildSelection(X,{isSingleTable:!0})}`:void 0,H=$?U` where ${$}`:void 0,W=this.buildOrderBy(G),F=this.buildLimit(J);return U`${Y}delete from ${_}${H}${z}${W}${F}`}buildUpdateSet(_,$){let X=_[B.Symbol.Columns],Z=Object.keys(X).filter((G)=>$[G]!==void 0||X[G]?.onUpdateFn!==void 0),J=Z.length;return U.join(Z.flatMap((G,Y)=>{let z=X[G],H=$[G]??U.param(z.onUpdateFn(),z),W=U`${U.identifier(this.casing.getColumnCasing(z))} = ${H}`;if(Y<J-1)return[W,U.raw(", ")];return[W]}))}buildUpdateQuery({table:_,set:$,where:X,returning:Z,withList:J,joins:G,from:Y,limit:z,orderBy:H}){let W=this.buildWithCTE(J),F=this.buildUpdateSet(_,$),A=Y&&U.join([U.raw(" from "),this.buildFromTable(Y)]),O=this.buildJoins(G),R=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,D=X?U` where ${X}`:void 0,N=this.buildOrderBy(H),Q=this.buildLimit(z);return U`${W}update ${_} set ${F}${A}${O}${D}${R}${N}${Q}`}buildSelection(_,{isSingleTable:$=!1}={}){let X=_.length,Z=_.flatMap(({field:J},G)=>{let Y=[];if(V(J,I.Aliased)&&J.isSelectionField)Y.push(U.identifier(J.fieldAlias));else if(V(J,I.Aliased)||V(J,I)){let z=V(J,I.Aliased)?J.sql:J;if($)Y.push(new I(z.queryChunks.map((H)=>{if(V(H,p))return U.identifier(this.casing.getColumnCasing(H));return H})));else Y.push(z);if(V(J,I.Aliased))Y.push(U` as ${U.identifier(J.fieldAlias)}`)}else if(V(J,p)){let z=J.table[B.Symbol.Name];if(J.columnType==="SQLiteNumericBigInt")if($)Y.push(U`cast(${U.identifier(this.casing.getColumnCasing(J))} as text)`);else Y.push(U`cast(${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))} as text)`);else if($)Y.push(U.identifier(this.casing.getColumnCasing(J)));else Y.push(U`${U.identifier(z)}.${U.identifier(this.casing.getColumnCasing(J))}`)}if(G<X-1)Y.push(U`, `);return Y});return U.join(Z)}buildJoins(_){if(!_||_.length===0)return;let $=[];if(_)for(let[X,Z]of _.entries()){if(X===0)$.push(U` `);let J=Z.table,G=Z.on?U` on ${Z.on}`:void 0;if(V(J,z0)){let Y=J[z0.Symbol.Name],z=J[z0.Symbol.Schema],H=J[z0.Symbol.OriginalName],W=Y===H?void 0:Z.alias;$.push(U`${U.raw(Z.joinType)} join ${z?U`${U.identifier(z)}.`:void 0}${U.identifier(H)}${W&&U` ${U.identifier(W)}`}${G}`)}else $.push(U`${U.raw(Z.joinType)} join ${J}${G}`);if(X<_.length-1)$.push(U` `)}return U.join($)}buildLimit(_){return typeof _==="object"||typeof _==="number"&&_>=0?U` limit ${_}`:void 0}buildOrderBy(_){let $=[];if(_){for(let[X,Z]of _.entries())if($.push(Z),X<_.length-1)$.push(U`, `)}return $.length>0?U` order by ${U.join($)}`:void 0}buildFromTable(_){if(V(_,B)&&_[B.Symbol.IsAlias])return U`${U`${U.identifier(_[B.Symbol.Schema]??"")}.`.if(_[B.Symbol.Schema])}${U.identifier(_[B.Symbol.OriginalName])} ${U.identifier(_[B.Symbol.Name])}`;return _}buildSelectQuery({withList:_,fields:$,fieldsFlat:X,where:Z,having:J,table:G,joins:Y,orderBy:z,groupBy:H,limit:W,offset:F,distinct:A,setOperators:O}){let R=X??g0($);for(let l0 of R)if(V(l0.field,p)&&L1(l0.field.table)!==(V(G,Z0)?G._.alias:V(G,z2)?G[r].name:V(G,I)?void 0:L1(G))&&!((_1)=>Y?.some(({alias:Z6})=>Z6===(_1[B.Symbol.IsAlias]?L1(_1):_1[B.Symbol.BaseName])))(l0.field.table)){let _1=L1(l0.field.table);throw Error(`Your "${l0.path.join("->")}" field references a column "${_1}"."${l0.field.name}", but the table "${_1}" is not part of the query! Did you forget to join it?`)}let D=!Y||Y.length===0,N=this.buildWithCTE(_),Q=A?U` distinct`:void 0,w=this.buildSelection(R,{isSingleTable:D}),j=this.buildFromTable(G),E=this.buildJoins(Y),d=Z?U` where ${Z}`:void 0,X0=J?U` having ${J}`:void 0,P=[];if(H){for(let[l0,_1]of H.entries())if(P.push(_1),l0<H.length-1)P.push(U`, `)}let g=P.length>0?U` group by ${U.join(P)}`:void 0,h0=this.buildOrderBy(z),T1=this.buildLimit(W),X_=F?U` offset ${F}`:void 0,K2=U`${N}select${Q} ${w} from ${j}${E}${d}${g}${X0}${h0}${T1}${X_}`;if(O.length>0)return this.buildSetOperations(K2,O);return K2}buildSetOperations(_,$){let[X,...Z]=$;if(!X)throw Error("Cannot pass undefined values to any set operator");if(Z.length===0)return this.buildSetOperationQuery({leftSelect:_,setOperator:X});return this.buildSetOperations(this.buildSetOperationQuery({leftSelect:_,setOperator:X}),Z)}buildSetOperationQuery({leftSelect:_,setOperator:{type:$,isAll:X,rightSelect:Z,limit:J,orderBy:G,offset:Y}}){let z=U`${_.getSQL()} `,H=U`${Z.getSQL()}`,W;if(G&&G.length>0){let R=[];for(let D of G)if(V(D,_0))R.push(U.identifier(D.name));else if(V(D,I)){for(let N=0;N<D.queryChunks.length;N++){let Q=D.queryChunks[N];if(V(Q,_0))D.queryChunks[N]=U.identifier(this.casing.getColumnCasing(Q))}R.push(U`${D}`)}else R.push(U`${D}`);W=U` order by ${U.join(R,U`, `)}`}let F=typeof J==="object"||typeof J==="number"&&J>=0?U` limit ${J}`:void 0,A=U.raw(`${$} ${X?"all ":""}`),O=Y?U` offset ${Y}`:void 0;return U`${z}${A}${H}${W}${F}${O}`}buildInsertQuery({table:_,values:$,onConflict:X,returning:Z,withList:J,select:G}){let Y=[],z=_[B.Symbol.Columns],H=Object.entries(z).filter(([D,N])=>!N.shouldDisableInsert()),W=H.map(([,D])=>U.identifier(this.casing.getColumnCasing(D)));if(G){let D=$;if(V(D,I))Y.push(D);else Y.push(D.getSQL())}else{let D=$;Y.push(U.raw("values "));for(let[N,Q]of D.entries()){let w=[];for(let[j,E]of H){let d=Q[j];if(d===void 0||V(d,x0)&&d.value===void 0){let X0;if(E.default!==null&&E.default!==void 0)X0=V(E.default,I)?E.default:U.param(E.default,E);else if(E.defaultFn!==void 0){let P=E.defaultFn();X0=V(P,I)?P:U.param(P,E)}else if(!E.default&&E.onUpdateFn!==void 0){let P=E.onUpdateFn();X0=V(P,I)?P:U.param(P,E)}else X0=U`null`;w.push(X0)}else w.push(d)}if(Y.push(w),N<D.length-1)Y.push(U`, `)}}let F=this.buildWithCTE(J),A=U.join(Y),O=Z?U` returning ${this.buildSelection(Z,{isSingleTable:!0})}`:void 0,R=X?.length?U.join(X):void 0;return U`${F}insert into ${_} ${W} ${A}${R}${O}`}sqlToQuery(_,$){return _.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:$})}buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:Z,tableConfig:J,queryConfig:G,tableAlias:Y,nestedQueryRelation:z,joinOn:H}){let W=[],F,A,O=[],R,D=[];if(G===!0)W=Object.entries(J.columns).map(([w,j])=>({dbKey:j.name,tsKey:w,field:X1(j,Y),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let Q=Object.fromEntries(Object.entries(J.columns).map(([P,g])=>[P,X1(g,Y)]));if(G.where){let P=typeof G.where==="function"?G.where(Q,M7()):G.where;R=P&&R_(P,Y)}let w=[],j=[];if(G.columns){let P=!1;for(let[g,h0]of Object.entries(G.columns)){if(h0===void 0)continue;if(g in J.columns){if(!P&&h0===!0)P=!0;j.push(g)}}if(j.length>0)j=P?j.filter((g)=>G.columns?.[g]===!0):Object.keys(J.columns).filter((g)=>!j.includes(g))}else j=Object.keys(J.columns);for(let P of j){let g=J.columns[P];w.push({tsKey:P,value:g})}let E=[];if(G.with)E=Object.entries(G.with).filter((P)=>!!P[1]).map(([P,g])=>({tsKey:P,queryConfig:g,relation:J.relations[P]}));let d;if(G.extras){d=typeof G.extras==="function"?G.extras(Q,{sql:U}):G.extras;for(let[P,g]of Object.entries(d))w.push({tsKey:P,value:r8(g,Y)})}for(let{tsKey:P,value:g}of w)W.push({dbKey:V(g,I.Aliased)?g.fieldAlias:J.columns[P].name,tsKey:P,field:V(g,p)?X1(g,Y):g,relationTableTsKey:void 0,isJson:!1,selection:[]});let X0=typeof G.orderBy==="function"?G.orderBy(Q,B7()):G.orderBy??[];if(!Array.isArray(X0))X0=[X0];O=X0.map((P)=>{if(V(P,p))return X1(P,Y);return R_(P,Y)}),F=G.limit,A=G.offset;for(let{tsKey:P,queryConfig:g,relation:h0}of E){let T1=I7($,X,h0),X_=n1(h0.referencedTable),K2=X[X_],l0=`${Y}_${P}`,_1=K0(...T1.fields.map((YJ,zJ)=>L(X1(T1.references[zJ],l0),X1(YJ,Y)))),Z6=this.buildRelationalQuery({fullSchema:_,schema:$,tableNamesMap:X,table:_[K2],tableConfig:$[K2],queryConfig:V(h0,P1)?g===!0?{limit:1}:{...g,limit:1}:g,tableAlias:l0,joinOn:_1,nestedQueryRelation:h0}),GJ=U`(${Z6.sql})`.as(P);W.push({dbKey:P,tsKey:P,field:GJ,relationTableTsKey:K2,isJson:!0,selection:Z6.selection})}}if(W.length===0)throw new B2({message:`No fields selected for table "${J.tsName}" ("${Y}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let N;if(R=K0(H,R),z){let Q=U`json_array(${U.join(W.map(({field:E})=>V(E,_0)?U.identifier(this.casing.getColumnCasing(E)):V(E,I.Aliased)?E.sql:E),U`, `)})`;if(V(z,M_))Q=U`coalesce(json_group_array(${Q}), json_array())`;let w=[{dbKey:"data",tsKey:"data",field:Q.as("data"),isJson:!0,relationTableTsKey:J.tsName,selection:W}];if(F!==void 0||A!==void 0||O.length>0)N=this.buildSelectQuery({table:B6(Z,Y),fields:{},fieldsFlat:[{path:[],field:U.raw("*")}],where:R,limit:F,offset:A,orderBy:O,setOperators:[]}),R=void 0,F=void 0,A=void 0,O=void 0;else N=B6(Z,Y);N=this.buildSelectQuery({table:V(N,z0)?N:new Z0(N,{},Y),fields:{},fieldsFlat:w.map(({field:E})=>({path:[],field:V(E,p)?X1(E,Y):E})),joins:D,where:R,limit:F,offset:A,orderBy:O,setOperators:[]})}else N=this.buildSelectQuery({table:B6(Z,Y),fields:{},fieldsFlat:W.map(({field:Q})=>({path:[],field:V(Q,p)?X1(Q,Y):Q})),joins:D,where:R,limit:F,offset:A,orderBy:O,setOperators:[]});return{tableTsKey:J.tsName,sql:N,selection:W}}}class l4 extends s2{static[K]="SQLiteSyncDialect";migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;$.run(J);let Y=$.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;$.run(U`BEGIN`);try{for(let z of _)if(!Y||Number(Y[2])<z.folderMillis){for(let H of z.sql)$.run(U.raw(H));$.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${z.hash}, ${z.folderMillis})`)}$.run(U`COMMIT`)}catch(z){throw $.run(U`ROLLBACK`),z}}}class i4 extends s2{static[K]="SQLiteAsyncDialect";async migrate(_,$,X){let Z=X===void 0?"__drizzle_migrations":typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",J=U`
			CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await $.run(J);let Y=(await $.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await $.transaction(async(z)=>{for(let H of _)if(!Y||Number(Y[2])<H.folderMillis){for(let W of H.sql)await z.run(U.raw(W));await z.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${H.hash}, ${H.folderMillis})`)}})}}class n4{static[K]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class t0{static[K]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(_){this.fields=_.fields,this.session=_.session,this.dialect=_.dialect,this.withList=_.withList,this.distinct=_.distinct}from(_){let $=!!this.fields,X;if(this.fields)X=this.fields;else if(V(_,Z0))X=Object.fromEntries(Object.keys(_._.selectedFields).map((Z)=>[Z,_[Z]]));else if(V(_,z2))X=_[r].selectedFields;else if(V(_,I))X={};else X=o3(_);return new s4({table:_,fields:X,isPartialSelect:$,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class zZ extends n4{static[K]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:_,fields:$,isPartialSelect:X,session:Z,dialect:J,withList:G,distinct:Y}){super();this.config={withList:G,table:_,fields:{...$},distinct:Y,setOperators:[]},this.isPartialSelect=X,this.session=Z,this.dialect=J,this._={selectedFields:$,config:this.config},this.tableName=V_(_),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{};for(let z of a0(_))this.usedTables.add(z)}getUsedTables(){return[...this.usedTables]}createJoin(_){return($,X)=>{let Z=this.tableName,J=V_($);for(let G of a0($))this.usedTables.add(G);if(typeof J==="string"&&this.config.joins?.some((G)=>G.alias===J))throw Error(`Alias "${J}" is already used in this query`);if(!this.isPartialSelect){if(Object.keys(this.joinsNotNullableMap).length===1&&typeof Z==="string")this.config.fields={[Z]:this.config.fields};if(typeof J==="string"&&!V($,I)){let G=V($,Z0)?$._.selectedFields:V($,b0)?$[r].selectedFields:$[B.Symbol.Columns];this.config.fields[J]=G}}if(typeof X==="function")X=X(new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));if(!this.config.joins)this.config.joins=[];if(this.config.joins.push({on:X,table:$,joinType:_,alias:J}),typeof J==="string")switch(_){case"left":{this.joinsNotNullableMap[J]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[J]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([G])=>[G,!1])),this.joinsNotNullableMap[J]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(_,$){return(X)=>{let Z=typeof X==="function"?X(NF()):X;if(!D_(this.getSelectedFields(),Z.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:_,isAll:$,rightSelect:Z}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(_){return this.config.setOperators.push(..._),this}where(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.where=_,this}having(_){if(typeof _==="function")_=_(new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.having=_,this}groupBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray($)?$:[$]}else this.config.groupBy=_;return this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.fields,new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=X;else this.config.orderBy=X}else{let $=_;if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=$;else this.config.orderBy=$}return this}limit(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).limit=_;else this.config.limit=_;return this}offset(_){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).offset=_;else this.config.offset=_;return this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}as(_){let $=[];if($.push(...a0(this.config.table)),this.config.joins)for(let X of this.config.joins)$.push(...a0(X.table));return new Proxy(new Z0(this.getSQL(),this.config.fields,_,!1,[...new Set($)]),new Y0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Y0({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class s4 extends zZ{static[K]="SQLiteSelect";_prepare(_=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let $=g0(this.config.fields),X=this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),$,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return X.joinsNotNullableMap=this.joinsNotNullableMap,X}$withCache(_){return this.cacheConfig=_===void 0?{config:{},enable:!0,autoInvalidate:!0}:_===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,..._},this}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.all()}}s3(s4,[Q0]);function X8(_,$){return(X,Z,...J)=>{let G=[Z,...J].map((Y)=>({type:_,isAll:$,rightSelect:Y}));for(let Y of G)if(!D_(X.getSelectedFields(),Y.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return X.addSetOperators(G)}}var NF=()=>({union:MF,unionAll:BF,intersect:QF,except:IF}),MF=X8("union",!1),BF=X8("union",!0),QF=X8("intersect",!1),IF=X8("except",!1);class o_{static[K]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(_){this.dialect=V(_,s2)?_:void 0,this.dialectConfig=V(_,s2)?void 0:_}$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(X);return new Proxy(new U_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new Y0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};with(..._){let $=this;function X(J){return new t0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_})}function Z(J){return new t0({fields:J??void 0,session:void 0,dialect:$.getDialect(),withList:_,distinct:!0})}return{select:X,selectDistinct:Z}}select(_){return new t0({fields:_??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(_){return new t0({fields:_??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){if(!this.dialect)this.dialect=new l4(this.dialectConfig);return this.dialect}}class Z8{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[K]="SQLiteInsertBuilder";values(_){if(_=Array.isArray(_)?_:[_],_.length===0)throw Error("values() must be called with at least one value");let $=_.map((X)=>{let Z={},J=this.table[B.Symbol.Columns];for(let G of Object.keys(X)){let Y=X[G];Z[G]=V(Y,I)?Y:new x0(Y,J[G])}return Z});return new o4(this.table,$,this.session,this.dialect,this.withList)}select(_){let $=typeof _==="function"?_(new o_):_;if(!V($,I)&&!D_(this.table[N6],$._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new o4(this.table,$,this.session,this.dialect,this.withList,!0)}}class o4 extends Q0{constructor(_,$,X,Z,J,G){super();this.session=X,this.dialect=Z,this.config={table:_,values:$,withList:J,select:G}}static[K]="SQLiteInsert";config;returning(_=this.config.table[z0.Symbol.Columns]){return this.config.returning=g0(_),this}onConflictDoNothing(_={}){if(!this.config.onConflict)this.config.onConflict=[];if(_.target===void 0)this.config.onConflict.push(U` on conflict do nothing`);else{let $=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,X=_.where?U` where ${_.where}`:U``;this.config.onConflict.push(U` on conflict ${$} do nothing${X}`)}return this}onConflictDoUpdate(_){if(_.where&&(_.targetWhere||_.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');if(!this.config.onConflict)this.config.onConflict=[];let $=_.where?U` where ${_.where}`:void 0,X=_.targetWhere?U` where ${_.targetWhere}`:void 0,Z=_.setWhere?U` where ${_.setWhere}`:void 0,J=Array.isArray(_.target)?U`${_.target}`:U`${[_.target]}`,G=this.dialect.buildUpdateSet(this.config.table,Q6(this.config.table,_.set));return this.config.onConflict.push(U` on conflict ${J}${X} do update set ${G}${$}${Z}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:a0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class J8{constructor(_,$,X,Z){this.table=_,this.session=$,this.dialect=X,this.withList=Z}static[K]="SQLiteUpdateBuilder";set(_){return new HZ(this.table,Q6(this.table,_),this.session,this.dialect,this.withList)}}class HZ extends Q0{constructor(_,$,X,Z,J){super();this.session=X,this.dialect=Z,this.config={set:$,table:_,withList:J,joins:[]}}static[K]="SQLiteUpdate";config;from(_){return this.config.from=_,this}createJoin(_){return($,X)=>{let Z=V_($);if(typeof Z==="string"&&this.config.joins.some((J)=>J.alias===Z))throw Error(`Alias "${Z}" is already used in this query`);if(typeof X==="function"){let J=this.config.from?V($,z0)?$[B.Symbol.Columns]:V($,Z0)?$._.selectedFields:V($,z2)?$[r].selectedFields:void 0:void 0;X=X(new Proxy(this.config.table[B.Symbol.Columns],new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),J&&new Proxy(J,new Y0({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:X,table:$,joinType:_,alias:Z}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(_){return this.config.where=_,this}orderBy(..._){if(typeof _[0]==="function"){let $=_[0](new Proxy(this.config.table[B.Symbol.Columns],new Y0({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray($)?$:[$];this.config.orderBy=X}else{let $=_;this.config.orderBy=$}return this}limit(_){return this.config.limit=_,this}returning(_=this.config.table[z0.Symbol.Columns]){return this.config.returning=g0(_),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:_,...$}=this.dialect.sqlToQuery(this.getSQL());return $}_prepare(_=!0){return this.session[_?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:a0(this.config.table)})}prepare(){return this._prepare(!1)}run=(_)=>{return this._prepare().run(_)};all=(_)=>{return this._prepare().all(_)};get=(_)=>{return this._prepare().get(_)};values=(_)=>{return this._prepare().values(_)};async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class r_ extends I{constructor(_){super(r_.buildEmbeddedCount(_.source,_.filters).queryChunks);this.params=_,this.session=_.session,this.sql=r_.buildCount(_.source,_.filters)}sql;static[K]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(_,$){return U`(select count(*) from ${_}${U.raw(" where ").if($)}${$})`}static buildCount(_,$){return U`select count(*) from ${_}${U.raw(" where ").if($)}${$}`}then(_,$){return Promise.resolve(this.session.count(this.sql)).then(_,$)}catch(_){return this.then(void 0,_)}finally(_){return this.then(($)=>{return _?.(),$},($)=>{throw _?.(),$})}}class a4{constructor(_,$,X,Z,J,G,Y,z){this.mode=_,this.fullSchema=$,this.schema=X,this.tableNamesMap=Z,this.table=J,this.tableConfig=G,this.dialect=Y,this.session=z}static[K]="SQLiteAsyncRelationalQueryBuilder";findMany(_){return this.mode==="sync"?new r4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many"):new G8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?_:{},"many")}findFirst(_){return this.mode==="sync"?new r4(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first"):new G8(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,_?{..._,limit:1}:{limit:1},"first")}}class G8 extends Q0{constructor(_,$,X,Z,J,G,Y,z,H){super();this.fullSchema=_,this.schema=$,this.tableNamesMap=X,this.table=Z,this.tableConfig=J,this.dialect=G,this.session=Y,this.config=z,this.mode=H}static[K]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(_=!1){let{query:$,builtQuery:X}=this._toSQL();return this.session[_?"prepareOneTimeQuery":"prepareQuery"](X,void 0,this.mode==="first"?"get":"all",!0,(Z,J)=>{let G=Z.map((Y)=>I6(this.schema,this.tableConfig,Y,$.selection,J));if(this.mode==="first")return G[0];return G})}prepare(){return this._prepare(!1)}_toSQL(){let _=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),$=this.dialect.sqlToQuery(_.sql);return{query:_,builtQuery:$}}toSQL(){return this._toSQL().builtQuery}executeRaw(){if(this.mode==="first")return this._prepare(!1).get();return this._prepare(!1).all()}async execute(){return this.executeRaw()}}class r4 extends G8{static[K]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class o2 extends Q0{constructor(_,$,X,Z,J){super();this.execute=_,this.getSQL=$,this.dialect=Z,this.mapBatchResult=J,this.config={action:X}}static[K]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(_,$){return $?this.mapBatchResult(_):_}_prepare(){return this}isResponseInArrayMode(){return!1}}class a_{constructor(_,$,X,Z){this.resultKind=_,this.dialect=$,this.session=X,this._=Z?{schema:Z.schema,fullSchema:Z.fullSchema,tableNamesMap:Z.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let J=this.query;if(this._.schema)for(let[G,Y]of Object.entries(this._.schema))J[G]=new a4(_,Z.fullSchema,this._.schema,this._.tableNamesMap,Z.fullSchema[G],Y,$,X);this.$cache={invalidate:async(G)=>{}}}static[K]="BaseSQLiteDatabase";query;$with=(_,$)=>{let X=this;return{as:(J)=>{if(typeof J==="function")J=J(new o_(X.dialect));return new Proxy(new U_(J.getSQL(),$??("getSelectedFields"in J?J.getSelectedFields()??{}:{}),_,!0),new Y0({alias:_,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};$count(_,$){return new r_({source:_,filters:$,session:this.session})}with(..._){let $=this;function X(z){return new t0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_})}function Z(z){return new t0({fields:z??void 0,session:$.session,dialect:$.dialect,withList:_,distinct:!0})}function J(z){return new J8(z,$.session,$.dialect,_)}function G(z){return new Z8(z,$.session,$.dialect,_)}function Y(z){return new $8(z,$.session,$.dialect,_)}return{select:X,selectDistinct:Z,update:J,insert:G,delete:Y}}select(_){return new t0({fields:_??void 0,session:this.session,dialect:this.dialect})}selectDistinct(_){return new t0({fields:_??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(_){return new J8(_,this.session,this.dialect)}$cache;insert(_){return new Z8(_,this.session,this.dialect)}delete(_){return new $8(_,this.session,this.dialect)}run(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.run($),()=>$,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session));return this.session.run($)}all(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.all($),()=>$,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session));return this.session.all($)}get(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.get($),()=>$,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session));return this.session.get($)}values(_){let $=typeof _==="string"?U.raw(_):_.getSQL();if(this.resultKind==="async")return new o2(async()=>this.session.values($),()=>$,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session));return this.session.values($)}transaction(_,$){return this.session.transaction(_,$)}}class WZ{static[K]="Cache"}class t_ extends WZ{strategy(){return"all"}static[K]="NoopCache";async get(_){return}async put(_,$,X,Z){}async onMutate(_){}}async function t4(_,$){let X=`${_}-${JSON.stringify($)}`,J=new TextEncoder().encode(X),G=await crypto.subtle.digest("SHA-256",J);return[...new Uint8Array(G)].map((H)=>H.toString(16).padStart(2,"0")).join("")}class FZ extends Q0{constructor(_){super();this.resultCb=_}static[K]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class e4{constructor(_,$,X,Z,J,G){if(this.mode=_,this.executeMethod=$,this.query=X,this.cache=Z,this.queryMetadata=J,this.cacheConfig=G,Z&&Z.strategy()==="all"&&G===void 0)this.cacheConfig={enable:!0,autoInvalidate:!0};if(!this.cacheConfig?.enable)this.cacheConfig=void 0}static[K]="PreparedQuery";joinsNotNullableMap;async queryWithCache(_,$,X){if(this.cache===void 0||V(this.cache,t_)||this.queryMetadata===void 0)try{return await X()}catch(Z){throw new D1(_,$,Z)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await X()}catch(Z){throw new D1(_,$,Z)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[Z]=await Promise.all([X(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return Z}catch(Z){throw new D1(_,$,Z)}if(!this.cacheConfig)try{return await X()}catch(Z){throw new D1(_,$,Z)}if(this.queryMetadata.type==="select"){let Z=await this.cache.get(this.cacheConfig.tag??await t4(_,$),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(Z===void 0){let J;try{J=await X()}catch(G){throw new D1(_,$,G)}return await this.cache.put(this.cacheConfig.tag??await t4(_,$),J,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),J}return Z}try{return await X()}catch(Z){throw new D1(_,$,Z)}}getQuery(){return this.query}mapRunResult(_,$){return _}mapAllResult(_,$){throw Error("Not implemented")}mapGetResult(_,$){throw Error("Not implemented")}execute(_){if(this.mode==="async")return this[this.executeMethod](_);return new FZ(()=>this[this.executeMethod](_))}mapResult(_,$){switch(this.executeMethod){case"run":return this.mapRunResult(_,$);case"all":return this.mapAllResult(_,$);case"get":return this.mapGetResult(_,$)}}}class _5{constructor(_){this.dialect=_}static[K]="SQLiteSession";prepareOneTimeQuery(_,$,X,Z,J,G,Y){return this.prepareQuery(_,$,X,Z,J,G,Y)}run(_){let $=this.dialect.sqlToQuery(_);try{return this.prepareOneTimeQuery($,void 0,"run",!1).run()}catch(X){throw new B2({cause:X,message:`Failed to run the query '${$.sql}'`})}}extractRawRunValueFromBatchResult(_){return _}all(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(_){throw Error("Not implemented")}get(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(_){throw Error("Not implemented")}values(_){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(_),void 0,"run",!1).values()}async count(_){return(await this.values(_))[0][0]}extractRawValuesValueFromBatchResult(_){throw Error("Not implemented")}}class $5 extends a_{constructor(_,$,X,Z,J=0){super(_,$,X,Z);this.schema=Z,this.nestedIndex=J}static[K]="SQLiteTransaction";rollback(){throw new a8}}class z8 extends _5{constructor(_,$,X,Z,J){super($);this.client=_,this.schema=X,this.options=Z,this.tx=J,this.logger=Z.logger??new e8,this.cache=Z.cache??new t_}static[K]="LibSQLSession";logger;cache;prepareQuery(_,$,X,Z,J,G,Y){return new AZ(this.client,_,this.logger,this.cache,G,Y,$,this.tx,X,Z,J)}async batch(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.batch(X)).map((J,G)=>$[G].mapResult(J,!0))}async migrate(_){let $=[],X=[];for(let J of _){let G=J._prepare(),Y=G.getQuery();$.push(G),X.push({sql:Y.sql,args:Y.params})}return(await this.client.migrate(X)).map((J,G)=>$[G].mapResult(J,!0))}async transaction(_,$){let X=await this.client.transaction(),Z=new z8(this.client,this.dialect,this.schema,this.options,X),J=new X5("async",this.dialect,Z,this.schema);try{let G=await _(J);return await X.commit(),G}catch(G){throw await X.rollback(),G}}extractRawAllValueFromBatchResult(_){return _.rows}extractRawGetValueFromBatchResult(_){return _.rows[0]}extractRawValuesValueFromBatchResult(_){return _.rows}}class X5 extends $5{static[K]="LibSQLTransaction";async transaction(_){let $=`sp${this.nestedIndex}`,X=new X5("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(U.raw(`savepoint ${$}`));try{let Z=await _(X);return await this.session.run(U.raw(`release savepoint ${$}`)),Z}catch(Z){throw await this.session.run(U.raw(`rollback to savepoint ${$}`)),Z}}}class AZ extends e4{constructor(_,$,X,Z,J,G,Y,z,H,W,F){super("async",H,$,Z,J,G);this.client=_,this.logger=X,this.fields=Y,this.tx=z,this._isResponseInArrayMode=W,this.customResultMapper=F,this.customResultMapper=F,this.fields=Y}static[K]="LibSQLPreparedQuery";async run(_){let $=K_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return this.tx?this.tx.execute(X):this.client.execute(X)})}async all(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let H=K_(Z.params,_??{});return X.logQuery(Z.sql,H),await this.queryWithCache(Z.sql,H,async()=>{let W={sql:Z.sql,args:H};return(J?J.execute(W):G.execute(W)).then(({rows:F})=>this.mapAllResult(F))})}let z=await this.values(_);return this.mapAllResult(z)}mapAllResult(_,$){if($)_=_.rows;if(!this.fields&&!this.customResultMapper)return _.map((X)=>UZ(X));if(this.customResultMapper)return this.customResultMapper(_,Y8);return _.map((X)=>{return _4(this.fields,Array.prototype.slice.call(X).map((Z)=>Y8(Z)),this.joinsNotNullableMap)})}async get(_){let{fields:$,logger:X,query:Z,tx:J,client:G,customResultMapper:Y}=this;if(!$&&!Y){let H=K_(Z.params,_??{});return X.logQuery(Z.sql,H),await this.queryWithCache(Z.sql,H,async()=>{let W={sql:Z.sql,args:H};return(J?J.execute(W):G.execute(W)).then(({rows:F})=>this.mapGetResult(F))})}let z=await this.values(_);return this.mapGetResult(z)}mapGetResult(_,$){if($)_=_.rows;let X=_[0];if(!this.fields&&!this.customResultMapper)return UZ(X);if(!X)return;if(this.customResultMapper)return this.customResultMapper(_,Y8);return _4(this.fields,Array.prototype.slice.call(X).map((Z)=>Y8(Z)),this.joinsNotNullableMap)}async values(_){let $=K_(this.query.params,_??{});return this.logger.logQuery(this.query.sql,$),await this.queryWithCache(this.query.sql,$,async()=>{let X={sql:this.query.sql,args:$};return(this.tx?this.tx.execute(X):this.client.execute(X)).then(({rows:Z})=>Z)})}isResponseInArrayMode(){return this._isResponseInArrayMode}}function UZ(_){return Object.keys(_).reduce(($,X)=>{if(Object.prototype.propertyIsEnumerable.call(_,X))$[X]=_[X];return $},{})}function Y8(_){if(typeof ArrayBuffer<"u"&&_ instanceof ArrayBuffer){if(typeof Buffer<"u"){if(!(_ instanceof Buffer))return Buffer.from(_);return _}if(typeof TextDecoder<"u")return new TextDecoder().decode(_);throw Error("TextDecoder is not available. Please provide either Buffer or TextDecoder polyfill.")}return _}class KZ extends a_{static[K]="LibSQLDatabase";async batch(_){return this.session.batch(_)}}function r2(_,$={}){let X=new i4({casing:$.casing}),Z;if($.logger===!0)Z=new t8;else if($.logger!==!1)Z=$.logger;let J;if($.schema){let z=Q7($.schema,E7);J={fullSchema:$.schema,schema:z.tables,tableNamesMap:z.tableNamesMap}}let G=new z8(_,X,J,{logger:Z,cache:$.cache},void 0),Y=new KZ("async",X,G,J);if(Y.$client=_,Y.$cache=$.cache,Y.$cache)Y.$cache.invalidate=$.cache?.onMutate;return Y}function a2(..._){if(typeof _[0]==="string"){let $=m1({url:_[0]});return r2($,_[1])}if(r3(_[0])){let{connection:$,client:X,...Z}=_[0];if(X)return r2(X,Z);let J=typeof $==="string"?m1({url:$}):m1($);return r2(J,Z)}return r2(_[0],_[1])}((_)=>{function $(X){return r2({},X)}_.mock=$})(a2||(a2={}));class _6{client;db;dbName;constructor(_,$){this.dbName=_;try{let X=e_.join(process.cwd(),".sylphx-flow");if(!H8.existsSync(X))H8.mkdirSync(X,{recursive:!0});let Z=e_.join(X,`${_}.db`);this.client=m1({url:`file:${Z}`}),this.db=a2(this.client,{schema:$})}catch(X){throw new B_(`Failed to initialize ${_} database connection`,{url:`file:${e_.join(process.cwd(),".sylphx-flow",`${_}.db`)}`},X)}}async close(){}getDatabasePath(){return e_.join(process.cwd(),".sylphx-flow",`${this.dbName}.db`)}async createTable(_){try{await this.client.execute(_)}catch($){throw new J0(`Failed to create table for ${this.dbName}`,`${this.dbName}.createTable`,$)}}async createIndex(_){try{await this.client.execute(_)}catch($){throw new J0(`Failed to create index for ${this.dbName}`,`${this.dbName}.createIndex`,$)}}async tableExists(_){try{return(await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name='${_}'
      `)).rows.length>0}catch($){throw new J0(`Failed to check if table ${_} exists`,`${this.dbName}.tableExists`,$)}}}var Z5={};U6(Z5,{tfidfTerms:()=>c0,tfidfIdf:()=>A1,tfidfDocuments:()=>U1,codebaseMetadata:()=>k0,codebaseFiles:()=>D0});var D0=I0("codebase_files_table",{path:k("path").primaryKey(),mtime:S0("mtime").notNull(),hash:k("hash").notNull(),content:k("content"),language:k("language"),size:S0("size"),indexedAt:k("indexed_at").notNull()},(_)=>[R0("idx_codebase_files_mtime").on(_.mtime),R0("idx_codebase_files_hash").on(_.hash)]),k0=I0("codebase_metadata_table",{key:k("key").primaryKey(),value:k("value").notNull()}),c0=I0("tfidf_terms_table",{filePath:k("file_path").notNull().references(()=>D0.path,{onDelete:"cascade"}),term:k("term").notNull(),frequency:F1("frequency").notNull()},(_)=>[n2({columns:[_.filePath,_.term]}),R0("idx_tfidf_terms_term").on(_.term),R0("idx_tfidf_terms_file").on(_.filePath)]),U1=I0("tfidf_documents_table",{filePath:k("file_path").primaryKey().references(()=>D0.path,{onDelete:"cascade"}),magnitude:F1("magnitude").notNull(),termCount:S0("term_count").notNull(),rawTerms:k("raw_terms").notNull()}),A1=I0("tfidf_idf_table",{term:k("term").primaryKey(),idfValue:F1("idf_value").notNull()});class G5 extends _6{constructor(){super("cache",Z5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Cache database tables already exist");return}await this.createTables(),console.error("[INFO] Cache database tables created")}catch(_){throw new J0("Failed to initialize cache database","cache.initialize",_)}}async createTables(){await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_files_table (
        path TEXT PRIMARY KEY,
        mtime INTEGER NOT NULL,
        hash TEXT NOT NULL,
        content TEXT,
        language TEXT,
        size INTEGER,
        indexed_at TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS codebase_metadata_table (
        key TEXT PRIMARY KEY,
        value TEXT NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_documents_table (
        file_path TEXT PRIMARY KEY,
        magnitude REAL NOT NULL,
        term_count INTEGER NOT NULL,
        raw_terms TEXT NOT NULL,
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_idf_table (
        term TEXT PRIMARY KEY,
        idf_value REAL NOT NULL
      )
    `),await this.createTable(`
      CREATE TABLE IF NOT EXISTS tfidf_terms_table (
        file_path TEXT NOT NULL,
        term TEXT NOT NULL,
        frequency REAL NOT NULL,
        PRIMARY KEY (file_path, term),
        FOREIGN KEY (file_path) REFERENCES codebase_files_table(path) ON DELETE CASCADE
      )
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_mtime ON codebase_files_table (mtime)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_codebase_files_hash ON codebase_files_table (hash)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_term ON tfidf_terms_table (term)
    `),await this.createIndex(`
      CREATE INDEX IF NOT EXISTS idx_tfidf_terms_file ON tfidf_terms_table (file_path)
    `)}async getMigrationStatus(){try{let _=["codebase_files_table","tfidf_terms_table","tfidf_documents_table"],$=0;for(let X of _)if(await this.tableExists(X))$++;return{isMigrated:$>=2,migrationCount:$}}catch(_){throw new J0("Failed to check cache database migration status","cache.getMigrationStatus",_)}}async clearCache(){try{await this.client.execute("DELETE FROM tfidf_terms_table"),await this.client.execute("DELETE FROM tfidf_documents_table"),await this.client.execute("DELETE FROM tfidf_idf_table"),await this.client.execute("DELETE FROM codebase_files_table"),await this.client.execute("DELETE FROM codebase_metadata_table"),console.error("[INFO] Cache database cleared")}catch(_){throw new J0("Failed to clear cache database","cache.clearCache",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM codebase_files_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,cachedFiles:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=J5.join(process.cwd(),".sylphx-flow");return J5.join(_,"cache.db")}}class Y5{cacheDb;cache;constructor(){this.cacheDb=new G5,this.cache=this.cacheDb.db}async initialize(){await this.cacheDb.initialize()}async setCodebaseFile(_){return l(`set codebase file: ${_.path}`,async()=>{await this.cache.insert(D0).values(_).onConflictDoUpdate({target:D0.path,set:{mtime:_.mtime,hash:_.hash,content:_.content,language:_.language,size:_.size,indexedAt:_.indexedAt}})})}async getCodebaseFile(_){return l(`get codebase file: ${_}`,async()=>{let $=await this.cache.select().from(D0).where(L(D0.path,_)).limit(1);if($.length===0)return null;let X=$[0];return{path:X.path,mtime:X.mtime,hash:X.hash,content:X.content||void 0,language:X.language||void 0,size:X.size||void 0,indexedAt:X.indexedAt}})}async getAllCodebaseFiles(){return l("get all codebase files",async()=>{return(await this.cache.select().from(D0).orderBy(p0(D0.mtime))).map(($)=>({path:$.path,mtime:$.mtime,hash:$.hash,content:$.content||void 0,language:$.language||void 0,size:$.size||void 0,indexedAt:$.indexedAt}))})}async deleteCodebaseFile(_){return l(`delete codebase file: ${_}`,async()=>{let $=await this.cache.delete(D0).where(L(D0.path,_));return(await this.cache.select().from(D0).where(L(D0.path,_)).limit(1)).length===0})}async clearCodebaseFiles(){return l("clear codebase files",async()=>{await this.cache.delete(D0)})}async setMetadata(_,$){return l(`set metadata: ${_}`,async()=>{await this.cache.insert(k0).values({key:_,value:$}).onConflictDoUpdate({target:k0.key,set:{value:$}})})}async getMetadata(_){return l(`get metadata: ${_}`,async()=>{let $=await this.cache.select().from(k0).where(L(k0.key,_)).limit(1);return $.length>0?$[0].value:null})}async getAllMetadata(){return l("get all metadata",async()=>{let _=await this.cache.select().from(k0),$={};for(let X of _)$[X.key]=X.value;return $})}async deleteMetadata(_){return l(`delete metadata: ${_}`,async()=>{let $=await this.cache.delete(k0).where(L(k0.key,_));return(await this.cache.select().from(k0).where(L(k0.key,_)).limit(1)).length===0})}async setTfidfTerms(_){return l("set TF-IDF terms",async()=>{let $=[...new Set(_.map((X)=>X.filePath))];for(let X of $)await this.cache.delete(c0).where(L(c0.filePath,X));if(_.length>0)await this.cache.insert(c0).values(_)})}async getTfidfTerms(_){return l(`get TF-IDF terms for file: ${_}`,async()=>{return(await this.cache.select().from(c0).where(L(c0.filePath,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async getTfidfTermsByTerm(_){return l(`get TF-IDF terms by term: ${_}`,async()=>{return(await this.cache.select().from(c0).where(L(c0.term,_))).map((X)=>({filePath:X.filePath,term:X.term,frequency:X.frequency}))})}async clearTfidfTerms(){return l("clear TF-IDF terms",async()=>{await this.cache.delete(c0)})}async setTfidfDocument(_){return l(`set TF-IDF document: ${_.filePath}`,async()=>{await this.cache.insert(U1).values(_).onConflictDoUpdate({target:U1.filePath,set:{magnitude:_.magnitude,termCount:_.termCount,rawTerms:_.rawTerms}})})}async getTfidfDocument(_){return l(`get TF-IDF document: ${_}`,async()=>{let $=await this.cache.select().from(U1).where(L(U1.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{filePath:X.filePath,magnitude:X.magnitude,termCount:X.termCount,rawTerms:X.rawTerms}})}async getAllTfidfDocuments(){return l("get all TF-IDF documents",async()=>{return(await this.cache.select().from(U1)).map(($)=>({filePath:$.filePath,magnitude:$.magnitude,termCount:$.termCount,rawTerms:$.rawTerms}))})}async clearTfidfDocuments(){return l("clear TF-IDF documents",async()=>{await this.cache.delete(U1)})}async setTfidfIdf(_){return l(`set TF-IDF IDF: ${_.term}`,async()=>{await this.cache.insert(A1).values(_).onConflictDoUpdate({target:A1.term,set:{idfValue:_.idfValue}})})}async getTfidfIdf(_){return l(`get TF-IDF IDF: ${_}`,async()=>{let $=await this.cache.select().from(A1).where(L(A1.term,_)).limit(1);if($.length===0)return null;let X=$[0];return{term:X.term,idfValue:X.idfValue}})}async getAllTfidfIdf(){return l("get all TF-IDF IDF values",async()=>{return(await this.cache.select().from(A1)).map(($)=>({term:$.term,idfValue:$.idfValue}))})}async clearTfidfIdf(){return l("clear TF-IDF IDF values",async()=>{await this.cache.delete(A1)})}async getStats(){return l("get cache statistics",async()=>{let[_,$,X,Z,J]=await Promise.all([this.cache.select({count:n0()}).from(D0),this.cache.select({count:n0()}).from(k0),this.cache.select({count:n0()}).from(c0),this.cache.select({count:n0()}).from(U1),this.cache.select({count:n0()}).from(A1)]);return{codebaseFiles:_[0]?.count||0,metadataEntries:$[0]?.count||0,tfidfTerms:X[0]?.count||0,tfidfDocuments:Z[0]?.count||0,tfidfIdfValues:J[0]?.count||0}})}async clearAll(){return l("clear all cache data",async()=>{await Promise.all([this.cache.delete(D0),this.cache.delete(k0),this.cache.delete(c0),this.cache.delete(U1),this.cache.delete(A1)])})}}import*as W8 from"node:path";var z5={};U6(z5,{memory:()=>y});var y=I0("memory_table",{key:k("key").notNull(),namespace:k("namespace").notNull().default("default"),value:k("value").notNull(),timestamp:S0("timestamp").notNull(),created_at:k("created_at").notNull(),updated_at:k("updated_at").notNull()},(_)=>[n2({columns:[_.key,_.namespace]}),R0("idx_memory_namespace").on(_.namespace),R0("idx_memory_timestamp").on(_.timestamp),R0("idx_memory_key").on(_.key)]);class H5 extends _6{constructor(){super("memory",z5)}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){console.error("[INFO] Memory database tables already exist");return}let $=W8.join(process.cwd(),"drizzle","memory");await this.createTables(),console.error("[INFO] Memory database tables created")}catch(_){throw new J0("Failed to initialize memory database","memory.initialize",_)}}async createTables(){await this.createTable(`
        CREATE TABLE IF NOT EXISTS memory_table (
          key TEXT NOT NULL,
          namespace TEXT NOT NULL DEFAULT 'default',
          value TEXT NOT NULL,
          timestamp INTEGER NOT NULL,
          created_at TEXT NOT NULL,
          updated_at TEXT NOT NULL,
          PRIMARY KEY (key, namespace)
        )
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_namespace ON memory_table (namespace)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_timestamp ON memory_table (timestamp)
      `),await this.createIndex(`
        CREATE INDEX IF NOT EXISTS idx_memory_key ON memory_table (key)
      `)}async getMigrationStatus(){try{let _=await this.tableExists("memory_table");return{isMigrated:_,migrationCount:_?1:0}}catch(_){throw new J0("Failed to check memory database migration status","memory.getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory_table
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}async close(){}getDatabasePath(){let _=W8.join(process.cwd(),".sylphx-flow");return W8.join(_,"memory.db")}}class W5{memoryDb;memory;constructor(){this.memoryDb=new H5,this.memory=this.memoryDb.db}async initialize(){await this.memoryDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch($){throw Error(`Failed to deserialize value: ${$.message}`)}}async set(_,$,X="default"){let Z=`Failed to set memory entry: ${X}:${_}`;try{let J=new Date().toISOString(),G=Date.now(),Y=this.safeSerialize($);if((await this.memory.select().from(y).where(K0(L(y.key,_),L(y.namespace,X))).limit(1)).length>0)await this.memory.update(y).set({value:Y,timestamp:G,updated_at:J}).where(K0(L(y.key,_),L(y.namespace,X)));else await this.memory.insert(y).values({key:_,namespace:X,value:Y,timestamp:G,created_at:J,updated_at:J})}catch(J){throw Error(`${Z}: ${J.message}`)}}async get(_,$="default"){let X=`Failed to get memory entry: ${$}:${_}`;try{let Z=await this.memory.select().from(y).where(K0(L(y.key,_),L(y.namespace,$))).limit(1);if(Z.length===0)return null;let J=Z[0];return{key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}}catch(Z){throw Error(`${X}: ${Z.message}`)}}async getAll(_){try{let X=this.memory.select().from(y);if(_&&_!=="all")X=X.where(L(y.namespace,_));return(await X.orderBy(p0(y.timestamp))).map((J)=>({key:J.key,namespace:J.namespace,value:this.safeDeserialize(J.value),timestamp:J.timestamp,created_at:J.created_at,updated_at:J.updated_at}))}catch(X){throw Error(`Failed to get all memory entries: ${X.message}`)}}async search(_,$){let X=`Failed to search memory entries: ${_}`;try{let Z=this.memory.select().from(y).where(N_(J1(y.key,`%${_}%`),J1(y.value,`%${_}%`)));if($&&$!=="all")Z=Z.where(K0(L(y.namespace,$),N_(J1(y.key,`%${_}%`),J1(y.value,`%${_}%`))));return(await Z.orderBy(p0(y.timestamp))).map((G)=>({key:G.key,namespace:G.namespace,value:this.safeDeserialize(G.value),timestamp:G.timestamp,created_at:G.created_at,updated_at:G.updated_at}))}catch(Z){throw Error(`${X}: ${Z.message}`)}}async delete(_,$="default"){let X=`Failed to delete memory entry: ${$}:${_}`;try{let Z=await this.memory.delete(y).where(K0(L(y.key,_),L(y.namespace,$)));return(await this.memory.select().from(y).where(K0(L(y.key,_),L(y.namespace,$))).limit(1)).length===0}catch(Z){throw Error(`${X}: ${Z.message}`)}}async clear(_="default"){let $=`Failed to clear memory namespace: ${_}`;try{await this.memory.delete(y).where(L(y.namespace,_))}catch(X){throw Error(`${$}: ${X.message}`)}}async getStats(_){try{let X=this.memory.select({count:n0()}).from(y);if(_&&_!=="all")X=X.where(L(y.namespace,_));let J=(await X)[0]?.count||0,Y=(await this.memory.selectDistinct({namespace:y.namespace}).from(y)).map((z)=>z.namespace);return{totalEntries:J,namespaces:Y}}catch(X){throw Error(`Failed to get memory statistics: ${X.message}`)}}}class v0{memoryStorage;cacheStorage;constructor(){this.memoryStorage=new W5,this.cacheStorage=new Y5}async initialize(){await Promise.all([this.memoryStorage.initialize(),this.cacheStorage.initialize()])}async set(_,$,X="default"){return this.memoryStorage.set(_,$,X)}async get(_,$="default"){return this.memoryStorage.get(_,$)}async getAll(_){return this.memoryStorage.getAll(_)}async search(_,$){return this.memoryStorage.search(_,$)}async delete(_,$="default"){return this.memoryStorage.delete(_,$)}async clear(_="default"){return this.memoryStorage.clear(_)}async getStats(_){return this.memoryStorage.getStats(_)}async setCodebaseFile(_,$,X,Z,J,G){let Y=new Date().toISOString();return this.cacheStorage.setCodebaseFile({path:_,mtime:$,hash:X,content:Z,language:J,size:G,indexedAt:Y})}async getCodebaseFile(_){return this.cacheStorage.getCodebaseFile(_)}async getAllCodebaseFiles(){return this.cacheStorage.getAllCodebaseFiles()}async deleteCodebaseFile(_){return this.cacheStorage.deleteCodebaseFile(_)}async clearCodebaseFiles(){return this.cacheStorage.clearCodebaseFiles()}async setMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async getMetadata(_){return this.cacheStorage.getMetadata(_)}async getAllMetadata(){return this.cacheStorage.getAllMetadata()}async deleteMetadata(_){return this.cacheStorage.deleteMetadata(_)}async setTfidfTerms(_){return this.cacheStorage.setTfidfTerms(_)}async getTfidfTerms(_){return this.cacheStorage.getTfidfTerms(_)}async getTfidfTermsByTerm(_){return this.cacheStorage.getTfidfTermsByTerm(_)}async clearTfidfTerms(){return this.cacheStorage.clearTfidfTerms()}async setTfidfDocument(_,$,X,Z){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$,termCount:X,rawTerms:Z})}async getTFIDFDocument(_){return this.cacheStorage.getTfidfDocument(_)}async getAllTfidfDocuments(){return this.cacheStorage.getAllTfidfDocuments()}async clearTfidfDocuments(){return this.cacheStorage.clearTfidfDocuments()}async setTfidfIdf(_,$){return this.cacheStorage.setTfidfIdf({term:_,idfValue:$})}async getTfidfIdf(_){return this.cacheStorage.getTfidfIdf(_)}async getAllTfidfIdf(){return this.cacheStorage.getAllTfidfIdf()}async clearTfidfIdf(){return this.cacheStorage.clearTfidfIdf()}async getCacheStats(){return this.cacheStorage.getStats()}async clearAllCache(){return this.cacheStorage.clearAll()}async getAllStats(){let[_,$]=await Promise.all([this.memoryStorage.getStats(),this.cacheStorage.getStats()]);return{memory:_,cache:$}}async clearAll(){await Promise.all([this.memoryStorage.clear("default"),this.cacheStorage.clearAll()])}async getCodebaseIndexStats(){let _=await this.cacheStorage.getAllMetadata();return{indexedAt:_.indexedAt,totalFiles:Number.parseInt(_.totalFiles||"0"),totalTerms:Number.parseInt(_.totalTerms||"0")}}async getIDFValues(){return this.cacheStorage.getAllTfidfIdf()}async upsertTFIDFDocument(_,$){return this.cacheStorage.setTfidfDocument({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:JSON.stringify($.rawTerms)})}async upsertCodebaseFile(_){return this.cacheStorage.setCodebaseFile({..._,indexedAt:_.indexedAt||new Date().toISOString()})}async setIDFValues(_){let $=Object.entries(_).map(([X,Z])=>this.cacheStorage.setTfidfIdf({term:X,idfValue:Z}));await Promise.all($)}async clearCodebaseIndex(){await Promise.all([this.cacheStorage.clearCodebaseFiles(),this.cacheStorage.clearTfidfTerms(),this.cacheStorage.clearTfidfDocuments(),this.cacheStorage.clearTfidfIdf()])}async getCodebaseMetadata(_){return this.cacheStorage.getMetadata(_)}async setCodebaseMetadata(_,$){return this.cacheStorage.setMetadata(_,$)}async setTFIDFTerms(_,$){let X=Object.entries($).map(([Z,J])=>({filePath:_,term:Z,frequency:J}));return this.cacheStorage.setTfidfTerms(X)}}class OZ{static step1aRules=[{pattern:/sses$/i,replacement:"ss"},{pattern:/ies$/i,replacement:"i"},{pattern:/ss$/i,replacement:"ss"},{pattern:/s$/i,replacement:""}];static step1bRules=[{pattern:/eed$/i,replacement:"ee"},{pattern:/ed$/i,replacement:""},{pattern:/ing$/i,replacement:""}];static step1cRules=[{pattern:/y$/i,replacement:"i"}];static step2Rules=[{pattern:/ational$/i,replacement:"ate"},{pattern:/tional$/i,replacement:"tion"},{pattern:/enci$/i,replacement:"ence"},{pattern:/anci$/i,replacement:"ance"},{pattern:/izer$/i,replacement:"ize"},{pattern:/abli$/i,replacement:"able"},{pattern:/alli$/i,replacement:"al"},{pattern:/entli$/i,replacement:"ent"},{pattern:/eli$/i,replacement:"e"},{pattern:/ousli$/i,replacement:"ous"},{pattern:/ization$/i,replacement:"ize"},{pattern:/ation$/i,replacement:"ate"},{pattern:/ator$/i,replacement:"ate"},{pattern:/alism$/i,replacement:"al"},{pattern:/iveness$/i,replacement:"ive"},{pattern:/fulness$/i,replacement:"ful"},{pattern:/ousness$/i,replacement:"ous"},{pattern:/aliti$/i,replacement:"al"},{pattern:/iviti$/i,replacement:"ive"},{pattern:/biliti$/i,replacement:"ble"}];static step3Rules=[{pattern:/icate$/i,replacement:"ic"},{pattern:/ative$/i,replacement:""},{pattern:/alize$/i,replacement:"al"},{pattern:/iciti$/i,replacement:"ic"},{pattern:/ical$/i,replacement:"ic"},{pattern:/ful$/i,replacement:""},{pattern:/ness$/i,replacement:""}];static step4Rules=[{pattern:/al$/i,replacement:""},{pattern:/ance$/i,replacement:""},{pattern:/ence$/i,replacement:""},{pattern:/er$/i,replacement:""},{pattern:/ic$/i,replacement:""},{pattern:/able$/i,replacement:""},{pattern:/ible$/i,replacement:""},{pattern:/ant$/i,replacement:""},{pattern:/ement$/i,replacement:""},{pattern:/ment$/i,replacement:""},{pattern:/ent$/i,replacement:""},{pattern:/ion$/i,replacement:""},{pattern:/ou$/i,replacement:""},{pattern:/ism$/i,replacement:""},{pattern:/ate$/i,replacement:""},{pattern:/iti$/i,replacement:""},{pattern:/ous$/i,replacement:""},{pattern:/ive$/i,replacement:""},{pattern:/ize$/i,replacement:""}];static step5Rules=[{pattern:/e$/i,replacement:""},{pattern:/ll$/i,replacement:"l"}];static stem(_){if(_.length<3)return _.toLowerCase();let $=_.toLowerCase();for(let X of this.step1aRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1bRules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step1cRules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step2Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step3Rules)if(X.pattern.test($)){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step4Rules)if(X.pattern.test($)&&$.length>3){$=$.replace(X.pattern,X.replacement);break}for(let X of this.step5Rules)if(X.pattern.test($)&&$.length>2){$=$.replace(X.pattern,X.replacement);break}return $}}function F5(_){return _.replace(/```[\s\S]*?```/g," ").replace(/`[^`]+`/g," ").replace(/#{1,6}\s/g,"").replace(/[*_~]/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").toLowerCase().split(/[^a-z0-9_-]+/).filter((Z)=>Z.length>1)}function U5(_){let $=F5(_),X=new Map;for(let Z of $){let J=OZ.stem(Z);X.set(J,(X.get(J)||0)+1)}return X}var EF=new Set(["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","will","with","this","but","they","have","had","what","when","where","who","which","why","how"]);function RZ(_){return _.filter(($)=>!EF.has($.toLowerCase()))}function DZ(_){let $=Array.from(_.values()).reduce((Z,J)=>Z+J,0),X=new Map;for(let[Z,J]of _.entries())X.set(Z,J/$);return X}function jF(_,$){let X=new Map;for(let J of _){let G=new Set(J.keys());for(let Y of G)X.set(Y,(X.get(Y)||0)+1)}let Z=new Map;for(let[J,G]of X.entries())Z.set(J,Math.log($/G));return Z}function VZ(_,$){let X=new Map;for(let[Z,J]of _.entries()){let G=$.get(Z)||0;X.set(Z,J*G)}return X}function NZ(_){let $=0;for(let X of _.values())$+=X*X;return Math.sqrt($)}function F8(_){let $=_.map((J)=>({uri:J.uri,terms:U5(J.content)})),X=jF($.map((J)=>J.terms),_.length);return{documents:$.map((J)=>{let G=DZ(J.terms),Y=VZ(G,X),z=NZ(Y);return{uri:J.uri,terms:Y,rawTerms:J.terms,magnitude:z}}),idf:X,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}function TF(_,$){let X=0;for(let[J,G]of _.entries()){let Y=$.terms.get(J)||0;X+=G*Y}let Z=NZ(_);if(Z===0||$.magnitude===0)return 0;return X/(Z*$.magnitude)}function LF(_,$){let X=U5(_),Z=DZ(X);return VZ(Z,$)}function A5(_,$,X={}){let{limit:Z=10,minScore:J=0,boostFactors:G={}}=X,{exactMatch:Y=1.5,phraseMatch:z=2}=G,H=LF(_,$.idf),W=RZ(F5(_));return $.documents.map((A)=>{let O=TF(H,A),R=[];for(let D of W)if(A.rawTerms.has(D))O*=Y,R.push(D);if(R.length===W.length&&W.length>1)O*=z;return{uri:A.uri,score:O,matchedTerms:R}}).filter((A)=>A.score>=J).sort((A,O)=>O.score-A.score).slice(0,Z)}function wF(_){let $=K1.extname(_).toLowerCase();return{".ts":"TypeScript",".tsx":"TSX",".js":"JavaScript",".jsx":"JSX",".py":"Python",".java":"Java",".go":"Go",".rs":"Rust",".c":"C",".cpp":"C++",".cs":"C#",".rb":"Ruby",".php":"PHP",".swift":"Swift",".kt":"Kotlin",".md":"Markdown",".json":"JSON",".yaml":"YAML",".yml":"YAML",".toml":"TOML",".sql":"SQL",".sh":"Shell",".bash":"Bash"}[$]}function PF(_){let $=new Set([".ts",".tsx",".js",".jsx",".py",".java",".go",".rs",".c",".cpp",".h",".hpp",".cs",".rb",".php",".swift",".kt",".md",".txt",".json",".yaml",".yml",".toml",".xml",".html",".css",".scss",".sass",".less",".sql",".sh",".bash",".env",".gitignore",".dockerignore"]),X=K1.extname(_).toLowerCase();return $.has(X)||!X}function xF(_){let $=MZ.default();$.add(["node_modules/",".git/","dist/","build/",".next/",".cache/","coverage/","*.log",".DS_Store","Thumbs.db"]);let X=K1.join(_,".gitignore");if(j1.existsSync(X)){let Z=j1.readFileSync(X,"utf8");$.add(Z)}return $}function qF(_,$,X,Z={}){let{maxFileSize:J=1048576,maxFiles:G=50000}=Z,Y=[];function z(H){if(Y.length>=G)return;let W=j1.readdirSync(H,{withFileTypes:!0});for(let F of W){if(Y.length>=G)break;let A=K1.join(H,F.name),O=K1.relative($,A);if(X.ignores(O))continue;if(F.isDirectory())z(A);else if(F.isFile()&&PF(F.name))try{let R=j1.statSync(A);if(R.size>J){console.warn(`[WARN] Skipping large file: ${O} (${R.size} bytes)`);continue}let D=j1.readFileSync(A,"utf8"),N=wF(F.name);Y.push({path:O,absolutePath:A,content:D,language:N,size:R.size,mtime:R.mtimeMs})}catch(R){console.warn(`[WARN] Failed to read file: ${O}`,R)}}}return z(_),Y}function CF(_){let $=0;for(let X=0;X<_.length;X++){let Z=_.charCodeAt(X);$=($<<5)-$+Z,$=$&$}return $.toString(36)}class K5{codebaseRoot;cacheDir;cache=null;ig;db;options;constructor(_={}){this.options={batchSize:100,..._},this.codebaseRoot=_.codebaseRoot||process.cwd(),this.cacheDir=_.cacheDir||K1.join(this.codebaseRoot,".sylphx-flow","cache"),this.ig=xF(this.codebaseRoot),this.db=new v0}async buildTFIDFIndexFromDB(){try{let _=[],$=await this.db.getAllCodebaseFiles();for(let J of $){let G=await this.db.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,H=new Map;for(let[W,F]of Object.entries(Y))z.set(W,F),H.set(W,F);_.push({uri:`file://${J.path}`,terms:z,rawTerms:H,magnitude:G.magnitude})}}let X=await this.db.getIDFValues(),Z=new Map;for(let[J,G]of Object.entries(X))Z.set(J,G);if(_.length===0)return;return{documents:_,idf:Z,totalDocuments:_.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch(_){console.error("[ERROR] Failed to build TF-IDF index from database:",_);return}}async loadCache(){try{await this.db.initialize();let _=await this.db.getCodebaseMetadata("version"),$=await this.db.getCodebaseMetadata("codebaseRoot"),X=await this.db.getCodebaseMetadata("indexedAt"),Z=await this.db.getCodebaseMetadata("fileCount");if(!_||!$||!X||!Z)return null;let J=await this.db.getAllCodebaseFiles(),G=new Map;for(let H of J)G.set(H.path,{mtime:H.mtime,hash:H.hash});let Y=await this.buildTFIDFIndexFromDB(),z=await this.db.getCodebaseMetadata("vectorIndexPath");return{version:_,codebaseRoot:$,indexedAt:X,fileCount:Number.parseInt(Z),files:G,tfidfIndex:Y,vectorIndexPath:z}}catch(_){return console.error("[ERROR] Failed to load cache from database:",_),null}}async saveCache(_){try{if(await this.db.initialize(),await this.db.setCodebaseMetadata("version",_.version),await this.db.setCodebaseMetadata("codebaseRoot",_.codebaseRoot),await this.db.setCodebaseMetadata("indexedAt",_.indexedAt),await this.db.setCodebaseMetadata("fileCount",_.fileCount.toString()),_.vectorIndexPath)await this.db.setCodebaseMetadata("vectorIndexPath",_.vectorIndexPath);for(let[$,X]of _.files.entries())await this.db.upsertCodebaseFile({path:$,mtime:X.mtime,hash:X.hash});if(_.tfidfIndex){for(let X of _.tfidfIndex.documents){let Z=X.uri.replace("file://",""),J={};for(let[Y,z]of X.rawTerms.entries())J[Y]=z;await this.db.upsertTFIDFDocument(Z,{magnitude:X.magnitude,termCount:X.terms.size,rawTerms:J});let G={};for(let[Y,z]of X.terms.entries())G[Y]=z;await this.db.setTFIDFTerms(Z,G)}let $={};for(let[X,Z]of _.tfidfIndex.idf.entries())$[X]=Z;await this.db.setIDFValues($)}console.error("[INFO] Cache saved to database")}catch($){throw console.error("[ERROR] Failed to save cache to database:",$),$}}async indexCodebase(_={}){let{force:$=!1}=_,{embeddingProvider:X}=_;this.cache=await this.loadCache(),console.error("[INFO] Scanning codebase...");let Z=qF(this.codebaseRoot,this.codebaseRoot,this.ig);if(console.error(`[INFO] Found ${Z.length} files`),this.cache&&!$){let R=Math.abs(Z.length-this.cache.fileCount)/this.cache.fileCount*100;if(R>20)console.error(`[WARN] File count changed significantly (${R.toFixed(1)}%), forcing full reindex`),$=!0,this.cache=null}let J=[],G=[],Y=new Map;for(let O of Z){let R=CF(O.content);Y.set(O.path,{mtime:O.mtime,hash:R});let D=this.cache?.files.get(O.path);if($||!D||D.hash!==R)J.push(O)}if(this.cache?.files){for(let O of this.cache.files.keys())if(!Y.has(O))G.push(O)}let z=J.length>0||G.length>0;if(!$&&!z&&this.cache?.tfidfIndex)return console.error("[INFO] Cache hit! Using cached index"),{tfidfIndex:this.cache.tfidfIndex,stats:{totalFiles:Z.length,indexedFiles:0,skippedFiles:Z.length,cacheHit:!0}};if(J.length>0)console.error(`[INFO] Changed files: ${J.length}`);if(G.length>0)console.error(`[INFO] Deleted files: ${G.length}`);console.error(`[INFO] Indexing ${J.length} changed files...`);let W=Z.map((O)=>({uri:`file://${O.path}`,content:O.content})),F=F8(W),A;if(X){console.error("[INFO] Generating embeddings...");let O=K1.join(this.cacheDir,"codebase-vectors.hnsw");A=new U8(O,X.dimensions);let R=10;for(let D=0;D<Z.length;D+=R){let N=Z.slice(D,D+R),Q=N.map((j)=>j.content),w=await X.generateEmbeddings(Q);for(let j=0;j<N.length;j++){let E=N[j],d=w[j],X0={id:`file://${E.path}`,embedding:d,metadata:{type:"code",language:E.language||"",content:E.content.slice(0,500),category:""}};A.addDocument(X0)}console.error(`[INFO] Embedded ${Math.min(D+R,Z.length)}/${Z.length} files`)}A.save()}return this.cache={version:"1.0.0",codebaseRoot:this.codebaseRoot,indexedAt:new Date().toISOString(),fileCount:Z.length,files:Y,tfidfIndex:F,vectorIndexPath:A?K1.join(this.cacheDir,"codebase-vectors.hnsw"):void 0},await this.saveCache(this.cache),{tfidfIndex:F,vectorStorage:A,stats:{totalFiles:Z.length,indexedFiles:J.length,skippedFiles:Z.length-J.length,cacheHit:!1}}}async getCacheStats(){try{await this.db.initialize();let _=await this.db.getCodebaseIndexStats();return{exists:_.fileCount>0,fileCount:_.fileCount,indexedAt:_.indexedAt}}catch(_){return console.error("[ERROR] Failed to get cache stats:",_),{exists:!1,fileCount:0}}}async clearCache(){try{await this.db.initialize(),await this.db.clearCodebaseIndex();let _=K1.join(this.cacheDir,"codebase-index.json");if(j1.existsSync(_))j1.unlinkSync(_);let $=K1.join(this.cacheDir,"codebase-vectors.hnsw");if(j1.existsSync($))j1.unlinkSync($);console.error("[INFO] Cache cleared from database and files")}catch(_){console.error("[ERROR] Failed to clear cache:",_)}}}import R5 from"node:fs";import D5 from"node:path";class O5{config;cachedIndex=null;indexingPromise=null;status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0};constructor(_){this.config=_}getStatus(){return{...this.status}}isReady(){return this.cachedIndex!==null&&!this.status.isIndexing}startBackgroundIndexing(){if(this.status.isIndexing||this.cachedIndex)return;console.error(`[INFO] Starting background ${this.config.name} indexing...`),this.loadIndex().catch((_)=>{console.error(`[ERROR] Background ${this.config.name} indexing failed:`,_)})}async loadIndex(){if(this.cachedIndex)return this.cachedIndex;if(this.indexingPromise)return this.indexingPromise;return this.status.isIndexing=!0,this.status.progress=0,this.status.startTime=Date.now(),this.status.error=void 0,this.indexingPromise=this.buildIndex().then((_)=>{return this.cachedIndex=_,this.status.isIndexing=!1,this.status.progress=100,this.status.totalItems=_.totalDocuments,this.status.indexedItems=_.totalDocuments,console.error(`[INFO] ${this.config.name} indexing complete: ${_.totalDocuments} documents`),_}).catch((_)=>{throw this.status.isIndexing=!1,this.status.error=_ instanceof Error?_.message:String(_),console.error(`[ERROR] ${this.config.name} indexing failed:`,_),_}),this.indexingPromise}clearCache(){this.cachedIndex=null,this.indexingPromise=null,this.status={isIndexing:!1,progress:0,totalItems:0,indexedItems:0,startTime:0}}async getStats(){let _=await this.loadIndex();if(!_)return null;return{totalDocuments:_.totalDocuments,uniqueTerms:_.idf.size,generatedAt:_.metadata.generatedAt,version:_.metadata.version}}}class BZ extends O5{embeddingProvider;vectorStorage;constructor(_){super({name:"knowledge",autoStart:!0});this.embeddingProvider=_}scanKnowledgeFiles(_){let $=[],X=(Z,J)=>{let G=R5.readdirSync(Z,{withFileTypes:!0});for(let Y of G){let z=D5.join(Z,Y.name);if(Y.isDirectory())X(z,J);else if(Y.isFile()&&Y.name.endsWith(".md")){let W=D5.relative(J,z).replace(/\.md$/,"").replace(/\\/g,"/"),F=R5.readFileSync(z,"utf8");$.push({uri:`knowledge://${W}`,content:F})}}};return X(_,_),$}async buildIndex(){let _=N5();if(!R5.existsSync(_))throw Error(`Knowledge directory not found: ${_}`);let $=this.scanKnowledgeFiles(_);console.error(`[INFO] Found ${$.length} knowledge files`);let X=F8($);if(this.embeddingProvider&&$.length>0){console.error("[INFO] Building vector index for knowledge...");try{let Z=D5.join(N5(),"..",".sylphx-flow","knowledge-vectors.hnsw");this.vectorStorage=new U8(Z,this.embeddingProvider.dimensions||1536),await this.vectorStorage.initialize();let J=10;for(let G=0;G<$.length;G+=J){let Y=$.slice(G,G+J),z=await this.embeddingProvider.generateEmbeddings(Y.map((H)=>H.content));for(let H=0;H<Y.length;H++){let W=Y[H],F=z[H];await this.vectorStorage.addDocument({id:W.uri,embedding:F,metadata:{type:"knowledge",content:W.content.slice(0,500),category:"knowledge",language:"markdown"}})}console.error(`[INFO] Processed ${Math.min(G+J,$.length)}/${$.length} knowledge files`)}await this.vectorStorage.save(),console.error("[INFO] Vector index built successfully")}catch(Z){console.error("[ERROR] Failed to build vector index:",Z),this.vectorStorage=void 0}}return X}}var V5=null;function M5(_){if(!V5)V5=new BZ(_);return V5}class QZ{memoryStorage;knowledgeIndexer=M5();embeddingProvider;constructor(){this.memoryStorage=new v0}async initialize(){if(await this.memoryStorage.initialize(),!this.embeddingProvider)this.embeddingProvider=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();this.knowledgeIndexer=M5(this.embeddingProvider)}async getStatus(){let _=await this.memoryStorage.getAllCodebaseFiles(),$=await this.memoryStorage.getCodebaseIndexStats(),X=this.knowledgeIndexer.getStatus(),Z=!1,J=0;try{let G=await this.knowledgeIndexer.loadIndex();Z=!0,J=G.totalDocuments}catch{}return{codebase:{indexed:_.length>0,fileCount:_.length,indexedAt:$.indexedAt},knowledge:{indexed:Z,documentCount:J,isIndexing:X.isIndexing,progress:X.progress}}}async searchCodebase(_,$={}){let{limit:X=10,include_content:Z=!0,file_extensions:J,path_filter:G,exclude_paths:Y,min_score:z=0.1}=$,H=await this.memoryStorage.getAllCodebaseFiles();if(H.length===0)throw Error('Codebase not indexed yet. Run "sylphx search reindex" first.');let W=H;if(J?.length)W=W.filter((R)=>J.some((D)=>R.path.endsWith(D)));if(G)W=W.filter((R)=>R.path.includes(G));if(Y?.length)W=W.filter((R)=>!Y.some((D)=>R.path.includes(D)));if(W.length===0)return{results:[],totalIndexed:H.length,query:_};let F=await this.buildSearchIndex(W);if(!F)throw Error("No searchable content found");let A=await A5(_,F,{limit:X,minScore:z}),O=[];for(let R of A){let D=R.uri?.replace("file://","")||"Unknown",N="";if(Z){let Q=await this.memoryStorage.getCodebaseFile(D);if(Q?.content){if(N=Q.content.substring(0,500),Q.content.length>500)N+="..."}}O.push({uri:R.uri,score:R.score||0,title:D.split("/").pop()||D,content:Z?N:void 0})}return{results:O,totalIndexed:H.length,query:_}}async searchKnowledge(_,$={}){let{limit:X=10,include_content:Z=!0}=$;try{let J=await this.knowledgeIndexer.loadIndex();return{results:(await A5(_,J,{limit:X})).map((z)=>({uri:z.uri,score:z.score||0,title:z.uri?.split("/").pop()||"Unknown",content:Z?"":void 0})),totalIndexed:J.totalDocuments,query:_}}catch{throw Error("Knowledge base not indexed yet")}}async buildSearchIndex(_){try{let $=[];for(let J of _){let G=await this.memoryStorage.getTFIDFDocument(J.path);if(G){let Y=G.rawTerms||{},z=new Map,H=new Map;for(let[W,F]of Object.entries(Y))z.set(W,F),H.set(W,F);$.push({uri:`file://${J.path}`,terms:z,rawTerms:H,magnitude:G.magnitude})}}if($.length===0)return null;let X=await this.memoryStorage.getIDFValues(),Z=new Map;for(let J of X)if(J.term&&J.idfValue!==void 0)Z.set(J.term,J.idfValue);return{documents:$,idf:Z,totalDocuments:$.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch($){return console.error("[ERROR] Failed to build search index:",$),null}}formatResultsForCLI(_,$,X){if(_.length===0)return`\uD83D\uDCED No results found for "${$}"

**Total indexed files:** ${X}`;let Z=`✓ Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let H=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${H}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA Source: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
   \`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return Z+J}formatResultsForMCP(_,$,X){let Z=`Found ${_.length} result(s) for "${$}":

`,J=_.map((G,Y)=>{let z=`${Y+1}. **${G.title}** (Score: ${G.score.toFixed(3)})`;if(G.uri.startsWith("file://")){let H=G.uri.replace("file://","");z+=`
   \uD83D\uDCC1 Path: \`${H}\``}else if(G.uri.startsWith("knowledge://"))z+=`
   \uD83D\uDCDA URI: ${G.uri}`;else z+=`
   \uD83D\uDD17 URI: ${G.uri}`;if(G.content)z+=`
\`\`\`
${G.content}
\`\`\``;return z}).join(`

`);return{content:[{type:"text",text:Z+J}]}}async getAvailableKnowledgeURIs(){try{return(await this.knowledgeIndexer.loadIndex()).documents.map(($)=>$.uri)}catch{return[]}}}var E0=new QZ;var SF=new B0("search").description("Search codebase files and source code").argument("<query>","Search query - use natural language, function names, or technical terms").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include file content snippets in results (default: true)","true").option("--extensions <exts...>","Filter by file extensions (e.g., .ts .tsx .js)").option("--path <pattern>","Filter by path pattern (e.g., src/components)").option("--exclude <patterns...>","Exclude paths containing these patterns").action(async(_,$)=>{try{console.log(""),console.log(M.cyan.bold("▸ Search Codebase")),console.log(M.gray(`  Query: "${_}"`));let X=f0("Searching...").start();await E0.initialize();let Z=await E0.searchCodebase(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false",file_extensions:$.extensions,path_filter:$.path,exclude_paths:$.exclude});X.stop();let J=E0.formatResultsForCLI(Z.results,_,Z.totalIndexed);console.log(J),console.log("")}catch(X){console.error(M.red(`
✗ Error: ${X.message}
`)),process.exit(1)}}),kF=new B0("reindex").description("Reindex all codebase files").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Reindex Codebase"));let _=f0("Scanning and indexing files...").start(),$=new K5,X=await(await import("./embeddings-aa6d3v5m.js")).getDefaultEmbeddingProvider();await $.indexCodebase({embeddingProvider:X}),_.succeed(M.green("Indexing complete")),console.log("")}catch(_){throw new x(`Codebase reindex failed: ${_.message}`)}}),vF=new B0("status").description("Get codebase search system status").action(async()=>{try{console.log(""),console.log(M.cyan.bold("▸ Codebase Status")),await E0.initialize();let _=await E0.getStatus();if(_.codebase.indexed){if(console.log(M.green(`
✓ Indexed and ready`)),console.log(M.gray(`  Files: ${_.codebase.fileCount}`)),_.codebase.indexedAt)console.log(M.gray(`  Last indexed: ${new Date(_.codebase.indexedAt).toLocaleString()}`))}else console.log(M.yellow(`
⚠ Not indexed`)),console.log(M.gray("  Run: sylphx-flow codebase reindex"));console.log(M.cyan(`
▸ Available Commands`)),console.log(M.gray("  • codebase search <query>")),console.log(M.gray("  • codebase reindex")),console.log(M.gray("  • codebase status")),console.log("")}catch(_){console.error(M.red(`
✗ Error: ${_.message}
`)),process.exit(1)}}),IZ=new B0("codebase").description("Manage codebase indexing and search").addCommand(SF).addCommand(kF).addCommand(vF);import e0 from"node:fs";import u1 from"node:path";var hF={core:"core.md"};function B5(_="core"){return EZ(hF[_])}function jZ(_){try{return B5(_),!0}catch{return!1}}function t2(_,$="white"){let X={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",reset:"\x1B[0m"},Z=X[$]||X.white;console.log(`${Z}${_}${X.reset}`)}import PZ from"node:path";import H2 from"node:fs/promises";import TZ from"node:path";async function I5(_,$={}){let{encoding:X="utf8",fallback:Z}=$;try{return await H2.readFile(_,X)}catch(J){if(J.code==="ENOENT"&&Z!==void 0)return Z;throw J}}async function LZ(_){try{return await H2.access(_),!0}catch{return!1}}async function A8(_){try{let $=await H2.stat(_);return{exists:!0,isFile:$.isFile(),isDirectory:$.isDirectory(),size:$.size,mtime:$.mtime,atime:$.atime,ctime:$.ctime}}catch{return{exists:!1,isFile:!1,isDirectory:!1}}}async function wZ(_){if(Q5.validatePath(_),!await LZ(_))return;if((await A8(_)).isDirectory)await H2.rmdir(_,{recursive:!0});else await H2.unlink(_)}async function K8(_,$={}){let{recursive:X=!1,includeFiles:Z=!0,includeDirectories:J=!0}=$;if(Q5.validatePath(_),!await LZ(_))throw Error(`Directory does not exist: ${_}`);if(!(await A8(_)).isDirectory)throw Error(`Path is not a directory: ${_}`);if(X){let Y=[],z=await H2.readdir(_,{withFileTypes:!0});for(let H of z){let W=TZ.join(_,H.name);if(H.isDirectory()&&J){Y.push(W);let F=await K8(W,$);Y.push(...F)}else if(H.isFile()&&Z)Y.push(W)}return Y}else return(await H2.readdir(_,{withFileTypes:!0})).filter((z)=>{if(z.isFile()&&Z)return!0;if(z.isDirectory()&&J)return!0;return!1}).map((z)=>TZ.join(_,z.name))}async function E5(_,$){try{return(await K8(_,{recursive:!0,includeFiles:!0,includeDirectories:!1})).filter((Z)=>$.some((J)=>Z.endsWith(J))).map((Z)=>PZ.relative(_,Z)).sort()}catch{return[]}}async function $6(_){let $=await A8(_);if(!$.exists||!$.isFile)return null;let X=await I5(_);if(X===null)return null;return{content:X,mtime:$.mtime}}async function j5(_,$,X,Z){try{let J=await K8(_,{recursive:!1,includeFiles:!0,includeDirectories:!1});for(let G of J){let Y=PZ.basename(G);if(X.some((H)=>Y.endsWith(H))&&!$.has(Y))await wZ(G),Z.push({file:Y,status:"skipped",action:"Removed obsolete file"})}}catch{}}async function T5(_,$,X,Z,J=!1,G=!1){if(G)return;if(!J){let A=_.length,O=_.filter((R)=>R.status==="added"||R.status==="updated").length;if(O>0)console.log(`✓ ${O} files updated`);else console.log(`✓ All ${A} files already current`);return}console.log(`
\uD83D\uDCCA ${Z} Results for ${X}`),console.log("=====================================");let Y=_.reduce((A,O)=>{if(!A[O.status])A[O.status]=[];return A[O.status].push(O),A},{}),z=["added","updated","current","skipped"],H={added:"green",updated:"yellow",current:"blue",skipped:"magenta"};for(let A of z){let O=Y[A];if(O&&O.length>0){let R=H[A];t2(`${A.toUpperCase()} (${O.length}):`,R);for(let D of O)t2(`  ${D.file} - ${D.action}`,R);console.log("")}}let W=_.length,F=_.filter((A)=>A.status==="added"||A.status==="updated").length;if(F>0)t2(`✓ ${Z} complete: ${F}/${W} files modified`,"green");else t2(`✓ ${Z} complete: All ${W} files already current`,"blue");console.log(`\uD83D\uDCC1 Target directory: ${$}`)}async function xZ(){let{getAgentsDir:_}=await import("./paths-2re3k191.js"),$=_();if(!e0.existsSync($))throw Error(`Could not find agents directory at: ${$}`);let X=[],Z=e0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isFile()&&G.name.endsWith(".md")).map((G)=>G.name);X.push(...Z);let J=e0.readdirSync($,{withFileTypes:!0}).filter((G)=>G.isDirectory()&&G.name!=="archived").map((G)=>G.name);for(let G of J){let Y=u1.join($,G),z=await E5(Y,[".md"]);X.push(...z.map((H)=>u1.join(G,H)))}return X}async function qZ(_){let $=process.cwd(),X=[],Z=await v.resolveTarget({target:_.target}),J=v.getTarget(Z);if(!J)throw Error(`Target not found: ${Z}`);if(_.quiet!==!0)console.log(`Using target: ${J.name}`);let G=J.config,Y=u1.join($,G.agentDir),z=async(O,R)=>{return await J.transformAgentContent(O,void 0,R)};if(_.clear&&e0.existsSync(Y)){let O,R=await xZ();O=new Set(R.map((D)=>{let N=u1.parse(D),Q=N.name,w=N.dir;if(G.flatten)return`${w?`${w.replace(/[\/\\]/g,"-")}-${Q}`:Q}${G.agentExtension}`;return D})),j5(Y,O,[G.agentExtension],X)}e0.mkdirSync(Y,{recursive:!0});let H=await xZ();if(_.quiet!==!0)console.log(`Installing ${H.length} agents to ${Y.replace(`${process.cwd()}/`,"")}`),console.log("");if(_.dryRun){console.log("✓ Dry run completed - no files were modified");return}let{getAgentsDir:W}=await import("./paths-2re3k191.js"),F=W(),A=H.map(async(O)=>{let R=u1.join(F,O),D=u1.join(Y,O),N=u1.dirname(D);if(!e0.existsSync(N))e0.mkdirSync(N,{recursive:!0});let Q=await $6(D),w=!Q,j=e0.readFileSync(R,"utf8");j=await z(j,O);let E=Q?await z(Q.content,O):"";if(!Q||E!==j)e0.writeFileSync(D,j,"utf8"),X.push({file:O,status:Q?"updated":"added",action:Q?"Updated":"Created"});else X.push({file:O,status:"current",action:"Already current"})});await Promise.all(A),T5(X,Y,J.name,"Install",_.verbose,_.quiet)}async function CZ(_){let $=process.cwd(),X=await v.resolveTarget({target:_.target}),Z=v.getTarget(X);if(!Z)throw Error(`Target not found: ${X}`);if(!Z.config.rulesFile)return;if(!jZ("core")){console.warn("⚠️ Core rules file not found");return}let J=B5("core"),Y=e0.readFileSync(J,"utf8"),z=u1.join($,Z.config.rulesFile),H=await $6(z),W=Y;if(_.dryRun){console.log(`Dry run: Would install rules file to ${z.replace(`${$}/`,"")}`);return}if(H&&H.content===W){if(_.quiet!==!0)console.log(`Rules file already current: ${Z.config.rulesFile}`);return}if(e0.writeFileSync(z,W,"utf8"),_.quiet!==!0)console.log(`${H?"Updated":"Created"} rules file: ${Z.config.rulesFile}`)}function yF(_){return _.type==="stdio"}function L5(_){return yF(_)}function w5(_){if(typeof _==="function"){let $=_();return Promise.resolve($)}return Promise.resolve(_)}class d1{target;constructor(_){let $=v.getTarget(_);if(!$)throw Error(`Target not found: ${_}`);this.target=$}getAllServerIds(){return Object.keys(A0)}async getAvailableServers(){let _=await this.getInstalledServerIds();return this.getAllServerIds().filter(($)=>!_.includes($))}async getInstalledServerIds(){try{let _=await this.target.readConfig(process.cwd()),$=this.target.config.mcpConfigPath,X=this.getNestedProperty(_,$)||{},Z=Object.keys(X);return Object.values(A0).filter((J)=>Z.includes(J.name)).map((J)=>J.id)}catch(_){return[]}}getRequiringConfiguration(_){return _.filter(($)=>{return!!A0[$].envVars})}validateServer(_,$){let X=A0[_];if(!X?.envVars)return{isValid:!0,missingRequired:[],invalidValues:[]};let Z=[],J=[];for(let[G,Y]of Object.entries(X.envVars)){let z=$[G]||process.env[G]||"";if(Y.required&&(!z||z===""))Z.push(G)}return{isValid:Z.length===0&&J.length===0,missingRequired:Z,invalidValues:J}}async configureServer(_,$={}){let X=A0[_],Z={};if(!X.envVars)return Z;console.log(""),console.log(M.cyan(`▸ ${X.name}`)),console.log(M.gray(`  ${X.description}`)),console.log("");for(let[J,G]of Object.entries(X.envVars)){if(G.dependsOn){if(G.dependsOn.filter((W)=>!($[W]||process.env[W])).length>0)continue}let Y=$[J]||process.env[J],z;if(Y&&Y.trim()!=="")z=Y;else if(G.fetchChoices){let H=f0("Fetching options...").start();for(let[W,F]of Object.entries($))if(F)process.env[W]=F;try{let W=await G.fetchChoices();H.stop(),z=(await c.prompt({type:"list",name:"value",message:`${J}${G.required?" *":""}`,choices:W,default:G.default||W[0]})).value}catch(W){let F=W instanceof Error?W.message:String(W);H.fail(M.red(`Failed to fetch options: ${F}`)),z=(await c.prompt({type:"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default})).value}}else if(J==="GEMINI_MODEL")z=(await c.prompt({type:"list",name:"model",message:`${J}${G.required?" *":""}`,choices:["gemini-2.5-flash","gemini-2.5-pro","gemini-1.5-flash","gemini-1.5-pro"],default:G.default||"gemini-2.5-flash"})).model;else z=(await c.prompt({type:G.secret?"password":"input",name:"value",message:`${J}${G.required?" *":""}`,default:G.default,mask:G.secret?"•":void 0})).value;if(z)Z[J]=z,$[J]=z}return console.log(M.green("✓ Configured")),console.log(""),Z}async installServers(_,$={}){if(_.length===0)return;try{let X=await this.target.readConfig(process.cwd()),Z=this.target.config.mcpConfigPath,G={...this.getNestedProperty(X,Z)||{}};for(let Y of _){let z=A0[Y],H=$[Y]||{},W={...z.config},F,A;if(L5(z.config))F=z.config.command?await w5(z.config.command):void 0,A=z.config.args?await w5(z.config.args):[];if(L5(z.config))W={...z.config,command:F,args:A};if(Object.keys(H).length>0){let D={...z.config.type==="local"?z.config.environment:z.config.type==="stdio"?z.config.env:{}};for(let[N,Q]of Object.entries(H))if(Q&&Q.trim()!=="")D[N]=Q;if(W.type==="local")W.environment=D;else if(W.type==="stdio")W.env=D}let O=this.target.transformMCPConfig(W,Y);G[z.name]=O}if(this.setNestedProperty(X,Z,G),await this.target.writeConfig(process.cwd(),X),this.target.approveMCPServers){let Y=_.map((z)=>A0[z].name);await this.target.approveMCPServers(process.cwd(),Y)}}catch(X){throw Error(`Failed to install MCP servers: ${X instanceof Error?X.message:String(X)}`)}}async readConfig(){try{return await this.target.readConfig(process.cwd())}catch(_){return{settings:{}}}}async writeConfig(_){await this.target.writeConfig(process.cwd(),_)}getNestedProperty(_,$){return $.split(".").reduce((X,Z)=>{if(typeof X==="object"&&X!==null)return X[Z];return},_)}setNestedProperty(_,$,X){let Z=$.split("."),J=Z.pop();if(!J)return;let G=Z.reduce((Y,z)=>{if(!Y[z])Y[z]={};return Y[z]},_);G[J]=X}}async function SZ(_,$){let X=v.getTarget($);if(!X)throw Error(`Target not found: ${$}`);let Z=await X.readConfig(_),J=X.config.mcpConfigPath,G=fF(Z,J);if(!G||Object.keys(G).length===0){console.log("ℹ️  No MCP servers configured");return}console.log(`\uD83D\uDCCB Currently configured MCP servers for ${X.name}:`),console.log("");for(let[Y,z]of Object.entries(G)){let H="";if(z&&typeof z==="object"&&"type"in z){if(z.type==="local")H=z.command?.join(" ")||"Unknown command";else if(z.type==="remote")H=`HTTP: ${z.url}`}console.log(`  • ${Y}: ${H}`);let W=Object.values(A0).find((F)=>F.name===Y);if(W)console.log(`    ${W.description}`);console.log("")}}function kZ(_){let $=v.getTarget(_);if(!$)throw Error(`Unknown target: ${_}. Available targets: ${v.getImplementedTargetIDs().join(", ")}`);if(!$.isImplemented)throw Error(`Target '${_}' is not implemented. Available targets: ${v.getImplementedTargetIDs().join(", ")}`);return _}function c1(_){return v.getTarget(_)?.config.installation.supportedMcpServers??!1}function fF(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}async function bF(_){let $=await v.resolveTarget({target:_.target});_.target=$;try{kZ($)}catch(X){if(X instanceof Error)throw new x(X.message,"UNSUPPORTED_TARGET");throw X}if(_.merge)throw new x("The --merge option is not supported with init command.","INVALID_OPTION")}var hZ={name:"init",description:"Initialize project with Sylphx Flow development agents and MCP tools",options:[{flags:"--target <type>",description:`Force specific target (${v.getImplementedTargetIDs().join(", ")}, default: opencode)`},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--no-mcp",description:"Skip MCP tools installation"}],handler:async(_)=>{let $=_.target;if(console.log(""),console.log(M.cyan.bold("▸ Sylphx Flow Setup")),!$)$=await v.promptForTargetSelection(),_.target=$;if(await bF(_),!$)throw Error("Target ID not set");if(_.dryRun){if(console.log(M.yellow(`
  Dry run mode - no changes will be made`)),_.mcp!==!1&&c1($)){let G=await new d1($).getAvailableServers();console.log(M.cyan(`
▸ MCP Tools`));for(let Y of G)console.log(M.gray(`  • ${A0[Y].name}`))}console.log(M.cyan(`
▸ Agents`)),console.log(M.gray("  • Development agents")),console.log(M.cyan(`
▸ Rules`)),console.log(M.gray("  • Custom rules")),console.log(M.green(`
✓ Dry run complete
`));return}if(_.mcp!==!1&&c1($)){let J=new d1($),G=J.getAllServerIds(),Y=await J.getInstalledServerIds();console.log(""),console.log(M.cyan.bold("▸ Configure MCP Tools")),console.log("");let H=(await c.prompt([{type:"checkbox",name:"selectedServers",message:"Select MCP tools to install:",choices:G.map((F)=>{let A=A0[F],O=Y.includes(F);return{name:`${A.name} - ${A.description}`,value:F,checked:A.required||O||A.defaultInInit||!1,disabled:A.required?"(required)":!1}})}])).selectedServers,W=G.filter((F)=>A0[F].required);if(H=[...new Set([...W,...H])],H.length>0){let F=H.filter((R)=>{let D=A0[R];return D.envVars&&Object.keys(D.envVars).length>0}),A={};if(F.length>0){console.log(""),console.log(M.cyan.bold("▸ Configure selected MCP tools"));let R={};for(let D of F){let N=await J.configureServer(D,R);A[D]=N}}let O=f0("Installing MCP servers...").start();try{await J.installServers(H,A),O.succeed("MCP servers installed")}catch(R){throw O.fail(M.red("Failed to install MCP servers")),R}}}if($==="opencode")await O8.ensureSecretsDir(process.cwd()),await O8.addToGitignore(process.cwd());console.log("");let X=f0("Installing agents...").start();await qZ({..._,quiet:!0}),X.succeed("Agents installed"),console.log("");let Z=f0("Installing rules...").start();await CZ({..._,quiet:!0}),Z.succeed("Rules installed"),console.log(""),console.log(M.green.bold("✓ Setup complete!")),console.log(M.gray("  Start coding with Sylphx Flow")),console.log("");try{await vZ.setDefaultTarget($),console.log(M.gray(`  Default target set to: ${v.getTarget($)?.name||$}`))}catch(J){console.warn(M.yellow(`  Warning: Could not save default target: ${J instanceof Error?J.message:String(J)}`))}console.log("")}};function gF(){return[{uri:"knowledge://stacks/react-app",title:"React App",description:"React application patterns, hooks, components, and best practices",content:"",category:"stacks"},{uri:"knowledge://stacks/nextjs-app",title:"Next.js App",description:"Next.js patterns, routing, API routes, and deployment strategies",content:"",category:"stacks"},{uri:"knowledge://stacks/node-api",title:"Node.js API",description:"Node.js API patterns, middleware, authentication, and database integration",content:"",category:"stacks"},{uri:"knowledge://data/sql",title:"SQL Patterns",description:"SQL queries, indexing, migrations, and database optimization",content:"",category:"data"},{uri:"knowledge://guides/saas-template",title:"SaaS Template",description:"SaaS application architecture, multi-tenancy, and scaling patterns",content:"",category:"guides"},{uri:"knowledge://guides/tech-stack",title:"Tech Stack Guide",description:"Technology selection, architecture decisions, and stack composition",content:"",category:"guides"},{uri:"knowledge://guides/ui-ux",title:"UI/UX Patterns",description:"User interface patterns, UX principles, and frontend architecture",content:"",category:"guides"},{uri:"knowledge://universal/security",title:"Security",description:"Security best practices, authentication, authorization, and vulnerability prevention",content:"",category:"universal"},{uri:"knowledge://universal/performance",title:"Performance",description:"Performance optimization, caching, monitoring, and scaling strategies",content:"",category:"universal"},{uri:"knowledge://universal/testing",title:"Testing",description:"Testing strategies, unit tests, integration tests, and quality assurance",content:"",category:"universal"},{uri:"knowledge://universal/deployment",title:"Deployment",description:"Deployment strategies, CI/CD, infrastructure, and monitoring",content:"",category:"universal"}]}function yZ(_){let X=gF().find((G)=>G.uri===_);if(!X)throw Error(`Knowledge resource not found: ${_}`);let Z=_.split("/")[2],J=_.split("/").pop();return`# ${X.title}

**URI:** ${_}
**Category:** ${Z}
**Description:** ${X.description}

*Note: This is a placeholder implementation. In a full implementation, this would load the actual content from knowledge files.*`}var pF=new B0("search").description("Search knowledge base, documentation, and guides").argument("<query>","Search query - use natural language, technology names, or topic keywords").option("-l, --limit <number>","Maximum number of results to return (default: 10)","10").option("--include-content","Include full content in results (default: true)","true").action(async(_,$)=>{try{console.log(`\uD83D\uDCDA Searching knowledge base for: "${_}"`),await E0.initialize();let X=await E0.searchKnowledge(_,{limit:Number.parseInt($.limit),include_content:$.includeContent!=="false"}),Z=E0.formatResultsForCLI(X.results,_,X.totalIndexed);console.log(Z)}catch(X){throw new x(`Knowledge search failed: ${X.message}`)}}),mF=new B0("get").description("Get specific knowledge document by URI").argument("<uri>",'Knowledge URI to access (e.g., "knowledge://stacks/react-app")').action(async(_)=>{try{let $=yZ(_);console.log($)}catch($){let X=`Knowledge get failed: ${$.message}`,Z=await E0.getAvailableKnowledgeURIs();if(Z.length>0)console.log(`
**Available knowledge URIs:**`),Z.forEach((J)=>console.log(`• ${J}`));throw new x(X)}}),uF=new B0("list").description("List all available knowledge resources").option("--category <type>","Filter by category (stacks, guides, universal, data)").action(async(_)=>{try{await E0.initialize();let $=await E0.getAvailableKnowledgeURIs();if($.length===0){console.log("\uD83D\uDCED No knowledge documents available");return}let X=$;if(_.category)X=$.filter((J)=>J.includes(`/${_.category}/`));console.log(`\uD83D\uDCDA Available Knowledge Resources (${X.length} documents):
`);let Z=X.reduce((J,G)=>{let Y=G.split("/")[2]||"unknown";if(!J[Y])J[Y]=[];return J[Y].push(G),J},{});Object.entries(Z).forEach(([J,G])=>{console.log(`### ${J.charAt(0).toUpperCase()+J.slice(1)}`),G.forEach((Y)=>{let z=Y.split("/").pop()||"Unknown";console.log(`• ${z} - ${Y}`)}),console.log("")}),console.log("**Usage:**"),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch($){throw new x(`Knowledge status failed: ${$.message}`)}}),dF=new B0("status").description("Get knowledge base system status").action(async()=>{try{console.log(`
### \uD83D\uDCDA Knowledge Base Status
`),await E0.initialize();let _=await E0.getStatus();if(_.knowledge.indexed)console.log("**Status:** ✓ Ready"),console.log(`**Documents:** ${_.knowledge.documentCount} files`);else if(_.knowledge.isIndexing)console.log(`**Status:** \uD83D\uDD04 Building index (${_.knowledge.progress||0}%)`),console.log("**Note:** Please wait a moment and try again");else console.log("**Status:** ⚠️ Not initialized"),console.log("**Note:** Will auto-index on first search");console.log(`
**Available Commands:**`),console.log("• sylphx knowledge search <query> - Search knowledge base"),console.log("• sylphx knowledge get <uri> - Get specific document")}catch(_){throw new x(`Knowledge list failed: ${_.message}`)}}),e2=new B0("knowledge").description("Knowledge base search and management commands");e2.addCommand(pF);e2.addCommand(mF);e2.addCommand(uF);e2.addCommand(dF);function cF(_,$){return $.split(".").reduce((X,Z)=>X?.[Z],_)}var lF=async(_)=>{let $={disableMemory:_.disableMemory===!0,disableTime:_.disableTime===!0,disableProjectStartup:_.disableProjectStartup===!0,disableKnowledge:_.disableKnowledge===!0,disableCodebaseSearch:_.disableCodebaseSearch===!0},X=await v.resolveTarget({target:_.target,allowSelection:!0}),Z=v.getTarget(X);if(!Z)throw new x(`Target not found: ${X}`,"TARGET_NOT_FOUND");try{let J=await Z.readConfig(process.cwd()),G=Z.config.mcpConfigPath||"mcp",Y=cF(J,G)||{},z=["--disable-memory","--disable-time","--disable-project-startup","--disable-knowledge","--disable-codebase-search"],H=[];if($.disableMemory)H.push("--disable-memory");if($.disableTime)H.push("--disable-time");if($.disableProjectStartup)H.push("--disable-project-startup");if($.disableKnowledge)H.push("--disable-knowledge");if($.disableCodebaseSearch)H.push("--disable-codebase-search");for(let[W,F]of Object.entries(Y)){if(!F||typeof F!=="object")continue;if(F.type==="stdio"){if(!F.args)F.args=[];F.args.push(...H)}else if(F.type==="local"&&Array.isArray(F.command))F.command.push(...H);else if(F.type==="http"||F.type==="remote")continue}await Z.writeConfig(process.cwd(),J),console.log(M.green("✓ Sylphx Flow MCP server configuration updated"))}catch(J){throw new x(`Failed to update MCP configuration: ${J instanceof Error?J.message:String(J)}`,"MCP_CONFIG_ERROR")}},iF=async(_)=>{let $=_.server,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1(X))throw new x(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");console.log(""),console.log(M.cyan.bold("▸ Configure MCP Server")),console.log(M.gray(`  Target: ${X}`));let Z=new d1(X),J;if($){if(!Z.getAllServerIds().includes($))throw new x(`Invalid MCP server: ${$}. Available: ${Z.getAllServerIds().join(", ")}`,"INVALID_MCP_SERVER");J=$}else J=(await c.prompt([{type:"list",name:"server",message:"Select server to configure:",choices:Z.getAllServerIds().map((H)=>{let W=A0[H];return{name:`${W.name} - ${W.description}`,value:H}})}])).server;let G=A0[J];if(console.log(M.cyan(`
▸ ${G.name}`)),console.log(M.gray(`  ${G.description}`)),!G.envVars){console.log(M.gray(`
  No configuration needed`));return}await Z.configureServer(J);let Y=f0("Saving configuration...").start();try{await Z.installServers([J]),Y.succeed(M.green("✓ Configuration saved"))}catch(z){throw Y.fail(M.red("Failed to save configuration")),z}},nF=async(_)=>{let $=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1($))throw new x(`Target ${$} does not support MCP servers`,"UNSUPPORTED_TARGET");await SZ(process.cwd(),$)},sF=async(_)=>{let $=_.servers,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1(X))throw new x(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new x("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let Z=Array.isArray($)?$:[$],J=new d1(X),G=J.getAllServerIds(),Y=Z.filter((H)=>!G.includes(H));if(Y.length>0)throw new x(`Invalid MCP servers: ${Y.join(", ")}. Available: ${G.join(", ")}`,"INVALID_MCP_SERVERS");let z=Z;await J.installServers(z)},oF=async(_)=>{let $=_.servers,X=await v.resolveTarget({target:_.target,allowSelection:!0});if(!c1(X))throw new x(`Target ${X} does not support MCP servers`,"UNSUPPORTED_TARGET");if(!$||$.length===0)throw new x("No servers specified. Use --servers <server1,server2,...>","NO_SERVERS_SPECIFIED");let J=new d1(X).getInstalledServerIds(),G=$.filter((Y)=>!J.includes(Y));if(G.length>0)throw new x(`MCP servers not installed: ${G.join(", ")}. Installed: ${J.join(", ")}`,"SERVERS_NOT_INSTALLED");console.log(M.yellow("Remove functionality not yet implemented"))},fZ={name:"mcp",description:"Manage MCP (Model Context Protocol) servers",options:[{flags:"--target <type>",description:`Force specific target (${v.getImplementedTargetIDs().join(", ")}, default: opencode)`}],subcommands:[{name:"start",description:"Start Sylphx Flow MCP server with specific configuration",options:[{flags:"--disable-memory",description:"Disable memory functionality"},{flags:"--disable-time",description:"Disable time functionality"},{flags:"--disable-project-startup",description:"Disable project startup functionality"},{flags:"--disable-knowledge",description:"Disable knowledge functionality"},{flags:"--disable-codebase-search",description:"Disable codebase search functionality"}],handler:lF},{name:"config",description:"Configure MCP server settings",options:[{flags:"--server <name>",description:"Configure specific server (shows selection if not provided)"}],handler:iF},{name:"list",description:"List installed MCP servers",options:[],handler:nF},{name:"add",description:"Add MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to add"}],handler:sF},{name:"remove",description:"Remove MCP servers",options:[{flags:"--servers <servers>",description:"Comma-separated list of server names to remove"}],handler:oF}]};var rF=async(_)=>{let X=await new v0().getAll();if(_.namespace&&_.namespace!=="all"){let Z=X.filter((Y)=>Y.namespace===_.namespace);if(console.log(`\uD83D\uDCCB Memory entries in namespace: ${_.namespace}`),console.log(`Total: ${Z.length} entries
`),Z.length===0){console.log("No entries found in this namespace.");return}let J=_.limit||50;Z.slice(0,J).forEach((Y,z)=>{let H=Y.value||"",W=typeof H==="string"?H.substring(0,50)+(H.length>50?"...":""):`${JSON.stringify(H).substring(0,50)}...`;console.log(`${z+1}. ${Y.namespace}:${Y.key}`),console.log(`   Value: ${W}`),console.log(`   Updated: ${Y.updated_at}`),console.log("")})}else{if(console.log(`\uD83D\uDCCB All memory entries (showing first ${_.limit||50}):`),console.log(`Total: ${X.length} entries
`),X.length===0){console.log("No memory entries found.");return}let Z=_.limit||50;X.slice(0,Z).forEach((G,Y)=>{let z=G.value||"",H=typeof z==="string"?z.substring(0,50)+(z.length>50?"...":""):`${JSON.stringify(z).substring(0,50)}...`;console.log(`${Y+1}. ${G.namespace}:${G.key}`),console.log(`   Value: ${H}`),console.log(`   Updated: ${G.updated_at}`),console.log("")})}},aF=async(_)=>{if(!_.pattern)throw new x("Search pattern is required. Use --pattern <pattern>");let X=await new v0().search(_.pattern,_.namespace);if(console.log(`\uD83D\uDD0D Search results for pattern: ${_.pattern}`),_.namespace&&_.namespace!=="all")console.log(`Namespace: ${_.namespace}`);if(console.log(`Found: ${X.length} results
`),X.length===0){console.log("No matching entries found.");return}X.forEach((Z,J)=>{let G=Z.value||"",Y=typeof G==="string"?G.substring(0,50)+(G.length>50?"...":""):`${JSON.stringify(G).substring(0,50)}...`;console.log(`${J+1}. ${Z.namespace}:${Z.key}`),console.log(`   Value: ${Y}`),console.log(`   Updated: ${Z.updated_at}`),console.log("")})},tF=async(_)=>{if(!_.key)throw new x("Key is required. Use --key <key>");if(await new v0().delete(_.key,_.namespace||"default"))console.log(`✓ Deleted memory entry: ${_.namespace||"default"}:${_.key}`);else console.log(`✗ Memory entry not found: ${_.namespace||"default"}:${_.key}`)},eF=async(_)=>{if(!_.confirm)throw new x("Confirmation required. Use --confirm to clear memory entries");let $=new v0;if(_.namespace)await $.clear(_.namespace),console.log(`✓ Cleared all memory entries in namespace: ${_.namespace}`);else await $.clear(),console.log("✓ Cleared all memory entries")},_U=async()=>{let $=await new v0().getStats();if(console.log("\uD83D\uDCCA Memory Statistics"),console.log("=================="),console.log(`Total Entries: ${$.totalEntries}`),console.log(`Namespaces: ${$.namespaces.length}`),console.log(""),$.namespaces.length>0)console.log("Namespaces:"),$.namespaces.forEach((X)=>{console.log(`  • ${X}`)}),console.log("");console.log("\uD83D\uDCCD Database: .sylphx-flow/memory.db")},$U=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("get")+1;if(X>=$.length)throw new x("Usage: flow memory get <key> [--namespace <namespace>]");let Z=$[X],J=_.namespace||"default",Y=await new v0().get(Z,J);if(Y)console.log(`\uD83D\uDCC4 Memory entry: ${J}:${Z}`),console.log(`Value: ${JSON.stringify(Y.value,null,2)}`),console.log(`Created: ${Y.created_at}`),console.log(`Updated: ${Y.updated_at}`);else console.log(`✗ Memory entry not found: ${J}:${Z}`)},XU=async(_)=>{let $=process.argv.slice(2),X=$.indexOf("set")+1,Z=X+1;if(X>=$.length||Z>=$.length)throw new x("Usage: flow memory set <key> <value> [--namespace <namespace>]");let J=$[X],G=$[Z],Y=_.namespace||"default";await new v0().set(J,G,Y),console.log(`✓ Set memory entry: ${Y}:${J} = "${G}"`)},bZ={name:"memory",description:"Manage memory storage (set, get, search, list, delete, clear)",options:[{flags:"--target <type>",description:`Target platform (${v.getImplementedTargets().join(", ")}, default: auto-detect)`}],subcommands:[{name:"list",description:"List memory entries",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"},{flags:"--limit <number>",description:"Limit number of entries (default: 50)"}],handler:rF},{name:"search",description:"Search memory entries",arguments:[{name:"pattern",required:!0,description:"Search pattern"}],options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:aF},{name:"delete",description:"Delete memory entry",arguments:[{name:"key",required:!0,description:"Memory key to delete"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:tF},{name:"clear",description:"Clear memory entries",options:[{flags:"--namespace <name>",description:"Clear specific namespace (default: all)"},{flags:"--confirm",description:"Skip confirmation prompt"}],handler:eF},{name:"stats",description:"Show memory statistics",options:[{flags:"--namespace <name>",description:"Filter by namespace (default: all)"}],handler:_U},{name:"get",description:"Get memory entry",arguments:[{name:"key",required:!0,description:"Memory key to retrieve"}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:$U},{name:"set",description:"Set memory entry",arguments:[{name:"key",description:"Memory key",required:!0},{name:"value",description:"Memory value",required:!0}],options:[{flags:"--namespace <name>",description:"Namespace (default: default)"}],handler:XU}]};import*as X6 from"node:fs";import*as U2 from"node:path";import ZU from"node:crypto";import P5 from"node:fs";function gZ(_){let $=_.migrationsFolder,X=[],Z=`${$}/meta/_journal.json`;if(!P5.existsSync(Z))throw Error("Can't find meta/_journal.json file");let J=P5.readFileSync(`${$}/meta/_journal.json`).toString(),G=JSON.parse(J);for(let Y of G.entries){let z=`${$}/${Y.tag}.sql`;try{let H=P5.readFileSync(`${$}/${Y.tag}.sql`).toString(),W=H.split("--> statement-breakpoint").map((F)=>{return F});X.push({sql:W,bps:Y.breakpoints,folderMillis:Y.when,hash:ZU.createHash("sha256").update(H).digest("hex")})}catch{throw Error(`No file ${z} found in ${$} folder`)}}return X}async function pZ(_,$){let X=gZ($),Z=$.migrationsTable??"__drizzle_migrations",J=U`
		CREATE TABLE IF NOT EXISTS ${U.identifier(Z)} (
			id SERIAL PRIMARY KEY,
			hash text NOT NULL,
			created_at numeric
		)
	`;await _.session.run(J);let Y=(await _.values(U`SELECT id, hash, created_at FROM ${U.identifier(Z)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0,z=[];for(let H of X)if(!Y||Number(Y[2])<H.folderMillis){for(let W of H.sql)z.push(_.run(U.raw(W)));z.push(_.run(U`INSERT INTO ${U.identifier(Z)} ("hash", "created_at") VALUES(${H.hash}, ${H.folderMillis})`))}await _.session.migrate(z)}var R8={};U6(R8,{tfidfTerms:()=>N0,tfidfIdf:()=>__,tfidfDocuments:()=>W2,memory:()=>f,codebaseMetadata:()=>F2,codebaseFiles:()=>i});var f=I0("memory",{key:k("key").notNull(),namespace:k("namespace").notNull().default("default"),value:k("value").notNull(),timestamp:S0("timestamp").notNull(),created_at:k("created_at").notNull(),updated_at:k("updated_at").notNull()},(_)=>({pk:n2({columns:[_.key,_.namespace]}),namespaceIdx:R0("idx_memory_namespace").on(_.namespace),timestampIdx:R0("idx_memory_timestamp").on(_.timestamp),keyIdx:R0("idx_memory_key").on(_.key)})),i=I0("codebase_files",{path:k("path").primaryKey(),mtime:S0("mtime").notNull(),hash:k("hash").notNull(),content:k("content"),language:k("language"),size:S0("size"),indexedAt:k("indexed_at").notNull()},(_)=>({mtimeIdx:R0("idx_codebase_files_mtime").on(_.mtime),hashIdx:R0("idx_codebase_files_hash").on(_.hash)})),N0=I0("tfidf_terms",{filePath:k("file_path").notNull().references(()=>i.path,{onDelete:"cascade"}),term:k("term").notNull(),frequency:F1("frequency").notNull()},(_)=>({termIdx:R0("idx_tfidf_terms_term").on(_.term),fileIdx:R0("idx_tfidf_terms_file").on(_.filePath)})),W2=I0("tfidf_documents",{filePath:k("file_path").primaryKey().references(()=>i.path,{onDelete:"cascade"}),magnitude:F1("magnitude").notNull(),termCount:S0("term_count").notNull(),rawTerms:k("raw_terms").notNull()}),__=I0("tfidf_idf",{term:k("term").primaryKey(),idfValue:F1("idf_value").notNull()}),F2=I0("codebase_metadata",{key:k("key").primaryKey(),value:k("value").notNull()});class x5{client;db;constructor(){try{let _=U2.join(process.cwd(),".sylphx-flow");if(!X6.existsSync(_))X6.mkdirSync(_,{recursive:!0});let $=U2.join(_,"memory.db");this.client=m1({url:`file:${$}`}),this.db=a2(this.client,{schema:R8})}catch(_){throw new B_("Failed to initialize database connection",{url:`file:${U2.join(process.cwd(),".sylphx-flow/memory.db")}`},_)}}async initialize(){try{if((await this.getMigrationStatus()).isMigrated){if(console.error("[INFO] Database tables already exist, checking migration state"),(await this.client.execute(`
          SELECT name FROM sqlite_master 
          WHERE type='table' AND name='__drizzle_migrations'
        `)).rows.length===0)await this.client.execute(`
            CREATE TABLE IF NOT EXISTS __drizzle_migrations (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              hash text NOT NULL UNIQUE,
              created_at numeric NOT NULL DEFAULT (strftime('%s', 'now'))
            )
          `),await this.client.execute(`
            INSERT OR IGNORE INTO __drizzle_migrations (hash, created_at) 
            VALUES ('0000_wooden_lady_bullseye', strftime('%s', 'now'))
          `),console.error("[INFO] Migration tracking initialized for existing tables");return}let $=U2.join(process.cwd(),"drizzle");if(X6.existsSync($))await pZ(this.db,{migrationsFolder:$}),console.error("[INFO] Database migrations completed");else console.error("[WARN] No migrations folder found, using fallback table creation"),await this.createTablesFallback()}catch(_){let $=`Migration failed: ${_.message}`;console.error("[ERROR]",$);try{await this.createTablesFallback(),console.error("[WARN] Fallback table creation completed")}catch(X){throw new J0("Both migration and fallback failed","initialize",X,{originalError:_.message})}}}async createTablesFallback(){console.error("[INFO] Using fallback table creation")}async close(){}getDatabasePath(){let _=U2.join(process.cwd(),".sylphx-flow");return U2.join(_,"memory.db")}async getMigrationStatus(){try{let _=await this.client.execute(`
        SELECT name FROM sqlite_master 
        WHERE type='table' AND name IN ('memory', 'codebase_files', 'tfidf_terms')
      `);return{isMigrated:_.rows.length>=2,migrationCount:_.rows.length}}catch(_){throw new J0("Failed to check migration status","getMigrationStatus",_)}}async healthCheck(){try{await this.client.execute("SELECT 1");let _=await this.getMigrationStatus(),$=await this.client.execute(`
        SELECT count(*) as count FROM memory
      `);return{healthy:!0,details:{tablesExist:_.isMigrated,tableCount:_.migrationCount,memoryEntries:$.rows[0]?.count||0}}}catch(_){return{healthy:!1,error:_.message}}}}class q5{drizzleDb;db;constructor(){this.drizzleDb=new x5,this.db=this.drizzleDb.db}async initialize(){await this.drizzleDb.initialize()}safeSerialize(_){try{return JSON.stringify(_)}catch($){throw Error(`Failed to serialize value: ${$.message}`)}}safeDeserialize(_){try{return JSON.parse(_)}catch{return _}}async set(_,$,X="default"){if(!_||typeof _!=="string")throw new E6("Key must be a non-empty string","key",_);if(!X||typeof X!=="string")throw new E6("Namespace must be a non-empty string","namespace",X);await l("memory.set",async()=>{let Z=new Date,J=Z.getTime(),G=Z.toISOString(),Y=G,z=this.safeSerialize($);if(await this.get(_,X))await this.db.update(f).set({value:z,timestamp:J,updated_at:Y}).where(K0(L(f.key,_),L(f.namespace,X)));else{let W={key:_,namespace:X,value:z,timestamp:J,created_at:G,updated_at:Y};await this.db.insert(f).values(W)}},{key:_,namespace:X})}async get(_,$="default"){let X=await this.db.select().from(f).where(K0(L(f.key,_),L(f.namespace,$))).limit(1);if(X.length===0)return null;let Z=X[0];return{key:Z.key,namespace:Z.namespace,value:this.safeDeserialize(Z.value),timestamp:Z.timestamp,created_at:Z.created_at,updated_at:Z.updated_at}}async getAll(){return(await this.db.select().from(f).orderBy(p0(f.timestamp))).map(($)=>({key:$.key,namespace:$.namespace,value:this.safeDeserialize($.value),timestamp:$.timestamp,created_at:$.created_at,updated_at:$.updated_at}))}async search(_,$){if(!_||typeof _!=="string")throw Error("Search pattern must be a non-empty string");let X=_.replace(/[^a-zA-Z0-9\s*_\-]/g,"");if(X!==_)throw Error("Search pattern contains invalid characters");let Z=X.replace(/\*/g,"%"),J=J1(f.key,Z);if($&&$!=="all"){if(!/^[a-zA-Z0-9_\-]+$/.test($))throw Error("Namespace contains invalid characters");J=K0(J,L(f.namespace,$))}return(await this.db.select().from(f).where(J).orderBy(p0(f.timestamp)).limit(1000)).map((Y)=>({key:Y.key,namespace:Y.namespace,value:this.safeDeserialize(Y.value),timestamp:Y.timestamp,created_at:Y.created_at,updated_at:Y.updated_at}))}async delete(_,$="default"){return(await this.db.delete(f).where(K0(L(f.key,_),L(f.namespace,$)))).rowsAffected>0}async clear(_){if(_&&_!=="all")await this.db.delete(f).where(L(f.namespace,_));else await this.db.delete(f)}async getStats(){let[_,$,X,Z]=await Promise.all([this.db.select({count:n0()}).from(f),this.db.select({namespace:f.namespace,count:n0()}).from(f).groupBy(f.namespace).orderBy(f.namespace),this.db.select({created_at:f.created_at}).from(f).orderBy(f.created_at).limit(1),this.db.select({created_at:f.created_at}).from(f).orderBy(p0(f.created_at)).limit(1)]),J=_[0]?.count||0,G=$.map((W)=>W.namespace),Y=Object.fromEntries($.map((W)=>[W.namespace,W.count])),z=X[0]?.created_at||null,H=Z[0]?.created_at||null;return{totalEntries:J,namespaces:G,namespaceCounts:Y,oldestEntry:z,newestEntry:H}}async load(){let _=await this.getAll(),$={};return _.forEach((X)=>{if(!$[X.namespace])$[X.namespace]={};$[X.namespace][X.key]=X.value}),{namespaces:$}}async close(){await this.drizzleDb.close()}getDatabasePath(){return this.drizzleDb.getDatabasePath()}async setCodebaseMetadata(_,$){let X=this.safeSerialize($);await this.db.insert(F2).values({key:_,value:X}).onConflictDoUpdate({target:F2.key,set:{value:X}})}async getCodebaseMetadata(_){let $=await this.db.select().from(F2).where(L(F2.key,_)).limit(1);if($.length===0)return null;return this.safeDeserialize($[0].value)}async upsertCodebaseFile(_){let $=new Date().toISOString();await this.db.insert(i).values({path:_.path,mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}).onConflictDoUpdate({target:i.path,set:{mtime:_.mtime,hash:_.hash,content:_.content||null,language:_.language||null,size:_.size||null,indexedAt:$}})}async getCodebaseFile(_){let $=await this.db.select().from(i).where(L(i.path,_)).limit(1);return $.length>0?$[0]:null}async getAllCodebaseFiles(){return await this.db.select({path:i.path,mtime:i.mtime,hash:i.hash,content:i.content,language:i.language,size:i.size,indexedAt:i.indexedAt}).from(i).orderBy(i.path)}async deleteCodebaseFile(_){await this.db.delete(i).where(L(i.path,_))}async upsertTFIDFDocument(_,$){await this.db.insert(W2).values({filePath:_,magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}).onConflictDoUpdate({target:W2.filePath,set:{magnitude:$.magnitude,termCount:$.termCount,rawTerms:this.safeSerialize($.rawTerms)}})}async getTFIDFDocument(_){let $=await this.db.select().from(W2).where(L(W2.filePath,_)).limit(1);if($.length===0)return null;let X=$[0];return{...X,rawTerms:this.safeDeserialize(X.rawTerms)}}async setTFIDFTerms(_,$){if(await this.db.delete(N0).where(L(N0.filePath,_)),Object.keys($).length>0){let X=Object.entries($).map(([J,G])=>({filePath:_,term:J,frequency:G})),Z=100;for(let J=0;J<X.length;J+=100){let G=X.slice(J,J+100);await this.db.insert(N0).values(G)}}}async getTFIDFTerms(_){let $=await this.db.select().from(N0).where(L(N0.filePath,_)),X={};return $.forEach((Z)=>{X[Z.term]=Z.frequency}),X}async setIDFValues(_){if(await this.db.delete(__),Object.keys(_).length>0){let $=Object.entries(_).map(([Z,J])=>({term:Z,idfValue:J})),X=100;for(let Z=0;Z<$.length;Z+=100){let J=$.slice(Z,Z+100);await this.db.insert(__).values(J)}}}async getIDFValues(){let _=await this.db.select().from(__),$={};return _.forEach((X)=>{$[X.term]=X.idfValue}),$}async getCodebaseIndexStats(){let $=(await this.db.select({count:i.path}).from(i)).length,Z=(await this.db.selectDistinct({term:N0.term}).from(N0)).length,[J,G]=await Promise.all([this.getCodebaseMetadata("indexedAt"),this.getCodebaseMetadata("version")]);return{fileCount:$,termCount:Z,indexedAt:J,version:G}}async clearCodebaseIndex(){await Promise.all([this.db.delete(i),this.db.delete(N0),this.db.delete(W2),this.db.delete(__),this.db.delete(F2)])}async searchTFIDFTerms(_){if(!_||typeof _!=="string")throw Error("Term pattern must be a non-empty string");let $=_.replace(/[^a-zA-Z0-9\s_\-]/g,"");if($!==_)throw Error("Term pattern contains invalid characters");let X=`%${$}%`;return await this.db.select({path:i.path,term:N0.term,frequency:N0.frequency,language:i.language}).from(N0).innerJoin(i,L(N0.filePath,i.path)).where(J1(N0.term,X)).orderBy(p0(N0.frequency)).limit(100)}}class mZ{memory;entries=[];running=!0;constructor(){this.memory=new q5}async start(){console.clear(),console.log(M.cyan.bold("\uD83E\uDDE0 Memory Manager")),console.log(M.gray(`Interactive memory management for Sylphx Flow
`)),await this.loadEntries();while(this.running)try{await this.showMainMenu()}catch(_){console.error(M.red(`Error: ${_}`)),await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}async loadEntries(){try{this.entries=await this.memory.getAll(),this.entries.sort((_,$)=>new Date($.updated_at).getTime()-new Date(_.updated_at).getTime())}catch(_){console.error(M.red(`Failed to load entries: ${_}`)),this.entries=[]}}async showMainMenu(){if(this.entries.length===0){console.log(M.yellow("No memory entries found."));let{action:X}=await c.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:[{name:"➕ Add new entry",value:"add"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh"},{name:"✗ Exit",value:"exit"}]}]);if(X==="add")await this.showAddEntry();else if(X==="refresh")await this.loadEntries();else this.running=!1;return}let _=[{name:"\uD83D\uDCDD View entry details",value:"view",short:"View"},{name:"✏️ Edit entry",value:"edit",short:"Edit"},{name:"➕ Add new entry",value:"add",short:"Add"},{name:"\uD83D\uDDD1️ Delete entry",value:"delete",short:"Delete"},{name:"\uD83D\uDD0D Search entries",value:"search",short:"Search"},{name:"\uD83D\uDD04 Refresh entries",value:"refresh",short:"Refresh"},{name:"✗ Exit",value:"exit",short:"Exit"}],{action:$}=await c.prompt([{type:"list",name:"action",message:"What would you like to do?",choices:_}]);switch($){case"view":await this.showViewEntry();break;case"edit":await this.showEditEntry();break;case"add":await this.showAddEntry();break;case"delete":await this.showDeleteEntry();break;case"search":await this.showSearchEntries();break;case"refresh":await this.loadEntries(),console.log(M.green("✓ Entries refreshed"));break;case"exit":this.running=!1;break}}async selectEntry(_,$=!1){if(this.entries.length===0){if($)return null;throw Error("No entries available")}let X=this.entries.map((J,G)=>({value:J,name:`${M.cyan(`${G+1}.`)} ${M.bold(J.namespace)}:${M.bold(J.key)}`,short:`${J.namespace}:${J.key}`}));if($)X.unshift({name:"← Back to menu",value:null,short:"Back"});let{selected:Z}=await c.prompt([{type:"list",name:"selected",message:_,choices:X,pageSize:15}]);return Z}async showViewEntry(){let _=await this.selectEntry("Select entry to view:",!0);if(!_)return;console.clear(),console.log(M.cyan.bold("\uD83D\uDCC4 Entry Details")),console.log(M.gray("─".repeat(50))),console.log(M.blue.bold("Namespace:"),_.namespace),console.log(M.blue.bold("Key:"),_.key),console.log(M.blue.bold("Updated:"),_.updated_at),console.log(M.blue.bold(`
Value:`));let $=JSON.stringify(_.value,null,2);console.log(M.gray($)),await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showEditEntry(){let _=await this.selectEntry("Select entry to edit:",!0);if(!_)return;console.clear(),console.log(M.yellow.bold("✏️ Edit Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Editing:")} ${_.namespace}:${_.key}
`);let $=await c.prompt([{type:"input",name:"namespace",message:"Namespace:",default:_.namespace,validate:(X)=>X.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",default:_.key,validate:(X)=>X.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:JSON.stringify(_.value,null,2),validate:(X)=>{try{return JSON.parse(X),!0}catch{return"Invalid JSON format"}}}]);try{let X=JSON.parse($.value);if(await this.memory.set($.key,X,$.namespace),$.namespace!==_.namespace||$.key!==_.key)await this.memory.delete(_.key,_.namespace);await this.loadEntries(),console.log(M.green(`✓ Updated ${$.namespace}:${$.key}`))}catch(X){console.error(M.red(`Failed to update entry: ${X}`))}await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showAddEntry(){console.clear(),console.log(M.green.bold("➕ Add New Entry")),console.log(M.gray("─".repeat(50)));let _=await c.prompt([{type:"input",name:"namespace",message:"Namespace:",default:"default",validate:($)=>$.trim().length>0||"Namespace is required"},{type:"input",name:"key",message:"Key:",validate:($)=>$.trim().length>0||"Key is required"},{type:"editor",name:"value",message:"Value (JSON):",default:`{
  
}`,validate:($)=>{try{return JSON.parse($),!0}catch{return"Invalid JSON format"}}}]);try{let $=JSON.parse(_.value);await this.memory.set(_.key,$,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Added ${_.namespace}:${_.key}`))}catch($){console.error(M.red(`Failed to add entry: ${$}`))}await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showDeleteEntry(){let _=await this.selectEntry("Select entry to delete:",!0);if(!_)return;console.clear(),console.log(M.red.bold("\uD83D\uDDD1️ Delete Entry")),console.log(M.gray("─".repeat(50))),console.log(`${M.blue("Entry:")} ${_.namespace}:${_.key}`);let $=JSON.stringify(_.value),X=$.length>100?$.substring(0,100)+"...":$;console.log(`${M.blue("Value:")} ${M.gray(X)}`);let{confirmed:Z}=await c.prompt([{type:"confirm",name:"confirmed",message:M.yellow("Are you sure you want to delete this entry?"),default:!1}]);if(Z)try{await this.memory.delete(_.key,_.namespace),await this.loadEntries(),console.log(M.green(`✓ Deleted ${_.namespace}:${_.key}`))}catch(J){console.error(M.red(`Failed to delete entry: ${J}`))}else console.log(M.gray("Delete cancelled"));await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}async showSearchEntries(){console.clear(),console.log(M.magenta.bold("\uD83D\uDD0D Search Entries")),console.log(M.gray("─".repeat(50)));let{query:_}=await c.prompt([{type:"input",name:"query",message:"Search query:",validate:(X)=>X.trim().length>0||"Search query is required"}]),$=this.entries.filter((X)=>X.namespace.toLowerCase().includes(_.toLowerCase())||X.key.toLowerCase().includes(_.toLowerCase())||JSON.stringify(X.value).toLowerCase().includes(_.toLowerCase()));if($.length===0)console.log(M.yellow("No entries found matching your search."));else console.log(M.cyan(`
Found ${$.length} matching entries:
`)),$.forEach((X,Z)=>{let J=JSON.stringify(X.value),G=J.length>80?J.substring(0,80)+"...":J;console.log(`${M.cyan(`${Z+1}.`)} ${M.bold(X.namespace)}:${M.bold(X.key)}`),console.log(`   ${M.gray(G)}
`)});await c.prompt([{type:"input",name:"continue",message:"Press Enter to continue..."}])}}var uZ=async()=>{await new mZ().start()};var C5=async()=>{await uZ()},uT={name:"memory-tui",description:"Launch interactive memory management TUI",options:[{flags:"--target <type>",description:`Target platform (${v.getImplementedTargets().join(", ")}, default: auto-detect)`}],handler:C5};import dZ from"node:fs/promises";import cZ from"node:path";async function JU(_){if(_.target=await v.resolveTarget({target:_.target,allowSelection:!0}),!_.agent)_.agent="builder"}async function GU(_){try{let $=cZ.join(process.cwd(),"agents",`${_}.md`);try{return await dZ.readFile($,"utf-8")}catch(X){let Z=$_(),J=cZ.join(Z,`${_}.md`);return await dZ.readFile(J,"utf-8")}}catch($){throw new x(`Agent '${_}' not found`,"AGENT_NOT_FOUND")}}function YU(_){let $=/^---\s*\n[\s\S]*?\n---\s*\n/,X=_.match($);if(X)return _.substring(X[0].length).trim();return _.trim()}function zU(_,$,X,Z){let J=v.getTarget(_);if(!J)throw new x(`Target not found: ${_}`,"TARGET_NOT_FOUND");if(!J.isImplemented)throw new x(`Target '${_}' is not implemented. Supported targets: ${lZ().join(", ")}`,"TARGET_NOT_IMPLEMENTED");if(!J.executeCommand)throw new x(`Target '${_}' does not support command execution. Supported targets: ${lZ().join(", ")}`,"EXECUTION_NOT_SUPPORTED");return J.executeCommand($,X,Z)}function lZ(){return v.getImplementedTargetIDs().filter((_)=>{return v.getTarget(_)?.executeCommand!==void 0})}var iZ={name:"run",description:"Run a prompt with a specific agent (default: sparc-orchestrator) using the detected or specified target",options:[{flags:"--target <name>",description:`Target platform (${v.getImplementedTargetIDs().join(", ")}, default: auto-detect)`},{flags:"--agent <name>",description:"Agent to use (default: sparc-orchestrator)"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without executing the command"}],arguments:[{name:"prompt",description:"The prompt to execute with the agent (optional - if not provided, will start Claude Code interactively)",required:!1}],handler:async(_)=>{await JU(_);let{prompt:$,agent:X,verbose:Z}=_;if(Z){if(console.log("\uD83D\uDE80 Sylphx Flow Run"),console.log("===================="),console.log(`\uD83C\uDFAF Target: ${_.target}`),console.log(`\uD83E\uDD16 Agent: ${X}`),$)console.log(`\uD83D\uDCAC Prompt: ${$}`);else console.log("\uD83D\uDCAC Prompt: [Interactive mode]");console.log("")}let J=await GU(X),Y=`AGENT INSTRUCTIONS:
${YU(J)}`,z="";if($&&$.trim()!=="")z=$;if(Z)if(console.log("\uD83D\uDCDD System Prompt:"),console.log("================"),console.log(Y.substring(0,500)+(Y.length>500?"...":"")),console.log(""),z.trim()!=="")console.log("\uD83D\uDCDD User Prompt:"),console.log("=============="),console.log(z.substring(0,500)+(z.length>500?"...":"")),console.log("");else console.log("\uD83D\uDCDD User Prompt: [Interactive mode - Claude will greet the user]"),console.log("");await zU(_.target,Y,z,_)}};import n from"node:fs/promises";import M0 from"node:path";import{spawn as sZ}from"node:child_process";class oZ{outputs=new Map;maxLines=5;addOutput(_,$){if(!this.outputs.has(_))this.outputs.set(_,[]);let X=this.outputs.get(_);if(X.push(...$.split(`
`).filter((Z)=>Z.trim())),X.length>this.maxLines)X.splice(0,X.length-this.maxLines)}display(){console.clear(),console.log(`\uD83E\uDD16 Agent Monitor - Real-time Output
`);for(let[_,$]of this.outputs)if($.length>0)console.log(`\uD83D\uDCCB ${_}:`),$.forEach((X)=>console.log(`   ${X}`)),console.log("")}}var D8=["craftsman","practitioner","craftsman-reflective","practitioner-reflective"];async function HU(_){if(!_.task)_.task="examples/benchmark-tasks/user-management-system.md";try{await n.access(_.task)}catch{throw new x(`Task file not found: ${_.task}`)}if(!_.output){let $=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);_.output=`/tmp/agent-benchmark-${$}`}if(!_.agents)_.agents="all";if(!_.context)_.context="";if(_.evaluate===void 0)_.evaluate=!0;if(!_.concurrency)_.concurrency=1;if(!_.delay)_.delay=2}async function WU(_){try{await n.mkdir(_,{recursive:!0}),console.log(`\uD83D\uDCC1 Created benchmark directory: ${_}`)}catch($){throw new x(`Failed to create benchmark directory: ${$}`)}}async function FU(_,$,X){let Z=await n.readFile(_,"utf-8");if(await n.writeFile(M0.join(X,"task-definition.txt"),Z),$)try{let J=await n.readFile($,"utf-8");await n.writeFile(M0.join(X,"context-info.txt"),J),console.log(`\uD83D\uDCC4 Copied context file: ${$}`)}catch(J){console.warn(`⚠️  Warning: Could not read context file: ${J}`)}console.log(`\uD83D\uDCCB Task definition copied from: ${_}`)}async function UU(_){if(_==="all")return D8;let $=_.split(",").map((X)=>X.trim());for(let X of $)if(!D8.includes(X))throw new x(`Invalid agent: ${X}. Available agents: ${D8.join(", ")}`);return $}async function nZ(_,$,X,Z,J,G=3){let Y=M0.join($,_);await n.mkdir(Y,{recursive:!0});let z=$_(),H=M0.join(z,`${_}.md`);try{let W=await n.readFile(H,"utf-8"),F=await n.readFile(X,"utf-8"),A=F;if(Z)try{A=`CONTEXT:
${await n.readFile(Z,"utf-8")}

TASK:
${F}`}catch(R){console.warn(`⚠️  Warning: Could not read context file: ${R}`)}A+=`

IMPORTANT: Please implement your solution in the current working directory: ${Y}
This is a temporary directory for testing, so you can create files freely without affecting any production codebase.`,console.log(`\uD83D\uDE80 Running agent: ${_} in ${Y}`),console.log(`\uD83D\uDCDD Claude command: claude --system-prompt [${W.length} chars] --dangerously-skip-permissions --print [${A.length} chars]`),await(async()=>{let R=M0.join(Y,".agent-prompt.md");return await n.writeFile(R,W),new Promise((D,N)=>{let Q=sZ("claude",["--system-prompt",`@${R}`,"--dangerously-skip-permissions","--print",A],{cwd:Y,stdio:["inherit","pipe","pipe"]}),w="",j="";Q.stdout?.on("data",(E)=>{let d=E.toString();w+=d,J?.addOutput(_,d),process.stdout.write(`[${_}] ${d}`)}),Q.stderr?.on("data",(E)=>{let d=E.toString();j+=d,J?.addOutput(_,`ERROR: ${d}`),process.stderr.write(`[${_} ERROR] ${d}`)}),Q.on("close",async(E)=>{try{await n.unlink(R)}catch(d){}if(E===0)await n.writeFile(M0.join(Y,"execution-log.txt"),w),console.log(`✅ Agent ${_} completed successfully`),D();else await n.writeFile(M0.join(Y,"execution-error.txt"),j),N(Error(`Agent ${_} failed with code ${E}`))}),Q.on("error",(E)=>{N(E)})})})()}catch(W){throw new x(`Failed to load agent ${_}: ${W}`)}}async function AU(_,$,X){console.log("\uD83D\uDD0D Evaluating code created by agents...");let Z=`
Please evaluate the code and solutions created by these four software engineering agents. For each agent, analyze their work by examining the files they created in their respective directories.

For each agent, evaluate:

1. **Code Quality** (1-10): Readability, structure, naming conventions, code organization
2. **Architecture Design** (1-10): Modularity, scalability, separation of concerns, best practices
3. **Functionality** (1-10): Requirements satisfaction, error handling, feature completeness
4. **Testing Coverage** (1-10): Test quality, coverage, testing strategies used
5. **Documentation** (1-10): Code comments, README files, API documentation, setup instructions
6. **Business Value** (1-10): Practicality, maintainability, innovation, solution effectiveness

Agents to evaluate:
- craftsman: Idealistic craftsman with principles-based approach
- practitioner: Pragmatic practitioner with business-focused approach
- craftsman-reflective: Idealistic craftsman with reflective questioning
- practitioner-reflective: Pragmatic practitioner with contextual decision-making

For each agent, please:
1. Examine all files they created in their directory
2. Analyze the code quality and architecture
3. Check if requirements were met
4. Evaluate the overall solution quality
5. Compare approaches between agents

Please provide:
1. Detailed scoring for each agent (1-10 scale)
2. Analysis of differences between approaches
3. What each agent excels at
4. Recommendations for different use cases
5. Overall comparison and insights

Format your response as a structured evaluation report with clear sections for each agent.
`,J=D8.map((A)=>M0.join(_,A)),G={};for(let A of J){let O=M0.basename(A);try{let R=await n.readdir(A),D=`=== ${O} WORK ===

`;for(let N of R){let Q=M0.join(A,N);if((await n.stat(Q)).isFile()){let j=await n.readFile(Q,"utf-8");D+=`
--- File: ${N} ---
${j}
`}}G[O]=D}catch(R){G[O]=`=== ${O} WORK ===

ERROR: Could not read files - ${R}`}}let Y=Object.values(G).join(`
`+"=".repeat(80)+`
`),z=Z+`

AGENT WORK TO EVALUATE:
`+Y,H=M0.join(_,".evaluation-prompt.md");await n.writeFile(H,z);let W=sZ("claude",["--system-prompt",`@${H}`,"--dangerously-skip-permissions","--print","Please evaluate the agent work as described in the system prompt."],{cwd:_,stdio:["inherit","pipe","pipe"]}),F="";return W.stdout?.on("data",(A)=>{F+=A.toString()}),new Promise((A,O)=>{W.on("close",async(R)=>{if(R===0){let D=M0.join(_,"evaluation-report.md");await n.writeFile(D,F);let N=Object.entries(G).map(([w,j])=>{let E=(j.match(/--- File: /g)||[]).length;return`${w}: ${E} files created`}).join(`
`),Q=M0.join(_,"summary.txt");await n.writeFile(Q,N);try{await n.unlink(H)}catch(w){}if(console.log("\uD83D\uDCCA Evaluation completed"),console.log(`\uD83D\uDCC4 Report saved to: ${D}`),$){let w=M0.join(process.cwd(),$,"evaluation-report.md"),j=M0.join(process.cwd(),$,"summary.txt");await n.mkdir(M0.dirname(w),{recursive:!0}),await n.writeFile(w,F),await n.writeFile(j,N),console.log(`\uD83D\uDCC4 Report also saved to: ${w}`)}console.log("\uD83D\uDCCB Summary of created files saved"),A()}else O(Error(`Evaluation failed with code ${R}`))}),W.on("error",(R)=>{O(R)})})}async function KU(_,$,X,Z,J,G){console.log(`\uD83D\uDD04 Running ${_.length} agents with concurrency: ${J}, delay: ${G}s`);let Y=new oZ;if(J<=1){console.log("\uD83D\uDCDD Running agents sequentially...");for(let z of _)try{if(await nZ(z,$,X,Z,Y),z!==_[_.length-1])Y.display(),console.log(`⏳ Waiting ${G}s before next agent...`),await new Promise((H)=>setTimeout(H,G*1000))}catch(H){Y.addOutput(z,`❌ ERROR: ${H}`),Y.display(),console.error(`❌ Agent ${z} failed:`,H)}}else{let z=[];for(let H=0;H<_.length;H+=J)z.push(_.slice(H,H+J));for(let H=0;H<z.length;H++){console.log(`\uD83D\uDD04 Running chunk ${H+1}/${z.length} (${z[H].length} agents)...`);let W=z[H].map((F)=>nZ(F,$,X,Z,Y));try{await Promise.all(W),Y.display(),console.log(`✅ Chunk ${H+1} completed`)}catch(F){Y.addOutput(`Chunk ${H+1}`,`❌ ERROR: ${F}`),Y.display(),console.error(`❌ Chunk ${H+1} had failures:`,F)}if(H<z.length-1)console.log(`⏳ Waiting ${G}s before next chunk...`),await new Promise((F)=>setTimeout(F,G*1000))}}Y.display(),console.log("✅ All agent executions completed")}var rZ={name:"benchmark",description:"Run benchmark tests comparing multiple agent designs",options:[{flags:"--agents <agents>",description:'Agents to test (comma-separated or "all")',defaultValue:"all"},{flags:"--task <file>",description:"Path to task definition file",defaultValue:"examples/benchmark-tasks/user-management-system.md"},{flags:"--output <dir>",description:"Output directory for results"},{flags:"--context <file>",description:"Path to context information file (optional)"},{flags:"--no-evaluate",description:"Skip LLM evaluation after agents complete"},{flags:"--report <dir>",description:"Directory to save evaluation reports",defaultValue:"benchmark-results"},{flags:"--concurrency <number>",description:"Number of agents to run concurrently",defaultValue:"1"},{flags:"--delay <seconds>",description:"Delay in seconds between agent executions",defaultValue:"2"}],handler:async(_)=>{try{await HU(_),console.log("\uD83C\uDFAF Starting agent benchmark test"),console.log(`\uD83D\uDCC1 Output directory: ${_.output}`),await WU(_.output),await FU(_.task,_.context,_.output);let $=await UU(_.agents);if(console.log(`\uD83E\uDD16 Testing agents: ${$.join(", ")}`),await KU($,_.output,_.task,_.context,_.concurrency,_.delay),_.evaluate)await AU(_.output,_.report,_);console.log("\uD83C\uDF89 Benchmark completed!"),console.log(`\uD83D\uDCC1 Results saved to: ${_.output}`)}catch($){throw new x(`Benchmark failed: ${$}`)}}};import j0 from"node:fs/promises";import A2 from"node:path";import{spawn as tZ}from"node:child_process";class eZ{status;uiProcess;constructor(_,$,X,Z){this.status={agents:[],totalAgents:_,completedAgents:0,outputDir:$,startTime:new Date,task:X,concurrency:Z}}async startUI(){this.uiProcess=tZ("node",["-e",`
      const { render } = require('ink');
      const React = require('react');
      const { Box, Text, useApp } = require('ink');

      const BenchmarkUI = () => {
        const [status, setStatus] = React.useState(null);
        const { exit } = useApp();

        React.useEffect(() => {
          const handleStdin = (data) => {
            try {
              const message = data.toString().trim();
              if (message.startsWith('BENCHMARK_STATUS:')) {
                const statusData = JSON.parse(message.substring(16));
                setStatus(statusData);
              }
            } catch (error) {
              // Ignore parsing errors
            }
          };

          process.stdin.on('data', handleStdin);
          return () => {
            process.stdin.off('data', handleStdin);
          };
        }, []);

        React.useEffect(() => {
          if (status && status.completedAgents === status.totalAgents) {
            setTimeout(() => exit(), 2000);
          }
        }, [status, exit]);

        if (!status) {
          return React.createElement(Box, { flexDirection: "column", padding: 1 }, [
            React.createElement(Text, { color: "cyan" }, "\uD83E\uDD16 Initializing Benchmark Terminal UI..."),
            React.createElement(Text, { color: "gray" }, "Waiting for benchmark to start...")
          ]);
        }

        const elapsed = Date.now() - new Date(status.startTime).getTime();
        const progressPercent = status.totalAgents > 0 ? (status.completedAgents / status.totalAgents) * 100 : 0;
        const progressBar = '█'.repeat(Math.floor(progressPercent / 10)) + '░'.repeat(10 - Math.floor(progressPercent / 10));

        return React.createElement(Box, { flexDirection: "column", padding: 1 }, [
          React.createElement(Box, { borderStyle: "single", padding: 1, marginBottom: 1 }, [
            React.createElement(Text, { color: "cyan", bold: true }, "\uD83C\uDFAF Agent Benchmark Monitor"),
            React.createElement(Text, { color: "gray" }, \`Task: \${status.task}\`),
            React.createElement(Text, { color: "gray" }, \`Output: \${status.outputDir}\`),
            React.createElement(Text, { color: "gray" }, \`Time: \${Math.floor(elapsed / 1000)}s\`)
          ]),
          React.createElement(Box, { marginBottom: 1 }, [
            React.createElement(Text, {}, \`Progress: \${progressBar} \${status.completedAgents}/\${status.totalAgents} (\${progressPercent.toFixed(1)}%)\`)
          ]),
          React.createElement(Box, { flexDirection: "column", gap: 1 }, [
            React.createElement(Text, { color: "white", bold: true }, "\uD83D\uDCCA Agent Status:"),
            ...status.agents.map(agent =>
              React.createElement(Box, { key: agent.name, borderStyle: "round", padding: 1 }, [
                React.createElement(Text, { bold: true },
                  \`\${agent.name} \${agent.status === 'completed' ? '✅' : agent.status === 'running' ? '\uD83D\uDD04' : agent.status === 'error' ? '❌' : '⏸️'}\`
                ),
                agent.output.length > 0 && React.createElement(Box, { flexDirection: "column", marginTop: 1 },
                  agent.output.slice(-3).map((line, i) =>
                    React.createElement(Text, { key: i, color: "gray", dimColor: true }, line)
                  )
                )
              ])
            )
          ]),
          React.createElement(Box, { marginTop: 1 }, [
            React.createElement(Text, {
              color: status.completedAgents === status.totalAgents ? "green" : "yellow",
              bold: true
            }, status.completedAgents === status.totalAgents ? "\uD83C\uDF89 Benchmark Completed!" : "\uD83D\uDD04 Running...")
          ])
        ]);
      };

      render(React.createElement(BenchmarkUI));
    `],{stdio:["pipe","pipe","pipe"]}),this.sendStatus()}sendStatus(){if(this.uiProcess&&this.uiProcess.stdin)this.uiProcess.stdin.write(`BENCHMARK_STATUS:${JSON.stringify(this.status)}
`)}addAgent(_){this.status.agents.push({name:_,status:"idle",output:[],progress:0}),this.sendStatus()}updateAgentStatus(_,$){let X=this.status.agents.find((Z)=>Z.name===_);if(X)Object.assign(X,$),this.sendStatus()}addAgentOutput(_,$){let X=this.status.agents.find((Z)=>Z.name===_);if(X){let Z=$.split(`
`).filter((J)=>J.trim());X.output=[...X.output.slice(-2),...Z],this.sendStatus()}}incrementCompleted(){this.status.completedAgents++,this.sendStatus()}async stop(){if(this.uiProcess)this.uiProcess.kill("SIGTERM"),await new Promise((_)=>setTimeout(_,500))}}async function OU(_){if(!_.task)_.task="examples/benchmark-tasks/simple-hello.md";try{await j0.access(_.task)}catch{throw new x(`Task file not found: ${_.task}`)}if(!_.output){let $=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);_.output=`/tmp/agent-benchmark-${$}`}if(!_.agents)_.agents="all";if(!_.context)_.context="";if(_.evaluate===void 0)_.evaluate=!0;if(!_.concurrency)_.concurrency=1;if(!_.delay)_.delay=2;if(_.ui===void 0)_.ui=!0}async function RU(_){try{await j0.mkdir(_,{recursive:!0}),console.log(`\uD83D\uDCC1 Created benchmark directory: ${_}`)}catch($){throw new x(`Failed to create benchmark directory: ${$}`)}}async function DU(_,$,X){let Z=await j0.readFile(_,"utf-8");if(await j0.writeFile(A2.join(X,"task-definition.txt"),Z),$)try{let J=await j0.readFile($,"utf-8");await j0.writeFile(A2.join(X,"context-info.txt"),J),console.log(`\uD83D\uDCC4 Copied context file: ${$}`)}catch(J){console.warn(`⚠️  Warning: Could not read context file: ${J}`)}console.log(`\uD83D\uDCCB Task definition copied from: ${_}`)}async function VU(_){let $=["craftsman","practitioner","craftsman-reflective","practitioner-reflective"];if(_==="all")return $;let X=_.split(",").map((Z)=>Z.trim());for(let Z of X)if(!$.includes(Z))throw new x(`Invalid agent: ${Z}. Available agents: ${$.join(", ")}`);return X}async function aZ(_,$,X,Z,J){let G=A2.join($,_);await j0.mkdir(G,{recursive:!0});let Y=$_(),z=A2.join(Y,`${_}.md`);try{let H=await j0.readFile(z,"utf-8"),W=await j0.readFile(X,"utf-8"),F=W;if(Z)try{F=`CONTEXT:
${await j0.readFile(Z,"utf-8")}

TASK:
${W}`}catch(O){console.warn(`⚠️  Warning: Could not read context file: ${O}`)}F+=`

IMPORTANT: Please implement your solution in the current working directory: ${G}
This is a temporary directory for testing, so you can create files freely without affecting any production codebase.`,console.log(`\uD83D\uDE80 Running agent: ${_} in ${G}`),J?.addAgent(_),J?.updateAgentStatus(_,{status:"running",startTime:Date.now()}),await(async()=>{let O=A2.join(G,".agent-prompt.md");return await j0.writeFile(O,H),new Promise((R,D)=>{let N=tZ("claude",["--system-prompt",`@${O}`,"--dangerously-skip-permissions","--print",F],{cwd:G,stdio:["inherit","pipe","pipe"]}),Q="",w="";N.stdout?.on("data",(j)=>{let E=j.toString();Q+=E,J?.addAgentOutput(_,E),process.stdout.write(`[${_}] ${E}`)}),N.stderr?.on("data",(j)=>{let E=j.toString();w+=E,J?.addAgentOutput(_,`ERROR: ${E}`),process.stderr.write(`[${_} ERROR] ${E}`)}),N.on("close",async(j)=>{try{await j0.unlink(O)}catch(E){}if(j===0)await j0.writeFile(A2.join(G,"execution-log.txt"),Q),console.log(`✅ Agent ${_} completed successfully`),J?.updateAgentStatus(_,{status:"completed",endTime:Date.now(),progress:100}),J?.incrementCompleted(),R();else await j0.writeFile(A2.join(G,"execution-error.txt"),w),J?.updateAgentStatus(_,{status:"error",endTime:Date.now(),progress:0}),D(Error(`Agent ${_} failed with code ${j}`))}),N.on("error",(j)=>{J?.updateAgentStatus(_,{status:"error",endTime:Date.now(),progress:0}),D(j)})})})()}catch(H){throw J?.updateAgentStatus(_,{status:"error",endTime:Date.now(),progress:0}),new x(`Failed to load agent ${_}: ${H}`)}}async function NU(_,$,X,Z,J,G,Y){if(console.log(`\uD83D\uDD04 Running ${_.length} agents with concurrency: ${J}, delay: ${G}s`),J<=1){console.log("\uD83D\uDCDD Running agents sequentially...");for(let z of _)try{if(await aZ(z,$,X,Z,Y),z!==_[_.length-1])console.log(`⏳ Waiting ${G}s before next agent...`),await new Promise((H)=>setTimeout(H,G*1000))}catch(H){console.error(`❌ Agent ${z} failed:`,H)}}else{let z=[];for(let H=0;H<_.length;H+=J)z.push(_.slice(H,H+J));for(let H=0;H<z.length;H++){console.log(`\uD83D\uDD04 Running chunk ${H+1}/${z.length} (${z[H].length} agents)...`);let W=z[H].map((F)=>aZ(F,$,X,Z,Y));try{await Promise.all(W),console.log(`✅ Chunk ${H+1} completed`)}catch(F){console.error(`❌ Chunk ${H+1} had failures:`,F)}if(H<z.length-1)console.log(`⏳ Waiting ${G}s before next chunk...`),await new Promise((F)=>setTimeout(F,G*1000))}}console.log("✅ All agent executions completed")}var _J={name:"benchmark-ui",description:"Run benchmark tests with enhanced terminal UI",options:[{flags:"--agents <agents>",description:'Agents to test (comma-separated or "all", default: all)',defaultValue:"all"},{flags:"--task <file>",description:"Path to task definition file",defaultValue:"examples/benchmark-tasks/simple-hello.md"},{flags:"--output <dir>",description:"Output directory for results"},{flags:"--context <file>",description:"Path to context information file (optional)"},{flags:"--no-evaluate",description:"Skip LLM evaluation after agents complete"},{flags:"--report <dir>",description:"Directory to save evaluation reports",defaultValue:"benchmark-results"},{flags:"--concurrency <number>",description:"Number of agents to run concurrently (default: 1)",defaultValue:"1"},{flags:"--delay <seconds>",description:"Delay in seconds between agent executions (default: 2)",defaultValue:"2"},{flags:"--no-ui",description:"Disable enhanced terminal UI"}],handler:async(_)=>{try{await OU(_),console.log("\uD83C\uDFAF Starting agent benchmark test with enhanced UI"),console.log(`\uD83D\uDCC1 Output directory: ${_.output}`),await RU(_.output),await DU(_.task,_.context,_.output);let $=await VU(_.agents);console.log(`\uD83E\uDD16 Testing agents: ${$.join(", ")}`);let X;if(_.ui!==!1)X=new eZ($.length,_.output,_.task,_.concurrency),await X.startUI(),console.log("\uD83D\uDDA5️ Terminal UI started");if(await NU($,_.output,_.task,_.context,_.concurrency,_.delay,X),_.evaluate)console.log("\uD83D\uDD0D Skipping evaluation in UI mode - evaluation will be available in a future update");if(X)console.log("⏳ Waiting 3 seconds before UI shutdown..."),await new Promise((Z)=>setTimeout(Z,3000)),await X.stop();console.log("\uD83C\uDF89 Benchmark completed!"),console.log(`\uD83D\uDCC1 Results saved to: ${_.output}`)}catch($){throw new x(`Benchmark failed: ${$}`)}}};function S5(_){let $=new B0(_.name);$.description(_.description);for(let X of _.options||[])$.option(X.flags,X.description,X.defaultValue);if(_.arguments)for(let X of _.arguments){let Z=X.name==="servers"?`[${X.name}...]`:X.required?`<${X.name}>`:`[${X.name}]`;$.argument(Z,X.description)}if(_.subcommands)for(let X of _.subcommands)$.addCommand(S5(X));if(_.handler){let X=$J(_.handler,_.name);if(_.validator)$.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,H)=>{if(H<J.length)Y[z.name]=J[H]});return _.validator?.(Y),X(Y)});else $.action((...Z)=>{let J=Z.slice(0,-1),Y=Z[Z.length-1].opts();if(_.arguments&&J.length>0)_.arguments.forEach((z,H)=>{if(H<J.length)Y[z.name]=J[H]});return X(Y)})}return $}var UL=[{flags:"--target <type>",description:"Force specific target"},{flags:"--verbose",description:"Show detailed output"},{flags:"--dry-run",description:"Show what would be done without making changes"},{flags:"--clear",description:"Clear obsolete items before processing"},{flags:"--mcp [servers...]",description:`Install MCP servers (${XJ().join(", ")})`}];function ZJ(){console.log("\uD83D\uDE80 Sylphx Flow CLI - Type-safe development flow"),console.log("========================================="),console.log(""),console.log("Available commands:"),console.log("  init     Initialize project with Sylphx Flow"),console.log("  mcp      Manage MCP tools"),console.log("  memory   Manage memory storage"),console.log("  tui      Interactive TUI for all operations"),console.log(""),console.log("Examples:"),console.log("  sylphx-flow init"),console.log("  sylphx-flow init --target opencode"),console.log("  sylphx-flow mcp install --all"),console.log("  sylphx-flow memory set key value"),console.log("  sylphx-flow tui"),console.log(""),console.log('Run "sylphx-flow <command> --help" for more information about a command.')}function MU(){let _=new B0;_.name("sylphx-flow").description("Sylphx Flow - Type-safe development flow CLI").version("1.0.0");let $=[hZ,fZ,bZ,iZ,rZ,_J];_.addCommand(IZ),_.addCommand(e2);for(let X of $)_.addCommand(S5(X));return _.command("tui").description("Launch interactive Sylphx Flow TUI").option("--target <type>","Target platform (opencode, default: auto-detect)").action(C5),_.action(()=>{ZJ()}),_}function JJ(){let _=MU();if(process.argv.length===2)_.help();process.on("uncaughtException",($)=>{console.error(`✗ Uncaught error: ${$.message}`),process.exit(1)}),process.on("unhandledRejection",($)=>{console.error(`✗ Unhandled rejection: ${$}`),process.exit(1)});try{_.parse()}catch($){console.error(`✗ Error: ${$.message}`),process.exit(1)}}JJ();
