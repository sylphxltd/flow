import{createRequire as HU}from"node:module";var KU=Object.create;var{getPrototypeOf:YU,defineProperty:tK,getOwnPropertyNames:GU}=Object;var XU=Object.prototype.hasOwnProperty;var nG=(J,Z,$)=>{$=J!=null?KU(YU(J)):{};let Q=Z||!J||!J.__esModule?tK($,"default",{value:J,enumerable:!0}):$;for(let W of GU(J))if(!XU.call(Q,W))tK(Q,W,{get:()=>J[W],enumerable:!0});return Q};var J6=(J,Z)=>()=>(Z||J((Z={exports:{}}).exports,Z),Z.exports);var qU=(J,Z)=>{for(var $ in Z)tK(J,$,{get:Z[$],enumerable:!0,configurable:!0,set:(Q)=>Z[$]=()=>Q})};var b6=HU(import.meta.url);var $Y=J6((NX)=>{Object.defineProperty(NX,"__esModule",{value:!0});NX.resolveBackendAndExecutionProviders=NX.registerBackend=void 0;var OZ=new Map,pJ=[],zU=(J,Z,$)=>{if(Z&&typeof Z.init==="function"&&typeof Z.createInferenceSessionHandler==="function"){let Q=OZ.get(J);if(Q===void 0)OZ.set(J,{backend:Z,priority:$});else if(Q.priority>$)return;else if(Q.priority===$){if(Q.backend!==Z)throw Error(`cannot register backend "${J}" using priority ${$}`)}if($>=0){let W=pJ.indexOf(J);if(W!==-1)pJ.splice(W,1);for(let Y=0;Y<pJ.length;Y++)if(OZ.get(pJ[Y]).priority<=$){pJ.splice(Y,0,J);return}pJ.push(J)}return}throw TypeError("not a valid backend")};NX.registerBackend=zU;var EU=async(J)=>{let Z=OZ.get(J);if(!Z)return"backend not found.";if(Z.initialized)return Z.backend;else if(Z.aborted)return Z.error;else{let $=!!Z.initPromise;try{if(!$)Z.initPromise=Z.backend.init(J);return await Z.initPromise,Z.initialized=!0,Z.backend}catch(Q){if(!$)Z.error=`${Q}`,Z.aborted=!0;return Z.error}finally{delete Z.initPromise}}},LU=async(J)=>{let Z=J.executionProviders||[],$=Z.map((q)=>typeof q==="string"?q:q.name),Q=$.length===0?pJ:$,W,Y=[],H=new Set;for(let q of Q){let z=await EU(q);if(typeof z==="string")Y.push({name:q,err:z});else{if(!W)W=z;if(W===z)H.add(q)}}if(!W)throw Error(`no available backend found. ERR: ${Y.map((q)=>`[${q.name}] ${q.err}`).join(", ")}`);for(let{name:q,err:z}of Y)if($.includes(q))console.warn(`removing requested execution provider "${q}" from session options because it is not available: ${z}`);let G=Z.filter((q)=>H.has(typeof q==="string"?q:q.name));return[W,new Proxy(J,{get:(q,z)=>{if(z==="executionProviders")return G;return Reflect.get(q,z)}})]};NX.resolveBackendAndExecutionProviders=LU});var EX=J6((ZY)=>{Object.defineProperty(ZY,"__esModule",{value:!0});ZY.registerBackend=void 0;var BU=$Y();Object.defineProperty(ZY,"registerBackend",{enumerable:!0,get:function(){return BU.registerBackend}})});var BX=J6((LX)=>{Object.defineProperty(LX,"__esModule",{value:!0});LX.version=void 0;LX.version="1.21.0"});var WY=J6((FX)=>{Object.defineProperty(FX,"__esModule",{value:!0});FX.env=void 0;var FU=BX(),RX="warning";FX.env={wasm:{},webgl:{},webgpu:{},versions:{common:FU.version},set logLevel(J){if(J===void 0)return;if(typeof J!=="string"||["verbose","info","warning","error","fatal"].indexOf(J)===-1)throw Error(`Unsupported logging level: ${J}`);RX=J},get logLevel(){return RX}};Object.defineProperty(FX.env,"logLevel",{enumerable:!0})});var wX=J6((DX)=>{Object.defineProperty(DX,"__esModule",{value:!0});DX.env=void 0;var DU=WY();DX.env=DU.env});var CX=J6((jX)=>{Object.defineProperty(jX,"__esModule",{value:!0});jX.tensorToImageData=jX.tensorToDataURL=void 0;var IU=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);$.width=J.dims[3],$.height=J.dims[2];let Q=$.getContext("2d");if(Q!=null){let W,Y;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")W=J.dims[2],Y=J.dims[3];else W=J.dims[3],Y=J.dims[2];let H=Z?.format!==void 0?Z.format:"RGB",G=Z?.norm,q,z;if(G===void 0||G.mean===void 0)q=[255,255,255,255];else if(typeof G.mean==="number")q=[G.mean,G.mean,G.mean,G.mean];else if(q=[G.mean[0],G.mean[1],G.mean[2],0],G.mean[3]!==void 0)q[3]=G.mean[3];if(G===void 0||G.bias===void 0)z=[0,0,0,0];else if(typeof G.bias==="number")z=[G.bias,G.bias,G.bias,G.bias];else if(z=[G.bias[0],G.bias[1],G.bias[2],0],G.bias[3]!==void 0)z[3]=G.bias[3];let U=Y*W,N=0,L=U,w=U*2,F=-1;if(H==="RGBA")N=0,L=U,w=U*2,F=U*3;else if(H==="RGB")N=0,L=U,w=U*2;else if(H==="RBG")N=0,w=U,L=U*2;for(let v=0;v<Y;v++)for(let I=0;I<W;I++){let j=(J.data[N++]-z[0])*q[0],y=(J.data[L++]-z[1])*q[1],g=(J.data[w++]-z[2])*q[2],A=F===-1?255:(J.data[F++]-z[3])*q[3];Q.fillStyle="rgba("+j+","+y+","+g+","+A+")",Q.fillRect(I,v,1,1)}if("toDataURL"in $)return $.toDataURL();else throw Error("toDataURL is not supported")}else throw Error("Can not access image data")};jX.tensorToDataURL=IU;var wU=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),Q;if($!=null){let W,Y,H;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")W=J.dims[2],Y=J.dims[1],H=J.dims[3];else W=J.dims[3],Y=J.dims[2],H=J.dims[1];let G=Z!==void 0?Z.format!==void 0?Z.format:"RGB":"RGB",q=Z?.norm,z,U;if(q===void 0||q.mean===void 0)z=[255,255,255,255];else if(typeof q.mean==="number")z=[q.mean,q.mean,q.mean,q.mean];else if(z=[q.mean[0],q.mean[1],q.mean[2],255],q.mean[3]!==void 0)z[3]=q.mean[3];if(q===void 0||q.bias===void 0)U=[0,0,0,0];else if(typeof q.bias==="number")U=[q.bias,q.bias,q.bias,q.bias];else if(U=[q.bias[0],q.bias[1],q.bias[2],0],q.bias[3]!==void 0)U[3]=q.bias[3];let N=Y*W;if(Z!==void 0){if(Z.format!==void 0&&H===4&&Z.format!=="RGBA"||H===3&&Z.format!=="RGB"&&Z.format!=="BGR")throw Error("Tensor format doesn't match input tensor dims")}let L=4,w=0,F=1,v=2,I=3,j=0,y=N,g=N*2,A=-1;if(G==="RGBA")j=0,y=N,g=N*2,A=N*3;else if(G==="RGB")j=0,y=N,g=N*2;else if(G==="RBG")j=0,g=N,y=N*2;Q=$.createImageData(W,Y);for(let T=0;T<Y*W;w+=L,F+=L,v+=L,I+=L,T++)Q.data[w]=(J.data[j++]-U[0])*z[0],Q.data[F]=(J.data[y++]-U[1])*z[1],Q.data[v]=(J.data[g++]-U[2])*z[2],Q.data[I]=A===-1?255:(J.data[A++]-U[3])*z[3]}else throw Error("Can not access image data");return Q};jX.tensorToImageData=wU});var TX=J6((SX)=>{Object.defineProperty(SX,"__esModule",{value:!0});SX.tensorFromPinnedBuffer=SX.tensorFromMLTensor=SX.tensorFromGpuBuffer=SX.tensorFromTexture=SX.tensorFromImage=SX.bufferToTensor=void 0;var W5=hZ(),PU=(J,Z)=>{if(J===void 0)throw Error("Image buffer must be defined");if(Z.height===void 0||Z.width===void 0)throw Error("Image height and width must be defined");if(Z.tensorLayout==="NHWC")throw Error("NHWC Tensor layout is not supported yet");let{height:$,width:Q}=Z,W=Z.norm??{mean:255,bias:0},Y,H;if(typeof W.mean==="number")Y=[W.mean,W.mean,W.mean,W.mean];else Y=[W.mean[0],W.mean[1],W.mean[2],W.mean[3]??255];if(typeof W.bias==="number")H=[W.bias,W.bias,W.bias,W.bias];else H=[W.bias[0],W.bias[1],W.bias[2],W.bias[3]??0];let G=Z.format!==void 0?Z.format:"RGBA",q=Z.tensorFormat!==void 0?Z.tensorFormat!==void 0?Z.tensorFormat:"RGB":"RGB",z=$*Q,U=q==="RGBA"?new Float32Array(z*4):new Float32Array(z*3),N=4,L=0,w=1,F=2,v=3,I=0,j=z,y=z*2,g=-1;if(G==="RGB")N=3,L=0,w=1,F=2,v=-1;if(q==="RGBA")g=z*3;else if(q==="RBG")I=0,y=z,j=z*2;else if(q==="BGR")y=0,j=z,I=z*2;for(let T=0;T<z;T++,L+=N,F+=N,w+=N,v+=N)if(U[I++]=(J[L]+H[0])/Y[0],U[j++]=(J[w]+H[1])/Y[1],U[y++]=(J[F]+H[2])/Y[2],g!==-1&&v!==-1)U[g++]=(J[v]+H[3])/Y[3];return q==="RGBA"?new W5.Tensor("float32",U,[1,4,$,Q]):new W5.Tensor("float32",U,[1,3,$,Q])};SX.bufferToTensor=PU;var CU=async(J,Z)=>{let $=typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement,Q=typeof ImageData<"u"&&J instanceof ImageData,W=typeof ImageBitmap<"u"&&J instanceof ImageBitmap,Y=typeof J==="string",H,G=Z??{},q=()=>{if(typeof document<"u")return document.createElement("canvas");else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);else throw Error("Canvas is not supported")},z=(U)=>{if(typeof HTMLCanvasElement<"u"&&U instanceof HTMLCanvasElement)return U.getContext("2d");else if(U instanceof OffscreenCanvas)return U.getContext("2d");else return null};if($){let U=q();U.width=J.width,U.height=J.height;let N=z(U);if(N!=null){let{height:L,width:w}=J;if(Z!==void 0&&Z.resizedHeight!==void 0&&Z.resizedWidth!==void 0)L=Z.resizedHeight,w=Z.resizedWidth;if(Z!==void 0){if(G=Z,Z.tensorFormat!==void 0)throw Error("Image input config format must be RGBA for HTMLImageElement");else G.tensorFormat="RGBA";G.height=L,G.width=w}else G.tensorFormat="RGBA",G.height=L,G.width=w;N.drawImage(J,0,0),H=N.getImageData(0,0,w,L).data}else throw Error("Can not access image data")}else if(Q){let U,N;if(Z!==void 0&&Z.resizedWidth!==void 0&&Z.resizedHeight!==void 0)U=Z.resizedHeight,N=Z.resizedWidth;else U=J.height,N=J.width;if(Z!==void 0)G=Z;if(G.format="RGBA",G.height=U,G.width=N,Z!==void 0){let L=q();L.width=N,L.height=U;let w=z(L);if(w!=null)w.putImageData(J,0,0),H=w.getImageData(0,0,N,U).data;else throw Error("Can not access image data")}else H=J.data}else if(W){if(Z===void 0)throw Error("Please provide image config with format for Imagebitmap");let U=q();U.width=J.width,U.height=J.height;let N=z(U);if(N!=null){let{height:L,width:w}=J;return N.drawImage(J,0,0,w,L),H=N.getImageData(0,0,w,L).data,G.height=L,G.width=w,SX.bufferToTensor(H,G)}else throw Error("Can not access image data")}else if(Y)return new Promise((U,N)=>{let L=q(),w=z(L);if(!J||!w)return N();let F=new Image;F.crossOrigin="Anonymous",F.src=J,F.onload=()=>{L.width=F.width,L.height=F.height,w.drawImage(F,0,0,L.width,L.height);let v=w.getImageData(0,0,L.width,L.height);G.height=L.height,G.width=L.width,U(SX.bufferToTensor(v.data,G))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(H!==void 0)return SX.bufferToTensor(H,G);else throw Error("Input data provided is not supported - aborted tensor creation")};SX.tensorFromImage=CU;var SU=(J,Z)=>{let{width:$,height:Q,download:W,dispose:Y}=Z,H=[1,Q,$,4];return new W5.Tensor({location:"texture",type:"float32",texture:J,dims:H,download:W,dispose:Y})};SX.tensorFromTexture=SU;var MU=(J,Z)=>{let{dataType:$,dims:Q,download:W,dispose:Y}=Z;return new W5.Tensor({location:"gpu-buffer",type:$??"float32",gpuBuffer:J,dims:Q,download:W,dispose:Y})};SX.tensorFromGpuBuffer=MU;var TU=(J,Z)=>{let{dataType:$,dims:Q,download:W,dispose:Y}=Z;return new W5.Tensor({location:"ml-tensor",type:$??"float32",mlTensor:J,dims:Q,download:W,dispose:Y})};SX.tensorFromMLTensor=TU;var _U=(J,Z,$)=>new W5.Tensor({location:"cpu-pinned",type:J,data:Z,dims:$??[Z.length]});SX.tensorFromPinnedBuffer=_U});var yX=J6((kX)=>{Object.defineProperty(kX,"__esModule",{value:!0});kX.checkTypedArray=kX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=kX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=void 0;kX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]);kX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);var _X=!1,OU=()=>{if(!_X){_X=!0;let J=typeof BigInt64Array<"u"&&BigInt64Array.from,Z=typeof BigUint64Array<"u"&&BigUint64Array.from,$=globalThis.Float16Array,Q=typeof $<"u"&&$.from;if(J)kX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("int64",BigInt64Array),kX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigInt64Array,"int64");if(Z)kX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("uint64",BigUint64Array),kX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigUint64Array,"uint64");if(Q)kX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("float16",$),kX.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set($,"float16");else kX.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("float16",Uint16Array)}};kX.checkTypedArray=OU});var bX=J6((vX)=>{Object.defineProperty(vX,"__esModule",{value:!0});vX.tensorReshape=vX.calculateSize=void 0;var f5=hZ(),bU=(J)=>{let Z=1;for(let $=0;$<J.length;$++){let Q=J[$];if(typeof Q!=="number"||!Number.isSafeInteger(Q))throw TypeError(`dims[${$}] must be an integer, got: ${Q}`);if(Q<0)throw RangeError(`dims[${$}] must be a non-negative integer, got: ${Q}`);Z*=Q}return Z};vX.calculateSize=bU;var hU=(J,Z)=>{switch(J.location){case"cpu":return new f5.Tensor(J.type,J.data,Z);case"cpu-pinned":return new f5.Tensor({location:"cpu-pinned",data:J.data,type:J.type,dims:Z});case"texture":return new f5.Tensor({location:"texture",texture:J.texture,type:J.type,dims:Z});case"gpu-buffer":return new f5.Tensor({location:"gpu-buffer",gpuBuffer:J.gpuBuffer,type:J.type,dims:Z});case"ml-tensor":return new f5.Tensor({location:"ml-tensor",mlTensor:J.mlTensor,type:J.type,dims:Z});default:throw Error(`tensorReshape: tensor location ${J.location} is not supported`)}};vX.tensorReshape=hU});var hZ=J6((uX)=>{Object.defineProperty(uX,"__esModule",{value:!0});uX.Tensor=void 0;var hX=CX(),d5=TX(),dZ=yX(),fX=bX();class dX{constructor(J,Z,$){(0,dZ.checkTypedArray)();let Q,W;if(typeof J==="object"&&"location"in J)switch(this.dataLocation=J.location,Q=J.type,W=J.dims,J.location){case"cpu-pinned":{let H=dZ.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(Q);if(!H)throw TypeError(`unsupported type "${Q}" to create tensor from pinned buffer`);if(!(J.data instanceof H))throw TypeError(`buffer should be of type ${H.name}`);this.cpuData=J.data;break}case"texture":{if(Q!=="float32")throw TypeError(`unsupported type "${Q}" to create tensor from texture`);this.gpuTextureData=J.texture,this.downloader=J.download,this.disposer=J.dispose;break}case"gpu-buffer":{if(Q!=="float32"&&Q!=="float16"&&Q!=="int32"&&Q!=="int64"&&Q!=="uint32"&&Q!=="uint8"&&Q!=="bool"&&Q!=="uint4"&&Q!=="int4")throw TypeError(`unsupported type "${Q}" to create tensor from gpu buffer`);this.gpuBufferData=J.gpuBuffer,this.downloader=J.download,this.disposer=J.dispose;break}case"ml-tensor":{if(Q!=="float32"&&Q!=="float16"&&Q!=="int32"&&Q!=="int64"&&Q!=="uint32"&&Q!=="uint64"&&Q!=="int8"&&Q!=="uint8"&&Q!=="bool"&&Q!=="uint4"&&Q!=="int4")throw TypeError(`unsupported type "${Q}" to create tensor from MLTensor`);this.mlTensorData=J.mlTensor,this.downloader=J.download,this.disposer=J.dispose;break}default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let H,G;if(typeof J==="string")if(Q=J,G=$,J==="string"){if(!Array.isArray(Z))throw TypeError("A string tensor's data must be a string array.");H=Z}else{let q=dZ.NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(J);if(q===void 0)throw TypeError(`Unsupported tensor type: ${J}.`);if(Array.isArray(Z))if(J==="float16"&&q===Uint16Array||J==="uint4"||J==="int4")throw TypeError(`Creating a ${J} tensor from number array is not supported. Please use ${q.name} as data.`);else if(J==="uint64"||J==="int64")H=q.from(Z,BigInt);else H=q.from(Z);else if(Z instanceof q)H=Z;else if(Z instanceof Uint8ClampedArray)if(J==="uint8")H=Uint8Array.from(Z);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(J==="float16"&&Z instanceof Uint16Array&&q!==Uint16Array)H=new globalThis.Float16Array(Z.buffer,Z.byteOffset,Z.length);else throw TypeError(`A ${Q} tensor's data must be type of ${q}`)}else if(G=Z,Array.isArray(J)){if(J.length===0)throw TypeError("Tensor type cannot be inferred from an empty array.");let q=typeof J[0];if(q==="string")Q="string",H=J;else if(q==="boolean")Q="bool",H=Uint8Array.from(J);else throw TypeError(`Invalid element type of data array: ${q}.`)}else if(J instanceof Uint8ClampedArray)Q="uint8",H=Uint8Array.from(J);else{let q=dZ.NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.get(J.constructor);if(q===void 0)throw TypeError(`Unsupported type for tensor data: ${J.constructor}.`);Q=q,H=J}if(G===void 0)G=[H.length];else if(!Array.isArray(G))throw TypeError("A tensor's dims must be a number array");W=G,this.cpuData=H,this.dataLocation="cpu"}let Y=(0,fX.calculateSize)(W);if(this.cpuData&&Y!==this.cpuData.length)if((Q==="uint4"||Q==="int4")&&Math.ceil(Y/2)===this.cpuData.length);else throw Error(`Tensor's size(${Y}) does not match data length(${this.cpuData.length}).`);this.type=Q,this.dims=W,this.size=Y}static async fromImage(J,Z){return(0,d5.tensorFromImage)(J,Z)}static fromTexture(J,Z){return(0,d5.tensorFromTexture)(J,Z)}static fromGpuBuffer(J,Z){return(0,d5.tensorFromGpuBuffer)(J,Z)}static fromMLTensor(J,Z){return(0,d5.tensorFromMLTensor)(J,Z)}static fromPinnedBuffer(J,Z,$){return(0,d5.tensorFromPinnedBuffer)(J,Z,$)}toDataURL(J){return(0,hX.tensorToDataURL)(this,J)}toImageData(J){return(0,hX.tensorToImageData)(this,J)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(J){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let Z=await this.downloader();if(this.downloader=void 0,this.dataLocation="cpu",this.cpuData=Z,J&&this.disposer)this.disposer(),this.disposer=void 0;return Z}finally{this.isDownloading=!1}}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");if(this.disposer)this.disposer(),this.disposer=void 0;this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw Error("The tensor is disposed.")}reshape(J){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return(0,fX.tensorReshape)(this,J)}}uX.Tensor=dX});var KY=J6((lX)=>{Object.defineProperty(lX,"__esModule",{value:!0});lX.Tensor=void 0;var dU=hZ();lX.Tensor=dU.Tensor});var YY=J6((aX)=>{Object.defineProperty(aX,"__esModule",{value:!0});aX.TRACE_FUNC_END=aX.TRACE_FUNC_BEGIN=aX.TRACE=void 0;var zJ=WY(),uU=(J,Z)=>{if(typeof zJ.env.trace>"u"?!zJ.env.wasm.trace:!zJ.env.trace)return;console.timeStamp(`${J}::ORT::${Z}`)};aX.TRACE=uU;var mX=(J,Z)=>{let $=Error().stack?.split(/\r\n|\r|\n/g)||[],Q=!1;for(let W=0;W<$.length;W++){if(Q&&!$[W].includes("TRACE_FUNC")){let Y=`FUNC_${J}::${$[W].trim().split(" ")[1]}`;if(Z)Y+=`::${Z}`;aX.TRACE("CPU",Y);return}if($[W].includes("TRACE_FUNC"))Q=!0}},gU=(J)=>{if(typeof zJ.env.trace>"u"?!zJ.env.wasm.trace:!zJ.env.trace)return;mX("BEGIN",J)};aX.TRACE_FUNC_BEGIN=gU;var lU=(J)=>{if(typeof zJ.env.trace>"u"?!zJ.env.wasm.trace:!zJ.env.trace)return;mX("END",J)};aX.TRACE_FUNC_END=lU});var sX=J6((eX)=>{Object.defineProperty(eX,"__esModule",{value:!0});eX.InferenceSession=void 0;var mU=$Y(),u5=KY(),uZ=YY();class GY{constructor(J){this.handler=J}async run(J,Z,$){(0,uZ.TRACE_FUNC_BEGIN)();let Q={},W={};if(typeof J!=="object"||J===null||J instanceof u5.Tensor||Array.isArray(J))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let Y=!0;if(typeof Z==="object"){if(Z===null)throw TypeError("Unexpected argument[1]: cannot be null.");if(Z instanceof u5.Tensor)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(Z)){if(Z.length===0)throw TypeError("'fetches' cannot be an empty array.");Y=!1;for(let q of Z){if(typeof q!=="string")throw TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(q)===-1)throw RangeError(`'fetches' contains invalid output name: ${q}.`);Q[q]=null}if(typeof $==="object"&&$!==null)W=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else{let q=!1,z=Object.getOwnPropertyNames(Z);for(let U of this.outputNames)if(z.indexOf(U)!==-1){let N=Z[U];if(N===null||N instanceof u5.Tensor)q=!0,Y=!1,Q[U]=N}if(q){if(typeof $==="object"&&$!==null)W=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else W=Z}}else if(typeof Z<"u")throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let q of this.inputNames)if(typeof J[q]>"u")throw Error(`input '${q}' is missing in 'feeds'.`);if(Y)for(let q of this.outputNames)Q[q]=null;let H=await this.handler.run(J,Q,W),G={};for(let q in H)if(Object.hasOwnProperty.call(H,q)){let z=H[q];if(z instanceof u5.Tensor)G[q]=z;else G[q]=new u5.Tensor(z.type,z.data,z.dims)}return(0,uZ.TRACE_FUNC_END)(),G}async release(){return this.handler.dispose()}static async create(J,Z,$,Q){(0,uZ.TRACE_FUNC_BEGIN)();let W,Y={};if(typeof J==="string"){if(W=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof Uint8Array){if(W=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&J instanceof SharedArrayBuffer){let z=J,U=0,N=J.byteLength;if(typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z==="number"){if(U=Z,!Number.isSafeInteger(U))throw RangeError("'byteOffset' must be an integer.");if(U<0||U>=z.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${z.byteLength}).`);if(N=J.byteLength-U,typeof $==="number"){if(N=$,!Number.isSafeInteger(N))throw RangeError("'byteLength' must be an integer.");if(N<=0||U+N>z.byteLength)throw RangeError(`'byteLength' is out of range (0, ${z.byteLength-U}].`);if(typeof Q==="object"&&Q!==null)Y=Q;else if(typeof Q<"u")throw TypeError("'options' must be an object.")}else if(typeof $<"u")throw TypeError("'byteLength' must be a number.")}else if(typeof Z<"u")throw TypeError("'options' must be an object.");W=new Uint8Array(z,U,N)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[H,G]=await(0,mU.resolveBackendAndExecutionProviders)(Y),q=await H.createInferenceSessionHandler(W,G);return(0,uZ.TRACE_FUNC_END)(),new GY(q)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}eX.InferenceSession=GY});var oX=J6((iX)=>{Object.defineProperty(iX,"__esModule",{value:!0});iX.InferenceSession=void 0;var aU=sX();iX.InferenceSession=aU.InferenceSession});var $q=J6((Jq)=>{Object.defineProperty(Jq,"__esModule",{value:!0})});var Qq=J6((Zq)=>{Object.defineProperty(Zq,"__esModule",{value:!0})});var Kq=J6((Wq)=>{Object.defineProperty(Wq,"__esModule",{value:!0})});var Gq=J6((Yq)=>{Object.defineProperty(Yq,"__esModule",{value:!0})});var gZ=J6((L4)=>{var pU=L4&&L4.__createBinding||(Object.create?function(J,Z,$,Q){if(Q===void 0)Q=$;var W=Object.getOwnPropertyDescriptor(Z,$);if(!W||("get"in W?!Z.__esModule:W.writable||W.configurable))W={enumerable:!0,get:function(){return Z[$]}};Object.defineProperty(J,Q,W)}:function(J,Z,$,Q){if(Q===void 0)Q=$;J[Q]=Z[$]}),EJ=L4&&L4.__exportStar||function(J,Z){for(var $ in J)if($!=="default"&&!Object.prototype.hasOwnProperty.call(Z,$))pU(Z,J,$)};Object.defineProperty(L4,"__esModule",{value:!0});EJ(EX(),L4);EJ(wX(),L4);EJ(oX(),L4);EJ(KY(),L4);EJ($q(),L4);EJ(Qq(),L4);EJ(YY(),L4);EJ(Kq(),L4);EJ(Gq(),L4)});var Uq=J6((qq)=>{Object.defineProperty(qq,"__esModule",{value:!0});qq.initOrt=qq.binding=void 0;var lZ=gZ();qq.binding=b6(`../bin/napi-v3/${process.platform}/${process.arch}/onnxruntime_binding.node`);var Xq=!1,rU=()=>{if(!Xq){Xq=!0;let J=2;if(lZ.env.logLevel)switch(lZ.env.logLevel){case"verbose":J=0;break;case"info":J=1;break;case"warning":J=2;break;case"error":J=3;break;case"fatal":J=4;break;default:throw Error(`Unsupported log level: ${lZ.env.logLevel}`)}qq.binding.initOrtOnce(J,lZ.Tensor)}};qq.initOrt=rU});var qY=J6((s4)=>{var eU=s4&&s4.__classPrivateFieldSet||function(J,Z,$,Q,W){if(Q==="m")throw TypeError("Private method is not writable");if(Q==="a"&&!W)throw TypeError("Private accessor was defined without a setter");if(typeof Z==="function"?J!==Z||!W:!Z.has(J))throw TypeError("Cannot write private member to an object whose class did not declare it");return Q==="a"?W.call(J,$):W?W.value=$:Z.set(J,$),$},rJ=s4&&s4.__classPrivateFieldGet||function(J,Z,$,Q){if($==="a"&&!Q)throw TypeError("Private accessor was defined without a getter");if(typeof Z==="function"?J!==Z||!Q:!Z.has(J))throw TypeError("Cannot read private member from an object whose class did not declare it");return $==="m"?Q:$==="a"?Q.call(J):Q?Q.value:Z.get(J)},n4;Object.defineProperty(s4,"__esModule",{value:!0});s4.listSupportedBackends=s4.onnxruntimeBackend=void 0;var XY=Uq();class Nq{constructor(J,Z){if(n4.set(this,void 0),(0,XY.initOrt)(),eU(this,n4,new XY.binding.InferenceSession,"f"),typeof J==="string")rJ(this,n4,"f").loadModel(J,Z);else rJ(this,n4,"f").loadModel(J.buffer,J.byteOffset,J.byteLength,Z);this.inputNames=rJ(this,n4,"f").inputNames,this.outputNames=rJ(this,n4,"f").outputNames}async dispose(){rJ(this,n4,"f").dispose()}startProfiling(){}endProfiling(){rJ(this,n4,"f").endProfiling()}async run(J,Z,$){return new Promise((Q,W)=>{setImmediate(()=>{try{Q(rJ(this,n4,"f").run(J,Z,$))}catch(Y){W(Y)}})})}}n4=new WeakMap;class zq{async init(){return Promise.resolve()}async createInferenceSessionHandler(J,Z){return new Promise(($,Q)=>{setImmediate(()=>{try{$(new Nq(J,Z||{}))}catch(W){Q(W)}})})}}s4.onnxruntimeBackend=new zq;s4.listSupportedBackends=XY.binding.listSupportedBackends});var Aq=J6((Eq)=>{Object.defineProperty(Eq,"__esModule",{value:!0});Eq.version=void 0;Eq.version="1.21.0"});var Fq=J6((LJ)=>{var nU=LJ&&LJ.__createBinding||(Object.create?function(J,Z,$,Q){if(Q===void 0)Q=$;var W=Object.getOwnPropertyDescriptor(Z,$);if(!W||("get"in W?!Z.__esModule:W.writable||W.configurable))W={enumerable:!0,get:function(){return Z[$]}};Object.defineProperty(J,Q,W)}:function(J,Z,$,Q){if(Q===void 0)Q=$;J[Q]=Z[$]}),sU=LJ&&LJ.__exportStar||function(J,Z){for(var $ in J)if($!=="default"&&!Object.prototype.hasOwnProperty.call(Z,$))nU(Z,J,$)};Object.defineProperty(LJ,"__esModule",{value:!0});LJ.listSupportedBackends=void 0;sU(gZ(),LJ);var iU=qY();Object.defineProperty(LJ,"listSupportedBackends",{enumerable:!0,get:function(){return iU.listSupportedBackends}});var Bq=gZ(),tU=Aq(),Rq=qY(),oU=(0,Rq.listSupportedBackends)();for(let J of oU)(0,Bq.registerBackend)(J.name,Rq.onnxruntimeBackend,100);Object.defineProperty(Bq.env.versions,"node",{value:tU.version,enumerable:!0})});var i4=J6((bA,Iq)=>{var Dq=function(J){return typeof J<"u"&&J!==null},JN=function(J){return typeof J==="object"},$N=function(J){return Object.prototype.toString.call(J)==="[object Object]"},ZN=function(J){return typeof J==="function"},QN=function(J){return typeof J==="boolean"},WN=function(J){return J instanceof Buffer},KN=function(J){if(Dq(J))switch(J.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},YN=function(J){return J instanceof ArrayBuffer},GN=function(J){return typeof J==="string"&&J.length>0},XN=function(J){return typeof J==="number"&&!Number.isNaN(J)},qN=function(J){return Number.isInteger(J)},HN=function(J,Z,$){return J>=Z&&J<=$},VN=function(J,Z){return Z.includes(J)},UN=function(J,Z,$){return Error(`Expected ${Z} for ${J} but received ${$} of type ${typeof $}`)},NN=function(J,Z){return Z.message=J.message,Z};Iq.exports={defined:Dq,object:JN,plainObject:$N,fn:ZN,bool:QN,buffer:WN,typedArray:KN,arrayBuffer:YN,string:GN,number:XN,integer:qN,inRange:HN,inArray:VN,invalidParameterError:UN,nativeError:NN}});var Pq=J6((hA,jq)=>{var wq=()=>process.platform==="linux",cZ=null,zN=()=>{if(!cZ)if(wq()&&process.report){let J=process.report.excludeNetwork;process.report.excludeNetwork=!0,cZ=process.report.getReport(),process.report.excludeNetwork=J}else cZ={};return cZ};jq.exports={isLinux:wq,getReport:zN}});var Sq=J6((fA,Cq)=>{var K5=b6("fs"),EN=(J)=>{let Z=K5.openSync(J,"r"),$=Buffer.alloc(2048),Q=K5.readSync(Z,$,0,2048,0);return K5.close(Z,()=>{}),$.subarray(0,Q)},LN=(J)=>new Promise((Z,$)=>{K5.open(J,"r",(Q,W)=>{if(Q)$(Q);else{let Y=Buffer.alloc(2048);K5.read(W,Y,0,2048,0,(H,G)=>{Z(Y.subarray(0,G)),K5.close(W,()=>{})})}})});Cq.exports={LDD_PATH:"/usr/bin/ldd",SELF_PATH:"/proc/self/exe",readFileSync:EN,readFile:LN}});var Tq=J6((dA,Mq)=>{var AN=(J)=>{if(J.length<64)return null;if(J.readUInt32BE(0)!==2135247942)return null;if(J.readUInt8(4)!==2)return null;if(J.readUInt8(5)!==1)return null;let Z=J.readUInt32LE(32),$=J.readUInt16LE(54),Q=J.readUInt16LE(56);for(let W=0;W<Q;W++){let Y=Z+W*$;if(J.readUInt32LE(Y)===3){let G=J.readUInt32LE(Y+8),q=J.readUInt32LE(Y+32);return J.subarray(G,G+q).toString().replace(/\0.*$/g,"")}}return null};Mq.exports={interpreterPath:AN}});var aZ=J6((uA,pq)=>{var kq=b6("child_process"),{isLinux:Y5,getReport:xq}=Pq(),{LDD_PATH:mZ,SELF_PATH:yq,readFile:HY,readFileSync:VY}=Sq(),{interpreterPath:vq}=Tq(),t4,o4,JJ,PJ="",Oq=()=>{if(!PJ)return new Promise((J)=>{kq.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",(Z,$)=>{PJ=Z?" ":$,J(PJ)})});return PJ},bq=()=>{if(!PJ)try{PJ=kq.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch(J){PJ=" "}return PJ},AJ="glibc",hq=/LIBC[a-z0-9 \-).]*?(\d+\.\d+)/i,eJ="musl",BN=(J)=>J.includes("libc.musl-")||J.includes("ld-musl-"),fq=()=>{let J=xq();if(J.header&&J.header.glibcVersionRuntime)return AJ;if(Array.isArray(J.sharedObjects)){if(J.sharedObjects.some(BN))return eJ}return null},dq=(J)=>{let[Z,$]=J.split(/[\r\n]+/);if(Z&&Z.includes(AJ))return AJ;if($&&$.includes(eJ))return eJ;return null},uq=(J)=>{if(J){if(J.includes("/ld-musl-"))return eJ;else if(J.includes("/ld-linux-"))return AJ}return null},gq=(J)=>{if(J=J.toString(),J.includes("musl"))return eJ;if(J.includes("GNU C Library"))return AJ;return null},RN=async()=>{if(o4!==void 0)return o4;o4=null;try{let J=await HY(mZ);o4=gq(J)}catch(J){}return o4},FN=()=>{if(o4!==void 0)return o4;o4=null;try{let J=VY(mZ);o4=gq(J)}catch(J){}return o4},DN=async()=>{if(t4!==void 0)return t4;t4=null;try{let J=await HY(yq),Z=vq(J);t4=uq(Z)}catch(J){}return t4},IN=()=>{if(t4!==void 0)return t4;t4=null;try{let J=VY(yq),Z=vq(J);t4=uq(Z)}catch(J){}return t4},lq=async()=>{let J=null;if(Y5()){if(J=await DN(),!J){if(J=await RN(),!J)J=fq();if(!J){let Z=await Oq();J=dq(Z)}}}return J},cq=()=>{let J=null;if(Y5()){if(J=IN(),!J){if(J=FN(),!J)J=fq();if(!J){let Z=bq();J=dq(Z)}}}return J},wN=async()=>Y5()&&await lq()!==AJ,jN=()=>Y5()&&cq()!==AJ,PN=async()=>{if(JJ!==void 0)return JJ;JJ=null;try{let Z=(await HY(mZ)).match(hq);if(Z)JJ=Z[1]}catch(J){}return JJ},CN=()=>{if(JJ!==void 0)return JJ;JJ=null;try{let Z=VY(mZ).match(hq);if(Z)JJ=Z[1]}catch(J){}return JJ},mq=()=>{let J=xq();if(J.header&&J.header.glibcVersionRuntime)return J.header.glibcVersionRuntime;return null},_q=(J)=>J.trim().split(/\s+/)[1],aq=(J)=>{let[Z,$,Q]=J.split(/[\r\n]+/);if(Z&&Z.includes(AJ))return _q(Z);if($&&Q&&$.includes(eJ))return _q(Q);return null},SN=async()=>{let J=null;if(Y5()){if(J=await PN(),!J)J=mq();if(!J){let Z=await Oq();J=aq(Z)}}return J},MN=()=>{let J=null;if(Y5()){if(J=CN(),!J)J=mq();if(!J){let Z=bq();J=aq(Z)}}return J};pq.exports={GLIBC:AJ,MUSL:eJ,family:lq,familySync:cq,isNonGlibcLinux:wN,isNonGlibcLinuxSync:jN,version:SN,versionSync:MN}});var g5=J6((gA,rq)=>{var TN=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...J)=>console.error("SEMVER",...J):()=>{};rq.exports=TN});var pZ=J6((lA,eq)=>{var _N=Number.MAX_SAFE_INTEGER||9007199254740991,kN=["major","premajor","minor","preminor","patch","prepatch","prerelease"];eq.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:_N,RELEASE_TYPES:kN,SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var l5=J6(($J,nq)=>{var{MAX_SAFE_COMPONENT_LENGTH:UY,MAX_SAFE_BUILD_LENGTH:xN,MAX_LENGTH:yN}=pZ(),vN=g5();$J=nq.exports={};var ON=$J.re=[],bN=$J.safeRe=[],r0=$J.src=[],hN=$J.safeSrc=[],e0=$J.t={},fN=0,NY="[a-zA-Z0-9-]",dN=[["\\s",1],["\\d",yN],[NY,xN]],uN=(J)=>{for(let[Z,$]of dN)J=J.split(`${Z}*`).join(`${Z}{0,${$}}`).split(`${Z}+`).join(`${Z}{1,${$}}`);return J},z6=(J,Z,$)=>{let Q=uN(Z),W=fN++;vN(J,W,Z),e0[J]=W,r0[W]=Z,hN[W]=Q,ON[W]=new RegExp(Z,$?"g":void 0),bN[W]=new RegExp(Q,$?"g":void 0)};z6("NUMERICIDENTIFIER","0|[1-9]\\d*");z6("NUMERICIDENTIFIERLOOSE","\\d+");z6("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${NY}*`);z6("MAINVERSION",`(${r0[e0.NUMERICIDENTIFIER]})\\.(${r0[e0.NUMERICIDENTIFIER]})\\.(${r0[e0.NUMERICIDENTIFIER]})`);z6("MAINVERSIONLOOSE",`(${r0[e0.NUMERICIDENTIFIERLOOSE]})\\.(${r0[e0.NUMERICIDENTIFIERLOOSE]})\\.(${r0[e0.NUMERICIDENTIFIERLOOSE]})`);z6("PRERELEASEIDENTIFIER",`(?:${r0[e0.NONNUMERICIDENTIFIER]}|${r0[e0.NUMERICIDENTIFIER]})`);z6("PRERELEASEIDENTIFIERLOOSE",`(?:${r0[e0.NONNUMERICIDENTIFIER]}|${r0[e0.NUMERICIDENTIFIERLOOSE]})`);z6("PRERELEASE",`(?:-(${r0[e0.PRERELEASEIDENTIFIER]}(?:\\.${r0[e0.PRERELEASEIDENTIFIER]})*))`);z6("PRERELEASELOOSE",`(?:-?(${r0[e0.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r0[e0.PRERELEASEIDENTIFIERLOOSE]})*))`);z6("BUILDIDENTIFIER",`${NY}+`);z6("BUILD",`(?:\\+(${r0[e0.BUILDIDENTIFIER]}(?:\\.${r0[e0.BUILDIDENTIFIER]})*))`);z6("FULLPLAIN",`v?${r0[e0.MAINVERSION]}${r0[e0.PRERELEASE]}?${r0[e0.BUILD]}?`);z6("FULL",`^${r0[e0.FULLPLAIN]}$`);z6("LOOSEPLAIN",`[v=\\s]*${r0[e0.MAINVERSIONLOOSE]}${r0[e0.PRERELEASELOOSE]}?${r0[e0.BUILD]}?`);z6("LOOSE",`^${r0[e0.LOOSEPLAIN]}$`);z6("GTLT","((?:<|>)?=?)");z6("XRANGEIDENTIFIERLOOSE",`${r0[e0.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);z6("XRANGEIDENTIFIER",`${r0[e0.NUMERICIDENTIFIER]}|x|X|\\*`);z6("XRANGEPLAIN",`[v=\\s]*(${r0[e0.XRANGEIDENTIFIER]})(?:\\.(${r0[e0.XRANGEIDENTIFIER]})(?:\\.(${r0[e0.XRANGEIDENTIFIER]})(?:${r0[e0.PRERELEASE]})?${r0[e0.BUILD]}?)?)?`);z6("XRANGEPLAINLOOSE",`[v=\\s]*(${r0[e0.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r0[e0.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r0[e0.XRANGEIDENTIFIERLOOSE]})(?:${r0[e0.PRERELEASELOOSE]})?${r0[e0.BUILD]}?)?)?`);z6("XRANGE",`^${r0[e0.GTLT]}\\s*${r0[e0.XRANGEPLAIN]}$`);z6("XRANGELOOSE",`^${r0[e0.GTLT]}\\s*${r0[e0.XRANGEPLAINLOOSE]}$`);z6("COERCEPLAIN",`(^|[^\\d])(\\d{1,${UY}})(?:\\.(\\d{1,${UY}}))?(?:\\.(\\d{1,${UY}}))?`);z6("COERCE",`${r0[e0.COERCEPLAIN]}(?:$|[^\\d])`);z6("COERCEFULL",r0[e0.COERCEPLAIN]+`(?:${r0[e0.PRERELEASE]})?(?:${r0[e0.BUILD]})?(?:$|[^\\d])`);z6("COERCERTL",r0[e0.COERCE],!0);z6("COERCERTLFULL",r0[e0.COERCEFULL],!0);z6("LONETILDE","(?:~>?)");z6("TILDETRIM",`(\\s*)${r0[e0.LONETILDE]}\\s+`,!0);$J.tildeTrimReplace="$1~";z6("TILDE",`^${r0[e0.LONETILDE]}${r0[e0.XRANGEPLAIN]}$`);z6("TILDELOOSE",`^${r0[e0.LONETILDE]}${r0[e0.XRANGEPLAINLOOSE]}$`);z6("LONECARET","(?:\\^)");z6("CARETTRIM",`(\\s*)${r0[e0.LONECARET]}\\s+`,!0);$J.caretTrimReplace="$1^";z6("CARET",`^${r0[e0.LONECARET]}${r0[e0.XRANGEPLAIN]}$`);z6("CARETLOOSE",`^${r0[e0.LONECARET]}${r0[e0.XRANGEPLAINLOOSE]}$`);z6("COMPARATORLOOSE",`^${r0[e0.GTLT]}\\s*(${r0[e0.LOOSEPLAIN]})$|^$`);z6("COMPARATOR",`^${r0[e0.GTLT]}\\s*(${r0[e0.FULLPLAIN]})$|^$`);z6("COMPARATORTRIM",`(\\s*)${r0[e0.GTLT]}\\s*(${r0[e0.LOOSEPLAIN]}|${r0[e0.XRANGEPLAIN]})`,!0);$J.comparatorTrimReplace="$1$2$3";z6("HYPHENRANGE",`^\\s*(${r0[e0.XRANGEPLAIN]})\\s+-\\s+(${r0[e0.XRANGEPLAIN]})\\s*$`);z6("HYPHENRANGELOOSE",`^\\s*(${r0[e0.XRANGEPLAINLOOSE]})\\s+-\\s+(${r0[e0.XRANGEPLAINLOOSE]})\\s*$`);z6("STAR","(<|>)?=?\\s*\\*");z6("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");z6("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var rZ=J6((cA,sq)=>{var gN=Object.freeze({loose:!0}),lN=Object.freeze({}),cN=(J)=>{if(!J)return lN;if(typeof J!=="object")return gN;return J};sq.exports=cN});var JH=J6((mA,oq)=>{var iq=/^[0-9]+$/,tq=(J,Z)=>{if(typeof J==="number"&&typeof Z==="number")return J===Z?0:J<Z?-1:1;let $=iq.test(J),Q=iq.test(Z);if($&&Q)J=+J,Z=+Z;return J===Z?0:$&&!Q?-1:Q&&!$?1:J<Z?-1:1},mN=(J,Z)=>tq(Z,J);oq.exports={compareIdentifiers:tq,rcompareIdentifiers:mN}});var G5=J6((aA,ZH)=>{var eZ=g5(),{MAX_LENGTH:$H,MAX_SAFE_INTEGER:nZ}=pZ(),{safeRe:sZ,t:iZ}=l5(),aN=rZ(),{compareIdentifiers:zY}=JH();class u4{constructor(J,Z){if(Z=aN(Z),J instanceof u4)if(J.loose===!!Z.loose&&J.includePrerelease===!!Z.includePrerelease)return J;else J=J.version;else if(typeof J!=="string")throw TypeError(`Invalid version. Must be a string. Got type "${typeof J}".`);if(J.length>$H)throw TypeError(`version is longer than ${$H} characters`);eZ("SemVer",J,Z),this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease;let $=J.trim().match(Z.loose?sZ[iZ.LOOSE]:sZ[iZ.FULL]);if(!$)throw TypeError(`Invalid Version: ${J}`);if(this.raw=J,this.major=+$[1],this.minor=+$[2],this.patch=+$[3],this.major>nZ||this.major<0)throw TypeError("Invalid major version");if(this.minor>nZ||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>nZ||this.patch<0)throw TypeError("Invalid patch version");if(!$[4])this.prerelease=[];else this.prerelease=$[4].split(".").map((Q)=>{if(/^[0-9]+$/.test(Q)){let W=+Q;if(W>=0&&W<nZ)return W}return Q});this.build=$[5]?$[5].split("."):[],this.format()}format(){if(this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length)this.version+=`-${this.prerelease.join(".")}`;return this.version}toString(){return this.version}compare(J){if(eZ("SemVer.compare",this.version,this.options,J),!(J instanceof u4)){if(typeof J==="string"&&J===this.version)return 0;J=new u4(J,this.options)}if(J.version===this.version)return 0;return this.compareMain(J)||this.comparePre(J)}compareMain(J){if(!(J instanceof u4))J=new u4(J,this.options);if(this.major<J.major)return-1;if(this.major>J.major)return 1;if(this.minor<J.minor)return-1;if(this.minor>J.minor)return 1;if(this.patch<J.patch)return-1;if(this.patch>J.patch)return 1;return 0}comparePre(J){if(!(J instanceof u4))J=new u4(J,this.options);if(this.prerelease.length&&!J.prerelease.length)return-1;else if(!this.prerelease.length&&J.prerelease.length)return 1;else if(!this.prerelease.length&&!J.prerelease.length)return 0;let Z=0;do{let $=this.prerelease[Z],Q=J.prerelease[Z];if(eZ("prerelease compare",Z,$,Q),$===void 0&&Q===void 0)return 0;else if(Q===void 0)return 1;else if($===void 0)return-1;else if($===Q)continue;else return zY($,Q)}while(++Z)}compareBuild(J){if(!(J instanceof u4))J=new u4(J,this.options);let Z=0;do{let $=this.build[Z],Q=J.build[Z];if(eZ("build compare",Z,$,Q),$===void 0&&Q===void 0)return 0;else if(Q===void 0)return 1;else if($===void 0)return-1;else if($===Q)continue;else return zY($,Q)}while(++Z)}inc(J,Z,$){if(J.startsWith("pre")){if(!Z&&$===!1)throw Error("invalid increment argument: identifier is empty");if(Z){let Q=`-${Z}`.match(this.options.loose?sZ[iZ.PRERELEASELOOSE]:sZ[iZ.PRERELEASE]);if(!Q||Q[1]!==Z)throw Error(`invalid identifier: ${Z}`)}}switch(J){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",Z,$);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",Z,$);break;case"prepatch":this.prerelease.length=0,this.inc("patch",Z,$),this.inc("pre",Z,$);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",Z,$);this.inc("pre",Z,$);break;case"release":if(this.prerelease.length===0)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0,this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":{let Q=Number($)?1:0;if(this.prerelease.length===0)this.prerelease=[Q];else{let W=this.prerelease.length;while(--W>=0)if(typeof this.prerelease[W]==="number")this.prerelease[W]++,W=-2;if(W===-1){if(Z===this.prerelease.join(".")&&$===!1)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(Q)}}if(Z){let W=[Z,Q];if($===!1)W=[Z];if(zY(this.prerelease[0],Z)===0){if(isNaN(this.prerelease[1]))this.prerelease=W}else this.prerelease=W}break}default:throw Error(`invalid increment argument: ${J}`)}if(this.raw=this.format(),this.build.length)this.raw+=`+${this.build.join(".")}`;return this}}ZH.exports=u4});var KH=J6((pA,WH)=>{var QH=G5(),pN=(J,Z,$=!1)=>{if(J instanceof QH)return J;try{return new QH(J,Z)}catch(Q){if(!$)return null;throw Q}};WH.exports=pN});var GH=J6((rA,YH)=>{var rN=G5(),eN=KH(),{safeRe:tZ,t:oZ}=l5(),nN=(J,Z)=>{if(J instanceof rN)return J;if(typeof J==="number")J=String(J);if(typeof J!=="string")return null;Z=Z||{};let $=null;if(!Z.rtl)$=J.match(Z.includePrerelease?tZ[oZ.COERCEFULL]:tZ[oZ.COERCE]);else{let q=Z.includePrerelease?tZ[oZ.COERCERTLFULL]:tZ[oZ.COERCERTL],z;while((z=q.exec(J))&&(!$||$.index+$[0].length!==J.length)){if(!$||z.index+z[0].length!==$.index+$[0].length)$=z;q.lastIndex=z.index+z[1].length+z[2].length}q.lastIndex=-1}if($===null)return null;let Q=$[2],W=$[3]||"0",Y=$[4]||"0",H=Z.includePrerelease&&$[5]?`-${$[5]}`:"",G=Z.includePrerelease&&$[6]?`+${$[6]}`:"";return eN(`${Q}.${W}.${Y}${H}${G}`,Z)};YH.exports=nN});var nJ=J6((eA,qH)=>{var XH=G5(),sN=(J,Z,$)=>new XH(J,$).compare(new XH(Z,$));qH.exports=sN});var EY=J6((nA,HH)=>{var iN=nJ(),tN=(J,Z,$)=>iN(J,Z,$)>=0;HH.exports=tN});var NH=J6((sA,UH)=>{class VH{constructor(){this.max=1000,this.map=new Map}get(J){let Z=this.map.get(J);if(Z===void 0)return;else return this.map.delete(J),this.map.set(J,Z),Z}delete(J){return this.map.delete(J)}set(J,Z){if(!this.delete(J)&&Z!==void 0){if(this.map.size>=this.max){let Q=this.map.keys().next().value;this.delete(Q)}this.map.set(J,Z)}return this}}UH.exports=VH});var EH=J6((iA,zH)=>{var oN=nJ(),Jz=(J,Z,$)=>oN(J,Z,$)===0;zH.exports=Jz});var AH=J6((tA,LH)=>{var $z=nJ(),Zz=(J,Z,$)=>$z(J,Z,$)!==0;LH.exports=Zz});var RH=J6((oA,BH)=>{var Qz=nJ(),Wz=(J,Z,$)=>Qz(J,Z,$)>0;BH.exports=Wz});var DH=J6((JB,FH)=>{var Kz=nJ(),Yz=(J,Z,$)=>Kz(J,Z,$)<0;FH.exports=Yz});var wH=J6(($B,IH)=>{var Gz=nJ(),Xz=(J,Z,$)=>Gz(J,Z,$)<=0;IH.exports=Xz});var PH=J6((ZB,jH)=>{var qz=EH(),Hz=AH(),Vz=RH(),Uz=EY(),Nz=DH(),zz=wH(),Ez=(J,Z,$,Q)=>{switch(Z){case"===":if(typeof J==="object")J=J.version;if(typeof $==="object")$=$.version;return J===$;case"!==":if(typeof J==="object")J=J.version;if(typeof $==="object")$=$.version;return J!==$;case"":case"=":case"==":return qz(J,$,Q);case"!=":return Hz(J,$,Q);case">":return Vz(J,$,Q);case">=":return Uz(J,$,Q);case"<":return Nz(J,$,Q);case"<=":return zz(J,$,Q);default:throw TypeError(`Invalid operator: ${Z}`)}};jH.exports=Ez});var xH=J6((QB,kH)=>{var c5=Symbol("SemVer ANY");class J8{static get ANY(){return c5}constructor(J,Z){if(Z=CH(Z),J instanceof J8)if(J.loose===!!Z.loose)return J;else J=J.value;if(J=J.trim().split(/\s+/).join(" "),AY("comparator",J,Z),this.options=Z,this.loose=!!Z.loose,this.parse(J),this.semver===c5)this.value="";else this.value=this.operator+this.semver.version;AY("comp",this)}parse(J){let Z=this.options.loose?SH[MH.COMPARATORLOOSE]:SH[MH.COMPARATOR],$=J.match(Z);if(!$)throw TypeError(`Invalid comparator: ${J}`);if(this.operator=$[1]!==void 0?$[1]:"",this.operator==="=")this.operator="";if(!$[2])this.semver=c5;else this.semver=new TH($[2],this.options.loose)}toString(){return this.value}test(J){if(AY("Comparator.test",J,this.options.loose),this.semver===c5||J===c5)return!0;if(typeof J==="string")try{J=new TH(J,this.options)}catch(Z){return!1}return LY(J,this.operator,this.semver,this.options)}intersects(J,Z){if(!(J instanceof J8))throw TypeError("a Comparator is required");if(this.operator===""){if(this.value==="")return!0;return new _H(J.value,Z).test(this.value)}else if(J.operator===""){if(J.value==="")return!0;return new _H(this.value,Z).test(J.semver)}if(Z=CH(Z),Z.includePrerelease&&(this.value==="<0.0.0-0"||J.value==="<0.0.0-0"))return!1;if(!Z.includePrerelease&&(this.value.startsWith("<0.0.0")||J.value.startsWith("<0.0.0")))return!1;if(this.operator.startsWith(">")&&J.operator.startsWith(">"))return!0;if(this.operator.startsWith("<")&&J.operator.startsWith("<"))return!0;if(this.semver.version===J.semver.version&&this.operator.includes("=")&&J.operator.includes("="))return!0;if(LY(this.semver,"<",J.semver,Z)&&this.operator.startsWith(">")&&J.operator.startsWith("<"))return!0;if(LY(this.semver,">",J.semver,Z)&&this.operator.startsWith("<")&&J.operator.startsWith(">"))return!0;return!1}}kH.exports=J8;var CH=rZ(),{safeRe:SH,t:MH}=l5(),LY=PH(),AY=g5(),TH=G5(),_H=BY()});var BY=J6((WB,bH)=>{var Lz=/\s+/g;class m5{constructor(J,Z){if(Z=Bz(Z),J instanceof m5)if(J.loose===!!Z.loose&&J.includePrerelease===!!Z.includePrerelease)return J;else return new m5(J.raw,Z);if(J instanceof RY)return this.raw=J.value,this.set=[[J]],this.formatted=void 0,this;if(this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease,this.raw=J.trim().replace(Lz," "),this.set=this.raw.split("||").map(($)=>this.parseRange($.trim())).filter(($)=>$.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let $=this.set[0];if(this.set=this.set.filter((Q)=>!vH(Q[0])),this.set.length===0)this.set=[$];else if(this.set.length>1){for(let Q of this.set)if(Q.length===1&&Pz(Q[0])){this.set=[Q];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let J=0;J<this.set.length;J++){if(J>0)this.formatted+="||";let Z=this.set[J];for(let $=0;$<Z.length;$++){if($>0)this.formatted+=" ";this.formatted+=Z[$].toString().trim()}}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(J){let $=((this.options.includePrerelease&&wz)|(this.options.loose&&jz))+":"+J,Q=yH.get($);if(Q)return Q;let W=this.options.loose,Y=W?A4[q4.HYPHENRANGELOOSE]:A4[q4.HYPHENRANGE];J=J.replace(Y,Oz(this.options.includePrerelease)),_6("hyphen replace",J),J=J.replace(A4[q4.COMPARATORTRIM],Fz),_6("comparator trim",J),J=J.replace(A4[q4.TILDETRIM],Dz),_6("tilde trim",J),J=J.replace(A4[q4.CARETTRIM],Iz),_6("caret trim",J);let H=J.split(" ").map((U)=>Cz(U,this.options)).join(" ").split(/\s+/).map((U)=>vz(U,this.options));if(W)H=H.filter((U)=>{return _6("loose invalid filter",U,this.options),!!U.match(A4[q4.COMPARATORLOOSE])});_6("range list",H);let G=new Map,q=H.map((U)=>new RY(U,this.options));for(let U of q){if(vH(U))return[U];G.set(U.value,U)}if(G.size>1&&G.has(""))G.delete("");let z=[...G.values()];return yH.set($,z),z}intersects(J,Z){if(!(J instanceof m5))throw TypeError("a Range is required");return this.set.some(($)=>{return OH($,Z)&&J.set.some((Q)=>{return OH(Q,Z)&&$.every((W)=>{return Q.every((Y)=>{return W.intersects(Y,Z)})})})})}test(J){if(!J)return!1;if(typeof J==="string")try{J=new Rz(J,this.options)}catch(Z){return!1}for(let Z=0;Z<this.set.length;Z++)if(bz(this.set[Z],J,this.options))return!0;return!1}}bH.exports=m5;var Az=NH(),yH=new Az,Bz=rZ(),RY=xH(),_6=g5(),Rz=G5(),{safeRe:A4,t:q4,comparatorTrimReplace:Fz,tildeTrimReplace:Dz,caretTrimReplace:Iz}=l5(),{FLAG_INCLUDE_PRERELEASE:wz,FLAG_LOOSE:jz}=pZ(),vH=(J)=>J.value==="<0.0.0-0",Pz=(J)=>J.value==="",OH=(J,Z)=>{let $=!0,Q=J.slice(),W=Q.pop();while($&&Q.length)$=Q.every((Y)=>{return W.intersects(Y,Z)}),W=Q.pop();return $},Cz=(J,Z)=>{return J=J.replace(A4[q4.BUILD],""),_6("comp",J,Z),J=Tz(J,Z),_6("caret",J),J=Sz(J,Z),_6("tildes",J),J=kz(J,Z),_6("xrange",J),J=yz(J,Z),_6("stars",J),J},B4=(J)=>!J||J.toLowerCase()==="x"||J==="*",Sz=(J,Z)=>{return J.trim().split(/\s+/).map(($)=>Mz($,Z)).join(" ")},Mz=(J,Z)=>{let $=Z.loose?A4[q4.TILDELOOSE]:A4[q4.TILDE];return J.replace($,(Q,W,Y,H,G)=>{_6("tilde",J,Q,W,Y,H,G);let q;if(B4(W))q="";else if(B4(Y))q=`>=${W}.0.0 <${+W+1}.0.0-0`;else if(B4(H))q=`>=${W}.${Y}.0 <${W}.${+Y+1}.0-0`;else if(G)_6("replaceTilde pr",G),q=`>=${W}.${Y}.${H}-${G} <${W}.${+Y+1}.0-0`;else q=`>=${W}.${Y}.${H} <${W}.${+Y+1}.0-0`;return _6("tilde return",q),q})},Tz=(J,Z)=>{return J.trim().split(/\s+/).map(($)=>_z($,Z)).join(" ")},_z=(J,Z)=>{_6("caret",J,Z);let $=Z.loose?A4[q4.CARETLOOSE]:A4[q4.CARET],Q=Z.includePrerelease?"-0":"";return J.replace($,(W,Y,H,G,q)=>{_6("caret",J,W,Y,H,G,q);let z;if(B4(Y))z="";else if(B4(H))z=`>=${Y}.0.0${Q} <${+Y+1}.0.0-0`;else if(B4(G))if(Y==="0")z=`>=${Y}.${H}.0${Q} <${Y}.${+H+1}.0-0`;else z=`>=${Y}.${H}.0${Q} <${+Y+1}.0.0-0`;else if(q)if(_6("replaceCaret pr",q),Y==="0")if(H==="0")z=`>=${Y}.${H}.${G}-${q} <${Y}.${H}.${+G+1}-0`;else z=`>=${Y}.${H}.${G}-${q} <${Y}.${+H+1}.0-0`;else z=`>=${Y}.${H}.${G}-${q} <${+Y+1}.0.0-0`;else if(_6("no pr"),Y==="0")if(H==="0")z=`>=${Y}.${H}.${G}${Q} <${Y}.${H}.${+G+1}-0`;else z=`>=${Y}.${H}.${G}${Q} <${Y}.${+H+1}.0-0`;else z=`>=${Y}.${H}.${G} <${+Y+1}.0.0-0`;return _6("caret return",z),z})},kz=(J,Z)=>{return _6("replaceXRanges",J,Z),J.split(/\s+/).map(($)=>xz($,Z)).join(" ")},xz=(J,Z)=>{J=J.trim();let $=Z.loose?A4[q4.XRANGELOOSE]:A4[q4.XRANGE];return J.replace($,(Q,W,Y,H,G,q)=>{_6("xRange",J,Q,W,Y,H,G,q);let z=B4(Y),U=z||B4(H),N=U||B4(G),L=N;if(W==="="&&L)W="";if(q=Z.includePrerelease?"-0":"",z)if(W===">"||W==="<")Q="<0.0.0-0";else Q="*";else if(W&&L){if(U)H=0;if(G=0,W===">")if(W=">=",U)Y=+Y+1,H=0,G=0;else H=+H+1,G=0;else if(W==="<=")if(W="<",U)Y=+Y+1;else H=+H+1;if(W==="<")q="-0";Q=`${W+Y}.${H}.${G}${q}`}else if(U)Q=`>=${Y}.0.0${q} <${+Y+1}.0.0-0`;else if(N)Q=`>=${Y}.${H}.0${q} <${Y}.${+H+1}.0-0`;return _6("xRange return",Q),Q})},yz=(J,Z)=>{return _6("replaceStars",J,Z),J.trim().replace(A4[q4.STAR],"")},vz=(J,Z)=>{return _6("replaceGTE0",J,Z),J.trim().replace(A4[Z.includePrerelease?q4.GTE0PRE:q4.GTE0],"")},Oz=(J)=>(Z,$,Q,W,Y,H,G,q,z,U,N,L)=>{if(B4(Q))$="";else if(B4(W))$=`>=${Q}.0.0${J?"-0":""}`;else if(B4(Y))$=`>=${Q}.${W}.0${J?"-0":""}`;else if(H)$=`>=${$}`;else $=`>=${$}${J?"-0":""}`;if(B4(z))q="";else if(B4(U))q=`<${+z+1}.0.0-0`;else if(B4(N))q=`<${z}.${+U+1}.0-0`;else if(L)q=`<=${z}.${U}.${N}-${L}`;else if(J)q=`<${z}.${U}.${+N+1}-0`;else q=`<=${q}`;return`${$} ${q}`.trim()},bz=(J,Z,$)=>{for(let Q=0;Q<J.length;Q++)if(!J[Q].test(Z))return!1;if(Z.prerelease.length&&!$.includePrerelease){for(let Q=0;Q<J.length;Q++){if(_6(J[Q].semver),J[Q].semver===RY.ANY)continue;if(J[Q].semver.prerelease.length>0){let W=J[Q].semver;if(W.major===Z.major&&W.minor===Z.minor&&W.patch===Z.patch)return!0}}return!1}return!0}});var fH=J6((KB,hH)=>{var hz=BY(),fz=(J,Z,$)=>{try{Z=new hz(Z,$)}catch(Q){return!1}return Z.test(J)};hH.exports=fz});var FY=J6((YB,dz)=>{dz.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.34.4",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://sharp.pixelplumbing.com",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unnebck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix Bnemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","Jrmy Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kotovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Choucio <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugu <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com>","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>","Dennis Beatty <dennis@dcbeatty.com>","Ingvar Stepanyan <me@rreverser.com>","Don Denton <don@happycollision.com>"],scripts:{install:"node install/check.js",clean:"rm -rf src/build/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run test-lint && npm run test-unit && npm run test-licensing && npm run test-types","test-lint":"semistandard && cpplint","test-unit":"nyc --reporter=lcov --reporter=text --check-coverage --branches=100 mocha","test-licensing":'license-checker --production --summary --onlyAllow="Apache-2.0;BSD;ISC;LGPL-3.0-or-later;MIT"',"test-leak":"./test/leak/leak.sh","test-types":"tsd","package-from-local-build":"node npm/from-local-build.js","package-release-notes":"node npm/release-notes.js","docs-build":"node docs/build.mjs","docs-serve":"cd docs && npm start","docs-publish":"cd docs && npm run build && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},type:"commonjs",main:"lib/index.js",types:"lib/index.d.ts",files:["install","lib","src/*.{cc,h,gyp}"],repository:{type:"git",url:"git://github.com/lovell/sharp.git"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{"@img/colour":"^1.0.0","detect-libc":"^2.1.0",semver:"^7.7.2"},optionalDependencies:{"@img/sharp-darwin-arm64":"0.34.4","@img/sharp-darwin-x64":"0.34.4","@img/sharp-libvips-darwin-arm64":"1.2.3","@img/sharp-libvips-darwin-x64":"1.2.3","@img/sharp-libvips-linux-arm":"1.2.3","@img/sharp-libvips-linux-arm64":"1.2.3","@img/sharp-libvips-linux-ppc64":"1.2.3","@img/sharp-libvips-linux-s390x":"1.2.3","@img/sharp-libvips-linux-x64":"1.2.3","@img/sharp-libvips-linuxmusl-arm64":"1.2.3","@img/sharp-libvips-linuxmusl-x64":"1.2.3","@img/sharp-linux-arm":"0.34.4","@img/sharp-linux-arm64":"0.34.4","@img/sharp-linux-ppc64":"0.34.4","@img/sharp-linux-s390x":"0.34.4","@img/sharp-linux-x64":"0.34.4","@img/sharp-linuxmusl-arm64":"0.34.4","@img/sharp-linuxmusl-x64":"0.34.4","@img/sharp-wasm32":"0.34.4","@img/sharp-win32-arm64":"0.34.4","@img/sharp-win32-ia32":"0.34.4","@img/sharp-win32-x64":"0.34.4"},devDependencies:{"@emnapi/runtime":"^1.5.0","@img/sharp-libvips-dev":"1.2.3","@img/sharp-libvips-dev-wasm32":"1.2.3","@img/sharp-libvips-win32-arm64":"1.2.3","@img/sharp-libvips-win32-ia32":"1.2.3","@img/sharp-libvips-win32-x64":"1.2.3","@types/node":"*",cc:"^3.0.1",emnapi:"^1.5.0","exif-reader":"^2.0.2","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^9.1.2","license-checker":"^25.0.1",mocha:"^11.7.2","node-addon-api":"^8.5.0","node-gyp":"^11.4.2",nyc:"^17.1.0",semistandard:"^17.0.0","tar-fs":"^3.1.1",tsd:"^0.33.0"},license:"Apache-2.0",engines:{node:"^18.17.0 || ^20.3.0 || >=21.0.0"},config:{libvips:">=8.17.2"},funding:{url:"https://opencollective.com/libvips"},semistandard:{env:["mocha"]},cc:{linelength:"120",filter:["build/include"]},nyc:{include:["lib"]},tsd:{directory:"test/types/"}}});var IY=J6((GB,eH)=>{var{spawnSync:$8}=b6("node:child_process"),{createHash:uz}=b6("node:crypto"),lH=GH(),gz=EY(),lz=fH(),dH=aZ(),{config:cz,engines:uH,optionalDependencies:mz}=FY(),az=process.env.npm_package_config_libvips||cz.libvips,cH=lH(az).version,pz=["darwin-arm64","darwin-x64","linux-arm","linux-arm64","linux-ppc64","linux-s390x","linux-x64","linuxmusl-arm64","linuxmusl-x64","win32-arm64","win32-ia32","win32-x64"],Z8={encoding:"utf8",shell:!0},rz=(J)=>{if(J instanceof Error)console.error(`sharp: Installation error: ${J.message}`);else console.log(`sharp: ${J}`)},mH=()=>dH.isNonGlibcLinuxSync()?dH.familySync():"",ez=()=>`${process.platform}${mH()}-${process.arch}`,X5=()=>{if(aH())return"wasm32";let{npm_config_arch:J,npm_config_platform:Z,npm_config_libc:$}=process.env,Q=typeof $==="string"?$:mH();return`${Z||process.platform}${Q}-${J||process.arch}`},nz=()=>{try{return b6(`@img/sharp-libvips-dev-${X5()}/include`)}catch{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/include");})()}catch{}}return""},sz=()=>{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/cplusplus");})()}catch{}return""},iz=()=>{try{return b6(`@img/sharp-libvips-dev-${X5()}/lib`)}catch{try{return b6(`@img/sharp-libvips-${X5()}/lib`)}catch{}}return""},tz=()=>{if(process.release?.name==="node"&&process.versions){if(!lz(process.versions.node,uH.node))return{found:process.versions.node,expected:uH.node}}},aH=()=>{let{CC:J}=process.env;return Boolean(J&&J.endsWith("/emcc"))},oz=()=>{if(process.platform==="darwin"&&process.arch==="x64")return($8("sysctl sysctl.proc_translated",Z8).stdout||"").trim()==="sysctl.proc_translated: 1";return!1},gH=(J)=>uz("sha512").update(J).digest("hex"),J3=()=>{try{let J=gH(`imgsharp-libvips-${X5()}`),Z=lH(mz[`@img/sharp-libvips-${X5()}`],{includePrerelease:!0}).version;return gH(`${J}npm:${Z}`).slice(0,10)}catch{}return""},$3=()=>$8(`node-gyp rebuild --directory=src ${aH()?"--nodedir=emscripten":""}`,{...Z8,stdio:"inherit"}).status,pH=()=>{if(process.platform!=="win32")return($8("pkg-config --modversion vips-cpp",{...Z8,env:{...process.env,PKG_CONFIG_PATH:rH()}}).stdout||"").trim();else return""},rH=()=>{if(process.platform!=="win32")return[($8('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',Z8).stdout||"").trim(),process.env.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":");else return""},DY=(J,Z,$)=>{if($)$(`Detected ${Z}, skipping search for globally-installed libvips`);return J},Z3=(J)=>{if(Boolean(process.env.SHARP_IGNORE_GLOBAL_LIBVIPS)===!0)return DY(!1,"SHARP_IGNORE_GLOBAL_LIBVIPS",J);if(Boolean(process.env.SHARP_FORCE_GLOBAL_LIBVIPS)===!0)return DY(!0,"SHARP_FORCE_GLOBAL_LIBVIPS",J);if(oz())return DY(!1,"Rosetta",J);let Z=pH();return!!Z&&gz(Z,cH)};eH.exports={minimumLibvipsVersion:cH,prebuiltPlatforms:pz,buildPlatformArch:X5,buildSharpLibvipsIncludeDir:nz,buildSharpLibvipsCPlusPlusDir:sz,buildSharpLibvipsLibDir:iz,isUnsupportedNodeRuntime:tz,runtimePlatformArch:ez,log:rz,yarnLocator:J3,spawnRebuild:$3,globalLibvipsVersion:pH,pkgConfigPath:rH,useGlobalLibvips:Z3}});var p5=J6((qB,sH)=>{var{familySync:Q3,versionSync:W3}=aZ(),{runtimePlatformArch:K3,isUnsupportedNodeRuntime:nH,prebuiltPlatforms:Y3,minimumLibvipsVersion:G3}=IY(),sJ=K3(),X3=[`../src/build/Release/sharp-${sJ}.node`,"../src/build/Release/sharp-wasm32.node",`@img/sharp-${sJ}/sharp.node`,"@img/sharp-wasm32/sharp.node"],wY,q5,a5=[];for(wY of X3)try{q5=b6(wY);break}catch(J){a5.push(J)}if(q5&&wY.startsWith("@img/sharp-linux-x64")&&!q5._isUsingX64V2()){let J=Error("Prebuilt binaries for linux-x64 require v2 microarchitecture");J.code="Unsupported CPU",a5.push(J),q5=null}if(q5)sH.exports=q5;else{let[J,Z,$]=["linux","darwin","win32"].map((Y)=>sJ.startsWith(Y)),Q=[`Could not load the "sharp" module using the ${sJ} runtime`];a5.forEach((Y)=>{if(Y.code!=="MODULE_NOT_FOUND")Q.push(`${Y.code}: ${Y.message}`)});let W=a5.map((Y)=>Y.message).join(" ");if(Q.push("Possible solutions:"),nH()){let{found:Y,expected:H}=nH();Q.push("- Please upgrade Node.js:",`    Found ${Y}`,`    Requires ${H}`)}else if(Y3.includes(sJ)){let[Y,H]=sJ.split("-"),G=Y.endsWith("musl")?" --libc=musl":"";Q.push("- Ensure optional dependencies can be installed:","    npm install --include=optional sharp","- Ensure your package manager supports multi-platform installation:","    See https://sharp.pixelplumbing.com/install#cross-platform","- Add platform-specific dependencies:",`    npm install --os=${Y.replace("musl","")}${G} --cpu=${H} sharp`)}else Q.push(`- Manually install libvips >= ${G3}`,"- Add experimental WebAssembly-based dependencies:","    npm install --cpu=wasm32 sharp","    npm install @img/sharp-wasm32");if(J&&/(symbol not found|CXXABI_)/i.test(W))try{let{config:Y}=b6(`@img/sharp-libvips-${sJ}/package`),H=`${Q3()} ${W3()}`,G=`${Y.musl?"musl":"glibc"} ${Y.musl||Y.glibc}`;Q.push("- Update your OS:",`    Found ${H}`,`    Requires ${G}`)}catch(Y){}if(J&&/\/snap\/core[0-9]{2}/.test(W))Q.push("- Remove the Node.js Snap, which does not support native modules","    snap remove node");if(Z&&/Incompatible library version/.test(W))Q.push("- Update Homebrew:","    brew update && brew upgrade vips");if(a5.some((Y)=>Y.code==="ERR_DLOPEN_DISABLED"))Q.push("- Run Node.js without using the --no-addons flag");if($&&/The specified procedure could not be found/.test(W))Q.push("- Using the canvas package on Windows?","    See https://sharp.pixelplumbing.com/install#canvas-and-windows","- Check for outdated versions of sharp in the dependency tree:","    npm ls sharp");throw Q.push("- Consult the installation documentation:","    See https://sharp.pixelplumbing.com/install"),Error(Q.join(`
`))}});var tH=J6((VB,iH)=>{var q3=b6("node:util"),jY=b6("node:stream"),H3=i4();p5();var V3=q3.debuglog("sharp"),iJ=function(J,Z){if(arguments.length===1&&!H3.defined(J))throw Error("Invalid input");if(!(this instanceof iJ))return new iJ(J,Z);return jY.Duplex.call(this),this.options={topOffsetPre:-1,leftOffsetPre:-1,widthPre:-1,heightPre:-1,topOffsetPost:-1,leftOffsetPost:-1,widthPost:-1,heightPost:-1,width:-1,height:-1,canvas:"crop",position:0,resizeBackground:[0,0,0,255],angle:0,rotationAngle:0,rotationBackground:[0,0,0,255],rotateBefore:!1,orientBefore:!1,flip:!1,flop:!1,extendTop:0,extendBottom:0,extendLeft:0,extendRight:0,extendBackground:[0,0,0,255],extendWith:"background",withoutEnlargement:!1,withoutReduction:!1,affineMatrix:[],affineBackground:[0,0,0,255],affineIdx:0,affineIdy:0,affineOdx:0,affineOdy:0,affineInterpolator:this.constructor.interpolators.bilinear,kernel:"lanczos3",fastShrinkOnLoad:!0,tint:[-1,0,0,0],flatten:!1,flattenBackground:[0,0,0],unflatten:!1,negate:!1,negateAlpha:!0,medianSize:0,blurSigma:0,precision:"integer",minAmpl:0.2,sharpenSigma:0,sharpenM1:1,sharpenM2:2,sharpenX1:2,sharpenY2:10,sharpenY3:20,threshold:0,thresholdGrayscale:!0,trimBackground:[],trimThreshold:-1,trimLineArt:!1,dilateWidth:0,erodeWidth:0,gamma:0,gammaOut:0,greyscale:!1,normalise:!1,normaliseLower:1,normaliseUpper:99,claheWidth:0,claheHeight:0,claheMaxSlope:3,brightness:1,saturation:1,hue:0,lightness:0,booleanBufferIn:null,booleanFileIn:"",joinChannelIn:[],extractChannel:-1,removeAlpha:!1,ensureAlpha:-1,colourspace:"srgb",colourspacePipeline:"last",composite:[],fileOut:"",formatOut:"input",streamOut:!1,keepMetadata:0,withMetadataOrientation:-1,withMetadataDensity:0,withIccProfile:"",withExif:{},withExifMerge:!0,withXmp:"",resolveWithObject:!1,loop:-1,delay:[],jpegQuality:80,jpegProgressive:!1,jpegChromaSubsampling:"4:2:0",jpegTrellisQuantisation:!1,jpegOvershootDeringing:!1,jpegOptimiseScans:!1,jpegOptimiseCoding:!0,jpegQuantisationTable:0,pngProgressive:!1,pngCompressionLevel:6,pngAdaptiveFiltering:!1,pngPalette:!1,pngQuality:100,pngEffort:7,pngBitdepth:8,pngDither:1,jp2Quality:80,jp2TileHeight:512,jp2TileWidth:512,jp2Lossless:!1,jp2ChromaSubsampling:"4:4:4",webpQuality:80,webpAlphaQuality:100,webpLossless:!1,webpNearLossless:!1,webpSmartSubsample:!1,webpSmartDeblock:!1,webpPreset:"default",webpEffort:4,webpMinSize:!1,webpMixed:!1,gifBitdepth:8,gifEffort:7,gifDither:1,gifInterFrameMaxError:0,gifInterPaletteMaxError:3,gifKeepDuplicateFrames:!1,gifReuse:!0,gifProgressive:!1,tiffQuality:80,tiffCompression:"jpeg",tiffPredictor:"horizontal",tiffPyramid:!1,tiffMiniswhite:!1,tiffBitdepth:8,tiffTile:!1,tiffTileHeight:256,tiffTileWidth:256,tiffXres:1,tiffYres:1,tiffResolutionUnit:"inch",heifQuality:50,heifLossless:!1,heifCompression:"av1",heifEffort:4,heifChromaSubsampling:"4:4:4",heifBitdepth:8,jxlDistance:1,jxlDecodingTier:0,jxlEffort:7,jxlLossless:!1,rawDepth:"uchar",tileSize:256,tileOverlap:0,tileContainer:"fs",tileLayout:"dz",tileFormat:"last",tileDepth:"last",tileAngle:0,tileSkipBlanks:-1,tileBackground:[255,255,255,255],tileCentre:!1,tileId:"https://example.com/iiif",tileBasename:"",timeoutSeconds:0,linearA:[],linearB:[],pdfBackground:[255,255,255,255],debuglog:($)=>{this.emit("warning",$),V3($)},queueListener:function($){iJ.queue.emit("change",$)}},this.options.input=this._createInputDescriptor(J,Z,{allowStream:!0}),this};Object.setPrototypeOf(iJ.prototype,jY.Duplex.prototype);Object.setPrototypeOf(iJ,jY.Duplex);function U3(){let J=this.constructor.call(),{debuglog:Z,queueListener:$,...Q}=this.options;if(J.options=structuredClone(Q),J.options.debuglog=Z,J.options.queueListener=$,this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),J.options.input.buffer=this.options.input.buffer,J.emit("finish")});return J}Object.assign(iJ.prototype,{clone:U3});iH.exports=iJ});var $V=J6((UB,JV)=>{var i=i4(),CJ=p5(),N3={left:"low",top:"low",low:"low",center:"centre",centre:"centre",right:"high",bottom:"high",high:"high"},z3=["failOn","limitInputPixels","unlimited","animated","autoOrient","density","ignoreIcc","page","pages","sequentialRead","jp2","openSlide","pdf","raw","svg","tiff","failOnError","openSlideLevel","pdfBackground","tiffSubifd"];function oH(J){let Z=z3.filter(($)=>i.defined(J[$])).map(($)=>[$,J[$]]);return Z.length?Object.fromEntries(Z):void 0}function E3(J,Z,$){let Q={autoOrient:!1,failOn:"warning",limitInputPixels:Math.pow(16383,2),ignoreIcc:!1,unlimited:!1,sequentialRead:!0};if(i.string(J))Q.file=J;else if(i.buffer(J)){if(J.length===0)throw Error("Input Buffer is empty");Q.buffer=J}else if(i.arrayBuffer(J)){if(J.byteLength===0)throw Error("Input bit Array is empty");Q.buffer=Buffer.from(J,0,J.byteLength)}else if(i.typedArray(J)){if(J.length===0)throw Error("Input Bit Array is empty");Q.buffer=Buffer.from(J.buffer,J.byteOffset,J.byteLength)}else if(i.plainObject(J)&&!i.defined(Z)){if(Z=J,oH(Z))Q.buffer=[]}else if(!i.defined(J)&&!i.defined(Z)&&i.object($)&&$.allowStream)Q.buffer=[];else if(Array.isArray(J))if(J.length>1)if(!this.options.joining)this.options.joining=!0,this.options.join=J.map((W)=>this._createInputDescriptor(W));else throw Error("Recursive join is unsupported");else throw Error("Expected at least two images to join");else throw Error(`Unsupported input '${J}' of type ${typeof J}${i.defined(Z)?` when also providing options of type ${typeof Z}`:""}`);if(i.object(Z)){if(i.defined(Z.failOnError))if(i.bool(Z.failOnError))Q.failOn=Z.failOnError?"warning":"none";else throw i.invalidParameterError("failOnError","boolean",Z.failOnError);if(i.defined(Z.failOn))if(i.string(Z.failOn)&&i.inArray(Z.failOn,["none","truncated","error","warning"]))Q.failOn=Z.failOn;else throw i.invalidParameterError("failOn","one of: none, truncated, error, warning",Z.failOn);if(i.defined(Z.autoOrient))if(i.bool(Z.autoOrient))Q.autoOrient=Z.autoOrient;else throw i.invalidParameterError("autoOrient","boolean",Z.autoOrient);if(i.defined(Z.density))if(i.inRange(Z.density,1,1e5))Q.density=Z.density;else throw i.invalidParameterError("density","number between 1 and 100000",Z.density);if(i.defined(Z.ignoreIcc))if(i.bool(Z.ignoreIcc))Q.ignoreIcc=Z.ignoreIcc;else throw i.invalidParameterError("ignoreIcc","boolean",Z.ignoreIcc);if(i.defined(Z.limitInputPixels))if(i.bool(Z.limitInputPixels))Q.limitInputPixels=Z.limitInputPixels?Math.pow(16383,2):0;else if(i.integer(Z.limitInputPixels)&&i.inRange(Z.limitInputPixels,0,Number.MAX_SAFE_INTEGER))Q.limitInputPixels=Z.limitInputPixels;else throw i.invalidParameterError("limitInputPixels","positive integer",Z.limitInputPixels);if(i.defined(Z.unlimited))if(i.bool(Z.unlimited))Q.unlimited=Z.unlimited;else throw i.invalidParameterError("unlimited","boolean",Z.unlimited);if(i.defined(Z.sequentialRead))if(i.bool(Z.sequentialRead))Q.sequentialRead=Z.sequentialRead;else throw i.invalidParameterError("sequentialRead","boolean",Z.sequentialRead);if(i.defined(Z.raw)){if(i.object(Z.raw)&&i.integer(Z.raw.width)&&Z.raw.width>0&&i.integer(Z.raw.height)&&Z.raw.height>0&&i.integer(Z.raw.channels)&&i.inRange(Z.raw.channels,1,4))switch(Q.rawWidth=Z.raw.width,Q.rawHeight=Z.raw.height,Q.rawChannels=Z.raw.channels,J.constructor){case Uint8Array:case Uint8ClampedArray:Q.rawDepth="uchar";break;case Int8Array:Q.rawDepth="char";break;case Uint16Array:Q.rawDepth="ushort";break;case Int16Array:Q.rawDepth="short";break;case Uint32Array:Q.rawDepth="uint";break;case Int32Array:Q.rawDepth="int";break;case Float32Array:Q.rawDepth="float";break;case Float64Array:Q.rawDepth="double";break;default:Q.rawDepth="uchar";break}else throw Error("Expected width, height and channels for raw pixel input");if(Q.rawPremultiplied=!1,i.defined(Z.raw.premultiplied))if(i.bool(Z.raw.premultiplied))Q.rawPremultiplied=Z.raw.premultiplied;else throw i.invalidParameterError("raw.premultiplied","boolean",Z.raw.premultiplied);if(Q.rawPageHeight=0,i.defined(Z.raw.pageHeight))if(i.integer(Z.raw.pageHeight)&&Z.raw.pageHeight>0&&Z.raw.pageHeight<=Z.raw.height){if(Z.raw.height%Z.raw.pageHeight!==0)throw Error(`Expected raw.height ${Z.raw.height} to be a multiple of raw.pageHeight ${Z.raw.pageHeight}`);Q.rawPageHeight=Z.raw.pageHeight}else throw i.invalidParameterError("raw.pageHeight","positive integer",Z.raw.pageHeight)}if(i.defined(Z.animated))if(i.bool(Z.animated))Q.pages=Z.animated?-1:1;else throw i.invalidParameterError("animated","boolean",Z.animated);if(i.defined(Z.pages))if(i.integer(Z.pages)&&i.inRange(Z.pages,-1,1e5))Q.pages=Z.pages;else throw i.invalidParameterError("pages","integer between -1 and 100000",Z.pages);if(i.defined(Z.page))if(i.integer(Z.page)&&i.inRange(Z.page,0,1e5))Q.page=Z.page;else throw i.invalidParameterError("page","integer between 0 and 100000",Z.page);if(i.object(Z.openSlide)&&i.defined(Z.openSlide.level))if(i.integer(Z.openSlide.level)&&i.inRange(Z.openSlide.level,0,256))Q.openSlideLevel=Z.openSlide.level;else throw i.invalidParameterError("openSlide.level","integer between 0 and 256",Z.openSlide.level);else if(i.defined(Z.level))if(i.integer(Z.level)&&i.inRange(Z.level,0,256))Q.openSlideLevel=Z.level;else throw i.invalidParameterError("level","integer between 0 and 256",Z.level);if(i.object(Z.tiff)&&i.defined(Z.tiff.subifd))if(i.integer(Z.tiff.subifd)&&i.inRange(Z.tiff.subifd,-1,1e5))Q.tiffSubifd=Z.tiff.subifd;else throw i.invalidParameterError("tiff.subifd","integer between -1 and 100000",Z.tiff.subifd);else if(i.defined(Z.subifd))if(i.integer(Z.subifd)&&i.inRange(Z.subifd,-1,1e5))Q.tiffSubifd=Z.subifd;else throw i.invalidParameterError("subifd","integer between -1 and 100000",Z.subifd);if(i.object(Z.svg)){if(i.defined(Z.svg.stylesheet))if(i.string(Z.svg.stylesheet))Q.svgStylesheet=Z.svg.stylesheet;else throw i.invalidParameterError("svg.stylesheet","string",Z.svg.stylesheet);if(i.defined(Z.svg.highBitdepth))if(i.bool(Z.svg.highBitdepth))Q.svgHighBitdepth=Z.svg.highBitdepth;else throw i.invalidParameterError("svg.highBitdepth","boolean",Z.svg.highBitdepth)}if(i.object(Z.pdf)&&i.defined(Z.pdf.background))Q.pdfBackground=this._getBackgroundColourOption(Z.pdf.background);else if(i.defined(Z.pdfBackground))Q.pdfBackground=this._getBackgroundColourOption(Z.pdfBackground);if(i.object(Z.jp2)&&i.defined(Z.jp2.oneshot))if(i.bool(Z.jp2.oneshot))Q.jp2Oneshot=Z.jp2.oneshot;else throw i.invalidParameterError("jp2.oneshot","boolean",Z.jp2.oneshot);if(i.defined(Z.create))if(i.object(Z.create)&&i.integer(Z.create.width)&&Z.create.width>0&&i.integer(Z.create.height)&&Z.create.height>0&&i.integer(Z.create.channels)){if(Q.createWidth=Z.create.width,Q.createHeight=Z.create.height,Q.createChannels=Z.create.channels,Q.createPageHeight=0,i.defined(Z.create.pageHeight))if(i.integer(Z.create.pageHeight)&&Z.create.pageHeight>0&&Z.create.pageHeight<=Z.create.height){if(Z.create.height%Z.create.pageHeight!==0)throw Error(`Expected create.height ${Z.create.height} to be a multiple of create.pageHeight ${Z.create.pageHeight}`);Q.createPageHeight=Z.create.pageHeight}else throw i.invalidParameterError("create.pageHeight","positive integer",Z.create.pageHeight);if(i.defined(Z.create.noise)){if(!i.object(Z.create.noise))throw Error("Expected noise to be an object");if(Z.create.noise.type!=="gaussian")throw Error("Only gaussian noise is supported at the moment");if(Q.createNoiseType=Z.create.noise.type,!i.inRange(Z.create.channels,1,4))throw i.invalidParameterError("create.channels","number between 1 and 4",Z.create.channels);if(Q.createNoiseMean=128,i.defined(Z.create.noise.mean))if(i.number(Z.create.noise.mean)&&i.inRange(Z.create.noise.mean,0,1e4))Q.createNoiseMean=Z.create.noise.mean;else throw i.invalidParameterError("create.noise.mean","number between 0 and 10000",Z.create.noise.mean);if(Q.createNoiseSigma=30,i.defined(Z.create.noise.sigma))if(i.number(Z.create.noise.sigma)&&i.inRange(Z.create.noise.sigma,0,1e4))Q.createNoiseSigma=Z.create.noise.sigma;else throw i.invalidParameterError("create.noise.sigma","number between 0 and 10000",Z.create.noise.sigma)}else if(i.defined(Z.create.background)){if(!i.inRange(Z.create.channels,3,4))throw i.invalidParameterError("create.channels","number between 3 and 4",Z.create.channels);Q.createBackground=this._getBackgroundColourOption(Z.create.background)}else throw Error("Expected valid noise or background to create a new input image");delete Q.buffer}else throw Error("Expected valid width, height and channels to create a new input image");if(i.defined(Z.text))if(i.object(Z.text)&&i.string(Z.text.text)){if(Q.textValue=Z.text.text,i.defined(Z.text.height)&&i.defined(Z.text.dpi))throw Error("Expected only one of dpi or height");if(i.defined(Z.text.font))if(i.string(Z.text.font))Q.textFont=Z.text.font;else throw i.invalidParameterError("text.font","string",Z.text.font);if(i.defined(Z.text.fontfile))if(i.string(Z.text.fontfile))Q.textFontfile=Z.text.fontfile;else throw i.invalidParameterError("text.fontfile","string",Z.text.fontfile);if(i.defined(Z.text.width))if(i.integer(Z.text.width)&&Z.text.width>0)Q.textWidth=Z.text.width;else throw i.invalidParameterError("text.width","positive integer",Z.text.width);if(i.defined(Z.text.height))if(i.integer(Z.text.height)&&Z.text.height>0)Q.textHeight=Z.text.height;else throw i.invalidParameterError("text.height","positive integer",Z.text.height);if(i.defined(Z.text.align))if(i.string(Z.text.align)&&i.string(this.constructor.align[Z.text.align]))Q.textAlign=this.constructor.align[Z.text.align];else throw i.invalidParameterError("text.align","valid alignment",Z.text.align);if(i.defined(Z.text.justify))if(i.bool(Z.text.justify))Q.textJustify=Z.text.justify;else throw i.invalidParameterError("text.justify","boolean",Z.text.justify);if(i.defined(Z.text.dpi))if(i.integer(Z.text.dpi)&&i.inRange(Z.text.dpi,1,1e6))Q.textDpi=Z.text.dpi;else throw i.invalidParameterError("text.dpi","integer between 1 and 1000000",Z.text.dpi);if(i.defined(Z.text.rgba))if(i.bool(Z.text.rgba))Q.textRgba=Z.text.rgba;else throw i.invalidParameterError("text.rgba","bool",Z.text.rgba);if(i.defined(Z.text.spacing))if(i.integer(Z.text.spacing)&&i.inRange(Z.text.spacing,-1e6,1e6))Q.textSpacing=Z.text.spacing;else throw i.invalidParameterError("text.spacing","integer between -1000000 and 1000000",Z.text.spacing);if(i.defined(Z.text.wrap))if(i.string(Z.text.wrap)&&i.inArray(Z.text.wrap,["word","char","word-char","none"]))Q.textWrap=Z.text.wrap;else throw i.invalidParameterError("text.wrap","one of: word, char, word-char, none",Z.text.wrap);delete Q.buffer}else throw Error("Expected a valid string to create an image with text.");if(i.defined(Z.join))if(i.defined(this.options.join)){if(i.defined(Z.join.animated))if(i.bool(Z.join.animated))Q.joinAnimated=Z.join.animated;else throw i.invalidParameterError("join.animated","boolean",Z.join.animated);if(i.defined(Z.join.across))if(i.integer(Z.join.across)&&i.inRange(Z.join.across,1,1e6))Q.joinAcross=Z.join.across;else throw i.invalidParameterError("join.across","integer between 1 and 100000",Z.join.across);if(i.defined(Z.join.shim))if(i.integer(Z.join.shim)&&i.inRange(Z.join.shim,0,1e6))Q.joinShim=Z.join.shim;else throw i.invalidParameterError("join.shim","integer between 0 and 100000",Z.join.shim);if(i.defined(Z.join.background))Q.joinBackground=this._getBackgroundColourOption(Z.join.background);if(i.defined(Z.join.halign))if(i.string(Z.join.halign)&&i.string(this.constructor.align[Z.join.halign]))Q.joinHalign=this.constructor.align[Z.join.halign];else throw i.invalidParameterError("join.halign","valid alignment",Z.join.halign);if(i.defined(Z.join.valign))if(i.string(Z.join.valign)&&i.string(this.constructor.align[Z.join.valign]))Q.joinValign=this.constructor.align[Z.join.valign];else throw i.invalidParameterError("join.valign","valid alignment",Z.join.valign)}else throw Error("Expected input to be an array of images to join")}else if(i.defined(Z))throw Error("Invalid input options "+Z);return Q}function L3(J,Z,$){if(Array.isArray(this.options.input.buffer))if(i.buffer(J)){if(this.options.input.buffer.length===0)this.on("finish",()=>{this.streamInFinished=!0});this.options.input.buffer.push(J),$()}else $(Error("Non-Buffer data on Writable Stream"));else $(Error("Unexpected data on Writable Stream"))}function A3(){if(this._isStreamInput())this.options.input.buffer=Buffer.concat(this.options.input.buffer)}function B3(){return Array.isArray(this.options.input.buffer)}function R3(J){let Z=Error();if(i.fn(J)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),CJ.metadata(this.options,($,Q)=>{if($)J(i.nativeError($,Z));else J(null,Q)})});else CJ.metadata(this.options,($,Q)=>{if($)J(i.nativeError($,Z));else J(null,Q)});return this}else if(this._isStreamInput())return new Promise(($,Q)=>{let W=()=>{this._flattenBufferIn(),CJ.metadata(this.options,(Y,H)=>{if(Y)Q(i.nativeError(Y,Z));else $(H)})};if(this.writableFinished)W();else this.once("finish",W)});else return new Promise(($,Q)=>{CJ.metadata(this.options,(W,Y)=>{if(W)Q(i.nativeError(W,Z));else $(Y)})})}function F3(J){let Z=Error();if(i.fn(J)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),CJ.stats(this.options,($,Q)=>{if($)J(i.nativeError($,Z));else J(null,Q)})});else CJ.stats(this.options,($,Q)=>{if($)J(i.nativeError($,Z));else J(null,Q)});return this}else if(this._isStreamInput())return new Promise(($,Q)=>{this.on("finish",function(){this._flattenBufferIn(),CJ.stats(this.options,(W,Y)=>{if(W)Q(i.nativeError(W,Z));else $(Y)})})});else return new Promise(($,Q)=>{CJ.stats(this.options,(W,Y)=>{if(W)Q(i.nativeError(W,Z));else $(Y)})})}JV.exports=function(J){Object.assign(J.prototype,{_inputOptionsFromObject:oH,_createInputDescriptor:E3,_write:L3,_flattenBufferIn:A3,_isStreamInput:B3,metadata:R3,stats:F3}),J.align=N3}});var GV=J6((NB,YV)=>{var $6=i4(),QV={center:0,centre:0,north:1,east:2,south:3,west:4,northeast:5,southeast:6,southwest:7,northwest:8},WV={top:1,right:2,bottom:3,left:4,"right top":5,"right bottom":6,"left bottom":7,"left top":8},ZV={background:"background",copy:"copy",repeat:"repeat",mirror:"mirror"},KV={entropy:16,attention:17},PY={nearest:"nearest",linear:"linear",cubic:"cubic",mitchell:"mitchell",lanczos2:"lanczos2",lanczos3:"lanczos3",mks2013:"mks2013",mks2021:"mks2021"},D3={contain:"contain",cover:"cover",fill:"fill",inside:"inside",outside:"outside"},I3={contain:"embed",cover:"crop",fill:"ignore_aspect",inside:"max",outside:"min"};function CY(J){return J.angle%360!==0||J.rotationAngle!==0}function Q8(J){return J.width!==-1||J.height!==-1}function w3(J,Z,$){if(Q8(this.options))this.options.debuglog("ignoring previous resize options");if(this.options.widthPost!==-1)this.options.debuglog("operation order will be: extract, resize, extract");if($6.defined(J))if($6.object(J)&&!$6.defined($))$=J;else if($6.integer(J)&&J>0)this.options.width=J;else throw $6.invalidParameterError("width","positive integer",J);else this.options.width=-1;if($6.defined(Z))if($6.integer(Z)&&Z>0)this.options.height=Z;else throw $6.invalidParameterError("height","positive integer",Z);else this.options.height=-1;if($6.object($)){if($6.defined($.width))if($6.integer($.width)&&$.width>0)this.options.width=$.width;else throw $6.invalidParameterError("width","positive integer",$.width);if($6.defined($.height))if($6.integer($.height)&&$.height>0)this.options.height=$.height;else throw $6.invalidParameterError("height","positive integer",$.height);if($6.defined($.fit)){let Q=I3[$.fit];if($6.string(Q))this.options.canvas=Q;else throw $6.invalidParameterError("fit","valid fit",$.fit)}if($6.defined($.position)){let Q=$6.integer($.position)?$.position:KV[$.position]||WV[$.position]||QV[$.position];if($6.integer(Q)&&($6.inRange(Q,0,8)||$6.inRange(Q,16,17)))this.options.position=Q;else throw $6.invalidParameterError("position","valid position/gravity/strategy",$.position)}if(this._setBackgroundColourOption("resizeBackground",$.background),$6.defined($.kernel))if($6.string(PY[$.kernel]))this.options.kernel=PY[$.kernel];else throw $6.invalidParameterError("kernel","valid kernel name",$.kernel);if($6.defined($.withoutEnlargement))this._setBooleanOption("withoutEnlargement",$.withoutEnlargement);if($6.defined($.withoutReduction))this._setBooleanOption("withoutReduction",$.withoutReduction);if($6.defined($.fastShrinkOnLoad))this._setBooleanOption("fastShrinkOnLoad",$.fastShrinkOnLoad)}if(CY(this.options)&&Q8(this.options))this.options.rotateBefore=!0;return this}function j3(J){if($6.integer(J)&&J>0)this.options.extendTop=J,this.options.extendBottom=J,this.options.extendLeft=J,this.options.extendRight=J;else if($6.object(J)){if($6.defined(J.top))if($6.integer(J.top)&&J.top>=0)this.options.extendTop=J.top;else throw $6.invalidParameterError("top","positive integer",J.top);if($6.defined(J.bottom))if($6.integer(J.bottom)&&J.bottom>=0)this.options.extendBottom=J.bottom;else throw $6.invalidParameterError("bottom","positive integer",J.bottom);if($6.defined(J.left))if($6.integer(J.left)&&J.left>=0)this.options.extendLeft=J.left;else throw $6.invalidParameterError("left","positive integer",J.left);if($6.defined(J.right))if($6.integer(J.right)&&J.right>=0)this.options.extendRight=J.right;else throw $6.invalidParameterError("right","positive integer",J.right);if(this._setBackgroundColourOption("extendBackground",J.background),$6.defined(J.extendWith))if($6.string(ZV[J.extendWith]))this.options.extendWith=ZV[J.extendWith];else throw $6.invalidParameterError("extendWith","one of: background, copy, repeat, mirror",J.extendWith)}else throw $6.invalidParameterError("extend","integer or object",J);return this}function P3(J){let Z=Q8(this.options)||this.options.widthPre!==-1?"Post":"Pre";if(this.options[`width${Z}`]!==-1)this.options.debuglog("ignoring previous extract options");if(["left","top","width","height"].forEach(function($){let Q=J[$];if($6.integer(Q)&&Q>=0)this.options[$+($==="left"||$==="top"?"Offset":"")+Z]=Q;else throw $6.invalidParameterError($,"integer",Q)},this),CY(this.options)&&!Q8(this.options)){if(this.options.widthPre===-1||this.options.widthPost===-1)this.options.rotateBefore=!0}if(this.options.input.autoOrient)this.options.orientBefore=!0;return this}function C3(J){if(this.options.trimThreshold=10,$6.defined(J))if($6.object(J)){if($6.defined(J.background))this._setBackgroundColourOption("trimBackground",J.background);if($6.defined(J.threshold))if($6.number(J.threshold)&&J.threshold>=0)this.options.trimThreshold=J.threshold;else throw $6.invalidParameterError("threshold","positive number",J.threshold);if($6.defined(J.lineArt))this._setBooleanOption("trimLineArt",J.lineArt)}else throw $6.invalidParameterError("trim","object",J);if(CY(this.options))this.options.rotateBefore=!0;return this}YV.exports=function(J){Object.assign(J.prototype,{resize:w3,extend:j3,extract:P3,trim:C3}),J.gravity=QV,J.strategy=KV,J.kernel=PY,J.fit=D3,J.position=WV}});var qV=J6((zB,XV)=>{var w6=i4(),SY={clear:"clear",source:"source",over:"over",in:"in",out:"out",atop:"atop",dest:"dest","dest-over":"dest-over","dest-in":"dest-in","dest-out":"dest-out","dest-atop":"dest-atop",xor:"xor",add:"add",saturate:"saturate",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","colour-dodge":"colour-dodge","color-dodge":"colour-dodge","colour-burn":"colour-burn","color-burn":"colour-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion"};function S3(J){if(!Array.isArray(J))throw w6.invalidParameterError("images to composite","array",J);return this.options.composite=J.map((Z)=>{if(!w6.object(Z))throw w6.invalidParameterError("image to composite","object",Z);let $=this._inputOptionsFromObject(Z),Q={input:this._createInputDescriptor(Z.input,$,{allowStream:!1}),blend:"over",tile:!1,left:0,top:0,hasOffset:!1,gravity:0,premultiplied:!1};if(w6.defined(Z.blend))if(w6.string(SY[Z.blend]))Q.blend=SY[Z.blend];else throw w6.invalidParameterError("blend","valid blend name",Z.blend);if(w6.defined(Z.tile))if(w6.bool(Z.tile))Q.tile=Z.tile;else throw w6.invalidParameterError("tile","boolean",Z.tile);if(w6.defined(Z.left))if(w6.integer(Z.left))Q.left=Z.left;else throw w6.invalidParameterError("left","integer",Z.left);if(w6.defined(Z.top))if(w6.integer(Z.top))Q.top=Z.top;else throw w6.invalidParameterError("top","integer",Z.top);if(w6.defined(Z.top)!==w6.defined(Z.left))throw Error("Expected both left and top to be set");else Q.hasOffset=w6.integer(Z.top)&&w6.integer(Z.left);if(w6.defined(Z.gravity))if(w6.integer(Z.gravity)&&w6.inRange(Z.gravity,0,8))Q.gravity=Z.gravity;else if(w6.string(Z.gravity)&&w6.integer(this.constructor.gravity[Z.gravity]))Q.gravity=this.constructor.gravity[Z.gravity];else throw w6.invalidParameterError("gravity","valid gravity",Z.gravity);if(w6.defined(Z.premultiplied))if(w6.bool(Z.premultiplied))Q.premultiplied=Z.premultiplied;else throw w6.invalidParameterError("premultiplied","boolean",Z.premultiplied);return Q}),this}XV.exports=function(J){J.prototype.composite=S3,J.blend=SY}});var zV=J6((EB,NV)=>{var K0=i4(),HV={integer:"integer",float:"float",approximate:"approximate"};function M3(J,Z){if(!K0.defined(J))return this.autoOrient();if(this.options.angle||this.options.rotationAngle)this.options.debuglog("ignoring previous rotate options"),this.options.angle=0,this.options.rotationAngle=0;if(K0.integer(J)&&!(J%90))this.options.angle=J;else if(K0.number(J)){if(this.options.rotationAngle=J,K0.object(Z)&&Z.background)this._setBackgroundColourOption("rotationBackground",Z.background)}else throw K0.invalidParameterError("angle","numeric",J);return this}function T3(){return this.options.input.autoOrient=!0,this}function _3(J){return this.options.flip=K0.bool(J)?J:!0,this}function k3(J){return this.options.flop=K0.bool(J)?J:!0,this}function x3(J,Z){let $=[].concat(...J);if($.length===4&&$.every(K0.number))this.options.affineMatrix=$;else throw K0.invalidParameterError("matrix","1x4 or 2x2 array",J);if(K0.defined(Z))if(K0.object(Z)){if(this._setBackgroundColourOption("affineBackground",Z.background),K0.defined(Z.idx))if(K0.number(Z.idx))this.options.affineIdx=Z.idx;else throw K0.invalidParameterError("options.idx","number",Z.idx);if(K0.defined(Z.idy))if(K0.number(Z.idy))this.options.affineIdy=Z.idy;else throw K0.invalidParameterError("options.idy","number",Z.idy);if(K0.defined(Z.odx))if(K0.number(Z.odx))this.options.affineOdx=Z.odx;else throw K0.invalidParameterError("options.odx","number",Z.odx);if(K0.defined(Z.ody))if(K0.number(Z.ody))this.options.affineOdy=Z.ody;else throw K0.invalidParameterError("options.ody","number",Z.ody);if(K0.defined(Z.interpolator))if(K0.inArray(Z.interpolator,Object.values(this.constructor.interpolators)))this.options.affineInterpolator=Z.interpolator;else throw K0.invalidParameterError("options.interpolator","valid interpolator name",Z.interpolator)}else throw K0.invalidParameterError("options","object",Z);return this}function y3(J,Z,$){if(!K0.defined(J))this.options.sharpenSigma=-1;else if(K0.bool(J))this.options.sharpenSigma=J?-1:0;else if(K0.number(J)&&K0.inRange(J,0.01,1e4)){if(this.options.sharpenSigma=J,K0.defined(Z))if(K0.number(Z)&&K0.inRange(Z,0,1e4))this.options.sharpenM1=Z;else throw K0.invalidParameterError("flat","number between 0 and 10000",Z);if(K0.defined($))if(K0.number($)&&K0.inRange($,0,1e4))this.options.sharpenM2=$;else throw K0.invalidParameterError("jagged","number between 0 and 10000",$)}else if(K0.plainObject(J)){if(K0.number(J.sigma)&&K0.inRange(J.sigma,0.000001,10))this.options.sharpenSigma=J.sigma;else throw K0.invalidParameterError("options.sigma","number between 0.000001 and 10",J.sigma);if(K0.defined(J.m1))if(K0.number(J.m1)&&K0.inRange(J.m1,0,1e6))this.options.sharpenM1=J.m1;else throw K0.invalidParameterError("options.m1","number between 0 and 1000000",J.m1);if(K0.defined(J.m2))if(K0.number(J.m2)&&K0.inRange(J.m2,0,1e6))this.options.sharpenM2=J.m2;else throw K0.invalidParameterError("options.m2","number between 0 and 1000000",J.m2);if(K0.defined(J.x1))if(K0.number(J.x1)&&K0.inRange(J.x1,0,1e6))this.options.sharpenX1=J.x1;else throw K0.invalidParameterError("options.x1","number between 0 and 1000000",J.x1);if(K0.defined(J.y2))if(K0.number(J.y2)&&K0.inRange(J.y2,0,1e6))this.options.sharpenY2=J.y2;else throw K0.invalidParameterError("options.y2","number between 0 and 1000000",J.y2);if(K0.defined(J.y3))if(K0.number(J.y3)&&K0.inRange(J.y3,0,1e6))this.options.sharpenY3=J.y3;else throw K0.invalidParameterError("options.y3","number between 0 and 1000000",J.y3)}else throw K0.invalidParameterError("sigma","number between 0.01 and 10000",J);return this}function v3(J){if(!K0.defined(J))this.options.medianSize=3;else if(K0.integer(J)&&K0.inRange(J,1,1000))this.options.medianSize=J;else throw K0.invalidParameterError("size","integer between 1 and 1000",J);return this}function O3(J){let Z;if(K0.number(J))Z=J;else if(K0.plainObject(J)){if(!K0.number(J.sigma))throw K0.invalidParameterError("options.sigma","number between 0.3 and 1000",Z);if(Z=J.sigma,"precision"in J)if(K0.string(HV[J.precision]))this.options.precision=HV[J.precision];else throw K0.invalidParameterError("precision","one of: integer, float, approximate",J.precision);if("minAmplitude"in J)if(K0.number(J.minAmplitude)&&K0.inRange(J.minAmplitude,0.001,1))this.options.minAmpl=J.minAmplitude;else throw K0.invalidParameterError("minAmplitude","number between 0.001 and 1",J.minAmplitude)}if(!K0.defined(J))this.options.blurSigma=-1;else if(K0.bool(J))this.options.blurSigma=J?-1:0;else if(K0.number(Z)&&K0.inRange(Z,0.3,1000))this.options.blurSigma=Z;else throw K0.invalidParameterError("sigma","number between 0.3 and 1000",Z);return this}function VV(J){if(!K0.defined(J))this.options.dilateWidth=1;else if(K0.integer(J)&&J>0)this.options.dilateWidth=J;else throw K0.invalidParameterError("dilate","positive integer",VV);return this}function UV(J){if(!K0.defined(J))this.options.erodeWidth=1;else if(K0.integer(J)&&J>0)this.options.erodeWidth=J;else throw K0.invalidParameterError("erode","positive integer",UV);return this}function b3(J){if(this.options.flatten=K0.bool(J)?J:!0,K0.object(J))this._setBackgroundColourOption("flattenBackground",J.background);return this}function h3(){return this.options.unflatten=!0,this}function f3(J,Z){if(!K0.defined(J))this.options.gamma=2.2;else if(K0.number(J)&&K0.inRange(J,1,3))this.options.gamma=J;else throw K0.invalidParameterError("gamma","number between 1.0 and 3.0",J);if(!K0.defined(Z))this.options.gammaOut=this.options.gamma;else if(K0.number(Z)&&K0.inRange(Z,1,3))this.options.gammaOut=Z;else throw K0.invalidParameterError("gammaOut","number between 1.0 and 3.0",Z);return this}function d3(J){if(this.options.negate=K0.bool(J)?J:!0,K0.plainObject(J)&&"alpha"in J)if(!K0.bool(J.alpha))throw K0.invalidParameterError("alpha","should be boolean value",J.alpha);else this.options.negateAlpha=J.alpha;return this}function u3(J){if(K0.plainObject(J)){if(K0.defined(J.lower))if(K0.number(J.lower)&&K0.inRange(J.lower,0,99))this.options.normaliseLower=J.lower;else throw K0.invalidParameterError("lower","number between 0 and 99",J.lower);if(K0.defined(J.upper))if(K0.number(J.upper)&&K0.inRange(J.upper,1,100))this.options.normaliseUpper=J.upper;else throw K0.invalidParameterError("upper","number between 1 and 100",J.upper)}if(this.options.normaliseLower>=this.options.normaliseUpper)throw K0.invalidParameterError("range","lower to be less than upper",`${this.options.normaliseLower} >= ${this.options.normaliseUpper}`);return this.options.normalise=!0,this}function g3(J){return this.normalise(J)}function l3(J){if(K0.plainObject(J)){if(K0.integer(J.width)&&J.width>0)this.options.claheWidth=J.width;else throw K0.invalidParameterError("width","integer greater than zero",J.width);if(K0.integer(J.height)&&J.height>0)this.options.claheHeight=J.height;else throw K0.invalidParameterError("height","integer greater than zero",J.height);if(K0.defined(J.maxSlope))if(K0.integer(J.maxSlope)&&K0.inRange(J.maxSlope,0,100))this.options.claheMaxSlope=J.maxSlope;else throw K0.invalidParameterError("maxSlope","integer between 0 and 100",J.maxSlope)}else throw K0.invalidParameterError("options","plain object",J);return this}function c3(J){if(!K0.object(J)||!Array.isArray(J.kernel)||!K0.integer(J.width)||!K0.integer(J.height)||!K0.inRange(J.width,3,1001)||!K0.inRange(J.height,3,1001)||J.height*J.width!==J.kernel.length)throw Error("Invalid convolution kernel");if(!K0.integer(J.scale))J.scale=J.kernel.reduce(function(Z,$){return Z+$},0);if(J.scale<1)J.scale=1;if(!K0.integer(J.offset))J.offset=0;return this.options.convKernel=J,this}function m3(J,Z){if(!K0.defined(J))this.options.threshold=128;else if(K0.bool(J))this.options.threshold=J?128:0;else if(K0.integer(J)&&K0.inRange(J,0,255))this.options.threshold=J;else throw K0.invalidParameterError("threshold","integer between 0 and 255",J);if(!K0.object(Z)||Z.greyscale===!0||Z.grayscale===!0)this.options.thresholdGrayscale=!0;else this.options.thresholdGrayscale=!1;return this}function a3(J,Z,$){if(this.options.boolean=this._createInputDescriptor(J,$),K0.string(Z)&&K0.inArray(Z,["and","or","eor"]))this.options.booleanOp=Z;else throw K0.invalidParameterError("operator","one of: and, or, eor",Z);return this}function p3(J,Z){if(!K0.defined(J)&&K0.number(Z))J=1;else if(K0.number(J)&&!K0.defined(Z))Z=0;if(!K0.defined(J))this.options.linearA=[];else if(K0.number(J))this.options.linearA=[J];else if(Array.isArray(J)&&J.length&&J.every(K0.number))this.options.linearA=J;else throw K0.invalidParameterError("a","number or array of numbers",J);if(!K0.defined(Z))this.options.linearB=[];else if(K0.number(Z))this.options.linearB=[Z];else if(Array.isArray(Z)&&Z.length&&Z.every(K0.number))this.options.linearB=Z;else throw K0.invalidParameterError("b","number or array of numbers",Z);if(this.options.linearA.length!==this.options.linearB.length)throw Error("Expected a and b to be arrays of the same length");return this}function r3(J){if(!Array.isArray(J))throw K0.invalidParameterError("inputMatrix","array",J);if(J.length!==3&&J.length!==4)throw K0.invalidParameterError("inputMatrix","3x3 or 4x4 array",J.length);let Z=J.flat().map(Number);if(Z.length!==9&&Z.length!==16)throw K0.invalidParameterError("inputMatrix","cardinality of 9 or 16",Z.length);return this.options.recombMatrix=Z,this}function e3(J){if(!K0.plainObject(J))throw K0.invalidParameterError("options","plain object",J);if("brightness"in J)if(K0.number(J.brightness)&&J.brightness>=0)this.options.brightness=J.brightness;else throw K0.invalidParameterError("brightness","number above zero",J.brightness);if("saturation"in J)if(K0.number(J.saturation)&&J.saturation>=0)this.options.saturation=J.saturation;else throw K0.invalidParameterError("saturation","number above zero",J.saturation);if("hue"in J)if(K0.integer(J.hue))this.options.hue=J.hue%360;else throw K0.invalidParameterError("hue","number",J.hue);if("lightness"in J)if(K0.number(J.lightness))this.options.lightness=J.lightness;else throw K0.invalidParameterError("lightness","number",J.lightness);return this}NV.exports=function(J){Object.assign(J.prototype,{autoOrient:T3,rotate:M3,flip:_3,flop:k3,affine:x3,sharpen:y3,erode:UV,dilate:VV,median:v3,blur:O3,flatten:b3,unflatten:h3,gamma:f3,negate:d3,normalise:u3,normalize:g3,clahe:l3,convolve:c3,threshold:m3,boolean:a3,linear:p3,recomb:r3,modulate:e3})}});var FV=J6((LB,RV)=>{var{defineProperty:kY,getOwnPropertyDescriptor:n3,getOwnPropertyNames:s3}=Object,i3=Object.prototype.hasOwnProperty,t3=(J,Z)=>{for(var $ in Z)kY(J,$,{get:Z[$],enumerable:!0})},o3=(J,Z,$,Q)=>{if(Z&&typeof Z==="object"||typeof Z==="function"){for(let W of s3(Z))if(!i3.call(J,W)&&W!==$)kY(J,W,{get:()=>Z[W],enumerable:!(Q=n3(Z,W))||Q.enumerable})}return J},JE=(J)=>o3(kY({},"__esModule",{value:!0}),J),EV={};t3(EV,{default:()=>zE});RV.exports=JE(EV);var ZJ={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},LV=Object.create(null);for(let J in ZJ)if(Object.hasOwn(ZJ,J))LV[ZJ[J]]=J;var w4={to:{},get:{}};w4.get=function(J){let Z=J.slice(0,3).toLowerCase(),$,Q;switch(Z){case"hsl":{$=w4.get.hsl(J),Q="hsl";break}case"hwb":{$=w4.get.hwb(J),Q="hwb";break}default:{$=w4.get.rgb(J),Q="rgb";break}}if(!$)return null;return{model:Q,value:$}};w4.get.rgb=function(J){if(!J)return null;let Z=/^#([a-f\d]{3,4})$/i,$=/^#([a-f\d]{6})([a-f\d]{2})?$/i,Q=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,W=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,Y=/^(\w+)$/,H=[0,0,0,1],G,q,z;if(G=J.match($)){z=G[2],G=G[1];for(q=0;q<3;q++){let U=q*2;H[q]=Number.parseInt(G.slice(U,U+2),16)}if(z)H[3]=Number.parseInt(z,16)/255}else if(G=J.match(Z)){G=G[1],z=G[3];for(q=0;q<3;q++)H[q]=Number.parseInt(G[q]+G[q],16);if(z)H[3]=Number.parseInt(z+z,16)/255}else if(G=J.match(Q)){for(q=0;q<3;q++)H[q]=Number.parseInt(G[q+1],10);if(G[4])H[3]=G[5]?Number.parseFloat(G[4])*0.01:Number.parseFloat(G[4])}else if(G=J.match(W)){for(q=0;q<3;q++)H[q]=Math.round(Number.parseFloat(G[q+1])*2.55);if(G[4])H[3]=G[5]?Number.parseFloat(G[4])*0.01:Number.parseFloat(G[4])}else if(G=J.match(Y)){if(G[1]==="transparent")return[0,0,0,0];if(!Object.hasOwn(ZJ,G[1]))return null;return H=ZJ[G[1]],H[3]=1,H}else return null;for(q=0;q<3;q++)H[q]=SJ(H[q],0,255);return H[3]=SJ(H[3],0,1),H};w4.get.hsl=function(J){if(!J)return null;let Z=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,$=J.match(Z);if($){let Q=Number.parseFloat($[4]),W=(Number.parseFloat($[1])%360+360)%360,Y=SJ(Number.parseFloat($[2]),0,100),H=SJ(Number.parseFloat($[3]),0,100),G=SJ(Number.isNaN(Q)?1:Q,0,1);return[W,Y,H,G]}return null};w4.get.hwb=function(J){if(!J)return null;let Z=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,$=J.match(Z);if($){let Q=Number.parseFloat($[4]),W=(Number.parseFloat($[1])%360+360)%360,Y=SJ(Number.parseFloat($[2]),0,100),H=SJ(Number.parseFloat($[3]),0,100),G=SJ(Number.isNaN(Q)?1:Q,0,1);return[W,Y,H,G]}return null};w4.to.hex=function(...J){return"#"+W8(J[0])+W8(J[1])+W8(J[2])+(J[3]<1?W8(Math.round(J[3]*255)):"")};w4.to.rgb=function(...J){return J.length<4||J[3]===1?"rgb("+Math.round(J[0])+", "+Math.round(J[1])+", "+Math.round(J[2])+")":"rgba("+Math.round(J[0])+", "+Math.round(J[1])+", "+Math.round(J[2])+", "+J[3]+")"};w4.to.rgb.percent=function(...J){let Z=Math.round(J[0]/255*100),$=Math.round(J[1]/255*100),Q=Math.round(J[2]/255*100);return J.length<4||J[3]===1?"rgb("+Z+"%, "+$+"%, "+Q+"%)":"rgba("+Z+"%, "+$+"%, "+Q+"%, "+J[3]+")"};w4.to.hsl=function(...J){return J.length<4||J[3]===1?"hsl("+J[0]+", "+J[1]+"%, "+J[2]+"%)":"hsla("+J[0]+", "+J[1]+"%, "+J[2]+"%, "+J[3]+")"};w4.to.hwb=function(...J){let Z="";if(J.length>=4&&J[3]!==1)Z=", "+J[3];return"hwb("+J[0]+", "+J[1]+"%, "+J[2]+"%"+Z+")"};w4.to.keyword=function(...J){return LV[J.slice(0,3)]};function SJ(J,Z,$){return Math.min(Math.max(Z,J),$)}function W8(J){let Z=Math.round(J).toString(16).toUpperCase();return Z.length<2?"0"+Z:Z}var H5=w4,AV={};for(let J of Object.keys(ZJ))AV[ZJ[J]]=J;var p0={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},tJ=p0,BJ=0.008856451679035631;function U5(J){let Z=J>0.0031308?1.055*J**0.4166666666666667-0.055:J*12.92;return Math.min(Math.max(0,Z),1)}function N5(J){return J>0.04045?((J+0.055)/1.055)**2.4:J/12.92}for(let J of Object.keys(p0)){if(!("channels"in p0[J]))throw Error("missing channels property: "+J);if(!("labels"in p0[J]))throw Error("missing channel labels property: "+J);if(p0[J].labels.length!==p0[J].channels)throw Error("channel and label counts mismatch: "+J);let{channels:Z,labels:$}=p0[J];delete p0[J].channels,delete p0[J].labels,Object.defineProperty(p0[J],"channels",{value:Z}),Object.defineProperty(p0[J],"labels",{value:$})}p0.rgb.hsl=function(J){let Z=J[0]/255,$=J[1]/255,Q=J[2]/255,W=Math.min(Z,$,Q),Y=Math.max(Z,$,Q),H=Y-W,G,q;switch(Y){case W:{G=0;break}case Z:{G=($-Q)/H;break}case $:{G=2+(Q-Z)/H;break}case Q:{G=4+(Z-$)/H;break}}if(G=Math.min(G*60,360),G<0)G+=360;let z=(W+Y)/2;if(Y===W)q=0;else if(z<=0.5)q=H/(Y+W);else q=H/(2-Y-W);return[G,q*100,z*100]};p0.rgb.hsv=function(J){let Z,$,Q,W,Y,H=J[0]/255,G=J[1]/255,q=J[2]/255,z=Math.max(H,G,q),U=z-Math.min(H,G,q),N=function(L){return(z-L)/6/U+0.5};if(U===0)W=0,Y=0;else{switch(Y=U/z,Z=N(H),$=N(G),Q=N(q),z){case H:{W=Q-$;break}case G:{W=0.3333333333333333+Z-Q;break}case q:{W=0.6666666666666666+$-Z;break}}if(W<0)W+=1;else if(W>1)W-=1}return[W*360,Y*100,z*100]};p0.rgb.hwb=function(J){let Z=J[0],$=J[1],Q=J[2],W=p0.rgb.hsl(J)[0],Y=0.00392156862745098*Math.min(Z,Math.min($,Q));return Q=1-0.00392156862745098*Math.max(Z,Math.max($,Q)),[W,Y*100,Q*100]};p0.rgb.oklab=function(J){let Z=N5(J[0]/255),$=N5(J[1]/255),Q=N5(J[2]/255),W=Math.cbrt(0.4122214708*Z+0.5363325363*$+0.0514459929*Q),Y=Math.cbrt(0.2119034982*Z+0.6806995451*$+0.1073969566*Q),H=Math.cbrt(0.0883024619*Z+0.2817188376*$+0.6299787005*Q),G=0.2104542553*W+0.793617785*Y-0.0040720468*H,q=1.9779984951*W-2.428592205*Y+0.4505937099*H,z=0.0259040371*W+0.7827717662*Y-0.808675766*H;return[G*100,q*100,z*100]};p0.rgb.cmyk=function(J){let Z=J[0]/255,$=J[1]/255,Q=J[2]/255,W=Math.min(1-Z,1-$,1-Q),Y=(1-Z-W)/(1-W)||0,H=(1-$-W)/(1-W)||0,G=(1-Q-W)/(1-W)||0;return[Y*100,H*100,G*100,W*100]};function $E(J,Z){return(J[0]-Z[0])**2+(J[1]-Z[1])**2+(J[2]-Z[2])**2}p0.rgb.keyword=function(J){let Z=AV[J];if(Z)return Z;let $=Number.POSITIVE_INFINITY,Q;for(let W of Object.keys(ZJ)){let Y=ZJ[W],H=$E(J,Y);if(H<$)$=H,Q=W}return Q};p0.keyword.rgb=function(J){return ZJ[J]};p0.rgb.xyz=function(J){let Z=N5(J[0]/255),$=N5(J[1]/255),Q=N5(J[2]/255),W=Z*0.4124564+$*0.3575761+Q*0.1804375,Y=Z*0.2126729+$*0.7151522+Q*0.072175,H=Z*0.0193339+$*0.119192+Q*0.9503041;return[W*100,Y*100,H*100]};p0.rgb.lab=function(J){let Z=p0.rgb.xyz(J),$=Z[0],Q=Z[1],W=Z[2];$/=95.047,Q/=100,W/=108.883,$=$>BJ?$**0.3333333333333333:7.787*$+0.13793103448275862,Q=Q>BJ?Q**0.3333333333333333:7.787*Q+0.13793103448275862,W=W>BJ?W**0.3333333333333333:7.787*W+0.13793103448275862;let Y=116*Q-16,H=500*($-Q),G=200*(Q-W);return[Y,H,G]};p0.hsl.rgb=function(J){let Z=J[0]/360,$=J[1]/100,Q=J[2]/100,W,Y;if($===0)return Y=Q*255,[Y,Y,Y];let H=Q<0.5?Q*(1+$):Q+$-Q*$,G=2*Q-H,q=[0,0,0];for(let z=0;z<3;z++){if(W=Z+0.3333333333333333*-(z-1),W<0)W++;if(W>1)W--;if(6*W<1)Y=G+(H-G)*6*W;else if(2*W<1)Y=H;else if(3*W<2)Y=G+(H-G)*(0.6666666666666666-W)*6;else Y=G;q[z]=Y*255}return q};p0.hsl.hsv=function(J){let Z=J[0],$=J[1]/100,Q=J[2]/100,W=$,Y=Math.max(Q,0.01);Q*=2,$*=Q<=1?Q:2-Q,W*=Y<=1?Y:2-Y;let H=(Q+$)/2,G=Q===0?2*W/(Y+W):2*$/(Q+$);return[Z,G*100,H*100]};p0.hsv.rgb=function(J){let Z=J[0]/60,$=J[1]/100,Q=J[2]/100,W=Math.floor(Z)%6,Y=Z-Math.floor(Z),H=255*Q*(1-$),G=255*Q*(1-$*Y),q=255*Q*(1-$*(1-Y));switch(Q*=255,W){case 0:return[Q,q,H];case 1:return[G,Q,H];case 2:return[H,Q,q];case 3:return[H,G,Q];case 4:return[q,H,Q];case 5:return[Q,H,G]}};p0.hsv.hsl=function(J){let Z=J[0],$=J[1]/100,Q=J[2]/100,W=Math.max(Q,0.01),Y,H;H=(2-$)*Q;let G=(2-$)*W;return Y=$*W,Y/=G<=1?G:2-G,Y=Y||0,H/=2,[Z,Y*100,H*100]};p0.hwb.rgb=function(J){let Z=J[0]/360,$=J[1]/100,Q=J[2]/100,W=$+Q,Y;if(W>1)$/=W,Q/=W;let H=Math.floor(6*Z),G=1-Q;if(Y=6*Z-H,(H&1)!==0)Y=1-Y;let q=$+Y*(G-$),z,U,N;switch(H){default:case 6:case 0:{z=G,U=q,N=$;break}case 1:{z=q,U=G,N=$;break}case 2:{z=$,U=G,N=q;break}case 3:{z=$,U=q,N=G;break}case 4:{z=q,U=$,N=G;break}case 5:{z=G,U=$,N=q;break}}return[z*255,U*255,N*255]};p0.cmyk.rgb=function(J){let Z=J[0]/100,$=J[1]/100,Q=J[2]/100,W=J[3]/100,Y=1-Math.min(1,Z*(1-W)+W),H=1-Math.min(1,$*(1-W)+W),G=1-Math.min(1,Q*(1-W)+W);return[Y*255,H*255,G*255]};p0.xyz.rgb=function(J){let Z=J[0]/100,$=J[1]/100,Q=J[2]/100,W,Y,H;return W=Z*3.2404542+$*-1.5371385+Q*-0.4985314,Y=Z*-0.969266+$*1.8760108+Q*0.041556,H=Z*0.0556434+$*-0.2040259+Q*1.0572252,W=U5(W),Y=U5(Y),H=U5(H),[W*255,Y*255,H*255]};p0.xyz.lab=function(J){let Z=J[0],$=J[1],Q=J[2];Z/=95.047,$/=100,Q/=108.883,Z=Z>BJ?Z**0.3333333333333333:7.787*Z+0.13793103448275862,$=$>BJ?$**0.3333333333333333:7.787*$+0.13793103448275862,Q=Q>BJ?Q**0.3333333333333333:7.787*Q+0.13793103448275862;let W=116*$-16,Y=500*(Z-$),H=200*($-Q);return[W,Y,H]};p0.xyz.oklab=function(J){let Z=J[0]/100,$=J[1]/100,Q=J[2]/100,W=Math.cbrt(0.8189330101*Z+0.3618667424*$-0.1288597137*Q),Y=Math.cbrt(0.0329845436*Z+0.9293118715*$+0.0361456387*Q),H=Math.cbrt(0.0482003018*Z+0.2643662691*$+0.633851707*Q),G=0.2104542553*W+0.793617785*Y-0.0040720468*H,q=1.9779984951*W-2.428592205*Y+0.4505937099*H,z=0.0259040371*W+0.7827717662*Y-0.808675766*H;return[G*100,q*100,z*100]};p0.oklab.oklch=function(J){return p0.lab.lch(J)};p0.oklab.xyz=function(J){let Z=J[0]/100,$=J[1]/100,Q=J[2]/100,W=(0.999999998*Z+0.396337792*$+0.215803758*Q)**3,Y=(1.000000008*Z-0.105561342*$-0.063854175*Q)**3,H=(1.000000055*Z-0.089484182*$-1.291485538*Q)**3,G=1.227013851*W-0.55779998*Y+0.281256149*H,q=-0.040580178*W+1.11225687*Y-0.071676679*H,z=-0.076381285*W-0.421481978*Y+1.58616322*H;return[G*100,q*100,z*100]};p0.oklab.rgb=function(J){let Z=J[0]/100,$=J[1]/100,Q=J[2]/100,W=(Z+0.3963377774*$+0.2158037573*Q)**3,Y=(Z-0.1055613458*$-0.0638541728*Q)**3,H=(Z-0.0894841775*$-1.291485548*Q)**3,G=U5(4.0767416621*W-3.3077115913*Y+0.2309699292*H),q=U5(-1.2684380046*W+2.6097574011*Y-0.3413193965*H),z=U5(-0.0041960863*W-0.7034186147*Y+1.707614701*H);return[G*255,q*255,z*255]};p0.oklch.oklab=function(J){return p0.lch.lab(J)};p0.lab.xyz=function(J){let Z=J[0],$=J[1],Q=J[2],W,Y,H;Y=(Z+16)/116,W=$/500+Y,H=Y-Q/200;let G=Y**3,q=W**3,z=H**3;return Y=G>BJ?G:(Y-0.13793103448275862)/7.787,W=q>BJ?q:(W-0.13793103448275862)/7.787,H=z>BJ?z:(H-0.13793103448275862)/7.787,W*=95.047,Y*=100,H*=108.883,[W,Y,H]};p0.lab.lch=function(J){let Z=J[0],$=J[1],Q=J[2],W;if(W=Math.atan2(Q,$)*360/2/Math.PI,W<0)W+=360;let H=Math.sqrt($*$+Q*Q);return[Z,H,W]};p0.lch.lab=function(J){let Z=J[0],$=J[1],W=J[2]/360*2*Math.PI,Y=$*Math.cos(W),H=$*Math.sin(W);return[Z,Y,H]};p0.rgb.ansi16=function(J,Z=null){let[$,Q,W]=J,Y=Z===null?p0.rgb.hsv(J)[2]:Z;if(Y=Math.round(Y/50),Y===0)return 30;let H=30+(Math.round(W/255)<<2|Math.round(Q/255)<<1|Math.round($/255));if(Y===2)H+=60;return H};p0.hsv.ansi16=function(J){return p0.rgb.ansi16(p0.hsv.rgb(J),J[2])};p0.rgb.ansi256=function(J){let Z=J[0],$=J[1],Q=J[2];if(Z>>4===$>>4&&$>>4===Q>>4){if(Z<8)return 16;if(Z>248)return 231;return Math.round((Z-8)/247*24)+232}return 16+36*Math.round(Z/255*5)+6*Math.round($/255*5)+Math.round(Q/255*5)};p0.ansi16.rgb=function(J){J=J[0];let Z=J%10;if(Z===0||Z===7){if(J>50)Z+=3.5;return Z=Z/10.5*255,[Z,Z,Z]}let $=(Math.trunc(J>50)+1)*0.5,Q=(Z&1)*$*255,W=(Z>>1&1)*$*255,Y=(Z>>2&1)*$*255;return[Q,W,Y]};p0.ansi256.rgb=function(J){if(J=J[0],J>=232){let Y=(J-232)*10+8;return[Y,Y,Y]}J-=16;let Z,$=Math.floor(J/36)/5*255,Q=Math.floor((Z=J%36)/6)/5*255,W=Z%6/5*255;return[$,Q,W]};p0.rgb.hex=function(J){let $=(((Math.round(J[0])&255)<<16)+((Math.round(J[1])&255)<<8)+(Math.round(J[2])&255)).toString(16).toUpperCase();return"000000".slice($.length)+$};p0.hex.rgb=function(J){let Z=J.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!Z)return[0,0,0];let $=Z[0];if(Z[0].length===3)$=[...$].map((G)=>G+G).join("");let Q=Number.parseInt($,16),W=Q>>16&255,Y=Q>>8&255,H=Q&255;return[W,Y,H]};p0.rgb.hcg=function(J){let Z=J[0]/255,$=J[1]/255,Q=J[2]/255,W=Math.max(Math.max(Z,$),Q),Y=Math.min(Math.min(Z,$),Q),H=W-Y,G,q=H<1?Y/(1-H):0;if(H<=0)G=0;else if(W===Z)G=($-Q)/H%6;else if(W===$)G=2+(Q-Z)/H;else G=4+(Z-$)/H;return G/=6,G%=1,[G*360,H*100,q*100]};p0.hsl.hcg=function(J){let Z=J[1]/100,$=J[2]/100,Q=$<0.5?2*Z*$:2*Z*(1-$),W=0;if(Q<1)W=($-0.5*Q)/(1-Q);return[J[0],Q*100,W*100]};p0.hsv.hcg=function(J){let Z=J[1]/100,$=J[2]/100,Q=Z*$,W=0;if(Q<1)W=($-Q)/(1-Q);return[J[0],Q*100,W*100]};p0.hcg.rgb=function(J){let Z=J[0]/360,$=J[1]/100,Q=J[2]/100;if($===0)return[Q*255,Q*255,Q*255];let W=[0,0,0],Y=Z%1*6,H=Y%1,G=1-H,q=0;switch(Math.floor(Y)){case 0:{W[0]=1,W[1]=H,W[2]=0;break}case 1:{W[0]=G,W[1]=1,W[2]=0;break}case 2:{W[0]=0,W[1]=1,W[2]=H;break}case 3:{W[0]=0,W[1]=G,W[2]=1;break}case 4:{W[0]=H,W[1]=0,W[2]=1;break}default:W[0]=1,W[1]=0,W[2]=G}return q=(1-$)*Q,[($*W[0]+q)*255,($*W[1]+q)*255,($*W[2]+q)*255]};p0.hcg.hsv=function(J){let Z=J[1]/100,$=J[2]/100,Q=Z+$*(1-Z),W=0;if(Q>0)W=Z/Q;return[J[0],W*100,Q*100]};p0.hcg.hsl=function(J){let Z=J[1]/100,Q=J[2]/100*(1-Z)+0.5*Z,W=0;if(Q>0&&Q<0.5)W=Z/(2*Q);else if(Q>=0.5&&Q<1)W=Z/(2*(1-Q));return[J[0],W*100,Q*100]};p0.hcg.hwb=function(J){let Z=J[1]/100,$=J[2]/100,Q=Z+$*(1-Z);return[J[0],(Q-Z)*100,(1-Q)*100]};p0.hwb.hcg=function(J){let Z=J[1]/100,Q=1-J[2]/100,W=Q-Z,Y=0;if(W<1)Y=(Q-W)/(1-W);return[J[0],W*100,Y*100]};p0.apple.rgb=function(J){return[J[0]/65535*255,J[1]/65535*255,J[2]/65535*255]};p0.rgb.apple=function(J){return[J[0]/255*65535,J[1]/255*65535,J[2]/255*65535]};p0.gray.rgb=function(J){return[J[0]/100*255,J[0]/100*255,J[0]/100*255]};p0.gray.hsl=function(J){return[0,0,J[0]]};p0.gray.hsv=p0.gray.hsl;p0.gray.hwb=function(J){return[0,100,J[0]]};p0.gray.cmyk=function(J){return[0,0,0,J[0]]};p0.gray.lab=function(J){return[J[0],0,0]};p0.gray.hex=function(J){let Z=Math.round(J[0]/100*255)&255,Q=((Z<<16)+(Z<<8)+Z).toString(16).toUpperCase();return"000000".slice(Q.length)+Q};p0.rgb.gray=function(J){return[(J[0]+J[1]+J[2])/3/255*100]};function ZE(){let J={},Z=Object.keys(tJ);for(let{length:$}=Z,Q=0;Q<$;Q++)J[Z[Q]]={distance:-1,parent:null};return J}function QE(J){let Z=ZE(),$=[J];Z[J].distance=0;while($.length>0){let Q=$.pop(),W=Object.keys(tJ[Q]);for(let{length:Y}=W,H=0;H<Y;H++){let G=W[H],q=Z[G];if(q.distance===-1)q.distance=Z[Q].distance+1,q.parent=Q,$.unshift(G)}}return Z}function WE(J,Z){return function($){return Z(J($))}}function KE(J,Z){let $=[Z[J].parent,J],Q=tJ[Z[J].parent][J],W=Z[J].parent;while(Z[W].parent)$.unshift(Z[W].parent),Q=WE(tJ[Z[W].parent][W],Q),W=Z[W].parent;return Q.conversion=$,Q}function YE(J){let Z=QE(J),$={},Q=Object.keys(Z);for(let{length:W}=Q,Y=0;Y<W;Y++){let H=Q[Y];if(Z[H].parent===null)continue;$[H]=KE(H,Z)}return $}var GE=YE,V5={},XE=Object.keys(tJ);function qE(J){let Z=function(...$){let Q=$[0];if(Q===void 0||Q===null)return Q;if(Q.length>1)$=Q;return J($)};if("conversion"in J)Z.conversion=J.conversion;return Z}function HE(J){let Z=function(...$){let Q=$[0];if(Q===void 0||Q===null)return Q;if(Q.length>1)$=Q;let W=J($);if(typeof W==="object")for(let{length:Y}=W,H=0;H<Y;H++)W[H]=Math.round(W[H]);return W};if("conversion"in J)Z.conversion=J.conversion;return Z}for(let J of XE){V5[J]={},Object.defineProperty(V5[J],"channels",{value:tJ[J].channels}),Object.defineProperty(V5[J],"labels",{value:tJ[J].labels});let Z=GE(J),$=Object.keys(Z);for(let Q of $){let W=Z[Q];V5[J][Q]=HE(W),V5[J][Q].raw=qE(W)}}var T4=V5,BV=["keyword","gray","hex"],MY={};for(let J of Object.keys(T4))MY[[...T4[J].labels].sort().join("")]=J;var TY={};function $4(J,Z){if(!(this instanceof $4))return new $4(J,Z);if(Z&&Z in BV)Z=null;if(Z&&!(Z in T4))throw Error("Unknown model: "+Z);let $,Q;if(J==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(J instanceof $4)this.model=J.model,this.color=[...J.color],this.valpha=J.valpha;else if(typeof J==="string"){let W=H5.get(J);if(W===null)throw Error("Unable to parse color from string: "+J);this.model=W.model,Q=T4[this.model].channels,this.color=W.value.slice(0,Q),this.valpha=typeof W.value[Q]==="number"?W.value[Q]:1}else if(J.length>0){this.model=Z||"rgb",Q=T4[this.model].channels;let W=Array.prototype.slice.call(J,0,Q);this.color=_Y(W,Q),this.valpha=typeof J[Q]==="number"?J[Q]:1}else if(typeof J==="number")this.model="rgb",this.color=[J>>16&255,J>>8&255,J&255],this.valpha=1;else{this.valpha=1;let W=Object.keys(J);if("alpha"in J)W.splice(W.indexOf("alpha"),1),this.valpha=typeof J.alpha==="number"?J.alpha:0;let Y=W.sort().join("");if(!(Y in MY))throw Error("Unable to parse color from object: "+JSON.stringify(J));this.model=MY[Y];let{labels:H}=T4[this.model],G=[];for($=0;$<H.length;$++)G.push(J[H[$]]);this.color=_Y(G)}if(TY[this.model]){Q=T4[this.model].channels;for($=0;$<Q;$++){let W=TY[this.model][$];if(W)this.color[$]=W(this.color[$])}}if(this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze)Object.freeze(this)}$4.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(J){let Z=this.model in H5.to?this:this.rgb();Z=Z.round(typeof J==="number"?J:1);let $=Z.valpha===1?Z.color:[...Z.color,this.valpha];return H5.to[Z.model](...$)},percentString(J){let Z=this.rgb().round(typeof J==="number"?J:1),$=Z.valpha===1?Z.color:[...Z.color,this.valpha];return H5.to.rgb.percent(...$)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){let J={},{channels:Z}=T4[this.model],{labels:$}=T4[this.model];for(let Q=0;Q<Z;Q++)J[$[Q]]=this.color[Q];if(this.valpha!==1)J.alpha=this.valpha;return J},unitArray(){let J=this.rgb().color;if(J[0]/=255,J[1]/=255,J[2]/=255,this.valpha!==1)J.push(this.valpha);return J},unitObject(){let J=this.rgb().object();if(J.r/=255,J.g/=255,J.b/=255,this.valpha!==1)J.alpha=this.valpha;return J},round(J){return J=Math.max(J||0,0),new $4([...this.color.map(UE(J)),this.valpha],this.model)},alpha(J){if(J!==void 0)return new $4([...this.color,Math.max(0,Math.min(1,J))],this.model);return this.valpha},red:f6("rgb",0,t6(255)),green:f6("rgb",1,t6(255)),blue:f6("rgb",2,t6(255)),hue:f6(["hsl","hsv","hsl","hwb","hcg"],0,(J)=>(J%360+360)%360),saturationl:f6("hsl",1,t6(100)),lightness:f6("hsl",2,t6(100)),saturationv:f6("hsv",1,t6(100)),value:f6("hsv",2,t6(100)),chroma:f6("hcg",1,t6(100)),gray:f6("hcg",2,t6(100)),white:f6("hwb",1,t6(100)),wblack:f6("hwb",2,t6(100)),cyan:f6("cmyk",0,t6(100)),magenta:f6("cmyk",1,t6(100)),yellow:f6("cmyk",2,t6(100)),black:f6("cmyk",3,t6(100)),x:f6("xyz",0,t6(95.047)),y:f6("xyz",1,t6(100)),z:f6("xyz",2,t6(108.833)),l:f6("lab",0,t6(100)),a:f6("lab",1),b:f6("lab",2),keyword(J){if(J!==void 0)return new $4(J);return T4[this.model].keyword(this.color)},hex(J){if(J!==void 0)return new $4(J);return H5.to.hex(...this.rgb().round().color)},hexa(J){if(J!==void 0)return new $4(J);let Z=this.rgb().round().color,$=Math.round(this.valpha*255).toString(16).toUpperCase();if($.length===1)$="0"+$;return H5.to.hex(...Z)+$},rgbNumber(){let J=this.rgb().color;return(J[0]&255)<<16|(J[1]&255)<<8|J[2]&255},luminosity(){let J=this.rgb().color,Z=[];for(let[$,Q]of J.entries()){let W=Q/255;Z[$]=W<=0.04045?W/12.92:((W+0.055)/1.055)**2.4}return 0.2126*Z[0]+0.7152*Z[1]+0.0722*Z[2]},contrast(J){let Z=this.luminosity(),$=J.luminosity();if(Z>$)return(Z+0.05)/($+0.05);return($+0.05)/(Z+0.05)},level(J){let Z=this.contrast(J);if(Z>=7)return"AAA";return Z>=4.5?"AA":""},isDark(){let J=this.rgb().color;return(J[0]*2126+J[1]*7152+J[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){let J=this.rgb();for(let Z=0;Z<3;Z++)J.color[Z]=255-J.color[Z];return J},lighten(J){let Z=this.hsl();return Z.color[2]+=Z.color[2]*J,Z},darken(J){let Z=this.hsl();return Z.color[2]-=Z.color[2]*J,Z},saturate(J){let Z=this.hsl();return Z.color[1]+=Z.color[1]*J,Z},desaturate(J){let Z=this.hsl();return Z.color[1]-=Z.color[1]*J,Z},whiten(J){let Z=this.hwb();return Z.color[1]+=Z.color[1]*J,Z},blacken(J){let Z=this.hwb();return Z.color[2]+=Z.color[2]*J,Z},grayscale(){let J=this.rgb().color,Z=J[0]*0.3+J[1]*0.59+J[2]*0.11;return $4.rgb(Z,Z,Z)},fade(J){return this.alpha(this.valpha-this.valpha*J)},opaquer(J){return this.alpha(this.valpha+this.valpha*J)},rotate(J){let Z=this.hsl(),$=Z.color[0];return $=($+J)%360,$=$<0?360+$:$,Z.color[0]=$,Z},mix(J,Z){if(!J||!J.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof J);let $=J.rgb(),Q=this.rgb(),W=Z===void 0?0.5:Z,Y=2*W-1,H=$.alpha()-Q.alpha(),G=((Y*H===-1?Y:(Y+H)/(1+Y*H))+1)/2,q=1-G;return $4.rgb(G*$.red()+q*Q.red(),G*$.green()+q*Q.green(),G*$.blue()+q*Q.blue(),$.alpha()*W+Q.alpha()*(1-W))}};for(let J of Object.keys(T4)){if(BV.includes(J))continue;let{channels:Z}=T4[J];$4.prototype[J]=function(...$){if(this.model===J)return new $4(this);if($.length>0)return new $4($,J);return new $4([...NE(T4[this.model][J].raw(this.color)),this.valpha],J)},$4[J]=function(...$){let Q=$[0];if(typeof Q==="number")Q=_Y($,Z);return new $4(Q,J)}}function VE(J,Z){return Number(J.toFixed(Z))}function UE(J){return function(Z){return VE(Z,J)}}function f6(J,Z,$){J=Array.isArray(J)?J:[J];for(let Q of J)(TY[Q]||=[])[Z]=$;return J=J[0],function(Q){let W;if(Q!==void 0){if($)Q=$(Q);return W=this[J](),W.color[Z]=Q,W}if(W=this[J]().color[Z],$)W=$(W);return W}}function t6(J){return function(Z){return Math.max(0,Math.min(J,Z))}}function NE(J){return Array.isArray(J)?J:[J]}function _Y(J,Z){for(let $=0;$<Z;$++)if(typeof J[$]!=="number")J[$]=0;return J}var zE=$4});var IV=J6((AB,DV)=>{DV.exports=FV().default});var CV=J6((BB,PV)=>{var EE=IV(),RJ=i4(),wV={multiband:"multiband","b-w":"b-w",bw:"b-w",cmyk:"cmyk",srgb:"srgb"};function LE(J){return this._setBackgroundColourOption("tint",J),this}function AE(J){return this.options.greyscale=RJ.bool(J)?J:!0,this}function BE(J){return this.greyscale(J)}function RE(J){if(!RJ.string(J))throw RJ.invalidParameterError("colourspace","string",J);return this.options.colourspacePipeline=J,this}function FE(J){return this.pipelineColourspace(J)}function DE(J){if(!RJ.string(J))throw RJ.invalidParameterError("colourspace","string",J);return this.options.colourspace=J,this}function IE(J){return this.toColourspace(J)}function jV(J){if(RJ.object(J)||RJ.string(J)){let Z=EE(J);return[Z.red(),Z.green(),Z.blue(),Math.round(Z.alpha()*255)]}else throw RJ.invalidParameterError("background","object or string",J)}function wE(J,Z){if(RJ.defined(Z))this.options[J]=jV(Z)}PV.exports=function(J){Object.assign(J.prototype,{tint:LE,greyscale:AE,grayscale:BE,pipelineColourspace:RE,pipelineColorspace:FE,toColourspace:DE,toColorspace:IE,_getBackgroundColourOption:jV,_setBackgroundColourOption:wE}),J.colourspace=wV,J.colorspace=wV}});var MV=J6((RB,SV)=>{var QJ=i4(),jE={and:"and",or:"or",eor:"eor"};function PE(){return this.options.removeAlpha=!0,this}function CE(J){if(QJ.defined(J))if(QJ.number(J)&&QJ.inRange(J,0,1))this.options.ensureAlpha=J;else throw QJ.invalidParameterError("alpha","number between 0 and 1",J);else this.options.ensureAlpha=1;return this}function SE(J){let Z={red:0,green:1,blue:2,alpha:3};if(Object.keys(Z).includes(J))J=Z[J];if(QJ.integer(J)&&QJ.inRange(J,0,4))this.options.extractChannel=J;else throw QJ.invalidParameterError("channel","integer or one of: red, green, blue, alpha",J);return this}function ME(J,Z){if(Array.isArray(J))J.forEach(function($){this.options.joinChannelIn.push(this._createInputDescriptor($,Z))},this);else this.options.joinChannelIn.push(this._createInputDescriptor(J,Z));return this}function TE(J){if(QJ.string(J)&&QJ.inArray(J,["and","or","eor"]))this.options.bandBoolOp=J;else throw QJ.invalidParameterError("boolOp","one of: and, or, eor",J);return this}SV.exports=function(J){Object.assign(J.prototype,{removeAlpha:PE,ensureAlpha:CE,extractChannel:SE,joinChannel:ME,bandbool:TE}),J.bool=jE}});var yV=J6((FB,xV)=>{var xY=b6("node:path"),x=i4(),z5=p5(),TV=new Map([["heic","heif"],["heif","heif"],["avif","avif"],["jpeg","jpeg"],["jpg","jpeg"],["jpe","jpeg"],["tile","tile"],["dz","tile"],["png","png"],["raw","raw"],["tiff","tiff"],["tif","tiff"],["webp","webp"],["gif","gif"],["jp2","jp2"],["jpx","jp2"],["j2k","jp2"],["j2c","jp2"],["jxl","jxl"]]),_E=/\.(jp[2x]|j2[kc])$/i,_V=()=>Error("JP2 output requires libvips with support for OpenJPEG"),kV=(J)=>1<<31-Math.clz32(Math.ceil(Math.log2(J)));function kE(J,Z){let $;if(!x.string(J))$=Error("Missing output file path");else if(x.string(this.options.input.file)&&xY.resolve(this.options.input.file)===xY.resolve(J))$=Error("Cannot use same file for input and output");else if(_E.test(xY.extname(J))&&!this.constructor.format.jp2k.output.file)$=_V();if($)if(x.fn(Z))Z($);else return Promise.reject($);else{this.options.fileOut=J;let Q=Error();return this._pipeline(Z,Q)}return this}function xE(J,Z){if(x.object(J))this._setBooleanOption("resolveWithObject",J.resolveWithObject);else if(this.options.resolveWithObject)this.options.resolveWithObject=!1;this.options.fileOut="";let $=Error();return this._pipeline(x.fn(J)?J:Z,$)}function yE(){return this.options.keepMetadata|=1,this}function vE(J){if(x.object(J))for(let[Z,$]of Object.entries(J))if(x.object($))for(let[Q,W]of Object.entries($))if(x.string(W))this.options.withExif[`exif-${Z.toLowerCase()}-${Q}`]=W;else throw x.invalidParameterError(`${Z}.${Q}`,"string",W);else throw x.invalidParameterError(Z,"object",$);else throw x.invalidParameterError("exif","object",J);return this.options.withExifMerge=!1,this.keepExif()}function OE(J){return this.withExif(J),this.options.withExifMerge=!0,this}function bE(){return this.options.keepMetadata|=8,this}function hE(J,Z){if(x.string(J))this.options.withIccProfile=J;else throw x.invalidParameterError("icc","string",J);if(this.keepIccProfile(),x.object(Z)){if(x.defined(Z.attach))if(x.bool(Z.attach)){if(!Z.attach)this.options.keepMetadata&=-9}else throw x.invalidParameterError("attach","boolean",Z.attach)}return this}function fE(){return this.options.keepMetadata|=2,this}function dE(J){if(x.string(J)&&J.length>0)this.options.withXmp=J,this.options.keepMetadata|=2;else throw x.invalidParameterError("xmp","non-empty string",J);return this}function uE(){return this.options.keepMetadata=31,this}function gE(J){if(this.keepMetadata(),this.withIccProfile("srgb"),x.object(J)){if(x.defined(J.orientation))if(x.integer(J.orientation)&&x.inRange(J.orientation,1,8))this.options.withMetadataOrientation=J.orientation;else throw x.invalidParameterError("orientation","integer between 1 and 8",J.orientation);if(x.defined(J.density))if(x.number(J.density)&&J.density>0)this.options.withMetadataDensity=J.density;else throw x.invalidParameterError("density","positive number",J.density);if(x.defined(J.icc))this.withIccProfile(J.icc);if(x.defined(J.exif))this.withExifMerge(J.exif)}return this}function lE(J,Z){let $=TV.get((x.object(J)&&x.string(J.id)?J.id:J).toLowerCase());if(!$)throw x.invalidParameterError("format",`one of: ${[...TV.keys()].join(", ")}`,J);return this[$](Z)}function cE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.jpegQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.progressive))this._setBooleanOption("jpegProgressive",J.progressive);if(x.defined(J.chromaSubsampling))if(x.string(J.chromaSubsampling)&&x.inArray(J.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jpegChromaSubsampling=J.chromaSubsampling;else throw x.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",J.chromaSubsampling);let Z=x.bool(J.optimizeCoding)?J.optimizeCoding:J.optimiseCoding;if(x.defined(Z))this._setBooleanOption("jpegOptimiseCoding",Z);if(x.defined(J.mozjpeg))if(x.bool(J.mozjpeg)){if(J.mozjpeg)this.options.jpegTrellisQuantisation=!0,this.options.jpegOvershootDeringing=!0,this.options.jpegOptimiseScans=!0,this.options.jpegProgressive=!0,this.options.jpegQuantisationTable=3}else throw x.invalidParameterError("mozjpeg","boolean",J.mozjpeg);let $=x.bool(J.trellisQuantization)?J.trellisQuantization:J.trellisQuantisation;if(x.defined($))this._setBooleanOption("jpegTrellisQuantisation",$);if(x.defined(J.overshootDeringing))this._setBooleanOption("jpegOvershootDeringing",J.overshootDeringing);let Q=x.bool(J.optimizeScans)?J.optimizeScans:J.optimiseScans;if(x.defined(Q)){if(this._setBooleanOption("jpegOptimiseScans",Q),Q)this.options.jpegProgressive=!0}let W=x.number(J.quantizationTable)?J.quantizationTable:J.quantisationTable;if(x.defined(W))if(x.integer(W)&&x.inRange(W,0,8))this.options.jpegQuantisationTable=W;else throw x.invalidParameterError("quantisationTable","integer between 0 and 8",W)}return this._updateFormatOut("jpeg",J)}function mE(J){if(x.object(J)){if(x.defined(J.progressive))this._setBooleanOption("pngProgressive",J.progressive);if(x.defined(J.compressionLevel))if(x.integer(J.compressionLevel)&&x.inRange(J.compressionLevel,0,9))this.options.pngCompressionLevel=J.compressionLevel;else throw x.invalidParameterError("compressionLevel","integer between 0 and 9",J.compressionLevel);if(x.defined(J.adaptiveFiltering))this._setBooleanOption("pngAdaptiveFiltering",J.adaptiveFiltering);let Z=J.colours||J.colors;if(x.defined(Z))if(x.integer(Z)&&x.inRange(Z,2,256))this.options.pngBitdepth=kV(Z);else throw x.invalidParameterError("colours","integer between 2 and 256",Z);if(x.defined(J.palette))this._setBooleanOption("pngPalette",J.palette);else if([J.quality,J.effort,J.colours,J.colors,J.dither].some(x.defined))this._setBooleanOption("pngPalette",!0);if(this.options.pngPalette){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,0,100))this.options.pngQuality=J.quality;else throw x.invalidParameterError("quality","integer between 0 and 100",J.quality);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,1,10))this.options.pngEffort=J.effort;else throw x.invalidParameterError("effort","integer between 1 and 10",J.effort);if(x.defined(J.dither))if(x.number(J.dither)&&x.inRange(J.dither,0,1))this.options.pngDither=J.dither;else throw x.invalidParameterError("dither","number between 0.0 and 1.0",J.dither)}}return this._updateFormatOut("png",J)}function aE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.webpQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.alphaQuality))if(x.integer(J.alphaQuality)&&x.inRange(J.alphaQuality,0,100))this.options.webpAlphaQuality=J.alphaQuality;else throw x.invalidParameterError("alphaQuality","integer between 0 and 100",J.alphaQuality);if(x.defined(J.lossless))this._setBooleanOption("webpLossless",J.lossless);if(x.defined(J.nearLossless))this._setBooleanOption("webpNearLossless",J.nearLossless);if(x.defined(J.smartSubsample))this._setBooleanOption("webpSmartSubsample",J.smartSubsample);if(x.defined(J.smartDeblock))this._setBooleanOption("webpSmartDeblock",J.smartDeblock);if(x.defined(J.preset))if(x.string(J.preset)&&x.inArray(J.preset,["default","photo","picture","drawing","icon","text"]))this.options.webpPreset=J.preset;else throw x.invalidParameterError("preset","one of: default, photo, picture, drawing, icon, text",J.preset);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,0,6))this.options.webpEffort=J.effort;else throw x.invalidParameterError("effort","integer between 0 and 6",J.effort);if(x.defined(J.minSize))this._setBooleanOption("webpMinSize",J.minSize);if(x.defined(J.mixed))this._setBooleanOption("webpMixed",J.mixed)}return yY(J,this.options),this._updateFormatOut("webp",J)}function pE(J){if(x.object(J)){if(x.defined(J.reuse))this._setBooleanOption("gifReuse",J.reuse);if(x.defined(J.progressive))this._setBooleanOption("gifProgressive",J.progressive);let Z=J.colours||J.colors;if(x.defined(Z))if(x.integer(Z)&&x.inRange(Z,2,256))this.options.gifBitdepth=kV(Z);else throw x.invalidParameterError("colours","integer between 2 and 256",Z);if(x.defined(J.effort))if(x.number(J.effort)&&x.inRange(J.effort,1,10))this.options.gifEffort=J.effort;else throw x.invalidParameterError("effort","integer between 1 and 10",J.effort);if(x.defined(J.dither))if(x.number(J.dither)&&x.inRange(J.dither,0,1))this.options.gifDither=J.dither;else throw x.invalidParameterError("dither","number between 0.0 and 1.0",J.dither);if(x.defined(J.interFrameMaxError))if(x.number(J.interFrameMaxError)&&x.inRange(J.interFrameMaxError,0,32))this.options.gifInterFrameMaxError=J.interFrameMaxError;else throw x.invalidParameterError("interFrameMaxError","number between 0.0 and 32.0",J.interFrameMaxError);if(x.defined(J.interPaletteMaxError))if(x.number(J.interPaletteMaxError)&&x.inRange(J.interPaletteMaxError,0,256))this.options.gifInterPaletteMaxError=J.interPaletteMaxError;else throw x.invalidParameterError("interPaletteMaxError","number between 0.0 and 256.0",J.interPaletteMaxError);if(x.defined(J.keepDuplicateFrames))if(x.bool(J.keepDuplicateFrames))this._setBooleanOption("gifKeepDuplicateFrames",J.keepDuplicateFrames);else throw x.invalidParameterError("keepDuplicateFrames","boolean",J.keepDuplicateFrames)}return yY(J,this.options),this._updateFormatOut("gif",J)}function rE(J){if(!this.constructor.format.jp2k.output.buffer)throw _V();if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.jp2Quality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.lossless))if(x.bool(J.lossless))this.options.jp2Lossless=J.lossless;else throw x.invalidParameterError("lossless","boolean",J.lossless);if(x.defined(J.tileWidth))if(x.integer(J.tileWidth)&&x.inRange(J.tileWidth,1,32768))this.options.jp2TileWidth=J.tileWidth;else throw x.invalidParameterError("tileWidth","integer between 1 and 32768",J.tileWidth);if(x.defined(J.tileHeight))if(x.integer(J.tileHeight)&&x.inRange(J.tileHeight,1,32768))this.options.jp2TileHeight=J.tileHeight;else throw x.invalidParameterError("tileHeight","integer between 1 and 32768",J.tileHeight);if(x.defined(J.chromaSubsampling))if(x.string(J.chromaSubsampling)&&x.inArray(J.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jp2ChromaSubsampling=J.chromaSubsampling;else throw x.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",J.chromaSubsampling)}return this._updateFormatOut("jp2",J)}function yY(J,Z){if(x.object(J)&&x.defined(J.loop))if(x.integer(J.loop)&&x.inRange(J.loop,0,65535))Z.loop=J.loop;else throw x.invalidParameterError("loop","integer between 0 and 65535",J.loop);if(x.object(J)&&x.defined(J.delay))if(x.integer(J.delay)&&x.inRange(J.delay,0,65535))Z.delay=[J.delay];else if(Array.isArray(J.delay)&&J.delay.every(x.integer)&&J.delay.every(($)=>x.inRange($,0,65535)))Z.delay=J.delay;else throw x.invalidParameterError("delay","integer or an array of integers between 0 and 65535",J.delay)}function eE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.tiffQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.bitdepth))if(x.integer(J.bitdepth)&&x.inArray(J.bitdepth,[1,2,4,8]))this.options.tiffBitdepth=J.bitdepth;else throw x.invalidParameterError("bitdepth","1, 2, 4 or 8",J.bitdepth);if(x.defined(J.tile))this._setBooleanOption("tiffTile",J.tile);if(x.defined(J.tileWidth))if(x.integer(J.tileWidth)&&J.tileWidth>0)this.options.tiffTileWidth=J.tileWidth;else throw x.invalidParameterError("tileWidth","integer greater than zero",J.tileWidth);if(x.defined(J.tileHeight))if(x.integer(J.tileHeight)&&J.tileHeight>0)this.options.tiffTileHeight=J.tileHeight;else throw x.invalidParameterError("tileHeight","integer greater than zero",J.tileHeight);if(x.defined(J.miniswhite))this._setBooleanOption("tiffMiniswhite",J.miniswhite);if(x.defined(J.pyramid))this._setBooleanOption("tiffPyramid",J.pyramid);if(x.defined(J.xres))if(x.number(J.xres)&&J.xres>0)this.options.tiffXres=J.xres;else throw x.invalidParameterError("xres","number greater than zero",J.xres);if(x.defined(J.yres))if(x.number(J.yres)&&J.yres>0)this.options.tiffYres=J.yres;else throw x.invalidParameterError("yres","number greater than zero",J.yres);if(x.defined(J.compression))if(x.string(J.compression)&&x.inArray(J.compression,["none","jpeg","deflate","packbits","ccittfax4","lzw","webp","zstd","jp2k"]))this.options.tiffCompression=J.compression;else throw x.invalidParameterError("compression","one of: none, jpeg, deflate, packbits, ccittfax4, lzw, webp, zstd, jp2k",J.compression);if(x.defined(J.predictor))if(x.string(J.predictor)&&x.inArray(J.predictor,["none","horizontal","float"]))this.options.tiffPredictor=J.predictor;else throw x.invalidParameterError("predictor","one of: none, horizontal, float",J.predictor);if(x.defined(J.resolutionUnit))if(x.string(J.resolutionUnit)&&x.inArray(J.resolutionUnit,["inch","cm"]))this.options.tiffResolutionUnit=J.resolutionUnit;else throw x.invalidParameterError("resolutionUnit","one of: inch, cm",J.resolutionUnit)}return this._updateFormatOut("tiff",J)}function nE(J){return this.heif({...J,compression:"av1"})}function sE(J){if(x.object(J)){if(x.string(J.compression)&&x.inArray(J.compression,["av1","hevc"]))this.options.heifCompression=J.compression;else throw x.invalidParameterError("compression","one of: av1, hevc",J.compression);if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.heifQuality=J.quality;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);if(x.defined(J.lossless))if(x.bool(J.lossless))this.options.heifLossless=J.lossless;else throw x.invalidParameterError("lossless","boolean",J.lossless);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,0,9))this.options.heifEffort=J.effort;else throw x.invalidParameterError("effort","integer between 0 and 9",J.effort);if(x.defined(J.chromaSubsampling))if(x.string(J.chromaSubsampling)&&x.inArray(J.chromaSubsampling,["4:2:0","4:4:4"]))this.options.heifChromaSubsampling=J.chromaSubsampling;else throw x.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",J.chromaSubsampling);if(x.defined(J.bitdepth))if(x.integer(J.bitdepth)&&x.inArray(J.bitdepth,[8,10,12])){if(J.bitdepth!==8&&this.constructor.versions.heif)throw x.invalidParameterError("bitdepth when using prebuilt binaries",8,J.bitdepth);this.options.heifBitdepth=J.bitdepth}else throw x.invalidParameterError("bitdepth","8, 10 or 12",J.bitdepth)}else throw x.invalidParameterError("options","Object",J);return this._updateFormatOut("heif",J)}function iE(J){if(x.object(J)){if(x.defined(J.quality))if(x.integer(J.quality)&&x.inRange(J.quality,1,100))this.options.jxlDistance=J.quality>=30?0.1+(100-J.quality)*0.09:0.017666666666666667*J.quality*J.quality-1.15*J.quality+25;else throw x.invalidParameterError("quality","integer between 1 and 100",J.quality);else if(x.defined(J.distance))if(x.number(J.distance)&&x.inRange(J.distance,0,15))this.options.jxlDistance=J.distance;else throw x.invalidParameterError("distance","number between 0.0 and 15.0",J.distance);if(x.defined(J.decodingTier))if(x.integer(J.decodingTier)&&x.inRange(J.decodingTier,0,4))this.options.jxlDecodingTier=J.decodingTier;else throw x.invalidParameterError("decodingTier","integer between 0 and 4",J.decodingTier);if(x.defined(J.lossless))if(x.bool(J.lossless))this.options.jxlLossless=J.lossless;else throw x.invalidParameterError("lossless","boolean",J.lossless);if(x.defined(J.effort))if(x.integer(J.effort)&&x.inRange(J.effort,1,9))this.options.jxlEffort=J.effort;else throw x.invalidParameterError("effort","integer between 1 and 9",J.effort)}return yY(J,this.options),this._updateFormatOut("jxl",J)}function tE(J){if(x.object(J)){if(x.defined(J.depth))if(x.string(J.depth)&&x.inArray(J.depth,["char","uchar","short","ushort","int","uint","float","complex","double","dpcomplex"]))this.options.rawDepth=J.depth;else throw x.invalidParameterError("depth","one of: char, uchar, short, ushort, int, uint, float, complex, double, dpcomplex",J.depth)}return this._updateFormatOut("raw")}function oE(J){if(x.object(J)){if(x.defined(J.size))if(x.integer(J.size)&&x.inRange(J.size,1,8192))this.options.tileSize=J.size;else throw x.invalidParameterError("size","integer between 1 and 8192",J.size);if(x.defined(J.overlap))if(x.integer(J.overlap)&&x.inRange(J.overlap,0,8192)){if(J.overlap>this.options.tileSize)throw x.invalidParameterError("overlap",`<= size (${this.options.tileSize})`,J.overlap);this.options.tileOverlap=J.overlap}else throw x.invalidParameterError("overlap","integer between 0 and 8192",J.overlap);if(x.defined(J.container))if(x.string(J.container)&&x.inArray(J.container,["fs","zip"]))this.options.tileContainer=J.container;else throw x.invalidParameterError("container","one of: fs, zip",J.container);if(x.defined(J.layout))if(x.string(J.layout)&&x.inArray(J.layout,["dz","google","iiif","iiif3","zoomify"]))this.options.tileLayout=J.layout;else throw x.invalidParameterError("layout","one of: dz, google, iiif, iiif3, zoomify",J.layout);if(x.defined(J.angle))if(x.integer(J.angle)&&!(J.angle%90))this.options.tileAngle=J.angle;else throw x.invalidParameterError("angle","positive/negative multiple of 90",J.angle);if(this._setBackgroundColourOption("tileBackground",J.background),x.defined(J.depth))if(x.string(J.depth)&&x.inArray(J.depth,["onepixel","onetile","one"]))this.options.tileDepth=J.depth;else throw x.invalidParameterError("depth","one of: onepixel, onetile, one",J.depth);if(x.defined(J.skipBlanks))if(x.integer(J.skipBlanks)&&x.inRange(J.skipBlanks,-1,65535))this.options.tileSkipBlanks=J.skipBlanks;else throw x.invalidParameterError("skipBlanks","integer between -1 and 255/65535",J.skipBlanks);else if(x.defined(J.layout)&&J.layout==="google")this.options.tileSkipBlanks=5;let Z=x.bool(J.center)?J.center:J.centre;if(x.defined(Z))this._setBooleanOption("tileCentre",Z);if(x.defined(J.id))if(x.string(J.id))this.options.tileId=J.id;else throw x.invalidParameterError("id","string",J.id);if(x.defined(J.basename))if(x.string(J.basename))this.options.tileBasename=J.basename;else throw x.invalidParameterError("basename","string",J.basename)}if(x.inArray(this.options.formatOut,["jpeg","png","webp"]))this.options.tileFormat=this.options.formatOut;else if(this.options.formatOut!=="input")throw x.invalidParameterError("format","one of: jpeg, png, webp",this.options.formatOut);return this._updateFormatOut("dz")}function JL(J){if(!x.plainObject(J))throw x.invalidParameterError("options","object",J);if(x.integer(J.seconds)&&x.inRange(J.seconds,0,3600))this.options.timeoutSeconds=J.seconds;else throw x.invalidParameterError("seconds","integer between 0 and 3600",J.seconds);return this}function $L(J,Z){if(!(x.object(Z)&&Z.force===!1))this.options.formatOut=J;return this}function ZL(J,Z){if(x.bool(Z))this.options[J]=Z;else throw x.invalidParameterError(J,"boolean",Z)}function QL(){if(!this.options.streamOut){this.options.streamOut=!0;let J=Error();this._pipeline(void 0,J)}}function WL(J,Z){if(typeof J==="function"){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),z5.pipeline(this.options,($,Q,W)=>{if($)J(x.nativeError($,Z));else J(null,Q,W)})});else z5.pipeline(this.options,($,Q,W)=>{if($)J(x.nativeError($,Z));else J(null,Q,W)});return this}else if(this.options.streamOut){if(this._isStreamInput()){if(this.once("finish",()=>{this._flattenBufferIn(),z5.pipeline(this.options,($,Q,W)=>{if($)this.emit("error",x.nativeError($,Z));else this.emit("info",W),this.push(Q);this.push(null),this.on("end",()=>this.emit("close"))})}),this.streamInFinished)this.emit("finish")}else z5.pipeline(this.options,($,Q,W)=>{if($)this.emit("error",x.nativeError($,Z));else this.emit("info",W),this.push(Q);this.push(null),this.on("end",()=>this.emit("close"))});return this}else if(this._isStreamInput())return new Promise(($,Q)=>{this.once("finish",()=>{this._flattenBufferIn(),z5.pipeline(this.options,(W,Y,H)=>{if(W)Q(x.nativeError(W,Z));else if(this.options.resolveWithObject)$({data:Y,info:H});else $(Y)})})});else return new Promise(($,Q)=>{z5.pipeline(this.options,(W,Y,H)=>{if(W)Q(x.nativeError(W,Z));else if(this.options.resolveWithObject)$({data:Y,info:H});else $(Y)})})}xV.exports=function(J){Object.assign(J.prototype,{toFile:kE,toBuffer:xE,keepExif:yE,withExif:vE,withExifMerge:OE,keepIccProfile:bE,withIccProfile:hE,keepXmp:fE,withXmp:dE,keepMetadata:uE,withMetadata:gE,toFormat:lE,jpeg:cE,jp2:rE,png:mE,webp:aE,tiff:eE,avif:nE,heif:sE,jxl:iE,gif:pE,raw:tE,tile:oE,timeout:JL,_updateFormatOut:$L,_setBooleanOption:ZL,_read:QL,_pipeline:WL})}});var hV=J6((DB,bV)=>{var KL=b6("node:events"),K8=aZ(),y4=i4(),{runtimePlatformArch:YL}=IY(),R4=p5(),vV=YL(),vY=R4.libvipsVersion(),MJ=R4.format();MJ.heif.output.alias=["avif","heic"];MJ.jpeg.output.alias=["jpe","jpg"];MJ.tiff.output.alias=["tif"];MJ.jp2k.output.alias=["j2c","j2k","jp2","jpx"];var GL={nearest:"nearest",bilinear:"bilinear",bicubic:"bicubic",locallyBoundedBicubic:"lbb",nohalo:"nohalo",vertexSplitQuadraticBasisSpline:"vsqbs"},E5={vips:vY.semver};if(!vY.isGlobal)if(!vY.isWasm)try{E5=b6(`@img/sharp-${vV}/versions`)}catch(J){try{E5=b6(`@img/sharp-libvips-${vV}/versions`)}catch(Z){}}else try{E5=(()=>{throw new Error("Cannot require module "+"@img/sharp-wasm32/versions");})()}catch(J){}E5.sharp=FY().version;if(E5.heif&&MJ.heif)MJ.heif.input.fileSuffix=[".avif"],MJ.heif.output.alias=["avif"];function OV(J){if(y4.bool(J))if(J)return R4.cache(50,20,100);else return R4.cache(0,0,0);else if(y4.object(J))return R4.cache(J.memory,J.files,J.items);else return R4.cache()}OV(!0);function XL(J){return R4.concurrency(y4.integer(J)?J:null)}if(K8.familySync()===K8.GLIBC&&!R4._isUsingJemalloc())R4.concurrency(1);else if(K8.familySync()===K8.MUSL&&R4.concurrency()===1024)R4.concurrency(b6("node:os").availableParallelism());var qL=new KL.EventEmitter;function HL(){return R4.counters()}function VL(J){return R4.simd(y4.bool(J)?J:null)}function UL(J){if(y4.object(J))if(Array.isArray(J.operation)&&J.operation.every(y4.string))R4.block(J.operation,!0);else throw y4.invalidParameterError("operation","Array<string>",J.operation);else throw y4.invalidParameterError("options","object",J)}function NL(J){if(y4.object(J))if(Array.isArray(J.operation)&&J.operation.every(y4.string))R4.block(J.operation,!1);else throw y4.invalidParameterError("operation","Array<string>",J.operation);else throw y4.invalidParameterError("options","object",J)}bV.exports=function(J){J.cache=OV,J.concurrency=XL,J.counters=HL,J.simd=VL,J.format=MJ,J.interpolators=GL,J.versions=E5,J.queue=qL,J.block=UL,J.unblock=NL}});var dV=J6((wB,fV)=>{var FJ=tH();$V()(FJ);GV()(FJ);qV()(FJ);zV()(FJ);CV()(FJ);MV()(FJ);yV()(FJ);hV()(FJ);fV.exports=FJ});import*as zL from"node:fs";import*as EL from"node:path";import*as LL from"node:url";var JY={};qU(JY,{registerBackend:()=>sG,env:()=>UU,Tensor:()=>aJ,TRACE_FUNC_END:()=>yZ,TRACE_FUNC_BEGIN:()=>xZ,TRACE:()=>VX,InferenceSession:()=>NU});var kZ=new Map,cJ=[],sG=(J,Z,$)=>{if(Z&&typeof Z.init==="function"&&typeof Z.createInferenceSessionHandler==="function"){let Q=kZ.get(J);if(Q===void 0)kZ.set(J,{backend:Z,priority:$});else if(Q.priority>$)return;else if(Q.priority===$){if(Q.backend!==Z)throw Error(`cannot register backend "${J}" using priority ${$}`)}if($>=0){let W=cJ.indexOf(J);if(W!==-1)cJ.splice(W,1);for(let Y=0;Y<cJ.length;Y++)if(kZ.get(cJ[Y]).priority<=$){cJ.splice(Y,0,J);return}cJ.push(J)}return}throw TypeError("not a valid backend")},VU=async(J)=>{let Z=kZ.get(J);if(!Z)return"backend not found.";if(Z.initialized)return Z.backend;else if(Z.aborted)return Z.error;else{let $=!!Z.initPromise;try{if(!$)Z.initPromise=Z.backend.init(J);return await Z.initPromise,Z.initialized=!0,Z.backend}catch(Q){if(!$)Z.error=`${Q}`,Z.aborted=!0;return Z.error}finally{delete Z.initPromise}}},iG=async(J)=>{let Z=J.executionProviders||[],$=Z.map((q)=>typeof q==="string"?q:q.name),Q=$.length===0?cJ:$,W,Y=[],H=new Set;for(let q of Q){let z=await VU(q);if(typeof z==="string")Y.push({name:q,err:z});else{if(!W)W=z;if(W===z)H.add(q)}}if(!W)throw Error(`no available backend found. ERR: ${Y.map((q)=>`[${q.name}] ${q.err}`).join(", ")}`);for(let{name:q,err:z}of Y)if($.includes(q))console.warn(`removing requested execution provider "${q}" from session options because it is not available: ${z}`);let G=Z.filter((q)=>H.has(typeof q==="string"?q:q.name));return[W,new Proxy(J,{get:(q,z)=>{if(z==="executionProviders")return G;return Reflect.get(q,z)}})]};var tG="1.21.0";var oG="warning",M4={wasm:{},webgl:{},webgpu:{},versions:{common:tG},set logLevel(J){if(J===void 0)return;if(typeof J!=="string"||["verbose","info","warning","error","fatal"].indexOf(J)===-1)throw Error(`Unsupported logging level: ${J}`);oG=J},get logLevel(){return oG}};Object.defineProperty(M4,"logLevel",{enumerable:!0});var UU=M4;var JX=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);$.width=J.dims[3],$.height=J.dims[2];let Q=$.getContext("2d");if(Q!=null){let W,Y;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")W=J.dims[2],Y=J.dims[3];else W=J.dims[3],Y=J.dims[2];let H=Z?.format!==void 0?Z.format:"RGB",G=Z?.norm,q,z;if(G===void 0||G.mean===void 0)q=[255,255,255,255];else if(typeof G.mean==="number")q=[G.mean,G.mean,G.mean,G.mean];else if(q=[G.mean[0],G.mean[1],G.mean[2],0],G.mean[3]!==void 0)q[3]=G.mean[3];if(G===void 0||G.bias===void 0)z=[0,0,0,0];else if(typeof G.bias==="number")z=[G.bias,G.bias,G.bias,G.bias];else if(z=[G.bias[0],G.bias[1],G.bias[2],0],G.bias[3]!==void 0)z[3]=G.bias[3];let U=Y*W,N=0,L=U,w=U*2,F=-1;if(H==="RGBA")N=0,L=U,w=U*2,F=U*3;else if(H==="RGB")N=0,L=U,w=U*2;else if(H==="RBG")N=0,w=U,L=U*2;for(let v=0;v<Y;v++)for(let I=0;I<W;I++){let j=(J.data[N++]-z[0])*q[0],y=(J.data[L++]-z[1])*q[1],g=(J.data[w++]-z[2])*q[2],A=F===-1?255:(J.data[F++]-z[3])*q[3];Q.fillStyle="rgba("+j+","+y+","+g+","+A+")",Q.fillRect(I,v,1,1)}if("toDataURL"in $)return $.toDataURL();else throw Error("toDataURL is not supported")}else throw Error("Can not access image data")},$X=(J,Z)=>{let $=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),Q;if($!=null){let W,Y,H;if(Z?.tensorLayout!==void 0&&Z.tensorLayout==="NHWC")W=J.dims[2],Y=J.dims[1],H=J.dims[3];else W=J.dims[3],Y=J.dims[2],H=J.dims[1];let G=Z!==void 0?Z.format!==void 0?Z.format:"RGB":"RGB",q=Z?.norm,z,U;if(q===void 0||q.mean===void 0)z=[255,255,255,255];else if(typeof q.mean==="number")z=[q.mean,q.mean,q.mean,q.mean];else if(z=[q.mean[0],q.mean[1],q.mean[2],255],q.mean[3]!==void 0)z[3]=q.mean[3];if(q===void 0||q.bias===void 0)U=[0,0,0,0];else if(typeof q.bias==="number")U=[q.bias,q.bias,q.bias,q.bias];else if(U=[q.bias[0],q.bias[1],q.bias[2],0],q.bias[3]!==void 0)U[3]=q.bias[3];let N=Y*W;if(Z!==void 0){if(Z.format!==void 0&&H===4&&Z.format!=="RGBA"||H===3&&Z.format!=="RGB"&&Z.format!=="BGR")throw Error("Tensor format doesn't match input tensor dims")}let L=4,w=0,F=1,v=2,I=3,j=0,y=N,g=N*2,A=-1;if(G==="RGBA")j=0,y=N,g=N*2,A=N*3;else if(G==="RGB")j=0,y=N,g=N*2;else if(G==="RBG")j=0,g=N,y=N*2;Q=$.createImageData(W,Y);for(let T=0;T<Y*W;w+=L,F+=L,v+=L,I+=L,T++)Q.data[w]=(J.data[j++]-U[0])*z[0],Q.data[F]=(J.data[y++]-U[1])*z[1],Q.data[v]=(J.data[g++]-U[2])*z[2],Q.data[I]=A===-1?255:(J.data[A++]-U[3])*z[3]}else throw Error("Can not access image data");return Q};var oK=(J,Z)=>{if(J===void 0)throw Error("Image buffer must be defined");if(Z.height===void 0||Z.width===void 0)throw Error("Image height and width must be defined");if(Z.tensorLayout==="NHWC")throw Error("NHWC Tensor layout is not supported yet");let{height:$,width:Q}=Z,W=Z.norm??{mean:255,bias:0},Y,H;if(typeof W.mean==="number")Y=[W.mean,W.mean,W.mean,W.mean];else Y=[W.mean[0],W.mean[1],W.mean[2],W.mean[3]??255];if(typeof W.bias==="number")H=[W.bias,W.bias,W.bias,W.bias];else H=[W.bias[0],W.bias[1],W.bias[2],W.bias[3]??0];let G=Z.format!==void 0?Z.format:"RGBA",q=Z.tensorFormat!==void 0?Z.tensorFormat!==void 0?Z.tensorFormat:"RGB":"RGB",z=$*Q,U=q==="RGBA"?new Float32Array(z*4):new Float32Array(z*3),N=4,L=0,w=1,F=2,v=3,I=0,j=z,y=z*2,g=-1;if(G==="RGB")N=3,L=0,w=1,F=2,v=-1;if(q==="RGBA")g=z*3;else if(q==="RBG")I=0,y=z,j=z*2;else if(q==="BGR")y=0,j=z,I=z*2;for(let T=0;T<z;T++,L+=N,F+=N,w+=N,v+=N)if(U[I++]=(J[L]+H[0])/Y[0],U[j++]=(J[w]+H[1])/Y[1],U[y++]=(J[F]+H[2])/Y[2],g!==-1&&v!==-1)U[g++]=(J[v]+H[3])/Y[3];return q==="RGBA"?new X4("float32",U,[1,4,$,Q]):new X4("float32",U,[1,3,$,Q])},ZX=async(J,Z)=>{let $=typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement,Q=typeof ImageData<"u"&&J instanceof ImageData,W=typeof ImageBitmap<"u"&&J instanceof ImageBitmap,Y=typeof J==="string",H,G=Z??{},q=()=>{if(typeof document<"u")return document.createElement("canvas");else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);else throw Error("Canvas is not supported")},z=(U)=>{if(typeof HTMLCanvasElement<"u"&&U instanceof HTMLCanvasElement)return U.getContext("2d");else if(U instanceof OffscreenCanvas)return U.getContext("2d");else return null};if($){let U=q();U.width=J.width,U.height=J.height;let N=z(U);if(N!=null){let{height:L,width:w}=J;if(Z!==void 0&&Z.resizedHeight!==void 0&&Z.resizedWidth!==void 0)L=Z.resizedHeight,w=Z.resizedWidth;if(Z!==void 0){if(G=Z,Z.tensorFormat!==void 0)throw Error("Image input config format must be RGBA for HTMLImageElement");else G.tensorFormat="RGBA";G.height=L,G.width=w}else G.tensorFormat="RGBA",G.height=L,G.width=w;N.drawImage(J,0,0),H=N.getImageData(0,0,w,L).data}else throw Error("Can not access image data")}else if(Q){let U,N;if(Z!==void 0&&Z.resizedWidth!==void 0&&Z.resizedHeight!==void 0)U=Z.resizedHeight,N=Z.resizedWidth;else U=J.height,N=J.width;if(Z!==void 0)G=Z;if(G.format="RGBA",G.height=U,G.width=N,Z!==void 0){let L=q();L.width=N,L.height=U;let w=z(L);if(w!=null)w.putImageData(J,0,0),H=w.getImageData(0,0,N,U).data;else throw Error("Can not access image data")}else H=J.data}else if(W){if(Z===void 0)throw Error("Please provide image config with format for Imagebitmap");let U=q();U.width=J.width,U.height=J.height;let N=z(U);if(N!=null){let{height:L,width:w}=J;return N.drawImage(J,0,0,w,L),H=N.getImageData(0,0,w,L).data,G.height=L,G.width=w,oK(H,G)}else throw Error("Can not access image data")}else if(Y)return new Promise((U,N)=>{let L=q(),w=z(L);if(!J||!w)return N();let F=new Image;F.crossOrigin="Anonymous",F.src=J,F.onload=()=>{L.width=F.width,L.height=F.height,w.drawImage(F,0,0,L.width,L.height);let v=w.getImageData(0,0,L.width,L.height);G.height=L.height,G.width=L.width,U(oK(v.data,G))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(H!==void 0)return oK(H,G);else throw Error("Input data provided is not supported - aborted tensor creation")},QX=(J,Z)=>{let{width:$,height:Q,download:W,dispose:Y}=Z;return new X4({location:"texture",type:"float32",texture:J,dims:[1,Q,$,4],download:W,dispose:Y})},WX=(J,Z)=>{let{dataType:$,dims:Q,download:W,dispose:Y}=Z;return new X4({location:"gpu-buffer",type:$??"float32",gpuBuffer:J,dims:Q,download:W,dispose:Y})},KX=(J,Z)=>{let{dataType:$,dims:Q,download:W,dispose:Y}=Z;return new X4({location:"ml-tensor",type:$??"float32",mlTensor:J,dims:Q,download:W,dispose:Y})},YX=(J,Z,$)=>new X4({location:"cpu-pinned",type:J,data:Z,dims:$??[Z.length]});var mJ=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),b5=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),GX=!1,XX=()=>{if(!GX){GX=!0;let J=typeof BigInt64Array<"u"&&BigInt64Array.from,Z=typeof BigUint64Array<"u"&&BigUint64Array.from,$=globalThis.Float16Array,Q=typeof $<"u"&&$.from;if(J)mJ.set("int64",BigInt64Array),b5.set(BigInt64Array,"int64");if(Z)mJ.set("uint64",BigUint64Array),b5.set(BigUint64Array,"uint64");if(Q)mJ.set("float16",$),b5.set($,"float16");else mJ.set("float16",Uint16Array)}};var qX=(J)=>{let Z=1;for(let $=0;$<J.length;$++){let Q=J[$];if(typeof Q!=="number"||!Number.isSafeInteger(Q))throw TypeError(`dims[${$}] must be an integer, got: ${Q}`);if(Q<0)throw RangeError(`dims[${$}] must be a non-negative integer, got: ${Q}`);Z*=Q}return Z},HX=(J,Z)=>{switch(J.location){case"cpu":return new X4(J.type,J.data,Z);case"cpu-pinned":return new X4({location:"cpu-pinned",data:J.data,type:J.type,dims:Z});case"texture":return new X4({location:"texture",texture:J.texture,type:J.type,dims:Z});case"gpu-buffer":return new X4({location:"gpu-buffer",gpuBuffer:J.gpuBuffer,type:J.type,dims:Z});case"ml-tensor":return new X4({location:"ml-tensor",mlTensor:J.mlTensor,type:J.type,dims:Z});default:throw Error(`tensorReshape: tensor location ${J.location} is not supported`)}};class X4{constructor(J,Z,$){XX();let Q,W;if(typeof J==="object"&&"location"in J)switch(this.dataLocation=J.location,Q=J.type,W=J.dims,J.location){case"cpu-pinned":{let H=mJ.get(Q);if(!H)throw TypeError(`unsupported type "${Q}" to create tensor from pinned buffer`);if(!(J.data instanceof H))throw TypeError(`buffer should be of type ${H.name}`);this.cpuData=J.data;break}case"texture":{if(Q!=="float32")throw TypeError(`unsupported type "${Q}" to create tensor from texture`);this.gpuTextureData=J.texture,this.downloader=J.download,this.disposer=J.dispose;break}case"gpu-buffer":{if(Q!=="float32"&&Q!=="float16"&&Q!=="int32"&&Q!=="int64"&&Q!=="uint32"&&Q!=="uint8"&&Q!=="bool"&&Q!=="uint4"&&Q!=="int4")throw TypeError(`unsupported type "${Q}" to create tensor from gpu buffer`);this.gpuBufferData=J.gpuBuffer,this.downloader=J.download,this.disposer=J.dispose;break}case"ml-tensor":{if(Q!=="float32"&&Q!=="float16"&&Q!=="int32"&&Q!=="int64"&&Q!=="uint32"&&Q!=="uint64"&&Q!=="int8"&&Q!=="uint8"&&Q!=="bool"&&Q!=="uint4"&&Q!=="int4")throw TypeError(`unsupported type "${Q}" to create tensor from MLTensor`);this.mlTensorData=J.mlTensor,this.downloader=J.download,this.disposer=J.dispose;break}default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let H,G;if(typeof J==="string")if(Q=J,G=$,J==="string"){if(!Array.isArray(Z))throw TypeError("A string tensor's data must be a string array.");H=Z}else{let q=mJ.get(J);if(q===void 0)throw TypeError(`Unsupported tensor type: ${J}.`);if(Array.isArray(Z))if(J==="float16"&&q===Uint16Array||J==="uint4"||J==="int4")throw TypeError(`Creating a ${J} tensor from number array is not supported. Please use ${q.name} as data.`);else if(J==="uint64"||J==="int64")H=q.from(Z,BigInt);else H=q.from(Z);else if(Z instanceof q)H=Z;else if(Z instanceof Uint8ClampedArray)if(J==="uint8")H=Uint8Array.from(Z);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(J==="float16"&&Z instanceof Uint16Array&&q!==Uint16Array)H=new globalThis.Float16Array(Z.buffer,Z.byteOffset,Z.length);else throw TypeError(`A ${Q} tensor's data must be type of ${q}`)}else if(G=Z,Array.isArray(J)){if(J.length===0)throw TypeError("Tensor type cannot be inferred from an empty array.");let q=typeof J[0];if(q==="string")Q="string",H=J;else if(q==="boolean")Q="bool",H=Uint8Array.from(J);else throw TypeError(`Invalid element type of data array: ${q}.`)}else if(J instanceof Uint8ClampedArray)Q="uint8",H=Uint8Array.from(J);else{let q=b5.get(J.constructor);if(q===void 0)throw TypeError(`Unsupported type for tensor data: ${J.constructor}.`);Q=q,H=J}if(G===void 0)G=[H.length];else if(!Array.isArray(G))throw TypeError("A tensor's dims must be a number array");W=G,this.cpuData=H,this.dataLocation="cpu"}let Y=qX(W);if(this.cpuData&&Y!==this.cpuData.length)if((Q==="uint4"||Q==="int4")&&Math.ceil(Y/2)===this.cpuData.length);else throw Error(`Tensor's size(${Y}) does not match data length(${this.cpuData.length}).`);this.type=Q,this.dims=W,this.size=Y}static async fromImage(J,Z){return ZX(J,Z)}static fromTexture(J,Z){return QX(J,Z)}static fromGpuBuffer(J,Z){return WX(J,Z)}static fromMLTensor(J,Z){return KX(J,Z)}static fromPinnedBuffer(J,Z,$){return YX(J,Z,$)}toDataURL(J){return JX(this,J)}toImageData(J){return $X(this,J)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(J){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let Z=await this.downloader();if(this.downloader=void 0,this.dataLocation="cpu",this.cpuData=Z,J&&this.disposer)this.disposer(),this.disposer=void 0;return Z}finally{this.isDownloading=!1}}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");if(this.disposer)this.disposer(),this.disposer=void 0;this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw Error("The tensor is disposed.")}reshape(J){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return HX(this,J)}}var aJ=X4;var VX=(J,Z)=>{if(typeof M4.trace>"u"?!M4.wasm.trace:!M4.trace)return;console.timeStamp(`${J}::ORT::${Z}`)},UX=(J,Z)=>{let $=Error().stack?.split(/\r\n|\r|\n/g)||[],Q=!1;for(let W=0;W<$.length;W++){if(Q&&!$[W].includes("TRACE_FUNC")){let Y=`FUNC_${J}::${$[W].trim().split(" ")[1]}`;if(Z)Y+=`::${Z}`;VX("CPU",Y);return}if($[W].includes("TRACE_FUNC"))Q=!0}},xZ=(J)=>{if(typeof M4.trace>"u"?!M4.wasm.trace:!M4.trace)return;UX("BEGIN",J)},yZ=(J)=>{if(typeof M4.trace>"u"?!M4.wasm.trace:!M4.trace)return;UX("END",J)};class vZ{constructor(J){this.handler=J}async run(J,Z,$){xZ();let Q={},W={};if(typeof J!=="object"||J===null||J instanceof aJ||Array.isArray(J))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let Y=!0;if(typeof Z==="object"){if(Z===null)throw TypeError("Unexpected argument[1]: cannot be null.");if(Z instanceof aJ)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(Z)){if(Z.length===0)throw TypeError("'fetches' cannot be an empty array.");Y=!1;for(let q of Z){if(typeof q!=="string")throw TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(q)===-1)throw RangeError(`'fetches' contains invalid output name: ${q}.`);Q[q]=null}if(typeof $==="object"&&$!==null)W=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else{let q=!1,z=Object.getOwnPropertyNames(Z);for(let U of this.outputNames)if(z.indexOf(U)!==-1){let N=Z[U];if(N===null||N instanceof aJ)q=!0,Y=!1,Q[U]=N}if(q){if(typeof $==="object"&&$!==null)W=$;else if(typeof $<"u")throw TypeError("'options' must be an object.")}else W=Z}}else if(typeof Z<"u")throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let q of this.inputNames)if(typeof J[q]>"u")throw Error(`input '${q}' is missing in 'feeds'.`);if(Y)for(let q of this.outputNames)Q[q]=null;let H=await this.handler.run(J,Q,W),G={};for(let q in H)if(Object.hasOwnProperty.call(H,q)){let z=H[q];if(z instanceof aJ)G[q]=z;else G[q]=new aJ(z.type,z.data,z.dims)}return yZ(),G}async release(){return this.handler.dispose()}static async create(J,Z,$,Q){xZ();let W,Y={};if(typeof J==="string"){if(W=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof Uint8Array){if(W=J,typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z<"u")throw TypeError("'options' must be an object.")}else if(J instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&J instanceof SharedArrayBuffer){let z=J,U=0,N=J.byteLength;if(typeof Z==="object"&&Z!==null)Y=Z;else if(typeof Z==="number"){if(U=Z,!Number.isSafeInteger(U))throw RangeError("'byteOffset' must be an integer.");if(U<0||U>=z.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${z.byteLength}).`);if(N=J.byteLength-U,typeof $==="number"){if(N=$,!Number.isSafeInteger(N))throw RangeError("'byteLength' must be an integer.");if(N<=0||U+N>z.byteLength)throw RangeError(`'byteLength' is out of range (0, ${z.byteLength-U}].`);if(typeof Q==="object"&&Q!==null)Y=Q;else if(typeof Q<"u")throw TypeError("'options' must be an object.")}else if(typeof $<"u")throw TypeError("'byteLength' must be a number.")}else if(typeof Z<"u")throw TypeError("'options' must be an object.");W=new Uint8Array(z,U,N)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[H,G]=await iG(Y),q=await H.createInferenceSessionHandler(W,G);return yZ(),new vZ(q)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}var NU=vZ;var AL=nG(Fq(),1),BL=nG(dV(),1),__dirname="/Users/kyle/rules/node_modules/@huggingface/transformers/dist",RL={"node:fs":(J)=>{/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/J.exports=zL},"node:path":(J)=>{/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/J.exports=EL},"node:url":(J)=>{/*!***************************!*\
  !*** external "node:url" ***!
  \***************************/J.exports=LL},"onnxruntime-common":(J)=>{/*!*************************************!*\
  !*** external "onnxruntime-common" ***!
  \*************************************/J.exports=JY},"onnxruntime-node":(J)=>{/*!***********************************!*\
  !*** external "onnxruntime-node" ***!
  \***********************************/J.exports=AL},sharp:(J)=>{/*!************************!*\
  !*** external "sharp" ***!
  \************************/J.exports=BL},"?8b6b":()=>{/*!*********************************!*\
  !*** onnxruntime-web (ignored) ***!
  \*********************************/},"./node_modules/@huggingface/jinja/dist/index.js":(J,Z,$)=>{/*!*******************************************************!*\
  !*** ./node_modules/@huggingface/jinja/dist/index.js ***!
  \*******************************************************/$.r(Z),$.d(Z,{Environment:()=>y0,Interpreter:()=>a0,Template:()=>YJ,parse:()=>A0,tokenize:()=>U});var Q=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),W=class{constructor(E,u){this.value=E,this.type=u}};function Y(E){return/\w/.test(E)}function H(E){return/[0-9]/.test(E)}var G=[["{%",Q.OpenStatement],["%}",Q.CloseStatement],["{{",Q.OpenExpression],["}}",Q.CloseExpression],["(",Q.OpenParen],[")",Q.CloseParen],["{",Q.OpenCurlyBracket],["}",Q.CloseCurlyBracket],["[",Q.OpenSquareBracket],["]",Q.CloseSquareBracket],[",",Q.Comma],[".",Q.Dot],[":",Q.Colon],["|",Q.Pipe],["<=",Q.ComparisonBinaryOperator],[">=",Q.ComparisonBinaryOperator],["==",Q.ComparisonBinaryOperator],["!=",Q.ComparisonBinaryOperator],["<",Q.ComparisonBinaryOperator],[">",Q.ComparisonBinaryOperator],["+",Q.AdditiveBinaryOperator],["-",Q.AdditiveBinaryOperator],["~",Q.AdditiveBinaryOperator],["*",Q.MultiplicativeBinaryOperator],["/",Q.MultiplicativeBinaryOperator],["%",Q.MultiplicativeBinaryOperator],["=",Q.Equals]],q=new Map([["n",`
`],["t","\t"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function z(E,u={}){if(E.endsWith(`
`))E=E.slice(0,-1);if(u.lstrip_blocks)E=E.replace(/^[ \t]*({[#%-])/gm,"$1");if(u.trim_blocks)E=E.replace(/([#%-]})\n/g,"$1");return E.replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{").replace(/-#}\s*/g,"#}").replace(/\s*{#-/g,"{#").replace(/{%\s*(end)?generation\s*%}/gs,"")}function U(E,u={}){let C=[],f=z(E,u),r=0,G0=0,L0=(c0)=>{let t0="";while(c0(f[r])){if(f[r]==="\\"){if(++r,r>=f.length)throw SyntaxError("Unexpected end of input");let v0=f[r++],U6=q.get(v0);if(U6===void 0)throw SyntaxError(`Unexpected escaped character: ${v0}`);t0+=U6;continue}if(t0+=f[r++],r>=f.length)throw SyntaxError("Unexpected end of input")}return t0};J:while(r<f.length){let c0=C.at(-1)?.type;if(c0===void 0||c0===Q.CloseStatement||c0===Q.CloseExpression||c0===Q.Comment){let v0="";while(r<f.length&&!(f[r]==="{"&&(f[r+1]==="%"||f[r+1]==="{"||f[r+1]==="#")))v0+=f[r++];if(v0.length>0){C.push(new W(v0,Q.Text));continue}}if(f[r]==="{"&&f[r+1]==="#"){r+=2;let v0="";while(f[r]!=="#"||f[r+1]!=="}"){if(r+2>=f.length)throw SyntaxError("Missing end of comment tag");v0+=f[r++]}C.push(new W(v0,Q.Comment)),r+=2;continue}L0((v0)=>/\s/.test(v0));let t0=f[r];if(t0==="-"||t0==="+"){let v0=C.at(-1)?.type;if(v0===Q.Text||v0===void 0)throw SyntaxError(`Unexpected character: ${t0}`);switch(v0){case Q.Identifier:case Q.NumericLiteral:case Q.StringLiteral:case Q.CloseParen:case Q.CloseSquareBracket:break;default:{++r;let U6=L0(H);C.push(new W(`${t0}${U6}`,U6.length>0?Q.NumericLiteral:Q.UnaryOperator));continue}}}for(let[v0,U6]of G){if(v0==="}}"&&G0>0)continue;if(f.slice(r,r+v0.length)===v0){if(C.push(new W(v0,U6)),U6===Q.OpenExpression)G0=0;else if(U6===Q.OpenCurlyBracket)++G0;else if(U6===Q.CloseCurlyBracket)--G0;r+=v0.length;continue J}}if(t0==="'"||t0==='"'){++r;let v0=L0((U6)=>U6!==t0);C.push(new W(v0,Q.StringLiteral)),++r;continue}if(H(t0)){let v0=L0(H);if(f[r]==="."&&H(f[r+1])){++r;let U6=L0(H);v0=`${v0}.${U6}`}C.push(new W(v0,Q.NumericLiteral));continue}if(Y(t0)){let v0=L0(Y);C.push(new W(v0,Q.Identifier));continue}throw SyntaxError(`Unexpected character: ${t0}`)}return C}var N=class{type="Statement"},L=class extends N{constructor(E){super();this.body=E}type="Program"},w=class extends N{constructor(E,u,C){super();this.test=E,this.body=u,this.alternate=C}type="If"},F=class extends N{constructor(E,u,C,f){super();this.loopvar=E,this.iterable=u,this.body=C,this.defaultBlock=f}type="For"},v=class extends N{type="Break"},I=class extends N{type="Continue"},j=class extends N{constructor(E,u,C){super();this.assignee=E,this.value=u,this.body=C}type="Set"},y=class extends N{constructor(E,u,C){super();this.name=E,this.args=u,this.body=C}type="Macro"},g=class extends N{constructor(E){super();this.value=E}type="Comment"},A=class extends N{type="Expression"},T=class extends A{constructor(E,u,C){super();this.object=E,this.property=u,this.computed=C}type="MemberExpression"},B=class extends A{constructor(E,u){super();this.callee=E,this.args=u}type="CallExpression"},R=class extends A{constructor(E){super();this.value=E}type="Identifier"},P=class extends A{constructor(E){super();this.value=E}type="Literal"},k=class extends P{type="IntegerLiteral"},h=class extends P{type="FloatLiteral"},c=class extends P{type="StringLiteral"},m=class extends P{type="ArrayLiteral"},d=class extends P{type="TupleLiteral"},a=class extends P{type="ObjectLiteral"},n=class extends A{constructor(E,u,C){super();this.operator=E,this.left=u,this.right=C}type="BinaryExpression"},t=class extends A{constructor(E,u){super();this.operand=E,this.filter=u}type="FilterExpression"},Q0=class extends N{constructor(E,u){super();this.filter=E,this.body=u}type="FilterStatement"},o=class extends A{constructor(E,u){super();this.lhs=E,this.test=u}type="SelectExpression"},N0=class extends A{constructor(E,u,C){super();this.operand=E,this.negate=u,this.test=C}type="TestExpression"},w0=class extends A{constructor(E,u){super();this.operator=E,this.argument=u}type="UnaryExpression"},D=class extends A{constructor(E=void 0,u=void 0,C=void 0){super();this.start=E,this.stop=u,this.step=C}type="SliceExpression"},O=class extends A{constructor(E,u){super();this.key=E,this.value=u}type="KeywordArgumentExpression"},p=class extends A{constructor(E){super();this.argument=E}type="SpreadExpression"},Z0=class extends N{constructor(E,u,C){super();this.call=E,this.callerArgs=u,this.body=C}type="CallStatement"},z0=class extends A{constructor(E,u,C){super();this.condition=E,this.trueExpr=u,this.falseExpr=C}type="Ternary"};function A0(E){let u=new L([]),C=0;function f(P0,S0){let m0=E[C++];if(!m0||m0.type!==P0)throw Error(`Parser Error: ${S0}. ${m0.type} !== ${P0}.`);return m0}function r(P0){if(!t0(P0))throw SyntaxError(`Expected ${P0}`);++C}function G0(){switch(E[C].type){case Q.Comment:return new g(E[C++].value);case Q.Text:return v0();case Q.OpenStatement:return U6();case Q.OpenExpression:return E6();default:throw SyntaxError(`Unexpected token type: ${E[C].type}`)}}function L0(...P0){return C+P0.length<=E.length&&P0.every((S0,m0)=>S0===E[C+m0].type)}function c0(...P0){return E[C]?.type===Q.OpenStatement&&E[C+1]?.type===Q.Identifier&&P0.includes(E[C+1]?.value)}function t0(...P0){return C+P0.length<=E.length&&P0.every((S0,m0)=>E[C+m0].type==="Identifier"&&S0===E[C+m0].value)}function v0(){return new c(f(Q.Text,"Expected text token").value)}function U6(){if(f(Q.OpenStatement,"Expected opening statement token"),E[C].type!==Q.Identifier)throw SyntaxError(`Unknown statement, got ${E[C].type}`);let P0=E[C].value,S0;switch(P0){case"set":++C,S0=x6();break;case"if":++C,S0=j6(),f(Q.OpenStatement,"Expected {% token"),r("endif"),f(Q.CloseStatement,"Expected %} token");break;case"macro":++C,S0=U4(),f(Q.OpenStatement,"Expected {% token"),r("endmacro"),f(Q.CloseStatement,"Expected %} token");break;case"for":++C,S0=Z4(),f(Q.OpenStatement,"Expected {% token"),r("endfor"),f(Q.CloseStatement,"Expected %} token");break;case"call":{++C;let m0=null;if(L0(Q.OpenParen))m0=x4();let P6=Y4();if(P6.type!=="Identifier")throw SyntaxError("Expected identifier following call statement");let VJ=x4();f(Q.CloseStatement,"Expected closing statement token");let p4=[];while(!c0("endcall"))p4.push(G0());f(Q.OpenStatement,"Expected '{%'"),r("endcall"),f(Q.CloseStatement,"Expected closing statement token");let C4=new B(P6,VJ);S0=new Z0(C4,m0,p4);break}case"break":++C,f(Q.CloseStatement,"Expected closing statement token"),S0=new v;break;case"continue":++C,f(Q.CloseStatement,"Expected closing statement token"),S0=new I;break;case"filter":{++C;let m0=Y4();if(m0 instanceof R&&L0(Q.OpenParen))m0=k4(m0);f(Q.CloseStatement,"Expected closing statement token");let P6=[];while(!c0("endfilter"))P6.push(G0());f(Q.OpenStatement,"Expected '{%'"),r("endfilter"),f(Q.CloseStatement,"Expected '%}'"),S0=new Q0(m0,P6);break}default:throw SyntaxError(`Unknown statement type: ${P0}`)}return S0}function E6(){f(Q.OpenExpression,"Expected opening expression token");let P0=p6();return f(Q.CloseExpression,"Expected closing expression token"),P0}function x6(){let P0=F4(),S0=null,m0=[];if(L0(Q.Equals))++C,S0=F4();else{f(Q.CloseStatement,"Expected %} token");while(!c0("endset"))m0.push(G0());f(Q.OpenStatement,"Expected {% token"),r("endset")}return f(Q.CloseStatement,"Expected closing statement token"),new j(P0,S0,m0)}function j6(){let P0=p6();f(Q.CloseStatement,"Expected closing statement token");let S0=[],m0=[];while(!c0("elif","else","endif"))S0.push(G0());if(c0("elif")){++C,++C;let P6=j6();m0.push(P6)}else if(c0("else")){++C,++C,f(Q.CloseStatement,"Expected closing statement token");while(!c0("endif"))m0.push(G0())}return new w(P0,S0,m0)}function U4(){let P0=Y4();if(P0.type!=="Identifier")throw SyntaxError("Expected identifier following macro statement");let S0=x4();f(Q.CloseStatement,"Expected closing statement token");let m0=[];while(!c0("endmacro"))m0.push(G0());return new y(P0,S0,m0)}function F4(P0=!1){let S0=P0?Y4:p6,m0=[S0()],P6=L0(Q.Comma);while(P6)if(++C,m0.push(S0()),!L0(Q.Comma))break;return P6?new d(m0):m0[0]}function Z4(){let P0=F4(!0);if(!(P0 instanceof R||P0 instanceof d))throw SyntaxError(`Expected identifier/tuple for the loop variable, got ${P0.type} instead`);if(!t0("in"))throw SyntaxError("Expected `in` keyword following loop variable");++C;let S0=p6();f(Q.CloseStatement,"Expected closing statement token");let m0=[];while(!c0("endfor","else"))m0.push(G0());let P6=[];if(c0("else")){++C,++C,f(Q.CloseStatement,"Expected closing statement token");while(!c0("endfor"))P6.push(G0())}return new F(P0,S0,m0,P6)}function p6(){return D4()}function D4(){let P0=g4();if(t0("if")){++C;let S0=g4();if(t0("else")){++C;let m0=D4();return new z0(S0,P0,m0)}else return new o(P0,S0)}return P0}function g4(){let P0=l4();while(t0("or")){let S0=E[C];++C;let m0=l4();P0=new n(S0,P0,m0)}return P0}function l4(){let P0=O4();while(t0("and")){let S0=E[C];++C;let m0=O4();P0=new n(S0,P0,m0)}return P0}function O4(){let P0;while(t0("not")){let S0=E[C];++C;let m0=O4();P0=new w0(S0,m0)}return P0??GJ()}function GJ(){let P0=c4();while(!0){let S0;if(t0("not","in"))S0=new W("not in",Q.Identifier),C+=2;else if(t0("in"))S0=E[C++];else if(L0(Q.ComparisonBinaryOperator))S0=E[C++];else break;let m0=c4();P0=new n(S0,P0,m0)}return P0}function c4(){let P0=P4();while(L0(Q.AdditiveBinaryOperator)){let S0=E[C];++C;let m0=P4();P0=new n(S0,P0,m0)}return P0}function j4(){let P0=m4(Y4());if(L0(Q.OpenParen))return k4(P0);return P0}function k4(P0){let S0=new B(P0,x4());if(S0=m4(S0),L0(Q.OpenParen))S0=k4(S0);return S0}function x4(){f(Q.OpenParen,"Expected opening parenthesis for arguments list");let P0=XJ();return f(Q.CloseParen,"Expected closing parenthesis for arguments list"),P0}function XJ(){let P0=[];while(!L0(Q.CloseParen)){let S0;if(E[C].type===Q.MultiplicativeBinaryOperator&&E[C].value==="*"){++C;let m0=p6();S0=new p(m0)}else if(S0=p6(),L0(Q.Equals)){if(++C,!(S0 instanceof R))throw SyntaxError("Expected identifier for keyword argument");let m0=p6();S0=new O(S0,m0)}if(P0.push(S0),L0(Q.Comma))++C}return P0}function qJ(){let P0=[],S0=!1;while(!L0(Q.CloseSquareBracket))if(L0(Q.Colon))P0.push(void 0),++C,S0=!0;else if(P0.push(p6()),L0(Q.Colon))++C,S0=!0;if(P0.length===0)throw SyntaxError("Expected at least one argument for member/slice expression");if(S0){if(P0.length>3)throw SyntaxError("Expected 0-3 arguments for slice expression");return new D(...P0)}return P0[0]}function m4(P0){while(L0(Q.Dot)||L0(Q.OpenSquareBracket)){let S0=E[C];++C;let m0,P6=S0.type===Q.OpenSquareBracket;if(P6)m0=qJ(),f(Q.CloseSquareBracket,"Expected closing square bracket");else if(m0=Y4(),m0.type!=="Identifier")throw SyntaxError("Expected identifier following dot operator");P0=new T(P0,m0,P6)}return P0}function P4(){let P0=a4();while(L0(Q.MultiplicativeBinaryOperator)){let S0=E[C++],m0=a4();P0=new n(S0,P0,m0)}return P0}function a4(){let P0=HJ();while(t0("is")){++C;let S0=t0("not");if(S0)++C;let m0=Y4();if(!(m0 instanceof R))throw SyntaxError("Expected identifier for the test");P0=new N0(P0,S0,m0)}return P0}function HJ(){let P0=j4();while(L0(Q.Pipe)){++C;let S0=Y4();if(!(S0 instanceof R))throw SyntaxError("Expected identifier for the filter");if(L0(Q.OpenParen))S0=k4(S0);P0=new t(P0,S0)}return P0}function Y4(){let P0=E[C++];switch(P0.type){case Q.NumericLiteral:{let S0=P0.value;return S0.includes(".")?new h(Number(S0)):new k(Number(S0))}case Q.StringLiteral:{let S0=P0.value;while(L0(Q.StringLiteral))S0+=E[C++].value;return new c(S0)}case Q.Identifier:return new R(P0.value);case Q.OpenParen:{let S0=F4();return f(Q.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),S0}case Q.OpenSquareBracket:{let S0=[];while(!L0(Q.CloseSquareBracket))if(S0.push(p6()),L0(Q.Comma))++C;return++C,new m(S0)}case Q.OpenCurlyBracket:{let S0=new Map;while(!L0(Q.CloseCurlyBracket)){let m0=p6();f(Q.Colon,"Expected colon between key and value in object literal");let P6=p6();if(S0.set(m0,P6),L0(Q.Comma))++C}return++C,new a(S0)}default:throw SyntaxError(`Unexpected token: ${P0.type}`)}}while(C<E.length)u.body.push(G0());return u}function j0(E,u,C=1){if(u===void 0)u=E,E=0;let f=[];for(let r=E;r<u;r+=C)f.push(r);return f}function h0(E,u,C,f=1){let r=Math.sign(f);if(r>=0)u=(u??=0)<0?Math.max(E.length+u,0):Math.min(u,E.length),C=(C??=E.length)<0?Math.max(E.length+C,0):Math.min(C,E.length);else u=(u??=E.length-1)<0?Math.max(E.length+u,-1):Math.min(u,E.length-1),C=(C??=-1)<-1?Math.max(E.length+C,-1):Math.min(C,E.length-1);let G0=[];for(let L0=u;r*L0<r*C;L0+=f)G0.push(E[L0]);return G0}function d0(E){return E.replace(/\b\w/g,(u)=>u.toUpperCase())}function T0(E){return b(new Date,E)}function b(E,u){let C=new Intl.DateTimeFormat(void 0,{month:"long"}),f=new Intl.DateTimeFormat(void 0,{month:"short"}),r=(G0)=>G0<10?"0"+G0:G0.toString();return u.replace(/%[YmdbBHM%]/g,(G0)=>{switch(G0){case"%Y":return E.getFullYear().toString();case"%m":return r(E.getMonth()+1);case"%d":return r(E.getDate());case"%b":return f.format(E);case"%B":return C.format(E);case"%H":return r(E.getHours());case"%M":return r(E.getMinutes());case"%%":return"%";default:return G0}})}function S(E){return E.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function W0(E,u,C,f){if(f===0)return E;let r=f==null||f<0?1/0:f,G0=u.length===0?new RegExp("(?=)","gu"):new RegExp(S(u),"gu");return E.replaceAll(G0,(L0)=>{if(r>0)return--r,C;return L0})}var B0=class extends Error{},D0=class extends Error{},R0=class{type="RuntimeValue";value;builtins=new Map;constructor(E=void 0){this.value=E}__bool__(){return new F0(!!this.value)}toString(){return String(this.value)}},Y0=class extends R0{type="IntegerValue"},E0=class extends R0{type="FloatValue";toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},X0=class extends R0{type="StringValue";builtins=new Map([["upper",new b0(()=>{return new X0(this.value.toUpperCase())})],["lower",new b0(()=>{return new X0(this.value.toLowerCase())})],["strip",new b0(()=>{return new X0(this.value.trim())})],["title",new b0(()=>{return new X0(d0(this.value))})],["capitalize",new b0(()=>{return new X0(this.value.charAt(0).toUpperCase()+this.value.slice(1))})],["length",new Y0(this.value.length)],["rstrip",new b0(()=>{return new X0(this.value.trimEnd())})],["lstrip",new b0(()=>{return new X0(this.value.trimStart())})],["startswith",new b0((E)=>{if(E.length===0)throw Error("startswith() requires at least one argument");let u=E[0];if(u instanceof X0)return new F0(this.value.startsWith(u.value));else if(u instanceof V0){for(let C of u.value){if(!(C instanceof X0))throw Error("startswith() tuple elements must be strings");if(this.value.startsWith(C.value))return new F0(!0)}return new F0(!1)}throw Error("startswith() argument must be a string or tuple of strings")})],["endswith",new b0((E)=>{if(E.length===0)throw Error("endswith() requires at least one argument");let u=E[0];if(u instanceof X0)return new F0(this.value.endsWith(u.value));else if(u instanceof V0){for(let C of u.value){if(!(C instanceof X0))throw Error("endswith() tuple elements must be strings");if(this.value.endsWith(C.value))return new F0(!0)}return new F0(!1)}throw Error("endswith() argument must be a string or tuple of strings")})],["split",new b0((E)=>{let u=E[0]??new s0;if(!(u instanceof X0||u instanceof s0))throw Error("sep argument must be a string or null");let C=E[1]??new Y0(-1);if(!(C instanceof Y0))throw Error("maxsplit argument must be a number");let f=[];if(u instanceof s0){let r=this.value.trimStart();for(let{0:G0,index:L0}of r.matchAll(/\S+/g)){if(C.value!==-1&&f.length>=C.value&&L0!==void 0){f.push(G0+r.slice(L0+G0.length));break}f.push(G0)}}else{if(u.value==="")throw Error("empty separator");if(f=this.value.split(u.value),C.value!==-1&&f.length>C.value)f.push(f.splice(C.value).join(u.value))}return new V0(f.map((r)=>new X0(r)))})],["replace",new b0((E)=>{if(E.length<2)throw Error("replace() requires at least two arguments");let u=E[0],C=E[1];if(!(u instanceof X0&&C instanceof X0))throw Error("replace() arguments must be strings");let f;if(E.length>2)if(E[2].type==="KeywordArgumentsValue")f=E[2].value.get("count")??new s0;else f=E[2];else f=new s0;if(!(f instanceof Y0||f instanceof s0))throw Error("replace() count argument must be a number or null");return new X0(W0(this.value,u.value,C.value,f.value))})]])},F0=class extends R0{type="BooleanValue"},C0=class extends R0{type="ObjectValue";__bool__(){return new F0(this.value.size>0)}builtins=new Map([["get",new b0(([E,u])=>{if(!(E instanceof X0))throw Error(`Object key must be a string: got ${E.type}`);return this.value.get(E.value)??u??new s0})],["items",new b0(()=>this.items())],["keys",new b0(()=>this.keys())],["values",new b0(()=>this.values())]]);items(){return new V0(Array.from(this.value.entries()).map(([E,u])=>new V0([new X0(E),u])))}keys(){return new V0(Array.from(this.value.keys()).map((E)=>new X0(E)))}values(){return new V0(Array.from(this.value.values()))}},x0=class extends C0{type="KeywordArgumentsValue"},V0=class extends R0{type="ArrayValue";builtins=new Map([["length",new Y0(this.value.length)]]);__bool__(){return new F0(this.value.length>0)}},u0=class extends V0{type="TupleValue"},b0=class extends R0{type="FunctionValue"},s0=class extends R0{type="NullValue"},l0=class extends R0{type="UndefinedValue"},y0=class{constructor(E){this.parent=E}variables=new Map([["namespace",new b0((E)=>{if(E.length===0)return new C0(new Map);if(E.length!==1||!(E[0]instanceof C0))throw Error("`namespace` expects either zero arguments or a single object argument");return E[0]})]]);tests=new Map([["boolean",(E)=>E.type==="BooleanValue"],["callable",(E)=>E instanceof b0],["odd",(E)=>{if(!(E instanceof Y0))throw Error(`cannot odd on ${E.type}`);return E.value%2!==0}],["even",(E)=>{if(!(E instanceof Y0))throw Error(`cannot even on ${E.type}`);return E.value%2===0}],["false",(E)=>E.type==="BooleanValue"&&!E.value],["true",(E)=>E.type==="BooleanValue"&&E.value],["none",(E)=>E.type==="NullValue"],["string",(E)=>E.type==="StringValue"],["number",(E)=>E instanceof Y0||E instanceof E0],["integer",(E)=>E instanceof Y0],["iterable",(E)=>E.type==="ArrayValue"||E.type==="StringValue"],["mapping",(E)=>E.type==="ObjectValue"],["lower",(E)=>{let u=E.value;return E.type==="StringValue"&&u===u.toLowerCase()}],["upper",(E)=>{let u=E.value;return E.type==="StringValue"&&u===u.toUpperCase()}],["none",(E)=>E.type==="NullValue"],["defined",(E)=>E.type!=="UndefinedValue"],["undefined",(E)=>E.type==="UndefinedValue"],["equalto",(E,u)=>E.value===u.value],["eq",(E,u)=>E.value===u.value]]);set(E,u){return this.declareVariable(E,n0(u))}declareVariable(E,u){if(this.variables.has(E))throw SyntaxError(`Variable already declared: ${E}`);return this.variables.set(E,u),u}setVariable(E,u){return this.variables.set(E,u),u}resolve(E){if(this.variables.has(E))return this;if(this.parent)return this.parent.resolve(E);throw Error(`Unknown variable: ${E}`)}lookupVariable(E){try{return this.resolve(E).variables.get(E)??new l0}catch{return new l0}}};function i0(E){E.set("false",!1),E.set("true",!0),E.set("none",null),E.set("raise_exception",(u)=>{throw Error(u)}),E.set("range",j0),E.set("strftime_now",T0),E.set("True",!0),E.set("False",!1),E.set("None",null)}var a0=class{global;constructor(E){this.global=E??new y0}run(E){return this.evaluate(E,this.global)}evaluateBinaryExpression(E,u){let C=this.evaluate(E.left,u);switch(E.operator.value){case"and":return C.__bool__().value?this.evaluate(E.right,u):C;case"or":return C.__bool__().value?C:this.evaluate(E.right,u)}let f=this.evaluate(E.right,u);switch(E.operator.value){case"==":return new F0(C.value==f.value);case"!=":return new F0(C.value!=f.value)}if(C instanceof l0||f instanceof l0){if(f instanceof l0&&["in","not in"].includes(E.operator.value))return new F0(E.operator.value==="not in");throw Error(`Cannot perform operation ${E.operator.value} on undefined values`)}else if(C instanceof s0||f instanceof s0)throw Error("Cannot perform operation on null values");else if(E.operator.value==="~")return new X0(C.value.toString()+f.value.toString());else if((C instanceof Y0||C instanceof E0)&&(f instanceof Y0||f instanceof E0)){let r=C.value,G0=f.value;switch(E.operator.value){case"+":case"-":case"*":{let L0=E.operator.value==="+"?r+G0:E.operator.value==="-"?r-G0:r*G0;return C instanceof E0||f instanceof E0?new E0(L0):new Y0(L0)}case"/":return new E0(r/G0);case"%":{let L0=r%G0;return C instanceof E0||f instanceof E0?new E0(L0):new Y0(L0)}case"<":return new F0(r<G0);case">":return new F0(r>G0);case">=":return new F0(r>=G0);case"<=":return new F0(r<=G0)}}else if(C instanceof V0&&f instanceof V0)switch(E.operator.value){case"+":return new V0(C.value.concat(f.value))}else if(f instanceof V0){let r=f.value.find((G0)=>G0.value===C.value)!==void 0;switch(E.operator.value){case"in":return new F0(r);case"not in":return new F0(!r)}}if(C instanceof X0||f instanceof X0)switch(E.operator.value){case"+":return new X0(C.value.toString()+f.value.toString())}if(C instanceof X0&&f instanceof X0)switch(E.operator.value){case"in":return new F0(f.value.includes(C.value));case"not in":return new F0(!f.value.includes(C.value))}if(C instanceof X0&&f instanceof C0)switch(E.operator.value){case"in":return new F0(f.value.has(C.value));case"not in":return new F0(!f.value.has(C.value))}throw SyntaxError(`Unknown operator "${E.operator.value}" between ${C.type} and ${f.type}`)}evaluateArguments(E,u){let C=[],f=new Map;for(let r of E)if(r.type==="SpreadExpression"){let G0=r,L0=this.evaluate(G0.argument,u);if(!(L0 instanceof V0))throw Error(`Cannot unpack non-iterable type: ${L0.type}`);for(let c0 of L0.value)C.push(c0)}else if(r.type==="KeywordArgumentExpression"){let G0=r;f.set(G0.key.value,this.evaluate(G0.value,u))}else{if(f.size>0)throw Error("Positional arguments must come before keyword arguments");C.push(this.evaluate(r,u))}return[C,f]}applyFilter(E,u,C){if(u.type==="Identifier"){let f=u;if(f.value==="tojson")return new X0(B6(E));if(E instanceof V0)switch(f.value){case"list":return E;case"first":return E.value[0];case"last":return E.value[E.value.length-1];case"length":return new Y0(E.value.length);case"reverse":return new V0(E.value.reverse());case"sort":return new V0(E.value.sort((r,G0)=>{if(r.type!==G0.type)throw Error(`Cannot compare different types: ${r.type} and ${G0.type}`);switch(r.type){case"IntegerValue":case"FloatValue":return r.value-G0.value;case"StringValue":return r.value.localeCompare(G0.value);default:throw Error(`Cannot compare type: ${r.type}`)}}));case"join":return new X0(E.value.map((r)=>r.value).join(""));case"string":return new X0(B6(E));case"unique":{let r=new Set,G0=[];for(let L0 of E.value)if(!r.has(L0.value))r.add(L0.value),G0.push(L0);return new V0(G0)}default:throw Error(`Unknown ArrayValue filter: ${f.value}`)}else if(E instanceof X0)switch(f.value){case"length":case"upper":case"lower":case"title":case"capitalize":{let r=E.builtins.get(f.value);if(r instanceof b0)return r.value([],C);else if(r instanceof Y0)return r;else throw Error(`Unknown StringValue filter: ${f.value}`)}case"trim":return new X0(E.value.trim());case"indent":return new X0(E.value.split(`
`).map((r,G0)=>G0===0||r.length===0?r:"    "+r).join(`
`));case"join":case"string":return E;case"int":{let r=parseInt(E.value,10);return new Y0(isNaN(r)?0:r)}case"float":{let r=parseFloat(E.value);return new E0(isNaN(r)?0:r)}default:throw Error(`Unknown StringValue filter: ${f.value}`)}else if(E instanceof Y0||E instanceof E0)switch(f.value){case"abs":return E instanceof Y0?new Y0(Math.abs(E.value)):new E0(Math.abs(E.value));case"int":return new Y0(Math.floor(E.value));case"float":return new E0(E.value);default:throw Error(`Unknown NumericValue filter: ${f.value}`)}else if(E instanceof C0)switch(f.value){case"items":return new V0(Array.from(E.value.entries()).map(([r,G0])=>new V0([new X0(r),G0])));case"length":return new Y0(E.value.size);default:throw Error(`Unknown ObjectValue filter: ${f.value}`)}else if(E instanceof F0)switch(f.value){case"bool":return new F0(E.value);case"int":return new Y0(E.value?1:0);case"float":return new E0(E.value?1:0);case"string":return new X0(E.value?"true":"false");default:throw Error(`Unknown BooleanValue filter: ${f.value}`)}throw Error(`Cannot apply filter "${f.value}" to type: ${E.type}`)}else if(u.type==="CallExpression"){let f=u;if(f.callee.type!=="Identifier")throw Error(`Unknown filter: ${f.callee.type}`);let r=f.callee.value;if(r==="tojson"){let[,G0]=this.evaluateArguments(f.args,C),L0=G0.get("indent")??new s0;if(!(L0 instanceof Y0||L0 instanceof s0))throw Error("If set, indent must be a number");return new X0(B6(E,L0.value))}else if(r==="join"){let G0;if(E instanceof X0)G0=Array.from(E.value);else if(E instanceof V0)G0=E.value.map((v0)=>v0.value);else throw Error(`Cannot apply filter "${r}" to type: ${E.type}`);let[L0,c0]=this.evaluateArguments(f.args,C),t0=L0.at(0)??c0.get("separator")??new X0("");if(!(t0 instanceof X0))throw Error("separator must be a string");return new X0(G0.join(t0.value))}else if(r==="int"||r==="float"){let[G0,L0]=this.evaluateArguments(f.args,C),c0=G0.at(0)??L0.get("default")??(r==="int"?new Y0(0):new E0(0));if(E instanceof X0){let t0=r==="int"?parseInt(E.value,10):parseFloat(E.value);return isNaN(t0)?c0:r==="int"?new Y0(t0):new E0(t0)}else if(E instanceof Y0||E instanceof E0)return E;else if(E instanceof F0)return r==="int"?new Y0(E.value?1:0):new E0(E.value?1:0);else throw Error(`Cannot apply filter "${r}" to type: ${E.type}`)}else if(r==="default"){let[G0,L0]=this.evaluateArguments(f.args,C),c0=G0[0]??new X0(""),t0=G0[1]??L0.get("boolean")??new F0(!1);if(!(t0 instanceof F0))throw Error("`default` filter flag must be a boolean");if(E instanceof l0||t0.value&&!E.__bool__().value)return c0;return E}if(E instanceof V0){switch(r){case"selectattr":case"rejectattr":{let G0=r==="selectattr";if(E.value.some((E6)=>!(E6 instanceof C0)))throw Error(`\`${r}\` can only be applied to array of objects`);if(f.args.some((E6)=>E6.type!=="StringLiteral"))throw Error(`arguments of \`${r}\` must be strings`);let[L0,c0,t0]=f.args.map((E6)=>this.evaluate(E6,C)),v0;if(c0){let E6=C.tests.get(c0.value);if(!E6)throw Error(`Unknown test: ${c0.value}`);v0=E6}else v0=(...E6)=>E6[0].__bool__().value;let U6=E.value.filter((E6)=>{let x6=E6.value.get(L0.value),j6=x6?v0(x6,t0):!1;return G0?j6:!j6});return new V0(U6)}case"map":{let[,G0]=this.evaluateArguments(f.args,C);if(G0.has("attribute")){let L0=G0.get("attribute");if(!(L0 instanceof X0))throw Error("attribute must be a string");let c0=G0.get("default"),t0=E.value.map((v0)=>{if(!(v0 instanceof C0))throw Error("items in map must be an object");return v0.value.get(L0.value)??c0??new l0});return new V0(t0)}else throw Error("`map` expressions without `attribute` set are not currently supported.")}}throw Error(`Unknown ArrayValue filter: ${r}`)}else if(E instanceof X0){switch(r){case"indent":{let[G0,L0]=this.evaluateArguments(f.args,C),c0=G0.at(0)??L0.get("width")??new Y0(4);if(!(c0 instanceof Y0))throw Error("width must be a number");let t0=G0.at(1)??L0.get("first")??new F0(!1),v0=G0.at(2)??L0.get("blank")??new F0(!1),U6=E.value.split(`
`),E6=" ".repeat(c0.value),x6=U6.map((j6,U4)=>!t0.value&&U4===0||!v0.value&&j6.length===0?j6:E6+j6);return new X0(x6.join(`
`))}case"replace":{let G0=E.builtins.get("replace");if(!(G0 instanceof b0))throw Error("replace filter not available");let[L0,c0]=this.evaluateArguments(f.args,C);return G0.value([...L0,new x0(c0)],C)}}throw Error(`Unknown StringValue filter: ${r}`)}else throw Error(`Cannot apply filter "${r}" to type: ${E.type}`)}throw Error(`Unknown filter: ${u.type}`)}evaluateFilterExpression(E,u){let C=this.evaluate(E.operand,u);return this.applyFilter(C,E.filter,u)}evaluateTestExpression(E,u){let C=this.evaluate(E.operand,u),f=u.tests.get(E.test.value);if(!f)throw Error(`Unknown test: ${E.test.value}`);let r=f(C);return new F0(E.negate?!r:r)}evaluateSelectExpression(E,u){if(!this.evaluate(E.test,u).__bool__().value)return new l0;return this.evaluate(E.lhs,u)}evaluateUnaryExpression(E,u){let C=this.evaluate(E.argument,u);switch(E.operator.value){case"not":return new F0(!C.value);default:throw SyntaxError(`Unknown operator: ${E.operator.value}`)}}evaluateTernaryExpression(E,u){return this.evaluate(E.condition,u).__bool__().value?this.evaluate(E.trueExpr,u):this.evaluate(E.falseExpr,u)}evalProgram(E,u){return this.evaluateBlock(E.body,u)}evaluateBlock(E,u){let C="";for(let f of E){let r=this.evaluate(f,u);if(r.type!=="NullValue"&&r.type!=="UndefinedValue")C+=r.toString()}return new X0(C)}evaluateIdentifier(E,u){return u.lookupVariable(E.value)}evaluateCallExpression(E,u){let[C,f]=this.evaluateArguments(E.args,u);if(f.size>0)C.push(new x0(f));let r=this.evaluate(E.callee,u);if(r.type!=="FunctionValue")throw Error(`Cannot call something that is not a function: got ${r.type}`);return r.value(C,u)}evaluateSliceExpression(E,u,C){if(!(E instanceof V0||E instanceof X0))throw Error("Slice object must be an array or string");let f=this.evaluate(u.start,C),r=this.evaluate(u.stop,C),G0=this.evaluate(u.step,C);if(!(f instanceof Y0||f instanceof l0))throw Error("Slice start must be numeric or undefined");if(!(r instanceof Y0||r instanceof l0))throw Error("Slice stop must be numeric or undefined");if(!(G0 instanceof Y0||G0 instanceof l0))throw Error("Slice step must be numeric or undefined");if(E instanceof V0)return new V0(h0(E.value,f.value,r.value,G0.value));else return new X0(h0(Array.from(E.value),f.value,r.value,G0.value).join(""))}evaluateMemberExpression(E,u){let C=this.evaluate(E.object,u),f;if(E.computed)if(E.property.type==="SliceExpression")return this.evaluateSliceExpression(C,E.property,u);else f=this.evaluate(E.property,u);else f=new X0(E.property.value);let r;if(C instanceof C0){if(!(f instanceof X0))throw Error(`Cannot access property with non-string: got ${f.type}`);r=C.value.get(f.value)??C.builtins.get(f.value)}else if(C instanceof V0||C instanceof X0)if(f instanceof Y0){if(r=C.value.at(f.value),C instanceof X0)r=new X0(C.value.at(f.value))}else if(f instanceof X0)r=C.builtins.get(f.value);else throw Error(`Cannot access property with non-string/non-number: got ${f.type}`);else{if(!(f instanceof X0))throw Error(`Cannot access property with non-string: got ${f.type}`);r=C.builtins.get(f.value)}return r instanceof R0?r:new l0}evaluateSet(E,u){let C=E.value?this.evaluate(E.value,u):this.evaluateBlock(E.body,u);if(E.assignee.type==="Identifier"){let f=E.assignee.value;u.setVariable(f,C)}else if(E.assignee.type==="TupleLiteral"){let f=E.assignee;if(!(C instanceof V0))throw Error(`Cannot unpack non-iterable type in set: ${C.type}`);let r=C.value;if(r.length!==f.value.length)throw Error(`Too ${f.value.length>r.length?"few":"many"} items to unpack in set`);for(let G0=0;G0<f.value.length;++G0){let L0=f.value[G0];if(L0.type!=="Identifier")throw Error(`Cannot unpack to non-identifier in set: ${L0.type}`);u.setVariable(L0.value,r[G0])}}else if(E.assignee.type==="MemberExpression"){let f=E.assignee,r=this.evaluate(f.object,u);if(!(r instanceof C0))throw Error("Cannot assign to member of non-object");if(f.property.type!=="Identifier")throw Error("Cannot assign to member with non-identifier property");r.value.set(f.property.value,C)}else throw Error(`Invalid LHS inside assignment expression: ${JSON.stringify(E.assignee)}`);return new s0}evaluateIf(E,u){let C=this.evaluate(E.test,u);return this.evaluateBlock(C.__bool__().value?E.body:E.alternate,u)}evaluateFor(E,u){let C=new y0(u),f,r;if(E.iterable.type==="SelectExpression"){let v0=E.iterable;r=this.evaluate(v0.lhs,C),f=v0.test}else r=this.evaluate(E.iterable,C);if(!(r instanceof V0||r instanceof C0))throw Error(`Expected iterable or object type in for loop: got ${r.type}`);if(r instanceof C0)r=r.keys();let G0=[],L0=[];for(let v0=0;v0<r.value.length;++v0){let U6=new y0(C),E6=r.value[v0],x6;if(E.loopvar.type==="Identifier")x6=(j6)=>j6.setVariable(E.loopvar.value,E6);else if(E.loopvar.type==="TupleLiteral"){let j6=E.loopvar;if(E6.type!=="ArrayValue")throw Error(`Cannot unpack non-iterable type: ${E6.type}`);let U4=E6;if(j6.value.length!==U4.value.length)throw Error(`Too ${j6.value.length>U4.value.length?"few":"many"} items to unpack`);x6=(F4)=>{for(let Z4=0;Z4<j6.value.length;++Z4){if(j6.value[Z4].type!=="Identifier")throw Error(`Cannot unpack non-identifier type: ${j6.value[Z4].type}`);F4.setVariable(j6.value[Z4].value,U4.value[Z4])}}}else throw Error(`Invalid loop variable(s): ${E.loopvar.type}`);if(f){if(x6(U6),!this.evaluate(f,U6).__bool__().value)continue}G0.push(E6),L0.push(x6)}let c0="",t0=!0;for(let v0=0;v0<G0.length;++v0){let U6=new Map([["index",new Y0(v0+1)],["index0",new Y0(v0)],["revindex",new Y0(G0.length-v0)],["revindex0",new Y0(G0.length-v0-1)],["first",new F0(v0===0)],["last",new F0(v0===G0.length-1)],["length",new Y0(G0.length)],["previtem",v0>0?G0[v0-1]:new l0],["nextitem",v0<G0.length-1?G0[v0+1]:new l0]]);C.setVariable("loop",new C0(U6)),L0[v0](C);try{let E6=this.evaluateBlock(E.body,C);c0+=E6.value}catch(E6){if(E6 instanceof D0)continue;if(E6 instanceof B0)break;throw E6}t0=!1}if(t0){let v0=this.evaluateBlock(E.defaultBlock,C);c0+=v0.value}return new X0(c0)}evaluateMacro(E,u){return u.setVariable(E.name.value,new b0((C,f)=>{let r=new y0(f);C=C.slice();let G0;if(C.at(-1)?.type==="KeywordArgumentsValue")G0=C.pop();for(let L0=0;L0<E.args.length;++L0){let c0=E.args[L0],t0=C[L0];if(c0.type==="Identifier"){let v0=c0;if(!t0)throw Error(`Missing positional argument: ${v0.value}`);r.setVariable(v0.value,t0)}else if(c0.type==="KeywordArgumentExpression"){let v0=c0,U6=t0??G0?.value.get(v0.key.value)??this.evaluate(v0.value,r);r.setVariable(v0.key.value,U6)}else throw Error(`Unknown argument type: ${c0.type}`)}return this.evaluateBlock(E.body,r)})),new s0}evaluateCallStatement(E,u){let C=new b0((c0,t0)=>{let v0=new y0(t0);if(E.callerArgs)for(let U6=0;U6<E.callerArgs.length;++U6){let E6=E.callerArgs[U6];if(E6.type!=="Identifier")throw Error(`Caller parameter must be an identifier, got ${E6.type}`);v0.setVariable(E6.value,c0[U6]??new l0)}return this.evaluateBlock(E.body,v0)}),[f,r]=this.evaluateArguments(E.call.args,u);f.push(new x0(r));let G0=this.evaluate(E.call.callee,u);if(G0.type!=="FunctionValue")throw Error(`Cannot call something that is not a function: got ${G0.type}`);let L0=new y0(u);return L0.setVariable("caller",C),G0.value(f,L0)}evaluateFilterStatement(E,u){let C=this.evaluateBlock(E.body,u);return this.applyFilter(C,E.filter,u)}evaluate(E,u){if(!E)return new l0;switch(E.type){case"Program":return this.evalProgram(E,u);case"Set":return this.evaluateSet(E,u);case"If":return this.evaluateIf(E,u);case"For":return this.evaluateFor(E,u);case"Macro":return this.evaluateMacro(E,u);case"CallStatement":return this.evaluateCallStatement(E,u);case"Break":throw new B0;case"Continue":throw new D0;case"IntegerLiteral":return new Y0(E.value);case"FloatLiteral":return new E0(E.value);case"StringLiteral":return new X0(E.value);case"ArrayLiteral":return new V0(E.value.map((C)=>this.evaluate(C,u)));case"TupleLiteral":return new u0(E.value.map((C)=>this.evaluate(C,u)));case"ObjectLiteral":{let C=new Map;for(let[f,r]of E.value){let G0=this.evaluate(f,u);if(!(G0 instanceof X0))throw Error(`Object keys must be strings: got ${G0.type}`);C.set(G0.value,this.evaluate(r,u))}return new C0(C)}case"Identifier":return this.evaluateIdentifier(E,u);case"CallExpression":return this.evaluateCallExpression(E,u);case"MemberExpression":return this.evaluateMemberExpression(E,u);case"UnaryExpression":return this.evaluateUnaryExpression(E,u);case"BinaryExpression":return this.evaluateBinaryExpression(E,u);case"FilterExpression":return this.evaluateFilterExpression(E,u);case"FilterStatement":return this.evaluateFilterStatement(E,u);case"TestExpression":return this.evaluateTestExpression(E,u);case"SelectExpression":return this.evaluateSelectExpression(E,u);case"Ternary":return this.evaluateTernaryExpression(E,u);case"Comment":return new s0;default:throw SyntaxError(`Unknown node type: ${E.type}`)}}};function n0(E){switch(typeof E){case"number":return Number.isInteger(E)?new Y0(E):new E0(E);case"string":return new X0(E);case"boolean":return new F0(E);case"undefined":return new l0;case"object":if(E===null)return new s0;else if(Array.isArray(E))return new V0(E.map(n0));else return new C0(new Map(Object.entries(E).map(([u,C])=>[u,n0(C)])));case"function":return new b0((u,C)=>{let f=E(...u.map((r)=>r.value))??null;return n0(f)});default:throw Error(`Cannot convert to runtime value: ${E}`)}}function B6(E,u,C){let f=C??0;switch(E.type){case"NullValue":case"UndefinedValue":return"null";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(E.value);case"ArrayValue":case"ObjectValue":{let r=u?" ".repeat(u):"",G0=`
`+r.repeat(f),L0=G0+r;if(E.type==="ArrayValue"){let c0=E.value.map((t0)=>B6(t0,u,f+1));return u?`[${L0}${c0.join(`,${L0}`)}${G0}]`:`[${c0.join(", ")}]`}else{let c0=Array.from(E.value.entries()).map(([t0,v0])=>{let U6=`"${t0}": ${B6(v0,u,f+1)}`;return u?`${L0}${U6}`:U6});return u?`{${c0.join(",")}${G0}}`:`{${c0.join(", ")}}`}}default:throw Error(`Cannot convert to JSON: ${E.type}`)}}var W6=`
`,a6="{%- ",H4=" -%}";function V4(E){switch(E.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":if(E.operator.value==="and")return 1;if(E.operator.value==="in"||E.operator.value==="not in")return 2;return 0}return 0}function _4(E,u="\t"){let C=typeof u==="number"?" ".repeat(u):u;return o6(E.body,0,C).replace(/\n$/,"")}function k6(...E){return a6+E.join(" ")+H4}function o6(E,u,C){return E.map((f)=>DJ(f,u,C)).join(W6)}function DJ(E,u,C){let f=C.repeat(u);switch(E.type){case"Program":return o6(E.body,u,C);case"If":return TJ(E,u,C);case"For":return _J(E,u,C);case"Set":return v4(E,u,C);case"Macro":return Z6(E,u,C);case"Break":return f+k6("break");case"Continue":return f+k6("continue");case"CallStatement":return WJ(E,u,C);case"FilterStatement":return KJ(E,u,C);case"Comment":return f+"{# "+E.value+" #}";default:return f+"{{- "+H6(E)+" -}}"}}function TJ(E,u,C){let f=C.repeat(u),r=[],G0=E;while(G0)if(r.push({test:G0.test,body:G0.body}),G0.alternate.length===1&&G0.alternate[0].type==="If")G0=G0.alternate[0];else break;let L0=f+k6("if",H6(r[0].test))+W6+o6(r[0].body,u+1,C);for(let c0=1;c0<r.length;++c0)L0+=W6+f+k6("elif",H6(r[c0].test))+W6+o6(r[c0].body,u+1,C);if(G0&&G0.alternate.length>0)L0+=W6+f+k6("else")+W6+o6(G0.alternate,u+1,C);return L0+=W6+f+k6("endif"),L0}function _J(E,u,C){let f=C.repeat(u),r="";if(E.iterable.type==="SelectExpression"){let L0=E.iterable;r=`${H6(L0.lhs)} if ${H6(L0.test)}`}else r=H6(E.iterable);let G0=f+k6("for",H6(E.loopvar),"in",r)+W6+o6(E.body,u+1,C);if(E.defaultBlock.length>0)G0+=W6+f+k6("else")+W6+o6(E.defaultBlock,u+1,C);return G0+=W6+f+k6("endfor"),G0}function v4(E,u,C){let f=C.repeat(u),r=H6(E.assignee),G0=E.value?H6(E.value):"",L0=f+k6("set",`${r}${E.value?" = "+G0:""}`);if(E.body.length===0)return L0;return L0+W6+o6(E.body,u+1,C)+W6+f+k6("endset")}function Z6(E,u,C){let f=C.repeat(u),r=E.args.map(H6).join(", ");return f+k6("macro",`${E.name.value}(${r})`)+W6+o6(E.body,u+1,C)+W6+f+k6("endmacro")}function WJ(E,u,C){let f=C.repeat(u),r=E.callerArgs&&E.callerArgs.length>0?`(${E.callerArgs.map(H6).join(", ")})`:"",G0=H6(E.call),L0=f+k6(`call${r}`,G0)+W6;return L0+=o6(E.body,u+1,C)+W6,L0+=f+k6("endcall"),L0}function KJ(E,u,C){let f=C.repeat(u),r=E.filter.type==="Identifier"?E.filter.value:H6(E.filter),G0=f+k6("filter",r)+W6;return G0+=o6(E.body,u+1,C)+W6,G0+=f+k6("endfilter"),G0}function H6(E,u=-1){switch(E.type){case"SpreadExpression":return`*${H6(E.argument)}`;case"Identifier":return E.value;case"IntegerLiteral":return`${E.value}`;case"FloatLiteral":return`${E.value}`;case"StringLiteral":return JSON.stringify(E.value);case"BinaryExpression":{let C=E,f=V4(C),r=H6(C.left,f),G0=H6(C.right,f+1),L0=`${r} ${C.operator.value} ${G0}`;return f<u?`(${L0})`:L0}case"UnaryExpression":{let C=E;return C.operator.value+(C.operator.value==="not"?" ":"")+H6(C.argument,1/0)}case"CallExpression":{let C=E,f=C.args.map(H6).join(", ");return`${H6(C.callee)}(${f})`}case"MemberExpression":{let C=E,f=H6(C.object);if(!["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(C.object.type))f=`(${f})`;let r=H6(C.property);if(!C.computed&&C.property.type!=="Identifier")r=`(${r})`;return C.computed?`${f}[${r}]`:`${f}.${r}`}case"FilterExpression":{let C=E,f=H6(C.operand,1/0);if(C.filter.type==="CallExpression")return`${f} | ${H6(C.filter)}`;return`${f} | ${C.filter.value}`}case"SelectExpression":{let C=E;return`${H6(C.lhs)} if ${H6(C.test)}`}case"TestExpression":{let C=E;return`${H6(C.operand)} is${C.negate?" not":""} ${C.test.value}`}case"ArrayLiteral":case"TupleLiteral":{let C=E.value.map(H6),f=E.type==="ArrayLiteral"?"[]":"()";return`${f[0]}${C.join(", ")}${f[1]}`}case"ObjectLiteral":return`{${Array.from(E.value.entries()).map(([f,r])=>`${H6(f)}: ${H6(r)}`).join(", ")}}`;case"SliceExpression":{let C=E,f=C.start?H6(C.start):"",r=C.stop?H6(C.stop):"",G0=C.step?`:${H6(C.step)}`:"";return`${f}:${r}${G0}`}case"KeywordArgumentExpression":{let C=E;return`${C.key.value}=${H6(C.value)}`}case"Ternary":{let C=E,f=`${H6(C.trueExpr)} if ${H6(C.condition,0)} else ${H6(C.falseExpr)}`;return u>-1?`(${f})`:f}default:throw Error(`Unknown expression type: ${E.type}`)}}var YJ=class{parsed;constructor(E){let u=U(E,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=A0(u)}render(E){let u=new y0;if(i0(u),E)for(let[r,G0]of Object.entries(E))u.set(r,G0);return new a0(u).run(this.parsed).value}format(E){return _4(this.parsed,E?.indent||"\t")}}},"./src/backends/onnx.js":(J,Z,$)=>{/*!******************************!*\
  !*** ./src/backends/onnx.js ***!
  \******************************/var Q;$.r(Z),$.d(Z,{Tensor:()=>G.Tensor,createInferenceSession:()=>I,deviceToExecutionProviders:()=>F,isONNXProxy:()=>B,isONNXTensor:()=>A,runInferenceSession:()=>g});var W=$("./src/env.js");/*! ../env.js */var Y=$("onnxruntime-node");/*! onnxruntime-node */var H=$("?8b6b");/*! onnxruntime-web */var G=$("onnxruntime-common");/*! onnxruntime-common */let q=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),z=[],U,N,L=Symbol.for("onnxruntime");if(L in globalThis)N=globalThis[L];else if(W.apis.IS_NODE_ENV){switch(N=Y.default??Y,process.platform){case"win32":z.push("dml");break;case"linux":if(process.arch==="x64")z.push("cuda");break;case"darwin":break}z.push("cpu"),U=["cpu"]}else{if(N=Q||(Q=$.t(H,2)),W.apis.IS_WEBNN_AVAILABLE)z.push("webnn-npu","webnn-gpu","webnn-cpu","webnn");if(W.apis.IS_WEBGPU_AVAILABLE)z.push("webgpu");z.push("wasm"),U=["wasm"]}let w=N.InferenceSession;function F(R=null){if(!R)return U;switch(R){case"auto":return z;case"gpu":return z.filter((P)=>["webgpu","cuda","dml","webnn-gpu"].includes(P))}if(z.includes(R))return[q[R]??R];throw Error(`Unsupported device: "${R}". Should be one of: ${z.join(", ")}.`)}let v=null;async function I(R,P,k){if(v)await v;let h=w.create(R,P);v??=h;let c=await h;return c.config=k,c}let j=Promise.resolve(),y=W.apis.IS_BROWSER_ENV||W.apis.IS_WEBWORKER_ENV;async function g(R,P){let k=()=>R.run(P);return await(y?j=j.then(k):k())}function A(R){return R instanceof N.Tensor}let T=N?.env;if(T?.wasm){if(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!T.wasm.wasmPaths)T.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${W.env.version}/dist/`;T.wasm.proxy=!1}if(T?.webgpu)T.webgpu.powerPreference="high-performance";function B(){return T?.wasm?.proxy}W.env.backends.onnx=T},"./src/base/feature_extraction_utils.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/base/feature_extraction_utils.js ***!
  \**********************************************/$.r(Z),$.d(Z,{FeatureExtractor:()=>H,validate_audio_inputs:()=>G});var Q=$("./src/utils/constants.js");/*! ../utils/constants.js */var W=$("./src/utils/generic.js");/*! ../utils/generic.js */var Y=$("./src/utils/hub.js");/*! ../utils/hub.js */class H extends W.Callable{constructor(q){super();this.config=q}static async from_pretrained(q,z={}){let U=await(0,Y.getModelJSON)(q,Q.FEATURE_EXTRACTOR_NAME,!0,z);return new this(U)}}function G(q,z){if(!(q instanceof Float32Array||q instanceof Float64Array))throw Error(`${z} expects input to be a Float32Array or a Float64Array, but got ${q?.constructor?.name??typeof q} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(J,Z,$)=>{/*!********************************************!*\
  !*** ./src/base/image_processors_utils.js ***!
  \********************************************/$.r(Z),$.d(Z,{ImageProcessor:()=>T,center_to_corners_format:()=>L,post_process_instance_segmentation:()=>A,post_process_object_detection:()=>w,post_process_panoptic_segmentation:()=>g,post_process_semantic_segmentation:()=>F});var Q=$("./src/utils/generic.js");/*! ../utils/generic.js */var W=$("./src/utils/tensor.js");/*! ../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../utils/maths.js */var H=$("./src/utils/image.js");/*! ../utils/image.js */var G=$("./src/utils/core.js");/*! ../utils/core.js */var q=$("./src/utils/hub.js");/*! ../utils/hub.js */var z=$("./src/utils/constants.js");/*! ../utils/constants.js */function U(B,R,P=0,k=null){let h=B/R,c=(0,Y.bankers_round)(h)*R;if(k!==null&&c>k)c=Math.floor(h)*R;if(c<P)c=Math.ceil(h)*R;return c}function N([B,R],P){return[Math.max(Math.floor(B/P),1)*P,Math.max(Math.floor(R/P),1)*P]}function L([B,R,P,k]){return[B-P/2,R-k/2,B+P/2,R+k/2]}function w(B,R=0.5,P=null,k=!1){let{logits:h,pred_boxes:c}=B,[m,d,a]=h.dims;if(P!==null&&P.length!==m)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let n=[];for(let t=0;t<m;++t){let Q0=P!==null?P[t]:null,o={boxes:[],classes:[],scores:[]},N0=h[t],w0=c[t];for(let D=0;D<d;++D){let O=N0[D],p=[],Z0;if(k){Z0=O.sigmoid().data;for(let z0=0;z0<Z0.length;++z0)if(Z0[z0]>R)p.push(z0)}else{let z0=(0,Y.max)(O.data)[1];if(z0===a-1)continue;if(Z0=(0,Y.softmax)(O.data),Z0[z0]<R)continue;p.push(z0)}for(let z0 of p){let A0=w0[D].data;if(A0=L(A0),Q0!==null)A0=A0.map((j0,h0)=>j0*Q0[(h0+1)%2]);o.boxes.push(A0),o.classes.push(z0),o.scores.push(Z0[z0])}}n.push(o)}return n}function F(B,R=null){let P=B.logits,k=P.dims[0];if(R!==null&&R.length!==k)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let c=0;c<k;++c){let m=R!==null?R[c]:null,d=P[c];if(m!==null)d=(0,W.interpolate)(d,m,"bilinear",!1);let[a,n]=m??d.dims.slice(-2),t=new W.Tensor("int32",new Int32Array(a*n),[a,n]),Q0=d[0].data,o=t.data;for(let D=1;D<d.dims[0];++D){let O=d[D].data;for(let p=0;p<O.length;++p)if(O[p]>Q0[p])Q0[p]=O[p],o[p]=D}let N0=Array(d.dims[0]);for(let D=0;D<o.length;++D){let O=o[D];N0[O]=O}let w0=N0.filter((D)=>D!==void 0);h.push({segmentation:t,labels:w0})}return h}function v(B,R,P,k){let h=[],c=[],m=[];for(let d=0;d<B.dims[0];++d){let a=B[d],n=R[d],t=(0,Y.max)(a.data)[1];if(t===k)continue;let o=(0,Y.softmax)(a.data)[t];if(o>P)h.push(n),c.push(o),m.push(t)}return[h,c,m]}function I(B,R,P,k=0.5,h=0.8){let c=[],m=0,d=0,a=R[P].data;for(let t=0;t<B.length;++t){if(B[t]===P)c.push(t),++m;if(a[t]>=k)++d}let n=m>0&&d>0;if(n)n=m/d>h;return[n,c]}function j(B,R,P,k,h,c=null,m=null){let[d,a]=m??B[0].dims,n=new W.Tensor("int32",new Int32Array(d*a),[d,a]),t=[];if(m!==null)for(let D=0;D<B.length;++D)B[D]=(0,W.interpolate)(B[D],m,"bilinear",!1);let Q0=new Int32Array(B[0].data.length),o=new Float32Array(B[0].data.length);for(let D=0;D<B.length;++D){let O=R[D],p=B[D].data;for(let Z0=0;Z0<p.length;++Z0)if(p[Z0]*=O,p[Z0]>o[Z0])Q0[Z0]=D,o[Z0]=p[Z0]}let N0=0,w0=n.data;for(let D=0;D<P.length;++D){let O=P[D],[p,Z0]=I(Q0,B,D,k,h);if(!p)continue;++N0;for(let z0 of Z0)w0[z0]=N0;t.push({id:N0,label_id:O,score:R[D]})}return[n,t]}function y(B,R,P=28,k=3136,h=1003520){if(B<P||R<P)throw Error(`height:${B} or width:${R} must be larger than factor:${P}`);else if(Math.max(B,R)/Math.min(B,R)>200)throw Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(B,R)/Math.min(B,R)}`);let c=Math.round(B/P)*P,m=Math.round(R/P)*P;if(c*m>h){let d=Math.sqrt(B*R/h);c=Math.floor(B/d/P)*P,m=Math.floor(R/d/P)*P}else if(c*m<k){let d=Math.sqrt(k/(B*R));c=Math.ceil(B*d/P)*P,m=Math.ceil(R*d/P)*P}return[c,m]}function g(B,R=0.5,P=0.5,k=0.8,h=null,c=null){if(h===null)console.warn("`label_ids_to_fuse` unset. No instance will be fused."),h=new Set;let m=B.class_queries_logits??B.logits,a=(B.masks_queries_logits??B.pred_masks).sigmoid(),[n,t,Q0]=m.dims;if(Q0-=1,c!==null&&c.length!==n)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let o=[];for(let N0=0;N0<n;++N0){let w0=c!==null?c[N0]:null,D=m[N0],O=a[N0],[p,Z0,z0]=v(D,O,R,Q0);if(z0.length===0){let[h0,d0]=w0??O.dims.slice(-2),T0=new W.Tensor("int32",new Int32Array(h0*d0).fill(-1),[h0,d0]);o.push({segmentation:T0,segments_info:[]});continue}let[A0,j0]=j(p,Z0,z0,P,k,h,w0);o.push({segmentation:A0,segments_info:j0})}return o}function A(B,R=0.5,P=null){throw Error("`post_process_instance_segmentation` is not yet implemented.")}class T extends Q.Callable{constructor(B){super();if(this.image_mean=B.image_mean??B.mean,this.image_std=B.image_std??B.std,this.resample=B.resample??2,this.do_rescale=B.do_rescale??!0,this.rescale_factor=B.rescale_factor??0.00392156862745098,this.do_normalize=B.do_normalize,this.do_thumbnail=B.do_thumbnail,this.size=B.size??B.image_size,this.do_resize=B.do_resize??this.size!==void 0,this.size_divisibility=B.size_divisibility??B.size_divisor,this.do_center_crop=B.do_center_crop,this.crop_size=B.crop_size,this.do_convert_rgb=B.do_convert_rgb??!0,this.do_crop_margin=B.do_crop_margin,this.pad_size=B.pad_size,this.do_pad=B.do_pad,this.min_pixels=B.min_pixels,this.max_pixels=B.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0)this.pad_size=this.size;this.do_flip_channel_order=B.do_flip_channel_order??!1,this.config=B}async thumbnail(B,R,P=2){let{height:k,width:h}=B,c=R.height,m=R.width,d=Math.min(k,c),a=Math.min(h,m);if(d===k&&a===h)return B;if(k>h)a=Math.floor(h*d/k);else if(h>k)d=Math.floor(k*a/h);return await B.resize(a,d,{resample:P})}async crop_margin(B,R=200){let P=B.clone().grayscale(),k=(0,Y.min)(P.data)[0],c=(0,Y.max)(P.data)[0]-k;if(c===0)return B;let m=R/255,d=P.width,a=P.height,n=0,t=0,Q0=P.data;for(let o=0;o<P.height;++o){let N0=o*P.width;for(let w0=0;w0<P.width;++w0)if((Q0[N0+w0]-k)/c<m)d=Math.min(d,w0),a=Math.min(a,o),n=Math.max(n,w0),t=Math.max(t,o)}return B=await B.crop([d,a,n,t]),B}pad_image(B,R,P,{mode:k="constant",center:h=!1,constant_values:c=0}={}){let[m,d,a]=R,n,t;if(typeof P==="number")n=P,t=P;else if(P==="square")n=t=Math.max(m,d);else n=P.width,t=P.height;if(n!==d||t!==m){let Q0=new Float32Array(n*t*a);if(Array.isArray(c))for(let w0=0;w0<Q0.length;++w0)Q0[w0]=c[w0%a];else if(c!==0)Q0.fill(c);let[o,N0]=h?[Math.floor((n-d)/2),Math.floor((t-m)/2)]:[0,0];for(let w0=0;w0<m;++w0){let D=(w0+N0)*n,O=w0*d;for(let p=0;p<d;++p){let Z0=(D+p+o)*a,z0=(O+p)*a;for(let A0=0;A0<a;++A0)Q0[Z0+A0]=B[z0+A0]}}if(k==="symmetric"){if(h)throw Error("`center` padding is not supported when `mode` is set to `symmetric`.");let w0=m-1,D=d-1;for(let O=0;O<t;++O){let p=O*n,Z0=(0,G.calculateReflectOffset)(O,w0)*d;for(let z0=0;z0<n;++z0){if(O<m&&z0<d)continue;let A0=(p+z0)*a,j0=(Z0+(0,G.calculateReflectOffset)(z0,D))*a;for(let h0=0;h0<a;++h0)Q0[A0+h0]=B[j0+h0]}}}B=Q0,R=[t,n,a]}return[B,R]}rescale(B){for(let R=0;R<B.length;++R)B[R]=this.rescale_factor*B[R]}get_resize_output_image_size(B,R){let[P,k]=B.size,h,c;if(this.do_thumbnail){let{height:m,width:d}=R;h=Math.min(m,d)}else if(Number.isInteger(R))h=R,c=this.config.max_size??h;else if(R!==void 0)h=R.shortest_edge,c=R.longest_edge;if(h!==void 0||c!==void 0){let m=h===void 0?1:Math.max(h/P,h/k),d=P*m,a=k*m,n=c===void 0?1:Math.min(c/d,c/a),t=Math.floor(Number((d*n).toFixed(2))),Q0=Math.floor(Number((a*n).toFixed(2)));if(this.size_divisibility!==void 0)[t,Q0]=N([t,Q0],this.size_divisibility);return[t,Q0]}else if(R!==void 0&&R.width!==void 0&&R.height!==void 0){let{width:m,height:d}=R;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let a=d/k,n=m/P;if(Math.abs(1-n)<Math.abs(1-a))a=n;else n=a;d=U(a*k,this.config.ensure_multiple_of),m=U(n*P,this.config.ensure_multiple_of)}return[m,d]}else if(this.size_divisibility!==void 0)return N([P,k],this.size_divisibility);else if(this.min_pixels!==void 0&&this.max_pixels!==void 0){let m=this.config.patch_size*this.config.merge_size;return y(k,P,m,this.min_pixels,this.max_pixels)}else throw Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(R)}`)}async resize(B){let[R,P]=this.get_resize_output_image_size(B,this.size);return await B.resize(R,P,{resample:this.resample})}async preprocess(B,{do_normalize:R=null,do_pad:P=null,do_convert_rgb:k=null,do_convert_grayscale:h=null,do_flip_channel_order:c=null}={}){if(this.do_crop_margin)B=await this.crop_margin(B);let[m,d]=B.size;if(k??this.do_convert_rgb)B=B.rgb();else if(h)B=B.grayscale();if(this.do_resize)B=await this.resize(B);if(this.do_thumbnail)B=await this.thumbnail(B,this.size,this.resample);if(this.do_center_crop){let o,N0;if(Number.isInteger(this.crop_size))o=this.crop_size,N0=this.crop_size;else o=this.crop_size.width,N0=this.crop_size.height;B=await B.center_crop(o,N0)}let a=[B.height,B.width],n=Float32Array.from(B.data),t=[B.height,B.width,B.channels];if(this.do_rescale)this.rescale(n);if(R??this.do_normalize){let o=this.image_mean;if(!Array.isArray(this.image_mean))o=Array(B.channels).fill(o);let N0=this.image_std;if(!Array.isArray(this.image_std))N0=Array(B.channels).fill(o);if(o.length!==B.channels||N0.length!==B.channels)throw Error(`When set to arrays, the length of \`image_mean\` (${o.length}) and \`image_std\` (${N0.length}) must match the number of channels in the image (${B.channels}).`);for(let w0=0;w0<n.length;w0+=B.channels)for(let D=0;D<B.channels;++D)n[w0+D]=(n[w0+D]-o[D])/N0[D]}if(P??this.do_pad){if(this.pad_size)[n,t]=this.pad_image(n,[B.height,B.width,B.channels],this.pad_size);else if(this.size_divisibility){let[o,N0]=N([t[1],t[0]],this.size_divisibility);[n,t]=this.pad_image(n,t,{width:o,height:N0})}}if(c??this.do_flip_channel_order){if(t[2]!==3)throw Error("Flipping channel order is only supported for RGB images.");for(let o=0;o<n.length;o+=3){let N0=n[o];n[o]=n[o+2],n[o+2]=N0}}let Q0=new W.Tensor("float32",n,t).permute(2,0,1);return{original_size:[d,m],reshaped_input_size:a,pixel_values:Q0}}async _call(B,...R){if(!Array.isArray(B))B=[B];let P=await Promise.all(B.map((h)=>this.preprocess(h)));return{pixel_values:(0,W.stack)(P.map((h)=>h.pixel_values),0),original_sizes:P.map((h)=>h.original_size),reshaped_input_sizes:P.map((h)=>h.reshaped_input_size)}}static async from_pretrained(B,R={}){let P=await(0,q.getModelJSON)(B,z.IMAGE_PROCESSOR_NAME,!0,R);return new this(P)}}},"./src/base/processing_utils.js":(J,Z,$)=>{/*!**************************************!*\
  !*** ./src/base/processing_utils.js ***!
  \**************************************/$.r(Z),$.d(Z,{Processor:()=>H});var Q=$("./src/utils/constants.js");/*! ../utils/constants.js */var W=$("./src/utils/generic.js");/*! ../utils/generic.js */var Y=$("./src/utils/hub.js");/*! ../utils/hub.js */class H extends W.Callable{static classes=["image_processor_class","tokenizer_class","feature_extractor_class"];static uses_processor_config=!1;static uses_chat_template_file=!1;constructor(G,q,z){super();this.config=G,this.components=q,this.chat_template=z}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(G,q={}){if(!this.tokenizer)throw Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(G,{tokenize:!1,chat_template:this.chat_template??void 0,...q})}batch_decode(...G){if(!this.tokenizer)throw Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...G)}decode(...G){if(!this.tokenizer)throw Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...G)}async _call(G,...q){for(let z of[this.image_processor,this.feature_extractor,this.tokenizer])if(z)return z(G,...q);throw Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(G,q={}){let[z,U,N]=await Promise.all([this.uses_processor_config?(0,Y.getModelJSON)(G,Q.PROCESSOR_NAME,!0,q):{},Promise.all(this.classes.filter((L)=>(L in this)).map(async(L)=>{let w=await this[L].from_pretrained(G,q);return[L.replace(/_class$/,""),w]})).then(Object.fromEntries),this.uses_chat_template_file?(0,Y.getModelText)(G,Q.CHAT_TEMPLATE_NAME,!0,q):null]);return new this(z,U,N)}}},"./src/configs.js":(J,Z,$)=>{/*!************************!*\
  !*** ./src/configs.js ***!
  \************************/$.r(Z),$.d(Z,{AutoConfig:()=>U,PretrainedConfig:()=>z,getCacheShapes:()=>G});var Q=$("./src/utils/core.js");/*! ./utils/core.js */var W=$("./src/utils/hub.js");/*! ./utils/hub.js */async function Y(N,L){return await(0,W.getModelJSON)(N,"config.json",!0,L)}function H(N){let L={},w={};switch(N.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":w=H(N.text_config);break;case"moondream1":w=H(N.phi_config);break;case"musicgen":w=H(N.decoder);break;case"multi_modality":w=H(N.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":L.num_heads="n_head",L.num_layers="n_layer",L.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":L.num_heads="num_attention_heads",L.num_layers="num_hidden_layers",L.hidden_size="hidden_size";break;case"llama":case"llama4_text":case"nanochat":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"granitemoehybrid":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":L.num_heads="num_key_value_heads",L.num_layers="num_hidden_layers",L.hidden_size="hidden_size",L.num_attention_heads="num_attention_heads",L.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"vaultgemma":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":L.num_heads="num_key_value_heads",L.num_layers="num_hidden_layers",L.dim_kv="head_dim";break;case"openelm":L.num_heads="num_kv_heads",L.num_layers="num_transformer_layers",L.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":L.num_heads="num_heads",L.num_layers="num_layers",L.hidden_size="hidden_size";break;case"bloom":L.num_heads="n_head",L.num_layers="n_layer",L.hidden_size="hidden_size";break;case"mpt":L.num_heads="n_heads",L.num_layers="n_layers",L.hidden_size="d_model";break;case"exaone":L.num_heads="num_key_value_heads",L.num_layers="num_layers",L.dim_kv="head_dim",L.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":L.num_decoder_layers="num_decoder_layers",L.num_decoder_heads="num_heads",L.decoder_dim_kv="d_kv",L.num_encoder_layers="num_layers",L.num_encoder_heads="num_heads",L.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":L.num_decoder_layers="decoder_layers",L.num_decoder_heads="decoder_attention_heads",L.decoder_hidden_size="d_model",L.num_encoder_layers="encoder_layers",L.num_encoder_heads="encoder_attention_heads",L.encoder_hidden_size="d_model";break;case"speecht5":L.num_decoder_layers="decoder_layers",L.num_decoder_heads="decoder_attention_heads",L.decoder_hidden_size="hidden_size",L.num_encoder_layers="encoder_layers",L.num_encoder_heads="encoder_attention_heads",L.encoder_hidden_size="hidden_size";break;case"trocr":L.num_encoder_layers=L.num_decoder_layers="decoder_layers",L.num_encoder_heads=L.num_decoder_heads="decoder_attention_heads",L.encoder_hidden_size=L.decoder_hidden_size="d_model";break;case"musicgen_decoder":L.num_encoder_layers=L.num_decoder_layers="num_hidden_layers",L.num_encoder_heads=L.num_decoder_heads="num_attention_heads",L.encoder_hidden_size=L.decoder_hidden_size="hidden_size";break;case"moonshine":L.num_decoder_layers="decoder_num_hidden_layers",L.num_decoder_heads="decoder_num_key_value_heads",L.num_encoder_layers="encoder_num_hidden_layers",L.num_encoder_heads="encoder_num_key_value_heads",L.encoder_hidden_size=L.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":let v=H(N.decoder),I="num_decoder_layers"in v,j=(0,Q.pick)(N,["model_type","is_encoder_decoder"]);if(I)j.num_decoder_layers=v.num_decoder_layers,j.num_decoder_heads=v.num_decoder_heads,j.decoder_hidden_size=v.decoder_hidden_size,j.num_encoder_layers=v.num_encoder_layers,j.num_encoder_heads=v.num_encoder_heads,j.encoder_hidden_size=v.encoder_hidden_size;else j.num_layers=v.num_layers,j.num_heads=v.num_heads,j.hidden_size=v.hidden_size;return j}let F={...w,...(0,Q.pick)(N,["model_type","multi_query","is_encoder_decoder"])};for(let v in L)F[v]=N[L[v]];return F}function G(N,L){if(N.model_type==="lfm2"){let w=L?.prefix??"past_key_values",F=w==="present"?"present":"past",v={},{layer_types:I,num_attention_heads:j,num_key_value_heads:y,hidden_size:g,conv_L_cache:A}=N,T=g/j,B=L?.batch_size??1;for(let R=0;R<I.length;++R)if(I[R]==="full_attention")for(let P of["key","value"])v[`${w}.${R}.${P}`]=[B,y,0,T];else if(I[R]==="conv")v[`${F}_conv.${R}`]=[B,g,A];else throw Error(`Unsupported layer type: ${I[R]}`);return v}return q(N,L)}function q(N,{prefix:L="past_key_values",batch_size:w=1}={}){let F={},v=N.normalized_config;if(v.is_encoder_decoder&&(("num_encoder_heads"in v)&&("num_decoder_heads"in v))){let I=v.encoder_dim_kv??v.encoder_hidden_size/v.num_encoder_heads,j=v.decoder_dim_kv??v.decoder_hidden_size/v.num_decoder_heads,y=[w,v.num_encoder_heads,0,I],g=[w,v.num_decoder_heads,0,j];for(let A=0;A<v.num_decoder_layers;++A)F[`${L}.${A}.encoder.key`]=y,F[`${L}.${A}.encoder.value`]=y,F[`${L}.${A}.decoder.key`]=g,F[`${L}.${A}.decoder.value`]=g}else{let{num_heads:I,num_layers:j}=v,y=v.dim_kv??v.hidden_size/(v.num_attention_heads??I);if(v.model_type==="falcon"){let g=[w*I,0,y];for(let A=0;A<j;++A)F[`${L}.${A}.key`]=g,F[`${L}.${A}.value`]=g}else if(v.multi_query){let g=[w*I,0,2*y];for(let A=0;A<j;++A)F[`${L}.${A}.key_value`]=g}else if(v.model_type==="bloom"){let g=[w*I,y,0],A=[w*I,0,y];for(let T=0;T<j;++T)F[`${L}.${T}.key`]=g,F[`${L}.${T}.value`]=A}else if(v.model_type==="openelm")for(let g=0;g<j;++g){let A=[w,I[g],0,y];F[`${L}.${g}.key`]=A,F[`${L}.${g}.value`]=A}else{let g=[w,I,0,y];for(let A=0;A<j;++A)F[`${L}.${A}.key`]=g,F[`${L}.${A}.value`]=g}}return F}class z{model_type=null;is_encoder_decoder=!1;max_position_embeddings;"transformers.js_config";constructor(N){Object.assign(this,N),this.normalized_config=H(this)}static async from_pretrained(N,{progress_callback:L=null,config:w=null,cache_dir:F=null,local_files_only:v=!1,revision:I="main"}={}){if(w&&!(w instanceof z))w=new z(w);let j=w??await Y(N,{progress_callback:L,config:w,cache_dir:F,local_files_only:v,revision:I});return new this(j)}}class U{static async from_pretrained(...N){return z.from_pretrained(...N)}}},"./src/env.js":(J,Z,$)=>{/*!********************!*\
  !*** ./src/env.js ***!
  \********************/$.r(Z),$.d(Z,{apis:()=>y,env:()=>P});var Q=$("node:fs");/*! node:fs */var W=$("node:path");/*! node:path */var Y=$("node:url");/*! node:url */let H="3.7.6",G=typeof window<"u"&&typeof window.document<"u",q=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes(self.constructor?.name),z=typeof self<"u"&&"caches"in self,U=typeof navigator<"u"&&"gpu"in navigator,N=typeof navigator<"u"&&"ml"in navigator,L=typeof process<"u",w=L&&process?.release?.name==="node",F=!k(Q.default),v=!k(W.default),I=typeof globalThis.Deno<"u",j=typeof globalThis.Bun<"u",y=Object.freeze({IS_BROWSER_ENV:G,IS_WEBWORKER_ENV:q,IS_WEB_CACHE_AVAILABLE:z,IS_WEBGPU_AVAILABLE:U,IS_WEBNN_AVAILABLE:N,IS_PROCESS_AVAILABLE:L,IS_NODE_ENV:w,IS_FS_AVAILABLE:F,IS_PATH_AVAILABLE:v}),g=F&&v,A="./";if(g){let h=Object(import.meta).url;if(h)A=W.default.dirname(W.default.dirname(Y.default.fileURLToPath(h)));else if(typeof __dirname<"u")A=W.default.dirname(__dirname)}let T=g?W.default.join(A,"/.cache/"):null,B="/models/",R=g?W.default.join(A,B):B,P={version:H,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(G||q),localModelPath:R,useFS:F,useBrowserCache:z&&!I,useFSCache:F,cacheDir:T,useCustomCache:!1,customCache:null};function k(h){return Object.keys(h).length===0}},"./src/generation/configuration_utils.js":(J,Z,$)=>{/*!***********************************************!*\
  !*** ./src/generation/configuration_utils.js ***!
  \***********************************************/$.r(Z),$.d(Z,{GenerationConfig:()=>W});var Q=$("./src/utils/core.js");/*! ../utils/core.js */class W{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=!1;max_time=null;do_sample=!1;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=!0;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=!1;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=!1;exponential_decay_length_penalty=null;suppress_tokens=null;streamer=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=!1;output_hidden_states=!1;output_scores=!1;return_dict_in_generate=!1;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(Y){Object.assign(this,(0,Q.pick)(Y,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/generation/logits_process.js ***!
  \******************************************/$.r(Z),$.d(Z,{ClassifierFreeGuidanceLogitsProcessor:()=>y,ForcedBOSTokenLogitsProcessor:()=>z,ForcedEOSTokenLogitsProcessor:()=>U,LogitsProcessor:()=>H,LogitsProcessorList:()=>q,LogitsWarper:()=>G,MinLengthLogitsProcessor:()=>v,MinNewTokensLengthLogitsProcessor:()=>I,NoBadWordsLogitsProcessor:()=>j,NoRepeatNGramLogitsProcessor:()=>w,RepetitionPenaltyLogitsProcessor:()=>F,SuppressTokensAtBeginLogitsProcessor:()=>N,TemperatureLogitsWarper:()=>g,TopKLogitsWarper:()=>T,TopPLogitsWarper:()=>A,WhisperTimeStampLogitsProcessor:()=>L});var Q=$("./src/utils/generic.js");/*! ../utils/generic.js */var W=$("./src/utils/tensor.js");/*! ../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../utils/maths.js */class H extends Q.Callable{_call(B,R){throw Error("`_call` should be implemented in a subclass")}}class G extends Q.Callable{_call(B,R){throw Error("`_call` should be implemented in a subclass")}}class q extends Q.Callable{constructor(){super();this.processors=[]}push(B){this.processors.push(B)}extend(B){this.processors.push(...B)}_call(B,R){let P=R;for(let k of this.processors)P=k(B,P);return P}[Symbol.iterator](){return this.processors.values()}}class z extends H{constructor(B){super();this.bos_token_id=B}_call(B,R){for(let P=0;P<B.length;++P)if(B[P].length===1){let k=R[P].data;k.fill(-1/0),k[this.bos_token_id]=0}return R}}class U extends H{constructor(B,R){super();this.max_length=B,this.eos_token_id=Array.isArray(R)?R:[R]}_call(B,R){for(let P=0;P<B.length;++P)if(B[P].length===this.max_length-1){let k=R[P].data;k.fill(-1/0);for(let h of this.eos_token_id)k[h]=0}return R}}class N extends H{constructor(B,R){super();this.begin_suppress_tokens=B,this.begin_index=R}_call(B,R){for(let P=0;P<B.length;++P)if(B[P].length===this.begin_index){let k=R[P].data;for(let h of this.begin_suppress_tokens)k[h]=-1/0}return R}}class L extends H{constructor(B,R){super();if(this.eos_token_id=Array.isArray(B.eos_token_id)?B.eos_token_id[0]:B.eos_token_id,this.no_timestamps_token_id=B.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=R.length,R.at(-1)===this.no_timestamps_token_id)this.begin_index-=1;this.max_initial_timestamp_index=B.max_initial_timestamp_index}_call(B,R){for(let P=0;P<B.length;++P){let k=R[P].data;if(k[this.no_timestamps_token_id]=-1/0,B[P].length===this.begin_index-1){k.fill(-1/0),k[this.timestamp_begin]=0;continue}let h=B[P].slice(this.begin_index),c=h.length>=1&&h[h.length-1]>=this.timestamp_begin,m=h.length<2||h[h.length-2]>=this.timestamp_begin;if(c)if(m)k.subarray(this.timestamp_begin).fill(-1/0);else k.subarray(0,this.eos_token_id).fill(-1/0);if(B[P].length===this.begin_index&&this.max_initial_timestamp_index!==null){let t=this.timestamp_begin+this.max_initial_timestamp_index;k.subarray(t+1).fill(-1/0)}let d=(0,Y.log_softmax)(k),a=Math.log(d.subarray(this.timestamp_begin).map(Math.exp).reduce((t,Q0)=>t+Q0)),n=(0,Y.max)(d.subarray(0,this.timestamp_begin))[0];if(a>n)k.subarray(0,this.timestamp_begin).fill(-1/0)}return R}}class w extends H{constructor(B){super();this.no_repeat_ngram_size=B}getNgrams(B){let R=B.length,P=[];for(let h=0;h<R+1-this.no_repeat_ngram_size;++h){let c=[];for(let m=0;m<this.no_repeat_ngram_size;++m)c.push(B[h+m]);P.push(c.map(Number))}let k=new Map;for(let h of P){let c=h.slice(0,h.length-1),m=JSON.stringify(c),d=k.get(m)??[];d.push(h[h.length-1]),k.set(m,d)}return k}getGeneratedNgrams(B,R){let P=R.slice(R.length+1-this.no_repeat_ngram_size,R.length);return B.get(JSON.stringify(P.map(Number)))??[]}calcBannedNgramTokens(B){let R=[];if(B.length+1<this.no_repeat_ngram_size)return R;else{let P=this.getNgrams(B);return this.getGeneratedNgrams(P,B)}}_call(B,R){for(let P=0;P<B.length;++P){let k=R[P].data,h=this.calcBannedNgramTokens(B[P]);for(let c of h)k[c]=-1/0}return R}}class F extends H{constructor(B){super();this.penalty=B}_call(B,R){for(let P=0;P<B.length;++P){let k=R[P].data;for(let h of new Set(B[P])){let c=Number(h);if(k[c]<0)k[c]*=this.penalty;else k[c]/=this.penalty}}return R}}class v extends H{constructor(B,R){super();this.min_length=B,this.eos_token_id=Array.isArray(R)?R:[R]}_call(B,R){for(let P=0;P<B.length;++P)if(B[P].length<this.min_length){let k=R[P].data;for(let h of this.eos_token_id)k[h]=-1/0}return R}}class I extends H{constructor(B,R,P){super();this.prompt_length_to_skip=B,this.min_new_tokens=R,this.eos_token_id=Array.isArray(P)?P:[P]}_call(B,R){for(let P=0;P<B.length;++P)if(B[P].length-this.prompt_length_to_skip<this.min_new_tokens){let h=R[P].data;for(let c of this.eos_token_id)h[c]=-1/0}return R}}class j extends H{constructor(B,R){super();this.bad_words_ids=B,this.eos_token_id=Array.isArray(R)?R:[R]}_call(B,R){for(let P=0;P<B.length;++P){let k=R[P].data,h=B[P];for(let c of this.bad_words_ids){if(h.length<c.length-1)continue;let m=!0;for(let d=1;d<=c.length-1;++d)if(c.at(-d-1)!=h.at(-d)){m=!1;break}if(m)k[c.at(-1)]=-1/0}}return R}}class y extends H{constructor(B){super();if(B<=1)throw Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${B}.`);this.guidance_scale=B}_call(B,R){if(R.dims[0]!==2*B.length)throw Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${R.dims[0]} for the logits and ${B.length} for the input ids.`);let P=B.length,k=R.slice([0,P],null),h=R.slice([P,R.dims[0]],null);for(let c=0;c<h.data.length;++c)h.data[c]+=(k.data[c]-h.data[c])*this.guidance_scale;return h}}class g extends G{constructor(B){super();if(typeof B!=="number"||B<=0){let R=`\`temperature\` (=${B}) must be a strictly positive float, otherwise your next token scores will be invalid.`;if(B===0)R+=" If you're looking for greedy decoding strategies, set `do_sample=false`."}this.temperature=B}_call(B,R){let P=R.data;for(let k=0;k<P.length;++k)P[k]/=this.temperature;return R}}class A extends G{constructor(B,{filter_value:R=-1/0,min_tokens_to_keep:P=1}={}){super();if(B<0||B>1)throw Error(`\`top_p\` must be a float > 0 and < 1, but is ${B}`);if(!Number.isInteger(P)||P<1)throw Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${P}`);this.top_p=B,this.filter_value=R,this.min_tokens_to_keep=P}}class T extends G{constructor(B,{filter_value:R=-1/0,min_tokens_to_keep:P=1}={}){super();if(!Number.isInteger(B)||B<0)throw Error(`\`top_k\` must be a positive integer, but is ${B}`);this.top_k=Math.max(B,P),this.filter_value=R}}},"./src/generation/logits_sampler.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/generation/logits_sampler.js ***!
  \******************************************/$.r(Z),$.d(Z,{LogitsSampler:()=>G});var Q=$("./src/utils/generic.js");/*! ../utils/generic.js */var W=$("./src/utils/tensor.js");/*! ../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../utils/maths.js */var H=$("./src/generation/configuration_utils.js");/*! ../generation/configuration_utils.js */class G extends Q.Callable{constructor(N){super();this.generation_config=N}async _call(N){return this.sample(N)}async sample(N){throw Error("sample should be implemented in subclasses.")}getLogits(N,L){let w=N.dims.at(-1),F=N.data;if(L===-1)F=F.slice(-w);else{let v=L*w;F=F.slice(v,v+w)}return F}randomSelect(N){let L=0;for(let F=0;F<N.length;++F)L+=N[F];let w=Math.random()*L;for(let F=0;F<N.length;++F)if(w-=N[F],w<=0)return F;return 0}static getSampler(N){if(N.do_sample)return new z(N);else if(N.num_beams>1)return new U(N);else{if(N.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${N.num_return_sequences}.`);return new q(N)}}}class q extends G{async sample(N){let L=(0,Y.max)(N.data)[1];return[[BigInt(L),0]]}}class z extends G{async sample(N){let L=N.dims.at(-1);if(this.generation_config.top_k>0)L=Math.min(this.generation_config.top_k,L);let[w,F]=await(0,W.topk)(N,L),v=(0,Y.softmax)(w.data);return Array.from({length:this.generation_config.num_beams},()=>{let I=this.randomSelect(v);return[F.data[I],Math.log(v[I])]})}}class U extends G{async sample(N){let L=N.dims.at(-1);if(this.generation_config.top_k>0)L=Math.min(this.generation_config.top_k,L);let[w,F]=await(0,W.topk)(N,L),v=(0,Y.softmax)(w.data);return Array.from({length:this.generation_config.num_beams},(I,j)=>{return[F.data[j],Math.log(v[j])]})}}},"./src/generation/stopping_criteria.js":(J,Z,$)=>{/*!*********************************************!*\
  !*** ./src/generation/stopping_criteria.js ***!
  \*********************************************/$.r(Z),$.d(Z,{EosTokenCriteria:()=>G,InterruptableStoppingCriteria:()=>q,MaxLengthCriteria:()=>H,StoppingCriteria:()=>W,StoppingCriteriaList:()=>Y});var Q=$("./src/utils/generic.js");/*! ../utils/generic.js */class W extends Q.Callable{_call(z,U){throw Error("StoppingCriteria needs to be subclassed")}}class Y extends Q.Callable{constructor(){super();this.criteria=[]}push(z){this.criteria.push(z)}extend(z){if(z instanceof Y)z=z.criteria;else if(z instanceof W)z=[z];this.criteria.push(...z)}_call(z,U){let N=Array(z.length).fill(!1);for(let L of this.criteria){let w=L(z,U);for(let F=0;F<N.length;++F)N[F]||=w[F]}return N}[Symbol.iterator](){return this.criteria.values()}}class H extends W{constructor(z,U=null){super();this.max_length=z,this.max_position_embeddings=U}_call(z){return z.map((U)=>U.length>=this.max_length)}}class G extends W{constructor(z){super();if(!Array.isArray(z))z=[z];this.eos_token_id=z}_call(z,U){return z.map((N)=>{let L=N.at(-1);return this.eos_token_id.some((w)=>L==w)})}}class q extends W{constructor(){super();this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(z,U){return Array(z.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(J,Z,$)=>{/*!*************************************!*\
  !*** ./src/generation/streamers.js ***!
  \*************************************/$.r(Z),$.d(Z,{BaseStreamer:()=>H,TextStreamer:()=>q,WhisperTextStreamer:()=>z});var Q=$("./src/utils/core.js");/*! ../utils/core.js */var W=$("./src/tokenizers.js");/*! ../tokenizers.js */var Y=$("./src/env.js");/*! ../env.js */class H{put(U){throw Error("Not implemented")}end(){throw Error("Not implemented")}}let G=Y.apis.IS_PROCESS_AVAILABLE?(U)=>process.stdout.write(U):(U)=>console.log(U);class q extends H{constructor(U,{skip_prompt:N=!1,callback_function:L=null,token_callback_function:w=null,skip_special_tokens:F=!0,decode_kwargs:v={},...I}={}){super();this.tokenizer=U,this.skip_prompt=N,this.callback_function=L??G,this.token_callback_function=w,this.decode_kwargs={skip_special_tokens:F,...v,...I},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(U){if(U.length>1)throw Error("TextStreamer only supports batch size of 1");let N=this.next_tokens_are_prompt;if(N){if(this.next_tokens_are_prompt=!1,this.skip_prompt)return}let L=U[0];this.token_callback_function?.(L),this.token_cache=(0,Q.mergeArrays)(this.token_cache,L);let w=this.tokenizer.decode(this.token_cache,this.decode_kwargs),F;if(N||w.endsWith(`
`))F=w.slice(this.print_len),this.token_cache=[],this.print_len=0;else if(w.length>0&&(0,W.is_chinese_char)(w.charCodeAt(w.length-1)))F=w.slice(this.print_len),this.print_len+=F.length;else F=w.slice(this.print_len,w.lastIndexOf(" ")+1),this.print_len+=F.length;this.on_finalized_text(F,!1)}end(){let U;if(this.token_cache.length>0)U=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0;else U="";this.next_tokens_are_prompt=!0,this.on_finalized_text(U,!0)}on_finalized_text(U,N){if(U.length>0)this.callback_function?.(U);if(N&&this.callback_function===G&&Y.apis.IS_PROCESS_AVAILABLE)this.callback_function?.(`
`)}}class z extends q{constructor(U,{skip_prompt:N=!1,callback_function:L=null,token_callback_function:w=null,on_chunk_start:F=null,on_chunk_end:v=null,on_finalize:I=null,time_precision:j=0.02,skip_special_tokens:y=!0,decode_kwargs:g={}}={}){super(U,{skip_prompt:N,skip_special_tokens:y,callback_function:L,token_callback_function:w,decode_kwargs:g});this.timestamp_begin=U.timestamp_begin,this.on_chunk_start=F,this.on_chunk_end=v,this.on_finalize=I,this.time_precision=j,this.waiting_for_timestamp=!1}put(U){if(U.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");let N=U[0];if(N.length===1){let L=Number(N[0])-this.timestamp_begin;if(L>=0){let w=L*this.time_precision;if(this.waiting_for_timestamp)this.on_chunk_end?.(w);else this.on_chunk_start?.(w);this.waiting_for_timestamp=!this.waiting_for_timestamp,this.token_callback_function?.(N);return}}return super.put(U)}end(){super.end(),this.on_finalize?.()}}},"./src/models.js":(J,Z,$)=>{/*!***********************!*\
  !*** ./src/models.js ***!
  \***********************/$.r(Z),$.d(Z,{ASTForAudioClassification:()=>w8,ASTModel:()=>I8,ASTPreTrainedModel:()=>r5,AlbertForMaskedLM:()=>L6,AlbertForQuestionAnswering:()=>_0,AlbertForSequenceClassification:()=>f0,AlbertModel:()=>O0,AlbertPreTrainedModel:()=>k0,ArceeForCausalLM:()=>AQ,ArceeModel:()=>LQ,ArceePreTrainedModel:()=>N$,AutoModel:()=>EG,AutoModelForAudioClassification:()=>vG,AutoModelForAudioFrameClassification:()=>bG,AutoModelForAudioTextToText:()=>aG,AutoModelForCTC:()=>yG,AutoModelForCausalLM:()=>IG,AutoModelForDepthEstimation:()=>uG,AutoModelForDocumentQuestionAnswering:()=>hG,AutoModelForImageClassification:()=>CG,AutoModelForImageFeatureExtraction:()=>cG,AutoModelForImageMatting:()=>fG,AutoModelForImageSegmentation:()=>SG,AutoModelForImageTextToText:()=>mG,AutoModelForImageToImage:()=>dG,AutoModelForMaskGeneration:()=>xG,AutoModelForMaskedLM:()=>wG,AutoModelForNormalEstimation:()=>gG,AutoModelForObjectDetection:()=>_G,AutoModelForPoseEstimation:()=>lG,AutoModelForQuestionAnswering:()=>jG,AutoModelForSemanticSegmentation:()=>MG,AutoModelForSeq2SeqLM:()=>BG,AutoModelForSequenceClassification:()=>LG,AutoModelForSpeechSeq2Seq:()=>RG,AutoModelForTextToSpectrogram:()=>FG,AutoModelForTextToWaveform:()=>DG,AutoModelForTokenClassification:()=>AG,AutoModelForUniversalSegmentation:()=>TG,AutoModelForVision2Seq:()=>PG,AutoModelForXVector:()=>OG,AutoModelForZeroShotObjectDetection:()=>kG,BartForConditionalGeneration:()=>n6,BartForSequenceClassification:()=>N4,BartModel:()=>M6,BartPretrainedModel:()=>b4,BaseModelOutput:()=>B0,BeitForImageClassification:()=>dW,BeitModel:()=>fW,BeitPreTrainedModel:()=>p$,BertForMaskedLM:()=>Y0,BertForQuestionAnswering:()=>F0,BertForSequenceClassification:()=>E0,BertForTokenClassification:()=>X0,BertModel:()=>R0,BertPreTrainedModel:()=>D0,BlenderbotForConditionalGeneration:()=>u6,BlenderbotModel:()=>d6,BlenderbotPreTrainedModel:()=>h6,BlenderbotSmallForConditionalGeneration:()=>L5,BlenderbotSmallModel:()=>vJ,BlenderbotSmallPreTrainedModel:()=>z4,BloomForCausalLM:()=>GW,BloomModel:()=>YW,BloomPreTrainedModel:()=>v$,CLIPModel:()=>h8,CLIPPreTrainedModel:()=>wJ,CLIPSegForImageSegmentation:()=>n8,CLIPSegModel:()=>e8,CLIPSegPreTrainedModel:()=>Q$,CLIPTextModel:()=>bY,CLIPTextModelWithProjection:()=>f8,CLIPVisionModel:()=>hY,CLIPVisionModelWithProjection:()=>d8,CamembertForMaskedLM:()=>t0,CamembertForQuestionAnswering:()=>E6,CamembertForSequenceClassification:()=>v0,CamembertForTokenClassification:()=>U6,CamembertModel:()=>c0,CamembertPreTrainedModel:()=>L0,CausalLMOutput:()=>NJ,CausalLMOutputWithPast:()=>rG,ChineseCLIPModel:()=>m8,ChineseCLIPPreTrainedModel:()=>c8,ClapAudioModelWithProjection:()=>r9,ClapModel:()=>a9,ClapPreTrainedModel:()=>C5,ClapTextModelWithProjection:()=>p9,CodeGenForCausalLM:()=>qQ,CodeGenModel:()=>XQ,CodeGenPreTrainedModel:()=>H$,CohereForCausalLM:()=>dQ,CohereModel:()=>fQ,CoherePreTrainedModel:()=>j$,ConvBertForMaskedLM:()=>WJ,ConvBertForQuestionAnswering:()=>YJ,ConvBertForSequenceClassification:()=>KJ,ConvBertForTokenClassification:()=>H6,ConvBertModel:()=>Z6,ConvBertPreTrainedModel:()=>v4,ConvNextForImageClassification:()=>y7,ConvNextModel:()=>x7,ConvNextPreTrainedModel:()=>GZ,ConvNextV2ForImageClassification:()=>O7,ConvNextV2Model:()=>v7,ConvNextV2PreTrainedModel:()=>XZ,DFineForObjectDetection:()=>tW,DFineModel:()=>iW,DFinePreTrainedModel:()=>t$,DINOv3ConvNextModel:()=>c7,DINOv3ConvNextPreTrainedModel:()=>l7,DINOv3ViTModel:()=>g7,DINOv3ViTPreTrainedModel:()=>u7,DPTForDepthEstimation:()=>z7,DPTModel:()=>N7,DPTPreTrainedModel:()=>WZ,DacDecoderModel:()=>OK,DacDecoderOutput:()=>xK,DacEncoderModel:()=>vK,DacEncoderOutput:()=>kK,DacModel:()=>yK,DacPreTrainedModel:()=>y5,DebertaForMaskedLM:()=>U4,DebertaForQuestionAnswering:()=>p6,DebertaForSequenceClassification:()=>F4,DebertaForTokenClassification:()=>Z4,DebertaModel:()=>j6,DebertaPreTrainedModel:()=>x6,DebertaV2ForMaskedLM:()=>l4,DebertaV2ForQuestionAnswering:()=>c4,DebertaV2ForSequenceClassification:()=>O4,DebertaV2ForTokenClassification:()=>GJ,DebertaV2Model:()=>g4,DebertaV2PreTrainedModel:()=>D4,DecisionTransformerModel:()=>zK,DecisionTransformerPreTrainedModel:()=>NK,DeiTForImageClassification:()=>Q7,DeiTModel:()=>Z7,DeiTPreTrainedModel:()=>JZ,DepthAnythingForDepthEstimation:()=>L7,DepthAnythingPreTrainedModel:()=>E7,DepthProForDepthEstimation:()=>D7,DepthProPreTrainedModel:()=>F7,DetrForObjectDetection:()=>gW,DetrForSegmentation:()=>r$,DetrModel:()=>uW,DetrObjectDetectionOutput:()=>e$,DetrPreTrainedModel:()=>F5,DetrSegmentationOutput:()=>lW,Dinov2ForImageClassification:()=>h7,Dinov2Model:()=>b7,Dinov2PreTrainedModel:()=>qZ,Dinov2WithRegistersForImageClassification:()=>d7,Dinov2WithRegistersModel:()=>f7,Dinov2WithRegistersPreTrainedModel:()=>HZ,DistilBertForMaskedLM:()=>m4,DistilBertForQuestionAnswering:()=>qJ,DistilBertForSequenceClassification:()=>x4,DistilBertForTokenClassification:()=>XJ,DistilBertModel:()=>k4,DistilBertPreTrainedModel:()=>j4,DonutSwinModel:()=>k7,DonutSwinPreTrainedModel:()=>_7,EfficientNetForImageClassification:()=>JK,EfficientNetModel:()=>o9,EfficientNetPreTrainedModel:()=>DZ,ElectraForMaskedLM:()=>C,ElectraForQuestionAnswering:()=>G0,ElectraForSequenceClassification:()=>f,ElectraForTokenClassification:()=>r,ElectraModel:()=>u,ElectraPreTrainedModel:()=>E,Ernie4_5_ForCausalLM:()=>u9,Ernie4_5_Model:()=>d9,Ernie4_5_PretrainedModel:()=>LZ,EsmForMaskedLM:()=>HJ,EsmForSequenceClassification:()=>Y4,EsmForTokenClassification:()=>P0,EsmModel:()=>a4,EsmPreTrainedModel:()=>P4,ExaoneForCausalLM:()=>SQ,ExaoneModel:()=>CQ,ExaonePreTrainedModel:()=>B$,FalconForCausalLM:()=>m9,FalconModel:()=>c9,FalconPreTrainedModel:()=>BZ,FastViTForImageClassification:()=>SW,FastViTModel:()=>CW,FastViTPreTrainedModel:()=>g$,Florence2ForConditionalGeneration:()=>_8,Florence2PreTrainedModel:()=>T8,GLPNForDepthEstimation:()=>T7,GLPNModel:()=>M7,GLPNPreTrainedModel:()=>YZ,GPT2LMHeadModel:()=>i8,GPT2Model:()=>s8,GPT2PreTrainedModel:()=>W$,GPTBigCodeForCausalLM:()=>GQ,GPTBigCodeModel:()=>YQ,GPTBigCodePreTrainedModel:()=>q$,GPTJForCausalLM:()=>KQ,GPTJModel:()=>WQ,GPTJPreTrainedModel:()=>X$,GPTNeoForCausalLM:()=>$Q,GPTNeoModel:()=>JQ,GPTNeoPreTrainedModel:()=>Y$,GPTNeoXForCausalLM:()=>QQ,GPTNeoXModel:()=>ZQ,GPTNeoXPreTrainedModel:()=>G$,Gemma2ForCausalLM:()=>cQ,Gemma2Model:()=>lQ,Gemma2PreTrainedModel:()=>C$,Gemma3ForCausalLM:()=>rQ,Gemma3Model:()=>pQ,Gemma3PreTrainedModel:()=>M$,Gemma3nForConditionalGeneration:()=>o5,Gemma3nPreTrainedModel:()=>v8,GemmaForCausalLM:()=>gQ,GemmaModel:()=>uQ,GemmaPreTrainedModel:()=>P$,GlmForCausalLM:()=>PQ,GlmModel:()=>jQ,GlmPreTrainedModel:()=>A$,GraniteForCausalLM:()=>OQ,GraniteModel:()=>vQ,GraniteMoeHybridForCausalLM:()=>hQ,GraniteMoeHybridModel:()=>bQ,GraniteMoeHybridPreTrainedModel:()=>w$,GranitePreTrainedModel:()=>I$,GroundingDinoForObjectDetection:()=>a7,GroundingDinoPreTrainedModel:()=>m7,GroupViTModel:()=>PW,GroupViTPreTrainedModel:()=>jW,HeliumForCausalLM:()=>wQ,HeliumModel:()=>IQ,HeliumPreTrainedModel:()=>L$,HieraForImageClassification:()=>K7,HieraModel:()=>W7,HieraPreTrainedModel:()=>$Z,HubertForCTC:()=>w9,HubertForSequenceClassification:()=>j9,HubertModel:()=>I9,HubertPreTrainedModel:()=>fY,IJepaForImageClassification:()=>EW,IJepaModel:()=>zW,IJepaPreTrainedModel:()=>f$,Idefics3ForConditionalGeneration:()=>B5,Idefics3PreTrainedModel:()=>O8,ImageMattingOutput:()=>mK,JAISLMHeadModel:()=>o8,JAISModel:()=>t8,JAISPreTrainedModel:()=>K$,JinaCLIPModel:()=>a8,JinaCLIPPreTrainedModel:()=>R5,JinaCLIPTextModel:()=>p8,JinaCLIPVisionModel:()=>r8,Lfm2ForCausalLM:()=>RQ,Lfm2Model:()=>BQ,Lfm2PreTrainedModel:()=>z$,LiteWhisperForConditionalGeneration:()=>P8,Llama4ForCausalLM:()=>NQ,Llama4PreTrainedModel:()=>UQ,LlamaForCausalLM:()=>VQ,LlamaModel:()=>HQ,LlamaPreTrainedModel:()=>V$,LlavaForConditionalGeneration:()=>A5,LlavaOnevisionForConditionalGeneration:()=>S8,LlavaPreTrainedModel:()=>t5,LlavaQwen2ForCausalLM:()=>y8,LongT5ForConditionalGeneration:()=>e6,LongT5Model:()=>Q4,LongT5PreTrainedModel:()=>v6,M2M100ForConditionalGeneration:()=>$9,M2M100Model:()=>J9,M2M100PreTrainedModel:()=>NZ,MBartForCausalLM:()=>s6,MBartForConditionalGeneration:()=>W4,MBartForSequenceClassification:()=>h4,MBartModel:()=>r4,MBartPreTrainedModel:()=>I4,MPNetForMaskedLM:()=>xJ,MPNetForQuestionAnswering:()=>V,MPNetForSequenceClassification:()=>yJ,MPNetForTokenClassification:()=>oJ,MPNetModel:()=>kJ,MPNetPreTrainedModel:()=>C4,MT5ForConditionalGeneration:()=>G4,MT5Model:()=>IJ,MT5PreTrainedModel:()=>S4,MarianMTModel:()=>o7,MarianModel:()=>t7,MarianPreTrainedModel:()=>UZ,MaskFormerForInstanceSegmentation:()=>S7,MaskFormerModel:()=>C7,MaskFormerPreTrainedModel:()=>KZ,MaskedLMOutput:()=>c6,Metric3DForDepthEstimation:()=>w7,Metric3DPreTrainedModel:()=>I7,Metric3Dv2ForDepthEstimation:()=>P7,Metric3Dv2PreTrainedModel:()=>j7,MgpstrForSceneTextRecognition:()=>RK,MgpstrModelOutput:()=>AK,MgpstrPreTrainedModel:()=>BK,MimiDecoderModel:()=>_K,MimiDecoderOutput:()=>SK,MimiEncoderModel:()=>TK,MimiEncoderOutput:()=>CK,MimiModel:()=>MK,MimiPreTrainedModel:()=>x5,MistralForCausalLM:()=>f9,MistralModel:()=>h9,MistralPreTrainedModel:()=>EZ,MobileBertForMaskedLM:()=>P6,MobileBertForQuestionAnswering:()=>p4,MobileBertForSequenceClassification:()=>VJ,MobileBertModel:()=>m0,MobileBertPreTrainedModel:()=>S0,MobileLLMForCausalLM:()=>TQ,MobileLLMModel:()=>MQ,MobileLLMPreTrainedModel:()=>R$,MobileNetV1ForImageClassification:()=>ZK,MobileNetV1ForSemanticSegmentation:()=>QK,MobileNetV1Model:()=>$K,MobileNetV1PreTrainedModel:()=>M5,MobileNetV2ForImageClassification:()=>KK,MobileNetV2ForSemanticSegmentation:()=>YK,MobileNetV2Model:()=>WK,MobileNetV2PreTrainedModel:()=>T5,MobileNetV3ForImageClassification:()=>XK,MobileNetV3ForSemanticSegmentation:()=>qK,MobileNetV3Model:()=>GK,MobileNetV3PreTrainedModel:()=>_5,MobileNetV4ForImageClassification:()=>VK,MobileNetV4ForSemanticSegmentation:()=>UK,MobileNetV4Model:()=>HK,MobileNetV4PreTrainedModel:()=>k5,MobileViTForImageClassification:()=>kW,MobileViTModel:()=>_W,MobileViTPreTrainedModel:()=>l$,MobileViTV2ForImageClassification:()=>yW,MobileViTV2Model:()=>xW,MobileViTV2PreTrainedModel:()=>c$,ModelOutput:()=>W0,ModernBertDecoderForCausalLM:()=>a6,ModernBertDecoderModel:()=>W6,ModernBertDecoderPreTrainedModel:()=>B6,ModernBertForMaskedLM:()=>i0,ModernBertForSequenceClassification:()=>a0,ModernBertForTokenClassification:()=>n0,ModernBertModel:()=>y0,ModernBertPreTrainedModel:()=>l0,Moondream1ForConditionalGeneration:()=>M8,MoonshineForConditionalGeneration:()=>C8,MoonshineModel:()=>OY,MoonshinePreTrainedModel:()=>s5,MptForCausalLM:()=>qW,MptModel:()=>XW,MptPreTrainedModel:()=>O$,MultiModalityCausalLM:()=>LK,MultiModalityPreTrainedModel:()=>EK,MusicgenForCausalLM:()=>lY,MusicgenForConditionalGeneration:()=>wZ,MusicgenModel:()=>gY,MusicgenPreTrainedModel:()=>IZ,NanoChatForCausalLM:()=>EQ,NanoChatModel:()=>zQ,NanoChatPreTrainedModel:()=>U$,NeoBertForMaskedLM:()=>V0,NeoBertForQuestionAnswering:()=>s0,NeoBertForSequenceClassification:()=>u0,NeoBertForTokenClassification:()=>b0,NeoBertModel:()=>x0,NeoBertPreTrainedModel:()=>C0,NomicBertModel:()=>V4,NomicBertPreTrainedModel:()=>H4,OPTForCausalLM:()=>VW,OPTModel:()=>HW,OPTPreTrainedModel:()=>b$,Olmo2ForCausalLM:()=>yQ,Olmo2Model:()=>xQ,Olmo2PreTrainedModel:()=>D$,OlmoForCausalLM:()=>kQ,OlmoModel:()=>_Q,OlmoPreTrainedModel:()=>F$,OpenELMForCausalLM:()=>nQ,OpenELMModel:()=>eQ,OpenELMPreTrainedModel:()=>T$,OwlViTForObjectDetection:()=>OW,OwlViTModel:()=>vW,OwlViTPreTrainedModel:()=>m$,Owlv2ForObjectDetection:()=>hW,Owlv2Model:()=>bW,Owlv2PreTrainedModel:()=>a$,PaliGemmaForConditionalGeneration:()=>x8,PaliGemmaPreTrainedModel:()=>k8,ParakeetForCTC:()=>G9,ParakeetPreTrainedModel:()=>Y9,PatchTSMixerForPrediction:()=>wK,PatchTSMixerModel:()=>IK,PatchTSMixerPreTrainedModel:()=>PZ,PatchTSTForPrediction:()=>DK,PatchTSTModel:()=>FK,PatchTSTPreTrainedModel:()=>jZ,Phi3ForCausalLM:()=>KW,Phi3Model:()=>WW,Phi3PreTrainedModel:()=>y$,Phi3VForCausalLM:()=>$$,Phi3VPreTrainedModel:()=>b8,PhiForCausalLM:()=>QW,PhiModel:()=>ZW,PhiPreTrainedModel:()=>x$,PreTrainedModel:()=>S,PretrainedMixin:()=>R6,PvtForImageClassification:()=>RW,PvtModel:()=>BW,PvtPreTrainedModel:()=>d$,PyAnnoteForAudioFrameClassification:()=>q9,PyAnnoteModel:()=>X9,PyAnnotePreTrainedModel:()=>zZ,QuestionAnsweringModelOutput:()=>J4,Qwen2ForCausalLM:()=>iQ,Qwen2Model:()=>sQ,Qwen2PreTrainedModel:()=>_$,Qwen2VLForConditionalGeneration:()=>$W,Qwen2VLPreTrainedModel:()=>JW,Qwen3ForCausalLM:()=>oQ,Qwen3Model:()=>tQ,Qwen3PreTrainedModel:()=>k$,RFDetrForObjectDetection:()=>nW,RFDetrModel:()=>eW,RFDetrObjectDetectionOutput:()=>sW,RFDetrPreTrainedModel:()=>i$,RTDetrForObjectDetection:()=>mW,RTDetrModel:()=>cW,RTDetrObjectDetectionOutput:()=>J5,RTDetrPreTrainedModel:()=>n$,RTDetrV2ForObjectDetection:()=>pW,RTDetrV2Model:()=>aW,RTDetrV2ObjectDetectionOutput:()=>rW,RTDetrV2PreTrainedModel:()=>s$,ResNetForImageClassification:()=>G7,ResNetModel:()=>Y7,ResNetPreTrainedModel:()=>ZZ,RoFormerForMaskedLM:()=>o6,RoFormerForQuestionAnswering:()=>_J,RoFormerForSequenceClassification:()=>DJ,RoFormerForTokenClassification:()=>TJ,RoFormerModel:()=>k6,RoFormerPreTrainedModel:()=>_4,RobertaForMaskedLM:()=>X8,RobertaForQuestionAnswering:()=>V8,RobertaForSequenceClassification:()=>q8,RobertaForTokenClassification:()=>H8,RobertaModel:()=>G8,RobertaPreTrainedModel:()=>OJ,SamImageSegmentationOutput:()=>i7,SamModel:()=>s7,SamPreTrainedModel:()=>n7,SapiensForDepthEstimation:()=>B7,SapiensForNormalEstimation:()=>R7,SapiensForSemanticSegmentation:()=>A7,SapiensPreTrainedModel:()=>I5,SegformerForImageClassification:()=>n9,SegformerForSemanticSegmentation:()=>s9,SegformerModel:()=>uY,SegformerPreTrainedModel:()=>S5,Seq2SeqLMOutput:()=>pG,SequenceClassifierOutput:()=>q6,SiglipModel:()=>u8,SiglipPreTrainedModel:()=>Z$,SiglipTextModel:()=>g8,SiglipVisionModel:()=>l8,SmolLM3ForCausalLM:()=>DQ,SmolLM3Model:()=>FQ,SmolLM3PreTrainedModel:()=>E$,SmolVLMForConditionalGeneration:()=>J$,SnacDecoderModel:()=>fK,SnacEncoderModel:()=>hK,SnacModel:()=>bK,SnacPreTrainedModel:()=>v5,SpeechT5ForSpeechToText:()=>x9,SpeechT5ForTextToSpeech:()=>y9,SpeechT5HifiGan:()=>v9,SpeechT5Model:()=>dY,SpeechT5PreTrainedModel:()=>P5,SqueezeBertForMaskedLM:()=>s,SqueezeBertForQuestionAnswering:()=>U0,SqueezeBertForSequenceClassification:()=>$0,SqueezeBertModel:()=>l,SqueezeBertPreTrainedModel:()=>_,StableLmForCausalLM:()=>t9,StableLmModel:()=>i9,StableLmPreTrainedModel:()=>FZ,Starcoder2ForCausalLM:()=>l9,Starcoder2Model:()=>g9,Starcoder2PreTrainedModel:()=>AZ,StyleTextToSpeech2Model:()=>k9,StyleTextToSpeech2PreTrainedModel:()=>_9,Swin2SRForImageSuperResolution:()=>U7,Swin2SRModel:()=>V7,Swin2SRPreTrainedModel:()=>QZ,SwinForImageClassification:()=>q7,SwinForSemanticSegmentation:()=>H7,SwinModel:()=>X7,SwinPreTrainedModel:()=>D5,T5ForConditionalGeneration:()=>r6,T5Model:()=>y6,T5PreTrainedModel:()=>X6,TableTransformerForObjectDetection:()=>J7,TableTransformerModel:()=>oW,TableTransformerObjectDetectionOutput:()=>$7,TableTransformerPreTrainedModel:()=>o$,TokenClassifierOutput:()=>g6,TrOCRForCausalLM:()=>b9,TrOCRPreTrainedModel:()=>O9,UltravoxModel:()=>CZ,UltravoxPreTrainedModel:()=>jK,UniSpeechForCTC:()=>N9,UniSpeechForSequenceClassification:()=>z9,UniSpeechModel:()=>U9,UniSpeechPreTrainedModel:()=>w5,UniSpeechSatForAudioFrameClassification:()=>B9,UniSpeechSatForCTC:()=>L9,UniSpeechSatForSequenceClassification:()=>A9,UniSpeechSatModel:()=>E9,UniSpeechSatPreTrainedModel:()=>$5,VaultGemmaForCausalLM:()=>aQ,VaultGemmaModel:()=>mQ,VaultGemmaPreTrainedModel:()=>S$,ViTForImageClassification:()=>NW,ViTMAEModel:()=>DW,ViTMAEPreTrainedModel:()=>FW,ViTMSNForImageClassification:()=>wW,ViTMSNModel:()=>IW,ViTMSNPreTrainedModel:()=>u$,ViTModel:()=>UW,ViTPreTrainedModel:()=>h$,VisionEncoderDecoderModel:()=>i5,VitMatteForImageMatting:()=>TW,VitMattePreTrainedModel:()=>MW,VitPoseForPoseEstimation:()=>AW,VitPosePreTrainedModel:()=>LW,VitsModel:()=>RZ,VitsModelOutput:()=>aK,VitsPreTrainedModel:()=>e9,VoxtralForConditionalGeneration:()=>PK,Wav2Vec2BertForCTC:()=>F9,Wav2Vec2BertForSequenceClassification:()=>D9,Wav2Vec2BertModel:()=>R9,Wav2Vec2BertPreTrainedModel:()=>j5,Wav2Vec2ForAudioFrameClassification:()=>K9,Wav2Vec2ForCTC:()=>Q9,Wav2Vec2ForSequenceClassification:()=>W9,Wav2Vec2Model:()=>Z9,Wav2Vec2PreTrainedModel:()=>UJ,WavLMForAudioFrameClassification:()=>T9,WavLMForCTC:()=>C9,WavLMForSequenceClassification:()=>S9,WavLMForXVector:()=>M9,WavLMModel:()=>P9,WavLMPreTrainedModel:()=>fJ,WeSpeakerResNetModel:()=>V9,WeSpeakerResNetPreTrainedModel:()=>H9,WhisperForConditionalGeneration:()=>n5,WhisperModel:()=>j8,WhisperPreTrainedModel:()=>e5,XLMForQuestionAnswering:()=>L8,XLMForSequenceClassification:()=>z8,XLMForTokenClassification:()=>E8,XLMModel:()=>U8,XLMPreTrainedModel:()=>bJ,XLMRobertaForMaskedLM:()=>B8,XLMRobertaForQuestionAnswering:()=>D8,XLMRobertaForSequenceClassification:()=>R8,XLMRobertaForTokenClassification:()=>F8,XLMRobertaModel:()=>A8,XLMRobertaPreTrainedModel:()=>hJ,XLMWithLMHeadModel:()=>N8,XVectorOutput:()=>cK,YolosForObjectDetection:()=>r7,YolosModel:()=>p7,YolosObjectDetectionOutput:()=>e7,YolosPreTrainedModel:()=>VZ});var Q=$("./src/configs.js");/*! ./configs.js */var W=$("./src/backends/onnx.js");/*! ./backends/onnx.js */var Y=$("./src/utils/dtypes.js");/*! ./utils/dtypes.js */var H=$("./src/utils/generic.js");/*! ./utils/generic.js */var G=$("./src/utils/core.js");/*! ./utils/core.js */var q=$("./src/utils/hub.js");/*! ./utils/hub.js */var z=$("./src/utils/constants.js");/*! ./utils/constants.js */var U=$("./src/generation/logits_process.js");/*! ./generation/logits_process.js */var N=$("./src/generation/configuration_utils.js");/*! ./generation/configuration_utils.js */var L=$("./src/utils/tensor.js");/*! ./utils/tensor.js */var w=$("./src/utils/image.js");/*! ./utils/image.js */var F=$("./src/utils/maths.js");/*! ./utils/maths.js */var v=$("./src/generation/stopping_criteria.js");/*! ./generation/stopping_criteria.js */var I=$("./src/generation/logits_sampler.js");/*! ./generation/logits_sampler.js */var j=$("./src/env.js");/*! ./env.js */var y=$("./src/models/whisper/generation_whisper.js");/*! ./models/whisper/generation_whisper.js */var g=$("./src/models/whisper/common_whisper.js");/*! ./models/whisper/common_whisper.js */let A={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12},T=new Map,B=new Map,R=new Map;async function P(X,M,e){let J0=e.config?.["transformers.js_config"]??{},q0=e.device??J0.device;if(q0&&typeof q0!=="string")if(q0.hasOwnProperty(M))q0=q0[M];else console.warn(`device not specified for "${M}". Using the default device.`),q0=null;let H0=q0??(j.apis.IS_NODE_ENV?"cpu":"wasm"),I0=(0,W.deviceToExecutionProviders)(H0),M0=J0.device_config??{};if(M0.hasOwnProperty(H0))J0={...J0,...M0[H0]};let g0=e.dtype??J0.dtype;if(typeof g0!=="string")if(g0&&g0.hasOwnProperty(M))g0=g0[M];else g0=Y.DEFAULT_DEVICE_DTYPE_MAPPING[H0]??Y.DATA_TYPES.fp32,console.warn(`dtype not specified for "${M}". Using the default dtype (${g0}) for this device (${H0}).`);if(g0===Y.DATA_TYPES.auto){let A6=J0.dtype;if(typeof A6!=="string")A6=A6?.[M];if(A6&&A6!==Y.DATA_TYPES.auto&&Y.DATA_TYPES.hasOwnProperty(A6))g0=A6;else g0=Y.DEFAULT_DEVICE_DTYPE_MAPPING[H0]??Y.DATA_TYPES.fp32}let K6=g0;if(!Y.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(K6))throw Error(`Invalid dtype: ${K6}. Should be one of: ${Object.keys(Y.DATA_TYPES).join(", ")}`);else if(K6===Y.DATA_TYPES.fp16&&H0==="webgpu"&&!await(0,Y.isWebGpuFp16Supported)())throw Error(`The device (${H0}) does not support fp16.`);let Q6=J0.kv_cache_dtype,N6=Q6?typeof Q6==="string"?Q6:Q6[K6]??"float32":void 0;if(N6&&!["float32","float16"].includes(N6))throw Error(`Invalid kv_cache_dtype: ${N6}. Should be one of: float32, float16`);let o0={dtype:K6,kv_cache_dtype:N6,device:H0},D6=Y.DEFAULT_DTYPE_SUFFIX_MAPPING[K6],G6=`${M}${D6}.onnx`,Y6=`${e.subfolder??""}/${G6}`,V6={...e.session_options};V6.executionProviders??=I0;let I6=J0.free_dimension_overrides;if(I6)V6.freeDimensionOverrides??=I6;else if(H0.startsWith("webnn")&&!V6.freeDimensionOverrides)console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${H0}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);let T6=j.apis.IS_NODE_ENV&&j.env.useFSCache,E4=(0,q.getModelFile)(X,Y6,!0,e,T6),O6=e.use_external_data_format??J0.use_external_data_format,C6=[];if(O6){let A6;if(typeof O6==="object")if(O6.hasOwnProperty(G6))A6=O6[G6];else if(O6.hasOwnProperty(M))A6=O6[M];else A6=!1;else A6=O6;let l6=+A6;if(l6>q.MAX_EXTERNAL_DATA_CHUNKS)throw Error(`The number of external data chunks (${l6}) exceeds the maximum allowed value (${q.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let e4=0;e4<l6;++e4){let K4=`${G6}_data${e4===0?"":"_"+e4}`,f4=`${e.subfolder??""}/${K4}`;C6.push(new Promise(async(dJ,SZ)=>{let uJ=await(0,q.getModelFile)(X,f4,!0,e,T6);dJ(uJ instanceof Uint8Array?{path:K4,data:uJ}:K4)}))}}else if(V6.externalData!==void 0)C6=V6.externalData.map(async(A6)=>{if(typeof A6.data==="string"){let l6=await(0,q.getModelFile)(X,A6.data,!0,e);return{...A6,data:l6}}return A6});if(C6.length>0){let A6=await Promise.all(C6);if(!j.apis.IS_NODE_ENV)V6.externalData=A6}if(H0==="webgpu"){let A6=(0,Q.getCacheShapes)(e.config,{prefix:"present"});if(Object.keys(A6).length>0&&!(0,W.isONNXProxy)()){let l6={};for(let e4 in A6)l6[e4]="gpu-buffer";V6.preferredOutputLocation=l6}}return{buffer_or_path:await E4,session_options:V6,session_config:o0}}async function k(X,M,e){return Object.fromEntries(await Promise.all(Object.keys(M).map(async(J0)=>{let{buffer_or_path:q0,session_options:H0,session_config:I0}=await P(X,M[J0],e),M0=await(0,W.createInferenceSession)(q0,H0,I0);return[J0,M0]})))}async function h(X,M,e){return Object.fromEntries(await Promise.all(Object.keys(M).map(async(J0)=>{let q0=await(0,q.getModelJSON)(X,M[J0],!1,e);return[J0,q0]})))}function c(X,M){let e=Object.create(null),J0=[];for(let I0 of X.inputNames){let M0=M[I0];if(!(M0 instanceof L.Tensor)){J0.push(I0);continue}e[I0]=(0,W.isONNXProxy)()?M0.clone():M0}if(J0.length>0)throw Error(`An error occurred during model execution: "Missing the following inputs: ${J0.join(", ")}.`);let q0=Object.keys(M).length,H0=X.inputNames.length;if(q0>H0){let I0=Object.keys(M).filter((M0)=>!X.inputNames.includes(M0));console.warn(`WARNING: Too many inputs were provided (${q0} > ${H0}). The following inputs will be ignored: "${I0.join(", ")}".`)}return e}async function m(X,M){let e=c(X,M);try{let J0=Object.fromEntries(Object.entries(e).map(([H0,I0])=>[H0,I0.ort_tensor])),q0=await(0,W.runInferenceSession)(X,J0);return d(q0)}catch(J0){let q0=Object.fromEntries(Object.entries(e).map(([H0,I0])=>{let M0={type:I0.type,dims:I0.dims,location:I0.location};if(M0.location!=="gpu-buffer")M0.data=I0.data;return[H0,M0]}));throw console.error(`An error occurred during model execution: "${J0}".`),console.error("Inputs given to model:",q0),J0}}function d(X){for(let M in X)if((0,W.isONNXTensor)(X[M]))X[M]=new L.Tensor(X[M]);else if(typeof X[M]==="object")d(X[M]);return X}function a(X){if(X instanceof L.Tensor)return X;if(X.length===0)throw Error("items must be non-empty");if(Array.isArray(X[0])){if(X.some((M)=>M.length!==X[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new L.Tensor("int64",BigInt64Array.from(X.flat().map((M)=>BigInt(M))),[X.length,X[0].length])}else return new L.Tensor("int64",BigInt64Array.from(X.map((M)=>BigInt(M))),[1,X.length])}function n(X){return new L.Tensor("bool",[X],[1])}async function t(X,M){let{encoder_outputs:e,input_ids:J0,decoder_input_ids:q0,...H0}=M;if(!e){let M0=(0,G.pick)(M,X.sessions.model.inputNames);e=(await Q0(X,M0)).last_hidden_state}if(H0.input_ids=q0,H0.encoder_hidden_states=e,X.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask"))H0.encoder_attention_mask=M.attention_mask;return await N0(X,H0,!0)}async function Q0(X,M){let e=X.sessions.model,J0=(0,G.pick)(M,e.inputNames);if(e.inputNames.includes("inputs_embeds")&&!J0.inputs_embeds){if(!M.input_ids)throw Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");J0.inputs_embeds=await X.encode_text({input_ids:M.input_ids})}if(e.inputNames.includes("token_type_ids")&&!J0.token_type_ids){if(!J0.input_ids)throw Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");J0.token_type_ids=(0,L.zeros_like)(J0.input_ids)}if(e.inputNames.includes("pixel_mask")&&!J0.pixel_mask){if(!J0.pixel_values)throw Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");let q0=J0.pixel_values.dims;J0.pixel_mask=(0,L.ones)([q0[0],q0[2],q0[3]])}return await m(e,J0)}async function o(X,M){let e=await X.encode(M);return await X.decode(e)}async function N0(X,M,e=!1){let J0=X.sessions[e?"decoder_model_merged":"model"],{past_key_values:q0,...H0}=M;if(J0.inputNames.includes("use_cache_branch"))H0.use_cache_branch=n(!!q0);if(J0.inputNames.includes("position_ids")&&H0.attention_mask&&!H0.position_ids){let M0=["paligemma","gemma3_text","gemma3"].includes(X.config.model_type)?1:0;H0.position_ids=j0(H0,q0,M0)}X.addPastKeyValues(H0,q0);let I0=(0,G.pick)(H0,J0.inputNames);return await m(J0,I0)}function w0({modality_token_id:X,inputs_embeds:M,modality_features:e,input_ids:J0,attention_mask:q0}){let H0=J0.tolist().map((K6)=>K6.reduce((Q6,N6,o0)=>{if(N6==X)Q6.push(o0);return Q6},[])),I0=H0.reduce((K6,Q6)=>K6+Q6.length,0),M0=e.dims[0];if(I0!==M0)throw Error(`Number of tokens and features do not match: tokens: ${I0}, features ${M0}`);let g0=0;for(let K6=0;K6<H0.length;++K6){let Q6=H0[K6],N6=M[K6];for(let o0=0;o0<Q6.length;++o0)N6[Q6[o0]].data.set(e[g0++].data)}return{inputs_embeds:M,attention_mask:q0}}function D({image_token_id:X,inputs_embeds:M,image_features:e,input_ids:J0,attention_mask:q0}){return w0({modality_token_id:X,inputs_embeds:M,modality_features:e,input_ids:J0,attention_mask:q0})}function O({audio_token_id:X,inputs_embeds:M,audio_features:e,input_ids:J0,attention_mask:q0}){return w0({modality_token_id:X,inputs_embeds:M,modality_features:e,input_ids:J0,attention_mask:q0})}async function p(X,{encode_function:M,merge_function:e,modality_input_name:J0,modality_output_name:q0,input_ids:H0=null,attention_mask:I0=null,position_ids:M0=null,inputs_embeds:g0=null,past_key_values:K6=null,generation_config:Q6=null,logits_processor:N6=null,...o0}){let D6=o0[J0];if(!g0){if(g0=await X.encode_text({input_ids:H0,...o0}),D6&&H0.dims[1]!==1){let Y6=await M({[J0]:D6,...o0});({inputs_embeds:g0,attention_mask:I0}=e({[q0]:Y6,inputs_embeds:g0,input_ids:H0,attention_mask:I0}))}else if(K6&&D6&&H0.dims[1]===1){let Y6=H0.dims[1],V6=Object.values(K6)[0].dims.at(-2);I0=(0,L.cat)([(0,L.ones)([H0.dims[0],V6]),I0.slice(null,[I0.dims[1]-Y6,I0.dims[1]])],1)}}if(!M0){if(X.config.model_type==="qwen2_vl"){let{image_grid_thw:Y6,video_grid_thw:V6}=o0;[M0]=X.get_rope_index(H0,Y6,V6,I0)}}return await N0(X,{inputs_embeds:g0,past_key_values:K6,attention_mask:I0,position_ids:M0,generation_config:Q6,logits_processor:N6},!0)}async function Z0(X,M){return await p(X,{...M,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:X.encode_audio.bind(X),merge_function:X._merge_input_ids_with_audio_features.bind(X)})}async function z0(X,M){return await p(X,{...M,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:X.encode_image.bind(X),merge_function:X._merge_input_ids_with_image_features.bind(X)})}function A0(X,M=0){let[e,J0]=X.dims,q0=X.data,H0=new BigInt64Array(q0.length);for(let I0=0;I0<e;++I0){let M0=I0*J0,g0=BigInt(M);for(let K6=0;K6<J0;++K6){let Q6=M0+K6;if(q0[Q6]===0n)H0[Q6]=BigInt(1);else H0[Q6]=g0,g0+=q0[Q6]}}return{data:H0,dims:X.dims}}function j0(X,M=null,e=0){let{input_ids:J0,inputs_embeds:q0,attention_mask:H0}=X,{data:I0,dims:M0}=A0(H0,e),g0=new L.Tensor("int64",I0,M0);if(M){let K6=-(J0??q0).dims.at(1);g0=g0.slice(null,[K6,null])}return g0}function h0(X,M,e,J0){let q0=e.past_key_values?Object.values(e.past_key_values)[0].dims.at(-2):0;if(!e.attention_mask){let H0;for(let I0 of["input_ids","inputs_embeds","position_ids"])if(e[I0]){H0=e[I0].dims;break}if(!H0)throw Error("attention_mask is not provided, and unable to infer its shape from model inputs.");e.attention_mask=(0,L.ones)([H0[0],q0+H0[1]])}if(e.past_key_values){let{input_ids:H0,attention_mask:I0}=e;if(I0&&I0.dims[1]>H0.dims[1]);else if(q0<H0.dims[1])e.input_ids=H0.slice(null,[q0,null])}return e}function d0(X,M,e,J0){if(e.past_key_values)M=M.map((q0)=>[q0.at(-1)]);return{...e,decoder_input_ids:a(M)}}function T0(X,...M){if(X.config.is_encoder_decoder)return d0(X,...M);else return h0(X,...M)}function b(X,M,e,J0){let q0=!!e.past_key_values;if(J0.guidance_scale!==null&&J0.guidance_scale>1)if(q0)e.input_ids=(0,L.cat)([e.input_ids,e.input_ids],0);else e.input_ids=(0,L.cat)([e.input_ids,(0,L.full_like)(e.input_ids,BigInt(J0.pad_token_id))],0),e.attention_mask=(0,L.cat)([e.attention_mask,(0,L.full_like)(e.attention_mask,0n)],0);if(q0||!e.pixel_values)e.pixel_values=(0,L.full)([0,0,3,384,384],1);if(q0)e.images_seq_mask=new L.Tensor("bool",[,].fill(!0).fill(!1,0,1),[1,1]),e.images_emb_mask=new L.Tensor("bool",[].fill(!1),[1,1,0]);return e}class S extends H.Callable{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(X,M,e){super();this.config=X,this.sessions=M,this.configs=e;let J0=R.get(this.constructor),q0=T.get(J0);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,q0){case A.DecoderOnly:this.can_generate=!0,this._forward=N0,this._prepare_inputs_for_generation=h0;break;case A.Seq2Seq:case A.Vision2Seq:case A.Musicgen:this.can_generate=!0,this._forward=t,this._prepare_inputs_for_generation=d0;break;case A.EncoderDecoder:this._forward=t;break;case A.ImageTextToText:this.can_generate=!0,this._forward=z0,this._prepare_inputs_for_generation=T0;break;case A.AudioTextToText:this.can_generate=!0,this._forward=Z0,this._prepare_inputs_for_generation=T0;break;case A.Phi3V:case A.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=T0;break;case A.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=b;break;case A.AutoEncoder:this._forward=o;break;default:this._forward=Q0;break}if(this.can_generate)this.forward_params.push("past_key_values");this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){let X=[];for(let M of Object.values(this.sessions))if(M?.handler?.dispose)X.push(M.handler.dispose());return await Promise.all(X)}static async from_pretrained(X,{progress_callback:M=null,config:e=null,cache_dir:J0=null,local_files_only:q0=!1,revision:H0="main",model_file_name:I0=null,subfolder:M0="onnx",device:g0=null,dtype:K6=null,use_external_data_format:Q6=null,session_options:N6={}}={}){let o0={progress_callback:M,config:e,cache_dir:J0,local_files_only:q0,revision:H0,model_file_name:I0,subfolder:M0,device:g0,dtype:K6,use_external_data_format:Q6,session_options:N6},D6=R.get(this),G6=T.get(D6);e=o0.config=await Q.AutoConfig.from_pretrained(X,o0);let Y6;if(G6===A.DecoderOnly)Y6=await Promise.all([k(X,{model:o0.model_file_name??"model"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.Seq2Seq||G6===A.Vision2Seq)Y6=await Promise.all([k(X,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.MaskGeneration)Y6=await Promise.all([k(X,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},o0)]);else if(G6===A.EncoderDecoder)Y6=await Promise.all([k(X,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},o0)]);else if(G6===A.ImageTextToText){let V6={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};if(e.is_encoder_decoder)V6.model="encoder_model";Y6=await Promise.all([k(X,V6,o0),h(X,{generation_config:"generation_config.json"},o0)])}else if(G6===A.AudioTextToText)Y6=await Promise.all([k(X,{embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.ImageAudioTextToText)Y6=await Promise.all([k(X,{embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.Musicgen)Y6=await Promise.all([k(X,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.MultiModality)Y6=await Promise.all([k(X,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.Phi3V)Y6=await Promise.all([k(X,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},o0),h(X,{generation_config:"generation_config.json"},o0)]);else if(G6===A.AutoEncoder)Y6=await Promise.all([k(X,{encoder_model:"encoder_model",decoder_model:"decoder_model"},o0)]);else{if(G6!==A.EncoderOnly){let V6=D6??e?.model_type;if(V6!=="custom")console.warn(`Model type for '${V6}' not found, assuming encoder-only architecture. Please report this at ${z.GITHUB_ISSUE_URL}.`)}Y6=await Promise.all([k(X,{model:o0.model_file_name??"model"},o0)])}return new this(e,...Y6)}async _call(X){return await this.forward(X)}async forward(X){return await this._forward(this,X)}get generation_config(){return this.configs?.generation_config??null}_get_logits_processor(X,M,e=null){let J0=new U.LogitsProcessorList;if(X.repetition_penalty!==null&&X.repetition_penalty!==1)J0.push(new U.RepetitionPenaltyLogitsProcessor(X.repetition_penalty));if(X.no_repeat_ngram_size!==null&&X.no_repeat_ngram_size>0)J0.push(new U.NoRepeatNGramLogitsProcessor(X.no_repeat_ngram_size));if(X.bad_words_ids!==null)J0.push(new U.NoBadWordsLogitsProcessor(X.bad_words_ids,X.eos_token_id));if(X.min_length!==null&&X.eos_token_id!==null&&X.min_length>0)J0.push(new U.MinLengthLogitsProcessor(X.min_length,X.eos_token_id));if(X.min_new_tokens!==null&&X.eos_token_id!==null&&X.min_new_tokens>0)J0.push(new U.MinNewTokensLengthLogitsProcessor(M,X.min_new_tokens,X.eos_token_id));if(X.forced_bos_token_id!==null)J0.push(new U.ForcedBOSTokenLogitsProcessor(X.forced_bos_token_id));if(X.forced_eos_token_id!==null)J0.push(new U.ForcedEOSTokenLogitsProcessor(X.max_length,X.forced_eos_token_id));if(X.begin_suppress_tokens!==null){let q0=M>1||X.forced_bos_token_id===null?M:M+1;J0.push(new U.SuppressTokensAtBeginLogitsProcessor(X.begin_suppress_tokens,q0))}if(X.guidance_scale!==null&&X.guidance_scale>1)J0.push(new U.ClassifierFreeGuidanceLogitsProcessor(X.guidance_scale));if(X.temperature===0&&X.do_sample)console.warn("`do_sample` changed to false because `temperature: 0` implies greedy sampling (always selecting the most likely token), which is incompatible with `do_sample: true`."),X.do_sample=!1;if(X.do_sample){if(X.temperature!==null&&X.temperature!==1)J0.push(new U.TemperatureLogitsWarper(X.temperature))}if(e!==null)J0.extend(e);return J0}_prepare_generation_config(X,M,e=N.GenerationConfig){let J0={...this.config};for(let H0 of["decoder","generator","text_config"])if(H0 in J0)Object.assign(J0,J0[H0]);let q0=new e(J0);if(Object.assign(q0,this.generation_config??{}),X)Object.assign(q0,X);if(M)Object.assign(q0,(0,G.pick)(M,Object.getOwnPropertyNames(q0)));return q0}_get_stopping_criteria(X,M=null){let e=new v.StoppingCriteriaList;if(X.max_length!==null)e.push(new v.MaxLengthCriteria(X.max_length,this.config.max_position_embeddings??null));if(X.eos_token_id!==null)e.push(new v.EosTokenCriteria(X.eos_token_id));if(M)e.extend(M);return e}_validate_model_class(){if(!this.can_generate){let X=[gK,lK,uK,dK],M=R.get(this.constructor),e=new Set,J0=this.config.model_type;for(let H0 of X){let I0=H0.get(J0);if(I0)e.add(I0[0])}let q0=`The current model class (${M}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;if(e.size>0)q0+=` Please use the following class instead: ${[...e].join(", ")}`;throw Error(q0)}}prepare_inputs_for_generation(...X){return this._prepare_inputs_for_generation(this,...X)}_update_model_kwargs_for_generation({generated_input_ids:X,outputs:M,model_inputs:e,is_encoder_decoder:J0}){if(e.past_key_values=this.getPastKeyValues(M,e.past_key_values),e.input_ids=new L.Tensor("int64",X.flat(),[X.length,1]),!J0)e.attention_mask=(0,L.cat)([e.attention_mask,(0,L.ones)([e.attention_mask.dims[0],1])],1);else if("decoder_attention_mask"in e);return e.position_ids=null,e}_prepare_model_inputs({inputs:X,bos_token_id:M,model_kwargs:e}){let J0=(0,G.pick)(e,this.forward_params),q0=this.main_input_name;if(q0 in J0){if(X)throw Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else J0[q0]=X;return{inputs_tensor:J0[q0],model_inputs:J0,model_input_name:q0}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:X,model_inputs:M,model_input_name:e,generation_config:J0}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!M.inputs_embeds&&"_prepare_inputs_embeds"in this){let{input_ids:H0,pixel_values:I0,attention_mask:M0,...g0}=M,K6=await this._prepare_inputs_embeds(M);M={...g0,...(0,G.pick)(K6,["inputs_embeds","attention_mask"])}}let{last_hidden_state:q0}=await Q0(this,M);if(J0.guidance_scale!==null&&J0.guidance_scale>1){if(q0=(0,L.cat)([q0,(0,L.full_like)(q0,0)],0),"attention_mask"in M)M.attention_mask=(0,L.cat)([M.attention_mask,(0,L.zeros_like)(M.attention_mask)],0)}else if(M.decoder_input_ids){let H0=a(M.decoder_input_ids).dims[0];if(H0!==q0.dims[0]){if(q0.dims[0]!==1)throw Error(`The encoder outputs have a different batch size (${q0.dims[0]}) than the decoder inputs (${H0}).`);q0=(0,L.cat)(Array.from({length:H0},()=>q0),0)}}return M.encoder_outputs=q0,M}_prepare_decoder_input_ids_for_generation({batch_size:X,model_input_name:M,model_kwargs:e,decoder_start_token_id:J0,bos_token_id:q0,generation_config:H0}){let{decoder_input_ids:I0,...M0}=e;if(!(I0 instanceof L.Tensor)){if(!I0)if(J0??=q0,this.config.model_type==="musicgen")I0=Array.from({length:X*this.config.decoder.num_codebooks},()=>[J0]);else if(Array.isArray(J0)){if(J0.length!==X)throw Error(`\`decoder_start_token_id\` expcted to have length ${X} but got ${J0.length}`);I0=J0}else I0=Array.from({length:X},()=>[J0]);else if(!Array.isArray(I0[0]))I0=Array.from({length:X},()=>I0);I0=a(I0)}return e.decoder_attention_mask=(0,L.ones_like)(I0),{input_ids:I0,model_inputs:M0}}async generate({inputs:X=null,generation_config:M=null,logits_processor:e=null,stopping_criteria:J0=null,streamer:q0=null,...H0}){this._validate_model_class(),M=this._prepare_generation_config(M,H0);let{inputs_tensor:I0,model_inputs:M0,model_input_name:g0}=this._prepare_model_inputs({inputs:X,model_kwargs:H0}),K6=this.config.is_encoder_decoder;if(!K6);else if(!("encoder_outputs"in M0))M0=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:I0,model_inputs:M0,model_input_name:g0,generation_config:M});let Q6;if(K6)({input_ids:Q6,model_inputs:M0}=this._prepare_decoder_input_ids_for_generation({batch_size:M0[g0].dims.at(0),model_input_name:g0,model_kwargs:M0,decoder_start_token_id:M.decoder_start_token_id,bos_token_id:M.bos_token_id,generation_config:M}));else Q6=M0[g0];let N6=Q6.dims.at(-1);if(M.max_new_tokens!==null)M.max_length=N6+M.max_new_tokens;let o0=this._get_logits_processor(M,N6,e),D6=this._get_stopping_criteria(M,J0),G6=M0[g0].dims.at(0),Y6=I.LogitsSampler.getSampler(M),V6=Array(G6).fill(0),I6=Q6.tolist();if(q0)q0.put(I6);let T6,E4={};while(!0){if(M0=this.prepare_inputs_for_generation(I6,M0,M),T6=await this.forward(M0),M.output_attentions&&M.return_dict_in_generate){let K4=this.getAttentions(T6);for(let f4 in K4){if(!(f4 in E4))E4[f4]=[];E4[f4].push(K4[f4])}}let i6=T6.logits.slice(null,-1,null),A6=o0(I6,i6),l6=[];for(let K4=0;K4<A6.dims.at(0);++K4){let f4=A6[K4],dJ=await Y6(f4);for(let[SZ,uJ]of dJ){let O5=BigInt(SZ);V6[K4]+=uJ,I6[K4].push(O5),l6.push([O5]);break}}if(q0)q0.put(l6);if(D6(I6).every((K4)=>K4))break;M0=this._update_model_kwargs_for_generation({generated_input_ids:l6,outputs:T6,model_inputs:M0,is_encoder_decoder:K6})}if(q0)q0.end();let O6=this.getPastKeyValues(T6,M0.past_key_values,!0),C6=new L.Tensor("int64",I6.flat(),[I6.length,I6[0].length]);if(M.return_dict_in_generate)return{sequences:C6,past_key_values:O6,...E4};else{for(let i6 of Object.values(T6))if(i6.location==="gpu-buffer")i6.dispose();return C6}}getPastKeyValues(X,M,e=!1){let J0=Object.create(null);for(let q0 in X)if(q0.startsWith("present")){let H0=q0.replace("present_conv","past_conv").replace("present","past_key_values"),I0=q0.includes("encoder");if(I0&&M)J0[H0]=M[H0];else J0[H0]=X[q0];if(M&&(!I0||e)){let M0=M[H0];if(M0.location==="gpu-buffer")M0.dispose()}}return J0}getAttentions(X){let M={};for(let e of["cross_attentions","encoder_attentions","decoder_attentions"])for(let J0 in X)if(J0.startsWith(e)){if(!(e in M))M[e]=[];M[e].push(X[J0])}return M}addPastKeyValues(X,M){if(M)Object.assign(X,M);else{let e=this.sessions.decoder_model_merged??this.sessions.model,J0=(X[this.main_input_name]??X.attention_mask)?.dims?.[0]??1,q0=e?.config?.kv_cache_dtype??"float32",H0=q0==="float16"?L.DataTypeMap.float16:L.DataTypeMap.float32,I0=(0,Q.getCacheShapes)(this.config,{batch_size:J0});for(let M0 in I0){let g0=I0[M0].reduce((K6,Q6)=>K6*Q6,1);X[M0]=new L.Tensor(q0,new H0(g0),I0[M0])}}}async encode_image({pixel_values:X}){return(await m(this.sessions.vision_encoder,{pixel_values:X})).image_features}async encode_text({input_ids:X}){return(await m(this.sessions.embed_tokens,{input_ids:X})).inputs_embeds}async encode_audio({audio_values:X}){return(await m(this.sessions.audio_encoder,{audio_values:X})).audio_features}}class W0{}class B0 extends W0{constructor({last_hidden_state:X,hidden_states:M=null,attentions:e=null}){super();this.last_hidden_state=X,this.hidden_states=M,this.attentions=e}}class D0 extends S{}class R0 extends D0{}class Y0 extends D0{async _call(X){return new c6(await super._call(X))}}class E0 extends D0{async _call(X){return new q6(await super._call(X))}}class X0 extends D0{async _call(X){return new g6(await super._call(X))}}class F0 extends D0{async _call(X){return new J4(await super._call(X))}}class C0 extends S{}class x0 extends C0{}class V0 extends C0{async _call(X){return new c6(await super._call(X))}}class u0 extends C0{async _call(X){return new q6(await super._call(X))}}class b0 extends C0{async _call(X){return new g6(await super._call(X))}}class s0 extends C0{async _call(X){return new J4(await super._call(X))}}class l0 extends S{}class y0 extends l0{}class i0 extends l0{async _call(X){return new c6(await super._call(X))}}class a0 extends l0{async _call(X){return new q6(await super._call(X))}}class n0 extends l0{async _call(X){return new g6(await super._call(X))}}class B6 extends S{}class W6 extends B6{}class a6 extends B6{}class H4 extends S{}class V4 extends H4{}class _4 extends S{}class k6 extends _4{}class o6 extends _4{async _call(X){return new c6(await super._call(X))}}class DJ extends _4{async _call(X){return new q6(await super._call(X))}}class TJ extends _4{async _call(X){return new g6(await super._call(X))}}class _J extends _4{async _call(X){return new J4(await super._call(X))}}class v4 extends S{}class Z6 extends v4{}class WJ extends v4{async _call(X){return new c6(await super._call(X))}}class KJ extends v4{async _call(X){return new q6(await super._call(X))}}class H6 extends v4{async _call(X){return new g6(await super._call(X))}}class YJ extends v4{async _call(X){return new J4(await super._call(X))}}class E extends S{}class u extends E{}class C extends E{async _call(X){return new c6(await super._call(X))}}class f extends E{async _call(X){return new q6(await super._call(X))}}class r extends E{async _call(X){return new g6(await super._call(X))}}class G0 extends E{async _call(X){return new J4(await super._call(X))}}class L0 extends S{}class c0 extends L0{}class t0 extends L0{async _call(X){return new c6(await super._call(X))}}class v0 extends L0{async _call(X){return new q6(await super._call(X))}}class U6 extends L0{async _call(X){return new g6(await super._call(X))}}class E6 extends L0{async _call(X){return new J4(await super._call(X))}}class x6 extends S{}class j6 extends x6{}class U4 extends x6{async _call(X){return new c6(await super._call(X))}}class F4 extends x6{async _call(X){return new q6(await super._call(X))}}class Z4 extends x6{async _call(X){return new g6(await super._call(X))}}class p6 extends x6{async _call(X){return new J4(await super._call(X))}}class D4 extends S{}class g4 extends D4{}class l4 extends D4{async _call(X){return new c6(await super._call(X))}}class O4 extends D4{async _call(X){return new q6(await super._call(X))}}class GJ extends D4{async _call(X){return new g6(await super._call(X))}}class c4 extends D4{async _call(X){return new J4(await super._call(X))}}class j4 extends S{}class k4 extends j4{}class x4 extends j4{async _call(X){return new q6(await super._call(X))}}class XJ extends j4{async _call(X){return new g6(await super._call(X))}}class qJ extends j4{async _call(X){return new J4(await super._call(X))}}class m4 extends j4{async _call(X){return new c6(await super._call(X))}}class P4 extends S{}class a4 extends P4{}class HJ extends P4{async _call(X){return new c6(await super._call(X))}}class Y4 extends P4{async _call(X){return new q6(await super._call(X))}}class P0 extends P4{async _call(X){return new g6(await super._call(X))}}class S0 extends S{}class m0 extends S0{}class P6 extends S0{async _call(X){return new c6(await super._call(X))}}class VJ extends S0{async _call(X){return new q6(await super._call(X))}}class p4 extends S0{async _call(X){return new J4(await super._call(X))}}class C4 extends S{}class kJ extends C4{}class xJ extends C4{async _call(X){return new c6(await super._call(X))}}class yJ extends C4{async _call(X){return new q6(await super._call(X))}}class oJ extends C4{async _call(X){return new g6(await super._call(X))}}class V extends C4{async _call(X){return new J4(await super._call(X))}}class _ extends S{}class l extends _{}class s extends _{async _call(X){return new c6(await super._call(X))}}class $0 extends _{async _call(X){return new q6(await super._call(X))}}class U0 extends _{async _call(X){return new J4(await super._call(X))}}class k0 extends S{}class O0 extends k0{}class f0 extends k0{async _call(X){return new q6(await super._call(X))}}class _0 extends k0{async _call(X){return new J4(await super._call(X))}}class L6 extends k0{async _call(X){return new c6(await super._call(X))}}class X6 extends S{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"]}class y6 extends X6{}class r6 extends X6{}class v6 extends S{}class Q4 extends v6{}class e6 extends v6{}class S4 extends S{}class IJ extends S4{}class G4 extends S4{}class b4 extends S{}class M6 extends b4{}class n6 extends b4{}class N4 extends b4{async _call(X){return new q6(await super._call(X))}}class I4 extends S{}class r4 extends I4{}class W4 extends I4{}class h4 extends I4{async _call(X){return new q6(await super._call(X))}}class s6 extends I4{}class h6 extends S{}class d6 extends h6{}class u6 extends h6{}class z4 extends S{}class vJ extends z4{}class L5 extends z4{}class OJ extends S{}class G8 extends OJ{}class X8 extends OJ{async _call(X){return new c6(await super._call(X))}}class q8 extends OJ{async _call(X){return new q6(await super._call(X))}}class H8 extends OJ{async _call(X){return new g6(await super._call(X))}}class V8 extends OJ{async _call(X){return new J4(await super._call(X))}}class bJ extends S{}class U8 extends bJ{}class N8 extends bJ{async _call(X){return new c6(await super._call(X))}}class z8 extends bJ{async _call(X){return new q6(await super._call(X))}}class E8 extends bJ{async _call(X){return new g6(await super._call(X))}}class L8 extends bJ{async _call(X){return new J4(await super._call(X))}}class hJ extends S{}class A8 extends hJ{}class B8 extends hJ{async _call(X){return new c6(await super._call(X))}}class R8 extends hJ{async _call(X){return new q6(await super._call(X))}}class F8 extends hJ{async _call(X){return new g6(await super._call(X))}}class D8 extends hJ{async _call(X){return new J4(await super._call(X))}}class r5 extends S{}class I8 extends r5{}class w8 extends r5{}class e5 extends S{requires_attention_mask=!1;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"]}class j8 extends e5{}class n5 extends e5{_prepare_generation_config(X,M){return super._prepare_generation_config(X,M,y.WhisperGenerationConfig)}_retrieve_init_tokens(X){let M=[X.decoder_start_token_id],e=X.language,J0=X.task;if(X.is_multilingual){if(!e)console.warn("No language specified - defaulting to English (en)."),e="en";let H0=`<|${(0,g.whisper_language_to_code)(e)}|>`;M.push(X.lang_to_id[H0]),M.push(X.task_to_id[J0??"transcribe"])}else if(e||J0)throw Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");if(!X.return_timestamps&&X.no_timestamps_token_id&&M.at(-1)!==X.no_timestamps_token_id)M.push(X.no_timestamps_token_id);else if(X.return_timestamps&&M.at(-1)===X.no_timestamps_token_id)console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),M.pop();return M.filter((q0)=>q0!=null)}async generate({inputs:X=null,generation_config:M=null,logits_processor:e=null,stopping_criteria:J0=null,...q0}){M=this._prepare_generation_config(M,q0);let H0=q0.decoder_input_ids??this._retrieve_init_tokens(M);if(M.return_timestamps)e??=new U.LogitsProcessorList,e.push(new U.WhisperTimeStampLogitsProcessor(M,H0));if(M.begin_suppress_tokens)e??=new U.LogitsProcessorList,e.push(new U.SuppressTokensAtBeginLogitsProcessor(M.begin_suppress_tokens,H0.length));if(M.return_token_timestamps){if(!M.alignment_heads)throw Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");if(M.task==="translate")console.warn("Token-level timestamps may not be reliable for task 'translate'.");M.output_attentions=!0,M.return_dict_in_generate=!0}let I0=await super.generate({inputs:X,generation_config:M,logits_processor:e,decoder_input_ids:H0,...q0});if(M.return_token_timestamps)I0.token_timestamps=this._extract_token_timestamps(I0,M.alignment_heads,M.num_frames);return I0}_extract_token_timestamps(X,M,e=null,J0=0.02){if(!X.cross_attentions)throw Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");if(e==null)console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let q0=this.config.median_filter_width;if(q0===void 0)console.warn("Model config has no `median_filter_width`, using default value of 7."),q0=7;let H0=X.cross_attentions,I0=Array.from({length:this.config.decoder_layers},(G6,Y6)=>(0,L.cat)(H0.map((V6)=>V6[Y6]),2)),M0=(0,L.stack)(M.map(([G6,Y6])=>{if(G6>=I0.length)throw Error(`Layer index ${G6} is out of bounds for cross attentions (length ${I0.length}).`);return e?I0[G6].slice(null,Y6,null,[0,e]):I0[G6].slice(null,Y6)})).transpose(1,0,2,3),[g0,K6]=(0,L.std_mean)(M0,-2,0,!0),Q6=M0.clone();for(let G6=0;G6<Q6.dims[0];++G6){let Y6=Q6[G6];for(let V6=0;V6<Y6.dims[0];++V6){let I6=Y6[V6],T6=g0[G6][V6][0].data,E4=K6[G6][V6][0].data;for(let O6=0;O6<I6.dims[0];++O6){let C6=I6[O6].data;for(let i6=0;i6<C6.length;++i6)C6[i6]=(C6[i6]-E4[i6])/T6[i6];C6.set((0,F.medianFilter)(C6,q0))}}}let N6=[(0,L.mean)(Q6,1)],o0=X.sequences.dims,D6=new L.Tensor("float32",new Float32Array(o0[0]*o0[1]),o0);for(let G6=0;G6<o0[0];++G6){let Y6=N6[G6].neg().squeeze_(0),[V6,I6]=(0,F.dynamic_time_warping)(Y6.tolist()),T6=Array.from({length:V6.length-1},(C6,i6)=>V6[i6+1]-V6[i6]),E4=(0,G.mergeArrays)([1],T6).map((C6)=>!!C6),O6=[];for(let C6=0;C6<E4.length;++C6)if(E4[C6])O6.push(I6[C6]*J0);D6[G6].data.set(O6,1)}return D6}}class P8 extends n5{}class s5 extends S{requires_attention_mask=!1;main_input_name="input_values";forward_params=["input_values","decoder_input_ids","past_key_values"]}class OY extends s5{}class C8 extends s5{}class i5 extends S{main_input_name="pixel_values";forward_params=["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"]}class t5 extends S{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class A5 extends t5{_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return D({image_token_id:this.config.image_token_index,...X,image_features:e})}}class S8 extends A5{}class M8 extends A5{}class T8 extends S{forward_params=["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"];main_input_name="inputs_embeds"}class _8 extends T8{_merge_input_ids_with_image_features({inputs_embeds:X,image_features:M,input_ids:e,attention_mask:J0}){return{inputs_embeds:(0,L.cat)([M,X],1),attention_mask:(0,L.cat)([(0,L.ones)(M.dims.slice(0,2)),J0],1)}}async _prepare_inputs_embeds({input_ids:X,pixel_values:M,inputs_embeds:e,attention_mask:J0}){if(!X&&!M)throw Error("Either `input_ids` or `pixel_values` should be provided.");let q0,H0;if(X)q0=await this.encode_text({input_ids:X});if(M)H0=await this.encode_image({pixel_values:M});if(q0&&H0)({inputs_embeds:e,attention_mask:J0}=this._merge_input_ids_with_image_features({inputs_embeds:q0,image_features:H0,input_ids:X,attention_mask:J0}));else e=q0||H0;return{inputs_embeds:e,attention_mask:J0}}async forward({input_ids:X,pixel_values:M,attention_mask:e,decoder_input_ids:J0,decoder_attention_mask:q0,encoder_outputs:H0,past_key_values:I0,inputs_embeds:M0,decoder_inputs_embeds:g0}){if(!M0)({inputs_embeds:M0,attention_mask:e}=await this._prepare_inputs_embeds({input_ids:X,pixel_values:M,inputs_embeds:M0,attention_mask:e}));if(!H0){let{last_hidden_state:N6}=await Q0(this,{inputs_embeds:M0,attention_mask:e});H0=N6}if(!g0){if(!J0)throw Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");g0=await this.encode_text({input_ids:J0})}return await N0(this,{inputs_embeds:g0,attention_mask:q0,encoder_attention_mask:e,encoder_hidden_states:H0,past_key_values:I0},!0)}}class k8 extends S{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class x8 extends k8{_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return D({image_token_id:this.config.image_token_index,...X,image_features:e})}}class y8 extends t5{_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return D({image_token_id:this.config.image_token_index,...X,image_features:e})}}class v8 extends S{forward_params=["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"]}class o5 extends v8{async forward({input_ids:X=null,attention_mask:M=null,pixel_values:e=null,input_features:J0=null,input_features_mask:q0=null,position_ids:H0=null,inputs_embeds:I0=null,per_layer_inputs:M0=null,past_key_values:g0=null,generation_config:K6=null,logits_processor:Q6=null,...N6}){if(!I0||!M0){if({inputs_embeds:I0,per_layer_inputs:M0}=await m(this.sessions.embed_tokens,{input_ids:X}),X.dims[1]!==1){if(e){let{image_features:D6}=await m(this.sessions.vision_encoder,{pixel_values:e});({inputs_embeds:I0,attention_mask:M}=this._merge_input_ids_with_image_features({image_features:D6,inputs_embeds:I0,input_ids:X,attention_mask:M}))}if(J0){let{audio_features:D6}=await m(this.sessions.audio_encoder,{input_features:J0,input_features_mask:q0});({inputs_embeds:I0,attention_mask:M}=this._merge_input_ids_with_audio_features({audio_features:D6,inputs_embeds:I0,input_ids:X,attention_mask:M}))}}}return await N0(this,{inputs_embeds:I0,per_layer_inputs:M0,past_key_values:g0,attention_mask:M,position_ids:H0,generation_config:K6,logits_processor:Q6},!0)}_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return D({image_token_id:this.config.image_token_id,...X,image_features:e})}_merge_input_ids_with_audio_features(X){let M=X.audio_features.dims.at(-1),e=X.audio_features.view(-1,M);return O({audio_token_id:this.config.audio_token_id,...X,audio_features:e})}}class O8 extends S{forward_params=["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"]}class B5 extends O8{async encode_image({pixel_values:X,pixel_attention_mask:M}){return(await m(this.sessions.vision_encoder,{pixel_values:X,pixel_attention_mask:M})).image_features}_merge_input_ids_with_image_features(X){let M=X.image_features.dims.at(-1),e=X.image_features.view(-1,M);return D({image_token_id:this.config.image_token_id,...X,image_features:e})}}class J$ extends B5{}class b8 extends S{forward_params=["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"]}class $$ extends b8{async forward({input_ids:X=null,attention_mask:M=null,pixel_values:e=null,image_sizes:J0=null,position_ids:q0=null,inputs_embeds:H0=null,past_key_values:I0=null,generation_config:M0=null,logits_processor:g0=null,...K6}){if(!H0){let N6;if(e&&X.dims[1]!==1){if(!J0)throw Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:N6}=await m(this.sessions.vision_encoder,{pixel_values:e,image_sizes:J0}))}else{let o0=this.config.normalized_config.hidden_size;N6=new L.Tensor("float32",[],[0,o0])}({inputs_embeds:H0}=await m(this.sessions.prepare_inputs_embeds,{input_ids:X,image_features:N6}))}return await N0(this,{inputs_embeds:H0,past_key_values:I0,attention_mask:M,position_ids:q0,generation_config:M0,logits_processor:g0},!1)}}class wJ extends S{}class h8 extends wJ{}class bY extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class f8 extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class hY extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class d8 extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class Z$ extends S{}class u8 extends Z${}class g8 extends Z${static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class l8 extends wJ{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class c8 extends S{}class m8 extends c8{}class R5 extends S{}class a8 extends R5{async forward(X){let M=!X.input_ids,e=!X.pixel_values;if(M&&e)throw Error("Either `input_ids` or `pixel_values` should be provided.");if(M)X.input_ids=(0,L.ones)([X.pixel_values.dims[0],1]);if(e){let{image_size:g0}=this.config.vision_config;X.pixel_values=(0,L.full)([0,3,g0,g0],0)}let{text_embeddings:J0,image_embeddings:q0,l2norm_text_embeddings:H0,l2norm_image_embeddings:I0}=await super.forward(X),M0={};if(!M)M0.text_embeddings=J0,M0.l2norm_text_embeddings=H0;if(!e)M0.image_embeddings=q0,M0.l2norm_image_embeddings=I0;return M0}}class p8 extends R5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class r8 extends R5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"vision_model"})}}class Q$ extends S{}class e8 extends Q${}class n8 extends Q${}class W$ extends S{}class s8 extends W${}class i8 extends W${}class K$ extends S{}class t8 extends K${}class o8 extends K${}class Y$ extends S{}class JQ extends Y${}class $Q extends Y${}class G$ extends S{}class ZQ extends G${}class QQ extends G${}class X$ extends S{}class WQ extends X${}class KQ extends X${}class q$ extends S{}class YQ extends q${}class GQ extends q${}class H$ extends S{}class XQ extends H${}class qQ extends H${}class V$ extends S{}class HQ extends V${}class VQ extends V${}class UQ extends S{}class NQ extends UQ{}class U$ extends S{}class zQ extends U${}class EQ extends U${}class N$ extends S{}class LQ extends N${}class AQ extends N${}class z$ extends S{}class BQ extends z${}class RQ extends z${}class E$ extends S{}class FQ extends E${}class DQ extends E${}class L$ extends S{}class IQ extends L${}class wQ extends L${}class A$ extends S{}class jQ extends A${}class PQ extends A${}class B$ extends S{}class CQ extends B${}class SQ extends B${}class R$ extends S{}class MQ extends R${}class TQ extends R${}class F$ extends S{}class _Q extends F${}class kQ extends F${}class D$ extends S{}class xQ extends D${}class yQ extends D${}class I$ extends S{}class vQ extends I${}class OQ extends I${}class w$ extends S{}class bQ extends w${}class hQ extends w${}class j$ extends S{}class fQ extends j${}class dQ extends j${}class P$ extends S{}class uQ extends P${}class gQ extends P${}class C$ extends S{}class lQ extends C${}class cQ extends C${}class S$ extends S{}class mQ extends S${}class aQ extends S${}class M$ extends S{}class pQ extends M${}class rQ extends M${}class T$ extends S{}class eQ extends T${}class nQ extends T${}class _$ extends S{}class sQ extends _${}class iQ extends _${}class k$ extends S{}class tQ extends k${}class oQ extends k${}class JW extends S{forward_params=["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"]}class $W extends JW{get_rope_index(X,M,e,J0){let{vision_config:q0,image_token_id:H0,video_token_id:I0,vision_start_token_id:M0}=this.config,g0=q0.spatial_merge_size??2,K6=[];if(M||e){let Q6=X.tolist();if(!J0)J0=(0,L.ones_like)(X);let N6=J0.tolist(),o0=Array.from({length:3},(I6)=>Array.from({length:X.dims[0]},(T6)=>Array.from({length:X.dims[1]},(E4)=>1))),D6=M?M.tolist():[],G6=e?e.tolist():[],Y6=0,V6=0;for(let I6=0;I6<Q6.length;++I6){let T6=Q6[I6].filter((S6,m6)=>N6[I6][m6]==1),O6=T6.reduce((S6,m6,jJ)=>{if(m6==M0)S6.push(jJ);return S6},[]).map((S6)=>T6[S6+1]),C6=O6.filter((S6)=>S6==H0).length,i6=O6.filter((S6)=>S6==I0).length,A6=[],l6=0,e4=C6,K4=i6;for(let S6=0;S6<O6.length;++S6){let m6=T6.findIndex((lJ,d4)=>d4>l6&&lJ==H0),jJ=T6.findIndex((lJ,d4)=>d4>l6&&lJ==I0),gJ=e4>0&&m6!==-1?m6:T6.length+1,Q5=K4>0&&jJ!==-1?jJ:T6.length+1,MZ,pK,rK,eK;if(gJ<Q5)[pK,rK,eK]=D6[Y6],++Y6,--e4,MZ=gJ;else[pK,rK,eK]=G6[V6],++V6,--K4,MZ=Q5;let[$U,nK,TZ]=[Number(pK),Math.floor(Number(rK)/g0),Math.floor(Number(eK)/g0)],sK=MZ-l6,eG=A6.length>0?(0,F.max)(A6.at(-1))[0]+1:0;A6.push(Array.from({length:3*sK},(lJ,d4)=>eG+d4%sK));let iK=sK+eG,_Z=$U*nK*TZ,ZU=Array.from({length:_Z},(lJ,d4)=>iK+Math.floor(d4/(nK*TZ))),QU=Array.from({length:_Z},(lJ,d4)=>iK+Math.floor(d4/TZ)%nK),WU=Array.from({length:_Z},(lJ,d4)=>iK+d4%TZ);A6.push([ZU,QU,WU].flat()),l6=MZ+_Z}if(l6<T6.length){let S6=A6.length>0?(0,F.max)(A6.at(-1))[0]+1:0,m6=T6.length-l6;A6.push(Array.from({length:3*m6},(jJ,gJ)=>S6+gJ%m6))}let f4=A6.reduce((S6,m6)=>S6+m6.length,0),dJ=Array(f4),SZ=0;for(let S6=0;S6<3;++S6)for(let m6=0;m6<A6.length;++m6){let jJ=A6[m6],gJ=jJ.length/3;for(let Q5=S6*gJ;Q5<(S6+1)*gJ;++Q5)dJ[SZ++]=jJ[Q5]}let uJ=0,O5=N6[I6];for(let S6=0;S6<O5.length;++S6)if(O5[S6]==1){for(let m6=0;m6<3;++m6)o0[m6][I6][S6]=dJ[m6*f4/3+uJ];++uJ}let JU=(0,F.max)(dJ)[0];K6.push(JU+1-Q6[I6].length)}return[new L.Tensor("int64",o0.flat(1/0),[3,X.dims[0],X.dims[1]]),new L.Tensor("int64",K6,[K6.length,1])]}else if(J0){let{data:Q6,dims:N6}=A0(J0),o0=BigInt64Array.from({length:3*Q6.length},(G6,Y6)=>Q6[Y6%Q6.length]),D6=Array.from({length:N6[0]},(G6,Y6)=>(0,F.max)(Q6.subarray(N6[1]*Y6,N6[1]*(Y6+1)))[0]+1n+BigInt(N6[1]));return[new L.Tensor("int64",o0,[3,...N6]),new L.Tensor("int64",D6,[D6.length,1])]}else{let[Q6,N6]=X.dims,o0=BigInt64Array.from({length:3*Q6*N6},(D6,G6)=>BigInt(Math.floor(G6%N6/Q6)));return[new L.Tensor("int64",o0,[3,...X.dims]),(0,L.zeros)([Q6,1])]}}async encode_image({pixel_values:X,image_grid_thw:M}){return(await m(this.sessions.vision_encoder,{pixel_values:X,grid_thw:M})).image_features}_merge_input_ids_with_image_features(X){return D({image_token_id:this.config.image_token_id,...X})}prepare_inputs_for_generation(X,M,e){if(M.attention_mask&&!M.position_ids)if(!M.past_key_values)[M.position_ids,M.rope_deltas]=this.get_rope_index(M.input_ids,M.image_grid_thw,M.video_grid_thw,M.attention_mask);else{M.pixel_values=null;let J0=BigInt(Object.values(M.past_key_values)[0].dims.at(-2)),q0=M.rope_deltas.map((H0)=>J0+H0);M.position_ids=(0,L.stack)([q0,q0,q0],0)}return M}}class x$ extends S{}class ZW extends x${}class QW extends x${}class y$ extends S{}class WW extends y${}class KW extends y${}class v$ extends S{}class YW extends v${}class GW extends v${}class O$ extends S{}class XW extends O${}class qW extends O${}class b$ extends S{}class HW extends b${}class VW extends b${}class h$ extends S{}class UW extends h${}class NW extends h${async _call(X){return new q6(await super._call(X))}}class f$ extends S{}class zW extends f${}class EW extends f${async _call(X){return new q6(await super._call(X))}}class LW extends S{}class AW extends LW{}class d$ extends S{}class BW extends d${}class RW extends d${async _call(X){return new q6(await super._call(X))}}class FW extends S{}class DW extends FW{}class u$ extends S{}class IW extends u${}class wW extends u${async _call(X){return new q6(await super._call(X))}}class jW extends S{}class PW extends jW{}class g$ extends S{}class CW extends g${}class SW extends g${async _call(X){return new q6(await super._call(X))}}class MW extends S{}class TW extends MW{async _call(X){return new mK(await super._call(X))}}class l$ extends S{}class _W extends l${}class kW extends l${async _call(X){return new q6(await super._call(X))}}class c$ extends S{}class xW extends c${}class yW extends c${async _call(X){return new q6(await super._call(X))}}class m$ extends S{}class vW extends m${}class OW extends m${}class a$ extends S{}class bW extends a${}class hW extends a${}class p$ extends S{}class fW extends p${}class dW extends p${async _call(X){return new q6(await super._call(X))}}class F5 extends S{}class uW extends F5{}class gW extends F5{async _call(X){return new e$(await super._call(X))}}class r$ extends F5{async _call(X){return new lW(await super._call(X))}}class e$ extends W0{constructor({logits:X,pred_boxes:M}){super();this.logits=X,this.pred_boxes=M}}class lW extends W0{constructor({logits:X,pred_boxes:M,pred_masks:e}){super();this.logits=X,this.pred_boxes=M,this.pred_masks=e}}class n$ extends S{}class cW extends n${}class mW extends n${async _call(X){return new J5(await super._call(X))}}class J5 extends W0{constructor({logits:X,pred_boxes:M}){super();this.logits=X,this.pred_boxes=M}}class s$ extends S{}class aW extends s${}class pW extends s${async _call(X){return new rW(await super._call(X))}}class rW extends J5{}class i$ extends S{}class eW extends i${}class nW extends i${async _call(X){return new sW(await super._call(X))}}class sW extends J5{}class t$ extends S{}class iW extends t${}class tW extends t${async _call(X){return new J5(await super._call(X))}}class o$ extends S{}class oW extends o${}class J7 extends o${async _call(X){return new $7(await super._call(X))}}class $7 extends e${}class JZ extends S{}class Z7 extends JZ{}class Q7 extends JZ{async _call(X){return new q6(await super._call(X))}}class $Z extends S{}class W7 extends $Z{}class K7 extends $Z{async _call(X){return new q6(await super._call(X))}}class ZZ extends S{}class Y7 extends ZZ{}class G7 extends ZZ{async _call(X){return new q6(await super._call(X))}}class D5 extends S{}class X7 extends D5{}class q7 extends D5{async _call(X){return new q6(await super._call(X))}}class H7 extends D5{}class QZ extends S{}class V7 extends QZ{}class U7 extends QZ{}class WZ extends S{}class N7 extends WZ{}class z7 extends WZ{}class E7 extends S{}class L7 extends E7{}class I5 extends S{}class A7 extends I5{}class B7 extends I5{}class R7 extends I5{}class F7 extends S{}class D7 extends F7{}class I7 extends S{}class w7 extends I7{}class j7 extends S{}class P7 extends j7{}class KZ extends S{}class C7 extends KZ{}class S7 extends KZ{}class YZ extends S{}class M7 extends YZ{}class T7 extends YZ{}class _7 extends S{}class k7 extends _7{}class GZ extends S{}class x7 extends GZ{}class y7 extends GZ{async _call(X){return new q6(await super._call(X))}}class XZ extends S{}class v7 extends XZ{}class O7 extends XZ{async _call(X){return new q6(await super._call(X))}}class qZ extends S{}class b7 extends qZ{}class h7 extends qZ{async _call(X){return new q6(await super._call(X))}}class HZ extends S{}class f7 extends HZ{}class d7 extends HZ{async _call(X){return new q6(await super._call(X))}}class u7 extends S{}class g7 extends u7{}class l7 extends S{}class c7 extends l7{}class m7 extends S{}class a7 extends m7{}class VZ extends S{}class p7 extends VZ{}class r7 extends VZ{async _call(X){return new e7(await super._call(X))}}class e7 extends W0{constructor({logits:X,pred_boxes:M}){super();this.logits=X,this.pred_boxes=M}}class n7 extends S{}class s7 extends n7{async get_image_embeddings({pixel_values:X}){return await Q0(this,{pixel_values:X})}async forward(X){if(!X.image_embeddings||!X.image_positional_embeddings)X={...X,...await this.get_image_embeddings(X)};if(!X.input_labels&&X.input_points){let e=X.input_points.dims.slice(0,-1),J0=e.reduce((q0,H0)=>q0*H0,1);X.input_labels=new L.Tensor("int64",new BigInt64Array(J0).fill(1n),e)}let M={image_embeddings:X.image_embeddings,image_positional_embeddings:X.image_positional_embeddings};if(X.input_points)M.input_points=X.input_points;if(X.input_labels)M.input_labels=X.input_labels;if(X.input_boxes)M.input_boxes=X.input_boxes;return await m(this.sessions.prompt_encoder_mask_decoder,M)}async _call(X){return new i7(await super._call(X))}}class i7 extends W0{constructor({iou_scores:X,pred_masks:M}){super();this.iou_scores=X,this.pred_masks=M}}class UZ extends S{}class t7 extends UZ{}class o7 extends UZ{}class NZ extends S{}class J9 extends NZ{}class $9 extends NZ{}class UJ extends S{}class Z9 extends UJ{}class Q9 extends UJ{async _call(X){return new NJ(await super._call(X))}}class W9 extends UJ{async _call(X){return new q6(await super._call(X))}}class K9 extends UJ{async _call(X){return new g6(await super._call(X))}}class Y9 extends S{}class G9 extends Y9{async _call(X){return new NJ(await super._call(X))}}class zZ extends S{}class X9 extends zZ{}class q9 extends zZ{async _call(X){return new g6(await super._call(X))}}class H9 extends S{}class V9 extends H9{}class w5 extends S{}class U9 extends w5{}class N9 extends w5{async _call(X){return new NJ(await super._call(X))}}class z9 extends w5{async _call(X){return new q6(await super._call(X))}}class $5 extends S{}class E9 extends $5{}class L9 extends $5{async _call(X){return new NJ(await super._call(X))}}class A9 extends $5{async _call(X){return new q6(await super._call(X))}}class B9 extends $5{async _call(X){return new g6(await super._call(X))}}class j5 extends S{}class R9 extends j5{}class F9 extends j5{async _call(X){return new NJ(await super._call(X))}}class D9 extends j5{async _call(X){return new q6(await super._call(X))}}class fY extends S{}class I9 extends UJ{}class w9 extends UJ{async _call(X){return new NJ(await super._call(X))}}class j9 extends UJ{async _call(X){return new q6(await super._call(X))}}class fJ extends S{}class P9 extends fJ{}class C9 extends fJ{async _call(X){return new NJ(await super._call(X))}}class S9 extends fJ{async _call(X){return new q6(await super._call(X))}}class M9 extends fJ{async _call(X){return new cK(await super._call(X))}}class T9 extends fJ{async _call(X){return new g6(await super._call(X))}}class _9 extends S{}class k9 extends _9{}class P5 extends S{}class dY extends P5{}class x9 extends P5{}class y9 extends P5{async generate_speech(X,M,{threshold:e=0.5,minlenratio:J0=0,maxlenratio:q0=20,vocoder:H0=null}={}){let I0={input_ids:X},{encoder_outputs:M0,encoder_attention_mask:g0}=await Q0(this,I0),K6=M0.dims[1]/this.config.reduction_factor,Q6=Math.floor(K6*q0),N6=Math.floor(K6*J0),o0=this.config.num_mel_bins,D6=[],G6=null,Y6=null,V6=0;while(!0){++V6;let E4=n(!!Y6),O6;if(Y6)O6=Y6.output_sequence_out;else O6=new L.Tensor("float32",new Float32Array(o0),[1,1,o0]);let C6={use_cache_branch:E4,output_sequence:O6,encoder_attention_mask:g0,speaker_embeddings:M,encoder_hidden_states:M0};this.addPastKeyValues(C6,G6),Y6=await m(this.sessions.decoder_model_merged,C6),G6=this.getPastKeyValues(Y6,G6);let{prob:i6,spectrum:A6}=Y6;if(D6.push(A6),V6>=N6&&(Array.from(i6.data).filter((l6)=>l6>=e).length>0||V6>=Q6))break}let I6=(0,L.cat)(D6),{waveform:T6}=await m(H0.sessions.model,{spectrogram:I6});return{spectrogram:I6,waveform:T6}}}class v9 extends S{main_input_name="spectrogram"}class O9 extends S{}class b9 extends O9{}class EZ extends S{}class h9 extends EZ{}class f9 extends EZ{}class LZ extends S{}class d9 extends LZ{}class u9 extends LZ{}class AZ extends S{}class g9 extends AZ{}class l9 extends AZ{}class BZ extends S{}class c9 extends BZ{}class m9 extends BZ{}class C5 extends S{}class a9 extends C5{}class p9 extends C5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"text_model"})}}class r9 extends C5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"audio_model"})}}class e9 extends S{}class RZ extends e9{async _call(X){return new aK(await super._call(X))}}class S5 extends S{}class uY extends S5{}class n9 extends S5{}class s9 extends S5{}class FZ extends S{}class i9 extends FZ{}class t9 extends FZ{}class DZ extends S{}class o9 extends DZ{}class JK extends DZ{async _call(X){return new q6(await super._call(X))}}class IZ extends S{}class gY extends IZ{}class lY extends IZ{}class wZ extends S{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];_apply_and_filter_by_delay_pattern_mask(X){let[M,e]=X.dims,J0=this.config.decoder.num_codebooks,q0=e-J0,H0=0;for(let g0=0;g0<X.size;++g0){if(X.data[g0]===this.config.decoder.pad_token_id)continue;let K6=g0%e,Q6=Math.floor(g0/e)%J0,N6=K6-Q6;if(N6>0&&N6<=q0)X.data[H0++]=X.data[g0]}let I0=Math.floor(M/J0),M0=H0/(I0*J0);return new L.Tensor(X.type,X.data.slice(0,H0),[I0,J0,M0])}prepare_inputs_for_generation(X,M,e){let J0=structuredClone(X);for(let H0=0;H0<J0.length;++H0)for(let I0=0;I0<J0[H0].length;++I0)if(H0%this.config.decoder.num_codebooks>=I0)J0[H0][I0]=BigInt(this.config.decoder.pad_token_id);if(e.guidance_scale!==null&&e.guidance_scale>1)J0=J0.concat(J0);return super.prepare_inputs_for_generation(J0,M,e)}async generate(X){let M=await super.generate(X),e=this._apply_and_filter_by_delay_pattern_mask(M).unsqueeze_(0),{audio_values:J0}=await m(this.sessions.encodec_decode,{audio_codes:e});return J0}}class M5 extends S{}class $K extends M5{}class ZK extends M5{async _call(X){return new q6(await super._call(X))}}class QK extends M5{}class T5 extends S{}class WK extends T5{}class KK extends T5{async _call(X){return new q6(await super._call(X))}}class YK extends T5{}class _5 extends S{}class GK extends _5{}class XK extends _5{async _call(X){return new q6(await super._call(X))}}class qK extends _5{}class k5 extends S{}class HK extends k5{}class VK extends k5{async _call(X){return new q6(await super._call(X))}}class UK extends k5{}class NK extends S{}class zK extends NK{}class EK extends S{}class LK extends EK{forward_params=["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"];constructor(...X){super(...X);this._generation_mode="text"}async forward(X){let M=this._generation_mode??"text",e;if(M==="text"||!X.past_key_values){let M0=this.sessions.prepare_inputs_embeds,g0=(0,G.pick)(X,M0.inputNames);e=await m(M0,g0)}else{let M0=this.sessions.gen_img_embeds,g0=(0,G.pick)({image_ids:X.input_ids},M0.inputNames);e=await m(M0,g0)}let J0={...X,...e},q0=await N0(this,J0),H0=this.sessions[M==="text"?"lm_head":"gen_head"];if(!H0)throw Error(`Unable to find "${H0}" generation head`);let I0=await m(H0,(0,G.pick)(q0,H0.inputNames));return{...e,...q0,...I0}}async generate(X){return this._generation_mode="text",super.generate(X)}async generate_images(X){this._generation_mode="image";let M=(X.inputs??X[this.main_input_name]).dims[1],J0=(await super.generate(X)).slice(null,[M,null]),q0=this.sessions.image_decode,{decoded_image:H0}=await m(q0,{generated_tokens:J0}),I0=H0.add_(1).mul_(127.5).clamp_(0,255).to("uint8"),M0=[];for(let g0 of I0){let K6=w.RawImage.fromTensor(g0);M0.push(K6)}return M0}}class AK extends W0{constructor({char_logits:X,bpe_logits:M,wp_logits:e}){super();this.char_logits=X,this.bpe_logits=M,this.wp_logits=e}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class BK extends S{}class RK extends BK{async _call(X){return new AK(await super._call(X))}}class jZ extends S{}class FK extends jZ{}class DK extends jZ{}class PZ extends S{}class IK extends PZ{}class wK extends PZ{}class jK extends S{forward_params=["input_ids","attention_mask","position_ids","audio_values","past_key_values"]}class CZ extends jK{_merge_input_ids_with_audio_features(X){let M=X.audio_features.dims.at(-1),e=X.audio_features.view(-1,M);return O({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...X,audio_features:e})}}class PK extends CZ{}class x5 extends S{main_input_name="input_values";forward_params=["input_values"]}class CK extends W0{constructor({audio_codes:X}){super();this.audio_codes=X}}class SK extends W0{constructor({audio_values:X}){super();this.audio_values=X}}class MK extends x5{async encode(X){return new CK(await m(this.sessions.encoder_model,X))}async decode(X){return new SK(await m(this.sessions.decoder_model,X))}}class TK extends x5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"encoder_model"})}}class _K extends x5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"decoder_model"})}}class y5 extends S{main_input_name="input_values";forward_params=["input_values"]}class kK extends W0{constructor({audio_codes:X}){super();this.audio_codes=X}}class xK extends W0{constructor({audio_values:X}){super();this.audio_values=X}}class yK extends y5{async encode(X){return new kK(await m(this.sessions.encoder_model,X))}async decode(X){return new xK(await m(this.sessions.decoder_model,X))}}class vK extends y5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"encoder_model"})}}class OK extends y5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"decoder_model"})}}class v5 extends S{main_input_name="input_values";forward_params=["input_values"]}class bK extends v5{async encode(X){return await m(this.sessions.encoder_model,X)}async decode(X){return await m(this.sessions.decoder_model,X)}}class hK extends v5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"encoder_model"})}}class fK extends v5{static async from_pretrained(X,M={}){return super.from_pretrained(X,{...M,model_file_name:M.model_file_name??"decoder_model"})}}class R6{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(X,{progress_callback:M=null,config:e=null,cache_dir:J0=null,local_files_only:q0=!1,revision:H0="main",model_file_name:I0=null,subfolder:M0="onnx",device:g0=null,dtype:K6=null,use_external_data_format:Q6=null,session_options:N6={}}={}){let o0={progress_callback:M,config:e,cache_dir:J0,local_files_only:q0,revision:H0,model_file_name:I0,subfolder:M0,device:g0,dtype:K6,use_external_data_format:Q6,session_options:N6};if(o0.config=await Q.AutoConfig.from_pretrained(X,o0),!this.MODEL_CLASS_MAPPINGS)throw Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);let D6=o0.config.model_type;for(let G6 of this.MODEL_CLASS_MAPPINGS){let Y6=G6.get(D6);if(!Y6){for(let V6 of G6.values())if(V6[0]===D6){Y6=V6;break}if(!Y6)continue}return await Y6[1].from_pretrained(X,o0)}if(this.BASE_IF_FAIL){if(!zG.has(D6))console.warn(`Unknown model class "${D6}", attempting to construct from base class.`);return await S.from_pretrained(X,o0)}else throw Error(`Unsupported model type: ${D6}`)}}let pV=new Map([["bert",["BertModel",R0]],["neobert",["NeoBertModel",x0]],["modernbert",["ModernBertModel",y0]],["nomic_bert",["NomicBertModel",V4]],["roformer",["RoFormerModel",k6]],["electra",["ElectraModel",u]],["esm",["EsmModel",a4]],["convbert",["ConvBertModel",Z6]],["camembert",["CamembertModel",c0]],["deberta",["DebertaModel",j6]],["deberta-v2",["DebertaV2Model",g4]],["mpnet",["MPNetModel",kJ]],["albert",["AlbertModel",O0]],["distilbert",["DistilBertModel",k4]],["roberta",["RobertaModel",G8]],["xlm",["XLMModel",U8]],["xlm-roberta",["XLMRobertaModel",A8]],["clap",["ClapModel",a9]],["clip",["CLIPModel",h8]],["clipseg",["CLIPSegModel",e8]],["chinese_clip",["ChineseCLIPModel",m8]],["siglip",["SiglipModel",u8]],["jina_clip",["JinaCLIPModel",a8]],["mobilebert",["MobileBertModel",m0]],["squeezebert",["SqueezeBertModel",l]],["wav2vec2",["Wav2Vec2Model",Z9]],["wav2vec2-bert",["Wav2Vec2BertModel",R9]],["unispeech",["UniSpeechModel",U9]],["unispeech-sat",["UniSpeechSatModel",E9]],["hubert",["HubertModel",I9]],["wavlm",["WavLMModel",P9]],["audio-spectrogram-transformer",["ASTModel",I8]],["vits",["VitsModel",RZ]],["pyannote",["PyAnnoteModel",X9]],["wespeaker-resnet",["WeSpeakerResNetModel",V9]],["detr",["DetrModel",uW]],["rt_detr",["RTDetrModel",cW]],["rt_detr_v2",["RTDetrV2Model",aW]],["rf_detr",["RFDetrModel",eW]],["d_fine",["DFineModel",iW]],["table-transformer",["TableTransformerModel",oW]],["vit",["ViTModel",UW]],["ijepa",["IJepaModel",zW]],["pvt",["PvtModel",BW]],["vit_msn",["ViTMSNModel",IW]],["vit_mae",["ViTMAEModel",DW]],["groupvit",["GroupViTModel",PW]],["fastvit",["FastViTModel",CW]],["mobilevit",["MobileViTModel",_W]],["mobilevitv2",["MobileViTV2Model",xW]],["owlvit",["OwlViTModel",vW]],["owlv2",["Owlv2Model",bW]],["beit",["BeitModel",fW]],["deit",["DeiTModel",Z7]],["hiera",["HieraModel",W7]],["convnext",["ConvNextModel",x7]],["convnextv2",["ConvNextV2Model",v7]],["dinov2",["Dinov2Model",b7]],["dinov2_with_registers",["Dinov2WithRegistersModel",f7]],["dinov3_vit",["DINOv3ViTModel",g7]],["dinov3_convnext",["DINOv3ConvNextModel",c7]],["resnet",["ResNetModel",Y7]],["swin",["SwinModel",X7]],["swin2sr",["Swin2SRModel",V7]],["donut-swin",["DonutSwinModel",k7]],["yolos",["YolosModel",p7]],["dpt",["DPTModel",N7]],["glpn",["GLPNModel",M7]],["hifigan",["SpeechT5HifiGan",v9]],["efficientnet",["EfficientNetModel",o9]],["decision_transformer",["DecisionTransformerModel",zK]],["patchtst",["PatchTSTForPrediction",FK]],["patchtsmixer",["PatchTSMixerForPrediction",IK]],["mobilenet_v1",["MobileNetV1Model",$K]],["mobilenet_v2",["MobileNetV2Model",WK]],["mobilenet_v3",["MobileNetV3Model",GK]],["mobilenet_v4",["MobileNetV4Model",HK]],["maskformer",["MaskFormerModel",C7]],["mgp-str",["MgpstrForSceneTextRecognition",RK]],["style_text_to_speech_2",["StyleTextToSpeech2Model",k9]]]),rV=new Map([["t5",["T5Model",y6]],["longt5",["LongT5Model",Q4]],["mt5",["MT5Model",IJ]],["bart",["BartModel",M6]],["mbart",["MBartModel",r4]],["marian",["MarianModel",t7]],["whisper",["WhisperModel",j8]],["m2m_100",["M2M100Model",J9]],["blenderbot",["BlenderbotModel",d6]],["blenderbot-small",["BlenderbotSmallModel",vJ]]]),eV=new Map([["mimi",["MimiModel",MK]],["dac",["DacModel",yK]],["snac",["SnacModel",bK]]]),nV=new Map([["bloom",["BloomModel",YW]],["jais",["JAISModel",t8]],["gpt2",["GPT2Model",s8]],["gptj",["GPTJModel",WQ]],["gpt_bigcode",["GPTBigCodeModel",YQ]],["gpt_neo",["GPTNeoModel",JQ]],["gpt_neox",["GPTNeoXModel",ZQ]],["codegen",["CodeGenModel",XQ]],["llama",["LlamaModel",HQ]],["nanochat",["NanoChatModel",zQ]],["arcee",["ArceeModel",LQ]],["lfm2",["Lfm2Model",BQ]],["smollm3",["SmolLM3Model",FQ]],["exaone",["ExaoneModel",CQ]],["olmo",["OlmoModel",_Q]],["olmo2",["Olmo2Model",xQ]],["mobilellm",["MobileLLMModel",MQ]],["granite",["GraniteModel",vQ]],["granitemoehybrid",["GraniteMoeHybridModel",bQ]],["cohere",["CohereModel",fQ]],["gemma",["GemmaModel",uQ]],["gemma2",["Gemma2Model",lQ]],["vaultgemma",["VaultGemmaModel",mQ]],["gemma3_text",["Gemma3Model",pQ]],["helium",["HeliumModel",IQ]],["glm",["GlmModel",jQ]],["openelm",["OpenELMModel",eQ]],["qwen2",["Qwen2Model",sQ]],["qwen3",["Qwen3Model",tQ]],["phi",["PhiModel",ZW]],["phi3",["Phi3Model",WW]],["mpt",["MptModel",XW]],["opt",["OPTModel",HW]],["mistral",["MistralModel",h9]],["ernie4_5",["Ernie4_5_Model",d9]],["starcoder2",["Starcoder2Model",g9]],["falcon",["FalconModel",c9]],["stablelm",["StableLmModel",i9]],["modernbert-decoder",["ModernBertDecoderModel",W6]]]),dK=new Map([["speecht5",["SpeechT5ForSpeechToText",x9]],["whisper",["WhisperForConditionalGeneration",n5]],["lite-whisper",["LiteWhisperForConditionalGeneration",P8]],["moonshine",["MoonshineForConditionalGeneration",C8]]]),cY=new Map([["speecht5",["SpeechT5ForTextToSpeech",y9]]]),mY=new Map([["vits",["VitsModel",RZ]],["musicgen",["MusicgenForConditionalGeneration",wZ]]]),aY=new Map([["bert",["BertForSequenceClassification",E0]],["neobert",["NeoBertForSequenceClassification",u0]],["modernbert",["ModernBertForSequenceClassification",a0]],["roformer",["RoFormerForSequenceClassification",DJ]],["electra",["ElectraForSequenceClassification",f]],["esm",["EsmForSequenceClassification",Y4]],["convbert",["ConvBertForSequenceClassification",KJ]],["camembert",["CamembertForSequenceClassification",v0]],["deberta",["DebertaForSequenceClassification",F4]],["deberta-v2",["DebertaV2ForSequenceClassification",O4]],["mpnet",["MPNetForSequenceClassification",yJ]],["albert",["AlbertForSequenceClassification",f0]],["distilbert",["DistilBertForSequenceClassification",x4]],["roberta",["RobertaForSequenceClassification",q8]],["xlm",["XLMForSequenceClassification",z8]],["xlm-roberta",["XLMRobertaForSequenceClassification",R8]],["bart",["BartForSequenceClassification",N4]],["mbart",["MBartForSequenceClassification",h4]],["mobilebert",["MobileBertForSequenceClassification",VJ]],["squeezebert",["SqueezeBertForSequenceClassification",$0]]]),pY=new Map([["bert",["BertForTokenClassification",X0]],["neobert",["NeoBertForTokenClassification",b0]],["modernbert",["ModernBertForTokenClassification",n0]],["roformer",["RoFormerForTokenClassification",TJ]],["electra",["ElectraForTokenClassification",r]],["esm",["EsmForTokenClassification",P0]],["convbert",["ConvBertForTokenClassification",H6]],["camembert",["CamembertForTokenClassification",U6]],["deberta",["DebertaForTokenClassification",Z4]],["deberta-v2",["DebertaV2ForTokenClassification",GJ]],["mpnet",["MPNetForTokenClassification",oJ]],["distilbert",["DistilBertForTokenClassification",XJ]],["roberta",["RobertaForTokenClassification",H8]],["xlm",["XLMForTokenClassification",E8]],["xlm-roberta",["XLMRobertaForTokenClassification",F8]]]),uK=new Map([["t5",["T5ForConditionalGeneration",r6]],["longt5",["LongT5ForConditionalGeneration",e6]],["mt5",["MT5ForConditionalGeneration",G4]],["bart",["BartForConditionalGeneration",n6]],["mbart",["MBartForConditionalGeneration",W4]],["marian",["MarianMTModel",o7]],["m2m_100",["M2M100ForConditionalGeneration",$9]],["blenderbot",["BlenderbotForConditionalGeneration",u6]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",L5]]]),gK=new Map([["bloom",["BloomForCausalLM",GW]],["gpt2",["GPT2LMHeadModel",i8]],["jais",["JAISLMHeadModel",o8]],["gptj",["GPTJForCausalLM",KQ]],["gpt_bigcode",["GPTBigCodeForCausalLM",GQ]],["gpt_neo",["GPTNeoForCausalLM",$Q]],["gpt_neox",["GPTNeoXForCausalLM",QQ]],["codegen",["CodeGenForCausalLM",qQ]],["llama",["LlamaForCausalLM",VQ]],["nanochat",["NanoChatForCausalLM",EQ]],["llama4_text",["Llama4ForCausalLM",NQ]],["arcee",["ArceeForCausalLM",AQ]],["lfm2",["Lfm2ForCausalLM",RQ]],["smollm3",["SmolLM3ForCausalLM",DQ]],["exaone",["ExaoneForCausalLM",SQ]],["olmo",["OlmoForCausalLM",kQ]],["olmo2",["Olmo2ForCausalLM",yQ]],["mobilellm",["MobileLLMForCausalLM",TQ]],["granite",["GraniteForCausalLM",OQ]],["granitemoehybrid",["GraniteMoeHybridForCausalLM",hQ]],["cohere",["CohereForCausalLM",dQ]],["gemma",["GemmaForCausalLM",gQ]],["gemma2",["Gemma2ForCausalLM",cQ]],["vaultgemma",["VaultGemmaForCausalLM",aQ]],["gemma3_text",["Gemma3ForCausalLM",rQ]],["helium",["HeliumForCausalLM",wQ]],["glm",["GlmForCausalLM",PQ]],["openelm",["OpenELMForCausalLM",nQ]],["qwen2",["Qwen2ForCausalLM",iQ]],["qwen3",["Qwen3ForCausalLM",oQ]],["phi",["PhiForCausalLM",QW]],["phi3",["Phi3ForCausalLM",KW]],["mpt",["MptForCausalLM",qW]],["opt",["OPTForCausalLM",VW]],["mbart",["MBartForCausalLM",s6]],["mistral",["MistralForCausalLM",f9]],["ernie4_5",["Ernie4_5_ForCausalLM",u9]],["starcoder2",["Starcoder2ForCausalLM",l9]],["falcon",["FalconForCausalLM",m9]],["trocr",["TrOCRForCausalLM",b9]],["stablelm",["StableLmForCausalLM",t9]],["modernbert-decoder",["ModernBertDecoderForCausalLM",a6]],["phi3_v",["Phi3VForCausalLM",$$]]]),sV=new Map([["multi_modality",["MultiModalityCausalLM",LK]]]),rY=new Map([["bert",["BertForMaskedLM",Y0]],["neobert",["NeoBertForMaskedLM",V0]],["modernbert",["ModernBertForMaskedLM",i0]],["roformer",["RoFormerForMaskedLM",o6]],["electra",["ElectraForMaskedLM",C]],["esm",["EsmForMaskedLM",HJ]],["convbert",["ConvBertForMaskedLM",WJ]],["camembert",["CamembertForMaskedLM",t0]],["deberta",["DebertaForMaskedLM",U4]],["deberta-v2",["DebertaV2ForMaskedLM",l4]],["mpnet",["MPNetForMaskedLM",xJ]],["albert",["AlbertForMaskedLM",L6]],["distilbert",["DistilBertForMaskedLM",m4]],["roberta",["RobertaForMaskedLM",X8]],["xlm",["XLMWithLMHeadModel",N8]],["xlm-roberta",["XLMRobertaForMaskedLM",B8]],["mobilebert",["MobileBertForMaskedLM",P6]],["squeezebert",["SqueezeBertForMaskedLM",s]]]),eY=new Map([["bert",["BertForQuestionAnswering",F0]],["neobert",["NeoBertForQuestionAnswering",s0]],["roformer",["RoFormerForQuestionAnswering",_J]],["electra",["ElectraForQuestionAnswering",G0]],["convbert",["ConvBertForQuestionAnswering",YJ]],["camembert",["CamembertForQuestionAnswering",E6]],["deberta",["DebertaForQuestionAnswering",p6]],["deberta-v2",["DebertaV2ForQuestionAnswering",c4]],["mpnet",["MPNetForQuestionAnswering",V]],["albert",["AlbertForQuestionAnswering",_0]],["distilbert",["DistilBertForQuestionAnswering",qJ]],["roberta",["RobertaForQuestionAnswering",V8]],["xlm",["XLMForQuestionAnswering",L8]],["xlm-roberta",["XLMRobertaForQuestionAnswering",D8]],["mobilebert",["MobileBertForQuestionAnswering",p4]],["squeezebert",["SqueezeBertForQuestionAnswering",U0]]]),lK=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",i5]],["idefics3",["Idefics3ForConditionalGeneration",B5]],["smolvlm",["SmolVLMForConditionalGeneration",J$]]]),nY=new Map([["llava",["LlavaForConditionalGeneration",A5]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",S8]],["moondream1",["Moondream1ForConditionalGeneration",M8]],["florence2",["Florence2ForConditionalGeneration",_8]],["qwen2-vl",["Qwen2VLForConditionalGeneration",$W]],["idefics3",["Idefics3ForConditionalGeneration",B5]],["smolvlm",["SmolVLMForConditionalGeneration",J$]],["paligemma",["PaliGemmaForConditionalGeneration",x8]],["llava_qwen2",["LlavaQwen2ForCausalLM",y8]],["gemma3n",["Gemma3nForConditionalGeneration",o5]]]),sY=new Map([["ultravox",["UltravoxModel",CZ]],["voxtral",["VoxtralForConditionalGeneration",PK]]]),iV=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",i5]]]),iY=new Map([["vit",["ViTForImageClassification",NW]],["ijepa",["IJepaForImageClassification",EW]],["pvt",["PvtForImageClassification",RW]],["vit_msn",["ViTMSNForImageClassification",wW]],["fastvit",["FastViTForImageClassification",SW]],["mobilevit",["MobileViTForImageClassification",kW]],["mobilevitv2",["MobileViTV2ForImageClassification",yW]],["beit",["BeitForImageClassification",dW]],["deit",["DeiTForImageClassification",Q7]],["hiera",["HieraForImageClassification",K7]],["convnext",["ConvNextForImageClassification",y7]],["convnextv2",["ConvNextV2ForImageClassification",O7]],["dinov2",["Dinov2ForImageClassification",h7]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",d7]],["resnet",["ResNetForImageClassification",G7]],["swin",["SwinForImageClassification",q7]],["segformer",["SegformerForImageClassification",n9]],["efficientnet",["EfficientNetForImageClassification",JK]],["mobilenet_v1",["MobileNetV1ForImageClassification",ZK]],["mobilenet_v2",["MobileNetV2ForImageClassification",KK]],["mobilenet_v3",["MobileNetV3ForImageClassification",XK]],["mobilenet_v4",["MobileNetV4ForImageClassification",VK]]]),tY=new Map([["detr",["DetrForObjectDetection",gW]],["rt_detr",["RTDetrForObjectDetection",mW]],["rt_detr_v2",["RTDetrV2ForObjectDetection",pW]],["rf_detr",["RFDetrForObjectDetection",nW]],["d_fine",["DFineForObjectDetection",tW]],["table-transformer",["TableTransformerForObjectDetection",J7]],["yolos",["YolosForObjectDetection",r7]]]),oY=new Map([["owlvit",["OwlViTForObjectDetection",OW]],["owlv2",["Owlv2ForObjectDetection",hW]],["grounding-dino",["GroundingDinoForObjectDetection",a7]]]),Z5=new Map([["detr",["DetrForSegmentation",r$]],["clipseg",["CLIPSegForImageSegmentation",n8]]]),JG=new Map([["segformer",["SegformerForSemanticSegmentation",s9]],["sapiens",["SapiensForSemanticSegmentation",A7]],["swin",["SwinForSemanticSegmentation",H7]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",QK]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",YK]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",qK]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",UK]]]),$G=new Map([["detr",["DetrForSegmentation",r$]],["maskformer",["MaskFormerForInstanceSegmentation",S7]]]),ZG=new Map([["sam",["SamModel",s7]]]),QG=new Map([["wav2vec2",["Wav2Vec2ForCTC",Q9]],["wav2vec2-bert",["Wav2Vec2BertForCTC",F9]],["unispeech",["UniSpeechForCTC",N9]],["unispeech-sat",["UniSpeechSatForCTC",L9]],["wavlm",["WavLMForCTC",C9]],["hubert",["HubertForCTC",w9]],["parakeet_ctc",["ParakeetForCTC",G9]]]),WG=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",W9]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",D9]],["unispeech",["UniSpeechForSequenceClassification",z9]],["unispeech-sat",["UniSpeechSatForSequenceClassification",A9]],["wavlm",["WavLMForSequenceClassification",S9]],["hubert",["HubertForSequenceClassification",j9]],["audio-spectrogram-transformer",["ASTForAudioClassification",w8]]]),KG=new Map([["wavlm",["WavLMForXVector",M9]]]),YG=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",B9]],["wavlm",["WavLMForAudioFrameClassification",T9]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",K9]],["pyannote",["PyAnnoteForAudioFrameClassification",q9]]]),GG=new Map([["vitmatte",["VitMatteForImageMatting",TW]]]),tV=new Map([["patchtst",["PatchTSTForPrediction",DK]],["patchtsmixer",["PatchTSMixerForPrediction",wK]]]),XG=new Map([["swin2sr",["Swin2SRForImageSuperResolution",U7]]]),qG=new Map([["dpt",["DPTForDepthEstimation",z7]],["depth_anything",["DepthAnythingForDepthEstimation",L7]],["glpn",["GLPNForDepthEstimation",T7]],["sapiens",["SapiensForDepthEstimation",B7]],["depth_pro",["DepthProForDepthEstimation",D7]],["metric3d",["Metric3DForDepthEstimation",w7]],["metric3dv2",["Metric3Dv2ForDepthEstimation",P7]]]),HG=new Map([["sapiens",["SapiensForNormalEstimation",R7]]]),VG=new Map([["vitpose",["VitPoseForPoseEstimation",AW]]]),UG=new Map([["clip",["CLIPVisionModelWithProjection",d8]],["siglip",["SiglipVisionModel",l8]],["jina_clip",["JinaCLIPVisionModel",r8]]]),NG=[[pV,A.EncoderOnly],[rV,A.EncoderDecoder],[nV,A.DecoderOnly],[eV,A.AutoEncoder],[aY,A.EncoderOnly],[pY,A.EncoderOnly],[uK,A.Seq2Seq],[dK,A.Seq2Seq],[gK,A.DecoderOnly],[sV,A.MultiModality],[rY,A.EncoderOnly],[eY,A.EncoderOnly],[lK,A.Vision2Seq],[nY,A.ImageTextToText],[sY,A.AudioTextToText],[iY,A.EncoderOnly],[Z5,A.EncoderOnly],[$G,A.EncoderOnly],[JG,A.EncoderOnly],[GG,A.EncoderOnly],[tV,A.EncoderOnly],[XG,A.EncoderOnly],[qG,A.EncoderOnly],[HG,A.EncoderOnly],[VG,A.EncoderOnly],[tY,A.EncoderOnly],[oY,A.EncoderOnly],[ZG,A.MaskGeneration],[QG,A.EncoderOnly],[WG,A.EncoderOnly],[cY,A.Seq2Seq],[mY,A.EncoderOnly],[KG,A.EncoderOnly],[YG,A.EncoderOnly],[UG,A.EncoderOnly]];for(let[X,M]of NG)for(let[e,J0]of X.values())T.set(e,M),R.set(J0,e),B.set(e,J0);let oV=[["MusicgenForConditionalGeneration",wZ,A.Musicgen],["Phi3VForCausalLM",$$,A.Phi3V],["CLIPTextModelWithProjection",f8,A.EncoderOnly],["SiglipTextModel",g8,A.EncoderOnly],["JinaCLIPTextModel",p8,A.EncoderOnly],["ClapTextModelWithProjection",p9,A.EncoderOnly],["ClapAudioModelWithProjection",r9,A.EncoderOnly],["DacEncoderModel",vK,A.EncoderOnly],["DacDecoderModel",OK,A.EncoderOnly],["MimiEncoderModel",TK,A.EncoderOnly],["MimiDecoderModel",_K,A.EncoderOnly],["SnacEncoderModel",hK,A.EncoderOnly],["SnacDecoderModel",fK,A.EncoderOnly],["Gemma3nForConditionalGeneration",o5,A.ImageAudioTextToText]];for(let[X,M,e]of oV)T.set(X,e),R.set(M,X),B.set(X,M);let zG=new Map([["modnet",Z5],["birefnet",Z5],["isnet",Z5],["ben",Z5]]);for(let[X,M]of zG.entries())M.set(X,["PreTrainedModel",S]),T.set(X,A.EncoderOnly),R.set(S,X),B.set(X,S);class EG extends R6{static MODEL_CLASS_MAPPINGS=NG.map((X)=>X[0]);static BASE_IF_FAIL=!0}class LG extends R6{static MODEL_CLASS_MAPPINGS=[aY]}class AG extends R6{static MODEL_CLASS_MAPPINGS=[pY]}class BG extends R6{static MODEL_CLASS_MAPPINGS=[uK]}class RG extends R6{static MODEL_CLASS_MAPPINGS=[dK]}class FG extends R6{static MODEL_CLASS_MAPPINGS=[cY]}class DG extends R6{static MODEL_CLASS_MAPPINGS=[mY]}class IG extends R6{static MODEL_CLASS_MAPPINGS=[gK]}class wG extends R6{static MODEL_CLASS_MAPPINGS=[rY]}class jG extends R6{static MODEL_CLASS_MAPPINGS=[eY]}class PG extends R6{static MODEL_CLASS_MAPPINGS=[lK]}class CG extends R6{static MODEL_CLASS_MAPPINGS=[iY]}class SG extends R6{static MODEL_CLASS_MAPPINGS=[Z5]}class MG extends R6{static MODEL_CLASS_MAPPINGS=[JG]}class TG extends R6{static MODEL_CLASS_MAPPINGS=[$G]}class _G extends R6{static MODEL_CLASS_MAPPINGS=[tY]}class kG extends R6{static MODEL_CLASS_MAPPINGS=[oY]}class xG extends R6{static MODEL_CLASS_MAPPINGS=[ZG]}class yG extends R6{static MODEL_CLASS_MAPPINGS=[QG]}class vG extends R6{static MODEL_CLASS_MAPPINGS=[WG]}class OG extends R6{static MODEL_CLASS_MAPPINGS=[KG]}class bG extends R6{static MODEL_CLASS_MAPPINGS=[YG]}class hG extends R6{static MODEL_CLASS_MAPPINGS=[iV]}class fG extends R6{static MODEL_CLASS_MAPPINGS=[GG]}class dG extends R6{static MODEL_CLASS_MAPPINGS=[XG]}class uG extends R6{static MODEL_CLASS_MAPPINGS=[qG]}class gG extends R6{static MODEL_CLASS_MAPPINGS=[HG]}class lG extends R6{static MODEL_CLASS_MAPPINGS=[VG]}class cG extends R6{static MODEL_CLASS_MAPPINGS=[UG]}class mG extends R6{static MODEL_CLASS_MAPPINGS=[nY]}class aG extends R6{static MODEL_CLASS_MAPPINGS=[sY]}class pG extends W0{constructor({logits:X,past_key_values:M,encoder_outputs:e,decoder_attentions:J0=null,cross_attentions:q0=null}){super();this.logits=X,this.past_key_values=M,this.encoder_outputs=e,this.decoder_attentions=J0,this.cross_attentions=q0}}class q6 extends W0{constructor({logits:X,...M}){super();this.logits=X;let e=Object.values(M);if(e.length>0)this.attentions=e}}class cK extends W0{constructor({logits:X,embeddings:M}){super();this.logits=X,this.embeddings=M}}class g6 extends W0{constructor({logits:X}){super();this.logits=X}}class c6 extends W0{constructor({logits:X}){super();this.logits=X}}class J4 extends W0{constructor({start_logits:X,end_logits:M}){super();this.start_logits=X,this.end_logits=M}}class NJ extends W0{constructor({logits:X}){super();this.logits=X}}class rG extends W0{constructor({logits:X,past_key_values:M}){super();this.logits=X,this.past_key_values=M}}class mK extends W0{constructor({alphas:X}){super();this.alphas=X}}class aK extends W0{constructor({waveform:X,spectrogram:M}){super();this.waveform=X,this.spectrogram=M}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(J,Z,$)=>{/*!******************************************************************************************************!*\
  !*** ./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js ***!
  \******************************************************************************************************/$.r(Z),$.d(Z,{ASTFeatureExtractor:()=>H});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends Q.FeatureExtractor{constructor(G){super(G);let q=this.config.sampling_rate,z=(0,Y.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(q/2),q,null,"kaldi",!0);this.mel_filters=z,this.window=(0,Y.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(G,q){return(0,Y.spectrogram)(G,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:0.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:0.0000001192092955078125,remove_dc_offset:!0,max_num_frames:q,transpose:!0})}async _call(G){(0,Q.validate_audio_inputs)(G,"ASTFeatureExtractor");let q=await this._extract_fbank_features(G,this.config.max_length);if(this.config.do_normalize){let z=this.std*2,U=q.data;for(let N=0;N<U.length;++N)U[N]=(U[N]-this.mean)/z}return{input_values:q.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/auto/feature_extraction_auto.js ***!
  \****************************************************/$.r(Z),$.d(Z,{AutoFeatureExtractor:()=>G});var Q=$("./src/utils/constants.js");/*! ../../utils/constants.js */var W=$("./src/utils/hub.js");/*! ../../utils/hub.js */var Y=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var H=$("./src/models/feature_extractors.js");/*! ../feature_extractors.js */class G{static async from_pretrained(q,z={}){let U=await(0,W.getModelJSON)(q,Q.FEATURE_EXTRACTOR_NAME,!0,z),N=U.feature_extractor_type,L=H[N];if(!L)throw Error(`Unknown feature_extractor_type: '${N}'. Please report this at ${Q.GITHUB_ISSUE_URL}.`);return new L(U)}}},"./src/models/auto/image_processing_auto.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/auto/image_processing_auto.js ***!
  \**************************************************/$.r(Z),$.d(Z,{AutoImageProcessor:()=>G});var Q=$("./src/utils/constants.js");/*! ../../utils/constants.js */var W=$("./src/utils/hub.js");/*! ../../utils/hub.js */var Y=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var H=$("./src/models/image_processors.js");/*! ../image_processors.js */class G{static async from_pretrained(q,z={}){let U=await(0,W.getModelJSON)(q,Q.IMAGE_PROCESSOR_NAME,!0,z),N=U.image_processor_type??U.feature_extractor_type,L=H[N?.replace(/Fast$/,"")];if(!L){if(N!==void 0)console.warn(`Image processor type '${N}' not found, assuming base ImageProcessor. Please report this at ${Q.GITHUB_ISSUE_URL}.`);L=Y.ImageProcessor}return new L(U)}}},"./src/models/auto/processing_auto.js":(J,Z,$)=>{/*!********************************************!*\
  !*** ./src/models/auto/processing_auto.js ***!
  \********************************************/$.r(Z),$.d(Z,{AutoProcessor:()=>z});var Q=$("./src/utils/constants.js");/*! ../../utils/constants.js */var W=$("./src/utils/hub.js");/*! ../../utils/hub.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var H=$("./src/models/processors.js");/*! ../processors.js */var G=$("./src/models/image_processors.js");/*! ../image_processors.js */var q=$("./src/models/feature_extractors.js");/*! ../feature_extractors.js */class z{static async from_pretrained(U,N={}){let L=await(0,W.getModelJSON)(U,Q.IMAGE_PROCESSOR_NAME,!0,N),{image_processor_type:w,feature_extractor_type:F,processor_class:v}=L;if(v&&H[v])return H[v].from_pretrained(U,N);if(!w&&!F)throw Error("No `image_processor_type` or `feature_extractor_type` found in the config.");let I={};if(w){let y=G[w.replace(/Fast$/,"")];if(!y)throw Error(`Unknown image_processor_type: '${w}'.`);I.image_processor=new y(L)}if(F){let y=G[F];if(y)I.image_processor=new y(L);else{let g=q[F];if(!g)throw Error(`Unknown feature_extractor_type: '${F}'.`);I.feature_extractor=new g(L)}}let j={};return new Y.Processor(j,I,null)}}},"./src/models/beit/image_processing_beit.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/beit/image_processing_beit.js ***!
  \**************************************************/$.r(Z),$.d(Z,{BeitFeatureExtractor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/bit/image_processing_bit.js ***!
  \************************************************/$.r(Z),$.d(Z,{BitImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/chinese_clip/image_processing_chinese_clip.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{ChineseCLIPFeatureExtractor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/clap/feature_extraction_clap.js ***!
  \****************************************************/$.r(Z),$.d(Z,{ClapFeatureExtractor:()=>H});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends Q.FeatureExtractor{constructor(G){super(G);this.mel_filters=(0,Y.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,Y.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,Y.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(G,q,z,U){let N,L=!1,w=G.length-q;if(w>0)if(z==="rand_trunc"){L=!0;let F=Math.floor(Math.random()*(w+1));G=G.subarray(F,F+q),N=await this._extract_fbank_features(G,this.mel_filters_slaney,this.config.nb_max_samples)}else throw Error(`Truncation strategy "${z}" not implemented`);else{if(w<0){let F=new Float64Array(q);if(F.set(G),U==="repeat")for(let v=G.length;v<q;v+=G.length)F.set(G.subarray(0,Math.min(G.length,q-v)),v);else if(U==="repeatpad")for(let v=G.length;v<-w;v+=G.length)F.set(G,v);G=F}if(z==="fusion")throw Error(`Truncation strategy "${z}" not implemented`);N=await this._extract_fbank_features(G,this.mel_filters_slaney,this.config.nb_max_samples)}return N.unsqueeze_(0)}async _extract_fbank_features(G,q,z=null){return(0,Y.spectrogram)(G,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:q,log_mel:"dB",max_num_frames:z,do_pad:!1,transpose:!0})}async _call(G,{max_length:q=null}={}){return(0,Q.validate_audio_inputs)(G,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(G,q??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/clip/image_processing_clip.js ***!
  \**************************************************/$.r(Z),$.d(Z,{CLIPFeatureExtractor:()=>Y,CLIPImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/convnext/image_processing_convnext.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/convnext/image_processing_convnext.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{ConvNextFeatureExtractor:()=>Y,ConvNextImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{constructor(H){super(H);this.crop_pct=this.config.crop_pct??0.875}async resize(H){let G=this.size?.shortest_edge;if(G===void 0)throw Error("Size dictionary must contain 'shortest_edge' key.");if(G<384){let q=Math.floor(G/this.crop_pct),[z,U]=this.get_resize_output_image_size(H,{shortest_edge:q});H=await H.resize(z,U,{resample:this.resample}),H=await H.center_crop(G,G)}else H=await H.resize(G,G,{resample:this.resample});return H}}class Y extends W{}},"./src/models/dac/feature_extraction_dac.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/dac/feature_extraction_dac.js ***!
  \**************************************************/$.r(Z),$.d(Z,{DacFeatureExtractor:()=>W});var Q=$("./src/models/encodec/feature_extraction_encodec.js");/*! ../encodec/feature_extraction_encodec.js */class W extends Q.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/deit/image_processing_deit.js ***!
  \**************************************************/$.r(Z),$.d(Z,{DeiTFeatureExtractor:()=>Y,DeiTImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/detr/image_processing_detr.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/detr/image_processing_detr.js ***!
  \**************************************************/$.r(Z),$.d(Z,{DetrFeatureExtractor:()=>H,DetrImageProcessor:()=>Y});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.ImageProcessor{async _call(G){let q=await super._call(G),z=[q.pixel_values.dims[0],64,64],U=(0,W.full)(z,1n);return{...q,pixel_mask:U}}post_process_object_detection(...G){return(0,Q.post_process_object_detection)(...G)}post_process_panoptic_segmentation(...G){return(0,Q.post_process_panoptic_segmentation)(...G)}post_process_instance_segmentation(...G){return(0,Q.post_process_instance_segmentation)(...G)}}class H extends Y{}},"./src/models/dinov3_vit/image_processing_dinov3_vit.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/dinov3_vit/image_processing_dinov3_vit.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{DINOv3ViTImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/donut/image_processing_donut.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/donut/image_processing_donut.js ***!
  \****************************************************/$.r(Z),$.d(Z,{DonutFeatureExtractor:()=>Y,DonutImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{pad_image(H,G,q,z={}){let[U,N,L]=G,w=this.image_mean;if(!Array.isArray(this.image_mean))w=Array(L).fill(w);let F=this.image_std;if(!Array.isArray(F))F=Array(L).fill(w);let v=w.map((I,j)=>-I/F[j]);return super.pad_image(H,G,q,{center:!0,constant_values:v,...z})}}class Y extends W{}},"./src/models/dpt/image_processing_dpt.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/dpt/image_processing_dpt.js ***!
  \************************************************/$.r(Z),$.d(Z,{DPTFeatureExtractor:()=>Y,DPTImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/efficientnet/image_processing_efficientnet.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/efficientnet/image_processing_efficientnet.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{EfficientNetImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{constructor(Y){super(Y);if(this.include_top=this.config.include_top??!0,this.include_top)this.image_std=this.image_std.map((H)=>H*H)}}},"./src/models/encodec/feature_extraction_encodec.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/encodec/feature_extraction_encodec.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{EncodecFeatureExtractor:()=>Y});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.FeatureExtractor{async _call(H){if((0,Q.validate_audio_inputs)(H,"EncodecFeatureExtractor"),H instanceof Float64Array)H=new Float32Array(H);let G=this.config.feature_size;if(H.length%G!==0)throw Error(`The length of the audio data must be a multiple of the number of channels (${G}).`);let q=[1,G,H.length/G];return{input_values:new W.Tensor("float32",H,q)}}}},"./src/models/feature_extractors.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/models/feature_extractors.js ***!
  \******************************************/$.r(Z),$.d(Z,{ASTFeatureExtractor:()=>Q.ASTFeatureExtractor,ClapFeatureExtractor:()=>Y.ClapFeatureExtractor,DacFeatureExtractor:()=>H.DacFeatureExtractor,EncodecFeatureExtractor:()=>W.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>G.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>j.ImageProcessor,MoonshineFeatureExtractor:()=>q.MoonshineFeatureExtractor,ParakeetFeatureExtractor:()=>z.ParakeetFeatureExtractor,PyAnnoteFeatureExtractor:()=>U.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>N.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>L.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>w.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>F.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>v.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>I.WhisperFeatureExtractor});var Q=$("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js");/*! ./audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js */var W=$("./src/models/encodec/feature_extraction_encodec.js");/*! ./encodec/feature_extraction_encodec.js */var Y=$("./src/models/clap/feature_extraction_clap.js");/*! ./clap/feature_extraction_clap.js */var H=$("./src/models/dac/feature_extraction_dac.js");/*! ./dac/feature_extraction_dac.js */var G=$("./src/models/gemma3n/feature_extraction_gemma3n.js");/*! ./gemma3n/feature_extraction_gemma3n.js */var q=$("./src/models/moonshine/feature_extraction_moonshine.js");/*! ./moonshine/feature_extraction_moonshine.js */var z=$("./src/models/parakeet/feature_extraction_parakeet.js");/*! ./parakeet/feature_extraction_parakeet.js */var U=$("./src/models/pyannote/feature_extraction_pyannote.js");/*! ./pyannote/feature_extraction_pyannote.js */var N=$("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js");/*! ./seamless_m4t/feature_extraction_seamless_m4t.js */var L=$("./src/models/snac/feature_extraction_snac.js");/*! ./snac/feature_extraction_snac.js */var w=$("./src/models/speecht5/feature_extraction_speecht5.js");/*! ./speecht5/feature_extraction_speecht5.js */var F=$("./src/models/wav2vec2/feature_extraction_wav2vec2.js");/*! ./wav2vec2/feature_extraction_wav2vec2.js */var v=$("./src/models/wespeaker/feature_extraction_wespeaker.js");/*! ./wespeaker/feature_extraction_wespeaker.js */var I=$("./src/models/whisper/feature_extraction_whisper.js");/*! ./whisper/feature_extraction_whisper.js */var j=$("./src/base/image_processors_utils.js");/*! ../base/image_processors_utils.js */},"./src/models/florence2/processing_florence2.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/florence2/processing_florence2.js ***!
  \******************************************************/$.r(Z),$.d(Z,{Florence2Processor:()=>H});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor;constructor(G,q,z){super(G,q,z);let{tasks_answer_post_processing_type:U,task_prompts_without_inputs:N,task_prompts_with_input:L}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(U??{})),this.task_prompts_without_inputs=new Map(Object.entries(N??{})),this.task_prompts_with_input=new Map(Object.entries(L??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1000}construct_prompts(G){if(typeof G==="string")G=[G];let q=[];for(let z of G)if(this.task_prompts_without_inputs.has(z))q.push(this.task_prompts_without_inputs.get(z));else{for(let[U,N]of this.task_prompts_with_input)if(z.includes(U)){q.push(N.replaceAll("{input}",z).replaceAll(U,""));break}if(q.length!==G.length)q.push(z)}return q}post_process_generation(G,q,z){let U=this.tasks_answer_post_processing_type.get(q)??"pure_text";G=G.replaceAll("<s>","").replaceAll("</s>","");let N;switch(U){case"pure_text":N=G;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":let L=U==="ocr"?"quad_boxes":"bboxes",w=G.matchAll(this.regexes[L]),F=[],v=[];for(let[I,j,...y]of w)F.push(j?j.trim():F.at(-1)??""),v.push(y.map((g,A)=>(Number(g)+0.5)/this.size_per_bin*z[A%2]));N={labels:F,[L]:v};break;default:throw Error(`Task "${q}" (of type "${U}") not yet implemented.`)}return{[q]:N}}async _call(G,q=null,z={}){if(!G&&!q)throw Error("Either text or images must be provided");let U=await this.image_processor(G,z),N=q?this.tokenizer(this.construct_prompts(q),z):{};return{...U,...N}}}},"./src/models/gemma3n/feature_extraction_gemma3n.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/gemma3n/feature_extraction_gemma3n.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{Gemma3nAudioFeatureExtractor:()=>H});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends Q.FeatureExtractor{constructor(G){super(G);let{fft_length:q,feature_size:z,min_frequency:U,max_frequency:N,sampling_rate:L,frame_length:w}=this.config,F=(0,Y.mel_filter_bank)(Math.floor(1+q/2),z,U,N,L,null,"htk",!1);this.mel_filters=F,this.window=(0,Y.window_function)(w,"hann")}async _extract_fbank_features(G,q){return(0,Y.spectrogram)(G,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(G,{max_length:q=480000,truncation:z=!0,padding:U=!0,pad_to_multiple_of:N=128}={}){if((0,Q.validate_audio_inputs)(G,"Gemma3nAudioFeatureExtractor"),z&&G.length>q)G=G.slice(0,q);if(U&&G.length%N!==0){let F=N-G.length%N,v=new Float64Array(G.length+F);if(v.set(G),this.config.padding_value!==0)v.fill(this.config.padding_value,G.length);G=v}let L=await this._extract_fbank_features(G,this.config.max_length),w=(0,W.full)([1,L.dims[0]],!0);return{input_features:L.unsqueeze_(0),input_features_mask:w}}}},"./src/models/gemma3n/processing_gemma3n.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/gemma3n/processing_gemma3n.js ***!
  \**************************************************/$.r(Z),$.d(Z,{Gemma3nProcessor:()=>z});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var H=$("./src/tokenizers.js");/*! ../../tokenizers.js */var G=$("./src/utils/image.js");/*! ../../utils/image.js */var q=$("./src/utils/audio.js");/*! ../../utils/audio.js */class z extends Q.Processor{static image_processor_class=W.AutoImageProcessor;static feature_extractor_class=Y.AutoFeatureExtractor;static tokenizer_class=H.AutoTokenizer;static uses_processor_config=!0;static uses_chat_template_file=!0;constructor(U,N,L){super(U,N,L);this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;let{audio_token_id:w,boa_token:F,audio_token:v,eoa_token:I,image_token_id:j,boi_token:y,image_token:g,eoi_token:A}=this.tokenizer.config;this.audio_token_id=w,this.boa_token=F,this.audio_token=v;let T=v.repeat(this.audio_seq_length);this.full_audio_sequence=`

${F}${T}${I}

`,this.image_token_id=j,this.boi_token=y,this.image_token=g;let B=g.repeat(this.image_seq_length);this.full_image_sequence=`

${y}${B}${A}

`}async _call(U,N=null,L=null,w={}){if(typeof U==="string")U=[U];let F;if(L)F=await this.feature_extractor(L,w),U=U.map((j)=>j.replaceAll(this.audio_token,this.full_audio_sequence));let v;if(N)v=await this.image_processor(N,w),U=U.map((j)=>j.replaceAll(this.image_token,this.full_image_sequence));return{...this.tokenizer(U,w),...v,...F}}}},"./src/models/glpn/image_processing_glpn.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/glpn/image_processing_glpn.js ***!
  \**************************************************/$.r(Z),$.d(Z,{GLPNFeatureExtractor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(J,Z,$)=>{/*!**********************************************************************!*\
  !*** ./src/models/grounding_dino/image_processing_grounding_dino.js ***!
  \**********************************************************************/$.r(Z),$.d(Z,{GroundingDinoImageProcessor:()=>Y});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.ImageProcessor{async _call(H){let G=await super._call(H),q=G.pixel_values.dims,z=(0,W.ones)([q[0],q[2],q[3]]);return{...G,pixel_mask:z}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(J,Z,$)=>{/*!****************************************************************!*\
  !*** ./src/models/grounding_dino/processing_grounding_dino.js ***!
  \****************************************************************/$.r(Z),$.d(Z,{GroundingDinoProcessor:()=>q});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */function G(z,U){let L=z.dims.at(-1)-1,w=z.tolist();w.fill(!1,0,1),w.fill(!1,L);let F=U.tolist();return w.map((v,I)=>v?I:null).filter((v)=>v!==null).map((v)=>F[v])}class q extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor;async _call(z,U,N={}){let L=z?await this.image_processor(z,N):{};return{...U?this.tokenizer(U,N):{},...L}}post_process_grounded_object_detection(z,U,{box_threshold:N=0.25,text_threshold:L=0.25,target_sizes:w=null}={}){let{logits:F,pred_boxes:v}=z,I=F.dims[0];if(w!==null&&w.length!==I)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let j=F.dims.at(1),y=F.sigmoid(),g=y.max(-1).tolist(),A=v.tolist().map((B)=>B.map((R)=>(0,H.center_to_corners_format)(R))),T=[];for(let B=0;B<I;++B){let R=w!==null?w[B]:null;if(R!==null)A[B]=A[B].map((m)=>m.map((d,a)=>d*R[(a+1)%2]));let P=g[B],k=[],h=[],c=[];for(let m=0;m<j;++m){let d=P[m];if(d<=N)continue;let a=A[B][m],n=y[B][m];k.push(d),c.push(a);let t=G(n.gt(L),U[B]);h.push(t)}T.push({scores:k,boxes:c,labels:this.batch_decode(h)})}return T}}},"./src/models/idefics3/image_processing_idefics3.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/idefics3/image_processing_idefics3.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{Idefics3ImageProcessor:()=>Y});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.ImageProcessor{constructor(H){super(H);this.do_image_splitting=H.do_image_splitting??!0,this.max_image_size=H.max_image_size}get_resize_for_vision_encoder(H,G){let[q,z]=H.dims.slice(-2),U=z/q;if(z>=q)z=Math.ceil(z/G)*G,q=Math.floor(z/U),q=Math.ceil(q/G)*G;else q=Math.ceil(q/G)*G,z=Math.floor(q*U),z=Math.ceil(z/G)*G;return{height:q,width:z}}async _call(H,{do_image_splitting:G=null,return_row_col_info:q=!1}={}){let z;if(!Array.isArray(H))z=[[H]];else{if(H.length===0||!H[0])throw Error("No images provided.");if(!Array.isArray(H[0]))z=[H];else z=H}let U=[],N=[],L=[],w=[],F=[];for(let B of z){let R=await Promise.all(B.map((h)=>this.preprocess(h)));w.push(...R.map((h)=>h.original_size)),F.push(...R.map((h)=>h.reshaped_input_size)),R.forEach((h)=>h.pixel_values.unsqueeze_(0));let{longest_edge:P}=this.max_image_size,k;if(G??this.do_image_splitting){let h=Array(R.length),c=Array(R.length);k=await Promise.all(R.map(async(m,d)=>{let a=this.get_resize_for_vision_encoder(m.pixel_values,P),n=await(0,W.interpolate_4d)(m.pixel_values,{size:[a.height,a.width]}),{frames:t,num_splits_h:Q0,num_splits_w:o}=await this.split_image(n,this.max_image_size);return h[d]=Q0,c[d]=o,(0,W.cat)(t,0)})),N.push(h),L.push(c)}else{let h=[P,P];k=await Promise.all(R.map((c)=>(0,W.interpolate_4d)(c.pixel_values,{size:h}))),N.push(Array(R.length).fill(0)),L.push(Array(R.length).fill(0))}U.push((0,W.cat)(k,0))}let v=U.length,[I,j,y,g]=U[0].dims,A,T;if(v===1)A=U[0].unsqueeze_(0),T=(0,W.full)([v,I,y,g],!0);else{let B=Math.max(...U.map((k)=>k.dims.at(0)));T=(0,W.full)([v,B,y,g],!0);let R=T.data,P=B*y*g;for(let k=0;k<v;++k){let h=U[k].dims[0];if(h<B){U[k]=(0,W.cat)([U[k],(0,W.full)([B-h,j,y,g],0)],0);let c=k*P+h*y*g,m=(k+1)*P;R.fill(!1,c,m)}}A=(0,W.stack)(U,0)}return{pixel_values:A,pixel_attention_mask:T,original_sizes:w,reshaped_input_sizes:F,...q?{rows:N,cols:L}:{}}}async split_image(H,{longest_edge:G}){let q=G,z=G,U=[],[N,L]=H.dims.slice(-2),w=0,F=0;if(N>q||L>z){w=Math.ceil(N/q),F=Math.ceil(L/z);let v=Math.ceil(N/w),I=Math.ceil(L/F);for(let g=0;g<w;++g)for(let A=0;A<F;++A){let T,B,R,P;if(g===w-1)B=N-v,P=N;else B=g*v,P=(g+1)*v;if(A===F-1)T=L-I,R=L;else T=A*I,R=(A+1)*I;let k=[B,T],h=[P,R],c=await(0,W.slice)(H,k,h,[2,3]);U.push(c)}let j=q,y=z;if(N!==j||L!==y)H=await(0,W.interpolate_4d)(H,{size:[j,y]})}return U.push(H),{frames:U,num_splits_h:w,num_splits_w:F}}}},"./src/models/idefics3/processing_idefics3.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/idefics3/processing_idefics3.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Idefics3Processor:()=>N});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/image.js");/*! ../../utils/image.js */var G=$("./src/utils/core.js");/*! ../../utils/core.js */function q(L,w,F,v,I,j){let y="";for(let g=0;g<w;++g){for(let A=0;A<F;++A)y+=v+`<row_${g+1}_col_${A+1}>`+I.repeat(L);y+=`
`}return y+=`
${v}${j}`+I.repeat(L)+`${v}`,y}function z(L,w,F,v){return`${w}${v}`+F.repeat(L)+`${w}`}function U(L,w,F,v,I,j){if(L===0&&w===0)return z(F,v,I,j);return q(F,L,w,v,I,j)}class N extends Q.Processor{static image_processor_class=W.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;static uses_processor_config=!0;fake_image_token="<fake_token_around_image>";image_token="<image>";global_img_token="<global-img>";async _call(L,w=null,F={}){F.return_row_col_info??=!0;let v;if(w)v=await this.image_processor(w,F);if(!Array.isArray(L))L=[L];let I=v.rows??[Array(L.length).fill(0)],j=v.cols??[Array(L.length).fill(0)],y=this.config.image_seq_len,g=[],A=[];for(let B=0;B<L.length;++B){let R=L[B],P=I[B],k=j[B];g.push((0,G.count)(R,this.image_token));let h=P.map((d,a)=>U(d,k[a],y,this.fake_image_token,this.image_token,this.global_img_token)),c=R.split(this.image_token);if(c.length===0)throw Error("The image token should be present in the text.");let m=c[0];for(let d=0;d<h.length;++d)m+=h[d]+c[d+1];A.push(m)}return{...this.tokenizer(A),...v}}}},"./src/models/image_processors.js":(J,Z,$)=>{/*!****************************************!*\
  !*** ./src/models/image_processors.js ***!
  \****************************************/$.r(Z),$.d(Z,{BeitFeatureExtractor:()=>Q.BeitFeatureExtractor,BitImageProcessor:()=>W.BitImageProcessor,CLIPFeatureExtractor:()=>H.CLIPFeatureExtractor,CLIPImageProcessor:()=>H.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>Y.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>G.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>G.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>U.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>L.DPTFeatureExtractor,DPTImageProcessor:()=>L.DPTImageProcessor,DeiTFeatureExtractor:()=>q.DeiTFeatureExtractor,DeiTImageProcessor:()=>q.DeiTImageProcessor,DetrFeatureExtractor:()=>z.DetrFeatureExtractor,DetrImageProcessor:()=>z.DetrImageProcessor,DonutFeatureExtractor:()=>N.DonutFeatureExtractor,DonutImageProcessor:()=>N.DonutImageProcessor,EfficientNetImageProcessor:()=>w.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>F.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>v.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>I.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>y.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>g.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>A.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>T.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>T.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>B.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>B.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>R.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>R.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>P.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>P.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>k.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>k.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>h.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>h.MobileViTImageProcessor,NougatImageProcessor:()=>c.NougatImageProcessor,OwlViTFeatureExtractor:()=>d.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>d.OwlViTImageProcessor,Owlv2ImageProcessor:()=>m.Owlv2ImageProcessor,Phi3VImageProcessor:()=>a.Phi3VImageProcessor,PvtImageProcessor:()=>n.PvtImageProcessor,Qwen2VLImageProcessor:()=>t.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>Q0.RTDetrImageProcessor,SamImageProcessor:()=>o.SamImageProcessor,SegformerFeatureExtractor:()=>N0.SegformerFeatureExtractor,SegformerImageProcessor:()=>N0.SegformerImageProcessor,SiglipImageProcessor:()=>w0.SiglipImageProcessor,SmolVLMImageProcessor:()=>D.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>O.Swin2SRImageProcessor,VLMImageProcessor:()=>j.VLMImageProcessor,ViTFeatureExtractor:()=>p.ViTFeatureExtractor,ViTImageProcessor:()=>p.ViTImageProcessor,VitMatteImageProcessor:()=>Z0.VitMatteImageProcessor,VitPoseImageProcessor:()=>z0.VitPoseImageProcessor,YolosFeatureExtractor:()=>A0.YolosFeatureExtractor,YolosImageProcessor:()=>A0.YolosImageProcessor});var Q=$("./src/models/beit/image_processing_beit.js");/*! ./beit/image_processing_beit.js */var W=$("./src/models/bit/image_processing_bit.js");/*! ./bit/image_processing_bit.js */var Y=$("./src/models/chinese_clip/image_processing_chinese_clip.js");/*! ./chinese_clip/image_processing_chinese_clip.js */var H=$("./src/models/clip/image_processing_clip.js");/*! ./clip/image_processing_clip.js */var G=$("./src/models/convnext/image_processing_convnext.js");/*! ./convnext/image_processing_convnext.js */var q=$("./src/models/deit/image_processing_deit.js");/*! ./deit/image_processing_deit.js */var z=$("./src/models/detr/image_processing_detr.js");/*! ./detr/image_processing_detr.js */var U=$("./src/models/dinov3_vit/image_processing_dinov3_vit.js");/*! ./dinov3_vit/image_processing_dinov3_vit.js */var N=$("./src/models/donut/image_processing_donut.js");/*! ./donut/image_processing_donut.js */var L=$("./src/models/dpt/image_processing_dpt.js");/*! ./dpt/image_processing_dpt.js */var w=$("./src/models/efficientnet/image_processing_efficientnet.js");/*! ./efficientnet/image_processing_efficientnet.js */var F=$("./src/models/glpn/image_processing_glpn.js");/*! ./glpn/image_processing_glpn.js */var v=$("./src/models/grounding_dino/image_processing_grounding_dino.js");/*! ./grounding_dino/image_processing_grounding_dino.js */var I=$("./src/models/idefics3/image_processing_idefics3.js");/*! ./idefics3/image_processing_idefics3.js */var j=$("./src/models/janus/image_processing_janus.js");/*! ./janus/image_processing_janus.js */var y=$("./src/models/jina_clip/image_processing_jina_clip.js");/*! ./jina_clip/image_processing_jina_clip.js */var g=$("./src/models/llava_onevision/image_processing_llava_onevision.js");/*! ./llava_onevision/image_processing_llava_onevision.js */var A=$("./src/models/mask2former/image_processing_mask2former.js");/*! ./mask2former/image_processing_mask2former.js */var T=$("./src/models/maskformer/image_processing_maskformer.js");/*! ./maskformer/image_processing_maskformer.js */var B=$("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js");/*! ./mobilenet_v1/image_processing_mobilenet_v1.js */var R=$("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js");/*! ./mobilenet_v2/image_processing_mobilenet_v2.js */var P=$("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js");/*! ./mobilenet_v3/image_processing_mobilenet_v3.js */var k=$("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js");/*! ./mobilenet_v4/image_processing_mobilenet_v4.js */var h=$("./src/models/mobilevit/image_processing_mobilevit.js");/*! ./mobilevit/image_processing_mobilevit.js */var c=$("./src/models/nougat/image_processing_nougat.js");/*! ./nougat/image_processing_nougat.js */var m=$("./src/models/owlv2/image_processing_owlv2.js");/*! ./owlv2/image_processing_owlv2.js */var d=$("./src/models/owlvit/image_processing_owlvit.js");/*! ./owlvit/image_processing_owlvit.js */var a=$("./src/models/phi3_v/image_processing_phi3_v.js");/*! ./phi3_v/image_processing_phi3_v.js */var n=$("./src/models/pvt/image_processing_pvt.js");/*! ./pvt/image_processing_pvt.js */var t=$("./src/models/qwen2_vl/image_processing_qwen2_vl.js");/*! ./qwen2_vl/image_processing_qwen2_vl.js */var Q0=$("./src/models/rt_detr/image_processing_rt_detr.js");/*! ./rt_detr/image_processing_rt_detr.js */var o=$("./src/models/sam/image_processing_sam.js");/*! ./sam/image_processing_sam.js */var N0=$("./src/models/segformer/image_processing_segformer.js");/*! ./segformer/image_processing_segformer.js */var w0=$("./src/models/siglip/image_processing_siglip.js");/*! ./siglip/image_processing_siglip.js */var D=$("./src/models/smolvlm/image_processing_smolvlm.js");/*! ./smolvlm/image_processing_smolvlm.js */var O=$("./src/models/swin2sr/image_processing_swin2sr.js");/*! ./swin2sr/image_processing_swin2sr.js */var p=$("./src/models/vit/image_processing_vit.js");/*! ./vit/image_processing_vit.js */var Z0=$("./src/models/vitmatte/image_processing_vitmatte.js");/*! ./vitmatte/image_processing_vitmatte.js */var z0=$("./src/models/vitpose/image_processing_vitpose.js");/*! ./vitpose/image_processing_vitpose.js */var A0=$("./src/models/yolos/image_processing_yolos.js");/*! ./yolos/image_processing_yolos.js */},"./src/models/janus/image_processing_janus.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/janus/image_processing_janus.js ***!
  \****************************************************/$.r(Z),$.d(Z,{VLMImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{constructor(Y){super({do_pad:!0,pad_size:{width:Y.image_size,height:Y.image_size},...Y});this.constant_values=this.config.background_color.map((H)=>H*this.rescale_factor)}pad_image(Y,H,G,q){return super.pad_image(Y,H,G,{constant_values:this.constant_values,center:!0,...q})}}},"./src/models/janus/processing_janus.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/models/janus/processing_janus.js ***!
  \**********************************************/$.r(Z),$.d(Z,{VLChatProcessor:()=>z});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/core.js");/*! ../../utils/core.js */var G=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var q=$("./src/utils/image.js");/*! ../../utils/image.js */class z extends Q.Processor{static image_processor_class=W.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;static uses_processor_config=!0;constructor(U,N,L){super(U,N,L);this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(U,{images:N=null,chat_template:L="default"}={}){if(!N)N=await Promise.all(U.filter((k)=>k.images).flatMap((k)=>k.images).map((k)=>q.RawImage.read(k)));else if(!Array.isArray(N))N=[N];let w=this.tokenizer,F=w.apply_chat_template(U,{tokenize:!1,add_generation_prompt:!0,chat_template:L}),v=(k)=>w.encode(k,{add_special_tokens:!1}),I=F.split(this.image_tag),j=I.length-1;if(N.length!==j)throw Error(`Number of images provided (${N.length}) does not match number of "${this.image_tag}" image tags (${j})`);let[y,g,A]=w.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]),T=v(I[0]),B=Array(T.length).fill(!1);for(let k=1;k<I.length;++k){let h=Array(this.num_image_tokens).fill(y),c=v(I[k]);T=(0,H.mergeArrays)(T,[g],h,[A],c);let m=Array(this.num_image_tokens).fill(!0);B=(0,H.mergeArrays)(B,[!1],m,[!1],Array(c.length).fill(!1))}let R=[1,T.length],P={input_ids:new G.Tensor("int64",T,R),attention_mask:new G.Tensor("int64",Array(T.length).fill(1),R),images_seq_mask:new G.Tensor("bool",B,R),images_emb_mask:new G.Tensor("bool",Array(j*this.num_image_tokens).fill(!0),[1,j,this.num_image_tokens])};if(N&&N.length>0){let k=await this.image_processor(N);return k.pixel_values.unsqueeze_(0),{...P,...k}}return P}}},"./src/models/jina_clip/image_processing_jina_clip.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/jina_clip/image_processing_jina_clip.js ***!
  \************************************************************/$.r(Z),$.d(Z,{JinaCLIPImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{constructor(Y){let{resize_mode:H,fill_color:G,interpolation:q,size:z,...U}=Y,N=H==="squash"?{width:z,height:z}:H==="shortest"?{shortest_edge:z}:{longest_edge:z},L=q==="bicubic"?3:2;super({...U,size:N,resample:L,do_center_crop:!0,crop_size:z,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/jina_clip/processing_jina_clip.js ***!
  \******************************************************/$.r(Z),$.d(Z,{JinaCLIPProcessor:()=>H});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor;async _call(G=null,q=null,z={}){if(!G&&!q)throw Error("Either text or images must be provided");let U=G?this.tokenizer(G,z):{},N=q?await this.image_processor(q,z):{};return{...U,...N}}}},"./src/models/llava/processing_llava.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/models/llava/processing_llava.js ***!
  \**********************************************/$.r(Z),$.d(Z,{LlavaProcessor:()=>H});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor;static uses_processor_config=!0;async _call(G,q=null,z={}){let U=await this.image_processor(G,z);if(q){let[L,w]=U.pixel_values.dims.slice(-2),{image_token:F,patch_size:v,num_additional_image_tokens:I}=this.config,j=Math.floor(L/v)*Math.floor(w/v)+I;if(q=structuredClone(q),!Array.isArray(q))q=[q];for(let y=0;y<q.length;++y)q[y]=q[y].replace(F,F.repeat(j))}let N=q?this.tokenizer(q,z):{};return{...U,...N}}}},"./src/models/llava_onevision/image_processing_llava_onevision.js":(J,Z,$)=>{/*!************************************************************************!*\
  !*** ./src/models/llava_onevision/image_processing_llava_onevision.js ***!
  \************************************************************************/$.r(Z),$.d(Z,{LlavaOnevisionImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(J,Z,$)=>{/*!****************************************************************!*\
  !*** ./src/models/mask2former/image_processing_mask2former.js ***!
  \****************************************************************/$.r(Z),$.d(Z,{Mask2FormerImageProcessor:()=>W});var Q=$("./src/models/maskformer/image_processing_maskformer.js");/*! ../maskformer/image_processing_maskformer.js */class W extends Q.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/maskformer/image_processing_maskformer.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{MaskFormerFeatureExtractor:()=>Y,MaskFormerImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{post_process_panoptic_segmentation(...H){return(0,Q.post_process_panoptic_segmentation)(...H)}post_process_instance_segmentation(...H){return(0,Q.post_process_instance_segmentation)(...H)}}class Y extends W{}},"./src/models/mgp_str/processing_mgp_str.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/mgp_str/processing_mgp_str.js ***!
  \**************************************************/$.r(Z),$.d(Z,{MgpstrProcessor:()=>q});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/maths.js");/*! ../../utils/maths.js */let G={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class q extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor;get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(z,U){if(!G.hasOwnProperty(U))throw Error(`Format ${U} is not supported.`);let[N,L]=G[U],w=this[N].bind(this),[F,v]=z.dims,I=[],j=[],y=z.tolist();for(let A=0;A<F;++A){let T=y[A],B=[],R=[];for(let k=1;k<v;++k){let[h,c]=(0,H.max)((0,H.softmax)(T[k]));if(R.push(h),c==L)break;B.push(c)}let P=R.length>0?R.reduce((k,h)=>k*h,1):0;j.push(B),I.push(P)}return[w(j),I]}char_decode(z){return this.char_tokenizer.batch_decode(z).map((U)=>U.replaceAll(" ",""))}bpe_decode(z){return this.bpe_tokenizer.batch_decode(z)}wp_decode(z){return this.wp_tokenizer.batch_decode(z).map((U)=>U.replaceAll(" ",""))}batch_decode([z,U,N]){let[L,w]=this._decode_helper(z,"char"),[F,v]=this._decode_helper(U,"bpe"),[I,j]=this._decode_helper(N,"wp"),y=[],g=[];for(let A=0;A<L.length;++A){let[T,B]=(0,H.max)([w[A],v[A],j[A]]);y.push([L[A],F[A],I[A]][B]),g.push(T)}return{generated_text:y,scores:g,char_preds:L,bpe_preds:F,wp_preds:I}}static async from_pretrained(...z){let U=await super.from_pretrained(...z),N=await Y.AutoTokenizer.from_pretrained("Xenova/gpt2"),L=await Y.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return U.components={image_processor:U.image_processor,char_tokenizer:U.tokenizer,bpe_tokenizer:N,wp_tokenizer:L},U}async _call(z,U=null){let N=await this.image_processor(z);if(U)N.labels=this.tokenizer(U).input_ids;return N}}},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v1/image_processing_mobilenet_v1.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV1FeatureExtractor:()=>Y,MobileNetV1ImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v2/image_processing_mobilenet_v2.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV2FeatureExtractor:()=>Y,MobileNetV2ImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v3/image_processing_mobilenet_v3.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV3FeatureExtractor:()=>Y,MobileNetV3ImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(J,Z,$)=>{/*!******************************************************************!*\
  !*** ./src/models/mobilenet_v4/image_processing_mobilenet_v4.js ***!
  \******************************************************************/$.r(Z),$.d(Z,{MobileNetV4FeatureExtractor:()=>Y,MobileNetV4ImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/mobilevit/image_processing_mobilevit.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/mobilevit/image_processing_mobilevit.js ***!
  \************************************************************/$.r(Z),$.d(Z,{MobileViTFeatureExtractor:()=>Y,MobileViTImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/moonshine/feature_extraction_moonshine.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/moonshine/feature_extraction_moonshine.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{MoonshineFeatureExtractor:()=>Y});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.FeatureExtractor{async _call(H){if((0,Q.validate_audio_inputs)(H,"MoonshineFeatureExtractor"),H instanceof Float64Array)H=new Float32Array(H);let G=[1,H.length];return{input_values:new W.Tensor("float32",H,G)}}}},"./src/models/moonshine/processing_moonshine.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/moonshine/processing_moonshine.js ***!
  \******************************************************/$.r(Z),$.d(Z,{MoonshineProcessor:()=>H});var Q=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Q.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/nougat/image_processing_nougat.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/nougat/image_processing_nougat.js ***!
  \******************************************************/$.r(Z),$.d(Z,{NougatImageProcessor:()=>W});var Q=$("./src/models/donut/image_processing_donut.js");/*! ../donut/image_processing_donut.js */class W extends Q.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/owlv2/image_processing_owlv2.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Owlv2ImageProcessor:()=>W});var Q=$("./src/models/owlvit/image_processing_owlvit.js");/*! ../owlvit/image_processing_owlvit.js */class W extends Q.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/owlvit/image_processing_owlvit.js ***!
  \******************************************************/$.r(Z),$.d(Z,{OwlViTFeatureExtractor:()=>Y,OwlViTImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{post_process_object_detection(...H){return(0,Q.post_process_object_detection)(...H)}}class Y extends W{}},"./src/models/owlvit/processing_owlvit.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/owlvit/processing_owlvit.js ***!
  \************************************************/$.r(Z),$.d(Z,{OwlViTProcessor:()=>H});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */class H extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor}},"./src/models/paligemma/processing_paligemma.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/paligemma/processing_paligemma.js ***!
  \******************************************************/$.r(Z),$.d(Z,{PaliGemmaProcessor:()=>q});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */let H="<image>";function G(z,U,N,L,w){return`${L.repeat(N*w)}${U}${z}
`}class q extends Q.Processor{static tokenizer_class=Y.AutoTokenizer;static image_processor_class=W.AutoImageProcessor;static uses_processor_config=!1;async _call(z,U=null,N={}){if(!U)console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),U="";if(!Array.isArray(z))z=[z];if(!Array.isArray(U))U=[U];let L=this.tokenizer.bos_token,w=this.image_processor.config.image_seq_length,F;if(U.some((j)=>j.includes(H)))F=U.map((j)=>{let y=j.replaceAll(H,H.repeat(w)),g=y.lastIndexOf(H),A=g===-1?0:g+H.length;return y.slice(0,A)+L+y.slice(A)+`
`});else console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),F=U.map((j)=>G(j,L,w,H,z.length));let v=this.tokenizer(F,N);return{...await this.image_processor(z,N),...v}}}},"./src/models/parakeet/feature_extraction_parakeet.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/parakeet/feature_extraction_parakeet.js ***!
  \************************************************************/$.r(Z),$.d(Z,{ParakeetFeatureExtractor:()=>G});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */let H=0.00001;class G extends Q.FeatureExtractor{constructor(q){super(q);this.config.mel_filters??=(0,Y.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,this.config.sampling_rate/2,this.config.sampling_rate,"slaney","slaney");let z=(0,Y.window_function)(this.config.win_length,"hann",{periodic:!1});this.window=new Float64Array(this.config.n_fft);let U=Math.floor((this.config.n_fft-this.config.win_length)/2);this.window.set(z,U)}async _extract_fbank_features(q){let z=this.config.preemphasis;q=new Float64Array(q);for(let N=q.length-1;N>=1;--N)q[N]-=z*q[N-1];return await(0,Y.spectrogram)(q,this.window,this.window.length,this.config.hop_length,{fft_length:this.config.n_fft,power:2,mel_filters:this.config.mel_filters,log_mel:"log",mel_floor:-1/0,pad_mode:"constant",center:!0,transpose:!0,mel_offset:0.00000005960464477539063})}async _call(q){(0,Q.validate_audio_inputs)(q,"ParakeetFeatureExtractor");let z=await this._extract_fbank_features(q),U=Math.floor((q.length+Math.floor(this.config.n_fft/2)*2-this.config.n_fft)/this.config.hop_length),N=z.data;N.fill(0,U*z.dims[1]);let[L,w]=z.dims,F=new Float64Array(w),v=new Float64Array(w);for(let y=0;y<U;++y){let g=y*w;for(let A=0;A<w;++A){let T=N[g+A];F[A]+=T,v[A]+=T*T}}let I=U>1?U-1:1;for(let y=0;y<w;++y){let g=F[y]/U,A=(v[y]-U*g*g)/I,B=1/(Math.sqrt(A)+H);for(let R=0;R<U;++R){let P=R*w+y;N[P]=(N[P]-g)*B}}let j=new BigInt64Array(L);return j.fill(1n,0,U),{input_features:z.unsqueeze_(0),attention_mask:new W.Tensor("int64",j,[1,L])}}}},"./src/models/phi3_v/image_processing_phi3_v.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/phi3_v/image_processing_phi3_v.js ***!
  \******************************************************/$.r(Z),$.d(Z,{Phi3VImageProcessor:()=>U});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */let Y=336,H=[2,3],{ceil:G,floor:q,sqrt:z}=Math;class U extends Q.ImageProcessor{constructor(N){super({...N,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0});this._num_crops=N.num_crops}calc_num_image_tokens_from_image_size(N,L){let{num_img_tokens:w}=this.config;return q((q(L/Y)*q(N/Y)+1)*w+1+(q(L/Y)+1)*z(w))}get_resize_output_image_size(N,L){let w=this._num_crops,[F,v]=N.size,I=F/v,j=1;while(j*Math.ceil(j/I)<=w)j+=1;j-=1;let y=Math.floor(j*336),g=Math.floor(y/I);return[y,g]}pad_image(N,L,w,F={}){let[v,I]=L,j=Y*G(v/Y),y=Y*G(I/Y),g=[1,1,1].map((A,T)=>(A-this.image_mean[T])/this.image_std[T]);return super.pad_image(N,L,{width:y,height:j},{center:!0,constant_values:g,...F})}async _call(N,{num_crops:L=null}={}){if(this._num_crops=L??=this.config.num_crops,L<4||z(L)%1!==0)throw Error("num_crops must be a square number >= 4");if(!Array.isArray(N))N=[N];let w=N.length,F=await Promise.all(N.map((B)=>this.preprocess(B))),v=F.map((B)=>B.original_size),I=F.map((B)=>B.reshaped_input_size),j=[];for(let{pixel_values:B}of F){B.unsqueeze_(0);let[R,P]=B.dims.slice(-2),k=await(0,W.interpolate_4d)(B,{size:[Y,Y],mode:"bicubic"});if(L>0){let h=[],c=z(L),m=q(P/c),d=q(R/c);for(let n=0;n<c;++n)for(let t=0;t<c;++t){let Q0,o,N0,w0;if(n===c-1)o=R-d,w0=R;else o=n*d,w0=(n+1)*d;if(t===c-1)Q0=P-m,N0=P;else Q0=t*m,N0=(t+1)*m;let D=[o,Q0],O=[w0,N0],p=await(0,W.slice)(B,D,O,H);h.push(p)}let a=await(0,W.interpolate_4d)((0,W.cat)(h,0),{size:[Y,Y],mode:"bicubic"});j.push((0,W.cat)([k,a],0))}else j.push(k)}let y=(0,W.stack)(j,0),g=I.map((B)=>B.map((R)=>Y*G(R/Y))),A=new W.Tensor("int64",g.flat(),[w,2]),T=g.map(([B,R])=>this.calc_num_image_tokens_from_image_size(R,B));return{pixel_values:y,original_sizes:v,reshaped_input_sizes:I,image_sizes:A,num_img_tokens:T}}}},"./src/models/phi3_v/processing_phi3_v.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/phi3_v/processing_phi3_v.js ***!
  \************************************************/$.r(Z),$.d(Z,{Phi3VProcessor:()=>z});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/image.js");/*! ../../utils/image.js */let G="<|image|>",q=/<\|image_\d+\|>/g;class z extends Q.Processor{static image_processor_class=W.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;async _call(U,N=null,{padding:L=!0,truncation:w=!0,num_crops:F=null}={}){if(!Array.isArray(U))U=[U];let v,I;if(N){I=await this.image_processor(N,{num_crops:F});let{num_img_tokens:j}=I,y=U.map((A,T)=>A.split(q).join(G.repeat(j[T])));v=this.tokenizer(y,{padding:L,truncation:w});let g=this.tokenizer.model.convert_tokens_to_ids([G])[0];v.input_ids.map_((A)=>A==g?-A:A)}else v=this.tokenizer(U);return{...v,...I}}}},"./src/models/processors.js":(J,Z,$)=>{/*!**********************************!*\
  !*** ./src/models/processors.js ***!
  \**********************************/$.r(Z),$.d(Z,{Florence2Processor:()=>Q.Florence2Processor,Gemma3nProcessor:()=>W.Gemma3nProcessor,GroundingDinoProcessor:()=>Y.GroundingDinoProcessor,Idefics3Processor:()=>H.Idefics3Processor,JinaCLIPProcessor:()=>q.JinaCLIPProcessor,LlavaProcessor:()=>z.LlavaProcessor,MgpstrProcessor:()=>U.MgpstrProcessor,MoonshineProcessor:()=>N.MoonshineProcessor,OwlViTProcessor:()=>L.OwlViTProcessor,PaliGemmaProcessor:()=>F.PaliGemmaProcessor,Phi3VProcessor:()=>w.Phi3VProcessor,PyAnnoteProcessor:()=>v.PyAnnoteProcessor,Qwen2VLProcessor:()=>I.Qwen2VLProcessor,SamProcessor:()=>j.SamProcessor,SmolVLMProcessor:()=>y.SmolVLMProcessor,SpeechT5Processor:()=>g.SpeechT5Processor,UltravoxProcessor:()=>A.UltravoxProcessor,VLChatProcessor:()=>G.VLChatProcessor,VoxtralProcessor:()=>T.VoxtralProcessor,Wav2Vec2Processor:()=>B.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>R.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>P.WhisperProcessor});var Q=$("./src/models/florence2/processing_florence2.js");/*! ./florence2/processing_florence2.js */var W=$("./src/models/gemma3n/processing_gemma3n.js");/*! ./gemma3n/processing_gemma3n.js */var Y=$("./src/models/grounding_dino/processing_grounding_dino.js");/*! ./grounding_dino/processing_grounding_dino.js */var H=$("./src/models/idefics3/processing_idefics3.js");/*! ./idefics3/processing_idefics3.js */var G=$("./src/models/janus/processing_janus.js");/*! ./janus/processing_janus.js */var q=$("./src/models/jina_clip/processing_jina_clip.js");/*! ./jina_clip/processing_jina_clip.js */var z=$("./src/models/llava/processing_llava.js");/*! ./llava/processing_llava.js */var U=$("./src/models/mgp_str/processing_mgp_str.js");/*! ./mgp_str/processing_mgp_str.js */var N=$("./src/models/moonshine/processing_moonshine.js");/*! ./moonshine/processing_moonshine.js */var L=$("./src/models/owlvit/processing_owlvit.js");/*! ./owlvit/processing_owlvit.js */var w=$("./src/models/phi3_v/processing_phi3_v.js");/*! ./phi3_v/processing_phi3_v.js */var F=$("./src/models/paligemma/processing_paligemma.js");/*! ./paligemma/processing_paligemma.js */var v=$("./src/models/pyannote/processing_pyannote.js");/*! ./pyannote/processing_pyannote.js */var I=$("./src/models/qwen2_vl/processing_qwen2_vl.js");/*! ./qwen2_vl/processing_qwen2_vl.js */var j=$("./src/models/sam/processing_sam.js");/*! ./sam/processing_sam.js */var y=$("./src/models/smolvlm/processing_smolvlm.js");/*! ./smolvlm/processing_smolvlm.js */var g=$("./src/models/speecht5/processing_speecht5.js");/*! ./speecht5/processing_speecht5.js */var A=$("./src/models/ultravox/processing_ultravox.js");/*! ./ultravox/processing_ultravox.js */var T=$("./src/models/voxtral/processing_voxtral.js");/*! ./voxtral/processing_voxtral.js */var B=$("./src/models/wav2vec2/processing_wav2vec2.js");/*! ./wav2vec2/processing_wav2vec2.js */var R=$("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js");/*! ./wav2vec2_with_lm/processing_wav2vec2_with_lm.js */var P=$("./src/models/whisper/processing_whisper.js");/*! ./whisper/processing_whisper.js */},"./src/models/pvt/image_processing_pvt.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/pvt/image_processing_pvt.js ***!
  \************************************************/$.r(Z),$.d(Z,{PvtImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/pyannote/feature_extraction_pyannote.js ***!
  \************************************************************/$.r(Z),$.d(Z,{PyAnnoteFeatureExtractor:()=>H});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/maths.js");/*! ../../utils/maths.js */class H extends Q.FeatureExtractor{async _call(G){if((0,Q.validate_audio_inputs)(G,"PyAnnoteFeatureExtractor"),G instanceof Float64Array)G=new Float32Array(G);let q=[1,1,G.length];return{input_values:new W.Tensor("float32",G,q)}}samples_to_frames(G){return(G-this.config.offset)/this.config.step}post_process_speaker_diarization(G,q){let z=q/this.samples_to_frames(q)/this.config.sampling_rate,U=[];for(let N of G.tolist()){let L=[],w=-1;for(let F=0;F<N.length;++F){let v=(0,Y.softmax)(N[F]),[I,j]=(0,Y.max)(v),[y,g]=[F,F+1];if(j!==w)w=j,L.push({id:j,start:y,end:g,score:I});else L.at(-1).end=g,L.at(-1).score+=I}U.push(L.map(({id:F,start:v,end:I,score:j})=>({id:F,start:v*z,end:I*z,confidence:j/(I-v)})))}return U}}},"./src/models/pyannote/processing_pyannote.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/pyannote/processing_pyannote.js ***!
  \****************************************************/$.r(Z),$.d(Z,{PyAnnoteProcessor:()=>Y});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/pyannote/feature_extraction_pyannote.js");/*! ./feature_extraction_pyannote.js */class Y extends Q.Processor{static feature_extractor_class=W.PyAnnoteFeatureExtractor;async _call(H){return await this.feature_extractor(H)}post_process_speaker_diarization(...H){return this.feature_extractor.post_process_speaker_diarization(...H)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/qwen2_vl/image_processing_qwen2_vl.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{Qwen2VLImageProcessor:()=>Y});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.ImageProcessor{async _call(H,...G){let{pixel_values:q,original_sizes:z,reshaped_input_sizes:U}=await super._call(H,...G),N=q,{temporal_patch_size:L,merge_size:w,patch_size:F}=this.config;if(N.dims[0]===1)N=(0,W.cat)(Array.from({length:L},()=>N),0);let v=N.dims[0]/L,I=N.dims[1],j=Math.floor(N.dims[2]/F),y=Math.floor(N.dims[3]/F),g=N.view(v,L,I,Math.floor(j/w),w,F,Math.floor(y/w),w,F).permute(0,3,6,4,7,2,1,5,8).view(v*j*y,I*L*F*F),A=new W.Tensor("int64",[v,j,y],[1,3]);return{pixel_values:g,image_grid_thw:A,original_sizes:z,reshaped_input_sizes:U}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/qwen2_vl/processing_qwen2_vl.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Qwen2VLProcessor:()=>G});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */var Y=$("./src/tokenizers.js");/*! ../../tokenizers.js */var H=$("./src/utils/image.js");/*! ../../utils/image.js */class G extends Q.Processor{static image_processor_class=W.AutoImageProcessor;static tokenizer_class=Y.AutoTokenizer;async _call(q,z=null,...U){if(!Array.isArray(q))q=[q];let N,L;if(z)N=await this.image_processor(z),L=N.image_grid_thw;if(L){let F=this.image_processor.config.merge_size**2,v=0,I=L.tolist();q=q.map((j)=>{while(j.includes("<|image_pad|>")){let y=Number(I[v++].reduce((g,A)=>g*A,1n));j=j.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(y/F)))}return j.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(q),...N}}}},"./src/models/rt_detr/image_processing_rt_detr.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/rt_detr/image_processing_rt_detr.js ***!
  \********************************************************/$.r(Z),$.d(Z,{RTDetrImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{post_process_object_detection(...Y){return(0,Q.post_process_object_detection)(...Y)}}},"./src/models/sam/image_processing_sam.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/sam/image_processing_sam.js ***!
  \************************************************/$.r(Z),$.d(Z,{SamImageProcessor:()=>H});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/core.js");/*! ../../utils/core.js */var Y=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class H extends Q.ImageProcessor{reshape_input_points(G,q,z,U=!1){G=structuredClone(G);let N=(0,W.calculateDimensions)(G);if(N.length===3){if(!U)N=[1,...N];G=[G]}else if(N.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let L=0;L<G.length;++L){let w=q[L],F=z[L],v=[F[0]/w[0],F[1]/w[1]];for(let I=0;I<G[L].length;++I)for(let j=0;j<G[L][I].length;++j)for(let y=0;y<G[L][I][j].length;++y)G[L][I][j][y]*=v[y%2]}return new Y.Tensor("float32",Float32Array.from(G.flat(1/0)),N)}add_input_labels(G,q){let z=(0,W.calculateDimensions)(G);if(z.length===2)z=[1,...z],G=[G];else if(z.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(z.some((U,N)=>U!==q.dims[N]))throw Error(`The first ${z.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new Y.Tensor("int64",G.flat(1/0).map(BigInt),z)}async _call(G,{input_points:q=null,input_labels:z=null,input_boxes:U=null}={}){let N=await super._call(G);if(q)N.input_points=this.reshape_input_points(q,N.original_sizes,N.reshaped_input_sizes);if(z){if(!N.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");N.input_labels=this.add_input_labels(z,N.input_points)}if(U)N.input_boxes=this.reshape_input_points(U,N.original_sizes,N.reshaped_input_sizes,!0);return N}async post_process_masks(G,q,z,{mask_threshold:U=0,binarize:N=!0,pad_size:L=null}={}){let w=[];L=L??this.pad_size;let F=[L.height,L.width];for(let v=0;v<q.length;++v){let I=q[v],j=z[v],y=await(0,Y.interpolate_4d)(G[v],{mode:"bilinear",size:F});if(y=y.slice(null,null,[0,j[0]],[0,j[1]]),y=await(0,Y.interpolate_4d)(y,{mode:"bilinear",size:I}),N){let g=y.data,A=new Uint8Array(g.length);for(let T=0;T<g.length;++T)if(g[T]>U)A[T]=1;y=new Y.Tensor("bool",A,y.dims)}w.push(y)}return w}generate_crop_boxes(G,q,{crop_n_layers:z=0,overlap_ratio:U=0.3413333333333333,points_per_crop:N=32,crop_n_points_downscale_factor:L=1}={}){}}},"./src/models/sam/processing_sam.js":(J,Z,$)=>{/*!******************************************!*\
  !*** ./src/models/sam/processing_sam.js ***!
  \******************************************/$.r(Z),$.d(Z,{SamProcessor:()=>Y});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/models/auto/image_processing_auto.js");/*! ../auto/image_processing_auto.js */class Y extends Q.Processor{static image_processor_class=W.AutoImageProcessor;async _call(...H){return await this.image_processor(...H)}post_process_masks(...H){return this.image_processor.post_process_masks(...H)}reshape_input_points(...H){return this.image_processor.reshape_input_points(...H)}}},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(J,Z,$)=>{/*!********************************************************************!*\
  !*** ./src/models/seamless_m4t/feature_extraction_seamless_m4t.js ***!
  \********************************************************************/$.r(Z),$.d(Z,{SeamlessM4TFeatureExtractor:()=>H});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends Q.FeatureExtractor{constructor(G){super(G);let q=this.config.sampling_rate,z=(0,Y.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(q/2),q,null,"kaldi",!0);this.mel_filters=z,this.window=(0,Y.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(G,q){return G=G.map((z)=>z*32768),(0,Y.spectrogram)(G,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:0.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:0.0000001192092955078125,remove_dc_offset:!0,max_num_frames:q,transpose:!0})}async _call(G,{padding:q=!0,pad_to_multiple_of:z=2,do_normalize_per_mel_bins:U=!0,return_attention_mask:N=!0}={}){(0,Q.validate_audio_inputs)(G,"SeamlessM4TFeatureExtractor");let L=await this._extract_fbank_features(G,this.config.max_length);if(U){let[A,T]=L.dims,B=L.data;for(let R=0;R<T;++R){let P=0;for(let m=0;m<A;++m)P+=B[m*T+R];let k=P/A,h=0;for(let m=0;m<A;++m)h+=(B[m*T+R]-k)**2;h/=A-1;let c=Math.sqrt(h+0.0000001);for(let m=0;m<A;++m){let d=m*T+R;B[d]=(B[d]-k)/c}}}let w;if(q){let[A,T]=L.dims,B=L.data,R=A%z;if(R>0){let P=new Float32Array(T*(A+R));P.set(B),P.fill(this.config.padding_value,B.length);let k=A+R;if(L=new W.Tensor(L.type,P,[k,T]),N)w=new W.Tensor("int64",new BigInt64Array(k),[1,k]),w.data.fill(1n,0,A)}}let[F,v]=L.dims,I=this.config.stride;if(F%I!==0)throw Error(`The number of frames (${F}) must be a multiple of the stride (${I}).`);let y=L.view(1,Math.floor(F/I),v*I),g={input_features:y};if(N){let A=y.dims[1],T=new BigInt64Array(A);if(w){let B=w.data;for(let R=1,P=0;R<F;R+=I,++P)T[P]=B[R]}else T.fill(1n);g.attention_mask=new W.Tensor("int64",T,[1,A])}return g}}},"./src/models/segformer/image_processing_segformer.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/segformer/image_processing_segformer.js ***!
  \************************************************************/$.r(Z),$.d(Z,{SegformerFeatureExtractor:()=>Y,SegformerImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{post_process_semantic_segmentation(...H){return(0,Q.post_process_semantic_segmentation)(...H)}}class Y extends W{}},"./src/models/siglip/image_processing_siglip.js":(J,Z,$)=>{/*!******************************************************!*\
  !*** ./src/models/siglip/image_processing_siglip.js ***!
  \******************************************************/$.r(Z),$.d(Z,{SiglipImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/smolvlm/image_processing_smolvlm.js ***!
  \********************************************************/$.r(Z),$.d(Z,{SmolVLMImageProcessor:()=>Q.Idefics3ImageProcessor});var Q=$("./src/models/idefics3/image_processing_idefics3.js");/*! ../idefics3/image_processing_idefics3.js */},"./src/models/smolvlm/processing_smolvlm.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/smolvlm/processing_smolvlm.js ***!
  \**************************************************/$.r(Z),$.d(Z,{SmolVLMProcessor:()=>Q.Idefics3Processor});var Q=$("./src/models/idefics3/processing_idefics3.js");/*! ../idefics3/processing_idefics3.js */},"./src/models/snac/feature_extraction_snac.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/snac/feature_extraction_snac.js ***!
  \****************************************************/$.r(Z),$.d(Z,{SnacFeatureExtractor:()=>W});var Q=$("./src/models/dac/feature_extraction_dac.js");/*! ../dac/feature_extraction_dac.js */class W extends Q.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/speecht5/feature_extraction_speecht5.js ***!
  \************************************************************/$.r(Z),$.d(Z,{SpeechT5FeatureExtractor:()=>W});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */class W extends Q.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/speecht5/processing_speecht5.js ***!
  \****************************************************/$.r(Z),$.d(Z,{SpeechT5Processor:()=>H});var Q=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */class H extends Q.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Y.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/swin2sr/image_processing_swin2sr.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/swin2sr/image_processing_swin2sr.js ***!
  \********************************************************/$.r(Z),$.d(Z,{Swin2SRImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{pad_image(Y,H,G,q={}){let[z,U,N]=H;return super.pad_image(Y,H,{width:U+(G-U%G)%G,height:z+(G-z%G)%G},{mode:"symmetric",center:!1,constant_values:-1,...q})}}},"./src/models/ultravox/processing_ultravox.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/ultravox/processing_ultravox.js ***!
  \****************************************************/$.r(Z),$.d(Z,{UltravoxProcessor:()=>H});var Q=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Q.AutoFeatureExtractor;static uses_processor_config=!0;async _call(G,q=null,z={}){if(Array.isArray(G))throw Error("Batched inputs are not supported yet.");let U={};if(q){let L=q.length,{input_features:w}=await this.feature_extractor(q,{...z,max_length:L}),F=Math.round(L/this.config.encoder_ds_factor+0.0001),v=1+Math.ceil(F/this.config.stack_factor);U.audio_token_len=[v],U.audio_values=w;let I=this.config.audio_placeholder;if(!G.includes(I))throw Error(`The input text does not contain the image token ${I}.`);G=G.replaceAll(I,I.repeat(v))}return{...this.tokenizer(G,{add_special_tokens:!1,...z}),...U}}}},"./src/models/vit/image_processing_vit.js":(J,Z,$)=>{/*!************************************************!*\
  !*** ./src/models/vit/image_processing_vit.js ***!
  \************************************************/$.r(Z),$.d(Z,{ViTFeatureExtractor:()=>Y,ViTImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{}class Y extends W{}},"./src/models/vitmatte/image_processing_vitmatte.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/vitmatte/image_processing_vitmatte.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{VitMatteImageProcessor:()=>Y});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.ImageProcessor{async _call(H,G){if(!Array.isArray(H))H=[H];if(!Array.isArray(G))G=[G];let q=await Promise.all(H.map((N)=>this.preprocess(N))),z=await Promise.all(G.map((N)=>this.preprocess(N,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,W.stack)(q.map((N,L)=>(0,W.cat)([N.pixel_values,z[L].pixel_values],0)),0),original_sizes:q.map((N)=>N.original_size),reshaped_input_sizes:q.map((N)=>N.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(J,Z,$)=>{/*!********************************************************!*\
  !*** ./src/models/vitpose/image_processing_vitpose.js ***!
  \********************************************************/$.r(Z),$.d(Z,{VitPoseImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{post_process_pose_estimation(Y,H,{threshold:G=null}={}){let q=Y.tolist(),[z,U,N,L]=Y.dims,w=[];for(let F=0;F<z;++F){let v=q[F],I=H[F],j=[];for(let y=0;y<I.length;++y){let g=I[y],A=[],T=[],B=[],R=g.at(-2)/L,P=g.at(-1)/N;for(let k=0;k<v.length;++k){let[h,c]=[0,0],m=0,d=-1/0,a=v[k];for(let t=0;t<a.length;++t){let Q0=a[t];for(let o=0;o<Q0.length;++o){let N0=Q0[o];m+=N0,d=Math.max(d,N0),h+=(o+0.5)*N0,c+=t*N0}}if(G!=null&&d<G)continue;let n=[R*h/m,P*c/m];A.push(n),B.push(k),T.push(d)}j.push({bbox:g,scores:T,labels:B,keypoints:A})}w.push(j)}return w}}},"./src/models/voxtral/processing_voxtral.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/voxtral/processing_voxtral.js ***!
  \**************************************************/$.r(Z),$.d(Z,{VoxtralProcessor:()=>N});var Q=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */var H=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */let G="[AUDIO]",q="[BEGIN_AUDIO]",z=375;function U(L,w){let F=[];for(let v=0;v<L.length;v+=w)F.push(L.subarray(v,Math.min(v+w,L.length)));return F}class N extends Y.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Q.AutoFeatureExtractor;static uses_processor_config=!1;async _call(L,w=null,F={}){if(Array.isArray(L))throw Error("Batched inputs are not supported yet.");let v={};if(w){if(!L.includes(G))throw Error(`The input text does not contain the audio token ${G}.`);if(!Array.isArray(w))w=[w];let j=L.split(G),y=j.length-1;if(y!==w.length)throw Error(`The number of audio inputs (${w.length}) does not match the number of audio tokens in the text (${y}).`);let g=this.feature_extractor.config.n_samples,A=w.map((k)=>U(k,g)),T=A.map((k)=>k.length),B=A.flat(),R=(await Promise.all(B.map((k)=>this.feature_extractor(k,F)))).map((k)=>k.input_features);v.audio_values=R.length>1?(0,H.cat)(R,0):R[0];let P=j[0];for(let k=0;k<T.length;++k){P+=q;for(let h=0;h<T[k];++h)P+=G.repeat(z);P+=j[k+1]}L=P}return{...this.tokenizer(L,{add_special_tokens:!1,...F}),...v}}}},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(J,Z,$)=>{/*!************************************************************!*\
  !*** ./src/models/wav2vec2/feature_extraction_wav2vec2.js ***!
  \************************************************************/$.r(Z),$.d(Z,{Wav2Vec2FeatureExtractor:()=>Y});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */class Y extends Q.FeatureExtractor{_zero_mean_unit_var_norm(H){let q=H.reduce((U,N)=>U+N,0)/H.length,z=H.reduce((U,N)=>U+(N-q)**2,0)/H.length;return H.map((U)=>(U-q)/Math.sqrt(z+0.0000001))}async _call(H){if((0,Q.validate_audio_inputs)(H,"Wav2Vec2FeatureExtractor"),H instanceof Float64Array)H=new Float32Array(H);let G=H;if(this.config.do_normalize)G=this._zero_mean_unit_var_norm(G);let q=[1,G.length];return{input_values:new W.Tensor("float32",G,q),attention_mask:new W.Tensor("int64",new BigInt64Array(G.length).fill(1n),q)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/wav2vec2/processing_wav2vec2.js ***!
  \****************************************************/$.r(Z),$.d(Z,{Wav2Vec2Processor:()=>H});var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var W=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=W.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(J,Z,$)=>{/*!********************************************************************!*\
  !*** ./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js ***!
  \********************************************************************/$.r(Z),$.d(Z,{Wav2Vec2ProcessorWithLM:()=>H});var Q=$("./src/tokenizers.js");/*! ../../tokenizers.js */var W=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=Q.AutoTokenizer;static feature_extractor_class=W.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/wespeaker/feature_extraction_wespeaker.js":(J,Z,$)=>{/*!**************************************************************!*\
  !*** ./src/models/wespeaker/feature_extraction_wespeaker.js ***!
  \**************************************************************/$.r(Z),$.d(Z,{WeSpeakerFeatureExtractor:()=>H});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */class H extends Q.FeatureExtractor{constructor(G){super(G);let q=this.config.sampling_rate,z=(0,Y.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(q/2),q,null,"kaldi",!0);this.mel_filters=z,this.window=(0,Y.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(G){return G=G.map((q)=>q*32768),(0,Y.spectrogram)(G,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:0.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:0.0000001192092955078125,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(G){(0,Q.validate_audio_inputs)(G,"WeSpeakerFeatureExtractor");let q=(await this._extract_fbank_features(G)).unsqueeze_(0);if(this.config.fbank_centering_span===null){let z=q.mean(1).data,U=q.data,[N,L,w]=q.dims;for(let F=0;F<N;++F){let v=F*L*w,I=F*w;for(let j=0;j<L;++j){let y=v+j*w;for(let g=0;g<w;++g)U[y+g]-=z[I+g]}}}return{input_features:q}}}},"./src/models/whisper/common_whisper.js":(J,Z,$)=>{/*!**********************************************!*\
  !*** ./src/models/whisper/common_whisper.js ***!
  \**********************************************/$.r(Z),$.d(Z,{WHISPER_LANGUAGE_MAPPING:()=>W,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>Y,whisper_language_to_code:()=>H});let Q=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],W=new Map(Q),Y=new Map([...Q.map(([G,q])=>[q,G]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function H(G){G=G.toLowerCase();let q=Y.get(G);if(q===void 0){let z=G.match(/^<\|([a-z]{2})\|>$/);if(z)G=z[1];if(W.has(G))q=G;else{let N=G.length===2?W.keys():W.values();throw Error(`Language "${G}" is not supported. Must be one of: ${JSON.stringify(Array.from(N))}`)}}return q}},"./src/models/whisper/feature_extraction_whisper.js":(J,Z,$)=>{/*!**********************************************************!*\
  !*** ./src/models/whisper/feature_extraction_whisper.js ***!
  \**********************************************************/$.r(Z),$.d(Z,{WhisperFeatureExtractor:()=>G});var Q=$("./src/base/feature_extraction_utils.js");/*! ../../base/feature_extraction_utils.js */var W=$("./src/utils/tensor.js");/*! ../../utils/tensor.js */var Y=$("./src/utils/audio.js");/*! ../../utils/audio.js */var H=$("./src/utils/maths.js");/*! ../../utils/maths.js */class G extends Q.FeatureExtractor{constructor(q){super(q);this.config.mel_filters??=(0,Y.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8000,this.config.sampling_rate,"slaney","slaney"),this.window=(0,Y.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(q){let z=await(0,Y.spectrogram)(q,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(q.length/this.config.hop_length),this.config.nb_max_frames)}),U=z.data,N=(0,H.max)(U)[0];for(let L=0;L<U.length;++L)U[L]=(Math.max(U[L],N-8)+4)/4;return z}async _call(q,{max_length:z=null}={}){(0,Q.validate_audio_inputs)(q,"WhisperFeatureExtractor");let U,N=z??this.config.n_samples;if(q.length>N){if(q.length>this.config.n_samples)console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`.");U=q.slice(0,N)}else U=new Float32Array(N),U.set(q);return{input_features:(await this._extract_fbank_features(U)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/whisper/generation_whisper.js ***!
  \**************************************************/$.r(Z),$.d(Z,{WhisperGenerationConfig:()=>W});var Q=$("./src/generation/configuration_utils.js");/*! ../../generation/configuration_utils.js */class W extends Q.GenerationConfig{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}},"./src/models/whisper/processing_whisper.js":(J,Z,$)=>{/*!**************************************************!*\
  !*** ./src/models/whisper/processing_whisper.js ***!
  \**************************************************/$.r(Z),$.d(Z,{WhisperProcessor:()=>H});var Q=$("./src/models/auto/feature_extraction_auto.js");/*! ../auto/feature_extraction_auto.js */var W=$("./src/tokenizers.js");/*! ../../tokenizers.js */var Y=$("./src/base/processing_utils.js");/*! ../../base/processing_utils.js */class H extends Y.Processor{static tokenizer_class=W.AutoTokenizer;static feature_extractor_class=Q.AutoFeatureExtractor;async _call(G){return await this.feature_extractor(G)}}},"./src/models/yolos/image_processing_yolos.js":(J,Z,$)=>{/*!****************************************************!*\
  !*** ./src/models/yolos/image_processing_yolos.js ***!
  \****************************************************/$.r(Z),$.d(Z,{YolosFeatureExtractor:()=>Y,YolosImageProcessor:()=>W});var Q=$("./src/base/image_processors_utils.js");/*! ../../base/image_processors_utils.js */class W extends Q.ImageProcessor{post_process_object_detection(...H){return(0,Q.post_process_object_detection)(...H)}}class Y extends W{}},"./src/ops/registry.js":(J,Z,$)=>{/*!*****************************!*\
  !*** ./src/ops/registry.js ***!
  \*****************************/$.r(Z),$.d(Z,{TensorOpRegistry:()=>H});var Q=$("./src/backends/onnx.js");/*! ../backends/onnx.js */var W=$("./src/utils/tensor.js");/*! ../utils/tensor.js */let Y=async(G,q,z)=>{let U=await(0,Q.createInferenceSession)(new Uint8Array(G),q);return async(N)=>{let L=(0,Q.isONNXProxy)(),w=Object.fromEntries(Object.entries(N).map(([v,I])=>[v,(L?I.clone():I).ort_tensor])),F=await(0,Q.runInferenceSession)(U,w);if(Array.isArray(z))return z.map((v)=>new W.Tensor(F[v]));else return new W.Tensor(F[z])}};class H{static session_options={};static get nearest_interpolate_4d(){if(!this._nearest_interpolate_4d)this._nearest_interpolate_4d=Y([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y");return this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){if(!this._bilinear_interpolate_4d)this._bilinear_interpolate_4d=Y([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y");return this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){if(!this._bicubic_interpolate_4d)this._bicubic_interpolate_4d=Y([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y");return this._bicubic_interpolate_4d}static get matmul(){if(!this._matmul)this._matmul=Y([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c");return this._matmul}static get stft(){if(!this._stft)this._stft=Y([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o");return this._stft}static get rfft(){if(!this._rfft)this._rfft=Y([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y");return this._rfft}static get top_k(){if(!this._top_k)this._top_k=Y([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"]);return this._top_k}static get slice(){if(!this._slice)this._slice=Y([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y");return this._slice}}},"./src/pipelines.js":(J,Z,$)=>{/*!**************************!*\
  !*** ./src/pipelines.js ***!
  \**************************/$.r(Z),$.d(Z,{AudioClassificationPipeline:()=>d,AutomaticSpeechRecognitionPipeline:()=>n,BackgroundRemovalPipeline:()=>N0,DepthEstimationPipeline:()=>A0,DocumentQuestionAnsweringPipeline:()=>p,FeatureExtractionPipeline:()=>c,FillMaskPipeline:()=>A,ImageClassificationPipeline:()=>Q0,ImageFeatureExtractionPipeline:()=>m,ImageSegmentationPipeline:()=>o,ImageToImagePipeline:()=>z0,ImageToTextPipeline:()=>t,ObjectDetectionPipeline:()=>D,Pipeline:()=>I,QuestionAnsweringPipeline:()=>g,SummarizationPipeline:()=>B,Text2TextGenerationPipeline:()=>T,TextClassificationPipeline:()=>j,TextGenerationPipeline:()=>k,TextToAudioPipeline:()=>Z0,TokenClassificationPipeline:()=>y,TranslationPipeline:()=>R,ZeroShotAudioClassificationPipeline:()=>a,ZeroShotClassificationPipeline:()=>h,ZeroShotImageClassificationPipeline:()=>w0,ZeroShotObjectDetectionPipeline:()=>O,pipeline:()=>d0});var Q=$("./src/tokenizers.js");/*! ./tokenizers.js */var W=$("./src/models.js");/*! ./models.js */var Y=$("./src/models/auto/processing_auto.js");/*! ./models/auto/processing_auto.js */var H=$("./src/base/processing_utils.js");/*! ./base/processing_utils.js */var G=$("./src/utils/generic.js");/*! ./utils/generic.js */var q=$("./src/utils/core.js");/*! ./utils/core.js */var z=$("./src/utils/maths.js");/*! ./utils/maths.js */var U=$("./src/utils/audio.js");/*! ./utils/audio.js */var N=$("./src/utils/tensor.js");/*! ./utils/tensor.js */var L=$("./src/utils/image.js");/*! ./utils/image.js */async function w(b){if(!Array.isArray(b))b=[b];return await Promise.all(b.map((S)=>L.RawImage.read(S)))}async function F(b,S){if(!Array.isArray(b))b=[b];return await Promise.all(b.map((W0)=>{if(typeof W0==="string"||W0 instanceof URL)return(0,U.read_audio)(W0,S);else if(W0 instanceof Float64Array)return new Float32Array(W0);return W0}))}function v(b,S){if(S)b=b.map((Y0)=>Y0|0);let[W0,B0,D0,R0]=b;return{xmin:W0,ymin:B0,xmax:D0,ymax:R0}}class I extends G.Callable{constructor({task:b,model:S,tokenizer:W0=null,processor:B0=null}){super();this.task=b,this.model=S,this.tokenizer=W0,this.processor=B0}async dispose(){await this.model.dispose()}}class j extends I{constructor(b){super(b)}async _call(b,{top_k:S=1}={}){let W0=this.tokenizer(b,{padding:!0,truncation:!0}),B0=await this.model(W0),D0=this.model.config.problem_type==="multi_label_classification"?(E0)=>E0.sigmoid():(E0)=>new N.Tensor("float32",(0,z.softmax)(E0.data),E0.dims),R0=this.model.config.id2label,Y0=[];for(let E0 of B0.logits){let X0=D0(E0),F0=await(0,N.topk)(X0,S),C0=F0[0].tolist(),V0=F0[1].tolist().map((u0,b0)=>({label:R0?R0[u0]:`LABEL_${u0}`,score:C0[b0]}));if(S===1)Y0.push(...V0);else Y0.push(V0)}return Array.isArray(b)||S===1?Y0:Y0[0]}}class y extends I{constructor(b){super(b)}async _call(b,{ignore_labels:S=["O"]}={}){let W0=Array.isArray(b),B0=this.tokenizer(W0?b:[b],{padding:!0,truncation:!0}),R0=(await this.model(B0)).logits,Y0=this.model.config.id2label,E0=[];for(let X0=0;X0<R0.dims[0];++X0){let F0=B0.input_ids[X0],C0=R0[X0],x0=[];for(let V0=0;V0<C0.dims[0];++V0){let u0=C0[V0],b0=(0,z.max)(u0.data)[1],s0=Y0?Y0[b0]:`LABEL_${b0}`;if(S.includes(s0))continue;let l0=this.tokenizer.decode([F0[V0].item()],{skip_special_tokens:!0});if(l0==="")continue;let y0=(0,z.softmax)(u0.data);x0.push({entity:s0,score:y0[b0],index:V0,word:l0})}E0.push(x0)}return W0?E0:E0[0]}}class g extends I{constructor(b){super(b)}async _call(b,S,{top_k:W0=1}={}){let B0=this.tokenizer(b,{text_pair:S,padding:!0,truncation:!0}),{start_logits:D0,end_logits:R0}=await this.model(B0),Y0=B0.input_ids.tolist(),E0=B0.attention_mask.tolist(),X0=this.tokenizer.all_special_ids,F0=[];for(let C0=0;C0<D0.dims[0];++C0){let x0=Y0[C0],V0=x0.findIndex((a0)=>a0==this.tokenizer.sep_token_id),u0=E0[C0].map((a0,n0)=>a0==1&&(n0===0||n0>V0&&X0.findIndex((B6)=>B6==x0[n0])===-1)),b0=D0[C0].tolist(),s0=R0[C0].tolist();for(let a0=1;a0<b0.length;++a0)if(E0[C0]==0||a0<=V0||X0.findIndex((n0)=>n0==x0[a0])!==-1)b0[a0]=-1/0,s0[a0]=-1/0;let l0=(0,z.softmax)(b0).map((a0,n0)=>[a0,n0]),y0=(0,z.softmax)(s0).map((a0,n0)=>[a0,n0]);l0[0][0]=0,y0[0][0]=0;let i0=(0,q.product)(l0,y0).filter((a0)=>a0[0][1]<=a0[1][1]).map((a0)=>[a0[0][1],a0[1][1],a0[0][0]*a0[1][0]]).sort((a0,n0)=>n0[2]-a0[2]);for(let a0=0;a0<Math.min(i0.length,W0);++a0){let[n0,B6,W6]=i0[a0],a6=x0.slice(n0,B6+1),H4=this.tokenizer.decode(a6,{skip_special_tokens:!0});F0.push({answer:H4,score:W6})}}return W0===1?F0[0]:F0}}class A extends I{constructor(b){super(b)}async _call(b,{top_k:S=5}={}){let W0=this.tokenizer(b,{padding:!0,truncation:!0}),{logits:B0}=await this.model(W0),D0=[],R0=W0.input_ids.tolist();for(let Y0=0;Y0<R0.length;++Y0){let E0=R0[Y0],X0=E0.findIndex((u0)=>u0==this.tokenizer.mask_token_id);if(X0===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let F0=B0[Y0][X0],C0=await(0,N.topk)(new N.Tensor("float32",(0,z.softmax)(F0.data),F0.dims),S),x0=C0[0].tolist(),V0=C0[1].tolist();D0.push(V0.map((u0,b0)=>{let s0=E0.slice();return s0[X0]=u0,{score:x0[b0],token:Number(u0),token_str:this.tokenizer.decode([u0]),sequence:this.tokenizer.decode(s0,{skip_special_tokens:!0})}}))}return Array.isArray(b)?D0:D0[0]}}class T extends I{_key="generated_text";constructor(b){super(b)}async _call(b,S={}){if(!Array.isArray(b))b=[b];if(this.model.config.prefix)b=b.map((E0)=>this.model.config.prefix+E0);let W0=this.model.config.task_specific_params;if(W0&&W0[this.task]){if(W0[this.task].prefix)b=b.map((E0)=>W0[this.task].prefix+E0)}let B0=this.tokenizer,D0={padding:!0,truncation:!0},R0;if(this instanceof R&&"_build_translation_inputs"in B0)R0=B0._build_translation_inputs(b,D0,S);else R0=B0(b,D0);let Y0=await this.model.generate({...R0,...S});return B0.batch_decode(Y0,{skip_special_tokens:!0}).map((E0)=>({[this._key]:E0}))}}class B extends T{_key="summary_text";constructor(b){super(b)}}class R extends T{_key="translation_text";constructor(b){super(b)}}function P(b){return Array.isArray(b)&&b.every((S)=>("role"in S)&&("content"in S))}class k extends I{constructor(b){super(b)}async _call(b,S={}){let W0=!1,B0=!1,D0=S.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,R0;if(typeof b==="string")R0=b=[b];else if(Array.isArray(b)&&b.every((V0)=>typeof V0==="string"))W0=!0,R0=b;else{if(P(b))b=[b];else if(Array.isArray(b)&&b.every(P))W0=!0;else throw Error("Input must be a string, an array of strings, a Chat, or an array of Chats");B0=!0,R0=b.map((V0)=>this.tokenizer.apply_chat_template(V0,{tokenize:!1,add_generation_prompt:!0})),D0=!1}let Y0=B0?!1:S.return_full_text??!0;this.tokenizer.padding_side="left";let E0=this.tokenizer(R0,{add_special_tokens:D0,padding:!0,truncation:!0}),X0=await this.model.generate({...E0,...S}),F0=this.tokenizer.batch_decode(X0,{skip_special_tokens:!0}),C0;if(!Y0&&E0.input_ids.dims.at(-1)>0)C0=this.tokenizer.batch_decode(E0.input_ids,{skip_special_tokens:!0}).map((V0)=>V0.length);let x0=Array.from({length:b.length},(V0)=>[]);for(let V0=0;V0<F0.length;++V0){let u0=Math.floor(V0/X0.dims[0]*b.length);if(C0)F0[V0]=F0[V0].slice(C0[u0]);x0[u0].push({generated_text:B0?[...b[u0],{role:"assistant",content:F0[V0]}]:F0[V0]})}return!W0&&x0.length===1?x0[0]:x0}}class h extends I{constructor(b){super(b);if(this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([S,W0])=>[S.toLowerCase(),W0])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0)console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2;if(this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0)console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0}async _call(b,S,{hypothesis_template:W0="This example is {}.",multi_label:B0=!1}={}){let D0=Array.isArray(b);if(!D0)b=[b];if(!Array.isArray(S))S=[S];let R0=S.map((X0)=>W0.replace("{}",X0)),Y0=B0||S.length===1,E0=[];for(let X0 of b){let F0=[];for(let V0 of R0){let u0=this.tokenizer(X0,{text_pair:V0,padding:!0,truncation:!0}),b0=await this.model(u0);if(Y0)F0.push([b0.logits.data[this.contradiction_id],b0.logits.data[this.entailment_id]]);else F0.push(b0.logits.data[this.entailment_id])}let x0=(Y0?F0.map((V0)=>(0,z.softmax)(V0)[1]):(0,z.softmax)(F0)).map((V0,u0)=>[V0,u0]).sort((V0,u0)=>u0[0]-V0[0]);E0.push({sequence:X0,labels:x0.map((V0)=>S[V0[1]]),scores:x0.map((V0)=>V0[0])})}return D0?E0:E0[0]}}class c extends I{constructor(b){super(b)}async _call(b,{pooling:S="none",normalize:W0=!1,quantize:B0=!1,precision:D0="binary"}={}){let R0=this.tokenizer(b,{padding:!0,truncation:!0}),Y0=await this.model(R0),E0=Y0.last_hidden_state??Y0.logits??Y0.token_embeddings;switch(S){case"none":break;case"mean":E0=(0,N.mean_pooling)(E0,R0.attention_mask);break;case"first_token":case"cls":E0=E0.slice(null,0);break;case"last_token":case"eos":E0=E0.slice(null,-1);break;default:throw Error(`Pooling method '${S}' not supported.`)}if(W0)E0=E0.normalize(2,-1);if(B0)E0=(0,N.quantize_embeddings)(E0,D0);return E0}}class m extends I{constructor(b){super(b)}async _call(b,{pool:S=null}={}){let W0=await w(b),{pixel_values:B0}=await this.processor(W0),D0=await this.model({pixel_values:B0}),R0;if(S){if(!("pooler_output"in D0))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");R0=D0.pooler_output}else R0=D0.last_hidden_state??D0.logits??D0.image_embeds;return R0}}class d extends I{constructor(b){super(b)}async _call(b,{top_k:S=5}={}){let W0=this.processor.feature_extractor.config.sampling_rate,B0=await F(b,W0),D0=this.model.config.id2label,R0=[];for(let Y0 of B0){let E0=await this.processor(Y0),F0=(await this.model(E0)).logits[0],C0=await(0,N.topk)(new N.Tensor("float32",(0,z.softmax)(F0.data),F0.dims),S),x0=C0[0].tolist(),u0=C0[1].tolist().map((b0,s0)=>({label:D0?D0[b0]:`LABEL_${b0}`,score:x0[s0]}));R0.push(u0)}return Array.isArray(b)?R0:R0[0]}}class a extends I{constructor(b){super(b)}async _call(b,S,{hypothesis_template:W0="This is a sound of {}."}={}){let B0=!Array.isArray(b);if(B0)b=[b];let D0=S.map((F0)=>W0.replace("{}",F0)),R0=this.tokenizer(D0,{padding:!0,truncation:!0}),Y0=this.processor.feature_extractor.config.sampling_rate,E0=await F(b,Y0),X0=[];for(let F0 of E0){let C0=await this.processor(F0),x0=await this.model({...R0,...C0}),V0=(0,z.softmax)(x0.logits_per_audio.data);X0.push([...V0].map((u0,b0)=>({score:u0,label:S[b0]})))}return B0?X0[0]:X0}}class n extends I{constructor(b){super(b)}async _call(b,S={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(b,S);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":case"parakeet_ctc":return this._call_wav2vec2(b,S);case"moonshine":return this._call_moonshine(b,S);default:throw Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(b,S){if(S.language)console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".');if(S.task)console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let W0=!Array.isArray(b);if(W0)b=[b];let B0=this.processor.feature_extractor.config.sampling_rate,D0=await F(b,B0),R0=[];for(let Y0 of D0){let E0=await this.processor(Y0),F0=(await this.model(E0)).logits[0],C0=[];for(let V0 of F0)C0.push((0,z.max)(V0.data)[1]);let x0=this.tokenizer.decode(C0,{skip_special_tokens:!0}).trim();R0.push({text:x0})}return W0?R0[0]:R0}async _call_whisper(b,S){let W0=S.return_timestamps??!1,B0=S.chunk_length_s??0,D0=S.force_full_sequences??!1,R0=S.stride_length_s??null,Y0={...S};if(W0==="word")Y0.return_token_timestamps=!0,Y0.return_timestamps=!1;let E0=!Array.isArray(b);if(E0)b=[b];let X0=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,F0=this.processor.feature_extractor.config.hop_length,C0=this.processor.feature_extractor.config.sampling_rate,x0=await F(b,C0),V0=[];for(let u0 of x0){let b0=[];if(B0>0){if(R0===null)R0=B0/6;else if(B0<=R0)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let y0=C0*B0,i0=C0*R0,a0=y0-2*i0,n0=0;while(!0){let B6=n0+y0,W6=u0.subarray(n0,B6),a6=await this.processor(W6),H4=n0===0,V4=B6>=u0.length;if(b0.push({stride:[W6.length,H4?0:i0,V4?0:i0],input_features:a6.input_features,is_last:V4}),V4)break;n0+=a0}}else b0=[{stride:[u0.length,0,0],input_features:(await this.processor(u0)).input_features,is_last:!0}];for(let y0 of b0){Y0.num_frames=Math.floor(y0.stride[0]/F0);let i0=await this.model.generate({inputs:y0.input_features,...Y0});if(W0==="word")y0.tokens=i0.sequences.tolist()[0],y0.token_timestamps=i0.token_timestamps.tolist()[0].map((a0)=>(0,z.round)(a0,2));else y0.tokens=i0[0].tolist();y0.stride=y0.stride.map((a0)=>a0/C0)}let[s0,l0]=this.tokenizer._decode_asr(b0,{time_precision:X0,return_timestamps:W0,force_full_sequences:D0});V0.push({text:s0,...l0})}return E0?V0[0]:V0}async _call_moonshine(b,S){let W0=!Array.isArray(b);if(W0)b=[b];let B0=this.processor.feature_extractor.config.sampling_rate,D0=await F(b,B0),R0=[];for(let Y0 of D0){let E0=await this.processor(Y0),X0=Math.floor(Y0.length/B0)*6,F0=await this.model.generate({max_new_tokens:X0,...S,...E0}),C0=this.processor.batch_decode(F0,{skip_special_tokens:!0})[0];R0.push({text:C0})}return W0?R0[0]:R0}}class t extends I{constructor(b){super(b)}async _call(b,S={}){let W0=Array.isArray(b),B0=await w(b),{pixel_values:D0}=await this.processor(B0),R0=[];for(let Y0 of D0){Y0.dims=[1,...Y0.dims];let E0=await this.model.generate({inputs:Y0,...S}),X0=this.tokenizer.batch_decode(E0,{skip_special_tokens:!0}).map((F0)=>({generated_text:F0.trim()}));R0.push(X0)}return W0?R0:R0[0]}}class Q0 extends I{constructor(b){super(b)}async _call(b,{top_k:S=5}={}){let W0=await w(b),{pixel_values:B0}=await this.processor(W0),D0=await this.model({pixel_values:B0}),R0=this.model.config.id2label,Y0=[];for(let E0 of D0.logits){let X0=await(0,N.topk)(new N.Tensor("float32",(0,z.softmax)(E0.data),E0.dims),S),F0=X0[0].tolist(),x0=X0[1].tolist().map((V0,u0)=>({label:R0?R0[V0]:`LABEL_${V0}`,score:F0[u0]}));Y0.push(x0)}return Array.isArray(b)?Y0:Y0[0]}}class o extends I{constructor(b){super(b);this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(b,{threshold:S=0.5,mask_threshold:W0=0.5,overlap_mask_area_threshold:B0=0.8,label_ids_to_fuse:D0=null,target_sizes:R0=null,subtask:Y0=null}={}){if(Array.isArray(b)&&b.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let X0=await w(b),F0=X0.map((y0)=>[y0.height,y0.width]),C0=await this.processor(X0),{inputNames:x0,outputNames:V0}=this.model.sessions.model;if(!x0.includes("pixel_values")){if(x0.length!==1)throw Error(`Expected a single input name, but got ${x0.length} inputs: ${x0}.`);let y0=x0[0];if(y0 in C0)throw Error(`Input name ${y0} already exists in the inputs.`);C0[y0]=C0.pixel_values}let u0=await this.model(C0),b0=null;if(Y0!==null)b0=this.subtasks_mapping[Y0];else if(this.processor.image_processor){for(let[y0,i0]of Object.entries(this.subtasks_mapping))if(i0 in this.processor.image_processor){b0=this.processor.image_processor[i0].bind(this.processor.image_processor),Y0=y0;break}}let s0=this.model.config.id2label,l0=[];if(!Y0){let i0=u0[V0[0]];for(let a0=0;a0<F0.length;++a0){let n0=F0[a0],B6=i0[a0];if(B6.data.some((a6)=>a6<-0.00001||a6>1.00001))B6.sigmoid_();let W6=await L.RawImage.fromTensor(B6.mul_(255).to("uint8")).resize(n0[1],n0[0]);l0.push({label:null,score:null,mask:W6})}}else if(Y0==="panoptic"||Y0==="instance"){let y0=b0(u0,S,W0,B0,D0,R0??F0)[0],i0=y0.segmentation;for(let a0 of y0.segments_info){let n0=new Uint8ClampedArray(i0.data.length);for(let W6=0;W6<i0.data.length;++W6)if(i0.data[W6]===a0.id)n0[W6]=255;let B6=new L.RawImage(n0,i0.dims[1],i0.dims[0],1);l0.push({score:a0.score,label:s0[a0.label_id],mask:B6})}}else if(Y0==="semantic"){let{segmentation:y0,labels:i0}=b0(u0,R0??F0)[0];for(let a0 of i0){let n0=new Uint8ClampedArray(y0.data.length);for(let W6=0;W6<y0.data.length;++W6)if(y0.data[W6]===a0)n0[W6]=255;let B6=new L.RawImage(n0,y0.dims[1],y0.dims[0],1);l0.push({score:null,label:s0[a0],mask:B6})}}else throw Error(`Subtask ${Y0} not supported.`);return l0}}class N0 extends o{constructor(b){super(b)}async _call(b,S={}){if(Array.isArray(b)&&b.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");let B0=await w(b),D0=await super._call(b,S);return B0.map((Y0,E0)=>{let X0=Y0.clone();return X0.putAlpha(D0[E0].mask),X0})}}class w0 extends I{constructor(b){super(b)}async _call(b,S,{hypothesis_template:W0="This is a photo of {}"}={}){let B0=Array.isArray(b),D0=await w(b),R0=S.map((x0)=>W0.replace("{}",x0)),Y0=this.tokenizer(R0,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:E0}=await this.processor(D0),X0=await this.model({...Y0,pixel_values:E0}),F0=this.model.config.model_type==="siglip"?(x0)=>x0.sigmoid().data:(x0)=>(0,z.softmax)(x0.data),C0=[];for(let x0 of X0.logits_per_image){let u0=[...F0(x0)].map((b0,s0)=>({score:b0,label:S[s0]}));u0.sort((b0,s0)=>s0.score-b0.score),C0.push(u0)}return B0?C0:C0[0]}}class D extends I{constructor(b){super(b)}async _call(b,{threshold:S=0.9,percentage:W0=!1}={}){let B0=Array.isArray(b);if(B0&&b.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");let D0=await w(b),R0=W0?null:D0.map((V0)=>[V0.height,V0.width]),{pixel_values:Y0,pixel_mask:E0}=await this.processor(D0),X0=await this.model({pixel_values:Y0,pixel_mask:E0}),F0=this.processor.image_processor.post_process_object_detection(X0,S,R0),C0=this.model.config.id2label,x0=F0.map((V0)=>V0.boxes.map((u0,b0)=>({score:V0.scores[b0],label:C0[V0.classes[b0]],box:v(u0,!W0)})));return B0?x0:x0[0]}}class O extends I{constructor(b){super(b)}async _call(b,S,{threshold:W0=0.1,top_k:B0=null,percentage:D0=!1}={}){let R0=Array.isArray(b),Y0=await w(b),E0=this.tokenizer(S,{padding:!0,truncation:!0}),X0=await this.processor(Y0),F0=[];for(let C0=0;C0<Y0.length;++C0){let x0=Y0[C0],V0=D0?null:[[x0.height,x0.width]],u0=X0.pixel_values[C0].unsqueeze_(0),b0=await this.model({...E0,pixel_values:u0}),s0;if("post_process_grounded_object_detection"in this.processor){let l0=this.processor.post_process_grounded_object_detection(b0,E0.input_ids,{box_threshold:W0,text_threshold:W0,target_sizes:V0})[0];s0=l0.boxes.map((y0,i0)=>({score:l0.scores[i0],label:l0.labels[i0],box:v(y0,!D0)}))}else{let l0=this.processor.image_processor.post_process_object_detection(b0,W0,V0,!0)[0];s0=l0.boxes.map((y0,i0)=>({score:l0.scores[i0],label:S[l0.classes[i0]],box:v(y0,!D0)}))}if(s0.sort((l0,y0)=>y0.score-l0.score),B0!==null)s0=s0.slice(0,B0);F0.push(s0)}return R0?F0:F0[0]}}class p extends I{constructor(b){super(b)}async _call(b,S,W0={}){let B0=(await w(b))[0],{pixel_values:D0}=await this.processor(B0),R0=`<s_docvqa><s_question>${S}</s_question><s_answer>`,Y0=this.tokenizer(R0,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,E0=await this.model.generate({inputs:D0,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:Y0,...W0}),F0=this.tokenizer.batch_decode(E0)[0].match(/<s_answer>(.*?)<\/s_answer>/),C0=null;if(F0&&F0.length>=2)C0=F0[1].trim();return[{answer:C0}]}}class Z0 extends I{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(b){super(b);this.vocoder=b.vocoder??null}async _call(b,{speaker_embeddings:S=null}={}){if(this.processor)return this._call_text_to_spectrogram(b,{speaker_embeddings:S});else return this._call_text_to_waveform(b)}async _call_text_to_waveform(b){let S=this.tokenizer(b,{padding:!0,truncation:!0}),{waveform:W0}=await this.model(S),B0=this.model.config.sampling_rate;return new U.RawAudio(W0.data,B0)}async _call_text_to_spectrogram(b,{speaker_embeddings:S}){if(!this.vocoder)console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await W.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"});if(typeof S==="string"||S instanceof URL)S=new Float32Array(await(await fetch(S)).arrayBuffer());if(S instanceof Float32Array)S=new N.Tensor("float32",S,[1,S.length]);else if(!(S instanceof N.Tensor))throw Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:W0}=this.tokenizer(b,{padding:!0,truncation:!0}),{waveform:B0}=await this.model.generate_speech(W0,S,{vocoder:this.vocoder}),D0=this.processor.feature_extractor.config.sampling_rate;return new U.RawAudio(B0.data,D0)}}class z0 extends I{constructor(b){super(b)}async _call(b){let S=await w(b),W0=await this.processor(S),B0=await this.model(W0),D0=[];for(let R0 of B0.reconstruction){let Y0=R0.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");D0.push(L.RawImage.fromTensor(Y0))}return D0.length>1?D0:D0[0]}}class A0 extends I{constructor(b){super(b)}async _call(b){let S=await w(b),W0=await this.processor(S),{predicted_depth:B0}=await this.model(W0),D0=[];for(let R0=0;R0<S.length;++R0){let Y0=B0[R0],[E0,X0]=Y0.dims.slice(-2),[F0,C0]=S[R0].size,x0=(await(0,N.interpolate_4d)(Y0.view(1,1,E0,X0),{size:[C0,F0],mode:"bilinear"})).view(C0,F0),V0=x0.min().item(),u0=x0.max().item(),b0=x0.sub(V0).div_(u0-V0).mul_(255).to("uint8").unsqueeze(0),s0=L.RawImage.fromTensor(b0);D0.push({predicted_depth:x0,depth:s0})}return D0.length>1?D0:D0[0]}}let j0=Object.freeze({"text-classification":{tokenizer:Q.AutoTokenizer,pipeline:j,model:W.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:Q.AutoTokenizer,pipeline:y,model:W.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:Q.AutoTokenizer,pipeline:g,model:W.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:Q.AutoTokenizer,pipeline:A,model:W.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:Q.AutoTokenizer,pipeline:B,model:W.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:Q.AutoTokenizer,pipeline:R,model:W.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:Q.AutoTokenizer,pipeline:T,model:W.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:Q.AutoTokenizer,pipeline:k,model:W.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:Q.AutoTokenizer,pipeline:h,model:W.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:d,model:W.AutoModelForAudioClassification,processor:Y.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:Q.AutoTokenizer,pipeline:a,model:W.AutoModel,processor:Y.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:Q.AutoTokenizer,pipeline:n,model:[W.AutoModelForSpeechSeq2Seq,W.AutoModelForCTC],processor:Y.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:Q.AutoTokenizer,pipeline:Z0,model:[W.AutoModelForTextToWaveform,W.AutoModelForTextToSpectrogram],processor:[Y.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:Q.AutoTokenizer,pipeline:t,model:W.AutoModelForVision2Seq,processor:Y.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:Q0,model:W.AutoModelForImageClassification,processor:Y.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:o,model:[W.AutoModelForImageSegmentation,W.AutoModelForSemanticSegmentation,W.AutoModelForUniversalSegmentation],processor:Y.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:N0,model:[W.AutoModelForImageSegmentation,W.AutoModelForSemanticSegmentation,W.AutoModelForUniversalSegmentation],processor:Y.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:Q.AutoTokenizer,pipeline:w0,model:W.AutoModel,processor:Y.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:D,model:W.AutoModelForObjectDetection,processor:Y.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:Q.AutoTokenizer,pipeline:O,model:W.AutoModelForZeroShotObjectDetection,processor:Y.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:Q.AutoTokenizer,pipeline:p,model:W.AutoModelForDocumentQuestionAnswering,processor:Y.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:z0,model:W.AutoModelForImageToImage,processor:Y.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:A0,model:W.AutoModelForDepthEstimation,processor:Y.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:Q.AutoTokenizer,pipeline:c,model:W.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:Y.AutoProcessor,pipeline:m,model:[W.AutoModelForImageFeatureExtraction,W.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),h0=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function d0(b,S=null,{progress_callback:W0=null,config:B0=null,cache_dir:D0=null,local_files_only:R0=!1,revision:Y0="main",device:E0=null,dtype:X0=null,subfolder:F0="onnx",use_external_data_format:C0=null,model_file_name:x0=null,session_options:V0={}}={}){b=h0[b]??b;let u0=j0[b.split("_",1)[0]];if(!u0)throw Error(`Unsupported pipeline: ${b}. Must be one of [${Object.keys(j0)}]`);if(!S)S=u0.default.model,console.log(`No model specified. Using default model: "${S}".`);let b0={progress_callback:W0,config:B0,cache_dir:D0,local_files_only:R0,revision:Y0,device:E0,dtype:X0,subfolder:F0,use_external_data_format:C0,model_file_name:x0,session_options:V0},s0=new Map([["tokenizer",u0.tokenizer],["model",u0.model],["processor",u0.processor]]),l0=await T0(s0,S,b0);return l0.task=b,(0,q.dispatchCallback)(W0,{status:"ready",task:b,model:S}),new u0.pipeline(l0)}async function T0(b,S,W0){let B0=Object.create(null),D0=[];for(let[R0,Y0]of b.entries()){if(!Y0)continue;let E0;if(Array.isArray(Y0))E0=new Promise(async(X0,F0)=>{let C0;for(let x0 of Y0){if(x0===null){X0(null);return}try{X0(await x0.from_pretrained(S,W0));return}catch(V0){if(V0.message?.includes("Unsupported model type"))C0=V0;else if(V0.message?.includes("Could not locate file"))C0=V0;else{F0(V0);return}}}F0(C0)});else E0=Y0.from_pretrained(S,W0);B0[R0]=E0,D0.push(E0)}await Promise.all(D0);for(let[R0,Y0]of Object.entries(B0))B0[R0]=await Y0;return B0}},"./src/tokenizers.js":(J,Z,$)=>{/*!***************************!*\
  !*** ./src/tokenizers.js ***!
  \***************************/$.r(Z),$.d(Z,{AlbertTokenizer:()=>KJ,AutoTokenizer:()=>oJ,BartTokenizer:()=>E6,BertTokenizer:()=>WJ,BlenderbotSmallTokenizer:()=>P6,BlenderbotTokenizer:()=>m0,BloomTokenizer:()=>F4,CLIPTokenizer:()=>HJ,CamembertTokenizer:()=>L0,CodeGenTokenizer:()=>a4,CodeLlamaTokenizer:()=>D4,CohereTokenizer:()=>kJ,ConvBertTokenizer:()=>f,DebertaTokenizer:()=>E,DebertaV2Tokenizer:()=>u,DistilBertTokenizer:()=>G0,ElectraTokenizer:()=>t0,Ernie4_5_Tokenizer:()=>yJ,EsmTokenizer:()=>c4,FalconTokenizer:()=>O4,GPT2Tokenizer:()=>U6,GPTNeoXTokenizer:()=>GJ,GemmaTokenizer:()=>k4,Grok1Tokenizer:()=>x4,HerbertTokenizer:()=>C,LlamaTokenizer:()=>p6,M2M100Tokenizer:()=>m4,MBart50Tokenizer:()=>j6,MBartTokenizer:()=>x6,MPNetTokenizer:()=>l4,MarianTokenizer:()=>P0,MgpstrTokenizer:()=>xJ,MobileBertTokenizer:()=>H6,NllbTokenizer:()=>qJ,NougatTokenizer:()=>p4,PreTrainedTokenizer:()=>Z6,Qwen2Tokenizer:()=>j4,RoFormerTokenizer:()=>r,RobertaTokenizer:()=>U4,SiglipTokenizer:()=>Y4,SpeechT5Tokenizer:()=>VJ,SqueezeBertTokenizer:()=>YJ,T5Tokenizer:()=>v0,TokenizerModel:()=>c,VitsTokenizer:()=>C4,Wav2Vec2CTCTokenizer:()=>S0,WhisperTokenizer:()=>P4,XLMRobertaTokenizer:()=>g4,XLMTokenizer:()=>c0,is_chinese_char:()=>g});var Q=$("./src/utils/generic.js");/*! ./utils/generic.js */var W=$("./src/utils/core.js");/*! ./utils/core.js */var Y=$("./src/utils/hub.js");/*! ./utils/hub.js */var H=$("./src/utils/maths.js");/*! ./utils/maths.js */var G=$("./src/utils/tensor.js");/*! ./utils/tensor.js */var q=$("./src/utils/data-structures.js");/*! ./utils/data-structures.js */var z=$("./node_modules/@huggingface/jinja/dist/index.js");/*! @huggingface/jinja */var U=$("./src/models/whisper/common_whisper.js");/*! ./models/whisper/common_whisper.js */async function N(V,_){let l=await Promise.all([(0,Y.getModelJSON)(V,"tokenizer.json",!0,_),(0,Y.getModelJSON)(V,"tokenizer_config.json",!0,_)]);if(_.legacy!==null)l[1].legacy=_.legacy;return l}function L(V,_){let l=[],s=0;for(let $0 of V.matchAll(_)){let U0=$0[0];if(s<$0.index)l.push(V.slice(s,$0.index));if(U0.length>0)l.push(U0);s=$0.index+U0.length}if(s<V.length)l.push(V.slice(s));return l}function w(V,_=!0){if(V.Regex!==void 0){let l=V.Regex.replace(/\\([#&~])/g,"$1");for(let[s,$0]of k)l=l.replaceAll(s,$0);return new RegExp(l,"gu")}else if(V.String!==void 0){let l=(0,W.escapeRegExp)(V.String);return new RegExp(_?l:`(${l})`,"gu")}else return console.warn("Unknown pattern type:",V),null}function F(V){return new Map(Object.entries(V))}function v(V){let _=V.dims;switch(_.length){case 1:return V.tolist();case 2:if(_[0]!==1)throw Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return V.tolist()[0];default:throw Error(`Expected tensor to have 1-2 dimensions, got ${_.length}.`)}}function I(V){return V.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function j(V){return V.replace(/\p{M}/gu,"")}function y(V){return j(V.toLowerCase())}function g(V){return V>=19968&&V<=40959||V>=13312&&V<=19903||V>=131072&&V<=173791||V>=173824&&V<=177983||V>=177984&&V<=178207||V>=178208&&V<=183983||V>=63744&&V<=64255||V>=194560&&V<=195103}function A(V,_,l){let s=[],$0=0;while($0<V.length){if(s.push(V[$0]),(_.get(V[$0])??l)!==l){++$0;continue}while(++$0<V.length&&(_.get(V[$0])??l)===l)if(_.get(s.at(-1))!==l)s[s.length-1]+=V[$0]}return s}function T(V){return V.match(/\S+/g)||[]}let B="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",R=new RegExp(`^[${B}]+$`,"gu"),P=".,!?",k=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${P}])]+`,` ?[^\\s${P}]+`]]);class h{constructor(V){this.content=V.content,this.id=V.id,this.single_word=V.single_word??!1,this.lstrip=V.lstrip??!1,this.rstrip=V.rstrip??!1,this.special=V.special??!1,this.normalized=V.normalized??null}}class c extends Q.Callable{constructor(V){super();this.config=V,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(V,..._){switch(V.type){case"WordPiece":return new m(V);case"Unigram":return new d(V,..._);case"BPE":return new t(V);default:if(V.vocab)if(Array.isArray(V.vocab))return new d(V,..._);else if(Object.hasOwn(V,"continuing_subword_prefix")&&Object.hasOwn(V,"unk_token"))if(Object.hasOwn(V,"merges"))return new t(V);else return new m(V);else return new Q0(V,..._);throw Error(`Unknown TokenizerModel type: ${V.type}`)}}_call(V){if(V=this.encode(V),this.fuse_unk)V=A(V,this.tokens_to_ids,this.unk_token_id);return V}encode(V){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(V){return V.map((_)=>this.tokens_to_ids.get(_)??this.unk_token_id)}convert_ids_to_tokens(V){return V.map((_)=>this.vocab[_]??this.unk_token)}}class m extends c{constructor(V){super(V);this.tokens_to_ids=F(V.vocab),this.unk_token_id=this.tokens_to_ids.get(V.unk_token),this.unk_token=V.unk_token,this.max_input_chars_per_word=V.max_input_chars_per_word??100,this.vocab=Array(this.tokens_to_ids.size);for(let[_,l]of this.tokens_to_ids)this.vocab[l]=_}encode(V){let _=[];for(let l of V){let s=[...l];if(s.length>this.max_input_chars_per_word){_.push(this.unk_token);continue}let $0=!1,U0=0,k0=[];while(U0<s.length){let O0=s.length,f0=null;while(U0<O0){let _0=s.slice(U0,O0).join("");if(U0>0)_0=this.config.continuing_subword_prefix+_0;if(this.tokens_to_ids.has(_0)){f0=_0;break}--O0}if(f0===null){$0=!0;break}k0.push(f0),U0=O0}if($0)_.push(this.unk_token);else _.push(...k0)}return _}}class d extends c{constructor(V,_){super(V);let l=V.vocab.length;this.vocab=Array(l),this.scores=Array(l);for(let s=0;s<l;++s)[this.vocab[s],this.scores[s]]=V.vocab[s];this.unk_token_id=V.unk_id,this.unk_token=this.vocab[V.unk_id],this.tokens_to_ids=new Map(this.vocab.map((s,$0)=>[s,$0])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=_.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,H.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new q.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(V){let _=V.chars,l=1,s=0;while(s<_.length){let $0=!1,U0=[],k0=_.slice(s).join(""),O0=this.trie.commonPrefixSearch(k0);for(let f0 of O0){U0.push(f0);let _0=this.tokens_to_ids.get(f0),L6=this.scores[_0],X6=(0,W.len)(f0);if(V.insert(s,X6,L6,_0),!$0&&X6===1)$0=!0}if(!$0)V.insert(s,1,this.unk_score,this.unk_token_id);s+=1}}tokenize(V){let _=new q.TokenLattice(V,this.bos_token_id,this.eos_token_id);return this.populateNodes(_),_.tokens()}encode(V){let _=[];for(let l of V){let s=this.tokenize(l);_.push(...s)}return _}}let a=(()=>{let V=[...Array.from({length:94},($0,U0)=>U0+33),...Array.from({length:"".charCodeAt(0)-"".charCodeAt(0)+1},($0,U0)=>U0+"".charCodeAt(0)),...Array.from({length:"".charCodeAt(0)-"".charCodeAt(0)+1},($0,U0)=>U0+"".charCodeAt(0))],_=V.slice(),l=0;for(let $0=0;$0<256;++$0)if(!V.includes($0))V.push($0),_.push(256+l),l+=1;let s=_.map(($0)=>String.fromCharCode($0));return Object.fromEntries(V.map(($0,U0)=>[$0,s[U0]]))})(),n=(0,W.reverseDictionary)(a);class t extends c{constructor(V){super(V);this.tokens_to_ids=F(V.vocab),this.unk_token_id=this.tokens_to_ids.get(V.unk_token),this.unk_token=V.unk_token,this.vocab=Array(this.tokens_to_ids.size);for(let[l,s]of this.tokens_to_ids)this.vocab[s]=l;let _=Array.isArray(V.merges[0]);if(this.merges=_?V.merges:V.merges.map((l)=>l.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((l,s)=>[JSON.stringify(l),s])),this.end_of_word_suffix=V.end_of_word_suffix,this.continuing_subword_suffix=V.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback)this.text_encoder=new TextEncoder;this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new q.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(V){if(V.length===0)return[];let _=this.cache.get(V);if(_!==void 0)return _;let l=Array.from(V);if(this.end_of_word_suffix)l[l.length-1]+=this.end_of_word_suffix;let s=[];if(l.length>1){let $0=new q.PriorityQueue((O0,f0)=>O0.score<f0.score),U0={token:l[0],bias:0,prev:null,next:null},k0=U0;for(let O0=1;O0<l.length;++O0){let f0={bias:O0/l.length,token:l[O0],prev:k0,next:null};k0.next=f0,this._add_node($0,k0),k0=f0}while(!$0.isEmpty()){let O0=$0.pop();if(O0.deleted||!O0.next||O0.next.deleted)continue;if(O0.deleted=!0,O0.next.deleted=!0,O0.prev){let _0={...O0.prev};if(O0.prev.deleted=!0,O0.prev=_0,_0.prev)_0.prev.next=_0;else U0=_0}let f0={token:O0.token+O0.next.token,bias:O0.bias,prev:O0.prev,next:O0.next.next};if(f0.prev)f0.prev.next=f0,this._add_node($0,f0.prev);else U0=f0;if(f0.next)f0.next.prev=f0,this._add_node($0,f0)}for(let O0=U0;O0!==null;O0=O0.next)s.push(O0.token)}else s=l;if(this.continuing_subword_suffix)for(let $0=0;$0<s.length-1;++$0)s[$0]+=this.continuing_subword_suffix;if(V.length<this.max_length_to_cache)this.cache.put(V,s);return s}_add_node(V,_){let l=this.bpe_ranks.get(JSON.stringify([_.token,_.next.token]));if(l!==void 0)_.score=l+_.bias,V.push(_)}encode(V){let _=[];for(let l of V){if(this.ignore_merges&&this.tokens_to_ids.has(l)){_.push(l);continue}let s=this.bpe(l);for(let $0 of s)if(this.tokens_to_ids.has($0))_.push($0);else if(this.byte_fallback){let U0=Array.from(this.text_encoder.encode($0)).map((k0)=>`<0x${k0.toString(16).toUpperCase().padStart(2,"0")}>`);if(U0.every((k0)=>this.tokens_to_ids.has(k0)))_.push(...U0);else _.push(this.unk_token)}else _.push(this.unk_token)}return _}}class Q0 extends c{constructor(V,_){super(V);this.tokens_to_ids=F(_.target_lang?V.vocab[_.target_lang]:V.vocab),this.bos_token=_.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=_.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=_.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=_.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=Array(this.tokens_to_ids.size);for(let[l,s]of this.tokens_to_ids)this.vocab[s]=l}encode(V){return V}}class o extends Q.Callable{constructor(V){super();this.config=V}static fromConfig(V){if(V===null)return null;switch(V.type){case"BertNormalizer":return new T0(V);case"Precompiled":return new V4(V);case"Sequence":return new d0(V);case"Replace":return new N0(V);case"NFC":return new D(V);case"NFD":return new O(V);case"NFKC":return new p(V);case"NFKD":return new Z0(V);case"Strip":return new z0(V);case"StripAccents":return new A0(V);case"Lowercase":return new j0(V);case"Prepend":return new h0(V);default:throw Error(`Unknown Normalizer type: ${V.type}`)}}normalize(V){throw Error("normalize should be implemented in subclass.")}_call(V){return this.normalize(V)}}class N0 extends o{normalize(V){let _=w(this.config.pattern);return _===null?V:V.replaceAll(_,this.config.content)}}class w0 extends o{form=void 0;normalize(V){return V=V.normalize(this.form),V}}class D extends w0{form="NFC"}class O extends w0{form="NFD"}class p extends w0{form="NFKC"}class Z0 extends w0{form="NFKD"}class z0 extends o{normalize(V){if(this.config.strip_left&&this.config.strip_right)V=V.trim();else{if(this.config.strip_left)V=V.trimStart();if(this.config.strip_right)V=V.trimEnd()}return V}}class A0 extends o{normalize(V){return V=j(V),V}}class j0 extends o{normalize(V){return V=V.toLowerCase(),V}}class h0 extends o{normalize(V){return V=this.config.prepend+V,V}}class d0 extends o{constructor(V){super(V);this.normalizers=V.normalizers.map((_)=>o.fromConfig(_))}normalize(V){return this.normalizers.reduce((_,l)=>{return l.normalize(_)},V)}}class T0 extends o{_tokenize_chinese_chars(V){let _=[];for(let l=0;l<V.length;++l){let s=V[l],$0=s.charCodeAt(0);if(g($0))_.push(" "),_.push(s),_.push(" ");else _.push(s)}return _.join("")}stripAccents(V){return V.normalize("NFD").replace(/\p{Mn}/gu,"")}_is_control(V){switch(V){case"\t":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(V)}}_clean_text(V){let _=[];for(let l of V){let s=l.charCodeAt(0);if(s===0||s===65533||this._is_control(l))continue;if(/^\s$/.test(l))_.push(" ");else _.push(l)}return _.join("")}normalize(V){if(this.config.clean_text)V=this._clean_text(V);if(this.config.handle_chinese_chars)V=this._tokenize_chinese_chars(V);if(this.config.lowercase){if(V=V.toLowerCase(),this.config.strip_accents!==!1)V=this.stripAccents(V)}else if(this.config.strip_accents)V=this.stripAccents(V);return V}}class b extends Q.Callable{static fromConfig(V){if(V===null)return null;switch(V.type){case"BertPreTokenizer":return new S(V);case"Sequence":return new _4(V);case"Whitespace":return new k6(V);case"WhitespaceSplit":return new o6(V);case"Metaspace":return new a6(V);case"ByteLevel":return new W0(V);case"Split":return new B0(V);case"Punctuation":return new D0(V);case"Digits":return new R0(V);case"Replace":return new DJ(V);default:throw Error(`Unknown PreTokenizer type: ${V.type}`)}}pre_tokenize_text(V,_){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(V,_){return(Array.isArray(V)?V.map((l)=>this.pre_tokenize_text(l,_)):this.pre_tokenize_text(V,_)).flat()}_call(V,_){return this.pre_tokenize(V,_)}}class S extends b{constructor(V){super();this.pattern=new RegExp(`[^\\s${B}]+|[${B}]`,"gu")}pre_tokenize_text(V,_){return V.trim().match(this.pattern)||[]}}class W0 extends b{constructor(V){super();this.config=V,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=a,this.text_encoder=new TextEncoder}pre_tokenize_text(V,_){if(this.add_prefix_space&&!V.startsWith(" "))V=" "+V;return(this.use_regex?V.match(this.pattern)||[]:[V]).map((s)=>Array.from(this.text_encoder.encode(s),($0)=>this.byte_encoder[$0]).join(""))}}class B0 extends b{constructor(V){super();this.config=V,this.pattern=w(this.config.pattern,this.config.invert)}pre_tokenize_text(V,_){if(this.pattern===null)return[];if(this.config.invert)return V.match(this.pattern)||[];else if(this.config.behavior?.toLowerCase()==="removed")return V.split(this.pattern).filter((l)=>l);else return L(V,this.pattern)}}class D0 extends b{constructor(V){super();this.config=V,this.pattern=new RegExp(`[^${B}]+|[${B}]+`,"gu")}pre_tokenize_text(V,_){return V.match(this.pattern)||[]}}class R0 extends b{constructor(V){super();this.config=V;let _=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(_,"gu")}pre_tokenize_text(V,_){return V.match(this.pattern)||[]}}class Y0 extends Q.Callable{constructor(V){super();this.config=V}static fromConfig(V){if(V===null)return null;switch(V.type){case"TemplateProcessing":return new F0(V);case"ByteLevel":return new C0(V);case"RobertaProcessing":return new X0(V);case"BertProcessing":return new E0(V);case"Sequence":return new x0(V);default:throw Error(`Unknown PostProcessor type: ${V.type}`)}}post_process(V,..._){throw Error("post_process should be implemented in subclass.")}_call(V,..._){return this.post_process(V,..._)}}class E0 extends Y0{constructor(V){super(V);this.cls=V.cls[0],this.sep=V.sep[0]}post_process(V,_=null,{add_special_tokens:l=!0}={}){if(l)V=(0,W.mergeArrays)([this.cls],V,[this.sep]);let s=Array(V.length).fill(0);if(_!==null){let $0=l&&this instanceof X0?[this.sep]:[],U0=l?[this.sep]:[];V=(0,W.mergeArrays)(V,$0,_,U0),s=(0,W.mergeArrays)(s,Array(_.length+$0.length+U0.length).fill(1))}return{tokens:V,token_type_ids:s}}}class X0 extends E0{}class F0 extends Y0{constructor(V){super(V);this.single=V.single,this.pair=V.pair}post_process(V,_=null,{add_special_tokens:l=!0}={}){let s=_===null?this.single:this.pair,$0=[],U0=[];for(let k0 of s)if("SpecialToken"in k0){if(l)$0.push(k0.SpecialToken.id),U0.push(k0.SpecialToken.type_id)}else if("Sequence"in k0){if(k0.Sequence.id==="A")$0=(0,W.mergeArrays)($0,V),U0=(0,W.mergeArrays)(U0,Array(V.length).fill(k0.Sequence.type_id));else if(k0.Sequence.id==="B")$0=(0,W.mergeArrays)($0,_),U0=(0,W.mergeArrays)(U0,Array(_.length).fill(k0.Sequence.type_id))}return{tokens:$0,token_type_ids:U0}}}class C0 extends Y0{post_process(V,_=null){if(_)V=(0,W.mergeArrays)(V,_);return{tokens:V}}}class x0 extends Y0{constructor(V){super(V);this.processors=V.processors.map((_)=>Y0.fromConfig(_))}post_process(V,_=null,l={}){let s;for(let $0 of this.processors)if($0 instanceof C0){if(V=$0.post_process(V).tokens,_)_=$0.post_process(_).tokens}else{let U0=$0.post_process(V,_,l);V=U0.tokens,s=U0.token_type_ids}return{tokens:V,token_type_ids:s}}}class V0 extends Q.Callable{constructor(V){super();this.config=V,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=V.trim_offsets}static fromConfig(V){if(V===null)return null;switch(V.type){case"WordPiece":return new y0(V);case"Metaspace":return new H4(V);case"ByteLevel":return new i0(V);case"Replace":return new u0(V);case"ByteFallback":return new b0(V);case"Fuse":return new s0(V);case"Strip":return new l0(V);case"Sequence":return new n0(V);case"CTC":return new a0(V);case"BPEDecoder":return new B6(V);default:throw Error(`Unknown Decoder type: ${V.type}`)}}_call(V){return this.decode(V)}decode(V){return this.decode_chain(V).join("")}decode_chain(V){throw Error("`decode_chain` should be implemented in subclass.")}}class u0 extends V0{decode_chain(V){let _=w(this.config.pattern);return _===null?V:V.map((l)=>l.replaceAll(_,this.config.content))}}class b0 extends V0{constructor(V){super(V);this.text_decoder=new TextDecoder}decode_chain(V){let _=[],l=[];for(let s of V){let $0=null;if(s.length===6&&s.startsWith("<0x")&&s.endsWith(">")){let U0=parseInt(s.slice(3,5),16);if(!isNaN(U0))$0=U0}if($0!==null)l.push($0);else{if(l.length>0){let U0=this.text_decoder.decode(Uint8Array.from(l));_.push(U0),l=[]}_.push(s)}}if(l.length>0){let s=this.text_decoder.decode(Uint8Array.from(l));_.push(s),l=[]}return _}}class s0 extends V0{decode_chain(V){return[V.join("")]}}class l0 extends V0{constructor(V){super(V);this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(V){return V.map((_)=>{let l=0;for(let $0=0;$0<this.start;++$0)if(_[$0]===this.content){l=$0+1;continue}else break;let s=_.length;for(let $0=0;$0<this.stop;++$0){let U0=_.length-$0-1;if(_[U0]===this.content){s=U0;continue}else break}return _.slice(l,s)})}}class y0 extends V0{constructor(V){super(V);this.cleanup=V.cleanup}decode_chain(V){return V.map((_,l)=>{if(l!==0)if(_.startsWith(this.config.prefix))_=_.replace(this.config.prefix,"");else _=" "+_;if(this.cleanup)_=I(_);return _})}}class i0 extends V0{constructor(V){super(V);this.byte_decoder=n,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(V){let _=V.join(""),l=new Uint8Array([..._].map(($0)=>this.byte_decoder[$0]));return this.text_decoder.decode(l)}decode_chain(V){let _=[],l=[];for(let s of V)if(this.added_tokens.find(($0)=>$0.content===s)!==void 0){if(l.length>0)_.push(this.convert_tokens_to_string(l)),l=[];_.push(s)}else l.push(s);if(l.length>0)_.push(this.convert_tokens_to_string(l));return _}}class a0 extends V0{constructor(V){super(V);this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(V){if(V.length===0)return"";let _=[V[0]];for(let $0=1;$0<V.length;++$0)if(V[$0]!==_.at(-1))_.push(V[$0]);let s=_.filter(($0)=>$0!==this.pad_token).join("");if(this.cleanup)s=I(s).replaceAll(this.word_delimiter_token," ").trim();return s}decode_chain(V){return[this.convert_tokens_to_string(V)]}}class n0 extends V0{constructor(V){super(V);this.decoders=V.decoders.map((_)=>V0.fromConfig(_))}decode_chain(V){return this.decoders.reduce((_,l)=>{return l.decode_chain(_)},V)}}class B6 extends V0{constructor(V){super(V);this.suffix=this.config.suffix}decode_chain(V){return V.map((_,l)=>{return _.replaceAll(this.suffix,l===V.length-1?"":" ")})}}class W6 extends V0{decode_chain(V){let _="";for(let l=1;l<V.length;l+=2)_+=V[l];return[_]}}class a6 extends b{constructor(V){super();this.addPrefixSpace=V.add_prefix_space,this.replacement=V.replacement,this.strRep=V.str_rep||this.replacement,this.prepend_scheme=V.prepend_scheme??"always"}pre_tokenize_text(V,{section_index:_=void 0}={}){let l=V.replaceAll(" ",this.strRep);if(this.addPrefixSpace&&!l.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&_===0))l=this.strRep+l;return[l]}}class H4 extends V0{constructor(V){super(V);this.addPrefixSpace=V.add_prefix_space,this.replacement=V.replacement}decode_chain(V){let _=[];for(let l=0;l<V.length;++l){let s=V[l].replaceAll(this.replacement," ");if(this.addPrefixSpace&&l==0&&s.startsWith(" "))s=s.substring(1);_.push(s)}return _}}class V4 extends o{constructor(V){super(V);this.charsmap=V.precompiled_charsmap}normalize(V){if(V=V.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),V=V.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),V.includes(""))V=V.split("").map((l)=>l.normalize("NFKC")).join("");else V=V.normalize("NFKC");return V}}class _4 extends b{constructor(V){super();this.tokenizers=V.pretokenizers.map((_)=>b.fromConfig(_))}pre_tokenize_text(V,_){return this.tokenizers.reduce((l,s)=>{return s.pre_tokenize(l,_)},[V])}}class k6 extends b{constructor(V){super()}pre_tokenize_text(V,_){return V.match(/\w+|[^\w\s]+/g)||[]}}class o6 extends b{constructor(V){super()}pre_tokenize_text(V,_){return T(V)}}class DJ extends b{constructor(V){super();this.config=V,this.pattern=w(this.config.pattern),this.content=this.config.content}pre_tokenize_text(V,_){if(this.pattern===null)return[V];return[V.replaceAll(this.pattern,this.config.content)]}}let TJ=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function _J(V,_,l,s){for(let $0 of Object.keys(V)){let U0=_-V[$0].length,k0=l($0),O0=Array(U0).fill(k0);V[$0]=s==="right"?(0,W.mergeArrays)(V[$0],O0):(0,W.mergeArrays)(O0,V[$0])}}function v4(V,_){for(let l of Object.keys(V))V[l].length=_}class Z6 extends Q.Callable{return_token_type_ids=!1;padding_side="right";constructor(V,_){super();this.config=_,this.normalizer=o.fromConfig(V.normalizer),this.pre_tokenizer=b.fromConfig(V.pre_tokenizer),this.model=c.fromConfig(V.model,_),this.post_processor=Y0.fromConfig(V.post_processor),this.decoder=V0.fromConfig(V.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(let l of V.added_tokens){let s=new h(l);if(this.added_tokens.push(s),this.model.tokens_to_ids.set(s.content,s.id),this.model.vocab[s.id]=s.content,s.special)this.special_tokens.push(s.content),this.all_special_ids.push(s.id)}if(this.additional_special_tokens=_.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder)this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix;if(this.added_tokens_splitter=new q.DictionarySplitter(this.added_tokens.map((l)=>l.content)),this.added_tokens_map=new Map(this.added_tokens.map((l)=>[l.content,l])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=_.model_max_length,this.remove_space=_.remove_space,this.clean_up_tokenization_spaces=_.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=_.do_lowercase_and_remove_accent??!1,_.padding_side)this.padding_side=_.padding_side;if(this.add_bos_token=_.add_bos_token,this.add_eos_token=_.add_eos_token,this.legacy=!1,this.chat_template=_.chat_template??null,Array.isArray(this.chat_template)){let l=Object.create(null);for(let{name:s,template:$0}of this.chat_template){if(typeof s!=="string"||typeof $0!=="string")throw Error('Chat template must be a list of objects with "name" and "template" properties');l[s]=$0}this.chat_template=l}this._compiled_template_cache=new Map}getToken(...V){for(let _ of V){let l=this.config[_];if(!l)continue;if(typeof l==="object")if(l.__type==="AddedToken")return l.content;else throw Error(`Unknown token: ${l}`);else return l}return null}static async from_pretrained(V,{progress_callback:_=null,config:l=null,cache_dir:s=null,local_files_only:$0=!1,revision:U0="main",legacy:k0=null}={}){let O0=await N(V,{progress_callback:_,config:l,cache_dir:s,local_files_only:$0,revision:U0,legacy:k0});return new this(...O0)}_call(V,{text_pair:_=null,add_special_tokens:l=!0,padding:s=!1,truncation:$0=null,max_length:U0=null,return_tensor:k0=!0,return_token_type_ids:O0=null}={}){let f0=Array.isArray(V),_0;if(f0){if(V.length===0)throw Error("text array must be non-empty");if(_!==null){if(!Array.isArray(_))throw Error("text_pair must also be an array");else if(V.length!==_.length)throw Error("text and text_pair must have the same length");_0=V.map((X6,y6)=>this._encode_plus(X6,{text_pair:_[y6],add_special_tokens:l,return_token_type_ids:O0}))}else _0=V.map((X6)=>this._encode_plus(X6,{add_special_tokens:l,return_token_type_ids:O0}))}else{if(V===null||V===void 0)throw Error("text may not be null or undefined");if(Array.isArray(_))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");_0=[this._encode_plus(V,{text_pair:_,add_special_tokens:l,return_token_type_ids:O0})]}if(U0===null)U0=this.model_max_length;else if($0===null){if(s===!0)console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),U0=this.model_max_length;else if(s===!1)console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),$0=!0}if(s===!0)U0=Math.min((0,H.max)(_0.map((X6)=>X6.input_ids.length))[0],U0??1/0);if(U0=Math.min(U0,this.model_max_length??1/0),s||$0){for(let X6=0;X6<_0.length;++X6)if(_0[X6].input_ids.length===U0)continue;else if(_0[X6].input_ids.length>U0){if($0)v4(_0[X6],U0)}else if(s)_J(_0[X6],U0,(y6)=>y6==="input_ids"?this.pad_token_id:0,this.padding_side)}let L6={};if(k0){if(!(s&&$0)){if(_0.some((y6)=>{for(let r6 of Object.keys(y6))if(y6[r6].length!==_0[0][r6]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.")}let X6=[_0.length,_0[0].input_ids.length];for(let y6 of Object.keys(_0[0]))L6[y6]=new G.Tensor("int64",BigInt64Array.from(_0.flatMap((r6)=>r6[y6]).map(BigInt)),X6)}else{for(let X6 of Object.keys(_0[0]))L6[X6]=_0.map((y6)=>y6[X6]);if(!f0)for(let X6 of Object.keys(L6))L6[X6]=L6[X6][0]}return L6}_encode_text(V){if(V===null)return null;let _=this.added_tokens_splitter.split(V);for(let s=0;s<_.length;++s){let $0=this.added_tokens_map.get(_[s]);if($0){if($0.lstrip&&s>0)_[s-1]=_[s-1].trimEnd();if($0.rstrip&&s<_.length-1)_[s+1]=_[s+1].trimStart()}}return _.flatMap((s,$0)=>{if(s.length===0)return[];if(this.added_tokens_map.has(s))return[s];if(this.remove_space===!0)s=s.trim().split(/\s+/).join(" ");if(this.do_lowercase_and_remove_accent)s=y(s);if(this.normalizer!==null)s=this.normalizer(s);if(s.length===0)return[];let U0=this.pre_tokenizer!==null?this.pre_tokenizer(s,{section_index:$0}):[s];return this.model(U0)})}_encode_plus(V,{text_pair:_=null,add_special_tokens:l=!0,return_token_type_ids:s=null}={}){let{tokens:$0,token_type_ids:U0}=this._tokenize_helper(V,{pair:_,add_special_tokens:l}),k0=this.model.convert_tokens_to_ids($0),O0={input_ids:k0,attention_mask:Array(k0.length).fill(1)};if((s??this.return_token_type_ids)&&U0)O0.token_type_ids=U0;return O0}_tokenize_helper(V,{pair:_=null,add_special_tokens:l=!1}={}){let s=this._encode_text(V),$0=this._encode_text(_);return this.post_processor?this.post_processor(s,$0,{add_special_tokens:l}):{tokens:(0,W.mergeArrays)(s??[],$0??[])}}tokenize(V,{pair:_=null,add_special_tokens:l=!1}={}){return this._tokenize_helper(V,{pair:_,add_special_tokens:l}).tokens}encode(V,{text_pair:_=null,add_special_tokens:l=!0,return_token_type_ids:s=null}={}){return this._encode_plus(V,{text_pair:_,add_special_tokens:l,return_token_type_ids:s}).input_ids}batch_decode(V,_={}){if(V instanceof G.Tensor)V=V.tolist();return V.map((l)=>this.decode(l,_))}decode(V,_={}){if(V instanceof G.Tensor)V=v(V);if(!Array.isArray(V)||V.length===0||!(0,W.isIntegralNumber)(V[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(V,_)}decode_single(V,{skip_special_tokens:_=!1,clean_up_tokenization_spaces:l=null}){let s=this.model.convert_ids_to_tokens(V);if(_)s=s.filter((U0)=>!this.special_tokens.includes(U0));let $0=this.decoder?this.decoder(s):s.join(" ");if(this.decoder&&this.decoder.end_of_word_suffix){if($0=$0.replaceAll(this.decoder.end_of_word_suffix," "),_)$0=$0.trim()}if(l??this.clean_up_tokenization_spaces)$0=I($0);return $0}get_chat_template({chat_template:V=null,tools:_=null}={}){if(this.chat_template&&typeof this.chat_template==="object"){let l=this.chat_template;if(V!==null&&Object.hasOwn(l,V))V=l[V];else if(V===null)if(_!==null&&"tool_use"in l)V=l.tool_use;else if("default"in l)V=l.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(l).sort()}.`)}else if(V===null)if(this.chat_template)V=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return V}apply_chat_template(V,{tools:_=null,documents:l=null,chat_template:s=null,add_generation_prompt:$0=!1,tokenize:U0=!0,padding:k0=!1,truncation:O0=!1,max_length:f0=null,return_tensor:_0=!0,return_dict:L6=!1,tokenizer_kwargs:X6={},...y6}={}){if(s=this.get_chat_template({chat_template:s,tools:_}),typeof s!=="string")throw Error(`chat_template must be a string, but got ${typeof s}`);let r6=this._compiled_template_cache.get(s);if(r6===void 0)r6=new z.Template(s),this._compiled_template_cache.set(s,r6);let v6=Object.create(null);for(let e6 of TJ){let S4=this.getToken(e6);if(S4)v6[e6]=S4}let Q4=r6.render({messages:V,add_generation_prompt:$0,tools:_,documents:l,...v6,...y6});if(U0){let e6=this._call(Q4,{add_special_tokens:!1,padding:k0,truncation:O0,max_length:f0,return_tensor:_0,...X6});return L6?e6:e6.input_ids}return Q4}}class WJ extends Z6{return_token_type_ids=!0}class KJ extends Z6{return_token_type_ids=!0}class H6 extends Z6{return_token_type_ids=!0}class YJ extends Z6{return_token_type_ids=!0}class E extends Z6{return_token_type_ids=!0}class u extends Z6{return_token_type_ids=!0}class C extends Z6{return_token_type_ids=!0}class f extends Z6{return_token_type_ids=!0}class r extends Z6{return_token_type_ids=!0}class G0 extends Z6{}class L0 extends Z6{}class c0 extends Z6{return_token_type_ids=!0;constructor(V,_){super(V,_);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class t0 extends Z6{return_token_type_ids=!0}class v0 extends Z6{}class U6 extends Z6{}class E6 extends Z6{}class x6 extends Z6{constructor(V,_){super(V,_);this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter((l)=>this.languageRegex.test(l)),this.lang_to_token=(l)=>l}_build_translation_inputs(V,_,l){return XJ(this,V,_,l)}}class j6 extends x6{}class U4 extends Z6{}class F4 extends Z6{}let Z4="";class p6 extends Z6{padding_side="left";constructor(V,_){super(V,_);if(this.legacy=_.legacy??!0,!this.legacy)this.normalizer=null,this.pre_tokenizer=new a6({replacement:Z4,add_prefix_space:!0,prepend_scheme:"first"})}_encode_text(V){if(V===null)return null;if(this.legacy||V.length===0)return super._encode_text(V);let _=super._encode_text(Z4+V.replaceAll(Z4," "));if(_.length>1&&_[0]===Z4&&this.special_tokens.includes(_[1]))_=_.slice(1);return _}}class D4 extends Z6{}class g4 extends Z6{}class l4 extends Z6{}class O4 extends Z6{}class GJ extends Z6{}class c4 extends Z6{}class j4 extends Z6{}class k4 extends Z6{}class x4 extends Z6{}function XJ(V,_,l,s){if(!("language_codes"in V)||!Array.isArray(V.language_codes))throw Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in V)||!(V.languageRegex instanceof RegExp))throw Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in V)||typeof V.lang_to_token!=="function")throw Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let{src_lang:$0,tgt_lang:U0}=s;if(!V.language_codes.includes(U0))throw Error(`Target language code "${U0}" is not valid. Must be one of: {${V.language_codes.join(", ")}}`);if($0!==void 0){if(!V.language_codes.includes($0))throw Error(`Source language code "${$0}" is not valid. Must be one of: {${V.language_codes.join(", ")}}`);for(let k0 of V.post_processor.config.single)if("SpecialToken"in k0&&V.languageRegex.test(k0.SpecialToken.id)){k0.SpecialToken.id=V.lang_to_token($0);break}}return s.forced_bos_token_id=V.model.convert_tokens_to_ids([V.lang_to_token(U0)])[0],V._call(_,l)}class qJ extends Z6{constructor(V,_){super(V,_);this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter((l)=>this.languageRegex.test(l)),this.lang_to_token=(l)=>l}_build_translation_inputs(V,_,l){return XJ(this,V,_,l)}}class m4 extends Z6{constructor(V,_){super(V,_);this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter((l)=>this.languageRegex.test(l)).map((l)=>l.slice(2,-2)),this.lang_to_token=(l)=>`__${l}__`}_build_translation_inputs(V,_,l){return XJ(this,V,_,l)}}class P4 extends Z6{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(V,{return_timestamps:_=!1,return_language:l=!1,time_precision:s=null,force_full_sequences:$0=!0}={}){if(s===null)throw Error("Must specify time_precision");let U0=null,k0=_==="word";function O0(){return{language:U0,timestamp:[null,null],text:""}}let f0=[],_0=O0(),L6=0,X6=this.timestamp_begin,r6=X6+1500,v6=[],Q4=[],e6=!1,S4=null,IJ=new Set(this.all_special_ids);for(let M6 of V){let n6=M6.tokens,N4=k0?M6.token_timestamps:null,I4=null,r4=X6;if("stride"in M6){let[s6,h6,d6]=M6.stride;if(L6-=h6,S4=s6-d6,h6)r4=h6/s+X6;if(d6)for(let u6=n6.length-1;u6>=0;--u6){let z4=Number(n6[u6]);if(z4>=X6){if(I4!==null&&(z4-X6)*s<S4)break;I4=z4}}}let W4=[],h4=[];for(let s6=0;s6<n6.length;++s6){let h6=Number(n6[s6]);if(IJ.has(h6)){let d6=this.decode([h6]),u6=U.WHISPER_LANGUAGE_MAPPING.get(d6.slice(2,-2));if(u6!==void 0){if(U0!==null&&u6!==U0&&!_){v6.push(W4);let z4=this.findLongestCommonSequence(v6)[0],vJ=this.decode(z4);_0.text=vJ,f0.push(_0),v6=[],W4=[],_0=O0()}U0=_0.language=u6}}else if(h6>=X6&&h6<=r6){let d6=(h6-X6)*s+L6,u6=(0,H.round)(d6,2);if(I4!==null&&h6>=I4)e6=!0;else if(e6||v6.length>0&&h6<r4)e6=!1;else if(_0.timestamp[0]===null)_0.timestamp[0]=u6;else if(u6===_0.timestamp[0]);else{if(_0.timestamp[1]=u6,v6.push(W4),k0)Q4.push(h4);let[z4,vJ]=this.findLongestCommonSequence(v6,Q4),L5=this.decode(z4);if(_0.text=L5,k0)_0.words=this.collateWordTimestamps(z4,vJ,U0);f0.push(_0),v6=[],W4=[],Q4=[],h4=[],_0=O0()}}else if(W4.push(h6),k0){let d6=(0,H.round)(N4[s6]+L6,2),u6;if(s6+1<N4.length){u6=(0,H.round)(N4[s6+1]+L6,2);let z4=this.decode([h6]);if(R.test(z4))u6=(0,H.round)(Math.min(d6+s,u6),2)}else u6=null;h4.push([d6,u6])}}if("stride"in M6){let[s6,h6,d6]=M6.stride;L6+=s6-d6}if(W4.length>0){if(v6.push(W4),k0)Q4.push(h4)}else if(v6.every((s6)=>s6.length===0))_0=O0(),v6=[],W4=[],Q4=[],h4=[]}if(v6.length>0){if($0&&_)throw Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[M6,n6]=this.findLongestCommonSequence(v6,Q4),N4=this.decode(M6);if(_0.text=N4,k0)_0.words=this.collateWordTimestamps(M6,n6,U0);f0.push(_0)}let G4=Object.create(null),b4=f0.map((M6)=>M6.text).join("");if(_||l){for(let M6=0;M6<f0.length;++M6){let n6=f0[M6];if(!_)delete n6.timestamp;if(!l)delete n6.language}if(k0){let M6=[];for(let n6 of f0)for(let N4 of n6.words)M6.push(N4);G4={chunks:M6}}else G4={chunks:f0}}return[b4,G4]}findLongestCommonSequence(V,_=null){let l=V[0],s=l.length,$0=[],U0=Array.isArray(_)&&_.length>0,k0=U0?[]:null,O0=U0?_[0]:null;for(let f0=1;f0<V.length;++f0){let _0=V[f0],L6=0,X6=[s,s,0,0],y6=_0.length;for(let G4=1;G4<s+y6;++G4){let b4=Math.max(0,s-G4),M6=Math.min(s,s+y6-G4),n6=l.slice(b4,M6),N4=Math.max(0,G4-s),I4=Math.min(y6,G4),r4=_0.slice(N4,I4);if(n6.length!==r4.length)throw Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let W4;if(U0)W4=n6.filter((h6,d6)=>h6===r4[d6]&&O0[b4+d6]<=_[f0][N4+d6]).length;else W4=n6.filter((h6,d6)=>h6===r4[d6]).length;let h4=G4/1e4,s6=W4/G4+h4;if(W4>1&&s6>L6)L6=s6,X6=[b4,M6,N4,I4]}let[r6,v6,Q4,e6]=X6,S4=Math.floor((v6+r6)/2),IJ=Math.floor((e6+Q4)/2);if($0.push(...l.slice(0,S4)),l=_0.slice(IJ),s=l.length,U0)k0.push(...O0.slice(0,S4)),O0=_[f0].slice(IJ)}if($0.push(...l),U0)return k0.push(...O0),[$0,k0];else return[$0,[]]}collateWordTimestamps(V,_,l){let[s,$0,U0]=this.combineTokensIntoWords(V,l),k0=[];for(let O0=0;O0<s.length;++O0){let f0=U0[O0];k0.push({text:s[O0],timestamp:[_[f0.at(0)][0],_[f0.at(-1)][1]]})}return k0}combineTokensIntoWords(V,_,l=`"'([{-`,s=`"'.,!?:)]}`){_=_??"english";let $0,U0,k0;if(["chinese","japanese","thai","lao","myanmar"].includes(_))[$0,U0,k0]=this.splitTokensOnUnicode(V);else[$0,U0,k0]=this.splitTokensOnSpaces(V);return this.mergePunctuations($0,U0,k0,l,s)}decode(V,_){let l;if(_?.decode_with_timestamps){if(V instanceof G.Tensor)V=v(V);l=this.decodeWithTimestamps(V,_)}else l=super.decode(V,_);return l}decodeWithTimestamps(V,_){let l=_?.time_precision??0.02,s=Array.from(this.all_special_ids).at(-1)+1,$0=[[]];for(let U0 of V)if(U0=Number(U0),U0>=s){let k0=((U0-s)*l).toFixed(2);$0.push(`<|${k0}|>`),$0.push([])}else $0[$0.length-1].push(U0);return $0=$0.map((U0)=>typeof U0==="string"?U0:super.decode(U0,_)),$0.join("")}splitTokensOnUnicode(V){let _=this.decode(V,{decode_with_timestamps:!0}),l="",s=[],$0=[],U0=[],k0=[],O0=[],f0=0;for(let _0=0;_0<V.length;++_0){let L6=V[_0];k0.push(L6),O0.push(_0);let X6=this.decode(k0,{decode_with_timestamps:!0});if(!X6.includes("")||_[f0+X6.indexOf("")]==="")s.push(X6),$0.push(k0),U0.push(O0),k0=[],O0=[],f0+=X6.length}return[s,$0,U0]}splitTokensOnSpaces(V){let[_,l,s]=this.splitTokensOnUnicode(V),$0=[],U0=[],k0=[],O0=new RegExp(`^[${B}]$`,"gu");for(let f0=0;f0<_.length;++f0){let _0=_[f0],L6=l[f0],X6=s[f0],y6=L6[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),r6=_0.startsWith(" "),v6=_0.trim(),Q4=O0.test(v6);if(y6||r6||Q4||$0.length===0)$0.push(_0),U0.push(L6),k0.push(X6);else{let e6=$0.length-1;$0[e6]+=_0,U0[e6].push(...L6),k0[e6].push(...X6)}}return[$0,U0,k0]}mergePunctuations(V,_,l,s,$0){let U0=structuredClone(V),k0=structuredClone(_),O0=structuredClone(l),f0=U0.length-2,_0=U0.length-1;while(f0>=0){if(U0[f0].startsWith(" ")&&s.includes(U0[f0].trim()))U0[_0]=U0[f0]+U0[_0],k0[_0]=(0,W.mergeArrays)(k0[f0],k0[_0]),O0[_0]=(0,W.mergeArrays)(O0[f0],O0[_0]),U0[f0]="",k0[f0]=[],O0[f0]=[];else _0=f0;--f0}f0=0,_0=1;while(_0<U0.length){if(!U0[f0].endsWith(" ")&&$0.includes(U0[_0]))U0[f0]+=U0[_0],k0[f0]=(0,W.mergeArrays)(k0[f0],k0[_0]),O0[f0]=(0,W.mergeArrays)(O0[f0],O0[_0]),U0[_0]="",k0[_0]=[],O0[_0]=[];else f0=_0;++_0}return[U0.filter((L6)=>L6),k0.filter((L6)=>L6.length>0),O0.filter((L6)=>L6.length>0)]}}class a4 extends Z6{}class HJ extends Z6{}class Y4 extends Z6{}class P0 extends Z6{constructor(V,_){super(V,_);this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter((l)=>this.languageRegex.test(l)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(V){if(V===null)return null;let[_,...l]=V.trim().split(this.languageRegex);if(l.length===0)return super._encode_text(_);else if(l.length===2){let[s,$0]=l;if(!this.supported_language_codes.includes(s))console.warn(`Unsupported language code "${s}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`);return(0,W.mergeArrays)([s],super._encode_text($0))}}}class S0 extends Z6{}class m0 extends Z6{}class P6 extends Z6{}class VJ extends Z6{}class p4 extends Z6{}class C4 extends Z6{constructor(V,_){super(V,_);this.decoder=new W6({})}}class kJ extends Z6{}class xJ extends Z6{}class yJ extends Z6{}class oJ{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:v0,DistilBertTokenizer:G0,CamembertTokenizer:L0,DebertaTokenizer:E,DebertaV2Tokenizer:u,BertTokenizer:WJ,HerbertTokenizer:C,ConvBertTokenizer:f,RoFormerTokenizer:r,XLMTokenizer:c0,ElectraTokenizer:t0,MobileBertTokenizer:H6,SqueezeBertTokenizer:YJ,AlbertTokenizer:KJ,GPT2Tokenizer:U6,BartTokenizer:E6,MBartTokenizer:x6,MBart50Tokenizer:j6,RobertaTokenizer:U4,WhisperTokenizer:P4,CodeGenTokenizer:a4,CLIPTokenizer:HJ,SiglipTokenizer:Y4,MarianTokenizer:P0,BloomTokenizer:F4,NllbTokenizer:qJ,M2M100Tokenizer:m4,LlamaTokenizer:p6,CodeLlamaTokenizer:D4,XLMRobertaTokenizer:g4,MPNetTokenizer:l4,FalconTokenizer:O4,GPTNeoXTokenizer:GJ,EsmTokenizer:c4,Wav2Vec2CTCTokenizer:S0,BlenderbotTokenizer:m0,BlenderbotSmallTokenizer:P6,SpeechT5Tokenizer:VJ,NougatTokenizer:p4,VitsTokenizer:C4,Qwen2Tokenizer:j4,GemmaTokenizer:k4,Grok1Tokenizer:x4,CohereTokenizer:kJ,MgpstrTokenizer:xJ,Ernie4_5_Tokenizer:yJ,PreTrainedTokenizer:Z6};static async from_pretrained(V,{progress_callback:_=null,config:l=null,cache_dir:s=null,local_files_only:$0=!1,revision:U0="main",legacy:k0=null}={}){let[O0,f0]=await N(V,{progress_callback:_,config:l,cache_dir:s,local_files_only:$0,revision:U0,legacy:k0}),_0=f0.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer",L6=this.TOKENIZER_CLASS_MAPPING[_0];if(!L6)console.warn(`Unknown tokenizer class "${_0}", attempting to construct from base class.`),L6=Z6;return new L6(O0,f0)}}},"./src/utils/audio.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/audio.js ***!
  \****************************/$.r(Z),$.d(Z,{RawAudio:()=>m,hamming:()=>L,hanning:()=>N,mel_filter_bank:()=>g,read_audio:()=>z,spectrogram:()=>P,window_function:()=>k});var Q=$("./src/utils/hub.js");/*! ./hub.js */var W=$("./src/utils/maths.js");/*! ./maths.js */var Y=$("./src/utils/core.js");/*! ./core.js */var H=$("./src/env.js");/*! ../env.js */var G=$("./src/utils/tensor.js");/*! ./tensor.js */var q=$("node:fs");/*! node:fs */async function z(d,a){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let n=await(await(0,Q.getFile)(d)).arrayBuffer(),t=new AudioContext({sampleRate:a});if(typeof a>"u")console.warn(`No sampling rate provided, using default of ${t.sampleRate}Hz.`);let Q0=await t.decodeAudioData(n),o;if(Q0.numberOfChannels===2){let N0=Math.sqrt(2),w0=Q0.getChannelData(0),D=Q0.getChannelData(1);o=new Float32Array(w0.length);for(let O=0;O<Q0.length;++O)o[O]=N0*(w0[O]+D[O])/2}else o=Q0.getChannelData(0);return o}function U(d,a){if(d<1)return new Float64Array;if(d===1)return new Float64Array([1]);let n=1-a,t=2*Math.PI/(d-1),Q0=new Float64Array(d);for(let o=0;o<d;++o)Q0[o]=a-n*Math.cos(o*t);return Q0}function N(d){return U(d,0.5)}function L(d){return U(d,0.54)}let w={htk:(d)=>2595*Math.log10(1+d/700),kaldi:(d)=>1127*Math.log(1+d/700),slaney:(d,a=1000,n=15,t=27/Math.log(6.4))=>d>=a?n+Math.log(d/a)*t:3*d/200};function F(d,a="htk"){let n=w[a];if(!n)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof d==="number"?n(d):d.map((t)=>n(t))}let v={htk:(d)=>700*(10**(d/2595)-1),kaldi:(d)=>700*(Math.exp(d/1127)-1),slaney:(d,a=1000,n=15,t=Math.log(6.4)/27)=>d>=n?a*Math.exp(t*(d-n)):200*d/3};function I(d,a="htk"){let n=v[a];if(!n)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof d==="number"?n(d):d.map((t)=>n(t))}function j(d,a){let n=Float64Array.from({length:a.length-1},(N0,w0)=>a[w0+1]-a[w0]),t=Array.from({length:d.length},()=>Array(a.length));for(let N0=0;N0<d.length;++N0){let w0=t[N0];for(let D=0;D<a.length;++D)w0[D]=a[D]-d[N0]}let Q0=a.length-2,o=Array.from({length:Q0},()=>Array(d.length));for(let N0=0;N0<d.length;++N0){let w0=t[N0];for(let D=0;D<Q0;++D){let O=-w0[D]/n[D],p=w0[D+2]/n[D+1];o[D][N0]=Math.max(0,Math.min(O,p))}}return o}function y(d,a,n){let t=(a-d)/(n-1);return Float64Array.from({length:n},(Q0,o)=>d+t*o)}function g(d,a,n,t,Q0,o=null,N0="htk",w0=!1){if(o!==null&&o!=="slaney")throw Error('norm must be one of null or "slaney"');if(d<2)throw Error(`Require num_frequency_bins: ${d} >= 2`);if(n>t)throw Error(`Require min_frequency: ${n} <= max_frequency: ${t}`);let D=F(n,N0),O=F(t,N0),p=y(D,O,a+2),Z0=I(p,N0),z0;if(w0){let j0=Q0/((d-1)*2);z0=F(Float64Array.from({length:d},(h0,d0)=>d0*j0),N0),Z0=p}else z0=y(0,Math.floor(Q0/2),d);let A0=j(z0,Z0);if(o!==null&&o==="slaney")for(let j0=0;j0<a;++j0){let h0=A0[j0],d0=2/(Z0[j0+2]-Z0[j0]);for(let T0=0;T0<d;++T0)h0[T0]*=d0}return A0}function A(d,a,n){let t=new d.constructor(d.length+a+n),Q0=d.length-1;for(let o=0;o<d.length;++o)t[a+o]=d[o];for(let o=1;o<=a;++o)t[a-o]=d[(0,Y.calculateReflectOffset)(o,Q0)];for(let o=1;o<=n;++o)t[Q0+a+o]=d[(0,Y.calculateReflectOffset)(Q0-o,Q0)];return t}function T(d,a,n,t,Q0){if(n<=0)throw Error("reference must be greater than zero");if(t<=0)throw Error("min_value must be greater than zero");n=Math.max(t,n);let o=Math.log10(n);for(let N0=0;N0<d.length;++N0)d[N0]=a*Math.log10(Math.max(t,d[N0])-o);if(Q0!==null){if(Q0<=0)throw Error("db_range must be greater than zero");let N0=(0,W.max)(d)[0]-Q0;for(let w0=0;w0<d.length;++w0)d[w0]=Math.max(d[w0],N0)}return d}function B(d,a=1,n=0.00001,t=null){return T(d,20,a,n,t)}function R(d,a=1,n=0.0000000001,t=null){return T(d,10,a,n,t)}async function P(d,a,n,t,{fft_length:Q0=null,power:o=1,center:N0=!0,pad_mode:w0="reflect",onesided:D=!0,preemphasis:O=null,preemphasis_htk_flavor:p=!0,mel_filters:Z0=null,mel_floor:z0=0.0000000001,log_mel:A0=null,reference:j0=1,min_value:h0=0.0000000001,db_range:d0=null,remove_dc_offset:T0=null,min_num_frames:b=null,max_num_frames:S=null,do_pad:W0=!0,transpose:B0=!1,mel_offset:D0=0}={}){let R0=a.length;if(Q0===null)Q0=n;if(n>Q0)throw Error(`frame_length (${n}) may not be larger than fft_length (${Q0})`);if(R0!==n)throw Error(`Length of the window (${R0}) must equal frame_length (${n})`);if(t<=0)throw Error("hop_length must be greater than zero");if(o===null&&Z0!==null)throw Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!p)throw Error("`preemphasis_htk_flavor=false` is not currently supported.");if(N0)switch(w0){case"reflect":{let y0=Math.floor((Q0-1)/2)+1;d=A(d,y0,y0);break}case"constant":{let y0=Math.floor(Q0/2),i0=new d.constructor(d.length+2*y0);i0.set(d,y0),d=i0;break}default:throw Error(`pad_mode="${w0}" not implemented yet.`)}let Y0=Math.floor(1+Math.floor((d.length-n)/t));if(b!==null&&Y0<b)Y0=b;let E0=D?Math.floor(Q0/2)+1:Q0,X0=Y0,F0=Y0;if(S!==null)if(S>Y0){if(W0)F0=S}else F0=X0=S;let C0=new W.FFT(Q0),x0=new Float64Array(Q0),V0=new Float64Array(C0.outputBufferSize),u0=new Float32Array(E0*F0);for(let y0=0;y0<X0;++y0){let i0=y0*t,a0=Math.min(d.length-i0,n);if(a0!==n)x0.fill(0,0,n);for(let n0=0;n0<a0;++n0)x0[n0]=d[i0+n0];if(T0){let n0=0;for(let W6=0;W6<a0;++W6)n0+=x0[W6];let B6=n0/a0;for(let W6=0;W6<a0;++W6)x0[W6]-=B6}if(O!==null){for(let n0=a0-1;n0>=1;--n0)x0[n0]-=O*x0[n0-1];x0[0]*=1-O}for(let n0=0;n0<a.length;++n0)x0[n0]*=a[n0];C0.realTransform(V0,x0);for(let n0=0;n0<E0;++n0){let B6=n0<<1;u0[n0*F0+y0]=V0[B6]**2+V0[B6+1]**2}}if(o!==null&&o!==2){let y0=o/2;for(let i0=0;i0<u0.length;++i0)u0[i0]**=y0}let b0=Z0.length,s0=await(0,G.matmul)(new G.Tensor("float32",Z0.flat(),[b0,E0]),new G.Tensor("float32",u0,[E0,F0]));if(B0)s0=s0.transpose(1,0);let l0=s0.data;for(let y0=0;y0<l0.length;++y0)l0[y0]=D0+Math.max(z0,l0[y0]);if(o!==null&&A0!==null){let y0=Math.min(l0.length,X0*b0);switch(A0){case"log":for(let i0=0;i0<y0;++i0)l0[i0]=Math.log(l0[i0]);break;case"log10":for(let i0=0;i0<y0;++i0)l0[i0]=Math.log10(l0[i0]);break;case"dB":if(o===1)B(l0,j0,h0,d0);else if(o===2)R(l0,j0,h0,d0);else throw Error(`Cannot use log_mel option '${A0}' with power ${o}`);break;default:throw Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${A0}'`)}}return s0}function k(d,a,{periodic:n=!0,frame_length:t=null,center:Q0=!0}={}){let o=n?d+1:d,N0;switch(a){case"boxcar":N0=new Float64Array(o).fill(1);break;case"hann":case"hann_window":N0=N(o);break;case"hamming":N0=L(o);break;case"povey":N0=N(o).map((w0)=>Math.pow(w0,0.85));break;default:throw Error(`Unknown window type ${a}.`)}if(n)N0=N0.subarray(0,d);if(t===null)return N0;if(d>t)throw Error(`Length of the window (${d}) may not be larger than frame_length (${t})`);return N0}function h(d,a){let n=44,t=new ArrayBuffer(n+d.length*4),Q0=new DataView(t);c(Q0,0,"RIFF"),Q0.setUint32(4,36+d.length*4,!0),c(Q0,8,"WAVE"),c(Q0,12,"fmt "),Q0.setUint32(16,16,!0),Q0.setUint16(20,3,!0),Q0.setUint16(22,1,!0),Q0.setUint32(24,a,!0),Q0.setUint32(28,a*4,!0),Q0.setUint16(32,4,!0),Q0.setUint16(34,32,!0),c(Q0,36,"data"),Q0.setUint32(40,d.length*4,!0);for(let o=0;o<d.length;++o,n+=4)Q0.setFloat32(n,d[o],!0);return t}function c(d,a,n){for(let t=0;t<n.length;++t)d.setUint8(a+t,n.charCodeAt(t))}class m{constructor(d,a){this.audio=d,this.sampling_rate=a}toWav(){return h(this.audio,this.sampling_rate)}toBlob(){let d=this.toWav();return new Blob([d],{type:"audio/wav"})}async save(d){let a;if(H.apis.IS_BROWSER_ENV){if(H.apis.IS_WEBWORKER_ENV)throw Error("Unable to save a file from a Web Worker.");a=Y.saveBlob}else if(H.apis.IS_FS_AVAILABLE)a=async(n,t)=>{let Q0=await t.arrayBuffer();q.default.writeFileSync(n,Buffer.from(Q0))};else throw Error("Unable to save because filesystem is disabled in this environment.");await a(d,this.toBlob())}}},"./src/utils/constants.js":(J,Z,$)=>{/*!********************************!*\
  !*** ./src/utils/constants.js ***!
  \********************************/$.r(Z),$.d(Z,{CHAT_TEMPLATE_NAME:()=>q,CONFIG_NAME:()=>W,FEATURE_EXTRACTOR_NAME:()=>Y,GENERATION_CONFIG_NAME:()=>z,GITHUB_ISSUE_URL:()=>Q,IMAGE_PROCESSOR_NAME:()=>H,PROCESSOR_NAME:()=>G});let Q="https://github.com/huggingface/transformers.js/issues/new/choose",W="config.json",Y="preprocessor_config.json",H=Y,G="processor_config.json",q="chat_template.jinja",z="generation_config.json"},"./src/utils/core.js":(J,Z,$)=>{/*!***************************!*\
  !*** ./src/utils/core.js ***!
  \***************************/$.r(Z),$.d(Z,{calculateDimensions:()=>z,calculateReflectOffset:()=>w,count:()=>j,dispatchCallback:()=>Q,escapeRegExp:()=>Y,isIntegralNumber:()=>G,isNullishDimension:()=>q,isTypedArray:()=>H,len:()=>I,mergeArrays:()=>N,pick:()=>v,pop:()=>U,product:()=>L,reverseDictionary:()=>W,saveBlob:()=>F});function Q(y,g){if(y)y(g)}function W(y){return Object.fromEntries(Object.entries(y).map(([g,A])=>[A,g]))}function Y(y){return y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(y){return y?.prototype?.__proto__?.constructor?.name==="TypedArray"}function G(y){return Number.isInteger(y)||typeof y==="bigint"}function q(y){return y===null||y===void 0||y===-1}function z(y){let g=[],A=y;while(Array.isArray(A))g.push(A.length),A=A[0];return g}function U(y,g,A=void 0){let T=y[g];if(T!==void 0)return delete y[g],T;if(A===void 0)throw Error(`Key ${g} does not exist in object.`);return A}function N(...y){return Array.prototype.concat.apply([],y)}function L(...y){return y.reduce((g,A)=>g.flatMap((T)=>A.map((B)=>[T,B])))}function w(y,g){return Math.abs((y+g)%(2*g)-g)}function F(y,g){let A=URL.createObjectURL(g),T=document.createElement("a");T.href=A,T.download=y,T.click(),T.remove(),URL.revokeObjectURL(A)}function v(y,g){return Object.assign({},...g.map((A)=>{if(y[A]!==void 0)return{[A]:y[A]}}))}function I(y){let g=0;for(let A of y)++g;return g}function j(y,g){let A=0;for(let T of y)if(T===g)++A;return A}},"./src/utils/data-structures.js":(J,Z,$)=>{/*!**************************************!*\
  !*** ./src/utils/data-structures.js ***!
  \**************************************/$.r(Z),$.d(Z,{CharTrie:()=>W,DictionarySplitter:()=>q,LRUCache:()=>z,PriorityQueue:()=>Q,TokenLattice:()=>H});class Q{constructor(U=(L,w)=>L>w,N=1/0){this._heap=[],this._comparator=U,this._maxSize=N}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...U){return this.extend(U)}extend(U){for(let N of U)if(this.size<this._maxSize)this._heap.push(N),this._siftUp();else{let L=this._smallest();if(this._comparator(N,this._heap[L]))this._heap[L]=N,this._siftUpFrom(L)}return this.size}pop(){let U=this.peek(),N=this.size-1;if(N>0)this._swap(0,N);return this._heap.pop(),this._siftDown(),U}replace(U){let N=this.peek();return this._heap[0]=U,this._siftDown(),N}_parent(U){return(U+1>>>1)-1}_left(U){return(U<<1)+1}_right(U){return U+1<<1}_greater(U,N){return this._comparator(this._heap[U],this._heap[N])}_swap(U,N){let L=this._heap[U];this._heap[U]=this._heap[N],this._heap[N]=L}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(U){while(U>0&&this._greater(U,this._parent(U)))this._swap(U,this._parent(U)),U=this._parent(U)}_siftDown(){let U=0;while(this._left(U)<this.size&&this._greater(this._left(U),U)||this._right(U)<this.size&&this._greater(this._right(U),U)){let N=this._right(U)<this.size&&this._greater(this._right(U),this._left(U))?this._right(U):this._left(U);this._swap(U,N),U=N}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class W{constructor(){this.root=Y.default()}extend(U){for(let N of U)this.push(N)}push(U){let N=this.root;for(let L of U){let w=N.children.get(L);if(w===void 0)w=Y.default(),N.children.set(L,w);N=w}N.isLeaf=!0}*commonPrefixSearch(U){let N=this.root;if(N===void 0)return;let L="";for(let w of U){if(L+=w,N=N.children.get(w),N===void 0)return;if(N.isLeaf)yield L}}}class Y{constructor(U,N){this.isLeaf=U,this.children=N}static default(){return new Y(!1,new Map)}}class H{constructor(U,N,L){this.chars=Array.from(U),this.len=this.chars.length,this.bosTokenId=N,this.eosTokenId=L,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let w=new G(this.bosTokenId,0,0,0,0),F=new G(this.eosTokenId,1,this.len,0,0);this.nodes.push(w.clone()),this.nodes.push(F.clone()),this.beginNodes[this.len].push(F),this.endNodes[0].push(w)}insert(U,N,L,w){let F=this.nodes.length,v=new G(w,F,U,N,L);this.beginNodes[U].push(v),this.endNodes[U+N].push(v),this.nodes.push(v)}viterbi(){let U=this.len,N=0;while(N<=U){if(this.beginNodes[N].length==0)return[];for(let I of this.beginNodes[N]){I.prev=null;let j=0,y=null;for(let g of this.endNodes[N]){let A=g.backtraceScore+I.score;if(y===null||A>j)y=g.clone(),j=A}if(y!==null)I.prev=y,I.backtraceScore=j;else return[]}++N}let L=[],F=this.beginNodes[U][0].prev;if(F===null)return[];let v=F.clone();while(v.prev!==null)L.push(v.clone()),v=v.clone().prev.clone();return L.reverse(),L}piece(U){return this.chars.slice(U.pos,U.pos+U.length).join("")}tokens(){return this.viterbi().map((N)=>this.piece(N))}tokenIds(){return this.viterbi().map((N)=>N.tokenId)}}class G{constructor(U,N,L,w,F){this.tokenId=U,this.nodeId=N,this.pos=L,this.length=w,this.score=F,this.prev=null,this.backtraceScore=0}clone(){let U=new G(this.tokenId,this.nodeId,this.pos,this.length,this.score);return U.prev=this.prev,U.backtraceScore=this.backtraceScore,U}}class q{constructor(U){this.trie=this._buildTrie(U)}_buildTrie(U){let N=Object.create(null);for(let L of U){let w=N;for(let F=0;F<L.length;++F)w=w[L[F]]??=Object.create(null);w.end=L}return N}split(U){let N=[],L=U.length,w=0,F=0;while(F<L){let v=this.trie,I=null,j=F;while(j<L&&(v=v[U[j]])){if(v.end)I=v.end;++j}if(I){if(F>w)N.push(U.slice(w,F));N.push(I),F+=I.length,w=F}else++F}if(w<L)N.push(U.slice(w));return N}}class z{constructor(U){this.capacity=U,this.cache=new Map}get(U){if(!this.cache.has(U))return;let N=this.cache.get(U);return this.cache.delete(U),this.cache.set(U,N),N}put(U,N){if(this.cache.has(U))this.cache.delete(U);if(this.cache.set(U,N),this.cache.size>this.capacity)this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(J,Z,$)=>{/*!******************************!*\
  !*** ./src/utils/devices.js ***!
  \******************************/$.r(Z),$.d(Z,{DEVICE_TYPES:()=>Q});let Q=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(J,Z,$)=>{/*!*****************************!*\
  !*** ./src/utils/dtypes.js ***!
  \*****************************/$.r(Z),$.d(Z,{DATA_TYPES:()=>H,DEFAULT_DEVICE_DTYPE_MAPPING:()=>G,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>q,isWebGpuFp16Supported:()=>Y});var Q=$("./src/env.js");/*! ../env.js */var W=$("./src/utils/devices.js");/*! ./devices.js */let Y=function(){let z;return async function(){if(z===void 0)if(!Q.apis.IS_WEBGPU_AVAILABLE)z=!1;else try{z=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch(U){z=!1}return z}}(),H=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),G=Object.freeze({[W.DEVICE_TYPES.wasm]:H.q8}),q=Object.freeze({[H.fp32]:"",[H.fp16]:"_fp16",[H.int8]:"_int8",[H.uint8]:"_uint8",[H.q8]:"_quantized",[H.q4]:"_q4",[H.q4f16]:"_q4f16",[H.bnb4]:"_bnb4"})},"./src/utils/generic.js":(J,Z,$)=>{/*!******************************!*\
  !*** ./src/utils/generic.js ***!
  \******************************/$.r(Z),$.d(Z,{Callable:()=>Q});let Q=class{constructor(){let W=function(...Y){return W._call(...Y)};return Object.setPrototypeOf(W,new.target.prototype)}_call(...W){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(J,Z,$)=>{/*!**************************!*\
  !*** ./src/utils/hub.js ***!
  \**************************/$.r(Z),$.d(Z,{MAX_EXTERNAL_DATA_CHUNKS:()=>G,getFile:()=>w,getModelFile:()=>y,getModelJSON:()=>A,getModelText:()=>g});var Q=$("node:fs");/*! node:fs */var W=$("node:path");/*! node:path */var Y=$("./src/env.js");/*! ../env.js */var H=$("./src/utils/core.js");/*! ./core.js */let G=100,q={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class z{constructor(R){if(this.filePath=R,this.headers=new Headers,this.exists=Q.default.existsSync(R),this.exists){this.status=200,this.statusText="OK";let P=Q.default.statSync(R);this.headers.set("content-length",P.size.toString()),this.updateContentType();let k=Q.default.createReadStream(R);this.body=new ReadableStream({start(h){k.on("data",(c)=>h.enqueue(c)),k.on("end",()=>h.close()),k.on("error",(c)=>h.error(c))},cancel(){k.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){let R=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",q[R]??"application/octet-stream")}clone(){let R=new z(this.filePath);return R.exists=this.exists,R.status=this.status,R.statusText=this.statusText,R.headers=new Headers(this.headers),R}async arrayBuffer(){return(await Q.default.promises.readFile(this.filePath)).buffer}async blob(){let R=await Q.default.promises.readFile(this.filePath);return new Blob([R],{type:this.headers.get("content-type")})}async text(){return await Q.default.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function U(R,P=null,k=null){let h;try{h=new URL(R)}catch(c){return!1}if(P&&!P.includes(h.protocol))return!1;if(k&&!k.includes(h.hostname))return!1;return!0}let N=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function L(R){if(!N.test(R))return!1;if(R.includes("..")||R.includes("--"))return!1;if(R.endsWith(".git")||R.endsWith(".ipynb"))return!1;return!0}async function w(R){if(Y.env.useFS&&!U(R,["http:","https:","blob:"]))return new z(R instanceof URL?R.protocol==="file:"?R.pathname:R.toString():R);else if(typeof process<"u"&&process?.release?.name==="node"){let P=!!process.env?.TESTING_REMOTELY,k=Y.env.version,h=new Headers;if(h.set("User-Agent",`transformers.js/${k}; is_ci/${P};`),U(R,["http:","https:"],["huggingface.co","hf.co"])){let m=process.env?.HF_TOKEN??process.env?.HF_ACCESS_TOKEN;if(m)h.set("Authorization",`Bearer ${m}`)}return fetch(R,{headers:h})}else return fetch(R)}let F={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function v(R,P,k){if(!k)return null;let h=F[R]??`Error (${R}) occurred while trying to load file`;throw Error(`${h}: "${P}".`)}class I{constructor(R){this.path=R}async match(R){let P=W.default.join(this.path,R),k=new z(P);if(k.exists)return k;else return}async put(R,P,k=void 0){let h=W.default.join(this.path,R);try{let c=P.headers.get("Content-Length"),m=parseInt(c??"0"),d=0;await Q.default.promises.mkdir(W.default.dirname(h),{recursive:!0});let a=Q.default.createWriteStream(h),n=P.body.getReader();while(!0){let{done:t,value:Q0}=await n.read();if(t)break;await new Promise((N0,w0)=>{a.write(Q0,(D)=>{if(D){w0(D);return}N0()})}),d+=Q0.length;let o=m?d/m*100:0;k?.({progress:o,loaded:d,total:m})}a.close()}catch(c){try{await Q.default.promises.unlink(h)}catch{}throw c}}}async function j(R,...P){for(let k of P)try{let h=await R.match(k);if(h)return h}catch(h){continue}return}async function y(R,P,k=!0,h={},c=!1){if(!Y.env.allowLocalModels){if(h.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");else if(!Y.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,H.dispatchCallback)(h.progress_callback,{status:"initiate",name:R,file:P});let m;if(!m&&Y.env.useCustomCache){if(!Y.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!Y.env.customCache.match||!Y.env.customCache.put)throw Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");m=Y.env.customCache}if(!m&&Y.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{m=await caches.open("transformers-cache")}catch(z0){console.warn("An error occurred while opening the browser cache:",z0)}}if(!m&&Y.env.useFSCache){if(!Y.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");m=new I(h.cache_dir??Y.env.cacheDir)}let d=h.revision??"main",a=B(R,P),n=L(R),t=n?B(Y.env.localModelPath,a):a,Q0=B(Y.env.remoteHost,Y.env.remotePathTemplate.replaceAll("{model}",R).replaceAll("{revision}",encodeURIComponent(d)),P),o,N0=m instanceof I?d==="main"?a:B(R,d,P):Q0,w0=!1,D;if(m)D=await j(m,t,N0);let O=D!==void 0;if(D===void 0){if(Y.env.allowLocalModels){if(!U(a,["http:","https:"]))try{D=await w(t),o=t}catch(A0){console.warn(`Unable to load from local path "${t}": "${A0}"`)}else if(h.local_files_only)throw Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${a}.`);else if(!Y.env.allowRemoteModels)throw Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${a}.`)}if(D===void 0||D.status===404){if(h.local_files_only||!Y.env.allowRemoteModels)if(k)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${t}".`);else return null;if(!n)throw Error(`Local file missing at "${t}" and download aborted due to invalid model ID "${R}".`);if(D=await w(Q0),D.status!==200)return v(D.status,Q0,k);o=N0}w0=m&&typeof Response<"u"&&D instanceof Response&&D.status===200}(0,H.dispatchCallback)(h.progress_callback,{status:"download",name:R,file:P});let p;if(!(Y.apis.IS_NODE_ENV&&c)){let z0;if(!h.progress_callback)z0=new Uint8Array(await D.arrayBuffer());else if(O&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent))z0=new Uint8Array(await D.arrayBuffer()),(0,H.dispatchCallback)(h.progress_callback,{status:"progress",name:R,file:P,progress:100,loaded:z0.length,total:z0.length});else z0=await T(D,(A0)=>{(0,H.dispatchCallback)(h.progress_callback,{status:"progress",name:R,file:P,...A0})});p=z0}if(w0&&o&&await m.match(o)===void 0)if(!p){let z0=h.progress_callback?(A0)=>(0,H.dispatchCallback)(h.progress_callback,{status:"progress",name:R,file:P,...A0}):void 0;await m.put(o,D,z0)}else await m.put(o,new Response(p,{headers:D.headers})).catch((z0)=>{console.warn(`Unable to add response to browser cache: ${z0}.`)});if((0,H.dispatchCallback)(h.progress_callback,{status:"done",name:R,file:P}),p){if(!Y.apis.IS_NODE_ENV&&c)throw Error("Cannot return path in a browser environment.");return p}if(D instanceof z)return D.filePath;let Z0=await m?.match(o);if(Z0 instanceof z)return Z0.filePath;else if(Z0 instanceof Response)return new Uint8Array(await Z0.arrayBuffer());else if(typeof Z0==="string")return Z0;throw Error("Unable to get model file path or buffer.")}async function g(R,P,k=!0,h={}){let c=await y(R,P,k,h,!1);if(c===null)return null;return new TextDecoder("utf-8").decode(c)}async function A(R,P,k=!0,h={}){let c=await g(R,P,k,h);if(c===null)return{};return JSON.parse(c)}async function T(R,P){let k=R.headers.get("Content-Length");if(k===null)console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let h=parseInt(k??"0"),c=new Uint8Array(h),m=0,d=R.body.getReader();async function a(){let{done:n,value:t}=await d.read();if(n)return;let Q0=m+t.length;if(Q0>h){h=Q0;let N0=new Uint8Array(h);N0.set(c),c=N0}c.set(t,m),m=Q0;let o=m/h*100;return P({progress:o,loaded:m,total:h}),a()}return await a(),c}function B(...R){return R=R.map((P,k)=>{if(k)P=P.replace(new RegExp("^/"),"");if(k!==R.length-1)P=P.replace(new RegExp("/$"),"");return P}),R.join("/")}},"./src/utils/image.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/image.js ***!
  \****************************/$.r(Z),$.d(Z,{RawImage:()=>F,load_image:()=>v});var Q=$("./src/utils/core.js");/*! ./core.js */var W=$("./src/utils/hub.js");/*! ./hub.js */var Y=$("./src/env.js");/*! ../env.js */var H=$("./src/utils/tensor.js");/*! ./tensor.js */var G=$("sharp");/*! sharp */let q,z,U,N=Y.apis.IS_BROWSER_ENV||Y.apis.IS_WEBWORKER_ENV;if(N)q=(I,j)=>{if(!self.OffscreenCanvas)throw Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(I,j)},U=self.createImageBitmap,z=self.ImageData;else if(G.default)U=async(I)=>{let y=(await I.metadata()).channels,{data:g,info:A}=await I.rotate().raw().toBuffer({resolveWithObject:!0}),T=new F(new Uint8ClampedArray(g),A.width,A.height,A.channels);if(y!==void 0&&y!==A.channels)T.convert(y);return T};else throw Error("Unable to load image processing library.");let L={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},w=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class F{constructor(I,j,y,g){this.data=I,this.width=j,this.height=y,this.channels=g}get size(){return[this.width,this.height]}static async read(I){if(I instanceof F)return I;else if(typeof I==="string"||I instanceof URL)return await this.fromURL(I);else if(I instanceof Blob)return await this.fromBlob(I);else if(typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&I instanceof OffscreenCanvas)return this.fromCanvas(I);else throw Error(`Unsupported input type: ${typeof I}`)}static fromCanvas(I){if(!N)throw Error("fromCanvas() is only supported in browser environments.");let y=I.getContext("2d").getImageData(0,0,I.width,I.height).data;return new F(y,I.width,I.height,4)}static async fromURL(I){let j=await(0,W.getFile)(I);if(j.status!==200)throw Error(`Unable to read image from "${I}" (${j.status} ${j.statusText})`);let y=await j.blob();return this.fromBlob(y)}static async fromBlob(I){if(N){let j=await U(I),y=q(j.width,j.height).getContext("2d");return y.drawImage(j,0,0),new this(y.getImageData(0,0,j.width,j.height).data,j.width,j.height,4)}else{let j=(0,G.default)(await I.arrayBuffer());return await U(j)}}static fromTensor(I,j="CHW"){if(I.dims.length!==3)throw Error(`Tensor should have 3 dimensions, but has ${I.dims.length} dimensions.`);if(j==="CHW")I=I.transpose(1,2,0);else if(j==="HWC");else throw Error(`Unsupported channel format: ${j}`);if(!(I.data instanceof Uint8ClampedArray||I.data instanceof Uint8Array))throw Error(`Unsupported tensor type: ${I.type}`);switch(I.dims[2]){case 1:case 2:case 3:case 4:return new F(I.data,I.dims[1],I.dims[0],I.dims[2]);default:throw Error(`Unsupported number of channels: ${I.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let I=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let j=0,y=0;j<this.data.length;j+=this.channels){let g=this.data[j],A=this.data[j+1],T=this.data[j+2];I[y++]=Math.round(0.2989*g+0.587*A+0.114*T)}break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(I,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let I=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let j=0,y=0;j<this.data.length;++j)I[y++]=this.data[j],I[y++]=this.data[j],I[y++]=this.data[j];break;case 4:for(let j=0,y=0;j<this.data.length;j+=4)I[y++]=this.data[j],I[y++]=this.data[j+1],I[y++]=this.data[j+2];break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(I,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let I=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let j=0,y=0;j<this.data.length;++j)I[y++]=this.data[j],I[y++]=this.data[j],I[y++]=this.data[j],I[y++]=255;break;case 3:for(let j=0,y=0;j<this.data.length;j+=3)I[y++]=this.data[j],I[y++]=this.data[j+1],I[y++]=this.data[j+2],I[y++]=255;break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(I,this.width,this.height,4)}putAlpha(I){if(I.width!==this.width||I.height!==this.height)throw Error(`Expected mask size to be ${this.width}x${this.height}, but got ${I.width}x${I.height}`);if(I.channels!==1)throw Error(`Expected mask to have 1 channel, but got ${I.channels}`);let j=this.data,y=I.data,g=this.width*this.height;if(this.channels===3){let A=new Uint8ClampedArray(g*4);for(let T=0,B=0,R=0;T<g;++T)A[R++]=j[B++],A[R++]=j[B++],A[R++]=j[B++],A[R++]=y[T];return this._update(A,this.width,this.height,4)}else if(this.channels===4){for(let A=0;A<g;++A)j[4*A+3]=y[A];return this}throw Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(I,j,{resample:y=2}={}){if(this.width===I&&this.height===j)return this;let g=L[y]??y,A=(0,Q.isNullishDimension)(I),T=(0,Q.isNullishDimension)(j);if(A&&T)return this;else if(A)I=j/this.height*this.width;else if(T)j=I/this.width*this.height;if(N){let B=this.channels,R=this.toCanvas(),P=q(I,j).getContext("2d");return P.drawImage(R,0,0,I,j),new F(P.getImageData(0,0,I,j).data,I,j,4).convert(B)}else{let B=this.toSharp();switch(g){case"box":case"hamming":if(g==="box"||g==="hamming")console.warn(`Resampling method ${g} is not yet supported. Using bilinear instead.`),g="bilinear";case"nearest":case"bilinear":case"bicubic":B=B.affine([I/this.width,0,0,j/this.height],{interpolator:g});break;case"lanczos":B=B.resize({width:I,height:j,fit:"fill",kernel:"lanczos3"});break;default:throw Error(`Resampling method ${g} is not supported.`)}return await U(B)}}async pad([I,j,y,g]){if(I=Math.max(I,0),j=Math.max(j,0),y=Math.max(y,0),g=Math.max(g,0),I===0&&j===0&&y===0&&g===0)return this;if(N){let A=this.channels,T=this.toCanvas(),B=this.width+I+j,R=this.height+y+g,P=q(B,R).getContext("2d");return P.drawImage(T,0,0,this.width,this.height,I,y,this.width,this.height),new F(P.getImageData(0,0,B,R).data,B,R,4).convert(A)}else{let A=this.toSharp().extend({left:I,right:j,top:y,bottom:g});return await U(A)}}async crop([I,j,y,g]){if(I=Math.max(I,0),j=Math.max(j,0),y=Math.min(y,this.width-1),g=Math.min(g,this.height-1),I===0&&j===0&&y===this.width-1&&g===this.height-1)return this;let A=y-I+1,T=g-j+1;if(N){let B=this.channels,R=this.toCanvas(),P=q(A,T).getContext("2d");return P.drawImage(R,I,j,A,T,0,0,A,T),new F(P.getImageData(0,0,A,T).data,A,T,4).convert(B)}else{let B=this.toSharp().extract({left:I,top:j,width:A,height:T});return await U(B)}}async center_crop(I,j){if(this.width===I&&this.height===j)return this;let y=(this.width-I)/2,g=(this.height-j)/2;if(N){let A=this.channels,T=this.toCanvas(),B=q(I,j).getContext("2d"),R=0,P=0,k=0,h=0;if(y>=0)R=y;else k=-y;if(g>=0)P=g;else h=-g;return B.drawImage(T,R,P,I,j,k,h,I,j),new F(B.getImageData(0,0,I,j).data,I,j,4).convert(A)}else{let A=this.toSharp();if(y>=0&&g>=0)A=A.extract({left:Math.floor(y),top:Math.floor(g),width:I,height:j});else if(y<=0&&g<=0){let T=Math.floor(-g),B=Math.floor(-y);A=A.extend({top:T,left:B,right:I-this.width-B,bottom:j-this.height-T})}else{let T=[0,0],B=0;if(g<0)T[0]=Math.floor(-g),T[1]=j-this.height-T[0];else B=Math.floor(g);let R=[0,0],P=0;if(y<0)R[0]=Math.floor(-y),R[1]=I-this.width-R[0];else P=Math.floor(y);A=A.extend({top:T[0],bottom:T[1],left:R[0],right:R[1]}).extract({left:P,top:B,width:I,height:j})}return await U(A)}}async toBlob(I="image/png",j=1){if(!N)throw Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:I,quality:j})}toTensor(I="CHW"){let j=new H.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(I==="HWC");else if(I==="CHW")j=j.permute(2,0,1);else throw Error(`Unsupported channel format: ${I}`);return j}toCanvas(){if(!N)throw Error("toCanvas() is only supported in browser environments.");let I=this.clone().rgba(),j=q(I.width,I.height),y=new z(I.data,I.width,I.height);return j.getContext("2d").putImageData(y,0,0),j}split(){let{data:I,width:j,height:y,channels:g}=this,A=I.constructor,T=I.length/g,B=Array.from({length:g},()=>new A(T));for(let R=0;R<T;++R){let P=g*R;for(let k=0;k<g;++k)B[k][R]=I[P+k]}return B.map((R)=>new F(R,j,y,1))}_update(I,j,y,g=null){if(this.data=I,this.width=j,this.height=y,g!==null)this.channels=g;return this}clone(){return new F(this.data.slice(),this.width,this.height,this.channels)}convert(I){if(this.channels===I)return this;switch(I){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(I){if(N){if(Y.apis.IS_WEBWORKER_ENV)throw Error("Unable to save an image from a Web Worker.");let j=I.split(".").pop().toLowerCase(),y=w.get(j)??"image/png",g=await this.toBlob(y);(0,Q.saveBlob)(I,g)}else if(!Y.apis.IS_FS_AVAILABLE)throw Error("Unable to save the image because filesystem is disabled in this environment.");else return await this.toSharp().toFile(I)}toSharp(){if(N)throw Error("toSharp() is only supported in server-side environments.");return(0,G.default)(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}let v=F.read.bind(F)},"./src/utils/maths.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/maths.js ***!
  \****************************/$.r(Z),$.d(Z,{FFT:()=>v,bankers_round:()=>y,cos_sim:()=>q,dot:()=>G,dynamic_time_warping:()=>g,interpolate_data:()=>Q,log_softmax:()=>H,magnitude:()=>z,max:()=>N,medianFilter:()=>I,min:()=>U,permute_data:()=>W,round:()=>j,softmax:()=>Y});function Q(A,[T,B,R],[P,k],h="bilinear",c=!1){let m=k/R,d=P/B,a=new A.constructor(P*k*T),n=B*R,t=P*k;for(let Q0=0;Q0<P;++Q0)for(let o=0;o<k;++o){let N0=Q0*k+o,w0=(o+0.5)/m-0.5,D=(Q0+0.5)/d-0.5,O=Math.floor(w0),p=Math.floor(D),Z0=Math.min(O+1,R-1),z0=Math.min(p+1,B-1);O=Math.max(O,0),p=Math.max(p,0);let A0=w0-O,j0=D-p,h0=(1-A0)*(1-j0),d0=A0*(1-j0),T0=(1-A0)*j0,b=A0*j0,S=p*R,W0=z0*R,B0=S+O,D0=S+Z0,R0=W0+O,Y0=W0+Z0;for(let E0=0;E0<T;++E0){let X0=E0*n;a[E0*t+N0]=h0*A[X0+B0]+d0*A[X0+D0]+T0*A[X0+R0]+b*A[X0+Y0]}}return a}function W(A,T,B){let R=Array(B.length),P=Array(B.length);for(let c=B.length-1,m=1;c>=0;--c)P[c]=m,R[c]=T[B[c]],m*=R[c];let k=B.map((c,m)=>P[B.indexOf(m)]),h=new A.constructor(A.length);for(let c=0;c<A.length;++c){let m=0;for(let d=T.length-1,a=c;d>=0;--d)m+=a%T[d]*k[d],a=Math.floor(a/T[d]);h[m]=A[c]}return[h,R]}function Y(A){let T=N(A)[0],B=A.map((k)=>Math.exp(k-T)),R=B.reduce((k,h)=>k+h,0);return B.map((k)=>k/R)}function H(A){let T=N(A)[0],B=0;for(let k=0;k<A.length;++k)B+=Math.exp(A[k]-T);let R=Math.log(B);return A.map((k)=>k-T-R)}function G(A,T){let B=0;for(let R=0;R<A.length;++R)B+=A[R]*T[R];return B}function q(A,T){let B=G(A,T),R=z(A),P=z(T);return B/(R*P)}function z(A){return Math.sqrt(A.reduce((T,B)=>T+B*B,0))}function U(A){if(A.length===0)throw Error("Array must not be empty");let T=A[0],B=0;for(let R=1;R<A.length;++R)if(A[R]<T)T=A[R],B=R;return[T,B]}function N(A){if(A.length===0)throw Error("Array must not be empty");let T=A[0],B=0;for(let R=1;R<A.length;++R)if(A[R]>T)T=A[R],B=R;return[T,B]}function L(A){return A>0&&(A&A-1)===0}class w{constructor(A){if(this.size=A|0,this.size<=1||!L(this.size))throw Error("FFT size must be a power of two larger than 1");this._csize=A<<1,this.table=new Float64Array(this.size*2);for(let B=0;B<this.table.length;B+=2){let R=Math.PI*B/this.size;this.table[B]=Math.cos(R),this.table[B+1]=-Math.sin(R)}let T=0;for(let B=1;this.size>B;B<<=1)++T;this._width=T%2===0?T-1:T,this._bitrev=new Int32Array(1<<this._width);for(let B=0;B<this._bitrev.length;++B){this._bitrev[B]=0;for(let R=0;R<this._width;R+=2){let P=this._width-R-2;this._bitrev[B]|=(B>>>R&3)<<P}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(A,T){let B=T||Array(A.length>>>1);for(let R=0;R<A.length;R+=2)B[R>>>1]=A[R];return B}toComplexArray(A,T){let B=T||this.createComplexArray();for(let R=0;R<B.length;R+=2)B[R]=A[R>>>1],B[R+1]=0;return B}transform(A,T){if(A===T)throw Error("Input and output buffers must be different");this._transform4(A,T,1)}realTransform(A,T){if(A===T)throw Error("Input and output buffers must be different");this._realTransform4(A,T,1)}inverseTransform(A,T){if(A===T)throw Error("Input and output buffers must be different");this._transform4(A,T,-1);for(let B=0;B<A.length;++B)A[B]/=this.size}_transform4(A,T,B){let R=this._csize,k=1<<this._width,h=R/k<<1,c,m,d=this._bitrev;if(h===4)for(c=0,m=0;c<R;c+=h,++m){let n=d[m];this._singleTransform2(T,A,c,n,k)}else for(c=0,m=0;c<R;c+=h,++m){let n=d[m];this._singleTransform4(T,A,c,n,k,B)}let a=this.table;for(k>>=2;k>=2;k>>=2){h=R/k<<1;let n=h>>>2;for(c=0;c<R;c+=h){let t=c+n-1;for(let Q0=c,o=0;Q0<t;Q0+=2,o+=k){let N0=Q0,w0=N0+n,D=w0+n,O=D+n,p=A[N0],Z0=A[N0+1],z0=A[w0],A0=A[w0+1],j0=A[D],h0=A[D+1],d0=A[O],T0=A[O+1],b=a[o],S=B*a[o+1],W0=z0*b-A0*S,B0=z0*S+A0*b,D0=a[2*o],R0=B*a[2*o+1],Y0=j0*D0-h0*R0,E0=j0*R0+h0*D0,X0=a[3*o],F0=B*a[3*o+1],C0=d0*X0-T0*F0,x0=d0*F0+T0*X0,V0=p+Y0,u0=Z0+E0,b0=p-Y0,s0=Z0-E0,l0=W0+C0,y0=B0+x0,i0=B*(W0-C0),a0=B*(B0-x0);A[N0]=V0+l0,A[N0+1]=u0+y0,A[w0]=b0+a0,A[w0+1]=s0-i0,A[D]=V0-l0,A[D+1]=u0-y0,A[O]=b0-a0,A[O+1]=s0+i0}}}}_singleTransform2(A,T,B,R,P){let k=A[R],h=A[R+1],c=A[R+P],m=A[R+P+1];T[B]=k+c,T[B+1]=h+m,T[B+2]=k-c,T[B+3]=h-m}_singleTransform4(A,T,B,R,P,k){let h=P*2,c=P*3,m=A[R],d=A[R+1],a=A[R+P],n=A[R+P+1],t=A[R+h],Q0=A[R+h+1],o=A[R+c],N0=A[R+c+1],w0=m+t,D=d+Q0,O=m-t,p=d-Q0,Z0=a+o,z0=n+N0,A0=k*(a-o),j0=k*(n-N0);T[B]=w0+Z0,T[B+1]=D+z0,T[B+2]=O+j0,T[B+3]=p-A0,T[B+4]=w0-Z0,T[B+5]=D-z0,T[B+6]=O-j0,T[B+7]=p+A0}_realTransform4(A,T,B){let R=this._csize,k=1<<this._width,h=R/k<<1,c,m,d=this._bitrev;if(h===4)for(c=0,m=0;c<R;c+=h,++m){let t=d[m];this._singleRealTransform2(T,A,c,t>>>1,k>>>1)}else for(c=0,m=0;c<R;c+=h,++m){let t=d[m];this._singleRealTransform4(T,A,c,t>>>1,k>>>1,B)}let a=this.table;for(k>>=2;k>=2;k>>=2){h=R/k<<1;let t=h>>>1,Q0=t>>>1,o=Q0>>>1;for(c=0;c<R;c+=h)for(let N0=0,w0=0;N0<=o;N0+=2,w0+=k){let D=c+N0,O=D+Q0,p=O+Q0,Z0=p+Q0,z0=A[D],A0=A[D+1],j0=A[O],h0=A[O+1],d0=A[p],T0=A[p+1],b=A[Z0],S=A[Z0+1],W0=z0,B0=A0,D0=a[w0],R0=B*a[w0+1],Y0=j0*D0-h0*R0,E0=j0*R0+h0*D0,X0=a[2*w0],F0=B*a[2*w0+1],C0=d0*X0-T0*F0,x0=d0*F0+T0*X0,V0=a[3*w0],u0=B*a[3*w0+1],b0=b*V0-S*u0,s0=b*u0+S*V0,l0=W0+C0,y0=B0+x0,i0=W0-C0,a0=B0-x0,n0=Y0+b0,B6=E0+s0,W6=B*(Y0-b0),a6=B*(E0-s0);if(A[D]=l0+n0,A[D+1]=y0+B6,A[O]=i0+a6,A[O+1]=a0-W6,N0===0){A[p]=l0-n0,A[p+1]=y0-B6;continue}if(N0===o)continue;let H4=c+Q0-N0,V4=c+t-N0;A[H4]=i0-B*a6,A[H4+1]=-a0-B*W6,A[V4]=l0-B*n0,A[V4+1]=-y0+B*B6}}let n=R>>>1;for(let t=2;t<n;t+=2)A[R-t]=A[t],A[R-t+1]=-A[t+1]}_singleRealTransform2(A,T,B,R,P){let k=A[R],h=A[R+P];T[B]=k+h,T[B+1]=0,T[B+2]=k-h,T[B+3]=0}_singleRealTransform4(A,T,B,R,P,k){let h=P*2,c=P*3,m=A[R],d=A[R+P],a=A[R+h],n=A[R+c],t=m+a,Q0=m-a,o=d+n,N0=k*(d-n);T[B]=t+o,T[B+1]=0,T[B+2]=Q0,T[B+3]=-N0,T[B+4]=t-o,T[B+5]=0,T[B+6]=Q0,T[B+7]=N0}}class F{constructor(A){let T=2*(A-1),B=2*(2*A-1),R=2**Math.ceil(Math.log2(B));this.bufferSize=R,this._a=T;let P=new Float64Array(B),k=new Float64Array(R);this._chirpBuffer=new Float64Array(R),this._buffer1=new Float64Array(R),this._buffer2=new Float64Array(R),this._outBuffer1=new Float64Array(R),this._outBuffer2=new Float64Array(R);let h=-2*Math.PI/A,c=Math.cos(h),m=Math.sin(h);for(let d=0;d<B>>1;++d){let a=(d+1-A)**2/2,n=Math.sqrt(c**2+m**2)**a,t=a*Math.atan2(m,c),Q0=2*d;P[Q0]=n*Math.cos(t),P[Q0+1]=n*Math.sin(t),k[Q0]=P[Q0],k[Q0+1]=-P[Q0+1]}this._slicedChirpBuffer=P.subarray(T,B),this._f=new w(R>>1),this._f.transform(this._chirpBuffer,k)}_transform(A,T,B){let R=this._buffer1,P=this._buffer2,k=this._outBuffer1,h=this._outBuffer2,c=this._chirpBuffer,m=this._slicedChirpBuffer,d=this._a;if(B)for(let a=0;a<m.length;a+=2){let n=a+1,t=a>>1,Q0=T[t];R[a]=Q0*m[a],R[n]=Q0*m[n]}else for(let a=0;a<m.length;a+=2){let n=a+1;R[a]=T[a]*m[a]-T[n]*m[n],R[n]=T[a]*m[n]+T[n]*m[a]}this._f.transform(k,R);for(let a=0;a<c.length;a+=2){let n=a+1;P[a]=k[a]*c[a]-k[n]*c[n],P[n]=k[a]*c[n]+k[n]*c[a]}this._f.inverseTransform(h,P);for(let a=0;a<h.length;a+=2){let n=h[a+d],t=h[a+d+1],Q0=m[a],o=m[a+1];A[a]=n*Q0-t*o,A[a+1]=n*o+t*Q0}}transform(A,T){this._transform(A,T,!1)}realTransform(A,T){this._transform(A,T,!0)}}class v{constructor(A){if(this.fft_length=A,this.isPowerOfTwo=L(A),this.isPowerOfTwo)this.fft=new w(A),this.outputBufferSize=2*A;else this.fft=new F(A),this.outputBufferSize=this.fft.bufferSize}realTransform(A,T){this.fft.realTransform(A,T)}transform(A,T){this.fft.transform(A,T)}}function I(A,T){if(T%2===0||T<=0)throw Error("Window size must be a positive odd number");let B=new A.constructor(A.length),R=new A.constructor(T),P=Math.floor(T/2);for(let k=0;k<A.length;++k){let h=0;for(let c=-P;c<=P;++c){let m=k+c;if(m<0)m=Math.abs(m);else if(m>=A.length)m=2*(A.length-1)-m;R[h++]=A[m]}R.sort(),B[k]=R[P]}return B}function j(A,T){let B=Math.pow(10,T);return Math.round(A*B)/B}function y(A){let T=Math.round(A);return Math.abs(A)%1===0.5?T%2===0?T:T-1:T}function g(A){let T=A.length,B=A[0].length,R=[T+1,B+1],P=Array.from({length:R[0]},()=>Array(R[1]).fill(1/0));P[0][0]=0;let k=Array.from({length:R[0]},()=>Array(R[1]).fill(-1));for(let a=1;a<R[1];++a)for(let n=1;n<R[0];++n){let t=P[n-1][a-1],Q0=P[n-1][a],o=P[n][a-1],N0,w0;if(t<Q0&&t<o)N0=t,w0=0;else if(Q0<t&&Q0<o)N0=Q0,w0=1;else N0=o,w0=2;P[n][a]=A[n-1][a-1]+N0,k[n][a]=w0}for(let a=0;a<R[1];++a)k[0][a]=2;for(let a=0;a<R[0];++a)k[a][0]=1;let h=T,c=B,m=[],d=[];while(h>0||c>0)switch(m.push(h-1),d.push(c-1),k[h][c]){case 0:--h,--c;break;case 1:--h;break;case 2:--c;break;default:throw Error(`Internal error in dynamic time warping. Unexpected trace[${h}, ${c}]. Please file a bug report.`)}return m.reverse(),d.reverse(),[m,d]}},"./src/utils/tensor.js":(J,Z,$)=>{/*!*****************************!*\
  !*** ./src/utils/tensor.js ***!
  \*****************************/$.r(Z),$.d(Z,{DataTypeMap:()=>H,Tensor:()=>G,cat:()=>B,full:()=>d,full_like:()=>a,interpolate:()=>U,interpolate_4d:()=>N,layer_norm:()=>y,matmul:()=>L,mean:()=>h,mean_pooling:()=>j,ones:()=>n,ones_like:()=>t,permute:()=>z,quantize_embeddings:()=>w0,rand:()=>N0,rfft:()=>w,slice:()=>I,stack:()=>R,std_mean:()=>k,topk:()=>F,zeros:()=>Q0,zeros_like:()=>o});var Q=$("./src/utils/maths.js");/*! ./maths.js */var W=$("./src/backends/onnx.js");/*! ../backends/onnx.js */var Y=$("./src/ops/registry.js");/*! ../ops/registry.js */let H=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class G{get dims(){return this.ort_tensor.dims}set dims(D){this.ort_tensor.dims=D}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...D){if((0,W.isONNXTensor)(D[0]))this.ort_tensor=D[0];else this.ort_tensor=new W.Tensor(D[0],D[1],D[2]);return new Proxy(this,{get:(O,p)=>{if(typeof p==="string"){let Z0=Number(p);if(Number.isInteger(Z0))return O._getitem(Z0)}return O[p]},set:(O,p,Z0)=>{return O[p]=Z0}})}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){let[D,...O]=this.dims;if(O.length>0){let p=O.reduce((Z0,z0)=>Z0*z0);for(let Z0=0;Z0<D;++Z0)yield this._subarray(Z0,p,O)}else yield*this.data}_getitem(D){let[O,...p]=this.dims;if(D=T(D,O),p.length>0){let Z0=p.reduce((z0,A0)=>z0*A0);return this._subarray(D,Z0,p)}else return new G(this.type,[this.data[D]],p)}indexOf(D){let O=this.data;for(let p=0;p<O.length;++p)if(O[p]==D)return p;return-1}_subarray(D,O,p){let Z0=D*O,z0=(D+1)*O,A0="subarray"in this.data?this.data.subarray(Z0,z0):this.data.slice(Z0,z0);return new G(this.type,A0,p)}item(){let D=this.data;if(D.length!==1)throw Error(`a Tensor with ${D.length} elements cannot be converted to Scalar`);return D[0]}tolist(){return q(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){let D=this.data;for(let O=0;O<D.length;++O)D[O]=1/(1+Math.exp(-D[O]));return this}map(D){return this.clone().map_(D)}map_(D){let O=this.data;for(let p=0;p<O.length;++p)O[p]=D(O[p],p,O);return this}mul(D){return this.clone().mul_(D)}mul_(D){let O=this.data;for(let p=0;p<O.length;++p)O[p]*=D;return this}div(D){return this.clone().div_(D)}div_(D){let O=this.data;for(let p=0;p<O.length;++p)O[p]/=D;return this}add(D){return this.clone().add_(D)}add_(D){let O=this.data;for(let p=0;p<O.length;++p)O[p]+=D;return this}sub(D){return this.clone().sub_(D)}sub_(D){let O=this.data;for(let p=0;p<O.length;++p)O[p]-=D;return this}clone(){return new G(this.type,this.data.slice(),this.dims.slice())}slice(...D){let O=[],p=[];for(let T0=0;T0<this.dims.length;++T0){let b=D[T0];if(b===null||b===void 0)p.push([0,this.dims[T0]]),O.push(this.dims[T0]);else if(typeof b==="number")b=T(b,this.dims[T0],T0),p.push([b,b+1]);else if(Array.isArray(b)&&b.length===2){let[S,W0]=b;if(S=S===null?0:T(S,this.dims[T0],T0,!1),W0=W0===null?this.dims[T0]:T(W0,this.dims[T0],T0,!1),S>W0)throw Error(`Invalid slice: ${b}`);let B0=[Math.max(S,0),Math.min(W0,this.dims[T0])];p.push(B0),O.push(B0[1]-B0[0])}else throw Error(`Invalid slice: ${b}`)}let Z0=p.map(([T0,b])=>b-T0),z0=Z0.reduce((T0,b)=>T0*b),A0=this.data,j0=new A0.constructor(z0),h0=this.stride(),d0=!0;for(let T0=1;T0<Z0.length;++T0)if(p[T0][0]!==0||p[T0][1]!==this.dims[T0]){d0=!1;break}if(d0){let T0=p[0][0]*h0[0],b=p[0][1]*h0[0];if(ArrayBuffer.isView(A0))j0.set(A0.subarray(T0,b));else if(Array.isArray(A0)){let S=A0.slice(T0,b);for(let W0=0;W0<S.length;++W0)j0[W0]=S[W0]}else throw Error("Unsupported data type for slicing")}else for(let T0=0;T0<z0;++T0){let b=0;for(let S=Z0.length-1,W0=T0;S>=0;--S){let B0=Z0[S];b+=(W0%B0+p[S][0])*h0[S],W0=Math.floor(W0/B0)}j0[T0]=A0[b]}return new G(this.type,j0,O)}permute(...D){return z(this,D)}transpose(...D){return this.permute(...D)}sum(D=null,O=!1){return this.norm(1,D,O)}norm(D="fro",O=null,p=!1){if(D==="fro")D=2;else if(typeof D==="string")throw Error(`Unsupported norm: ${D}`);let Z0=this.data,z0=(d0,T0)=>d0+T0**D;if(O===null){let d0=Z0.reduce(z0,0)**(1/D);return new G(this.type,[d0],[])}let[A0,j0,h0]=P(z0,this,O,p);if(D!==1)for(let d0=0;d0<j0.length;++d0)j0[d0]=j0[d0]**(1/D);return new G(A0,j0,h0)}normalize_(D=2,O=1){O=T(O,this.dims.length);let p=this.norm(D,O,!0),Z0=this.data,z0=p.data;for(let A0=0;A0<Z0.length;++A0){let j0=0;for(let h0=this.dims.length-1,d0=A0,T0=1;h0>=0;--h0){let b=this.dims[h0];if(h0!==O){let S=d0%b;j0+=S*T0,T0*=this.dims[h0]}d0=Math.floor(d0/b)}Z0[A0]/=z0[j0]}return this}normalize(D=2,O=1){return this.clone().normalize_(D,O)}stride(){return c(this.dims)}squeeze(D=null){return new G(this.type,this.data,g(this.dims,D))}squeeze_(D=null){return this.dims=g(this.dims,D),this}unsqueeze(D=null){return new G(this.type,this.data,A(this.dims,D))}unsqueeze_(D=null){return this.dims=A(this.dims,D),this}flatten_(D=0,O=-1){O=(O+this.dims.length)%this.dims.length;let p=this.dims.slice(0,D),Z0=this.dims.slice(D,O+1),z0=this.dims.slice(O+1);return this.dims=[...p,Z0.reduce((A0,j0)=>A0*j0,1),...z0],this}flatten(D=0,O=-1){return this.clone().flatten_(D,O)}view(...D){let O=-1;for(let Z0=0;Z0<D.length;++Z0)if(D[Z0]===-1){if(O!==-1)throw Error("Only one dimension can be inferred");O=Z0}let p=this.data;if(O!==-1){let Z0=D.reduce((z0,A0,j0)=>{return j0!==O?z0*A0:z0},1);D[O]=p.length/Z0}return new G(this.type,p,D)}neg_(){let D=this.data;for(let O=0;O<D.length;++O)D[O]=-D[O];return this}neg(){return this.clone().neg_()}gt(D){let O=new Uint8Array(this.data.length),p=this.data;for(let Z0=0;Z0<p.length;++Z0)O[Z0]=p[Z0]>D?1:0;return new G("bool",O,this.dims)}lt(D){let O=new Uint8Array(this.data.length),p=this.data;for(let Z0=0;Z0<p.length;++Z0)O[Z0]=p[Z0]<D?1:0;return new G("bool",O,this.dims)}clamp_(D,O){let p=this.data;for(let Z0=0;Z0<p.length;++Z0)p[Z0]=Math.min(Math.max(p[Z0],D),O);return this}clamp(D,O){return this.clone().clamp_(D,O)}round_(){let D=this.data;for(let O=0;O<D.length;++O)D[O]=Math.round(D[O]);return this}round(){return this.clone().round_()}mean(D=null,O=!1){return h(this,D,O)}min(D=null,O=!1){if(D===null){let A0=(0,Q.min)(this.data)[0];return new G(this.type,[A0],[])}let[p,Z0,z0]=P((A0,j0)=>Math.min(A0,j0),this,D,O,1/0);return new G(p,Z0,z0)}max(D=null,O=!1){if(D===null){let A0=(0,Q.max)(this.data)[0];return new G(this.type,[A0],[])}let[p,Z0,z0]=P((A0,j0)=>Math.max(A0,j0),this,D,O,-1/0);return new G(p,Z0,z0)}argmin(D=null,O=!1){if(D!==null)throw Error("`dim !== null` not yet implemented.");let p=(0,Q.min)(this.data)[1];return new G("int64",[BigInt(p)],[])}argmax(D=null,O=!1){if(D!==null)throw Error("`dim !== null` not yet implemented.");let p=(0,Q.max)(this.data)[1];return new G("int64",[BigInt(p)],[])}to(D){if(this.type===D)return this;if(!H.hasOwnProperty(D))throw Error(`Unsupported type: ${D}`);let O,p=["int64","uint64"].includes(this.type),Z0=["int64","uint64"].includes(D);if(p&&!Z0)O=Number;else if(!p&&Z0)O=BigInt;return new G(D,H[D].from(this.data,O),this.dims)}}function q(D,O){let p=D.length,Z0=O.reduce((A0,j0)=>A0*j0);if(p!==Z0)throw Error(`cannot reshape array of size ${p} into shape (${O})`);let z0=D;for(let A0=O.length-1;A0>=0;A0--)z0=z0.reduce((j0,h0)=>{let d0=j0[j0.length-1];if(d0.length<O[A0])d0.push(h0);else j0.push([h0]);return j0},[[]]);return z0[0]}function z(D,O){let[p,Z0]=(0,Q.permute_data)(D.data,D.dims,O);return new G(D.type,p,Z0)}function U(D,[O,p],Z0="bilinear",z0=!1){let A0=D.dims.at(-3)??1,j0=D.dims.at(-2),h0=D.dims.at(-1),d0=(0,Q.interpolate_data)(D.data,[A0,j0,h0],[O,p],Z0,z0);return new G(D.type,d0,[A0,O,p])}async function N(D,{size:O=null,mode:p="bilinear"}={}){if(D.dims.length!==4)throw Error("`interpolate_4d` currently only supports 4D input.");if(!O)throw Error("`interpolate_4d` requires a `size` argument.");let Z0;if(O.length===2)Z0=[...D.dims.slice(0,2),...O];else if(O.length===3)Z0=[D.dims[0],...O];else if(O.length===4)Z0=O;else throw Error("`size` must be of length 2, 3, or 4.");let z0;if(p==="nearest")z0=await Y.TensorOpRegistry.nearest_interpolate_4d;else if(p==="bilinear")z0=await Y.TensorOpRegistry.bilinear_interpolate_4d;else if(p==="bicubic")z0=await Y.TensorOpRegistry.bicubic_interpolate_4d;else throw Error(`Unsupported mode: ${p}`);let A0=new G("int64",new BigInt64Array(Z0.map(BigInt)),[Z0.length]);return await z0({x:D,s:A0})}async function L(D,O){return await(await Y.TensorOpRegistry.matmul)({a:D,b:O})}async function w(D,O){return await(await Y.TensorOpRegistry.rfft)({x:D,a:O})}async function F(D,O){let p=await Y.TensorOpRegistry.top_k;if(O==null)O=D.dims.at(-1);else O=Math.min(O,D.dims.at(-1));return await p({x:D,k:new G("int64",[BigInt(O)],[1])})}let v=(D)=>new G("int64",D,[D.length]);async function I(D,O,p,Z0,z0){return await(await Y.TensorOpRegistry.slice)({x:D,s:v(O),e:v(p),a:v(Z0),t:v(z0??Array(Z0.length).fill(1))})}function j(D,O){let p=D.data,Z0=O.data,z0=[D.dims[0],D.dims[2]],A0=new p.constructor(z0[0]*z0[1]),[j0,h0,d0]=D.dims,T0=0;for(let b=0;b<j0;++b){let S=b*d0*h0;for(let W0=0;W0<d0;++W0){let B0=0,D0=0,R0=b*h0,Y0=S+W0;for(let X0=0;X0<h0;++X0){let F0=Number(Z0[R0+X0]);D0+=F0,B0+=p[Y0+X0*d0]*F0}let E0=B0/D0;A0[T0++]=E0}}return new G(D.type,A0,z0)}function y(D,O,{eps:p=0.00001}={}){if(D.dims.length!==2)throw Error("`layer_norm` currently only supports 2D input.");let[Z0,z0]=D.dims;if(O.length!==1&&O[0]!==z0)throw Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");let[A0,j0]=k(D,1,0,!0),h0=A0.data,d0=j0.data,T0=D.data,b=new T0.constructor(T0.length);for(let S=0;S<Z0;++S){let W0=S*z0;for(let B0=0;B0<z0;++B0){let D0=W0+B0;b[D0]=(T0[D0]-d0[S])/(h0[S]+p)}}return new G(D.type,b,D.dims)}function g(D,O){if(D=D.slice(),O===null)D=D.filter((p)=>p!==1);else if(typeof O==="number"){if(D[O]===1)D.splice(O,1)}else if(Array.isArray(O))D=D.filter((p,Z0)=>{return p!==1||!O.includes(Z0)});return D}function A(D,O){return O=T(O,D.length+1),D=D.slice(),D.splice(O,0,1),D}function T(D,O,p=null,Z0=!0){if(D<-O||D>=O)if(Z0)throw Error(`IndexError: index ${D} is out of bounds for dimension${p===null?"":" "+p} with size ${O}`);else return D<-O?0:O;if(D<0)D=(D%O+O)%O;return D}function B(D,O=0){O=T(O,D[0].dims.length);let p=D[0].dims.slice();p[O]=D.reduce((j0,h0)=>j0+h0.dims[O],0);let Z0=p.reduce((j0,h0)=>j0*h0,1),z0=new D[0].data.constructor(Z0),A0=D[0].type;if(O===0){let j0=0;for(let h0 of D){let d0=h0.data;z0.set(d0,j0),j0+=d0.length}}else{let j0=0;for(let h0=0;h0<D.length;++h0){let{data:d0,dims:T0}=D[h0];for(let b=0;b<d0.length;++b){let S=0;for(let W0=T0.length-1,B0=b,D0=1;W0>=0;--W0){let R0=T0[W0],Y0=B0%R0;if(W0===O)Y0+=j0;S+=Y0*D0,D0*=p[W0],B0=Math.floor(B0/R0)}z0[S]=d0[b]}j0+=T0[O]}}return new G(A0,z0,p)}function R(D,O=0){return B(D.map((p)=>p.unsqueeze(O)),O)}function P(D,O,p=null,Z0=!1,z0=null){let{data:A0,dims:j0}=O;p=T(p,j0.length);let h0=j0.slice();h0[p]=1;let d0=new A0.constructor(A0.length/j0[p]);if(z0!==null)d0.fill(z0);for(let T0=0;T0<A0.length;++T0){let b=0;for(let S=j0.length-1,W0=T0,B0=1;S>=0;--S){let D0=j0[S];if(S!==p){let R0=W0%D0;b+=R0*B0,B0*=h0[S]}W0=Math.floor(W0/D0)}d0[b]=D(d0[b],A0[T0],T0,b)}if(!Z0)h0.splice(p,1);return[O.type,d0,h0]}function k(D,O=null,p=1,Z0=!1){let{data:z0,dims:A0}=D;if(O===null){let B0=z0.reduce((E0,X0)=>E0+X0,0)/z0.length,D0=Math.sqrt(z0.reduce((E0,X0)=>E0+(X0-B0)**2,0)/(z0.length-p)),R0=new G(D.type,[B0],[]);return[new G(D.type,[D0],[]),R0]}O=T(O,A0.length);let j0=h(D,O,Z0),h0=j0.data,[d0,T0,b]=P((W0,B0,D0,R0)=>W0+(B0-h0[R0])**2,D,O,Z0);for(let W0=0;W0<T0.length;++W0)T0[W0]=Math.sqrt(T0[W0]/(A0[O]-p));return[new G(d0,T0,b),j0]}function h(D,O=null,p=!1){let{dims:Z0,data:z0}=D;if(O===null){let d0=z0.reduce((T0,b)=>T0+b,0);return new G(D.type,[d0/z0.length],[])}O=T(O,Z0.length);let[A0,j0,h0]=P((d0,T0)=>d0+T0,D,O,p);if(Z0[O]!==1)for(let d0=0;d0<j0.length;++d0)j0[d0]/=Z0[O];return new G(A0,j0,h0)}function c(D){let O=Array(D.length);for(let p=D.length-1,Z0=1;p>=0;--p)O[p]=Z0,Z0*=D[p];return O}function m(D,O,p,Z0){let z0=D.reduce((A0,j0)=>A0*j0,1);return new G(p,new Z0(z0).fill(O),D)}function d(D,O){let p,Z0;if(typeof O==="number")p="float32",Z0=Float32Array;else if(typeof O==="bigint")p="int64",Z0=BigInt64Array;else if(typeof O==="boolean")p="bool",Z0=Uint8Array;else throw Error(`Unsupported data type: ${typeof O}`);return m(D,O,p,Z0)}function a(D,O){return d(D.dims,O)}function n(D){return m(D,1n,"int64",BigInt64Array)}function t(D){return n(D.dims)}function Q0(D){return m(D,0n,"int64",BigInt64Array)}function o(D){return Q0(D.dims)}function N0(D){let O=D.reduce((p,Z0)=>p*Z0,1);return new G("float32",Float32Array.from({length:O},()=>Math.random()),D)}function w0(D,O){if(D.dims.length!==2)throw Error("The tensor must have 2 dimensions");if(D.dims.at(-1)%8!==0)throw Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(O))throw Error("The precision must be either 'binary' or 'ubinary'");let p=O==="binary",Z0=p?"int8":"uint8",z0=p?Int8Array:Uint8Array,A0=D.data,j0=new z0(A0.length/8);for(let h0=0;h0<A0.length;++h0){let d0=A0[h0]>0?1:0,T0=Math.floor(h0/8),b=h0%8;if(j0[T0]|=d0<<7-b,p&&b===0)j0[T0]-=128}return new G(Z0,j0,[D.dims[0],D.dims[1]/8])}},"./src/utils/video.js":(J,Z,$)=>{/*!****************************!*\
  !*** ./src/utils/video.js ***!
  \****************************/$.r(Z),$.d(Z,{RawVideo:()=>H,RawVideoFrame:()=>Y,load_video:()=>G});var Q=$("./src/utils/image.js");/*! ./image.js */var W=$("./src/env.js");/*! ../env.js */class Y{constructor(q,z){this.image=q,this.timestamp=z}}class H{constructor(q,z){if(q.length>0&&q[0]instanceof Q.RawImage)q=q.map((U,N)=>new Y(U,(N+1)/(q.length+1)*z));this.frames=q,this.duration=z}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function G(q,{num_frames:z=null,fps:U=null}={}){if(!W.apis.IS_BROWSER_ENV)throw Error("`load_video` is currently only supported in browser environments.");if(z==null&&U==null)throw Error("Either num_frames or fps must be provided.");let N=[],L=document.createElement("video");if(L.crossOrigin="anonymous",L.muted=!0,typeof q==="string")L.src=q;else if(q instanceof Blob)L.src=URL.createObjectURL(q);else if(q instanceof HTMLVideoElement)L.src=q.src;else throw Error("Invalid URL or video element provided.");if(await new Promise((g)=>L.onloadedmetadata=g),L.seekable.start(0)===L.seekable.end(0)){let A=await(await fetch(L.src)).blob();L.src=URL.createObjectURL(A),await new Promise((T)=>L.onloadedmetadata=T)}let w=L.duration,F,v;if(z!=null)F=z,v=z===1?0:w/(z-1);else v=1/U,F=Math.floor(w/v);let I=[];for(let g=0;g<F;++g)I.push(z===1?w/2:g*v);let j=document.createElement("canvas");j.width=L.videoWidth,j.height=L.videoHeight;let y=j.getContext("2d",{willReadFrequently:!0});for(let g of I){L.currentTime=g,await new Promise((R)=>{L.onseeked=R}),y.drawImage(L,0,0,j.width,j.height);let A=y.getImageData(0,0,j.width,j.height),T=new Q.RawImage(A.data,j.width,j.height,4),B=new Y(T,g);N.push(B)}return L.remove(),new H(N,w)}}},uV={};function F6(J){var Z=uV[J];if(Z!==void 0)return Z.exports;var $=uV[J]={exports:{}};return RL[J]($,$.exports,F6),$.exports}(()=>{var J=Object.getPrototypeOf?($)=>Object.getPrototypeOf($):($)=>$.__proto__,Z;F6.t=function($,Q){if(Q&1)$=this($);if(Q&8)return $;if(typeof $==="object"&&$){if(Q&4&&$.__esModule)return $;if(Q&16&&typeof $.then==="function")return $}var W=Object.create(null);F6.r(W);var Y={};Z=Z||[null,J({}),J([]),J(J)];for(var H=Q&2&&$;typeof H=="object"&&!~Z.indexOf(H);H=J(H))Object.getOwnPropertyNames(H).forEach((G)=>Y[G]=()=>$[G]);return Y.default=()=>$,F6.d(W,Y),W}})();(()=>{F6.d=(J,Z)=>{for(var $ in Z)if(F6.o(Z,$)&&!F6.o(J,$))Object.defineProperty(J,$,{enumerable:!0,get:Z[$]})}})();(()=>{F6.o=(J,Z)=>Object.prototype.hasOwnProperty.call(J,Z)})();(()=>{F6.r=(J)=>{if(typeof Symbol<"u"&&Symbol.toStringTag)Object.defineProperty(J,Symbol.toStringTag,{value:"Module"});Object.defineProperty(J,"__esModule",{value:!0})}})();var K={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/F6.r(K),F6.d(K,{ASTFeatureExtractor:()=>N.ASTFeatureExtractor,ASTForAudioClassification:()=>$.ASTForAudioClassification,ASTModel:()=>$.ASTModel,ASTPreTrainedModel:()=>$.ASTPreTrainedModel,AlbertForMaskedLM:()=>$.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>$.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>$.AlbertForSequenceClassification,AlbertModel:()=>$.AlbertModel,AlbertPreTrainedModel:()=>$.AlbertPreTrainedModel,AlbertTokenizer:()=>Q.AlbertTokenizer,ArceeForCausalLM:()=>$.ArceeForCausalLM,ArceeModel:()=>$.ArceeModel,ArceePreTrainedModel:()=>$.ArceePreTrainedModel,AudioClassificationPipeline:()=>Z.AudioClassificationPipeline,AutoConfig:()=>W.AutoConfig,AutoFeatureExtractor:()=>L.AutoFeatureExtractor,AutoImageProcessor:()=>v.AutoImageProcessor,AutoModel:()=>$.AutoModel,AutoModelForAudioClassification:()=>$.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>$.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>$.AutoModelForAudioTextToText,AutoModelForCTC:()=>$.AutoModelForCTC,AutoModelForCausalLM:()=>$.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>$.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>$.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>$.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>$.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>$.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>$.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>$.AutoModelForImageTextToText,AutoModelForImageToImage:()=>$.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>$.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>$.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>$.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>$.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>$.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>$.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>$.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>$.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>$.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>$.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>$.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>$.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>$.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>$.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>$.AutoModelForVision2Seq,AutoModelForXVector:()=>$.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>$.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>y.AutoProcessor,AutoTokenizer:()=>Q.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>Z.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>Z.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>$.BartForConditionalGeneration,BartForSequenceClassification:()=>$.BartForSequenceClassification,BartModel:()=>$.BartModel,BartPretrainedModel:()=>$.BartPretrainedModel,BartTokenizer:()=>Q.BartTokenizer,BaseModelOutput:()=>$.BaseModelOutput,BaseStreamer:()=>g.BaseStreamer,BeitFeatureExtractor:()=>F.BeitFeatureExtractor,BeitForImageClassification:()=>$.BeitForImageClassification,BeitModel:()=>$.BeitModel,BeitPreTrainedModel:()=>$.BeitPreTrainedModel,BertForMaskedLM:()=>$.BertForMaskedLM,BertForQuestionAnswering:()=>$.BertForQuestionAnswering,BertForSequenceClassification:()=>$.BertForSequenceClassification,BertForTokenClassification:()=>$.BertForTokenClassification,BertModel:()=>$.BertModel,BertPreTrainedModel:()=>$.BertPreTrainedModel,BertTokenizer:()=>Q.BertTokenizer,BitImageProcessor:()=>F.BitImageProcessor,BlenderbotForConditionalGeneration:()=>$.BlenderbotForConditionalGeneration,BlenderbotModel:()=>$.BlenderbotModel,BlenderbotPreTrainedModel:()=>$.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>$.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>$.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>$.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>Q.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>Q.BlenderbotTokenizer,BloomForCausalLM:()=>$.BloomForCausalLM,BloomModel:()=>$.BloomModel,BloomPreTrainedModel:()=>$.BloomPreTrainedModel,BloomTokenizer:()=>Q.BloomTokenizer,CLIPFeatureExtractor:()=>F.CLIPFeatureExtractor,CLIPImageProcessor:()=>F.CLIPImageProcessor,CLIPModel:()=>$.CLIPModel,CLIPPreTrainedModel:()=>$.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>$.CLIPSegForImageSegmentation,CLIPSegModel:()=>$.CLIPSegModel,CLIPSegPreTrainedModel:()=>$.CLIPSegPreTrainedModel,CLIPTextModel:()=>$.CLIPTextModel,CLIPTextModelWithProjection:()=>$.CLIPTextModelWithProjection,CLIPTokenizer:()=>Q.CLIPTokenizer,CLIPVisionModel:()=>$.CLIPVisionModel,CLIPVisionModelWithProjection:()=>$.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>$.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>$.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>$.CamembertForSequenceClassification,CamembertForTokenClassification:()=>$.CamembertForTokenClassification,CamembertModel:()=>$.CamembertModel,CamembertPreTrainedModel:()=>$.CamembertPreTrainedModel,CamembertTokenizer:()=>Q.CamembertTokenizer,CausalLMOutput:()=>$.CausalLMOutput,CausalLMOutputWithPast:()=>$.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>F.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>$.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>$.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>$.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>N.ClapFeatureExtractor,ClapModel:()=>$.ClapModel,ClapPreTrainedModel:()=>$.ClapPreTrainedModel,ClapTextModelWithProjection:()=>$.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>T.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>$.CodeGenForCausalLM,CodeGenModel:()=>$.CodeGenModel,CodeGenPreTrainedModel:()=>$.CodeGenPreTrainedModel,CodeGenTokenizer:()=>Q.CodeGenTokenizer,CodeLlamaTokenizer:()=>Q.CodeLlamaTokenizer,CohereForCausalLM:()=>$.CohereForCausalLM,CohereModel:()=>$.CohereModel,CoherePreTrainedModel:()=>$.CoherePreTrainedModel,CohereTokenizer:()=>Q.CohereTokenizer,ConvBertForMaskedLM:()=>$.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>$.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>$.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>$.ConvBertForTokenClassification,ConvBertModel:()=>$.ConvBertModel,ConvBertPreTrainedModel:()=>$.ConvBertPreTrainedModel,ConvBertTokenizer:()=>Q.ConvBertTokenizer,ConvNextFeatureExtractor:()=>F.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>$.ConvNextForImageClassification,ConvNextImageProcessor:()=>F.ConvNextImageProcessor,ConvNextModel:()=>$.ConvNextModel,ConvNextPreTrainedModel:()=>$.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>$.ConvNextV2ForImageClassification,ConvNextV2Model:()=>$.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>$.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>$.DFineForObjectDetection,DFineModel:()=>$.DFineModel,DFinePreTrainedModel:()=>$.DFinePreTrainedModel,DINOv3ConvNextModel:()=>$.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>$.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>F.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>$.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>$.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>F.DPTFeatureExtractor,DPTForDepthEstimation:()=>$.DPTForDepthEstimation,DPTImageProcessor:()=>F.DPTImageProcessor,DPTModel:()=>$.DPTModel,DPTPreTrainedModel:()=>$.DPTPreTrainedModel,DacDecoderModel:()=>$.DacDecoderModel,DacDecoderOutput:()=>$.DacDecoderOutput,DacEncoderModel:()=>$.DacEncoderModel,DacEncoderOutput:()=>$.DacEncoderOutput,DacFeatureExtractor:()=>N.DacFeatureExtractor,DacModel:()=>$.DacModel,DacPreTrainedModel:()=>$.DacPreTrainedModel,DataTypeMap:()=>q.DataTypeMap,DebertaForMaskedLM:()=>$.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>$.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>$.DebertaForSequenceClassification,DebertaForTokenClassification:()=>$.DebertaForTokenClassification,DebertaModel:()=>$.DebertaModel,DebertaPreTrainedModel:()=>$.DebertaPreTrainedModel,DebertaTokenizer:()=>Q.DebertaTokenizer,DebertaV2ForMaskedLM:()=>$.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>$.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>$.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>$.DebertaV2ForTokenClassification,DebertaV2Model:()=>$.DebertaV2Model,DebertaV2PreTrainedModel:()=>$.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>Q.DebertaV2Tokenizer,DecisionTransformerModel:()=>$.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>$.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>F.DeiTFeatureExtractor,DeiTForImageClassification:()=>$.DeiTForImageClassification,DeiTImageProcessor:()=>F.DeiTImageProcessor,DeiTModel:()=>$.DeiTModel,DeiTPreTrainedModel:()=>$.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>$.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>$.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>Z.DepthEstimationPipeline,DepthProForDepthEstimation:()=>$.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>$.DepthProPreTrainedModel,DetrFeatureExtractor:()=>F.DetrFeatureExtractor,DetrForObjectDetection:()=>$.DetrForObjectDetection,DetrForSegmentation:()=>$.DetrForSegmentation,DetrImageProcessor:()=>F.DetrImageProcessor,DetrModel:()=>$.DetrModel,DetrObjectDetectionOutput:()=>$.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>$.DetrPreTrainedModel,DetrSegmentationOutput:()=>$.DetrSegmentationOutput,Dinov2ForImageClassification:()=>$.Dinov2ForImageClassification,Dinov2Model:()=>$.Dinov2Model,Dinov2PreTrainedModel:()=>$.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>$.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>$.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>$.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>$.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>$.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>$.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>$.DistilBertForTokenClassification,DistilBertModel:()=>$.DistilBertModel,DistilBertPreTrainedModel:()=>$.DistilBertPreTrainedModel,DistilBertTokenizer:()=>Q.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>Z.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>F.DonutFeatureExtractor,DonutImageProcessor:()=>F.DonutImageProcessor,DonutSwinModel:()=>$.DonutSwinModel,DonutSwinPreTrainedModel:()=>$.DonutSwinPreTrainedModel,EfficientNetForImageClassification:()=>$.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>F.EfficientNetImageProcessor,EfficientNetModel:()=>$.EfficientNetModel,EfficientNetPreTrainedModel:()=>$.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>$.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>$.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>$.ElectraForSequenceClassification,ElectraForTokenClassification:()=>$.ElectraForTokenClassification,ElectraModel:()=>$.ElectraModel,ElectraPreTrainedModel:()=>$.ElectraPreTrainedModel,ElectraTokenizer:()=>Q.ElectraTokenizer,EncodecFeatureExtractor:()=>N.EncodecFeatureExtractor,EosTokenCriteria:()=>A.EosTokenCriteria,Ernie4_5_ForCausalLM:()=>$.Ernie4_5_ForCausalLM,Ernie4_5_Model:()=>$.Ernie4_5_Model,Ernie4_5_PretrainedModel:()=>$.Ernie4_5_PretrainedModel,Ernie4_5_Tokenizer:()=>Q.Ernie4_5_Tokenizer,EsmForMaskedLM:()=>$.EsmForMaskedLM,EsmForSequenceClassification:()=>$.EsmForSequenceClassification,EsmForTokenClassification:()=>$.EsmForTokenClassification,EsmModel:()=>$.EsmModel,EsmPreTrainedModel:()=>$.EsmPreTrainedModel,EsmTokenizer:()=>Q.EsmTokenizer,ExaoneForCausalLM:()=>$.ExaoneForCausalLM,ExaoneModel:()=>$.ExaoneModel,ExaonePreTrainedModel:()=>$.ExaonePreTrainedModel,FFT:()=>z.FFT,FalconForCausalLM:()=>$.FalconForCausalLM,FalconModel:()=>$.FalconModel,FalconPreTrainedModel:()=>$.FalconPreTrainedModel,FalconTokenizer:()=>Q.FalconTokenizer,FastViTForImageClassification:()=>$.FastViTForImageClassification,FastViTModel:()=>$.FastViTModel,FastViTPreTrainedModel:()=>$.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>Z.FeatureExtractionPipeline,FeatureExtractor:()=>U.FeatureExtractor,FillMaskPipeline:()=>Z.FillMaskPipeline,Florence2ForConditionalGeneration:()=>$.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>$.Florence2PreTrainedModel,Florence2Processor:()=>j.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>T.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>T.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>F.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>$.GLPNForDepthEstimation,GLPNModel:()=>$.GLPNModel,GLPNPreTrainedModel:()=>$.GLPNPreTrainedModel,GPT2LMHeadModel:()=>$.GPT2LMHeadModel,GPT2Model:()=>$.GPT2Model,GPT2PreTrainedModel:()=>$.GPT2PreTrainedModel,GPT2Tokenizer:()=>Q.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>$.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>$.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>$.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>$.GPTJForCausalLM,GPTJModel:()=>$.GPTJModel,GPTJPreTrainedModel:()=>$.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>$.GPTNeoForCausalLM,GPTNeoModel:()=>$.GPTNeoModel,GPTNeoPreTrainedModel:()=>$.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>$.GPTNeoXForCausalLM,GPTNeoXModel:()=>$.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>$.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>Q.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>$.Gemma2ForCausalLM,Gemma2Model:()=>$.Gemma2Model,Gemma2PreTrainedModel:()=>$.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>$.Gemma3ForCausalLM,Gemma3Model:()=>$.Gemma3Model,Gemma3PreTrainedModel:()=>$.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>N.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>$.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>$.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>j.Gemma3nProcessor,GemmaForCausalLM:()=>$.GemmaForCausalLM,GemmaModel:()=>$.GemmaModel,GemmaPreTrainedModel:()=>$.GemmaPreTrainedModel,GemmaTokenizer:()=>Q.GemmaTokenizer,GlmForCausalLM:()=>$.GlmForCausalLM,GlmModel:()=>$.GlmModel,GlmPreTrainedModel:()=>$.GlmPreTrainedModel,GraniteForCausalLM:()=>$.GraniteForCausalLM,GraniteModel:()=>$.GraniteModel,GraniteMoeHybridForCausalLM:()=>$.GraniteMoeHybridForCausalLM,GraniteMoeHybridModel:()=>$.GraniteMoeHybridModel,GraniteMoeHybridPreTrainedModel:()=>$.GraniteMoeHybridPreTrainedModel,GranitePreTrainedModel:()=>$.GranitePreTrainedModel,Grok1Tokenizer:()=>Q.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>$.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>F.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>$.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>j.GroundingDinoProcessor,GroupViTModel:()=>$.GroupViTModel,GroupViTPreTrainedModel:()=>$.GroupViTPreTrainedModel,HeliumForCausalLM:()=>$.HeliumForCausalLM,HeliumModel:()=>$.HeliumModel,HeliumPreTrainedModel:()=>$.HeliumPreTrainedModel,HerbertTokenizer:()=>Q.HerbertTokenizer,HieraForImageClassification:()=>$.HieraForImageClassification,HieraModel:()=>$.HieraModel,HieraPreTrainedModel:()=>$.HieraPreTrainedModel,HubertForCTC:()=>$.HubertForCTC,HubertForSequenceClassification:()=>$.HubertForSequenceClassification,HubertModel:()=>$.HubertModel,HubertPreTrainedModel:()=>$.HubertPreTrainedModel,IJepaForImageClassification:()=>$.IJepaForImageClassification,IJepaModel:()=>$.IJepaModel,IJepaPreTrainedModel:()=>$.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>$.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>F.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>$.Idefics3PreTrainedModel,Idefics3Processor:()=>j.Idefics3Processor,ImageClassificationPipeline:()=>Z.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>Z.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>N.ImageFeatureExtractor,ImageMattingOutput:()=>$.ImageMattingOutput,ImageProcessor:()=>w.ImageProcessor,ImageSegmentationPipeline:()=>Z.ImageSegmentationPipeline,ImageToImagePipeline:()=>Z.ImageToImagePipeline,ImageToTextPipeline:()=>Z.ImageToTextPipeline,InterruptableStoppingCriteria:()=>A.InterruptableStoppingCriteria,JAISLMHeadModel:()=>$.JAISLMHeadModel,JAISModel:()=>$.JAISModel,JAISPreTrainedModel:()=>$.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>F.JinaCLIPImageProcessor,JinaCLIPModel:()=>$.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>$.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>j.JinaCLIPProcessor,JinaCLIPTextModel:()=>$.JinaCLIPTextModel,JinaCLIPVisionModel:()=>$.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>$.Lfm2ForCausalLM,Lfm2Model:()=>$.Lfm2Model,Lfm2PreTrainedModel:()=>$.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>$.LiteWhisperForConditionalGeneration,Llama4ForCausalLM:()=>$.Llama4ForCausalLM,Llama4PreTrainedModel:()=>$.Llama4PreTrainedModel,LlamaForCausalLM:()=>$.LlamaForCausalLM,LlamaModel:()=>$.LlamaModel,LlamaPreTrainedModel:()=>$.LlamaPreTrainedModel,LlamaTokenizer:()=>Q.LlamaTokenizer,LlavaForConditionalGeneration:()=>$.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>$.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>F.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>$.LlavaPreTrainedModel,LlavaProcessor:()=>j.LlavaProcessor,LlavaQwen2ForCausalLM:()=>$.LlavaQwen2ForCausalLM,LogitsProcessor:()=>T.LogitsProcessor,LogitsProcessorList:()=>T.LogitsProcessorList,LogitsWarper:()=>T.LogitsWarper,LongT5ForConditionalGeneration:()=>$.LongT5ForConditionalGeneration,LongT5Model:()=>$.LongT5Model,LongT5PreTrainedModel:()=>$.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>$.M2M100ForConditionalGeneration,M2M100Model:()=>$.M2M100Model,M2M100PreTrainedModel:()=>$.M2M100PreTrainedModel,M2M100Tokenizer:()=>Q.M2M100Tokenizer,MBart50Tokenizer:()=>Q.MBart50Tokenizer,MBartForCausalLM:()=>$.MBartForCausalLM,MBartForConditionalGeneration:()=>$.MBartForConditionalGeneration,MBartForSequenceClassification:()=>$.MBartForSequenceClassification,MBartModel:()=>$.MBartModel,MBartPreTrainedModel:()=>$.MBartPreTrainedModel,MBartTokenizer:()=>Q.MBartTokenizer,MPNetForMaskedLM:()=>$.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>$.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>$.MPNetForSequenceClassification,MPNetForTokenClassification:()=>$.MPNetForTokenClassification,MPNetModel:()=>$.MPNetModel,MPNetPreTrainedModel:()=>$.MPNetPreTrainedModel,MPNetTokenizer:()=>Q.MPNetTokenizer,MT5ForConditionalGeneration:()=>$.MT5ForConditionalGeneration,MT5Model:()=>$.MT5Model,MT5PreTrainedModel:()=>$.MT5PreTrainedModel,MarianMTModel:()=>$.MarianMTModel,MarianModel:()=>$.MarianModel,MarianPreTrainedModel:()=>$.MarianPreTrainedModel,MarianTokenizer:()=>Q.MarianTokenizer,Mask2FormerImageProcessor:()=>F.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>F.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>$.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>F.MaskFormerImageProcessor,MaskFormerModel:()=>$.MaskFormerModel,MaskFormerPreTrainedModel:()=>$.MaskFormerPreTrainedModel,MaskedLMOutput:()=>$.MaskedLMOutput,MaxLengthCriteria:()=>A.MaxLengthCriteria,Metric3DForDepthEstimation:()=>$.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>$.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>$.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>$.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>$.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>$.MgpstrModelOutput,MgpstrPreTrainedModel:()=>$.MgpstrPreTrainedModel,MgpstrProcessor:()=>j.MgpstrProcessor,MgpstrTokenizer:()=>Q.MgpstrTokenizer,MimiDecoderModel:()=>$.MimiDecoderModel,MimiDecoderOutput:()=>$.MimiDecoderOutput,MimiEncoderModel:()=>$.MimiEncoderModel,MimiEncoderOutput:()=>$.MimiEncoderOutput,MimiModel:()=>$.MimiModel,MimiPreTrainedModel:()=>$.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>T.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>T.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>$.MistralForCausalLM,MistralModel:()=>$.MistralModel,MistralPreTrainedModel:()=>$.MistralPreTrainedModel,MobileBertForMaskedLM:()=>$.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>$.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>$.MobileBertForSequenceClassification,MobileBertModel:()=>$.MobileBertModel,MobileBertPreTrainedModel:()=>$.MobileBertPreTrainedModel,MobileBertTokenizer:()=>Q.MobileBertTokenizer,MobileLLMForCausalLM:()=>$.MobileLLMForCausalLM,MobileLLMModel:()=>$.MobileLLMModel,MobileLLMPreTrainedModel:()=>$.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>F.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>$.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>$.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>F.MobileNetV1ImageProcessor,MobileNetV1Model:()=>$.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>$.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>F.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>$.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>$.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>F.MobileNetV2ImageProcessor,MobileNetV2Model:()=>$.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>$.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>F.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>$.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>$.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>F.MobileNetV3ImageProcessor,MobileNetV3Model:()=>$.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>$.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>F.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>$.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>$.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>F.MobileNetV4ImageProcessor,MobileNetV4Model:()=>$.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>$.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>F.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>$.MobileViTForImageClassification,MobileViTImageProcessor:()=>F.MobileViTImageProcessor,MobileViTModel:()=>$.MobileViTModel,MobileViTPreTrainedModel:()=>$.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>$.MobileViTV2ForImageClassification,MobileViTV2Model:()=>$.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>$.MobileViTV2PreTrainedModel,ModelOutput:()=>$.ModelOutput,ModernBertDecoderForCausalLM:()=>$.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>$.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>$.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>$.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>$.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>$.ModernBertForTokenClassification,ModernBertModel:()=>$.ModernBertModel,ModernBertPreTrainedModel:()=>$.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>$.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>N.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>$.MoonshineForConditionalGeneration,MoonshineModel:()=>$.MoonshineModel,MoonshinePreTrainedModel:()=>$.MoonshinePreTrainedModel,MoonshineProcessor:()=>j.MoonshineProcessor,MptForCausalLM:()=>$.MptForCausalLM,MptModel:()=>$.MptModel,MptPreTrainedModel:()=>$.MptPreTrainedModel,MultiModalityCausalLM:()=>$.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>$.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>$.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>$.MusicgenForConditionalGeneration,MusicgenModel:()=>$.MusicgenModel,MusicgenPreTrainedModel:()=>$.MusicgenPreTrainedModel,NanoChatForCausalLM:()=>$.NanoChatForCausalLM,NanoChatModel:()=>$.NanoChatModel,NanoChatPreTrainedModel:()=>$.NanoChatPreTrainedModel,NeoBertForMaskedLM:()=>$.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>$.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>$.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>$.NeoBertForTokenClassification,NeoBertModel:()=>$.NeoBertModel,NeoBertPreTrainedModel:()=>$.NeoBertPreTrainedModel,NllbTokenizer:()=>Q.NllbTokenizer,NoBadWordsLogitsProcessor:()=>T.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>T.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>$.NomicBertModel,NomicBertPreTrainedModel:()=>$.NomicBertPreTrainedModel,NougatImageProcessor:()=>F.NougatImageProcessor,NougatTokenizer:()=>Q.NougatTokenizer,OPTForCausalLM:()=>$.OPTForCausalLM,OPTModel:()=>$.OPTModel,OPTPreTrainedModel:()=>$.OPTPreTrainedModel,ObjectDetectionPipeline:()=>Z.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>$.Olmo2ForCausalLM,Olmo2Model:()=>$.Olmo2Model,Olmo2PreTrainedModel:()=>$.Olmo2PreTrainedModel,OlmoForCausalLM:()=>$.OlmoForCausalLM,OlmoModel:()=>$.OlmoModel,OlmoPreTrainedModel:()=>$.OlmoPreTrainedModel,OpenELMForCausalLM:()=>$.OpenELMForCausalLM,OpenELMModel:()=>$.OpenELMModel,OpenELMPreTrainedModel:()=>$.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>F.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>$.OwlViTForObjectDetection,OwlViTImageProcessor:()=>F.OwlViTImageProcessor,OwlViTModel:()=>$.OwlViTModel,OwlViTPreTrainedModel:()=>$.OwlViTPreTrainedModel,OwlViTProcessor:()=>j.OwlViTProcessor,Owlv2ForObjectDetection:()=>$.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>F.Owlv2ImageProcessor,Owlv2Model:()=>$.Owlv2Model,Owlv2PreTrainedModel:()=>$.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>$.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>$.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>j.PaliGemmaProcessor,ParakeetFeatureExtractor:()=>N.ParakeetFeatureExtractor,ParakeetForCTC:()=>$.ParakeetForCTC,ParakeetPreTrainedModel:()=>$.ParakeetPreTrainedModel,PatchTSMixerForPrediction:()=>$.PatchTSMixerForPrediction,PatchTSMixerModel:()=>$.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>$.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>$.PatchTSTForPrediction,PatchTSTModel:()=>$.PatchTSTModel,PatchTSTPreTrainedModel:()=>$.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>$.Phi3ForCausalLM,Phi3Model:()=>$.Phi3Model,Phi3PreTrainedModel:()=>$.Phi3PreTrainedModel,Phi3VForCausalLM:()=>$.Phi3VForCausalLM,Phi3VImageProcessor:()=>F.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>$.Phi3VPreTrainedModel,Phi3VProcessor:()=>j.Phi3VProcessor,PhiForCausalLM:()=>$.PhiForCausalLM,PhiModel:()=>$.PhiModel,PhiPreTrainedModel:()=>$.PhiPreTrainedModel,Pipeline:()=>Z.Pipeline,PreTrainedModel:()=>$.PreTrainedModel,PreTrainedTokenizer:()=>Q.PreTrainedTokenizer,PretrainedConfig:()=>W.PretrainedConfig,PretrainedMixin:()=>$.PretrainedMixin,Processor:()=>I.Processor,PvtForImageClassification:()=>$.PvtForImageClassification,PvtImageProcessor:()=>F.PvtImageProcessor,PvtModel:()=>$.PvtModel,PvtPreTrainedModel:()=>$.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>N.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>$.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>$.PyAnnoteModel,PyAnnotePreTrainedModel:()=>$.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>j.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>$.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>Z.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>$.Qwen2ForCausalLM,Qwen2Model:()=>$.Qwen2Model,Qwen2PreTrainedModel:()=>$.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>Q.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>$.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>F.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>$.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>j.Qwen2VLProcessor,Qwen3ForCausalLM:()=>$.Qwen3ForCausalLM,Qwen3Model:()=>$.Qwen3Model,Qwen3PreTrainedModel:()=>$.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>$.RFDetrForObjectDetection,RFDetrModel:()=>$.RFDetrModel,RFDetrObjectDetectionOutput:()=>$.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>$.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>$.RTDetrForObjectDetection,RTDetrImageProcessor:()=>F.RTDetrImageProcessor,RTDetrModel:()=>$.RTDetrModel,RTDetrObjectDetectionOutput:()=>$.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>$.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>$.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>$.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>$.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>$.RTDetrV2PreTrainedModel,RawAudio:()=>Y.RawAudio,RawImage:()=>H.RawImage,RawVideo:()=>G.RawVideo,RawVideoFrame:()=>G.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>T.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>$.ResNetForImageClassification,ResNetModel:()=>$.ResNetModel,ResNetPreTrainedModel:()=>$.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>$.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>$.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>$.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>$.RoFormerForTokenClassification,RoFormerModel:()=>$.RoFormerModel,RoFormerPreTrainedModel:()=>$.RoFormerPreTrainedModel,RoFormerTokenizer:()=>Q.RoFormerTokenizer,RobertaForMaskedLM:()=>$.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>$.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>$.RobertaForSequenceClassification,RobertaForTokenClassification:()=>$.RobertaForTokenClassification,RobertaModel:()=>$.RobertaModel,RobertaPreTrainedModel:()=>$.RobertaPreTrainedModel,RobertaTokenizer:()=>Q.RobertaTokenizer,SamImageProcessor:()=>F.SamImageProcessor,SamImageSegmentationOutput:()=>$.SamImageSegmentationOutput,SamModel:()=>$.SamModel,SamPreTrainedModel:()=>$.SamPreTrainedModel,SamProcessor:()=>j.SamProcessor,SapiensForDepthEstimation:()=>$.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>$.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>$.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>$.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>N.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>F.SegformerFeatureExtractor,SegformerForImageClassification:()=>$.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>$.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>F.SegformerImageProcessor,SegformerModel:()=>$.SegformerModel,SegformerPreTrainedModel:()=>$.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>$.Seq2SeqLMOutput,SequenceClassifierOutput:()=>$.SequenceClassifierOutput,SiglipImageProcessor:()=>F.SiglipImageProcessor,SiglipModel:()=>$.SiglipModel,SiglipPreTrainedModel:()=>$.SiglipPreTrainedModel,SiglipTextModel:()=>$.SiglipTextModel,SiglipTokenizer:()=>Q.SiglipTokenizer,SiglipVisionModel:()=>$.SiglipVisionModel,SmolLM3ForCausalLM:()=>$.SmolLM3ForCausalLM,SmolLM3Model:()=>$.SmolLM3Model,SmolLM3PreTrainedModel:()=>$.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>$.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>F.SmolVLMImageProcessor,SmolVLMProcessor:()=>j.SmolVLMProcessor,SnacDecoderModel:()=>$.SnacDecoderModel,SnacEncoderModel:()=>$.SnacEncoderModel,SnacFeatureExtractor:()=>N.SnacFeatureExtractor,SnacModel:()=>$.SnacModel,SnacPreTrainedModel:()=>$.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>N.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>$.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>$.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>$.SpeechT5HifiGan,SpeechT5Model:()=>$.SpeechT5Model,SpeechT5PreTrainedModel:()=>$.SpeechT5PreTrainedModel,SpeechT5Processor:()=>j.SpeechT5Processor,SpeechT5Tokenizer:()=>Q.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>$.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>$.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>$.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>$.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>$.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>Q.SqueezeBertTokenizer,StableLmForCausalLM:()=>$.StableLmForCausalLM,StableLmModel:()=>$.StableLmModel,StableLmPreTrainedModel:()=>$.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>$.Starcoder2ForCausalLM,Starcoder2Model:()=>$.Starcoder2Model,Starcoder2PreTrainedModel:()=>$.Starcoder2PreTrainedModel,StoppingCriteria:()=>A.StoppingCriteria,StoppingCriteriaList:()=>A.StoppingCriteriaList,StyleTextToSpeech2Model:()=>$.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>$.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>Z.SummarizationPipeline,SuppressTokensAtBeginLogitsProcessor:()=>T.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>$.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>F.Swin2SRImageProcessor,Swin2SRModel:()=>$.Swin2SRModel,Swin2SRPreTrainedModel:()=>$.Swin2SRPreTrainedModel,SwinForImageClassification:()=>$.SwinForImageClassification,SwinForSemanticSegmentation:()=>$.SwinForSemanticSegmentation,SwinModel:()=>$.SwinModel,SwinPreTrainedModel:()=>$.SwinPreTrainedModel,T5ForConditionalGeneration:()=>$.T5ForConditionalGeneration,T5Model:()=>$.T5Model,T5PreTrainedModel:()=>$.T5PreTrainedModel,T5Tokenizer:()=>Q.T5Tokenizer,TableTransformerForObjectDetection:()=>$.TableTransformerForObjectDetection,TableTransformerModel:()=>$.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>$.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>$.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>T.TemperatureLogitsWarper,Tensor:()=>q.Tensor,Text2TextGenerationPipeline:()=>Z.Text2TextGenerationPipeline,TextClassificationPipeline:()=>Z.TextClassificationPipeline,TextGenerationPipeline:()=>Z.TextGenerationPipeline,TextStreamer:()=>g.TextStreamer,TextToAudioPipeline:()=>Z.TextToAudioPipeline,TokenClassificationPipeline:()=>Z.TokenClassificationPipeline,TokenClassifierOutput:()=>$.TokenClassifierOutput,TokenizerModel:()=>Q.TokenizerModel,TopKLogitsWarper:()=>T.TopKLogitsWarper,TopPLogitsWarper:()=>T.TopPLogitsWarper,TrOCRForCausalLM:()=>$.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>$.TrOCRPreTrainedModel,TranslationPipeline:()=>Z.TranslationPipeline,UltravoxModel:()=>$.UltravoxModel,UltravoxPreTrainedModel:()=>$.UltravoxPreTrainedModel,UltravoxProcessor:()=>j.UltravoxProcessor,UniSpeechForCTC:()=>$.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>$.UniSpeechForSequenceClassification,UniSpeechModel:()=>$.UniSpeechModel,UniSpeechPreTrainedModel:()=>$.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>$.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>$.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>$.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>$.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>$.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>j.VLChatProcessor,VLMImageProcessor:()=>F.VLMImageProcessor,VaultGemmaForCausalLM:()=>$.VaultGemmaForCausalLM,VaultGemmaModel:()=>$.VaultGemmaModel,VaultGemmaPreTrainedModel:()=>$.VaultGemmaPreTrainedModel,ViTFeatureExtractor:()=>F.ViTFeatureExtractor,ViTForImageClassification:()=>$.ViTForImageClassification,ViTImageProcessor:()=>F.ViTImageProcessor,ViTMAEModel:()=>$.ViTMAEModel,ViTMAEPreTrainedModel:()=>$.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>$.ViTMSNForImageClassification,ViTMSNModel:()=>$.ViTMSNModel,ViTMSNPreTrainedModel:()=>$.ViTMSNPreTrainedModel,ViTModel:()=>$.ViTModel,ViTPreTrainedModel:()=>$.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>$.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>$.VitMatteForImageMatting,VitMatteImageProcessor:()=>F.VitMatteImageProcessor,VitMattePreTrainedModel:()=>$.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>$.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>F.VitPoseImageProcessor,VitPosePreTrainedModel:()=>$.VitPosePreTrainedModel,VitsModel:()=>$.VitsModel,VitsModelOutput:()=>$.VitsModelOutput,VitsPreTrainedModel:()=>$.VitsPreTrainedModel,VitsTokenizer:()=>Q.VitsTokenizer,VoxtralForConditionalGeneration:()=>$.VoxtralForConditionalGeneration,VoxtralProcessor:()=>j.VoxtralProcessor,Wav2Vec2BertForCTC:()=>$.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>$.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>$.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>$.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>Q.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>N.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>$.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>$.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>$.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>$.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>$.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>j.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>j.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>$.WavLMForAudioFrameClassification,WavLMForCTC:()=>$.WavLMForCTC,WavLMForSequenceClassification:()=>$.WavLMForSequenceClassification,WavLMForXVector:()=>$.WavLMForXVector,WavLMModel:()=>$.WavLMModel,WavLMPreTrainedModel:()=>$.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>N.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>$.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>$.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>N.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>$.WhisperForConditionalGeneration,WhisperModel:()=>$.WhisperModel,WhisperPreTrainedModel:()=>$.WhisperPreTrainedModel,WhisperProcessor:()=>j.WhisperProcessor,WhisperTextStreamer:()=>g.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>T.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>Q.WhisperTokenizer,XLMForQuestionAnswering:()=>$.XLMForQuestionAnswering,XLMForSequenceClassification:()=>$.XLMForSequenceClassification,XLMForTokenClassification:()=>$.XLMForTokenClassification,XLMModel:()=>$.XLMModel,XLMPreTrainedModel:()=>$.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>$.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>$.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>$.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>$.XLMRobertaForTokenClassification,XLMRobertaModel:()=>$.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>$.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>Q.XLMRobertaTokenizer,XLMTokenizer:()=>Q.XLMTokenizer,XLMWithLMHeadModel:()=>$.XLMWithLMHeadModel,XVectorOutput:()=>$.XVectorOutput,YolosFeatureExtractor:()=>F.YolosFeatureExtractor,YolosForObjectDetection:()=>$.YolosForObjectDetection,YolosImageProcessor:()=>F.YolosImageProcessor,YolosModel:()=>$.YolosModel,YolosObjectDetectionOutput:()=>$.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>$.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>Z.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>Z.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>Z.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>Z.ZeroShotObjectDetectionPipeline,bankers_round:()=>z.bankers_round,cat:()=>q.cat,cos_sim:()=>z.cos_sim,dot:()=>z.dot,dynamic_time_warping:()=>z.dynamic_time_warping,env:()=>J.env,full:()=>q.full,full_like:()=>q.full_like,getCacheShapes:()=>W.getCacheShapes,hamming:()=>Y.hamming,hanning:()=>Y.hanning,interpolate:()=>q.interpolate,interpolate_4d:()=>q.interpolate_4d,interpolate_data:()=>z.interpolate_data,is_chinese_char:()=>Q.is_chinese_char,layer_norm:()=>q.layer_norm,load_image:()=>H.load_image,load_video:()=>G.load_video,log_softmax:()=>z.log_softmax,magnitude:()=>z.magnitude,matmul:()=>q.matmul,max:()=>z.max,mean:()=>q.mean,mean_pooling:()=>q.mean_pooling,medianFilter:()=>z.medianFilter,mel_filter_bank:()=>Y.mel_filter_bank,min:()=>z.min,ones:()=>q.ones,ones_like:()=>q.ones_like,permute:()=>q.permute,permute_data:()=>z.permute_data,pipeline:()=>Z.pipeline,quantize_embeddings:()=>q.quantize_embeddings,rand:()=>q.rand,read_audio:()=>Y.read_audio,rfft:()=>q.rfft,round:()=>z.round,slice:()=>q.slice,softmax:()=>z.softmax,spectrogram:()=>Y.spectrogram,stack:()=>q.stack,std_mean:()=>q.std_mean,topk:()=>q.topk,window_function:()=>Y.window_function,zeros:()=>q.zeros,zeros_like:()=>q.zeros_like});var J=F6("./src/env.js");/*! ./env.js */var Z=F6("./src/pipelines.js");/*! ./pipelines.js */var $=F6("./src/models.js");/*! ./models.js */var Q=F6("./src/tokenizers.js");/*! ./tokenizers.js */var W=F6("./src/configs.js");/*! ./configs.js */var Y=F6("./src/utils/audio.js");/*! ./utils/audio.js */var H=F6("./src/utils/image.js");/*! ./utils/image.js */var G=F6("./src/utils/video.js");/*! ./utils/video.js */var q=F6("./src/utils/tensor.js");/*! ./utils/tensor.js */var z=F6("./src/utils/maths.js");/*! ./utils/maths.js */var U=F6("./src/base/feature_extraction_utils.js");/*! ./base/feature_extraction_utils.js */var N=F6("./src/models/feature_extractors.js");/*! ./models/feature_extractors.js */var L=F6("./src/models/auto/feature_extraction_auto.js");/*! ./models/auto/feature_extraction_auto.js */var w=F6("./src/base/image_processors_utils.js");/*! ./base/image_processors_utils.js */var F=F6("./src/models/image_processors.js");/*! ./models/image_processors.js */var v=F6("./src/models/auto/image_processing_auto.js");/*! ./models/auto/image_processing_auto.js */var I=F6("./src/base/processing_utils.js");/*! ./base/processing_utils.js */var j=F6("./src/models/processors.js");/*! ./models/processors.js */var y=F6("./src/models/auto/processing_auto.js");/*! ./models/auto/processing_auto.js */var g=F6("./src/generation/streamers.js");/*! ./generation/streamers.js */var A=F6("./src/generation/stopping_criteria.js");/*! ./generation/stopping_criteria.js */var T=F6("./src/generation/logits_process.js");/*! ./generation/logits_process.js */})();var{ASTFeatureExtractor:jB,ASTForAudioClassification:PB,ASTModel:CB,ASTPreTrainedModel:SB,AlbertForMaskedLM:MB,AlbertForQuestionAnswering:TB,AlbertForSequenceClassification:_B,AlbertModel:kB,AlbertPreTrainedModel:xB,AlbertTokenizer:yB,ArceeForCausalLM:vB,ArceeModel:OB,ArceePreTrainedModel:bB,AudioClassificationPipeline:hB,AutoConfig:fB,AutoFeatureExtractor:dB,AutoImageProcessor:uB,AutoModel:gB,AutoModelForAudioClassification:lB,AutoModelForAudioFrameClassification:cB,AutoModelForAudioTextToText:mB,AutoModelForCTC:aB,AutoModelForCausalLM:pB,AutoModelForDepthEstimation:rB,AutoModelForDocumentQuestionAnswering:eB,AutoModelForImageClassification:nB,AutoModelForImageFeatureExtraction:sB,AutoModelForImageMatting:iB,AutoModelForImageSegmentation:tB,AutoModelForImageTextToText:oB,AutoModelForImageToImage:JR,AutoModelForMaskGeneration:$R,AutoModelForMaskedLM:ZR,AutoModelForNormalEstimation:QR,AutoModelForObjectDetection:WR,AutoModelForPoseEstimation:KR,AutoModelForQuestionAnswering:YR,AutoModelForSemanticSegmentation:GR,AutoModelForSeq2SeqLM:XR,AutoModelForSequenceClassification:qR,AutoModelForSpeechSeq2Seq:HR,AutoModelForTextToSpectrogram:VR,AutoModelForTextToWaveform:UR,AutoModelForTokenClassification:NR,AutoModelForUniversalSegmentation:zR,AutoModelForVision2Seq:ER,AutoModelForXVector:LR,AutoModelForZeroShotObjectDetection:AR,AutoProcessor:BR,AutoTokenizer:gV,AutomaticSpeechRecognitionPipeline:RR,BackgroundRemovalPipeline:FR,BartForConditionalGeneration:DR,BartForSequenceClassification:IR,BartModel:wR,BartPretrainedModel:jR,BartTokenizer:PR,BaseModelOutput:CR,BaseStreamer:SR,BeitFeatureExtractor:MR,BeitForImageClassification:TR,BeitModel:_R,BeitPreTrainedModel:kR,BertForMaskedLM:xR,BertForQuestionAnswering:yR,BertForSequenceClassification:vR,BertForTokenClassification:OR,BertModel:bR,BertPreTrainedModel:hR,BertTokenizer:fR,BitImageProcessor:dR,BlenderbotForConditionalGeneration:uR,BlenderbotModel:gR,BlenderbotPreTrainedModel:lR,BlenderbotSmallForConditionalGeneration:cR,BlenderbotSmallModel:mR,BlenderbotSmallPreTrainedModel:aR,BlenderbotSmallTokenizer:pR,BlenderbotTokenizer:rR,BloomForCausalLM:eR,BloomModel:nR,BloomPreTrainedModel:sR,BloomTokenizer:iR,CLIPFeatureExtractor:tR,CLIPImageProcessor:oR,CLIPModel:JF,CLIPPreTrainedModel:$F,CLIPSegForImageSegmentation:ZF,CLIPSegModel:QF,CLIPSegPreTrainedModel:WF,CLIPTextModel:KF,CLIPTextModelWithProjection:YF,CLIPTokenizer:GF,CLIPVisionModel:XF,CLIPVisionModelWithProjection:qF,CamembertForMaskedLM:HF,CamembertForQuestionAnswering:VF,CamembertForSequenceClassification:UF,CamembertForTokenClassification:NF,CamembertModel:zF,CamembertPreTrainedModel:EF,CamembertTokenizer:LF,CausalLMOutput:AF,CausalLMOutputWithPast:BF,ChineseCLIPFeatureExtractor:RF,ChineseCLIPModel:FF,ChineseCLIPPreTrainedModel:DF,ClapAudioModelWithProjection:IF,ClapFeatureExtractor:wF,ClapModel:jF,ClapPreTrainedModel:PF,ClapTextModelWithProjection:CF,ClassifierFreeGuidanceLogitsProcessor:SF,CodeGenForCausalLM:MF,CodeGenModel:TF,CodeGenPreTrainedModel:_F,CodeGenTokenizer:kF,CodeLlamaTokenizer:xF,CohereForCausalLM:yF,CohereModel:vF,CoherePreTrainedModel:OF,CohereTokenizer:bF,ConvBertForMaskedLM:hF,ConvBertForQuestionAnswering:fF,ConvBertForSequenceClassification:dF,ConvBertForTokenClassification:uF,ConvBertModel:gF,ConvBertPreTrainedModel:lF,ConvBertTokenizer:cF,ConvNextFeatureExtractor:mF,ConvNextForImageClassification:aF,ConvNextImageProcessor:pF,ConvNextModel:rF,ConvNextPreTrainedModel:eF,ConvNextV2ForImageClassification:nF,ConvNextV2Model:sF,ConvNextV2PreTrainedModel:iF,DFineForObjectDetection:tF,DFineModel:oF,DFinePreTrainedModel:J1,DINOv3ConvNextModel:$1,DINOv3ConvNextPreTrainedModel:Z1,DINOv3ViTImageProcessor:Q1,DINOv3ViTModel:W1,DINOv3ViTPreTrainedModel:K1,DPTFeatureExtractor:Y1,DPTForDepthEstimation:G1,DPTImageProcessor:X1,DPTModel:q1,DPTPreTrainedModel:H1,DacDecoderModel:V1,DacDecoderOutput:U1,DacEncoderModel:N1,DacEncoderOutput:z1,DacFeatureExtractor:E1,DacModel:L1,DacPreTrainedModel:A1,DataTypeMap:B1,DebertaForMaskedLM:R1,DebertaForQuestionAnswering:F1,DebertaForSequenceClassification:D1,DebertaForTokenClassification:I1,DebertaModel:w1,DebertaPreTrainedModel:j1,DebertaTokenizer:P1,DebertaV2ForMaskedLM:C1,DebertaV2ForQuestionAnswering:S1,DebertaV2ForSequenceClassification:M1,DebertaV2ForTokenClassification:T1,DebertaV2Model:_1,DebertaV2PreTrainedModel:k1,DebertaV2Tokenizer:x1,DecisionTransformerModel:y1,DecisionTransformerPreTrainedModel:v1,DeiTFeatureExtractor:O1,DeiTForImageClassification:b1,DeiTImageProcessor:h1,DeiTModel:f1,DeiTPreTrainedModel:d1,DepthAnythingForDepthEstimation:u1,DepthAnythingPreTrainedModel:g1,DepthEstimationPipeline:l1,DepthProForDepthEstimation:c1,DepthProPreTrainedModel:m1,DetrFeatureExtractor:a1,DetrForObjectDetection:p1,DetrForSegmentation:r1,DetrImageProcessor:e1,DetrModel:n1,DetrObjectDetectionOutput:s1,DetrPreTrainedModel:i1,DetrSegmentationOutput:t1,Dinov2ForImageClassification:o1,Dinov2Model:JD,Dinov2PreTrainedModel:$D,Dinov2WithRegistersForImageClassification:ZD,Dinov2WithRegistersModel:QD,Dinov2WithRegistersPreTrainedModel:WD,DistilBertForMaskedLM:KD,DistilBertForQuestionAnswering:YD,DistilBertForSequenceClassification:GD,DistilBertForTokenClassification:XD,DistilBertModel:qD,DistilBertPreTrainedModel:HD,DistilBertTokenizer:VD,DocumentQuestionAnsweringPipeline:UD,DonutFeatureExtractor:ND,DonutImageProcessor:zD,DonutSwinModel:ED,DonutSwinPreTrainedModel:LD,EfficientNetForImageClassification:AD,EfficientNetImageProcessor:BD,EfficientNetModel:RD,EfficientNetPreTrainedModel:FD,ElectraForMaskedLM:DD,ElectraForQuestionAnswering:ID,ElectraForSequenceClassification:wD,ElectraForTokenClassification:jD,ElectraModel:PD,ElectraPreTrainedModel:CD,ElectraTokenizer:SD,EncodecFeatureExtractor:MD,EosTokenCriteria:TD,Ernie4_5_ForCausalLM:_D,Ernie4_5_Model:kD,Ernie4_5_PretrainedModel:xD,Ernie4_5_Tokenizer:yD,EsmForMaskedLM:vD,EsmForSequenceClassification:OD,EsmForTokenClassification:bD,EsmModel:hD,EsmPreTrainedModel:fD,EsmTokenizer:dD,ExaoneForCausalLM:uD,ExaoneModel:gD,ExaonePreTrainedModel:lD,FFT:cD,FalconForCausalLM:mD,FalconModel:aD,FalconPreTrainedModel:pD,FalconTokenizer:rD,FastViTForImageClassification:eD,FastViTModel:nD,FastViTPreTrainedModel:sD,FeatureExtractionPipeline:iD,FeatureExtractor:tD,FillMaskPipeline:oD,Florence2ForConditionalGeneration:JI,Florence2PreTrainedModel:$I,Florence2Processor:ZI,ForcedBOSTokenLogitsProcessor:QI,ForcedEOSTokenLogitsProcessor:WI,GLPNFeatureExtractor:KI,GLPNForDepthEstimation:YI,GLPNModel:GI,GLPNPreTrainedModel:XI,GPT2LMHeadModel:qI,GPT2Model:HI,GPT2PreTrainedModel:VI,GPT2Tokenizer:UI,GPTBigCodeForCausalLM:NI,GPTBigCodeModel:zI,GPTBigCodePreTrainedModel:EI,GPTJForCausalLM:LI,GPTJModel:AI,GPTJPreTrainedModel:BI,GPTNeoForCausalLM:RI,GPTNeoModel:FI,GPTNeoPreTrainedModel:DI,GPTNeoXForCausalLM:II,GPTNeoXModel:wI,GPTNeoXPreTrainedModel:jI,GPTNeoXTokenizer:PI,Gemma2ForCausalLM:CI,Gemma2Model:SI,Gemma2PreTrainedModel:MI,Gemma3ForCausalLM:TI,Gemma3Model:_I,Gemma3PreTrainedModel:kI,Gemma3nAudioFeatureExtractor:xI,Gemma3nForConditionalGeneration:yI,Gemma3nPreTrainedModel:vI,Gemma3nProcessor:OI,GemmaForCausalLM:bI,GemmaModel:hI,GemmaPreTrainedModel:fI,GemmaTokenizer:dI,GlmForCausalLM:uI,GlmModel:gI,GlmPreTrainedModel:lI,GraniteForCausalLM:cI,GraniteModel:mI,GraniteMoeHybridForCausalLM:aI,GraniteMoeHybridModel:pI,GraniteMoeHybridPreTrainedModel:rI,GranitePreTrainedModel:eI,Grok1Tokenizer:nI,GroundingDinoForObjectDetection:sI,GroundingDinoImageProcessor:iI,GroundingDinoPreTrainedModel:tI,GroundingDinoProcessor:oI,GroupViTModel:J2,GroupViTPreTrainedModel:$2,HeliumForCausalLM:Z2,HeliumModel:Q2,HeliumPreTrainedModel:W2,HerbertTokenizer:K2,HieraForImageClassification:Y2,HieraModel:G2,HieraPreTrainedModel:X2,HubertForCTC:q2,HubertForSequenceClassification:H2,HubertModel:V2,HubertPreTrainedModel:U2,IJepaForImageClassification:N2,IJepaModel:z2,IJepaPreTrainedModel:E2,Idefics3ForConditionalGeneration:L2,Idefics3ImageProcessor:A2,Idefics3PreTrainedModel:B2,Idefics3Processor:R2,ImageClassificationPipeline:F2,ImageFeatureExtractionPipeline:D2,ImageFeatureExtractor:I2,ImageMattingOutput:w2,ImageProcessor:j2,ImageSegmentationPipeline:P2,ImageToImagePipeline:C2,ImageToTextPipeline:S2,InterruptableStoppingCriteria:M2,JAISLMHeadModel:T2,JAISModel:_2,JAISPreTrainedModel:k2,JinaCLIPImageProcessor:x2,JinaCLIPModel:y2,JinaCLIPPreTrainedModel:v2,JinaCLIPProcessor:O2,JinaCLIPTextModel:b2,JinaCLIPVisionModel:h2,Lfm2ForCausalLM:f2,Lfm2Model:d2,Lfm2PreTrainedModel:u2,LiteWhisperForConditionalGeneration:g2,Llama4ForCausalLM:l2,Llama4PreTrainedModel:c2,LlamaForCausalLM:m2,LlamaModel:a2,LlamaPreTrainedModel:p2,LlamaTokenizer:r2,LlavaForConditionalGeneration:e2,LlavaOnevisionForConditionalGeneration:n2,LlavaOnevisionImageProcessor:s2,LlavaPreTrainedModel:i2,LlavaProcessor:t2,LlavaQwen2ForCausalLM:o2,LogitsProcessor:Jw,LogitsProcessorList:$w,LogitsWarper:Zw,LongT5ForConditionalGeneration:Qw,LongT5Model:Ww,LongT5PreTrainedModel:Kw,M2M100ForConditionalGeneration:Yw,M2M100Model:Gw,M2M100PreTrainedModel:Xw,M2M100Tokenizer:qw,MBart50Tokenizer:Hw,MBartForCausalLM:Vw,MBartForConditionalGeneration:Uw,MBartForSequenceClassification:Nw,MBartModel:zw,MBartPreTrainedModel:Ew,MBartTokenizer:Lw,MPNetForMaskedLM:Aw,MPNetForQuestionAnswering:Bw,MPNetForSequenceClassification:Rw,MPNetForTokenClassification:Fw,MPNetModel:Dw,MPNetPreTrainedModel:Iw,MPNetTokenizer:ww,MT5ForConditionalGeneration:jw,MT5Model:Pw,MT5PreTrainedModel:Cw,MarianMTModel:Sw,MarianModel:Mw,MarianPreTrainedModel:Tw,MarianTokenizer:_w,Mask2FormerImageProcessor:kw,MaskFormerFeatureExtractor:xw,MaskFormerForInstanceSegmentation:yw,MaskFormerImageProcessor:vw,MaskFormerModel:Ow,MaskFormerPreTrainedModel:bw,MaskedLMOutput:hw,MaxLengthCriteria:fw,Metric3DForDepthEstimation:dw,Metric3DPreTrainedModel:uw,Metric3Dv2ForDepthEstimation:gw,Metric3Dv2PreTrainedModel:lw,MgpstrForSceneTextRecognition:cw,MgpstrModelOutput:mw,MgpstrPreTrainedModel:aw,MgpstrProcessor:pw,MgpstrTokenizer:rw,MimiDecoderModel:ew,MimiDecoderOutput:nw,MimiEncoderModel:sw,MimiEncoderOutput:iw,MimiModel:tw,MimiPreTrainedModel:ow,MinLengthLogitsProcessor:Jj,MinNewTokensLengthLogitsProcessor:$j,MistralForCausalLM:Zj,MistralModel:Qj,MistralPreTrainedModel:Wj,MobileBertForMaskedLM:Kj,MobileBertForQuestionAnswering:Yj,MobileBertForSequenceClassification:Gj,MobileBertModel:Xj,MobileBertPreTrainedModel:qj,MobileBertTokenizer:Hj,MobileLLMForCausalLM:Vj,MobileLLMModel:Uj,MobileLLMPreTrainedModel:Nj,MobileNetV1FeatureExtractor:zj,MobileNetV1ForImageClassification:Ej,MobileNetV1ForSemanticSegmentation:Lj,MobileNetV1ImageProcessor:Aj,MobileNetV1Model:Bj,MobileNetV1PreTrainedModel:Rj,MobileNetV2FeatureExtractor:Fj,MobileNetV2ForImageClassification:Dj,MobileNetV2ForSemanticSegmentation:Ij,MobileNetV2ImageProcessor:wj,MobileNetV2Model:jj,MobileNetV2PreTrainedModel:Pj,MobileNetV3FeatureExtractor:Cj,MobileNetV3ForImageClassification:Sj,MobileNetV3ForSemanticSegmentation:Mj,MobileNetV3ImageProcessor:Tj,MobileNetV3Model:_j,MobileNetV3PreTrainedModel:kj,MobileNetV4FeatureExtractor:xj,MobileNetV4ForImageClassification:yj,MobileNetV4ForSemanticSegmentation:vj,MobileNetV4ImageProcessor:Oj,MobileNetV4Model:bj,MobileNetV4PreTrainedModel:hj,MobileViTFeatureExtractor:fj,MobileViTForImageClassification:dj,MobileViTImageProcessor:uj,MobileViTModel:gj,MobileViTPreTrainedModel:lj,MobileViTV2ForImageClassification:cj,MobileViTV2Model:mj,MobileViTV2PreTrainedModel:aj,ModelOutput:pj,ModernBertDecoderForCausalLM:rj,ModernBertDecoderModel:ej,ModernBertDecoderPreTrainedModel:nj,ModernBertForMaskedLM:sj,ModernBertForSequenceClassification:ij,ModernBertForTokenClassification:tj,ModernBertModel:oj,ModernBertPreTrainedModel:JP,Moondream1ForConditionalGeneration:$P,MoonshineFeatureExtractor:ZP,MoonshineForConditionalGeneration:QP,MoonshineModel:WP,MoonshinePreTrainedModel:KP,MoonshineProcessor:YP,MptForCausalLM:GP,MptModel:XP,MptPreTrainedModel:qP,MultiModalityCausalLM:HP,MultiModalityPreTrainedModel:VP,MusicgenForCausalLM:UP,MusicgenForConditionalGeneration:NP,MusicgenModel:zP,MusicgenPreTrainedModel:EP,NanoChatForCausalLM:LP,NanoChatModel:AP,NanoChatPreTrainedModel:BP,NeoBertForMaskedLM:RP,NeoBertForQuestionAnswering:FP,NeoBertForSequenceClassification:DP,NeoBertForTokenClassification:IP,NeoBertModel:wP,NeoBertPreTrainedModel:jP,NllbTokenizer:PP,NoBadWordsLogitsProcessor:CP,NoRepeatNGramLogitsProcessor:SP,NomicBertModel:MP,NomicBertPreTrainedModel:TP,NougatImageProcessor:_P,NougatTokenizer:kP,OPTForCausalLM:xP,OPTModel:yP,OPTPreTrainedModel:vP,ObjectDetectionPipeline:OP,Olmo2ForCausalLM:bP,Olmo2Model:hP,Olmo2PreTrainedModel:fP,OlmoForCausalLM:dP,OlmoModel:uP,OlmoPreTrainedModel:gP,OpenELMForCausalLM:lP,OpenELMModel:cP,OpenELMPreTrainedModel:mP,OwlViTFeatureExtractor:aP,OwlViTForObjectDetection:pP,OwlViTImageProcessor:rP,OwlViTModel:eP,OwlViTPreTrainedModel:nP,OwlViTProcessor:sP,Owlv2ForObjectDetection:iP,Owlv2ImageProcessor:tP,Owlv2Model:oP,Owlv2PreTrainedModel:JC,PaliGemmaForConditionalGeneration:$C,PaliGemmaPreTrainedModel:ZC,PaliGemmaProcessor:QC,ParakeetFeatureExtractor:WC,ParakeetForCTC:KC,ParakeetPreTrainedModel:YC,PatchTSMixerForPrediction:GC,PatchTSMixerModel:XC,PatchTSMixerPreTrainedModel:qC,PatchTSTForPrediction:HC,PatchTSTModel:VC,PatchTSTPreTrainedModel:UC,Phi3ForCausalLM:NC,Phi3Model:zC,Phi3PreTrainedModel:EC,Phi3VForCausalLM:LC,Phi3VImageProcessor:AC,Phi3VPreTrainedModel:BC,Phi3VProcessor:RC,PhiForCausalLM:FC,PhiModel:DC,PhiPreTrainedModel:IC,Pipeline:wC,PreTrainedModel:jC,PreTrainedTokenizer:PC,PretrainedConfig:CC,PretrainedMixin:SC,Processor:MC,PvtForImageClassification:TC,PvtImageProcessor:_C,PvtModel:kC,PvtPreTrainedModel:xC,PyAnnoteFeatureExtractor:yC,PyAnnoteForAudioFrameClassification:vC,PyAnnoteModel:OC,PyAnnotePreTrainedModel:bC,PyAnnoteProcessor:hC,QuestionAnsweringModelOutput:fC,QuestionAnsweringPipeline:dC,Qwen2ForCausalLM:uC,Qwen2Model:gC,Qwen2PreTrainedModel:lC,Qwen2Tokenizer:cC,Qwen2VLForConditionalGeneration:mC,Qwen2VLImageProcessor:aC,Qwen2VLPreTrainedModel:pC,Qwen2VLProcessor:rC,Qwen3ForCausalLM:eC,Qwen3Model:nC,Qwen3PreTrainedModel:sC,RFDetrForObjectDetection:iC,RFDetrModel:tC,RFDetrObjectDetectionOutput:oC,RFDetrPreTrainedModel:JS,RTDetrForObjectDetection:$S,RTDetrImageProcessor:ZS,RTDetrModel:QS,RTDetrObjectDetectionOutput:WS,RTDetrPreTrainedModel:KS,RTDetrV2ForObjectDetection:YS,RTDetrV2Model:GS,RTDetrV2ObjectDetectionOutput:XS,RTDetrV2PreTrainedModel:qS,RawAudio:HS,RawImage:VS,RawVideo:US,RawVideoFrame:NS,RepetitionPenaltyLogitsProcessor:zS,ResNetForImageClassification:ES,ResNetModel:LS,ResNetPreTrainedModel:AS,RoFormerForMaskedLM:BS,RoFormerForQuestionAnswering:RS,RoFormerForSequenceClassification:FS,RoFormerForTokenClassification:DS,RoFormerModel:IS,RoFormerPreTrainedModel:wS,RoFormerTokenizer:jS,RobertaForMaskedLM:PS,RobertaForQuestionAnswering:CS,RobertaForSequenceClassification:SS,RobertaForTokenClassification:MS,RobertaModel:TS,RobertaPreTrainedModel:_S,RobertaTokenizer:kS,SamImageProcessor:xS,SamImageSegmentationOutput:yS,SamModel:vS,SamPreTrainedModel:OS,SamProcessor:bS,SapiensForDepthEstimation:hS,SapiensForNormalEstimation:fS,SapiensForSemanticSegmentation:dS,SapiensPreTrainedModel:uS,SeamlessM4TFeatureExtractor:gS,SegformerFeatureExtractor:lS,SegformerForImageClassification:cS,SegformerForSemanticSegmentation:mS,SegformerImageProcessor:aS,SegformerModel:pS,SegformerPreTrainedModel:rS,Seq2SeqLMOutput:eS,SequenceClassifierOutput:nS,SiglipImageProcessor:sS,SiglipModel:iS,SiglipPreTrainedModel:tS,SiglipTextModel:oS,SiglipTokenizer:JM,SiglipVisionModel:$M,SmolLM3ForCausalLM:ZM,SmolLM3Model:QM,SmolLM3PreTrainedModel:WM,SmolVLMForConditionalGeneration:KM,SmolVLMImageProcessor:YM,SmolVLMProcessor:GM,SnacDecoderModel:XM,SnacEncoderModel:qM,SnacFeatureExtractor:HM,SnacModel:VM,SnacPreTrainedModel:UM,SpeechT5FeatureExtractor:NM,SpeechT5ForSpeechToText:zM,SpeechT5ForTextToSpeech:EM,SpeechT5HifiGan:LM,SpeechT5Model:AM,SpeechT5PreTrainedModel:BM,SpeechT5Processor:RM,SpeechT5Tokenizer:FM,SqueezeBertForMaskedLM:DM,SqueezeBertForQuestionAnswering:IM,SqueezeBertForSequenceClassification:wM,SqueezeBertModel:jM,SqueezeBertPreTrainedModel:PM,SqueezeBertTokenizer:CM,StableLmForCausalLM:SM,StableLmModel:MM,StableLmPreTrainedModel:TM,Starcoder2ForCausalLM:_M,Starcoder2Model:kM,Starcoder2PreTrainedModel:xM,StoppingCriteria:yM,StoppingCriteriaList:vM,StyleTextToSpeech2Model:OM,StyleTextToSpeech2PreTrainedModel:bM,SummarizationPipeline:hM,SuppressTokensAtBeginLogitsProcessor:fM,Swin2SRForImageSuperResolution:dM,Swin2SRImageProcessor:uM,Swin2SRModel:gM,Swin2SRPreTrainedModel:lM,SwinForImageClassification:cM,SwinForSemanticSegmentation:mM,SwinModel:aM,SwinPreTrainedModel:pM,T5ForConditionalGeneration:rM,T5Model:eM,T5PreTrainedModel:nM,T5Tokenizer:sM,TableTransformerForObjectDetection:iM,TableTransformerModel:tM,TableTransformerObjectDetectionOutput:oM,TableTransformerPreTrainedModel:JT,TemperatureLogitsWarper:$T,Tensor:ZT,Text2TextGenerationPipeline:QT,TextClassificationPipeline:WT,TextGenerationPipeline:KT,TextStreamer:YT,TextToAudioPipeline:GT,TokenClassificationPipeline:XT,TokenClassifierOutput:qT,TokenizerModel:HT,TopKLogitsWarper:VT,TopPLogitsWarper:UT,TrOCRForCausalLM:NT,TrOCRPreTrainedModel:zT,TranslationPipeline:ET,UltravoxModel:LT,UltravoxPreTrainedModel:AT,UltravoxProcessor:BT,UniSpeechForCTC:RT,UniSpeechForSequenceClassification:FT,UniSpeechModel:DT,UniSpeechPreTrainedModel:IT,UniSpeechSatForAudioFrameClassification:wT,UniSpeechSatForCTC:jT,UniSpeechSatForSequenceClassification:PT,UniSpeechSatModel:CT,UniSpeechSatPreTrainedModel:ST,VLChatProcessor:MT,VLMImageProcessor:TT,VaultGemmaForCausalLM:_T,VaultGemmaModel:kT,VaultGemmaPreTrainedModel:xT,ViTFeatureExtractor:yT,ViTForImageClassification:vT,ViTImageProcessor:OT,ViTMAEModel:bT,ViTMAEPreTrainedModel:hT,ViTMSNForImageClassification:fT,ViTMSNModel:dT,ViTMSNPreTrainedModel:uT,ViTModel:gT,ViTPreTrainedModel:lT,VisionEncoderDecoderModel:cT,VitMatteForImageMatting:mT,VitMatteImageProcessor:aT,VitMattePreTrainedModel:pT,VitPoseForPoseEstimation:rT,VitPoseImageProcessor:eT,VitPosePreTrainedModel:nT,VitsModel:sT,VitsModelOutput:iT,VitsPreTrainedModel:tT,VitsTokenizer:oT,VoxtralForConditionalGeneration:J_,VoxtralProcessor:$_,Wav2Vec2BertForCTC:Z_,Wav2Vec2BertForSequenceClassification:Q_,Wav2Vec2BertModel:W_,Wav2Vec2BertPreTrainedModel:K_,Wav2Vec2CTCTokenizer:Y_,Wav2Vec2FeatureExtractor:G_,Wav2Vec2ForAudioFrameClassification:X_,Wav2Vec2ForCTC:q_,Wav2Vec2ForSequenceClassification:H_,Wav2Vec2Model:V_,Wav2Vec2PreTrainedModel:U_,Wav2Vec2Processor:N_,Wav2Vec2ProcessorWithLM:z_,WavLMForAudioFrameClassification:E_,WavLMForCTC:L_,WavLMForSequenceClassification:A_,WavLMForXVector:B_,WavLMModel:R_,WavLMPreTrainedModel:F_,WeSpeakerFeatureExtractor:D_,WeSpeakerResNetModel:I_,WeSpeakerResNetPreTrainedModel:w_,WhisperFeatureExtractor:j_,WhisperForConditionalGeneration:P_,WhisperModel:C_,WhisperPreTrainedModel:S_,WhisperProcessor:M_,WhisperTextStreamer:T_,WhisperTimeStampLogitsProcessor:__,WhisperTokenizer:k_,XLMForQuestionAnswering:x_,XLMForSequenceClassification:y_,XLMForTokenClassification:v_,XLMModel:O_,XLMPreTrainedModel:b_,XLMRobertaForMaskedLM:h_,XLMRobertaForQuestionAnswering:f_,XLMRobertaForSequenceClassification:d_,XLMRobertaForTokenClassification:u_,XLMRobertaModel:g_,XLMRobertaPreTrainedModel:l_,XLMRobertaTokenizer:c_,XLMTokenizer:m_,XLMWithLMHeadModel:a_,XVectorOutput:p_,YolosFeatureExtractor:r_,YolosForObjectDetection:e_,YolosImageProcessor:n_,YolosModel:s_,YolosObjectDetectionOutput:i_,YolosPreTrainedModel:t_,ZeroShotAudioClassificationPipeline:o_,ZeroShotClassificationPipeline:Jk,ZeroShotImageClassificationPipeline:$k,ZeroShotObjectDetectionPipeline:Zk,bankers_round:Qk,cat:Wk,cos_sim:Kk,dot:Yk,dynamic_time_warping:Gk,env:Xk,full:qk,full_like:Hk,getCacheShapes:Vk,hamming:Uk,hanning:Nk,interpolate:zk,interpolate_4d:Ek,interpolate_data:Lk,is_chinese_char:Ak,layer_norm:Bk,load_image:Rk,load_video:Fk,log_softmax:Dk,magnitude:Ik,matmul:wk,max:jk,mean:Pk,mean_pooling:Ck,medianFilter:Sk,mel_filter_bank:Mk,min:Tk,ones:_k,ones_like:kk,permute:xk,permute_data:yk,pipeline:vk,quantize_embeddings:Ok,rand:bk,read_audio:hk,rfft:fk,round:dk,slice:uk,softmax:gk,spectrogram:lk,stack:ck,std_mean:mk,topk:ak,window_function:pk,zeros:rk,zeros_like:ek}=K;class Y8{tokenizer;initialized=!1;modelPath;constructor(J={}){this.modelPath=J.modelPath||"./models/starcoder2"}async initialize(){if(this.initialized)return;console.log("\uD83D\uDE80 Initializing Direct StarCoder2 Tokenizer...");try{this.tokenizer=await gV.from_pretrained(this.modelPath),this.initialized=!0,console.log(" Direct StarCoder2 Tokenizer initialized successfully!")}catch(J){throw console.error(" Failed to initialize StarCoder2 tokenizer:",J),Error(`StarCoder2 initialization failed: ${J.message}`)}}async tokenize(J){if(!this.initialized)await this.initialize();let Z=Date.now();console.log("\uD83D\uDD24 Starting Direct StarCoder2 tokenization...");try{let Q=(await this.tokenizer(J)).input_ids.tolist()[0],W=await this.tokenizer.decode(Q),Y=this.extractMeaningfulTokens(W,Q,J),H=this.calculateScores(Y,J),G=Date.now()-Z;return console.log(` Direct StarCoder2 tokenization completed in ${G}ms`),{tokens:H,metadata:{totalTokens:H.length,vocabSize:49152,processingTime:G,averageConfidence:this.calculateAverageConfidence(H)},raw:{inputIds:Q,decodedText:W}}}catch($){throw console.error(" StarCoder2 tokenization failed:",$),Error(`Tokenization failed: ${$.message}`)}}extractMeaningfulTokens(J,Z,$){let Q=[],W=J.replace(/[{}()\[\];,<\.>]/g," $& ").split(/\s+/).filter((G)=>G.length>0),Y=0;for(let G=0;G<W.length;G++){let q=W[G],z=Y<Z.length?Z[Y]:Z[Z.length-1];Y++,Q.push({text:q,id:z,score:0.5,confidence:0.9,relevance:"medium"})}let H=this.extractTechnicalTerms(J);for(let G of H){let q=Q.find((z)=>z.text.toLowerCase()===G.toLowerCase());if(q)q.score=Math.min(q.score+0.3,1),q.confidence=Math.min(q.confidence+0.1,1),q.relevance=this.determineRelevance(q.score);else{let z=Y<Z.length?Z[Y]:Z[Z.length-1];Y++,Q.push({text:G,id:z,score:0.8,confidence:0.95,relevance:"high"})}}return Q}extractTechnicalTerms(J){let Z=[],$=[/\b[A-Z]{2,}\b/g,/\b[a-z]+[A-Z][a-zA-Z]*\b/g,/\b[a-z]+_[a-z_]+\b/g,/\bv?\d+\.\d+\.\d+(-[a-zA-Z0-9]+)?\b/g,/\b(?:\/|[a-zA-Z]:\\\\)[^\s<>:"|?*]*\b/g,/https?:\/\/[^\s<>"]+/g,/\b(async|await|function|class|const|let|var|import|export|return|throw|try|catch|finally|interface|type|enum|Promise|Array|Object|String|Number|Boolean)\b/g];for(let Q of $){let W=J.match(Q);if(W)Z.push(...W)}return[...new Set(Z)]}calculateScores(J,Z){let $=[];for(let Q of J){let W=Q.score;if(this.isTechnicalTerm(Q.text))W+=0.2;if(Q.text.length>6)W+=0.1;if(Q.text.length>10)W+=0.1;let Y=this.calculateTokenFrequency(Q.text,Z);if(Y===1)W+=0.2;else if(Y>=5)W-=0.1;if(this.isStructuralToken(Q.text))W+=0.15;$.push({...Q,score:Math.min(W,1),relevance:this.determineRelevance(W)})}return $.sort((Q,W)=>W.score-Q.score)}isTechnicalTerm(J){return/^[A-Z]{2,}$/.test(J)||/^[a-z]+[A-Z]/.test(J)||/^[a-z]+_[a-z_]+$/.test(J)||/^v?\d+\.\d+\.\d+/.test(J)||/^(async|await|function|class|const|let|var|import|export|return|throw|try|catch|finally|interface|type|enum)$/.test(J)}isStructuralToken(J){return/^[\{\}\(\)\[\];,<\.>]$/.test(J)}calculateTokenFrequency(J,Z){let $=new RegExp(this.escapeRegExp(J),"g"),Q=Z.match($);return Q?Q.length:0}escapeRegExp(J){return J.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}determineRelevance(J){if(J>=0.8)return"high";if(J>=0.5)return"medium";return"low"}calculateAverageConfidence(J){if(J.length===0)return 0;return J.reduce(($,Q)=>$+Q.confidence,0)/J.length}async getTopTokens(J,Z=20,$=0.3){return(await this.tokenize(J)).tokens.filter((W)=>W.score>=$).slice(0,Z)}async getTechnicalTokens(J){return(await this.tokenize(J)).tokens.filter(($)=>this.isTechnicalTerm($.text)||$.relevance==="high")}async decode(J){if(!this.initialized)throw Error("Tokenizer not initialized. Call initialize() first.");return await this.tokenizer.decode(J)}async encode(J){if(!this.initialized)throw Error("Tokenizer not initialized. Call initialize() first.");return(await this.tokenizer(J)).input_ids.tolist()[0]}}async function nx(J,Z){try{let $=await J.getAllCodebaseFiles();if(Z){if(Z.file_extensions&&Z.file_extensions.length>0)$=$.filter((H)=>Z.file_extensions?.some((G)=>H.path.endsWith(G)));if(Z.path_filter)$=$.filter((H)=>H.path.includes(Z.path_filter));if(Z.exclude_paths&&Z.exclude_paths.length>0)$=$.filter((H)=>!Z.exclude_paths?.some((G)=>H.path.includes(G)))}if($.length===0)return null;let Q=[];for(let H of $){let G=await J.getTFIDFDocument(H.path);if(G){let q=G.rawTerms||{},z=new Map,U=new Map;for(let[N,L]of Object.entries(q))z.set(N,L),U.set(N,L);Q.push({uri:`file://${H.path}`,terms:z,rawTerms:U,magnitude:G.magnitude})}}if(Q.length===0)return null;let W=await J.getIDFValues(),Y=new Map;for(let[H,G]of Object.entries(W))Y.set(H,G);return{documents:Q,idf:Y,totalDocuments:Q.length,metadata:{generatedAt:new Date().toISOString(),version:"1.0.0"}}}catch($){return console.error("[ERROR] Failed to build search index from database:",$),null}}function lV(J){let Z=Array.from(J.values()).reduce((Q,W)=>Q+W,0),$=new Map;for(let[Q,W]of J.entries())$.set(Q,W/Z);return $}function FL(J,Z){let $=new Map;for(let W of J){let Y=new Set(W.keys());for(let H of Y)$.set(H,($.get(H)||0)+1)}let Q=new Map;for(let[W,Y]of $.entries())Q.set(W,Math.log(Z/Y));return Q}function cV(J,Z){let $=new Map;for(let[Q,W]of J.entries()){let Y=Z.get(Q)||0;$.set(Q,W*Y)}return $}function mV(J){let Z=0;for(let $ of J.values())Z+=$*$;return Math.sqrt(Z)}async function aV(J){let Z=new Y8({modelPath:"./models/starcoder2"});await Z.initialize();let $=await Z.tokenize(J),Q=new Map;for(let W of $.tokens){let Y=W.text.toLowerCase(),H=Q.get(Y)||0;Q.set(Y,H+W.score)}return Q}async function DL(J){let Z=new Y8({modelPath:"./models/starcoder2"});await Z.initialize();let $=await Z.tokenize(J),Q=new Map;for(let W of $.tokens){let Y=W.text.toLowerCase();if(!Q.has(Y)||W.score>0.8)Q.set(Y,W.text)}return Array.from(Q.values())}async function sx(J){console.log("\uD83D\uDE80 Building Direct StarCoder2 search index...");let Z=J.map(async(Y)=>({uri:Y.uri,terms:await aV(Y.content)})),$=await Promise.all(Z),Q=FL($.map((Y)=>Y.terms),J.length),W=$.map((Y)=>{let H=lV(Y.terms),G=cV(H,Q),q=mV(G);return{uri:Y.uri,terms:G,rawTerms:Y.terms,magnitude:q}});return console.log(` Direct StarCoder2 search index built with ${W.length} documents`),{documents:W,idf:Q,totalDocuments:J.length,metadata:{generatedAt:new Date().toISOString(),version:"5.0.0-direct-starcoder2",tokenizer:"Direct StarCoder2",features:["StarCoder2 industry-leading code understanding","Advanced technical term recognition","Optimized for code search","Simple and effective approach","No unnecessary complexity"]}}}function IL(J,Z){let $=0;for(let[W,Y]of J.entries()){let H=Z.terms.get(W)||0;$+=Y*H}let Q=mV(J);if(Q===0||Z.magnitude===0)return 0;return $/(Q*Z.magnitude)}async function wL(J,Z){let $=await aV(J),Q=lV($);return cV(Q,Z)}async function ix(J,Z,$={}){let{limit:Q=10,minScore:W=0,boostFactors:Y={}}=$,{exactMatch:H=1.5,phraseMatch:G=2,technicalMatch:q=1.8,identifierMatch:z=1.3}=Y,U=await wL(J,Z.idf),N=(await DL(J)).map((w)=>w.toLowerCase());return Z.documents.map((w)=>{let F=IL(U,w),v=[];for(let I of N)if(w.rawTerms.has(I)){let j=H;if(jL(I))j=Math.max(j,q);if(PL(I))j=Math.max(j,z);F*=j,v.push(I)}if(v.length===N.length&&N.length>1)F*=G;if(N.length>3&&v.length>=N.length*0.7)F*=1.2;return{uri:w.uri,score:F,matchedTerms:v}}).filter((w)=>w.score>=W).sort((w,F)=>F.score-w.score).slice(0,Q)}function jL(J){return[/\b[A-Z]{2,}\b/,/\b[A-Z][a-z]+(?:[A-Z][a-z]+)+\b/,/\b[a-z]+[A-Z][a-z]*\b/,/\b\w+(?:Dir|Config|File|Path|Data|Service|Manager|Handler)\b/,/\b(?:get|set|is|has|can|should|will|do)[A-Z]\w*\b/,/\b(?:http|https|json|xml|yaml|sql|api|url|uri)\b/].some(($)=>$.test(J))}function PL(J){return/^[a-zA-Z][a-zA-Z0-9_]*$/.test(J)&&J.length>1}function tx(J){let Z={documents:J.documents.map(($)=>({uri:$.uri,terms:Array.from($.terms.entries()),rawTerms:Array.from($.rawTerms.entries()),magnitude:$.magnitude})),idf:Array.from(J.idf.entries()),totalDocuments:J.totalDocuments,metadata:J.metadata};return JSON.stringify(Z,null,2)}function ox(J){let Z=JSON.parse(J);return{documents:Z.documents.map(($)=>({uri:$.uri,terms:new Map($.terms),rawTerms:new Map($.rawTerms),magnitude:$.magnitude})),idf:new Map(Z.idf),totalDocuments:Z.totalDocuments,metadata:Z.metadata}}export{tx as serializeIndex,ix as searchDocuments,wL as processQuery,ox as deserializeIndex,IL as calculateCosineSimilarity,nx as buildSearchIndexFromDB,sx as buildDirectStarCoder2Index};
export{nG as a,J6 as b,qU as c,b6 as d,sx as e,ix as f};
